<!doctype html><html lang=cn><head><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8920808282451934" crossorigin=anonymous></script><div id=cursor-chat-layer><input type=text id=cursor-chat-box></div><script src=https://unpkg.com/cursor-chat></script>
<link rel=stylesheet type=text/css href=https://unpkg.com/cursor-chat/dist/style.css><meta name=baidu-site-verification content="codeva-qMAjqdfVJc"><meta charset=utf-8><meta name=description content="Nettyè¿›é˜¶ 1. ç²˜åŒ…ä¸åŠåŒ… 1.1 ç²˜åŒ…ç°è±¡ æœåŠ¡ç«¯ä»£ç 
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  public class HelloWorldServer { static final Logger log = LoggerFactory."><title>Nettyè¿›é˜¶</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://harbor.mffseal.top//icon.png><link href=https://harbor.mffseal.top/styles.73cf69c3fd63eaf27dde453f5aa109f7.min.css rel=stylesheet><link href=https://harbor.mffseal.top/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://harbor.mffseal.top/js/darkmode.9841b88d44c115f7419d485ee72d23a2.min.js></script>
<script src=https://harbor.mffseal.top/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://harbor.mffseal.top/js/popover.53ad9a087e3feeaaa12b63bfd02d923b.min.js></script>
<script src=https://harbor.mffseal.top/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://harbor.mffseal.top/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://harbor.mffseal.top/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://harbor.mffseal.top/",fetchData=Promise.all([fetch("https://harbor.mffseal.top/indices/linkIndex.3d2d03102eda393ed53f6fd9593533e0.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://harbor.mffseal.top/indices/contentIndex.4d3a05c4c5c32394f6cde27b202efda0.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://harbor.mffseal.top",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://harbor.mffseal.top",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/harbor.mffseal.top\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-NV58SYWRZD"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NV58SYWRZD",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=æœç´¢ placeholder=æœä¸€æœ...><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://harbor.mffseal.top/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://harbor.mffseal.top/>ğŸ¦­ æ¸¯æ¹¾</a></h1><div class=spacer></div><div id=search-icon><p>æœç´¢</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">æœç´¢å›¾æ ‡</title><desc id="desc">æ‰“å¼€æœç´¢å›¾æ ‡</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>äº®è‰²</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>æš—è‰²</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Nettyè¿›é˜¶</h1><p class=meta>æœ€åæ›´æ–°
Sep 18, 2022
<a href="obsidian://open?vault=content&file=3-%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%a7%91%e5%ad%a6%2f6-%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%2fWeb%e5%90%8e%e7%ab%af%e5%bc%80%e5%8f%91%2fNetty%2fNetty%e8%bf%9b%e9%98%b6.md" rel=noopener>ç¼–è¾‘æº</a></p><ul class=tags><li><a href=https://harbor.mffseal.top/tags/article/>Article</a></li></ul><div class=toc-wrapper><div class=mainTOC id=mainTOC><aside><header><h3>Nettyè¿›é˜¶</h3></header><nav id=TableOfContents><ol><li><a href=#1-ç²˜åŒ…ä¸åŠåŒ…>1. ç²˜åŒ…ä¸åŠåŒ…</a><ol><li><a href=#11-ç²˜åŒ…ç°è±¡>1.1 ç²˜åŒ…ç°è±¡</a></li><li><a href=#12-åŠåŒ…ç°è±¡>1.2 åŠåŒ…ç°è±¡</a></li><li><a href=#13-ç°è±¡åˆ†æ>ğŸ’¡1.3 ç°è±¡åˆ†æ</a></li><li><a href=#14-è§£å†³æ–¹æ¡ˆ>1.4 ğŸ’¡è§£å†³æ–¹æ¡ˆ</a></li></ol></li><li><a href=#2-åè®®è®¾è®¡ä¸è§£æ>2. åè®®è®¾è®¡ä¸è§£æ</a><ol><li><a href=#21-ä¸ºä»€ä¹ˆéœ€è¦åè®®>2.1 ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ</a></li><li><a href=#22-redis-åè®®ä¸¾ä¾‹>2.2 redis åè®®ä¸¾ä¾‹</a></li><li><a href=#23-http-åè®®ä¸¾ä¾‹>2.3 http åè®®ä¸¾ä¾‹</a></li><li><a href=#24-è‡ªå®šä¹‰åè®®è¦ç´ >2.4 è‡ªå®šä¹‰åè®®è¦ç´ </a></li></ol></li><li><a href=#3-èŠå¤©å®¤æ¡ˆä¾‹>3. èŠå¤©å®¤æ¡ˆä¾‹</a><ol><li><a href=#31-èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»>3.1 èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»</a></li><li><a href=#32-èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•>3.2 èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•</a></li><li><a href=#33-èŠå¤©å®¤ä¸šåŠ¡-å•èŠ>3.3 èŠå¤©å®¤ä¸šåŠ¡-å•èŠ</a></li><li><a href=#34-èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ>3.4 èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ</a></li><li><a href=#35-èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º>3.5 èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º</a></li><li><a href=#36-èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹>3.6 èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹</a></li></ol></li></ol></nav></aside><a href=# id=toc-toggle></a></div></div><a href=#nettyè¿›é˜¶><h1 id=nettyè¿›é˜¶><span class=hanchor arialabel=Anchor># </span>Nettyè¿›é˜¶</h1></a><a href=#1-ç²˜åŒ…ä¸åŠåŒ…><h2 id=1-ç²˜åŒ…ä¸åŠåŒ…><span class=hanchor arialabel=Anchor># </span>1. ç²˜åŒ…ä¸åŠåŒ…</h2></a><a href=#11-ç²˜åŒ…ç°è±¡><h3 id=11-ç²˜åŒ…ç°è±¡><span class=hanchor arialabel=Anchor># </span>1.1 ç²˜åŒ…ç°è±¡</h3></a><p>æœåŠ¡ç«¯ä»£ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a>
</span><span class=lnt id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a>
</span><span class=lnt id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a>
</span><span class=lnt id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a>
</span><span class=lnt id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a>
</span><span class=lnt id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30>30</a>
</span><span class=lnt id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31>31</a>
</span><span class=lnt id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32>32</a>
</span><span class=lnt id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33>33</a>
</span><span class=lnt id=hl-0-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-34>34</a>
</span><span class=lnt id=hl-0-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-35>35</a>
</span><span class=lnt id=hl-0-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-36>36</a>
</span><span class=lnt id=hl-0-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-37>37</a>
</span><span class=lnt id=hl-0-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-38>38</a>
</span><span class=lnt id=hl-0-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-39>39</a>
</span><span class=lnt id=hl-0-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-40>40</a>
</span><span class=lnt id=hl-0-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-41>41</a>
</span><span class=lnt id=hl-0-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-42>42</a>
</span><span class=lnt id=hl-0-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-43>43</a>
</span><span class=lnt id=hl-0-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-44>44</a>
</span><span class=lnt id=hl-0-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-45>45</a>
</span><span class=lnt id=hl-0-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloWorldServer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>log</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>HelloWorldServer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>start</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>boss</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>(</span><span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ServerBootstrap</span> <span class=n>serverBootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServerBootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioServerSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>boss</span><span class=o>,</span> <span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>childHandler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(</span><span class=n>LogLevel</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInboundHandlerAdapter</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelActive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;connected {}&#34;</span><span class=o>,</span> <span class=n>ctx</span><span class=o>.</span><span class=na>channel</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                            <span class=kd>super</span><span class=o>.</span><span class=na>channelActive</span><span class=o>(</span><span class=n>ctx</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelInactive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;disconnect {}&#34;</span><span class=o>,</span> <span class=n>ctx</span><span class=o>.</span><span class=na>channel</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                            <span class=kd>super</span><span class=o>.</span><span class=na>channelInactive</span><span class=o>(</span><span class=n>ctx</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>});</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=n>ChannelFuture</span> <span class=n>channelFuture</span> <span class=o>=</span> <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>bind</span><span class=o>(</span><span class=n>8080</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;{} binding...&#34;</span><span class=o>,</span> <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>channelFuture</span><span class=o>.</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;{} bound...&#34;</span><span class=o>,</span> <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;server error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>boss</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;stoped&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>HelloWorldServer</span><span class=o>().</span><span class=na>start</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å®¢æˆ·ç«¯ä»£ç å¸Œæœ›å‘é€ 10 ä¸ªæ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆæ¯æ˜¯ 16 å­—èŠ‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-32>32</a>
</span><span class=lnt id=hl-1-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-33>33</a>
</span><span class=lnt id=hl-1-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-34>34</a>
</span><span class=lnt id=hl-1-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-35>35</a>
</span><span class=lnt id=hl-1-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-36>36</a>
</span><span class=lnt id=hl-1-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloWorldClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>log</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>HelloWorldClient</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Bootstrap</span> <span class=n>bootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>handler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;connetted...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInboundHandlerAdapter</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelActive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;sending...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=n>Random</span> <span class=n>r</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=kt>char</span> <span class=n>c</span> <span class=o>=</span> <span class=sc>&#39;a&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                            <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=n>ByteBuf</span> <span class=n>buffer</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=k>new</span> <span class=kt>byte</span><span class=o>[]{</span><span class=n>0</span><span class=o>,</span> <span class=n>1</span><span class=o>,</span> <span class=n>2</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>4</span><span class=o>,</span> <span class=n>5</span><span class=o>,</span> <span class=n>6</span><span class=o>,</span> <span class=n>7</span><span class=o>,</span> <span class=n>8</span><span class=o>,</span> <span class=n>9</span><span class=o>,</span> <span class=n>10</span><span class=o>,</span> <span class=n>11</span><span class=o>,</span> <span class=n>12</span><span class=o>,</span> <span class=n>13</span><span class=o>,</span> <span class=n>14</span><span class=o>,</span> <span class=n>15</span><span class=o>});</span>
</span></span><span class=line><span class=cl>                                <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=o>}</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>});</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=n>ChannelFuture</span> <span class=n>channelFuture</span> <span class=o>=</span> <span class=n>bootstrap</span><span class=o>.</span><span class=na>connect</span><span class=o>(</span><span class=s>&#34;127.0.0.1&#34;</span><span class=o>,</span> <span class=n>8080</span><span class=o>).</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;client error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æœåŠ¡å™¨ç«¯çš„æŸæ¬¡è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°ä¸€æ¬¡å°±æ¥æ”¶äº† 160 ä¸ªå­—èŠ‚ï¼Œè€Œéåˆ† 10 æ¬¡æ¥æ”¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>08:24:46 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x81e0fda5] binding...
</span></span><span class=line><span class=cl>08:24:46 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x81e0fda5, L:/0:0:0:0:0:0:0:0:8080] bound...
</span></span><span class=line><span class=cl>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] REGISTERED
</span></span><span class=line><span class=cl>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] ACTIVE
</span></span><span class=line><span class=cl>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177]
</span></span><span class=line><span class=cl>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] READ: 160B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000010| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000020| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000030| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000040| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000050| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000060| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000070| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000080| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000090| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] READ COMPLETE
</span></span></code></pre></td></tr></table></div></div><a href=#12-åŠåŒ…ç°è±¡><h3 id=12-åŠåŒ…ç°è±¡><span class=hanchor arialabel=Anchor># </span>1.2 åŠåŒ…ç°è±¡</h3></a><p>å®¢æˆ·ç«¯ä»£ç å¸Œæœ›å‘é€ 1 ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ 160 å­—èŠ‚ï¼Œä»£ç æ”¹ä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ByteBuf</span> <span class=n>buffer</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=k>new</span> <span class=kt>byte</span><span class=o>[]{</span><span class=n>0</span><span class=o>,</span> <span class=n>1</span><span class=o>,</span> <span class=n>2</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>4</span><span class=o>,</span> <span class=n>5</span><span class=o>,</span> <span class=n>6</span><span class=o>,</span> <span class=n>7</span><span class=o>,</span> <span class=n>8</span><span class=o>,</span> <span class=n>9</span><span class=o>,</span> <span class=n>10</span><span class=o>,</span> <span class=n>11</span><span class=o>,</span> <span class=n>12</span><span class=o>,</span> <span class=n>13</span><span class=o>,</span> <span class=n>14</span><span class=o>,</span> <span class=n>15</span><span class=o>});</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸ºç°è±¡æ˜æ˜¾ï¼ŒæœåŠ¡ç«¯ä¿®æ”¹ä¸€ä¸‹æ¥æ”¶ç¼“å†²åŒºï¼Œå…¶å®ƒä»£ç ä¸å˜</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>serverBootstrap</span><span class=o>.</span><span class=na>option</span><span class=o>(</span><span class=n>ChannelOption</span><span class=o>.</span><span class=na>SO_RCVBUF</span><span class=o>,</span> <span class=n>10</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>æœåŠ¡å™¨ç«¯çš„æŸæ¬¡è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ¥æ”¶çš„æ¶ˆæ¯è¢«åˆ†ä¸ºä¸¤èŠ‚ï¼Œç¬¬ä¸€æ¬¡ 20 å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡ 140 å­—èŠ‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>08:43:49 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x4d6c6a84] binding...
</span></span><span class=line><span class=cl>08:43:49 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x4d6c6a84, L:/0:0:0:0:0:0:0:0:8080] bound...
</span></span><span class=line><span class=cl>08:44:23 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] REGISTERED
</span></span><span class=line><span class=cl>08:44:23 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] ACTIVE
</span></span><span class=line><span class=cl>08:44:23 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221]
</span></span><span class=line><span class=cl>08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ: 20B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|
</span></span><span class=line><span class=cl>|00000010| 00 01 02 03                                     |....            |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ COMPLETE
</span></span><span class=line><span class=cl>08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ: 140B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|
</span></span><span class=line><span class=cl>|00000010| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|
</span></span><span class=line><span class=cl>|00000020| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|
</span></span><span class=line><span class=cl>|00000030| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|
</span></span><span class=line><span class=cl>|00000040| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|
</span></span><span class=line><span class=cl>|00000050| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|
</span></span><span class=line><span class=cl>|00000060| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|
</span></span><span class=line><span class=cl>|00000070| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|
</span></span><span class=line><span class=cl>|00000080| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f             |............    |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ COMPLETE
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>æ³¨æ„</strong></p><p>serverBootstrap.option(ChannelOption.SO_RCVBUF, 10) å½±å“çš„åº•å±‚æ¥æ”¶ç¼“å†²åŒºï¼ˆå³æ»‘åŠ¨çª—å£ï¼‰å¤§å°ï¼Œä»…å†³å®šäº† netty è¯»å–çš„æœ€å°å•ä½ï¼Œnetty å®é™…æ¯æ¬¡è¯»å–çš„ä¸€èˆ¬æ˜¯å®ƒçš„æ•´æ•°å€</p></blockquote><a href=#13-ç°è±¡åˆ†æ><h3 id=13-ç°è±¡åˆ†æ><span class=hanchor arialabel=Anchor># </span>ğŸ’¡1.3 ç°è±¡åˆ†æ</h3></a><blockquote><p>æ€»åŸå› ï¼šTCPæ¶ˆæ¯æ²¡æœ‰è¾¹ç•Œã€‚</p></blockquote><a href=#ç²˜åŒ…><h4 id=ç²˜åŒ…><span class=hanchor arialabel=Anchor># </span>ç²˜åŒ…</h4></a><ul><li>ç°è±¡ï¼Œå‘é€ abc defï¼Œæ¥æ”¶ abcdef</li><li>åŸå› <ul><li><strong>åº”ç”¨å±‚</strong>ï¼šæ¥æ”¶æ–¹ ByteBuf è®¾ç½®å¤ªå¤§ï¼ˆNetty é»˜è®¤ 1024ï¼‰</li><li><strong>ä¼ è¾“å±‚</strong>ï¼šTCPï¼šæ»‘åŠ¨çª—å£ï¼šå‡è®¾å‘é€æ–¹ 256 bytes è¡¨ç¤ºä¸€ä¸ªå®Œæ•´æŠ¥æ–‡ï¼Œä½†ç”±äºæ¥æ”¶æ–¹å¤„ç†ä¸åŠæ—¶ä¸”çª—å£å¤§å°è¶³å¤Ÿå¤§ï¼Œè¿™ 256 bytes å­—èŠ‚å°±ä¼šç¼“å†²åœ¨æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£ä¸­ï¼Œå½“æ»‘åŠ¨çª—å£ä¸­ç¼“å†²äº†å¤šä¸ªæŠ¥æ–‡å°±ä¼šç²˜åŒ…</li><li><strong>ä¼ è¾“å±‚</strong>ï¼šTCPï¼šNagle ç®—æ³•ï¼šä¼šé€ æˆç²˜åŒ…</li></ul></li></ul><blockquote><p>Nagle ç®—æ³•</p><ul><li>ç³Šæ¶‚çª—å£ç»¼åˆå¾ï¼šå³ä½¿å‘é€1ä¸ªå­—èŠ‚ï¼Œä¹Ÿéœ€è¦åŠ å…¥ tcp å¤´å’Œ ip å¤´ï¼Œä¹Ÿå°±æ˜¯æ€»å­—èŠ‚æ•°ä¼šä½¿ç”¨ 41 bytesï¼ˆTCP20+IP20+æ•°æ®1ï¼‰ï¼Œéå¸¸ä¸ç»æµã€‚å› æ­¤ä¸ºäº†æé«˜ç½‘ç»œåˆ©ç”¨ç‡ï¼Œtcp å¸Œæœ›<strong>å°½å¯èƒ½å‘é€è¶³å¤Ÿå¤§çš„æ•°æ®</strong>ï¼Œè¿™å°±æ˜¯ Nagle ç®—æ³•äº§ç”Ÿçš„ç¼˜ç”±</li><li>è¯¥ç®—æ³•æ˜¯æŒ‡å‘é€ç«¯å³ä½¿è¿˜æœ‰åº”è¯¥å‘é€çš„æ•°æ®ï¼Œä½†å¦‚æœè¿™éƒ¨åˆ†æ•°æ®å¾ˆå°‘çš„è¯ï¼Œåˆ™è¿›è¡Œå»¶è¿Ÿå‘é€<ul><li>å¦‚æœ SO_SNDBUF çš„æ•°æ®è¾¾åˆ° MSSï¼Œåˆ™éœ€è¦å‘é€</li><li>å¦‚æœ SO_SNDBUF ä¸­å«æœ‰ FINï¼ˆè¡¨ç¤ºéœ€è¦è¿æ¥å…³é—­ï¼‰è¿™æ—¶å°†å‰©ä½™æ•°æ®å‘é€ï¼Œå†å…³é—­</li><li>å¦‚æœ TCP_NODELAY = trueï¼Œåˆ™éœ€è¦å‘é€</li><li>å·²å‘é€çš„æ•°æ®éƒ½æ”¶åˆ° ack æ—¶ï¼Œåˆ™éœ€è¦å‘é€</li><li>ä¸Šè¿°æ¡ä»¶ä¸æ»¡è¶³ï¼Œä½†å‘ç”Ÿè¶…æ—¶ï¼ˆä¸€èˆ¬ä¸º 200msï¼‰åˆ™éœ€è¦å‘é€</li><li>é™¤ä¸Šè¿°æƒ…å†µï¼Œå»¶è¿Ÿå‘é€</li></ul></li></ul></blockquote><a href=#åŠåŒ…><h4 id=åŠåŒ…><span class=hanchor arialabel=Anchor># </span>åŠåŒ…</h4></a><ul><li>ç°è±¡ï¼Œå‘é€ abcdefï¼Œæ¥æ”¶ abc def</li><li>åŸå› <ul><li><strong>åº”ç”¨å±‚</strong>ï¼šæ¥æ”¶æ–¹ ByteBuf å°äºå®é™…å‘é€æ•°æ®é‡</li><li><strong>ä¼ è¾“å±‚</strong>ï¼šTCPï¼šæ»‘åŠ¨çª—å£ï¼šå‡è®¾æ¥æ”¶æ–¹çš„çª—å£åªå‰©äº† 128 bytesï¼Œå‘é€æ–¹çš„æŠ¥æ–‡å¤§å°æ˜¯ 256 bytesï¼Œè¿™æ—¶æ”¾ä¸ä¸‹äº†ï¼Œåªèƒ½å…ˆå‘é€å‰ 128 bytesï¼Œç­‰å¾… ack åæ‰èƒ½å‘é€å‰©ä½™éƒ¨åˆ†ï¼Œè¿™å°±é€ æˆäº†åŠåŒ…</li><li><strong>æ•°æ®é“¾è·¯å±‚</strong>ï¼šMSS é™åˆ¶ï¼šå½“å‘é€çš„æ•°æ®è¶…è¿‡ MSS é™åˆ¶åï¼Œä¼šå°†æ•°æ®åˆ‡åˆ†å‘é€ï¼Œå°±ä¼šé€ æˆåŠåŒ…<ul><li>â†‘MSSæ˜¯<strong>ä¼ è¾“å±‚</strong>çš„æŠ¥æ–‡è½½è·é•¿åº¦ï¼ˆä¸åŒ…å«æŠ¥å¤´ï¼‰ï¼ŒMTUæ˜¯<strong>æ•°æ®é“¾è·¯å±‚</strong>æœ€å¤§è½½è·é•¿åº¦ï¼Œå…¶ä¸­MTUåŒ…å«äº†MSSï¼ŒMTUå‡å»IPå¤´å’ŒTCPå¤´ï¼ˆ20+20ï¼‰å°±æ˜¯MSS</li><li>æœ¬æœºå›ç¯åœ°å€MTUé™åˆ¶å¾ˆå¤§ï¼Œ65535ï¼Œéš¾ä»¥æµ‹è¯•ã€‚</li></ul></li></ul></li></ul><p>æœ¬è´¨æ˜¯å› ä¸º TCP æ˜¯æµå¼åè®®ï¼Œæ¶ˆæ¯æ— è¾¹ç•Œ</p><blockquote><p>æ»‘åŠ¨çª—å£</p><ul><li><p>TCP ä»¥ä¸€ä¸ªæ®µï¼ˆsegmentï¼‰ä¸ºå•ä½ï¼Œæ¯å‘é€ä¸€ä¸ªæ®µå°±éœ€è¦è¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”ï¼ˆackï¼‰å¤„ç†ï¼Œä½†å¦‚æœè¿™ä¹ˆåšï¼Œç¼ºç‚¹æ˜¯åŒ…çš„å¾€è¿”æ—¶é—´è¶Šé•¿æ€§èƒ½å°±è¶Šå·®</p><p><img src="/z-oblib/z2-attachments/0049 1.png" width=auto></p></li></ul><p>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå¼•å…¥äº†çª—å£æ¦‚å¿µï¼Œçª—å£å¤§å°å³å†³å®šäº†æ— éœ€ç­‰å¾…åº”ç­”è€Œå¯ä»¥ç»§ç»­å‘é€çš„æ•°æ®æœ€å¤§å€¼</p><p><img src=/z-oblib/z2-attachments/0051.png width=auto></p><ul><li><p>çª—å£å®é™…å°±èµ·åˆ°ä¸€ä¸ªç¼“å†²åŒºçš„ä½œç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½èµ·åˆ°æµé‡æ§åˆ¶çš„ä½œç”¨</p><ul><li>å›¾ä¸­æ·±è‰²çš„éƒ¨åˆ†å³è¦å‘é€çš„æ•°æ®ï¼Œé«˜äº®çš„éƒ¨åˆ†å³çª—å£</li><li>çª—å£å†…çš„æ•°æ®æ‰å…è®¸è¢«å‘é€ï¼Œå½“åº”ç­”æœªåˆ°è¾¾å‰ï¼Œçª—å£å¿…é¡»åœæ­¢æ»‘åŠ¨</li><li>å¦‚æœ 1001~2000 è¿™ä¸ªæ®µçš„æ•°æ® ack å›æ¥äº†ï¼Œçª—å£å°±å¯ä»¥å‘å‰æ»‘åŠ¨</li><li>æ¥æ”¶æ–¹ä¹Ÿä¼šç»´æŠ¤ä¸€ä¸ªçª—å£ï¼Œåªæœ‰è½åœ¨çª—å£å†…çš„æ•°æ®æ‰èƒ½å…è®¸æ¥æ”¶</li></ul></li></ul></blockquote><blockquote><p>MSS é™åˆ¶</p><ul><li><p>é“¾è·¯å±‚å¯¹ä¸€æ¬¡èƒ½å¤Ÿå‘é€çš„æœ€å¤§æ•°æ®æœ‰é™åˆ¶ï¼Œè¿™ä¸ªé™åˆ¶ç§°ä¹‹ä¸º MTUï¼ˆmaximum transmission unitï¼‰ï¼Œä¸åŒçš„é“¾è·¯è®¾å¤‡çš„ MTU å€¼ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä¾‹å¦‚</p></li><li><p>ä»¥å¤ªç½‘çš„ MTU æ˜¯ 1500</p></li><li><p>FDDIï¼ˆå…‰çº¤åˆ†å¸ƒå¼æ•°æ®æ¥å£ï¼‰çš„ MTU æ˜¯ 4352</p></li><li><p>æœ¬åœ°å›ç¯åœ°å€çš„ MTU æ˜¯ 65535 - æœ¬åœ°æµ‹è¯•ä¸èµ°ç½‘å¡</p></li><li><p>MSS æ˜¯æœ€å¤§æ®µé•¿åº¦ï¼ˆmaximum segment sizeï¼‰ï¼Œå®ƒæ˜¯ MTU åˆ¨å» tcp å¤´å’Œ ip å¤´åå‰©ä½™èƒ½å¤Ÿä½œä¸ºæ•°æ®ä¼ è¾“çš„å­—èŠ‚æ•°</p></li><li><p>ipv4 tcp å¤´å ç”¨ 20 bytesï¼Œip å¤´å ç”¨ 20 bytesï¼Œå› æ­¤ä»¥å¤ªç½‘ MSS çš„å€¼ä¸º 1500 - 40 = 1460</p></li><li><p>TCP åœ¨ä¼ é€’å¤§é‡æ•°æ®æ—¶ï¼Œä¼šæŒ‰ç…§ MSS å¤§å°å°†æ•°æ®è¿›è¡Œåˆ†å‰²å‘é€</p></li><li><p>MSS çš„å€¼åœ¨ä¸‰æ¬¡æ¡æ‰‹æ—¶é€šçŸ¥å¯¹æ–¹è‡ªå·± MSS çš„å€¼ï¼Œç„¶ååœ¨ä¸¤è€…ä¹‹é—´é€‰æ‹©ä¸€ä¸ªå°å€¼ä½œä¸º MSS</p></li></ul><p><img src=/z-oblib/z2-attachments/0031.jpg width=auto></p></blockquote><a href=#14-è§£å†³æ–¹æ¡ˆ><h3 id=14-è§£å†³æ–¹æ¡ˆ><span class=hanchor arialabel=Anchor># </span>1.4 ğŸ’¡è§£å†³æ–¹æ¡ˆ</h3></a><ol><li>çŸ­é“¾æ¥ï¼Œå‘ä¸€ä¸ªåŒ…å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œè¿™æ ·è¿æ¥å»ºç«‹åˆ°è¿æ¥æ–­å¼€ä¹‹é—´å°±æ˜¯æ¶ˆæ¯çš„è¾¹ç•Œï¼Œç¼ºç‚¹æ•ˆç‡å¤ªä½</li><li>æ¯ä¸€æ¡æ¶ˆæ¯é‡‡ç”¨å›ºå®šé•¿åº¦ï¼Œç¼ºç‚¹æµªè´¹ç©ºé—´</li><li>æ¯ä¸€æ¡æ¶ˆæ¯é‡‡ç”¨åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ \nï¼Œç¼ºç‚¹éœ€è¦è½¬ä¹‰</li><li>æ¯ä¸€æ¡æ¶ˆæ¯åˆ†ä¸º head å’Œ bodyï¼Œhead ä¸­åŒ…å« body çš„é•¿åº¦</li></ol><a href=#æ–¹æ³•1çŸ­é“¾æ¥><h4 id=æ–¹æ³•1çŸ­é“¾æ¥><span class=hanchor arialabel=Anchor># </span>æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥</h4></a><p>ä»¥è§£å†³ç²˜åŒ…ä¸ºä¾‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-36>36</a>
</span><span class=lnt id=hl-6-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-37>37</a>
</span><span class=lnt id=hl-6-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-38>38</a>
</span><span class=lnt id=hl-6-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-39>39</a>
</span><span class=lnt id=hl-6-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-40>40</a>
</span><span class=lnt id=hl-6-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-41>41</a>
</span><span class=lnt id=hl-6-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-42>42</a>
</span><span class=lnt id=hl-6-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-43>43</a>
</span><span class=lnt id=hl-6-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-44>44</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloWorldClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>log</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>HelloWorldClient</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åˆ† 10 æ¬¡å‘é€
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>send</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>send</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Bootstrap</span> <span class=n>bootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>handler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;conneted...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(</span><span class=n>LogLevel</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInboundHandlerAdapter</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelActive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;sending...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=n>ByteBuf</span> <span class=n>buffer</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=n>buffer</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=k>new</span> <span class=kt>byte</span><span class=o>[]{</span><span class=n>0</span><span class=o>,</span> <span class=n>1</span><span class=o>,</span> <span class=n>2</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>4</span><span class=o>,</span> <span class=n>5</span><span class=o>,</span> <span class=n>6</span><span class=o>,</span> <span class=n>7</span><span class=o>,</span> <span class=n>8</span><span class=o>,</span> <span class=n>9</span><span class=o>,</span> <span class=n>10</span><span class=o>,</span> <span class=n>11</span><span class=o>,</span> <span class=n>12</span><span class=o>,</span> <span class=n>13</span><span class=o>,</span> <span class=n>14</span><span class=o>,</span> <span class=n>15</span><span class=o>});</span>
</span></span><span class=line><span class=cl>                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=c1>// å‘å®Œå³å…³
</span></span></span><span class=line><span class=cl><span class=c1></span>                            <span class=n>ctx</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>});</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=n>ChannelFuture</span> <span class=n>channelFuture</span> <span class=o>=</span> <span class=n>bootstrap</span><span class=o>.</span><span class=na>connect</span><span class=o>(</span><span class=s>&#34;localhost&#34;</span><span class=o>,</span> <span class=n>8080</span><span class=o>).</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;client error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¾“å‡ºï¼Œç•¥</p><a href=#ç¼ºç‚¹><h5 id=ç¼ºç‚¹><span class=hanchor arialabel=Anchor># </span>ç¼ºç‚¹</h5></a><p>åŠåŒ…ç”¨è¿™ç§åŠæ³•è¿˜æ˜¯ä¸å¥½è§£å†³ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„ç¼“å†²åŒºå¤§å°æ˜¯æœ‰é™çš„</p><a href=#æ–¹æ³•2å›ºå®šé•¿åº¦><h4 id=æ–¹æ³•2å›ºå®šé•¿åº¦><span class=hanchor arialabel=Anchor># </span>æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦</h4></a><p>è®©æ‰€æœ‰æ•°æ®åŒ…é•¿åº¦å›ºå®šï¼ˆå‡è®¾é•¿åº¦ä¸º 8 å­—èŠ‚ï¼‰ï¼ŒæœåŠ¡å™¨ç«¯åŠ å…¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>FixedLengthFrameDecoder</span><span class=o>(</span><span class=n>8</span><span class=o>));</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>frameï¼šå¸§ï¼Œç½‘ç»œä¸Šä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯</p></blockquote><p>å®¢æˆ·ç«¯æµ‹è¯•ä»£ç ï¼Œæ³¨æ„, é‡‡ç”¨è¿™ç§æ–¹æ³•åï¼Œå®¢æˆ·ç«¯ä»€ä¹ˆæ—¶å€™ flush éƒ½å¯ä»¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloWorldClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>log</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>HelloWorldClient</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Bootstrap</span> <span class=n>bootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>handler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;connetted...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(</span><span class=n>LogLevel</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInboundHandlerAdapter</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelActive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;sending...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=c1>// å‘é€å†…å®¹éšæœºçš„æ•°æ®åŒ…
</span></span></span><span class=line><span class=cl><span class=c1></span>                            <span class=n>Random</span> <span class=n>r</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=kt>char</span> <span class=n>c</span> <span class=o>=</span> <span class=sc>&#39;a&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                            <span class=n>ByteBuf</span> <span class=n>buffer</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=o>[</span><span class=n>8</span><span class=o>];</span>
</span></span><span class=line><span class=cl>                                <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>r</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=n>8</span><span class=o>);</span> <span class=n>j</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=n>bytes</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>byte</span><span class=o>)</span> <span class=n>c</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                                <span class=n>c</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>bytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=o>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>});</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=n>ChannelFuture</span> <span class=n>channelFuture</span> <span class=o>=</span> <span class=n>bootstrap</span><span class=o>.</span><span class=na>connect</span><span class=o>(</span><span class=s>&#34;192.168.0.103&#34;</span><span class=o>,</span> <span class=n>9090</span><span class=o>).</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;client error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å®¢æˆ·ç«¯è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2] REGISTERED
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2] CONNECT: /192.168.0.103:9090
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] ACTIVE
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] WRITE: 80B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 61 61 61 61 00 00 00 00 62 00 00 00 00 00 00 00 |aaaa....b.......|
</span></span><span class=line><span class=cl>|00000010| 63 63 00 00 00 00 00 00 64 00 00 00 00 00 00 00 |cc......d.......|
</span></span><span class=line><span class=cl>|00000020| 00 00 00 00 00 00 00 00 66 66 66 66 00 00 00 00 |........ffff....|
</span></span><span class=line><span class=cl>|00000030| 67 67 67 00 00 00 00 00 68 00 00 00 00 00 00 00 |ggg.....h.......|
</span></span><span class=line><span class=cl>|00000040| 69 69 69 69 69 00 00 00 6a 6a 6a 6a 00 00 00 00 |iiiii...jjjj....|
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] FLUSH
</span></span></code></pre></td></tr></table></div></div><p>æœåŠ¡ç«¯è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-27>27</a>
</span><span class=lnt id=hl-10-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-28>28</a>
</span><span class=lnt id=hl-10-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-29>29</a>
</span><span class=lnt id=hl-10-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-30>30</a>
</span><span class=lnt id=hl-10-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-31>31</a>
</span><span class=lnt id=hl-10-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-32>32</a>
</span><span class=lnt id=hl-10-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-33>33</a>
</span><span class=lnt id=hl-10-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-34>34</a>
</span><span class=lnt id=hl-10-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-35>35</a>
</span><span class=lnt id=hl-10-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-36>36</a>
</span><span class=lnt id=hl-10-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-37>37</a>
</span><span class=lnt id=hl-10-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-38>38</a>
</span><span class=lnt id=hl-10-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-39>39</a>
</span><span class=lnt id=hl-10-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-40>40</a>
</span><span class=lnt id=hl-10-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-41>41</a>
</span><span class=lnt id=hl-10-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-42>42</a>
</span><span class=lnt id=hl-10-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-43>43</a>
</span><span class=lnt id=hl-10-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-44>44</a>
</span><span class=lnt id=hl-10-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-45>45</a>
</span><span class=lnt id=hl-10-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-46>46</a>
</span><span class=lnt id=hl-10-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-47>47</a>
</span><span class=lnt id=hl-10-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-48>48</a>
</span><span class=lnt id=hl-10-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-49>49</a>
</span><span class=lnt id=hl-10-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-50>50</a>
</span><span class=lnt id=hl-10-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-51>51</a>
</span><span class=lnt id=hl-10-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-52>52</a>
</span><span class=lnt id=hl-10-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-53>53</a>
</span><span class=lnt id=hl-10-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-54>54</a>
</span><span class=lnt id=hl-10-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-55>55</a>
</span><span class=lnt id=hl-10-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-56>56</a>
</span><span class=lnt id=hl-10-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-57>57</a>
</span><span class=lnt id=hl-10-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-58>58</a>
</span><span class=lnt id=hl-10-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-59>59</a>
</span><span class=lnt id=hl-10-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-60>60</a>
</span><span class=lnt id=hl-10-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-61>61</a>
</span><span class=lnt id=hl-10-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-62>62</a>
</span><span class=lnt id=hl-10-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-63>63</a>
</span><span class=lnt id=hl-10-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-64>64</a>
</span><span class=lnt id=hl-10-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-65>65</a>
</span><span class=lnt id=hl-10-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-66>66</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>12:06:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xe3d9713f] binding...
</span></span><span class=line><span class=cl>12:06:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xe3d9713f, L:/192.168.0.103:9090] bound...
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] REGISTERED
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] ACTIVE
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155]
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 61 61 61 61 00 00 00 00                         |aaaa....        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 62 00 00 00 00 00 00 00                         |b.......        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 63 63 00 00 00 00 00 00                         |cc......        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 64 00 00 00 00 00 00 00                         |d.......        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 00 00 00 00 00 00 00 00                         |........        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 66 66 66 66 00 00 00 00                         |ffff....        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 67 67 67 00 00 00 00 00                         |ggg.....        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 68 00 00 00 00 00 00 00                         |h.......        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 69 69 69 69 69 00 00 00                         |iiiii...        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 6a 6a 6a 6a 00 00 00 00                         |jjjj....        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ COMPLETE
</span></span></code></pre></td></tr></table></div></div><a href=#ç¼ºç‚¹-1><h5 id=ç¼ºç‚¹-1><span class=hanchor arialabel=Anchor># </span>ç¼ºç‚¹</h5></a><p>æ•°æ®åŒ…çš„å¤§å°ä¸å¥½æŠŠæ¡</p><ul><li>é•¿åº¦å®šçš„å¤ªå¤§ï¼Œæµªè´¹</li><li>é•¿åº¦å®šçš„å¤ªå°ï¼Œå¯¹æŸäº›æ•°æ®åŒ…åˆæ˜¾å¾—ä¸å¤Ÿ</li></ul><a href=#æ–¹æ³•3å›ºå®šåˆ†éš”ç¬¦><h4 id=æ–¹æ³•3å›ºå®šåˆ†éš”ç¬¦><span class=hanchor arialabel=Anchor># </span>æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦</h4></a><p>æœåŠ¡ç«¯åŠ å…¥ï¼Œé»˜è®¤ä»¥ <code>\n</code> æˆ– <code>\r\n</code> ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¿…é¡»æŒ‡å®šæœ€å¤§é•¿åº¦ï¼Œå¦‚æœè¶…å‡ºæŒ‡å®šé•¿åº¦ä»æœªå‡ºç°åˆ†éš”ç¬¦ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LineBasedFrameDecoder</span><span class=o>(</span><span class=n>1024</span><span class=o>));</span>
</span></span></code></pre></td></tr></table></div></div><p>å®¢æˆ·ç«¯åœ¨æ¯æ¡æ¶ˆæ¯ä¹‹åï¼ŒåŠ å…¥ <code>\n</code> åˆ†éš”ç¬¦</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-31>31</a>
</span><span class=lnt id=hl-12-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-32>32</a>
</span><span class=lnt id=hl-12-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-33>33</a>
</span><span class=lnt id=hl-12-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-34>34</a>
</span><span class=lnt id=hl-12-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-35>35</a>
</span><span class=lnt id=hl-12-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-36>36</a>
</span><span class=lnt id=hl-12-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-37>37</a>
</span><span class=lnt id=hl-12-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-38>38</a>
</span><span class=lnt id=hl-12-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-39>39</a>
</span><span class=lnt id=hl-12-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-40>40</a>
</span><span class=lnt id=hl-12-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-41>41</a>
</span><span class=lnt id=hl-12-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-42>42</a>
</span><span class=lnt id=hl-12-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-43>43</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloWorldClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>log</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>HelloWorldClient</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Bootstrap</span> <span class=n>bootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>handler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;connetted...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(</span><span class=n>LogLevel</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInboundHandlerAdapter</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelActive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;sending...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=n>Random</span> <span class=n>r</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=kt>char</span> <span class=n>c</span> <span class=o>=</span> <span class=sc>&#39;a&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                            <span class=n>ByteBuf</span> <span class=n>buffer</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>r</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=n>16</span><span class=o>)+</span><span class=n>1</span><span class=o>;</span> <span class=n>j</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=n>buffer</span><span class=o>.</span><span class=na>writeByte</span><span class=o>((</span><span class=kt>byte</span><span class=o>)</span> <span class=n>c</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>10</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=n>c</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>                            <span class=o>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>});</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=n>ChannelFuture</span> <span class=n>channelFuture</span> <span class=o>=</span> <span class=n>bootstrap</span><span class=o>.</span><span class=na>connect</span><span class=o>(</span><span class=s>&#34;192.168.0.103&#34;</span><span class=o>,</span> <span class=n>9090</span><span class=o>).</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;client error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å®¢æˆ·ç«¯è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755] REGISTERED
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755] CONNECT: /192.168.0.103:9090
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] ACTIVE
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] WRITE: 60B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 61 0a 62 62 62 0a 63 63 63 0a 64 64 0a 65 65 65 |a.bbb.ccc.dd.eee|
</span></span><span class=line><span class=cl>|00000010| 65 65 65 65 65 65 65 0a 66 66 0a 67 67 67 67 67 |eeeeeee.ff.ggggg|
</span></span><span class=line><span class=cl>|00000020| 67 67 0a 68 68 68 68 0a 69 69 69 69 69 69 69 0a |gg.hhhh.iiiiiii.|
</span></span><span class=line><span class=cl>|00000030| 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 0a             |jjjjjjjjjjj.    |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] FLUSH
</span></span></code></pre></td></tr></table></div></div><p>æœåŠ¡ç«¯è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-29>29</a>
</span><span class=lnt id=hl-14-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-30>30</a>
</span><span class=lnt id=hl-14-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-31>31</a>
</span><span class=lnt id=hl-14-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-32>32</a>
</span><span class=lnt id=hl-14-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-33>33</a>
</span><span class=lnt id=hl-14-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-34>34</a>
</span><span class=lnt id=hl-14-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-35>35</a>
</span><span class=lnt id=hl-14-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-36>36</a>
</span><span class=lnt id=hl-14-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-37>37</a>
</span><span class=lnt id=hl-14-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-38>38</a>
</span><span class=lnt id=hl-14-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-39>39</a>
</span><span class=lnt id=hl-14-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-40>40</a>
</span><span class=lnt id=hl-14-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-41>41</a>
</span><span class=lnt id=hl-14-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-42>42</a>
</span><span class=lnt id=hl-14-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-43>43</a>
</span><span class=lnt id=hl-14-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-44>44</a>
</span><span class=lnt id=hl-14-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-45>45</a>
</span><span class=lnt id=hl-14-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-46>46</a>
</span><span class=lnt id=hl-14-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-47>47</a>
</span><span class=lnt id=hl-14-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-48>48</a>
</span><span class=lnt id=hl-14-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-49>49</a>
</span><span class=lnt id=hl-14-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-50>50</a>
</span><span class=lnt id=hl-14-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-51>51</a>
</span><span class=lnt id=hl-14-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-52>52</a>
</span><span class=lnt id=hl-14-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-53>53</a>
</span><span class=lnt id=hl-14-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-54>54</a>
</span><span class=lnt id=hl-14-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-55>55</a>
</span><span class=lnt id=hl-14-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-56>56</a>
</span><span class=lnt id=hl-14-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-57>57</a>
</span><span class=lnt id=hl-14-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-58>58</a>
</span><span class=lnt id=hl-14-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-59>59</a>
</span><span class=lnt id=hl-14-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-60>60</a>
</span><span class=lnt id=hl-14-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-61>61</a>
</span><span class=lnt id=hl-14-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-62>62</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] c.i.n.HelloWorldServer - connected [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641]
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 1B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 61                                              |a               |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 3B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 62 62 62                                        |bbb             |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 3B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 63 63 63                                        |ccc             |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 2B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 64 64                                           |dd              |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 10B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 65 65 65 65 65 65 65 65 65 65                   |eeeeeeeeee      |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 2B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 66 66                                           |ff              |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 7B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 67 67 67 67 67 67 67                            |ggggggg         |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 4B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 68 68 68 68                                     |hhhh            |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 7B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 69 69 69 69 69 69 69                            |iiiiiii         |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 11B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a                |jjjjjjjjjjj     |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ COMPLETE
</span></span></code></pre></td></tr></table></div></div><a href=#ç¼ºç‚¹-2><h5 id=ç¼ºç‚¹-2><span class=hanchor arialabel=Anchor># </span>ç¼ºç‚¹</h5></a><p>å¤„ç†å­—ç¬¦æ•°æ®æ¯”è¾ƒåˆé€‚ï¼Œä½†å¦‚æœå†…å®¹æœ¬èº«åŒ…å«äº†åˆ†éš”ç¬¦ï¼ˆå­—èŠ‚æ•°æ®å¸¸å¸¸ä¼šæœ‰æ­¤æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè§£æé”™è¯¯</p><a href=#æ–¹æ³•4çº¦å®šé•¿åº¦><h4 id=æ–¹æ³•4çº¦å®šé•¿åº¦><span class=hanchor arialabel=Anchor># </span>æ–¹æ³•4ï¼Œçº¦å®šé•¿åº¦</h4></a><blockquote><p>ç±»ä¼¼httpåè®®çš„Content-Lengthã€‚å®é™…ä¸Šæˆ‘ä»¬å°±æ˜¯è¦è®¾è®¡ä¸€ä¸ªç±»ä¼¼httpçš„åè®®ã€‚</p></blockquote><p>åœ¨å‘é€æ¶ˆæ¯å‰ï¼Œå…ˆçº¦å®šç”¨å®šé•¿å­—èŠ‚è¡¨ç¤ºæ¥ä¸‹æ¥æ•°æ®çš„é•¿åº¦</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// æœ€å¤§é•¿åº¦ï¼Œé•¿åº¦åç§»ï¼Œé•¿åº¦å ç”¨å­—èŠ‚ï¼Œé•¿åº¦è°ƒæ•´ï¼Œå‰¥ç¦»å­—èŠ‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LengthFieldBasedFrameDecoder</span><span class=o>(</span><span class=n>1024</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>1</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>1</span><span class=o>));</span>
</span></span></code></pre></td></tr></table></div></div><p>å®¢æˆ·ç«¯ä»£ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-35>35</a>
</span><span class=lnt id=hl-16-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-36>36</a>
</span><span class=lnt id=hl-16-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-37>37</a>
</span><span class=lnt id=hl-16-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-38>38</a>
</span><span class=lnt id=hl-16-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-39>39</a>
</span><span class=lnt id=hl-16-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-40>40</a>
</span><span class=lnt id=hl-16-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-41>41</a>
</span><span class=lnt id=hl-16-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-42>42</a>
</span><span class=lnt id=hl-16-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-43>43</a>
</span><span class=lnt id=hl-16-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-44>44</a>
</span><span class=lnt id=hl-16-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-45>45</a>
</span><span class=lnt id=hl-16-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloWorldClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>log</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>HelloWorldClient</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Bootstrap</span> <span class=n>bootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>handler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;connetted...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(</span><span class=n>LogLevel</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInboundHandlerAdapter</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelActive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;sending...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=n>Random</span> <span class=n>r</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=kt>char</span> <span class=n>c</span> <span class=o>=</span> <span class=sc>&#39;a&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                            <span class=n>ByteBuf</span> <span class=n>buffer</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=kt>byte</span> <span class=n>length</span> <span class=o>=</span> <span class=o>(</span><span class=kt>byte</span><span class=o>)</span> <span class=o>(</span><span class=n>r</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=n>16</span><span class=o>)</span> <span class=o>+</span> <span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=c1>// å…ˆå†™å…¥é•¿åº¦
</span></span></span><span class=line><span class=cl><span class=c1></span>                                <span class=n>buffer</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=c1>// å†
</span></span></span><span class=line><span class=cl><span class=c1></span>                                <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>length</span><span class=o>;</span> <span class=n>j</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=n>buffer</span><span class=o>.</span><span class=na>writeByte</span><span class=o>((</span><span class=kt>byte</span><span class=o>)</span> <span class=n>c</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                                <span class=n>c</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>                            <span class=o>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>});</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=n>ChannelFuture</span> <span class=n>channelFuture</span> <span class=o>=</span> <span class=n>bootstrap</span><span class=o>.</span><span class=na>connect</span><span class=o>(</span><span class=s>&#34;192.168.0.103&#34;</span><span class=o>,</span> <span class=n>9090</span><span class=o>).</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;client error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å®¢æˆ·ç«¯è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8] REGISTERED
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8] CONNECT: /192.168.0.103:9090
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] ACTIVE
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] WRITE: 97B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 09 61 61 61 61 61 61 61 61 61 09 62 62 62 62 62 |.aaaaaaaaa.bbbbb|
</span></span><span class=line><span class=cl>|00000010| 62 62 62 62 06 63 63 63 63 63 63 08 64 64 64 64 |bbbb.cccccc.dddd|
</span></span><span class=line><span class=cl>|00000020| 64 64 64 64 0f 65 65 65 65 65 65 65 65 65 65 65 |dddd.eeeeeeeeeee|
</span></span><span class=line><span class=cl>|00000030| 65 65 65 65 0d 66 66 66 66 66 66 66 66 66 66 66 |eeee.fffffffffff|
</span></span><span class=line><span class=cl>|00000040| 66 66 02 67 67 02 68 68 0e 69 69 69 69 69 69 69 |ff.gg.hh.iiiiiii|
</span></span><span class=line><span class=cl>|00000050| 69 69 69 69 69 69 69 09 6a 6a 6a 6a 6a 6a 6a 6a |iiiiiii.jjjjjjjj|
</span></span><span class=line><span class=cl>|00000060| 6a                                              |j               |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] FLUSH
</span></span></code></pre></td></tr></table></div></div><p>æœåŠ¡ç«¯è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-22>22</a>
</span><span class=lnt id=hl-18-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-23>23</a>
</span><span class=lnt id=hl-18-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-24>24</a>
</span><span class=lnt id=hl-18-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-25>25</a>
</span><span class=lnt id=hl-18-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-26>26</a>
</span><span class=lnt id=hl-18-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-27>27</a>
</span><span class=lnt id=hl-18-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-28>28</a>
</span><span class=lnt id=hl-18-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-29>29</a>
</span><span class=lnt id=hl-18-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-30>30</a>
</span><span class=lnt id=hl-18-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-31>31</a>
</span><span class=lnt id=hl-18-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-32>32</a>
</span><span class=lnt id=hl-18-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-33>33</a>
</span><span class=lnt id=hl-18-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-34>34</a>
</span><span class=lnt id=hl-18-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-35>35</a>
</span><span class=lnt id=hl-18-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-36>36</a>
</span><span class=lnt id=hl-18-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-37>37</a>
</span><span class=lnt id=hl-18-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-38>38</a>
</span><span class=lnt id=hl-18-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-39>39</a>
</span><span class=lnt id=hl-18-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-40>40</a>
</span><span class=lnt id=hl-18-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-41>41</a>
</span><span class=lnt id=hl-18-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-42>42</a>
</span><span class=lnt id=hl-18-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-43>43</a>
</span><span class=lnt id=hl-18-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-44>44</a>
</span><span class=lnt id=hl-18-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-45>45</a>
</span><span class=lnt id=hl-18-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-46>46</a>
</span><span class=lnt id=hl-18-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-47>47</a>
</span><span class=lnt id=hl-18-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-48>48</a>
</span><span class=lnt id=hl-18-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-49>49</a>
</span><span class=lnt id=hl-18-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-50>50</a>
</span><span class=lnt id=hl-18-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-51>51</a>
</span><span class=lnt id=hl-18-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-52>52</a>
</span><span class=lnt id=hl-18-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-53>53</a>
</span><span class=lnt id=hl-18-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-54>54</a>
</span><span class=lnt id=hl-18-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-55>55</a>
</span><span class=lnt id=hl-18-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-56>56</a>
</span><span class=lnt id=hl-18-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-57>57</a>
</span><span class=lnt id=hl-18-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-58>58</a>
</span><span class=lnt id=hl-18-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-59>59</a>
</span><span class=lnt id=hl-18-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-60>60</a>
</span><span class=lnt id=hl-18-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-61>61</a>
</span><span class=lnt id=hl-18-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-62>62</a>
</span><span class=lnt id=hl-18-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-63>63</a>
</span><span class=lnt id=hl-18-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-64>64</a>
</span><span class=lnt id=hl-18-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-65>65</a>
</span><span class=lnt id=hl-18-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-66>66</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>14:36:50 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xdff439d3] binding...
</span></span><span class=line><span class=cl>14:36:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xdff439d3, L:/192.168.0.103:9090] bound...
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] REGISTERED
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] ACTIVE
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979]
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 61 61 61 61 61 61 61 61 61                      |aaaaaaaaa       |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 62 62 62 62 62 62 62 62 62                      |bbbbbbbbb       |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 6B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 63 63 63 63 63 63                               |cccccc          |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 8B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 64 64 64 64 64 64 64 64                         |dddddddd        |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 15B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 65 65 65 65 65 65 65 65 65 65 65 65 65 65 65    |eeeeeeeeeeeeeee |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 13B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 66 66 66 66 66 66 66 66 66 66 66 66 66          |fffffffffffff   |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 2B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 67 67                                           |gg              |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 2B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 68 68                                           |hh              |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 14B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 69 69 69 69 69 69 69 69 69 69 69 69 69 69       |iiiiiiiiiiiiii  |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B
</span></span><span class=line><span class=cl>         +-------------------------------------------------+
</span></span><span class=line><span class=cl>         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>|00000000| 6a 6a 6a 6a 6a 6a 6a 6a 6a                      |jjjjjjjjj       |
</span></span><span class=line><span class=cl>+--------+-------------------------------------------------+----------------+
</span></span><span class=line><span class=cl>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ COMPLETE
</span></span></code></pre></td></tr></table></div></div><a href=#2-åè®®è®¾è®¡ä¸è§£æ><h2 id=2-åè®®è®¾è®¡ä¸è§£æ><span class=hanchor arialabel=Anchor># </span>2. åè®®è®¾è®¡ä¸è§£æ</h2></a><a href=#21-ä¸ºä»€ä¹ˆéœ€è¦åè®®><h3 id=21-ä¸ºä»€ä¹ˆéœ€è¦åè®®><span class=hanchor arialabel=Anchor># </span>2.1 ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ</h3></a><blockquote><p>TCP/IP ä¸­æ¶ˆæ¯ä¼ è¾“åŸºäº<strong>æµ</strong>çš„æ–¹å¼ï¼Œ<strong>æ²¡æœ‰è¾¹ç•Œ</strong>ã€‚</p></blockquote><p>åè®®çš„ç›®çš„å°±æ˜¯åˆ’å®šæ¶ˆæ¯çš„è¾¹ç•Œï¼Œåˆ¶å®šé€šä¿¡åŒæ–¹è¦å…±åŒéµå®ˆçš„é€šä¿¡è§„åˆ™</p><p>ä¾‹å¦‚ï¼šåœ¨ç½‘ç»œä¸Šä¼ è¾“</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ä¸‹é›¨å¤©ç•™å®¢å¤©ç•™æˆ‘ä¸ç•™
</span></span></code></pre></td></tr></table></div></div><p>æ˜¯ä¸­æ–‡ä¸€å¥è‘—åçš„æ— æ ‡ç‚¹ç¬¦å·å¥å­ï¼Œåœ¨æ²¡æœ‰æ ‡ç‚¹ç¬¦å·æƒ…å†µä¸‹ï¼Œè¿™å¥è¯æœ‰æ•°ç§æ‹†è§£æ–¹å¼ï¼Œè€Œæ„æ€å´æ˜¯å®Œå…¨ä¸åŒï¼Œæ‰€ä»¥å¸¸è¢«ç”¨ä½œè®²è¿°æ ‡ç‚¹ç¬¦å·çš„é‡è¦æ€§</p><p>ä¸€ç§è§£è¯»</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ä¸‹é›¨å¤©ç•™å®¢ï¼Œå¤©ç•™ï¼Œæˆ‘ä¸ç•™
</span></span></code></pre></td></tr></table></div></div><p>å¦ä¸€ç§è§£è¯»</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ä¸‹é›¨å¤©ï¼Œç•™å®¢å¤©ï¼Œç•™æˆ‘ä¸ï¼Ÿç•™
</span></span></code></pre></td></tr></table></div></div><p>å¦‚ä½•è®¾è®¡åè®®å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç»™ç½‘ç»œä¼ è¾“çš„ä¿¡æ¯åŠ ä¸Šâ€œæ ‡ç‚¹ç¬¦å·â€ã€‚ä½†é€šè¿‡åˆ†éš”ç¬¦æ¥æ–­å¥ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºåˆ†éš”ç¬¦æœ¬èº«å¦‚æœç”¨äºä¼ è¾“ï¼Œé‚£ä¹ˆå¿…é¡»åŠ ä»¥åŒºåˆ†ã€‚å› æ­¤ï¼Œä¸‹é¢ä¸€ç§åè®®è¾ƒä¸ºå¸¸ç”¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>å®šé•¿å­—èŠ‚è¡¨ç¤ºå†…å®¹é•¿åº¦ + å®é™…å†…å®¹
</span></span></code></pre></td></tr></table></div></div><p>ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªä¸­æ–‡å­—ç¬¦é•¿åº¦ä¸º 3ï¼ŒæŒ‰ç…§ä¸Šè¿°åè®®çš„è§„åˆ™ï¼Œå‘é€ä¿¡æ¯æ–¹å¼å¦‚ä¸‹ï¼Œå°±ä¸ä¼šè¢«æ¥æ”¶æ–¹å¼„é”™æ„æ€äº†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0fä¸‹é›¨å¤©ç•™å®¢06å¤©ç•™09æˆ‘ä¸ç•™
</span></span></code></pre></td></tr></table></div></div><blockquote><p>å°æ•…äº‹</p><p>å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œä¸€ä½ç§å¡¾å…ˆç”Ÿåˆ°ä¸€å®¶ä»»æ•™ã€‚åŒæ–¹ç­¾è®¢äº†ä¸€çº¸åè®®ï¼šâ€œæ— é¸¡é¸­äº¦å¯æ— é±¼è‚‰äº¦å¯ç™½èœè±†è…ä¸å¯å°‘ä¸å¾—æŸä¿®é‡‘â€ã€‚æ­¤åï¼Œç§å¡¾å…ˆç”Ÿè™½ç„¶è®¤çœŸæ•™è¯¾ï¼Œä½†ä¸»äººå®¶åˆ™æ€»æ˜¯ç»™ç§å¡¾å…ˆç”Ÿä»¥ç™½èœè±†è…ä¸ºèœï¼Œä¸æ¯«æœªè§é¸¡é¸­é±¼è‚‰çš„æ¬¾å¾…ã€‚ç§å¡¾å…ˆç”Ÿå…ˆæ˜¯å¾ˆä¸è§£ï¼Œå¯æ˜¯åæ¥ä¹Ÿå°±æƒ³é€šäº†ï¼šä¸»äººæŠŠé¸¡é¸­é±¼è‚‰çš„é’±éƒ½ä¼šæ¢ä¸ºæŸä¿®é‡‘çš„ï¼Œä¹Ÿç½¢ã€‚è‡³æ­¤åŒæ–¹ç›¸å®‰æ— äº‹ã€‚</p><p>å¹´å…³å°†è‡³ï¼Œä¸€ä¸ªå­¦å¹´æ®µäº¦å‘Šç»“æŸã€‚ç§å¡¾å…ˆç”Ÿä¸´è¡Œæ—¶ï¼Œä¹Ÿä¸è§ä¸»äººå®¶ä¸ºä»–äº¤ä»˜æŸä¿®é‡‘ï¼Œé‚ä¸ä¸»å®¶ç†è®ºã€‚ç„¶ä¸»å®¶äº¦æŒ¯æŒ¯æœ‰è¯ï¼šâ€œæœ‰åè®®ä¸ºè¯â€”â€”æ— é¸¡é¸­äº¦å¯ï¼Œæ— é±¼è‚‰äº¦å¯ï¼Œç™½èœè±†è…ä¸å¯å°‘ï¼Œä¸å¾—æŸä¿®é‡‘ã€‚è¿™ç™½çº¸é»‘å­—æ˜æ‘†ç€çš„ï¼Œä½ æœ‰ä»€ä¹ˆè¦è¯´çš„å‘¢ï¼Ÿâ€</p><p>ç§å¡¾å…ˆç”Ÿæ®ç†åŠ›äº‰ï¼šâ€œåè®®æ˜¯è¿™æ ·çš„â€”â€”æ— é¸¡ï¼Œé¸­äº¦å¯ï¼›æ— é±¼ï¼Œè‚‰äº¦å¯ï¼›ç™½èœè±†è…ä¸å¯ï¼Œå°‘ä¸å¾—æŸä¿®é‡‘ã€‚â€</p><p>åŒæ–¹å”‡æªèˆŒæˆ˜ï¼Œä½ æ¥æˆ‘å¾€ï¼ŒçœŸä¸ªæ˜¯ä¸äº¦ä¹ä¹ï¼</p><p>è¿™é‡Œçš„æŸä¿®é‡‘ï¼Œä¹Ÿä½œâ€œæŸè„©â€ï¼Œåº”å½“æ˜¯æ³›æŒ‡æ•™å¸ˆåº”å½“å¾—åˆ°çš„æŠ¥é…¬</p></blockquote><a href=#22-redis-åè®®ä¸¾ä¾‹><h3 id=22-redis-åè®®ä¸¾ä¾‹><span class=hanchor arialabel=Anchor># </span>2.2 redis åè®®ä¸¾ä¾‹</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-44>44</a>
</span><span class=lnt id=hl-24-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-45>45</a>
</span><span class=lnt id=hl-24-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-46>46</a>
</span><span class=lnt id=hl-24-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-47>47</a>
</span><span class=lnt id=hl-24-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-48>48</a>
</span><span class=lnt id=hl-24-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-49>49</a>
</span><span class=lnt id=hl-24-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-50>50</a>
</span><span class=lnt id=hl-24-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-51>51</a>
</span><span class=lnt id=hl-24-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-52>52</a>
</span><span class=lnt id=hl-24-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-53>53</a>
</span><span class=lnt id=hl-24-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-54>54</a>
</span><span class=lnt id=hl-24-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-55>55</a>
</span><span class=lnt id=hl-24-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-56>56</a>
</span><span class=lnt id=hl-24-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-57>57</a>
</span><span class=lnt id=hl-24-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-58>58</a>
</span><span class=lnt id=hl-24-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-59>59</a>
</span><span class=lnt id=hl-24-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-60>60</a>
</span><span class=lnt id=hl-24-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-61>61</a>
</span><span class=lnt id=hl-24-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-62>62</a>
</span><span class=lnt id=hl-24-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-63>63</a>
</span><span class=lnt id=hl-24-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-64>64</a>
</span><span class=lnt id=hl-24-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-65>65</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=kt>byte</span><span class=o>[]</span> <span class=n>LINE</span> <span class=o>=</span> <span class=o>{</span><span class=n>13</span><span class=o>,</span> <span class=n>10</span><span class=o>};</span>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Bootstrap</span> <span class=n>bootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap</span><span class=o>.</span><span class=na>handler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInboundHandlerAdapter</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// ä¼šåœ¨è¿æ¥ channel å»ºç«‹æˆåŠŸåï¼Œä¼šè§¦å‘ active äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelActive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>set</span><span class=o>(</span><span class=n>ctx</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>get</span><span class=o>(</span><span class=n>ctx</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=kd>private</span> <span class=kt>void</span> <span class=nf>get</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>ByteBuf</span> <span class=n>buf</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;*2&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;$3&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;get&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;$3&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;aaa&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>buf</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=kd>private</span> <span class=kt>void</span> <span class=nf>set</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>ByteBuf</span> <span class=n>buf</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;*3&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;$3&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;set&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;$3&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;aaa&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;$3&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=s>&#34;bbb&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>buf</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>LINE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>buf</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelRead</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>Object</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>ByteBuf</span> <span class=n>buf</span> <span class=o>=</span> <span class=o>(</span><span class=n>ByteBuf</span><span class=o>)</span> <span class=n>msg</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>buf</span><span class=o>.</span><span class=na>toString</span><span class=o>(</span><span class=n>Charset</span><span class=o>.</span><span class=na>defaultCharset</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=n>ChannelFuture</span> <span class=n>channelFuture</span> <span class=o>=</span> <span class=n>bootstrap</span><span class=o>.</span><span class=na>connect</span><span class=o>(</span><span class=s>&#34;localhost&#34;</span><span class=o>,</span> <span class=n>6379</span><span class=o>).</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;client error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#23-http-åè®®ä¸¾ä¾‹><h3 id=23-http-åè®®ä¸¾ä¾‹><span class=hanchor arialabel=Anchor># </span>2.3 http åè®®ä¸¾ä¾‹</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-40>40</a>
</span><span class=lnt id=hl-25-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-41>41</a>
</span><span class=lnt id=hl-25-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-42>42</a>
</span><span class=lnt id=hl-25-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-43>43</a>
</span><span class=lnt id=hl-25-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-44>44</a>
</span><span class=lnt id=hl-25-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-45>45</a>
</span><span class=lnt id=hl-25-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-46>46</a>
</span><span class=lnt id=hl-25-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-47>47</a>
</span><span class=lnt id=hl-25-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-48>48</a>
</span><span class=lnt id=hl-25-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-49>49</a>
</span><span class=lnt id=hl-25-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-50>50</a>
</span><span class=lnt id=hl-25-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-51>51</a>
</span><span class=lnt id=hl-25-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>NioEventLoopGroup</span> <span class=n>boss</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ServerBootstrap</span> <span class=n>serverBootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServerBootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioServerSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>boss</span><span class=o>,</span> <span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>childHandler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(</span><span class=n>LogLevel</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>HttpServerCodec</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>HttpRequest</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>HttpRequest</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// è·å–è¯·æ±‚
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>uri</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1>// è¿”å›å“åº”
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=n>DefaultFullHttpResponse</span> <span class=n>response</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                            <span class=k>new</span> <span class=n>DefaultFullHttpResponse</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>protocolVersion</span><span class=o>(),</span> <span class=n>HttpResponseStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=s>&#34;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>response</span><span class=o>.</span><span class=na>headers</span><span class=o>().</span><span class=na>setInt</span><span class=o>(</span><span class=n>CONTENT_LENGTH</span><span class=o>,</span> <span class=n>bytes</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>response</span><span class=o>.</span><span class=na>content</span><span class=o>().</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>bytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1>// å†™å›å“åº”
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>response</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=cm>/*ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {
</span></span></span><span class=line><span class=cl><span class=cm>                @Override
</span></span></span><span class=line><span class=cl><span class=cm>                public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {
</span></span></span><span class=line><span class=cl><span class=cm>                    log.debug(&#34;{}&#34;, msg.getClass());
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>                    if (msg instanceof HttpRequest) { // è¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>                    } else if (msg instanceof HttpContent) { //è¯·æ±‚ä½“
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>                    }
</span></span></span><span class=line><span class=cl><span class=cm>                }
</span></span></span><span class=line><span class=cl><span class=cm>            });*/</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=n>ChannelFuture</span> <span class=n>channelFuture</span> <span class=o>=</span> <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>bind</span><span class=o>(</span><span class=n>8080</span><span class=o>).</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>channelFuture</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;server error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>boss</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#24-è‡ªå®šä¹‰åè®®è¦ç´ ><h3 id=24-è‡ªå®šä¹‰åè®®è¦ç´ ><span class=hanchor arialabel=Anchor># </span>2.4 è‡ªå®šä¹‰åè®®è¦ç´ </h3></a><ul><li>é­”æ•°ï¼Œç”¨æ¥åœ¨ç¬¬ä¸€æ—¶é—´åˆ¤å®šæ˜¯å¦æ˜¯æ— æ•ˆæ•°æ®åŒ…</li><li>ç‰ˆæœ¬å·ï¼Œå¯ä»¥æ”¯æŒåè®®çš„å‡çº§</li><li>åºåˆ—åŒ–ç®—æ³•ï¼Œæ¶ˆæ¯æ­£æ–‡åˆ°åº•é‡‡ç”¨å“ªç§åºåˆ—åŒ–ååºåˆ—åŒ–æ–¹å¼ï¼Œå¯ä»¥ç”±æ­¤æ‰©å±•ï¼Œä¾‹å¦‚ï¼šjsonã€protobufã€hessianã€jdkï¼ˆæ€§èƒ½å·®ã€éè·¨å¹³å°ï¼‰</li><li>æŒ‡ä»¤ç±»å‹ï¼Œæ˜¯ç™»å½•ã€æ³¨å†Œã€å•èŠã€ç¾¤èŠ&mldr; è·Ÿä¸šåŠ¡ç›¸å…³</li><li>è¯·æ±‚åºå·ï¼Œä¸ºäº†åŒå·¥é€šä¿¡ï¼Œ</li><li>æ­£æ–‡é•¿åº¦</li><li>æ¶ˆæ¯æ­£æ–‡</li></ul><a href=#ç¼–è§£ç å™¨><h4 id=ç¼–è§£ç å™¨><span class=hanchor arialabel=Anchor># </span>ç¼–è§£ç å™¨</h4></a><p>æ ¹æ®ä¸Šé¢çš„è¦ç´ ï¼Œè®¾è®¡ä¸€ä¸ªç™»å½•è¯·æ±‚æ¶ˆæ¯å’Œç™»å½•å“åº”æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ Netty å®Œæˆæ”¶å‘</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-23>23</a>
</span><span class=lnt id=hl-26-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-24>24</a>
</span><span class=lnt id=hl-26-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-25>25</a>
</span><span class=lnt id=hl-26-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-26>26</a>
</span><span class=lnt id=hl-26-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-27>27</a>
</span><span class=lnt id=hl-26-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-28>28</a>
</span><span class=lnt id=hl-26-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-29>29</a>
</span><span class=lnt id=hl-26-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-30>30</a>
</span><span class=lnt id=hl-26-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-31>31</a>
</span><span class=lnt id=hl-26-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-32>32</a>
</span><span class=lnt id=hl-26-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-33>33</a>
</span><span class=lnt id=hl-26-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-34>34</a>
</span><span class=lnt id=hl-26-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-35>35</a>
</span><span class=lnt id=hl-26-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-36>36</a>
</span><span class=lnt id=hl-26-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-37>37</a>
</span><span class=lnt id=hl-26-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-38>38</a>
</span><span class=lnt id=hl-26-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-39>39</a>
</span><span class=lnt id=hl-26-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-40>40</a>
</span><span class=lnt id=hl-26-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-41>41</a>
</span><span class=lnt id=hl-26-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-42>42</a>
</span><span class=lnt id=hl-26-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-43>43</a>
</span><span class=lnt id=hl-26-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-44>44</a>
</span><span class=lnt id=hl-26-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-45>45</a>
</span><span class=lnt id=hl-26-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MessageCodec</span> <span class=kd>extends</span> <span class=n>ByteToMessageCodec</span><span class=o>&lt;</span><span class=n>Message</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>encode</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>Message</span> <span class=n>msg</span><span class=o>,</span> <span class=n>ByteBuf</span> <span class=n>out</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 1. 4 å­—èŠ‚çš„é­”æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=k>new</span> <span class=kt>byte</span><span class=o>[]{</span><span class=n>1</span><span class=o>,</span> <span class=n>2</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>4</span><span class=o>});</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getMessageType</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 5. 4 ä¸ªå­—èŠ‚
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeInt</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getSequenceId</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>0xff</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ByteArrayOutputStream</span> <span class=n>bos</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteArrayOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>ObjectOutputStream</span> <span class=n>oos</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span><span class=n>bos</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>oos</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>msg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>bos</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 7. é•¿åº¦
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeInt</span><span class=o>(</span><span class=n>bytes</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 8. å†™å…¥å†…å®¹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>bytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>decode</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>ByteBuf</span> <span class=n>in</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>out</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>magicNum</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readInt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span> <span class=n>version</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readByte</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span> <span class=n>serializerType</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readByte</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span> <span class=n>messageType</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readByte</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>sequenceId</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readInt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>in</span><span class=o>.</span><span class=na>readByte</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>length</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readInt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=o>[</span><span class=n>length</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>in</span><span class=o>.</span><span class=na>readBytes</span><span class=o>(</span><span class=n>bytes</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ObjectInputStream</span> <span class=n>ois</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span><span class=n>bytes</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>Message</span> <span class=n>message</span> <span class=o>=</span> <span class=o>(</span><span class=n>Message</span><span class=o>)</span> <span class=n>ois</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;{}, {}, {}, {}, {}, {}&#34;</span><span class=o>,</span> <span class=n>magicNum</span><span class=o>,</span> <span class=n>version</span><span class=o>,</span> <span class=n>serializerType</span><span class=o>,</span> <span class=n>messageType</span><span class=o>,</span> <span class=n>sequenceId</span><span class=o>,</span> <span class=n>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;{}&#34;</span><span class=o>,</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>EmbeddedChannel</span> <span class=n>channel</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EmbeddedChannel</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>LengthFieldBasedFrameDecoder</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>1024</span><span class=o>,</span> <span class=n>12</span><span class=o>,</span> <span class=n>4</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>0</span><span class=o>),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>MessageCodec</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>// encode
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LoginRequestMessage</span> <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LoginRequestMessage</span><span class=o>(</span><span class=s>&#34;zhangsan&#34;</span><span class=o>,</span> <span class=s>&#34;123&#34;</span><span class=o>,</span> <span class=s>&#34;å¼ ä¸‰&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//        channel.writeOutbound(message);
</span></span></span><span class=line><span class=cl><span class=c1>// decode
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ByteBuf</span> <span class=n>buf</span> <span class=o>=</span> <span class=n>ByteBufAllocator</span><span class=o>.</span><span class=na>DEFAULT</span><span class=o>.</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>new</span> <span class=n>MessageCodec</span><span class=o>().</span><span class=na>encode</span><span class=o>(</span><span class=kc>null</span><span class=o>,</span> <span class=n>message</span><span class=o>,</span> <span class=n>buf</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ByteBuf</span> <span class=n>s1</span> <span class=o>=</span> <span class=n>buf</span><span class=o>.</span><span class=na>slice</span><span class=o>(</span><span class=n>0</span><span class=o>,</span> <span class=n>100</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>ByteBuf</span> <span class=n>s2</span> <span class=o>=</span> <span class=n>buf</span><span class=o>.</span><span class=na>slice</span><span class=o>(</span><span class=n>100</span><span class=o>,</span> <span class=n>buf</span><span class=o>.</span><span class=na>readableBytes</span><span class=o>()</span> <span class=o>-</span> <span class=n>100</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>s1</span><span class=o>.</span><span class=na>retain</span><span class=o>();</span> <span class=c1>// å¼•ç”¨è®¡æ•° 2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>channel</span><span class=o>.</span><span class=na>writeInbound</span><span class=o>(</span><span class=n>s1</span><span class=o>);</span> <span class=c1>// release 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>channel</span><span class=o>.</span><span class=na>writeInbound</span><span class=o>(</span><span class=n>s2</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>è§£è¯»</p><p><img src=/z-oblib/z2-attachments/0013.png width=auto></p><a href=#æ³¨æ„åŠåŒ…><h5 id=æ³¨æ„åŠåŒ…><span class=hanchor arialabel=Anchor># </span>æ³¨æ„åŠåŒ…</h5></a><p>è™½ç„¶åè®®æŒ‡å®šäº†æ•°æ®é•¿åº¦ï¼Œå¯ä»¥è§£å†³ç²˜åŒ…é—®é¢˜ï¼Œä½†æ˜¯åŠåŒ…é—®é¢˜è¿˜è¦æ³¨æ„ï¼š
å¦‚æœåŠåŒ…äº†ï¼Œé‚£ä¹ˆhandlerå°±ä¸åº”è¯¥ç»§ç»­å¾€ä¸‹å¤„ç†ï¼Œå› ä¸ºæ­¤æ—¶ååºåˆ—åŒ–ä¼šå¤±è´¥ï¼ˆå®é™…é•¿åº¦å°äºæŒ‡å®šé•¿åº¦ï¼Œè¶Šç•Œè¯»ï¼‰ã€‚
éœ€è¦å…ˆç”¨å¸§è§£ç å™¨åŒ…è£…åŒ…çš„å®Œæ•´æ€§ã€‚</p><a href=#-ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ -sharable><h4 id=-ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ -sharable><span class=hanchor arialabel=Anchor># </span>ğŸ’¡ ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ  @Sharable</h4></a><ul><li>å½“ handler <strong>ä¸ä¿å­˜çŠ¶æ€</strong>ï¼ˆæˆå‘˜å˜é‡ï¼‰æ—¶ï¼Œå°±å¯ä»¥å®‰å…¨åœ°åœ¨å¤šçº¿ç¨‹ä¸‹è¢«å…±äº«ï¼ˆä¾‹å¦‚LoggingHandlerå¯ä»¥å…±äº«ï¼ŒLengthFieldBasedFrameDecoderä¸èƒ½å…±äº«ï¼‰ã€‚</li><li>ä½†è¦æ³¨æ„å¯¹äºç¼–è§£ç å™¨ç±»ï¼Œä¸èƒ½ç»§æ‰¿ ByteToMessageCodec æˆ– CombinedChannelDuplexHandler çˆ¶ç±»ï¼Œä»–ä»¬çš„æ„é€ æ–¹æ³•å¯¹ @Sharable æœ‰é™åˆ¶<ul><li>nettyè®¤ä¸ºä½ å¦‚æœç»§æ‰¿äº†è¿™ä¸¤ä¸ªçˆ¶ç±»ï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥æ˜¯ä¼šä¿å­˜çŠ¶æ€çš„ï¼ˆä¸ç®¡ä½ å®é™…ä¸Šæ˜¯å¦è¿™ä¹ˆåšäº†ï¼‰</li></ul></li><li>å¦‚æœèƒ½ç¡®ä¿ç¼–è§£ç å™¨<strong>ä¸ä¼š</strong>ä¿å­˜çŠ¶æ€ï¼Œå¯ä»¥ç»§æ‰¿ MessageToMessageCodec çˆ¶ç±»</li></ul><blockquote><p>Byteä»£è¡¨rawçš„æ•°æ®ï¼Œå¯èƒ½ä¸å®Œæ•´ï¼ŒMessageä»£è¡¨æ˜¯ä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯äº†ã€‚</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-25>25</a>
</span><span class=lnt id=hl-28-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-26>26</a>
</span><span class=lnt id=hl-28-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-27>27</a>
</span><span class=lnt id=hl-28-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-28>28</a>
</span><span class=lnt id=hl-28-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-29>29</a>
</span><span class=lnt id=hl-28-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-30>30</a>
</span><span class=lnt id=hl-28-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-31>31</a>
</span><span class=lnt id=hl-28-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-32>32</a>
</span><span class=lnt id=hl-28-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-33>33</a>
</span><span class=lnt id=hl-28-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-34>34</a>
</span><span class=lnt id=hl-28-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-35>35</a>
</span><span class=lnt id=hl-28-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-36>36</a>
</span><span class=lnt id=hl-28-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-37>37</a>
</span><span class=lnt id=hl-28-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-38>38</a>
</span><span class=lnt id=hl-28-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-39>39</a>
</span><span class=lnt id=hl-28-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-40>40</a>
</span><span class=lnt id=hl-28-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-41>41</a>
</span><span class=lnt id=hl-28-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-42>42</a>
</span><span class=lnt id=hl-28-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-43>43</a>
</span><span class=lnt id=hl-28-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-44>44</a>
</span><span class=lnt id=hl-28-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-45>45</a>
</span><span class=lnt id=hl-28-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-46>46</a>
</span><span class=lnt id=hl-28-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-47>47</a>
</span><span class=lnt id=hl-28-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-48>48</a>
</span><span class=lnt id=hl-28-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-49>49</a>
</span><span class=lnt id=hl-28-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-50>50</a>
</span><span class=lnt id=hl-28-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-51>51</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@ChannelHandler.Sharable</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * å¿…é¡»å’Œ LengthFieldBasedFrameDecoder ä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿æ¥åˆ°çš„ ByteBuf æ¶ˆæ¯æ˜¯å®Œæ•´çš„
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MessageCodecSharable</span> <span class=kd>extends</span> <span class=n>MessageToMessageCodec</span><span class=o>&lt;</span><span class=n>ByteBuf</span><span class=o>,</span> <span class=n>Message</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>encode</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>Message</span> <span class=n>msg</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>outList</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ByteBuf</span> <span class=n>out</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>alloc</span><span class=o>().</span><span class=na>buffer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 1. 4 å­—èŠ‚çš„é­”æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=k>new</span> <span class=kt>byte</span><span class=o>[]{</span><span class=n>1</span><span class=o>,</span> <span class=n>2</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>4</span><span class=o>});</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getMessageType</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 5. 4 ä¸ªå­—èŠ‚
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeInt</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getSequenceId</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeByte</span><span class=o>(</span><span class=n>0xff</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ByteArrayOutputStream</span> <span class=n>bos</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteArrayOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>ObjectOutputStream</span> <span class=n>oos</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span><span class=n>bos</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>oos</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>msg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>bos</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 7. é•¿åº¦
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeInt</span><span class=o>(</span><span class=n>bytes</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 8. å†™å…¥å†…å®¹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>out</span><span class=o>.</span><span class=na>writeBytes</span><span class=o>(</span><span class=n>bytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>outList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>out</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>decode</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>ByteBuf</span> <span class=n>in</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>out</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>magicNum</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readInt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span> <span class=n>version</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readByte</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span> <span class=n>serializerType</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readByte</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span> <span class=n>messageType</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readByte</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>sequenceId</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readInt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>in</span><span class=o>.</span><span class=na>readByte</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>length</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readInt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=o>[</span><span class=n>length</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>in</span><span class=o>.</span><span class=na>readBytes</span><span class=o>(</span><span class=n>bytes</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ObjectInputStream</span> <span class=n>ois</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span><span class=n>bytes</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>Message</span> <span class=n>message</span> <span class=o>=</span> <span class=o>(</span><span class=n>Message</span><span class=o>)</span> <span class=n>ois</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;{}, {}, {}, {}, {}, {}&#34;</span><span class=o>,</span> <span class=n>magicNum</span><span class=o>,</span> <span class=n>version</span><span class=o>,</span> <span class=n>serializerType</span><span class=o>,</span> <span class=n>messageType</span><span class=o>,</span> <span class=n>sequenceId</span><span class=o>,</span> <span class=n>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;{}&#34;</span><span class=o>,</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#3-èŠå¤©å®¤æ¡ˆä¾‹><h2 id=3-èŠå¤©å®¤æ¡ˆä¾‹><span class=hanchor arialabel=Anchor># </span>3. èŠå¤©å®¤æ¡ˆä¾‹</h2></a><a href=#31-èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»><h3 id=31-èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»><span class=hanchor arialabel=Anchor># </span>3.1 èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * ç”¨æˆ·ç®¡ç†æ¥å£
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>UserService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * ç™»å½•
</span></span></span><span class=line><span class=cl><span class=cm>     * @param username ç”¨æˆ·å
</span></span></span><span class=line><span class=cl><span class=cm>     * @param password å¯†ç 
</span></span></span><span class=line><span class=cl><span class=cm>     * @return ç™»å½•æˆåŠŸè¿”å› true, å¦åˆ™è¿”å› false
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=nf>login</span><span class=o>(</span><span class=n>String</span> <span class=n>username</span><span class=o>,</span> <span class=n>String</span> <span class=n>password</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-15>15</a>
</span><span class=lnt id=hl-30-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-16>16</a>
</span><span class=lnt id=hl-30-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-17>17</a>
</span><span class=lnt id=hl-30-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-18>18</a>
</span><span class=lnt id=hl-30-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-19>19</a>
</span><span class=lnt id=hl-30-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-20>20</a>
</span><span class=lnt id=hl-30-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-21>21</a>
</span><span class=lnt id=hl-30-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-22>22</a>
</span><span class=lnt id=hl-30-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-23>23</a>
</span><span class=lnt id=hl-30-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-24>24</a>
</span><span class=lnt id=hl-30-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-25>25</a>
</span><span class=lnt id=hl-30-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-26>26</a>
</span><span class=lnt id=hl-30-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-27>27</a>
</span><span class=lnt id=hl-30-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-28>28</a>
</span><span class=lnt id=hl-30-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-29>29</a>
</span><span class=lnt id=hl-30-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-30>30</a>
</span><span class=lnt id=hl-30-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-31>31</a>
</span><span class=lnt id=hl-30-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-32>32</a>
</span><span class=lnt id=hl-30-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-33>33</a>
</span><span class=lnt id=hl-30-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-34>34</a>
</span><span class=lnt id=hl-30-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-35>35</a>
</span><span class=lnt id=hl-30-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-36>36</a>
</span><span class=lnt id=hl-30-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-37>37</a>
</span><span class=lnt id=hl-30-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-38>38</a>
</span><span class=lnt id=hl-30-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-39>39</a>
</span><span class=lnt id=hl-30-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-40>40</a>
</span><span class=lnt id=hl-30-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-41>41</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * ä¼šè¯ç®¡ç†æ¥å£
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Session</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * ç»‘å®šä¼šè¯
</span></span></span><span class=line><span class=cl><span class=cm>     * @param channel å“ªä¸ª channel è¦ç»‘å®šä¼šè¯
</span></span></span><span class=line><span class=cl><span class=cm>     * @param username ä¼šè¯ç»‘å®šç”¨æˆ·
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>bind</span><span class=o>(</span><span class=n>Channel</span> <span class=n>channel</span><span class=o>,</span> <span class=n>String</span> <span class=n>username</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * è§£ç»‘ä¼šè¯
</span></span></span><span class=line><span class=cl><span class=cm>     * @param channel å“ªä¸ª channel è¦è§£ç»‘ä¼šè¯
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>unbind</span><span class=o>(</span><span class=n>Channel</span> <span class=n>channel</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * è·å–å±æ€§
</span></span></span><span class=line><span class=cl><span class=cm>     * @param channel å“ªä¸ª channel
</span></span></span><span class=line><span class=cl><span class=cm>     * @param name å±æ€§å
</span></span></span><span class=line><span class=cl><span class=cm>     * @return å±æ€§å€¼
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>Object</span> <span class=nf>getAttribute</span><span class=o>(</span><span class=n>Channel</span> <span class=n>channel</span><span class=o>,</span> <span class=n>String</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * è®¾ç½®å±æ€§
</span></span></span><span class=line><span class=cl><span class=cm>     * @param channel å“ªä¸ª channel
</span></span></span><span class=line><span class=cl><span class=cm>     * @param name å±æ€§å
</span></span></span><span class=line><span class=cl><span class=cm>     * @param value å±æ€§å€¼
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>setAttribute</span><span class=o>(</span><span class=n>Channel</span> <span class=n>channel</span><span class=o>,</span> <span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Object</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æ ¹æ®ç”¨æˆ·åè·å– channel
</span></span></span><span class=line><span class=cl><span class=cm>     * @param username ç”¨æˆ·å
</span></span></span><span class=line><span class=cl><span class=cm>     * @return channel
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>Channel</span> <span class=nf>getChannel</span><span class=o>(</span><span class=n>String</span> <span class=n>username</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-14>14</a>
</span><span class=lnt id=hl-31-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-15>15</a>
</span><span class=lnt id=hl-31-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-16>16</a>
</span><span class=lnt id=hl-31-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-17>17</a>
</span><span class=lnt id=hl-31-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-18>18</a>
</span><span class=lnt id=hl-31-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-19>19</a>
</span><span class=lnt id=hl-31-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-20>20</a>
</span><span class=lnt id=hl-31-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-21>21</a>
</span><span class=lnt id=hl-31-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-22>22</a>
</span><span class=lnt id=hl-31-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-23>23</a>
</span><span class=lnt id=hl-31-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-24>24</a>
</span><span class=lnt id=hl-31-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-25>25</a>
</span><span class=lnt id=hl-31-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-26>26</a>
</span><span class=lnt id=hl-31-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-27>27</a>
</span><span class=lnt id=hl-31-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-28>28</a>
</span><span class=lnt id=hl-31-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-29>29</a>
</span><span class=lnt id=hl-31-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-30>30</a>
</span><span class=lnt id=hl-31-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-31>31</a>
</span><span class=lnt id=hl-31-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-32>32</a>
</span><span class=lnt id=hl-31-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-33>33</a>
</span><span class=lnt id=hl-31-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-34>34</a>
</span><span class=lnt id=hl-31-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-35>35</a>
</span><span class=lnt id=hl-31-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-36>36</a>
</span><span class=lnt id=hl-31-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-37>37</a>
</span><span class=lnt id=hl-31-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-38>38</a>
</span><span class=lnt id=hl-31-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-39>39</a>
</span><span class=lnt id=hl-31-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-40>40</a>
</span><span class=lnt id=hl-31-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-41>41</a>
</span><span class=lnt id=hl-31-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-42>42</a>
</span><span class=lnt id=hl-31-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-43>43</a>
</span><span class=lnt id=hl-31-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-44>44</a>
</span><span class=lnt id=hl-31-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-45>45</a>
</span><span class=lnt id=hl-31-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-46>46</a>
</span><span class=lnt id=hl-31-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-47>47</a>
</span><span class=lnt id=hl-31-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-48>48</a>
</span><span class=lnt id=hl-31-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-49>49</a>
</span><span class=lnt id=hl-31-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-50>50</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * èŠå¤©ç»„ä¼šè¯ç®¡ç†æ¥å£
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>GroupSession</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * åˆ›å»ºä¸€ä¸ªèŠå¤©ç»„, å¦‚æœä¸å­˜åœ¨æ‰èƒ½åˆ›å»ºæˆåŠŸ, å¦åˆ™è¿”å› null
</span></span></span><span class=line><span class=cl><span class=cm>     * @param name ç»„å
</span></span></span><span class=line><span class=cl><span class=cm>     * @param members æˆå‘˜
</span></span></span><span class=line><span class=cl><span class=cm>     * @return æˆåŠŸæ—¶è¿”å›ç»„å¯¹è±¡, å¤±è´¥è¿”å› null
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>Group</span> <span class=nf>createGroup</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>members</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * åŠ å…¥èŠå¤©ç»„
</span></span></span><span class=line><span class=cl><span class=cm>     * @param name ç»„å
</span></span></span><span class=line><span class=cl><span class=cm>     * @param member æˆå‘˜å
</span></span></span><span class=line><span class=cl><span class=cm>     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>Group</span> <span class=nf>joinMember</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>String</span> <span class=n>member</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * ç§»é™¤ç»„æˆå‘˜
</span></span></span><span class=line><span class=cl><span class=cm>     * @param name ç»„å
</span></span></span><span class=line><span class=cl><span class=cm>     * @param member æˆå‘˜å
</span></span></span><span class=line><span class=cl><span class=cm>     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>Group</span> <span class=nf>removeMember</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>String</span> <span class=n>member</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * ç§»é™¤èŠå¤©ç»„
</span></span></span><span class=line><span class=cl><span class=cm>     * @param name ç»„å
</span></span></span><span class=line><span class=cl><span class=cm>     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>Group</span> <span class=nf>removeGroup</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * è·å–ç»„æˆå‘˜
</span></span></span><span class=line><span class=cl><span class=cm>     * @param name ç»„å
</span></span></span><span class=line><span class=cl><span class=cm>     * @return æˆå‘˜é›†åˆ, æ²¡æœ‰æˆå‘˜ä¼šè¿”å› empty set
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>getMembers</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * è·å–ç»„æˆå‘˜çš„ channel é›†åˆ, åªæœ‰åœ¨çº¿çš„ channel æ‰ä¼šè¿”å›
</span></span></span><span class=line><span class=cl><span class=cm>     * @param name ç»„å
</span></span></span><span class=line><span class=cl><span class=cm>     * @return æˆå‘˜ channel é›†åˆ
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Channel</span><span class=o>&gt;</span> <span class=nf>getMembersChannel</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#32-èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•><h3 id=32-èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•><span class=hanchor arialabel=Anchor># </span>3.2 èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-15>15</a>
</span><span class=lnt id=hl-32-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-16>16</a>
</span><span class=lnt id=hl-32-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-17>17</a>
</span><span class=lnt id=hl-32-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-18>18</a>
</span><span class=lnt id=hl-32-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-19>19</a>
</span><span class=lnt id=hl-32-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-20>20</a>
</span><span class=lnt id=hl-32-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-21>21</a>
</span><span class=lnt id=hl-32-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-22>22</a>
</span><span class=lnt id=hl-32-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-23>23</a>
</span><span class=lnt id=hl-32-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-24>24</a>
</span><span class=lnt id=hl-32-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-25>25</a>
</span><span class=lnt id=hl-32-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-26>26</a>
</span><span class=lnt id=hl-32-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-27>27</a>
</span><span class=lnt id=hl-32-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-28>28</a>
</span><span class=lnt id=hl-32-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-29>29</a>
</span><span class=lnt id=hl-32-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-30>30</a>
</span><span class=lnt id=hl-32-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-31>31</a>
</span><span class=lnt id=hl-32-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-32>32</a>
</span><span class=lnt id=hl-32-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-33>33</a>
</span><span class=lnt id=hl-32-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-34>34</a>
</span><span class=lnt id=hl-32-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-35>35</a>
</span><span class=lnt id=hl-32-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-36>36</a>
</span><span class=lnt id=hl-32-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-37>37</a>
</span><span class=lnt id=hl-32-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-38>38</a>
</span><span class=lnt id=hl-32-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-39>39</a>
</span><span class=lnt id=hl-32-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-40>40</a>
</span><span class=lnt id=hl-32-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-41>41</a>
</span><span class=lnt id=hl-32-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-42>42</a>
</span><span class=lnt id=hl-32-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-43>43</a>
</span><span class=lnt id=hl-32-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-44>44</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ChatServer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>boss</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>worker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>LoggingHandler</span> <span class=n>LOGGING_HANDLER</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(</span><span class=n>LogLevel</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>MessageCodecSharable</span> <span class=n>MESSAGE_CODEC</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MessageCodecSharable</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ServerBootstrap</span> <span class=n>serverBootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServerBootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioServerSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>boss</span><span class=o>,</span> <span class=n>worker</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>childHandler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ProcotolFrameDecoder</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=n>LOGGING_HANDLER</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=n>MESSAGE_CODEC</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>LoginRequestMessage</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>LoginRequestMessage</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>String</span> <span class=n>username</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=na>getUsername</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=n>String</span> <span class=n>password</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=na>getPassword</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=kt>boolean</span> <span class=n>login</span> <span class=o>=</span> <span class=n>UserServiceFactory</span><span class=o>.</span><span class=na>getUserService</span><span class=o>().</span><span class=na>login</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>password</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=n>LoginResponseMessage</span> <span class=n>message</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                            <span class=k>if</span><span class=o>(</span><span class=n>login</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LoginResponseMessage</span><span class=o>(</span><span class=kc>true</span><span class=o>,</span> <span class=s>&#34;ç™»å½•æˆåŠŸ&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LoginResponseMessage</span><span class=o>(</span><span class=kc>false</span><span class=o>,</span> <span class=s>&#34;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=o>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>});</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=n>Channel</span> <span class=n>channel</span> <span class=o>=</span> <span class=n>serverBootstrap</span><span class=o>.</span><span class=na>bind</span><span class=o>(</span><span class=n>8080</span><span class=o>).</span><span class=na>sync</span><span class=o>().</span><span class=na>channel</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>channel</span><span class=o>.</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;server error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>boss</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-1>  1</a>
</span><span class=lnt id=hl-33-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-2>  2</a>
</span><span class=lnt id=hl-33-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-3>  3</a>
</span><span class=lnt id=hl-33-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-4>  4</a>
</span><span class=lnt id=hl-33-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-5>  5</a>
</span><span class=lnt id=hl-33-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-6>  6</a>
</span><span class=lnt id=hl-33-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-7>  7</a>
</span><span class=lnt id=hl-33-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-8>  8</a>
</span><span class=lnt id=hl-33-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-9>  9</a>
</span><span class=lnt id=hl-33-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-10> 10</a>
</span><span class=lnt id=hl-33-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-11> 11</a>
</span><span class=lnt id=hl-33-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-12> 12</a>
</span><span class=lnt id=hl-33-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-13> 13</a>
</span><span class=lnt id=hl-33-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-14> 14</a>
</span><span class=lnt id=hl-33-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-15> 15</a>
</span><span class=lnt id=hl-33-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-16> 16</a>
</span><span class=lnt id=hl-33-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-17> 17</a>
</span><span class=lnt id=hl-33-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-18> 18</a>
</span><span class=lnt id=hl-33-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-19> 19</a>
</span><span class=lnt id=hl-33-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-20> 20</a>
</span><span class=lnt id=hl-33-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-21> 21</a>
</span><span class=lnt id=hl-33-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-22> 22</a>
</span><span class=lnt id=hl-33-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-23> 23</a>
</span><span class=lnt id=hl-33-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-24> 24</a>
</span><span class=lnt id=hl-33-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-25> 25</a>
</span><span class=lnt id=hl-33-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-26> 26</a>
</span><span class=lnt id=hl-33-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-27> 27</a>
</span><span class=lnt id=hl-33-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-28> 28</a>
</span><span class=lnt id=hl-33-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-29> 29</a>
</span><span class=lnt id=hl-33-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-30> 30</a>
</span><span class=lnt id=hl-33-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-31> 31</a>
</span><span class=lnt id=hl-33-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-32> 32</a>
</span><span class=lnt id=hl-33-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-33> 33</a>
</span><span class=lnt id=hl-33-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-34> 34</a>
</span><span class=lnt id=hl-33-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-35> 35</a>
</span><span class=lnt id=hl-33-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-36> 36</a>
</span><span class=lnt id=hl-33-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-37> 37</a>
</span><span class=lnt id=hl-33-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-38> 38</a>
</span><span class=lnt id=hl-33-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-39> 39</a>
</span><span class=lnt id=hl-33-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-40> 40</a>
</span><span class=lnt id=hl-33-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-41> 41</a>
</span><span class=lnt id=hl-33-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-42> 42</a>
</span><span class=lnt id=hl-33-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-43> 43</a>
</span><span class=lnt id=hl-33-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-44> 44</a>
</span><span class=lnt id=hl-33-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-45> 45</a>
</span><span class=lnt id=hl-33-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-46> 46</a>
</span><span class=lnt id=hl-33-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-47> 47</a>
</span><span class=lnt id=hl-33-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-48> 48</a>
</span><span class=lnt id=hl-33-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-49> 49</a>
</span><span class=lnt id=hl-33-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-50> 50</a>
</span><span class=lnt id=hl-33-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-51> 51</a>
</span><span class=lnt id=hl-33-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-52> 52</a>
</span><span class=lnt id=hl-33-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-53> 53</a>
</span><span class=lnt id=hl-33-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-54> 54</a>
</span><span class=lnt id=hl-33-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-55> 55</a>
</span><span class=lnt id=hl-33-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-56> 56</a>
</span><span class=lnt id=hl-33-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-57> 57</a>
</span><span class=lnt id=hl-33-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-58> 58</a>
</span><span class=lnt id=hl-33-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-59> 59</a>
</span><span class=lnt id=hl-33-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-60> 60</a>
</span><span class=lnt id=hl-33-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-61> 61</a>
</span><span class=lnt id=hl-33-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-62> 62</a>
</span><span class=lnt id=hl-33-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-63> 63</a>
</span><span class=lnt id=hl-33-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-64> 64</a>
</span><span class=lnt id=hl-33-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-65> 65</a>
</span><span class=lnt id=hl-33-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-66> 66</a>
</span><span class=lnt id=hl-33-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-67> 67</a>
</span><span class=lnt id=hl-33-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-68> 68</a>
</span><span class=lnt id=hl-33-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-69> 69</a>
</span><span class=lnt id=hl-33-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-70> 70</a>
</span><span class=lnt id=hl-33-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-71> 71</a>
</span><span class=lnt id=hl-33-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-72> 72</a>
</span><span class=lnt id=hl-33-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-73> 73</a>
</span><span class=lnt id=hl-33-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-74> 74</a>
</span><span class=lnt id=hl-33-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-75> 75</a>
</span><span class=lnt id=hl-33-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-76> 76</a>
</span><span class=lnt id=hl-33-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-77> 77</a>
</span><span class=lnt id=hl-33-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-78> 78</a>
</span><span class=lnt id=hl-33-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-79> 79</a>
</span><span class=lnt id=hl-33-80><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-80> 80</a>
</span><span class=lnt id=hl-33-81><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-81> 81</a>
</span><span class=lnt id=hl-33-82><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-82> 82</a>
</span><span class=lnt id=hl-33-83><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-83> 83</a>
</span><span class=lnt id=hl-33-84><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-84> 84</a>
</span><span class=lnt id=hl-33-85><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-85> 85</a>
</span><span class=lnt id=hl-33-86><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-86> 86</a>
</span><span class=lnt id=hl-33-87><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-87> 87</a>
</span><span class=lnt id=hl-33-88><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-88> 88</a>
</span><span class=lnt id=hl-33-89><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-89> 89</a>
</span><span class=lnt id=hl-33-90><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-90> 90</a>
</span><span class=lnt id=hl-33-91><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-91> 91</a>
</span><span class=lnt id=hl-33-92><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-92> 92</a>
</span><span class=lnt id=hl-33-93><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-93> 93</a>
</span><span class=lnt id=hl-33-94><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-94> 94</a>
</span><span class=lnt id=hl-33-95><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-95> 95</a>
</span><span class=lnt id=hl-33-96><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-96> 96</a>
</span><span class=lnt id=hl-33-97><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-97> 97</a>
</span><span class=lnt id=hl-33-98><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-98> 98</a>
</span><span class=lnt id=hl-33-99><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-99> 99</a>
</span><span class=lnt id=hl-33-100><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-100>100</a>
</span><span class=lnt id=hl-33-101><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-101>101</a>
</span><span class=lnt id=hl-33-102><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-102>102</a>
</span><span class=lnt id=hl-33-103><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-103>103</a>
</span><span class=lnt id=hl-33-104><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-104>104</a>
</span><span class=lnt id=hl-33-105><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-105>105</a>
</span><span class=lnt id=hl-33-106><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-106>106</a>
</span><span class=lnt id=hl-33-107><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-107>107</a>
</span><span class=lnt id=hl-33-108><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-108>108</a>
</span><span class=lnt id=hl-33-109><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-109>109</a>
</span><span class=lnt id=hl-33-110><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-110>110</a>
</span><span class=lnt id=hl-33-111><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-111>111</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ChatClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NioEventLoopGroup</span> <span class=n>group</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioEventLoopGroup</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>LoggingHandler</span> <span class=n>LOGGING_HANDLER</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LoggingHandler</span><span class=o>(</span><span class=n>LogLevel</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>MessageCodecSharable</span> <span class=n>MESSAGE_CODEC</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MessageCodecSharable</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>CountDownLatch</span> <span class=n>WAIT_FOR_LOGIN</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CountDownLatch</span><span class=o>(</span><span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>AtomicBoolean</span> <span class=n>LOGIN</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AtomicBoolean</span><span class=o>(</span><span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Bootstrap</span> <span class=n>bootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bootstrap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>channel</span><span class=o>(</span><span class=n>NioSocketChannel</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>group</span><span class=o>(</span><span class=n>group</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap</span><span class=o>.</span><span class=na>handler</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelInitializer</span><span class=o>&lt;</span><span class=n>SocketChannel</span><span class=o>&gt;()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>initChannel</span><span class=o>(</span><span class=n>SocketChannel</span> <span class=n>ch</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ProcotolFrameDecoder</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=c1>//                    ch.pipeline().addLast(LOGGING_HANDLER);
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=n>MESSAGE_CODEC</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=s>&#34;client handler&#34;</span><span class=o>,</span> <span class=k>new</span> <span class=n>ChannelInboundHandlerAdapter</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=c1>// æ¥æ”¶å“åº”æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelRead</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>Object</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;msg: {}&#34;</span><span class=o>,</span> <span class=n>msg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=k>if</span> <span class=o>((</span><span class=n>msg</span> <span class=k>instanceof</span> <span class=n>LoginResponseMessage</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=n>LoginResponseMessage</span> <span class=n>response</span> <span class=o>=</span> <span class=o>(</span><span class=n>LoginResponseMessage</span><span class=o>)</span> <span class=n>msg</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                <span class=k>if</span> <span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>isSuccess</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=c1>// å¦‚æœç™»å½•æˆåŠŸ
</span></span></span><span class=line><span class=cl><span class=c1></span>                                    <span class=n>LOGIN</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                                <span class=c1>// å”¤é†’ system in çº¿ç¨‹
</span></span></span><span class=line><span class=cl><span class=c1></span>                                <span class=n>WAIT_FOR_LOGIN</span><span class=o>.</span><span class=na>countDown</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                            <span class=o>}</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=c1>// åœ¨è¿æ¥å»ºç«‹åè§¦å‘ active äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>                        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>channelActive</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=c1>// è´Ÿè´£æ¥æ”¶ç”¨æˆ·åœ¨æ§åˆ¶å°çš„è¾“å…¥ï¼Œè´Ÿè´£å‘æœåŠ¡å™¨å‘é€å„ç§æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=c1></span>                            <span class=k>new</span> <span class=n>Thread</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=n>Scanner</span> <span class=n>scanner</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Scanner</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;è¯·è¾“å…¥ç”¨æˆ·å:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=n>String</span> <span class=n>username</span> <span class=o>=</span> <span class=n>scanner</span><span class=o>.</span><span class=na>nextLine</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;è¯·è¾“å…¥å¯†ç :&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=n>String</span> <span class=n>password</span> <span class=o>=</span> <span class=n>scanner</span><span class=o>.</span><span class=na>nextLine</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                                <span class=c1>// æ„é€ æ¶ˆæ¯å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>                                <span class=n>LoginRequestMessage</span> <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LoginRequestMessage</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>password</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=c1>// å‘é€æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=c1></span>                                <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;ç­‰å¾…åç»­æ“ä½œ...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=n>WAIT_FOR_LOGIN</span><span class=o>.</span><span class=na>await</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                                <span class=c1>// å¦‚æœç™»å½•å¤±è´¥
</span></span></span><span class=line><span class=cl><span class=c1></span>                                <span class=k>if</span> <span class=o>(!</span><span class=n>LOGIN</span><span class=o>.</span><span class=na>get</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=n>ctx</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                                    <span class=k>return</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                                <span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;==================================&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;send [username] [content]&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;gsend [group name] [content]&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;gcreate [group name] [m1,m2,m3...]&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;gmembers [group name]&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;gjoin [group name]&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;gquit [group name]&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;quit&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;==================================&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=n>String</span> <span class=n>command</span> <span class=o>=</span> <span class=n>scanner</span><span class=o>.</span><span class=na>nextLine</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                                    <span class=n>String</span><span class=o>[]</span> <span class=n>s</span> <span class=o>=</span> <span class=n>command</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34; &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                    <span class=k>switch</span> <span class=o>(</span><span class=n>s</span><span class=o>[</span><span class=n>0</span><span class=o>]){</span>
</span></span><span class=line><span class=cl>                                        <span class=k>case</span> <span class=s>&#34;send&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>ChatRequestMessage</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>s</span><span class=o>[</span><span class=n>1</span><span class=o>],</span> <span class=n>s</span><span class=o>[</span><span class=n>2</span><span class=o>]));</span>
</span></span><span class=line><span class=cl>                                            <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                        <span class=k>case</span> <span class=s>&#34;gsend&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupChatRequestMessage</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>s</span><span class=o>[</span><span class=n>1</span><span class=o>],</span> <span class=n>s</span><span class=o>[</span><span class=n>2</span><span class=o>]));</span>
</span></span><span class=line><span class=cl>                                            <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                        <span class=k>case</span> <span class=s>&#34;gcreate&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                            <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>set</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;(</span><span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=n>s</span><span class=o>[</span><span class=n>2</span><span class=o>].</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;,&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>                                            <span class=n>set</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>username</span><span class=o>);</span> <span class=c1>// åŠ å…¥è‡ªå·±
</span></span></span><span class=line><span class=cl><span class=c1></span>                                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupCreateRequestMessage</span><span class=o>(</span><span class=n>s</span><span class=o>[</span><span class=n>1</span><span class=o>],</span> <span class=n>set</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                                            <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                        <span class=k>case</span> <span class=s>&#34;gmembers&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupMembersRequestMessage</span><span class=o>(</span><span class=n>s</span><span class=o>[</span><span class=n>1</span><span class=o>]));</span>
</span></span><span class=line><span class=cl>                                            <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                        <span class=k>case</span> <span class=s>&#34;gjoin&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupJoinRequestMessage</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>s</span><span class=o>[</span><span class=n>1</span><span class=o>]));</span>
</span></span><span class=line><span class=cl>                                            <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                        <span class=k>case</span> <span class=s>&#34;gquit&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupQuitRequestMessage</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>s</span><span class=o>[</span><span class=n>1</span><span class=o>]));</span>
</span></span><span class=line><span class=cl>                                            <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                        <span class=k>case</span> <span class=s>&#34;quit&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                                            <span class=n>ctx</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                                            <span class=k>return</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                                    <span class=o>}</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                            <span class=o>},</span> <span class=s>&#34;system in&#34;</span><span class=o>).</span><span class=na>start</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>});</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>});</span>
</span></span><span class=line><span class=cl>            <span class=n>Channel</span> <span class=n>channel</span> <span class=o>=</span> <span class=n>bootstrap</span><span class=o>.</span><span class=na>connect</span><span class=o>(</span><span class=s>&#34;localhost&#34;</span><span class=o>,</span> <span class=n>8080</span><span class=o>).</span><span class=na>sync</span><span class=o>().</span><span class=na>channel</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>channel</span><span class=o>.</span><span class=na>closeFuture</span><span class=o>().</span><span class=na>sync</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;client error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>group</span><span class=o>.</span><span class=na>shutdownGracefully</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#33-èŠå¤©å®¤ä¸šåŠ¡-å•èŠ><h3 id=33-èŠå¤©å®¤ä¸šåŠ¡-å•èŠ><span class=hanchor arialabel=Anchor># </span>3.3 èŠå¤©å®¤ä¸šåŠ¡-å•èŠ</h3></a><p>æœåŠ¡å™¨ç«¯å°† handler ç‹¬ç«‹å‡ºæ¥</p><p>ç™»å½• handler</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ChannelHandler.Sharable</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LoginRequestMessageHandler</span> <span class=kd>extends</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>LoginRequestMessage</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>LoginRequestMessage</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>username</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=na>getUsername</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>password</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=na>getPassword</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>boolean</span> <span class=n>login</span> <span class=o>=</span> <span class=n>UserServiceFactory</span><span class=o>.</span><span class=na>getUserService</span><span class=o>().</span><span class=na>login</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>password</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>LoginResponseMessage</span> <span class=n>message</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>login</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>SessionFactory</span><span class=o>.</span><span class=na>getSession</span><span class=o>().</span><span class=na>bind</span><span class=o>(</span><span class=n>ctx</span><span class=o>.</span><span class=na>channel</span><span class=o>(),</span> <span class=n>username</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LoginResponseMessage</span><span class=o>(</span><span class=kc>true</span><span class=o>,</span> <span class=s>&#34;ç™»å½•æˆåŠŸ&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LoginResponseMessage</span><span class=o>(</span><span class=kc>false</span><span class=o>,</span> <span class=s>&#34;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å•èŠ handler</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ChannelHandler.Sharable</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ChatRequestMessageHandler</span> <span class=kd>extends</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>ChatRequestMessage</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>ChatRequestMessage</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>to</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=na>getTo</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Channel</span> <span class=n>channel</span> <span class=o>=</span> <span class=n>SessionFactory</span><span class=o>.</span><span class=na>getSession</span><span class=o>().</span><span class=na>getChannel</span><span class=o>(</span><span class=n>to</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åœ¨çº¿
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span><span class=o>(</span><span class=n>channel</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>channel</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>ChatResponseMessage</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getFrom</span><span class=o>(),</span> <span class=n>msg</span><span class=o>.</span><span class=na>getContent</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ä¸åœ¨çº¿
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>ChatResponseMessage</span><span class=o>(</span><span class=kc>false</span><span class=o>,</span> <span class=s>&#34;å¯¹æ–¹ç”¨æˆ·ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨çº¿&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#34-èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ><h3 id=34-èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ><span class=hanchor arialabel=Anchor># </span>3.4 èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ</h3></a><p>åˆ›å»ºç¾¤èŠ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-21>21</a>
</span><span class=lnt id=hl-36-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ChannelHandler.Sharable</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GroupCreateRequestMessageHandler</span> <span class=kd>extends</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>GroupCreateRequestMessage</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>GroupCreateRequestMessage</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>groupName</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>members</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=na>getMembers</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ç¾¤ç®¡ç†å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>GroupSession</span> <span class=n>groupSession</span> <span class=o>=</span> <span class=n>GroupSessionFactory</span><span class=o>.</span><span class=na>getGroupSession</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Group</span> <span class=n>group</span> <span class=o>=</span> <span class=n>groupSession</span><span class=o>.</span><span class=na>createGroup</span><span class=o>(</span><span class=n>groupName</span><span class=o>,</span> <span class=n>members</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>group</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å‘ç”ŸæˆåŠŸæ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupCreateResponseMessage</span><span class=o>(</span><span class=kc>true</span><span class=o>,</span> <span class=n>groupName</span> <span class=o>+</span> <span class=s>&#34;åˆ›å»ºæˆåŠŸ&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å‘é€æ‹‰ç¾¤æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>List</span><span class=o>&lt;</span><span class=n>Channel</span><span class=o>&gt;</span> <span class=n>channels</span> <span class=o>=</span> <span class=n>groupSession</span><span class=o>.</span><span class=na>getMembersChannel</span><span class=o>(</span><span class=n>groupName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=n>Channel</span> <span class=n>channel</span> <span class=o>:</span> <span class=n>channels</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>channel</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupCreateResponseMessage</span><span class=o>(</span><span class=kc>true</span><span class=o>,</span> <span class=s>&#34;æ‚¨å·²è¢«æ‹‰å…¥&#34;</span> <span class=o>+</span> <span class=n>groupName</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupCreateResponseMessage</span><span class=o>(</span><span class=kc>false</span><span class=o>,</span> <span class=n>groupName</span> <span class=o>+</span> <span class=s>&#34;å·²ç»å­˜åœ¨&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç¾¤èŠ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ChannelHandler.Sharable</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GroupChatRequestMessageHandler</span> <span class=kd>extends</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>GroupChatRequestMessage</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>GroupChatRequestMessage</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>List</span><span class=o>&lt;</span><span class=n>Channel</span><span class=o>&gt;</span> <span class=n>channels</span> <span class=o>=</span> <span class=n>GroupSessionFactory</span><span class=o>.</span><span class=na>getGroupSession</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getMembersChannel</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>Channel</span> <span class=n>channel</span> <span class=o>:</span> <span class=n>channels</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>channel</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupChatResponseMessage</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getFrom</span><span class=o>(),</span> <span class=n>msg</span><span class=o>.</span><span class=na>getContent</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>åŠ å…¥ç¾¤èŠ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ChannelHandler.Sharable</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GroupJoinRequestMessageHandler</span> <span class=kd>extends</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>GroupJoinRequestMessage</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>GroupJoinRequestMessage</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Group</span> <span class=n>group</span> <span class=o>=</span> <span class=n>GroupSessionFactory</span><span class=o>.</span><span class=na>getGroupSession</span><span class=o>().</span><span class=na>joinMember</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>(),</span> <span class=n>msg</span><span class=o>.</span><span class=na>getUsername</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>group</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupJoinResponseMessage</span><span class=o>(</span><span class=kc>true</span><span class=o>,</span> <span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;ç¾¤åŠ å…¥æˆåŠŸ&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupJoinResponseMessage</span><span class=o>(</span><span class=kc>true</span><span class=o>,</span> <span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;ç¾¤ä¸å­˜åœ¨&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>é€€å‡ºç¾¤èŠ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ChannelHandler.Sharable</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GroupQuitRequestMessageHandler</span> <span class=kd>extends</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>GroupQuitRequestMessage</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>GroupQuitRequestMessage</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Group</span> <span class=n>group</span> <span class=o>=</span> <span class=n>GroupSessionFactory</span><span class=o>.</span><span class=na>getGroupSession</span><span class=o>().</span><span class=na>removeMember</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>(),</span> <span class=n>msg</span><span class=o>.</span><span class=na>getUsername</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>group</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupJoinResponseMessage</span><span class=o>(</span><span class=kc>true</span><span class=o>,</span> <span class=s>&#34;å·²é€€å‡ºç¾¤&#34;</span> <span class=o>+</span> <span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupJoinResponseMessage</span><span class=o>(</span><span class=kc>true</span><span class=o>,</span> <span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;ç¾¤ä¸å­˜åœ¨&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹æˆå‘˜</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-1>1</a>
</span><span class=lnt id=hl-40-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-2>2</a>
</span><span class=lnt id=hl-40-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-3>3</a>
</span><span class=lnt id=hl-40-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-4>4</a>
</span><span class=lnt id=hl-40-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-5>5</a>
</span><span class=lnt id=hl-40-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-6>6</a>
</span><span class=lnt id=hl-40-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-7>7</a>
</span><span class=lnt id=hl-40-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-8>8</a>
</span><span class=lnt id=hl-40-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ChannelHandler.Sharable</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GroupMembersRequestMessageHandler</span> <span class=kd>extends</span> <span class=n>SimpleChannelInboundHandler</span><span class=o>&lt;</span><span class=n>GroupMembersRequestMessage</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>channelRead0</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>GroupMembersRequestMessage</span> <span class=n>msg</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>members</span> <span class=o>=</span> <span class=n>GroupSessionFactory</span><span class=o>.</span><span class=na>getGroupSession</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getMembers</span><span class=o>(</span><span class=n>msg</span><span class=o>.</span><span class=na>getGroupName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>GroupMembersResponseMessage</span><span class=o>(</span><span class=n>members</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#35-èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º><h3 id=35-èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º><span class=hanchor arialabel=Anchor># </span>3.5 èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-1> 1</a>
</span><span class=lnt id=hl-41-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-2> 2</a>
</span><span class=lnt id=hl-41-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-3> 3</a>
</span><span class=lnt id=hl-41-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-4> 4</a>
</span><span class=lnt id=hl-41-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-5> 5</a>
</span><span class=lnt id=hl-41-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-6> 6</a>
</span><span class=lnt id=hl-41-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-7> 7</a>
</span><span class=lnt id=hl-41-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-8> 8</a>
</span><span class=lnt id=hl-41-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-9> 9</a>
</span><span class=lnt id=hl-41-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-10>10</a>
</span><span class=lnt id=hl-41-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-11>11</a>
</span><span class=lnt id=hl-41-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-12>12</a>
</span><span class=lnt id=hl-41-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-13>13</a>
</span><span class=lnt id=hl-41-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-14>14</a>
</span><span class=lnt id=hl-41-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-15>15</a>
</span><span class=lnt id=hl-41-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-16>16</a>
</span><span class=lnt id=hl-41-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-17>17</a>
</span><span class=lnt id=hl-41-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>@Slf4j
</span></span><span class=line><span class=cl>@ChannelHandler.Sharable
</span></span><span class=line><span class=cl>public class QuitHandler extends ChannelInboundHandlerAdapter {
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // å½“è¿æ¥æ–­å¼€æ—¶è§¦å‘ inactive äº‹ä»¶
</span></span><span class=line><span class=cl>    @Override
</span></span><span class=line><span class=cl>    public void channelInactive(ChannelHandlerContext ctx) throws Exception {
</span></span><span class=line><span class=cl>        SessionFactory.getSession().unbind(ctx.channel());
</span></span><span class=line><span class=cl>        log.debug(&#34;{} å·²ç»æ–­å¼€&#34;, ctx.channel());
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	// å½“å‡ºç°å¼‚å¸¸æ—¶è§¦å‘
</span></span><span class=line><span class=cl>    @Override
</span></span><span class=line><span class=cl>    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception {
</span></span><span class=line><span class=cl>        SessionFactory.getSession().unbind(ctx.channel());
</span></span><span class=line><span class=cl>        log.debug(&#34;{} å·²ç»å¼‚å¸¸æ–­å¼€ å¼‚å¸¸æ˜¯{}&#34;, ctx.channel(), cause.getMessage());
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><a href=#36-èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹><h3 id=36-èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹><span class=hanchor arialabel=Anchor># </span>3.6 èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹</h3></a><a href=#è¿æ¥å‡æ­»><h4 id=è¿æ¥å‡æ­»><span class=hanchor arialabel=Anchor># </span>è¿æ¥å‡æ­»</h4></a><a href=#åŸå› ><h5 id=åŸå› ><span class=hanchor arialabel=Anchor># </span>åŸå› </h5></a><ul><li>ç½‘ç»œè®¾å¤‡å‡ºç°æ•…éšœï¼Œä¾‹å¦‚ç½‘å¡ï¼Œæœºæˆ¿ç­‰ï¼Œåº•å±‚çš„ TCP è¿æ¥å·²ç»æ–­å¼€äº†ï¼Œä½†åº”ç”¨<strong>ç¨‹åºæ²¡æœ‰æ„ŸçŸ¥</strong>åˆ°ï¼Œä»ç„¶å ç”¨ç€èµ„æºã€‚</li><li>å…¬ç½‘ç½‘ç»œä¸ç¨³å®šï¼Œå‡ºç°ä¸¢åŒ…ã€‚å¦‚æœè¿ç»­å‡ºç°ä¸¢åŒ…ï¼Œè¿™æ—¶ç°è±¡å°±æ˜¯å®¢æˆ·ç«¯æ•°æ®å‘ä¸å‡ºå»ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¸€ç›´æ”¶ä¸åˆ°æ•°æ®ï¼Œå°±è¿™ä¹ˆä¸€ç›´è€—ç€</li><li>åº”ç”¨ç¨‹åºçº¿ç¨‹é˜»å¡ï¼Œæ— æ³•è¿›è¡Œæ•°æ®è¯»å†™</li></ul><a href=#é—®é¢˜><h5 id=é—®é¢˜><span class=hanchor arialabel=Anchor># </span>é—®é¢˜</h5></a><ul><li>å‡æ­»çš„è¿æ¥å ç”¨çš„èµ„æºä¸èƒ½è‡ªåŠ¨é‡Šæ”¾</li><li>å‘å‡æ­»çš„è¿æ¥å‘é€æ•°æ®ï¼Œå¾—åˆ°çš„åé¦ˆæ˜¯å‘é€è¶…æ—¶</li></ul><a href=#æœåŠ¡å™¨ç«¯è§£å†³><h5 id=æœåŠ¡å™¨ç«¯è§£å†³><span class=hanchor arialabel=Anchor># </span>æœåŠ¡å™¨ç«¯è§£å†³</h5></a><ul><li>æ€ä¹ˆåˆ¤æ–­å®¢æˆ·ç«¯è¿æ¥æ˜¯å¦å‡æ­»å‘¢ï¼Ÿå¦‚æœèƒ½æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼Œè¯´æ˜æ²¡æœ‰å‡æ­»ã€‚å› æ­¤ç­–ç•¥å°±å¯ä»¥å®šä¸ºï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±æ£€æŸ¥è¿™æ®µæ—¶é—´å†…æ˜¯å¦æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼Œæ²¡æœ‰å°±å¯ä»¥åˆ¤å®šä¸ºè¿æ¥å‡æ­»</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-1> 1</a>
</span><span class=lnt id=hl-42-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-2> 2</a>
</span><span class=lnt id=hl-42-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-3> 3</a>
</span><span class=lnt id=hl-42-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-4> 4</a>
</span><span class=lnt id=hl-42-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-5> 5</a>
</span><span class=lnt id=hl-42-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-6> 6</a>
</span><span class=lnt id=hl-42-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-7> 7</a>
</span><span class=lnt id=hl-42-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-8> 8</a>
</span><span class=lnt id=hl-42-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-9> 9</a>
</span><span class=lnt id=hl-42-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-10>10</a>
</span><span class=lnt id=hl-42-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-11>11</a>
</span><span class=lnt id=hl-42-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-12>12</a>
</span><span class=lnt id=hl-42-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-13>13</a>
</span><span class=lnt id=hl-42-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-14>14</a>
</span><span class=lnt id=hl-42-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-15>15</a>
</span><span class=lnt id=hl-42-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿
</span></span></span><span class=line><span class=cl><span class=c1>// 5s å†…å¦‚æœæ²¡æœ‰æ”¶åˆ° channel çš„æ•°æ®ï¼Œä¼šè§¦å‘ä¸€ä¸ª IdleState#READER_IDLE äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>IdleStateHandler</span><span class=o>(</span><span class=n>5</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>0</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=c1>// ChannelDuplexHandler å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelDuplexHandler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ç”¨æ¥è§¦å‘ç‰¹æ®Šäº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>userEventTriggered</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>Object</span> <span class=n>evt</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>IdleStateEvent</span> <span class=n>event</span> <span class=o>=</span> <span class=o>(</span><span class=n>IdleStateEvent</span><span class=o>)</span> <span class=n>evt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// è§¦å‘äº†è¯»ç©ºé—²äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=o>(</span><span class=n>event</span><span class=o>.</span><span class=na>state</span><span class=o>()</span> <span class=o>==</span> <span class=n>IdleState</span><span class=o>.</span><span class=na>READER_IDLE</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;å·²ç» 5s æ²¡æœ‰è¯»åˆ°æ•°æ®äº†&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>ctx</span><span class=o>.</span><span class=na>channel</span><span class=o>().</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>});</span>
</span></span></code></pre></td></tr></table></div></div><a href=#å®¢æˆ·ç«¯å®šæ—¶å¿ƒè·³><h5 id=å®¢æˆ·ç«¯å®šæ—¶å¿ƒè·³><span class=hanchor arialabel=Anchor># </span>å®¢æˆ·ç«¯å®šæ—¶å¿ƒè·³</h5></a><ul><li>å®¢æˆ·ç«¯å¯ä»¥å®šæ—¶å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®ï¼Œåªè¦è¿™ä¸ªæ—¶é—´é—´éš”å°äºæœåŠ¡å™¨å®šä¹‰çš„ç©ºé—²æ£€æµ‹çš„æ—¶é—´é—´éš”ï¼Œé‚£ä¹ˆå°±èƒ½é˜²æ­¢å‰é¢æåˆ°çš„è¯¯åˆ¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥å®šä¹‰å¦‚ä¸‹å¿ƒè·³å¤„ç†å™¨</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-1> 1</a>
</span><span class=lnt id=hl-43-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-2> 2</a>
</span><span class=lnt id=hl-43-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-3> 3</a>
</span><span class=lnt id=hl-43-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-4> 4</a>
</span><span class=lnt id=hl-43-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-5> 5</a>
</span><span class=lnt id=hl-43-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-6> 6</a>
</span><span class=lnt id=hl-43-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-7> 7</a>
</span><span class=lnt id=hl-43-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-8> 8</a>
</span><span class=lnt id=hl-43-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-9> 9</a>
</span><span class=lnt id=hl-43-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-10>10</a>
</span><span class=lnt id=hl-43-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-11>11</a>
</span><span class=lnt id=hl-43-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-12>12</a>
</span><span class=lnt id=hl-43-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-13>13</a>
</span><span class=lnt id=hl-43-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-14>14</a>
</span><span class=lnt id=hl-43-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-15>15</a>
</span><span class=lnt id=hl-43-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿
</span></span></span><span class=line><span class=cl><span class=c1>// 3s å†…å¦‚æœæ²¡æœ‰å‘æœåŠ¡å™¨å†™æ•°æ®ï¼Œä¼šè§¦å‘ä¸€ä¸ª IdleState#WRITER_IDLE äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>IdleStateHandler</span><span class=o>(</span><span class=n>0</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>0</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=c1>// ChannelDuplexHandler å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ch</span><span class=o>.</span><span class=na>pipeline</span><span class=o>().</span><span class=na>addLast</span><span class=o>(</span><span class=k>new</span> <span class=n>ChannelDuplexHandler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ç”¨æ¥è§¦å‘ç‰¹æ®Šäº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>userEventTriggered</span><span class=o>(</span><span class=n>ChannelHandlerContext</span> <span class=n>ctx</span><span class=o>,</span> <span class=n>Object</span> <span class=n>evt</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>IdleStateEvent</span> <span class=n>event</span> <span class=o>=</span> <span class=o>(</span><span class=n>IdleStateEvent</span><span class=o>)</span> <span class=n>evt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// è§¦å‘äº†å†™ç©ºé—²äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=o>(</span><span class=n>event</span><span class=o>.</span><span class=na>state</span><span class=o>()</span> <span class=o>==</span> <span class=n>IdleState</span><span class=o>.</span><span class=na>WRITER_IDLE</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//                                log.debug(&#34;3s æ²¡æœ‰å†™æ•°æ®äº†ï¼Œå‘é€ä¸€ä¸ªå¿ƒè·³åŒ…&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>ctx</span><span class=o>.</span><span class=na>writeAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>PingMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>});</span>
</span></span></code></pre></td></tr></table></div></div></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>åå‘é“¾æ¥</h3><ul class=backlinks><li>æ— åå‘é“¾æ¥</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>æ¹¾åŒºåœ°å›¾</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://harbor.mffseal.top/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p><a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/><img alt="Creative Commons Licence" style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/88x31.png></a><br>æœ¬åšå®¢çš„åšä¸»åŸåˆ›æ–‡ç« å‡éµå¾ª <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>CC BY-NC(ç½²å-éå•†ä¸šæ€§ä½¿ç”¨) 4.0 å›½é™…åè®®</a><br>è½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜</p><p>ç”± mffseal ä½¿ç”¨ <a href=https://github.com/jackyzha0/quartz>Quartz</a> å¼€å‘, Â© 2023</p><ul><li><a href=https://harbor.mffseal.top/>æ¸¯å£</a></li><li><a href=https://github.com/mffseal>Github</a></li></ul></footer></div></div></body></html>