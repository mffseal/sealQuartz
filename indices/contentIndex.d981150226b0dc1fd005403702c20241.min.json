{"/":{"title":"ğŸ¦­æµ·è±¹æ¹¾","content":"\n**æµ·è±¹æ¸¯æ¹¾ï¼Œç¬¬äºŒå¤§è„‘**\n\næµ·è±¹çš„è§†çº¿ï¼šç½‘ç»œå®‰å…¨ | é€†å‘ | äºŒè¿›åˆ¶ | Java å¼€å‘ | ç‰©è”ç½‘å®‰å…¨ | TEE | åŒºå—é“¾\n\n---\n\n# ğŸ¦­æµ·è±¹æ¹¾\n\næ¹¾åŒºå»ºè®¾çŠ¶æ€ï¼š\n\n[![ä¸Šä¼ ](https://github.com/mffseal/sealQuartz/actions/workflows/deploy.yaml/badge.svg)](https://github.com/mffseal/sealQuartz/actions/workflows/deploy.yaml) [![æ„å»º](https://github.com/mffseal/sealQuartz/actions/workflows/pages/pages-build-deployment/badge.svg)](https://github.com/mffseal/sealQuartz/actions/workflows/pages/pages-build-deployment)\n\nçŸ¥è¯†æœ€å°å•ä½ä¸º atomï¼Œç”±å¤šä¸ª atom ç»„åˆæˆ articleï¼Œæ„å»ºçŸ¥è¯†å›¾è°±ï¼Œé™ä½å†…å®¹å†—ä½™åº¦ï¼Œä¸æ–­ç²¾ç‚¼å†…å®¹è¾“å‡ºã€‚\n\n[æ‰€æœ‰articleæ–‡ç« ](https://harbor.mffseal.top/tags/article) | [æ‰€æœ‰atomé¡¹](https://harbor.mffseal.top/tags/atom)\n","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6":{"title":"æ•°å­—è¯ä¹¦","content":"\n# æ•°å­—è¯ä¹¦\n\næœ€ç®€å•çš„è¯ä¹¦åŒ…å«å…¬é’¥ã€åç§°ä»¥åŠè¯ä¹¦æˆæƒä¸­å¿ƒçš„æ•°å­—ç­¾åã€‚\nä¸€èˆ¬æƒ…å†µä¸‹è¯ä¹¦ä¸­è¿˜åŒ…æ‹¬å¯†é’¥çš„æœ‰æ•ˆæœŸï¼Œé¢å‘è€…ï¼ˆè¯ä¹¦æˆæƒä¸­å¿ƒï¼‰çš„åç§°ï¼Œè¯¥è¯ä¹¦çš„åºåˆ—å·ç­‰ä¿¡æ¯ï¼Œè¯ä¹¦çš„ç»“æ„éµå¾ªX.509 v3ç‰ˆæœ¬çš„è§„èŒƒã€‚\n\n## å­—æ®µè§£é‡Š\n\n![[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/z-attachments/Pasted image 20220928021147.png]]\n\n- ç‰ˆæœ¬ï¼šå³ä½¿ç”¨X.509çš„ç‰ˆæœ¬ï¼Œç›®å‰æ™®éä½¿ç”¨çš„æ˜¯v3ç‰ˆæœ¬ï¼ˆ0x2ï¼‰ã€‚\n- åºåˆ—å·ï¼šé¢å‘è€…åˆ†é…ç»™è¯ä¹¦çš„ä¸€ä¸ªæ­£æ•´æ•°ï¼ŒåŒä¸€é¢å‘è€…é¢å‘çš„è¯ä¹¦åºåˆ—å·å„ä¸ç›¸åŒï¼Œå¯ç”¨ä¸é¢å‘è€…åç§°ä¸€èµ·ä½œä¸ºè¯ä¹¦å”¯ä¸€æ ‡è¯†ã€‚\n- ç­¾åç®—æ³•ï¼šé¢å‘è€…é¢å‘è¯ä¹¦ä½¿ç”¨çš„ç­¾åç®—æ³•ã€‚\n- é¢å‘è€…ï¼šé¢å‘è¯¥è¯ä¹¦çš„è®¾å¤‡åç§°ï¼Œå¿…é¡»ä¸é¢å‘è€…è¯ä¹¦ä¸­çš„ä¸»ä½“åä¸€è‡´ã€‚é€šå¸¸ä¸º[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CA|CA]]æœåŠ¡å™¨çš„åç§°ã€‚\n- æœ‰æ•ˆæœŸï¼šåŒ…å«æœ‰æ•ˆçš„èµ·ã€æ­¢æ—¥æœŸï¼Œä¸åœ¨æœ‰æ•ˆæœŸèŒƒå›´çš„è¯ä¹¦ä¸ºæ— æ•ˆè¯ä¹¦ã€‚\n- ä¸»ä½“åï¼šè¯ä¹¦æ‹¥æœ‰è€…çš„åç§°ï¼Œå¦‚æœä¸é¢å‘è€…ç›¸åŒåˆ™è¯´æ˜è¯¥è¯ä¹¦æ˜¯ä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ã€‚\n- å…¬é’¥ä¿¡æ¯ï¼šç”¨æˆ·å¯¹å¤–å…¬å¼€çš„å…¬é’¥ä»¥åŠå…¬é’¥ç®—æ³•ä¿¡æ¯ã€‚\n- æ‰©å±•ä¿¡æ¯ï¼šé€šå¸¸åŒ…å«äº†è¯ä¹¦çš„ç”¨æ³•ã€[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CRL|CRL]]çš„å‘å¸ƒåœ°å€ç­‰å¯é€‰å­—æ®µã€‚\n- ç­¾åï¼šé¢å‘è€…ç”¨ç§é’¥å¯¹è¯ä¹¦ä¿¡æ¯çš„ç­¾åã€‚\n\n## è¯ä¹¦ç±»å‹\n\n- è‡ªç­¾åè¯ä¹¦ï¼šè‡ªç­¾åè¯ä¹¦åˆç§°ä¸ºæ ¹è¯ä¹¦ï¼Œæ˜¯è‡ªå·±é¢å‘ç»™è‡ªå·±çš„è¯ä¹¦ï¼Œå³**è¯ä¹¦ä¸­çš„é¢å‘è€…å’Œä¸»ä½“åç›¸åŒ**ã€‚\n- CAè¯ä¹¦ï¼šCAè‡ªèº«çš„è¯ä¹¦ã€‚å¦‚æœ[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/PKI|PKI]]ç³»ç»Ÿä¸­æ²¡æœ‰å¤šå±‚çº§CAï¼ŒCAè¯ä¹¦å°±æ˜¯è‡ªç­¾åè¯ä¹¦ï¼›å¦‚æœæœ‰å¤šå±‚çº§CAï¼Œåˆ™ä¼šå½¢æˆä¸€ä¸ªCAå±‚æ¬¡ç»“æ„ï¼Œæœ€ä¸Šå±‚çš„CAæ˜¯æ ¹CAï¼Œå®ƒæ‹¥æœ‰ä¸€ä¸ªCAâ€œè‡ªç­¾åâ€çš„è¯ä¹¦ã€‚\n- æœ¬åœ°è¯ä¹¦ï¼šCAé¢å‘ç»™ç”³è¯·è€…çš„è¯ä¹¦ã€‚\n- è®¾å¤‡æœ¬åœ°è¯ä¹¦ï¼šè®¾å¤‡æ ¹æ®CAè¯ä¹¦ç»™è‡ªå·±é¢å‘çš„è¯ä¹¦ï¼Œè¯ä¹¦ä¸­çš„é¢å‘è€…åç§°æ˜¯CAæœåŠ¡å™¨çš„åç§°ã€‚\n\n## è¯ä¹¦æ ¼å¼\n\n1. PKCS#12ï¼šä»¥äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜è¯ä¹¦ï¼Œå¯ä»¥åŒ…å«ç§é’¥ï¼Œä¹Ÿå¯ä»¥ä¸åŒ…å«ç§é’¥ã€‚å¸¸ç”¨çš„åç¼€æœ‰ï¼š.P12å’Œ.PFXã€‚\n2. DERï¼šä»¥äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜è¯ä¹¦ï¼Œä¸åŒ…å«ç§é’¥ã€‚å¸¸ç”¨çš„åç¼€æœ‰ï¼š.DERã€.CERå’Œ.CRTã€‚\n3. PEMï¼šä»¥ASCIIç æ ¼å¼ä¿å­˜è¯ä¹¦ï¼Œå¯ä»¥åŒ…å«ç§é’¥ï¼Œä¹Ÿå¯ä»¥ä¸åŒ…å«ç§é’¥ã€‚å¸¸ç”¨çš„åç¼€æœ‰ï¼š.PEMã€.CERå’Œ.CRTã€‚\n\n\u003e å¯¹äºè¯ä¹¦åç¼€ä¸º.CERæˆ–.CRTï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€è¯ä¹¦ï¼ŒæŸ¥çœ‹è¯ä¹¦å†…å®¹æ¥åŒºåˆ†è¯ä¹¦æ ¼å¼ã€‚\n\u003e \n\u003e -   å¦‚æœæœ‰ç±»ä¼¼ï¼‚â€”â€“BEGIN CERTIFICATEâ€”â€“ï¼‚å’Œï¼‚â€”â€“END CERTIFICATEâ€”â€“ï¼‚çš„å¤´å°¾æ ‡è®°ï¼Œåˆ™è¯ä¹¦æ ¼å¼ä¸ºPEMã€‚\n\u003e -   å¦‚æœæ˜¯ä¹±ç ï¼Œåˆ™è¯ä¹¦æ ¼å¼ä¸ºDER\n\n\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/%E7%94%A8%E6%88%B7%E8%AF%81%E4%B9%A6%E7%AD%BE%E5%8F%91%E6%96%B9%E5%BC%8F":{"title":"ç”¨æˆ·è¯ä¹¦ç­¾å‘æ–¹å¼","content":"\n# ç”¨æˆ·è¯ä¹¦ç­¾å‘æ–¹å¼\n\nä¸¤ç§æ–¹å¼ï¼š\n1. ç”± CA ç›´æ¥æ¥ç”Ÿæˆè¯ä¹¦ï¼ˆå†…å«å…¬é’¥ï¼‰å’Œå¯¹åº”çš„ç§é’¥å‘ç»™ç”¨æˆ·ï¼›\n1. ç”±ç”¨æˆ·è‡ªå·±ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œç„¶åç”± CA æ¥å¯¹å…¬é’¥å†…å®¹è¿›è¡Œç­¾åã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/%E8%AF%81%E4%B9%A6%E6%92%A4%E9%94%80":{"title":"è¯ä¹¦æ’¤é”€","content":"\n# è¯ä¹¦æ’¤é”€\n\nè¯ä¹¦è¶…å‡ºæœ‰æ•ˆæœŸåä¼šä½œåºŸï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘ [[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CA|CA]] ç”³è¯·æ’¤é”€æŸè¯ä¹¦æ–‡ä»¶ï¼Œç”±äº CA æ— æ³•å¼ºåˆ¶æ”¶å›å·²ç»é¢å‘å‡ºå»çš„æ•°å­—è¯ä¹¦ï¼Œå› æ­¤ä¸ºäº†å®ç°è¯ä¹¦çš„ä½œåºŸï¼Œå¾€å¾€è¿˜éœ€è¦ç»´æŠ¤ä¸€ä¸ª[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CRL|CRL]]ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/%E8%AF%81%E4%B9%A6%E7%94%B3%E8%AF%B7":{"title":"è¯ä¹¦ç”³è¯·","content":"\n# è¯ä¹¦ç”³è¯·\n\n## å‰ç½®æ¡ä»¶\n\n1. åŒæ­¥æ—¶é—´ï¼šæ—¶é—´æ˜¯PIKç³»ç»Ÿçš„é‡ä¸­ä¹‹é‡ï¼Œå¿…é¡»å…ˆç¡®ä¿å‚åŠ [[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/PKI|PKI]]ç³»ç»Ÿçš„è®¾å¤‡å’Œä¸»æœºçš„æ—¶é—´åŒæ­¥ã€‚æ‰èƒ½å¼€å§‹PKIçš„éƒ¨ç½²ã€‚å½“è®¾å¤‡çš„æ—¶é—´æ…¢ä¸è¯ä¹¦æœ‰æ•ˆæœŸçš„å¼€å§‹æ—¶é—´æˆ–è€…è®¾å¤‡æ—¶é—´å¤§äºè¯ä¹¦æœ‰æ•ˆæœŸçš„ç»“æŸæ—¶é—´é‚£ä¹ˆè¯ä¹¦éƒ½æ˜¯æ— æ•ˆçš„ã€‚ å¿Œè®³ï¼šè®¾å¤‡æ—¶é—´æ¯”è¯ä¹¦æœåŠ¡å™¨çš„æ—¶é—´æ…¢ã€‚\n2. éƒ¨ç½²è¯ä¹¦æœåŠ¡å™¨ã€‚è¯ä¹¦æœåŠ¡å™¨æ˜¯æ•´ä¸ªPKIç³»ç»Ÿçš„æ ¸å¿ƒã€‚å¯ä»¥é€‰æ‹©å¾®è½¯çš„è¯ä¹¦æœåŠ¡å™¨ã€‚\n3. å®¢æˆ·ç«¯äº§ç”Ÿå¯†é’¥å¯¹ã€‚æ¯ä¸€ä¸ªå®ä½“åœ¨ç”³è¯·è¯ä¹¦ä¹‹å‰ï¼Œéœ€è¦é¢„å…ˆäº§ç”ŸRSAçš„ç§˜é’¥å¯¹ã€‚\n4. éªŒè¯è¯ä¹¦æœåŠ¡å™¨çš„åˆæ³•æ€§ã€‚æ¯ä¸€ä¸ªå®ä½“éœ€è¦è·å–è¯ä¹¦æœåŠ¡å™¨çš„æ ¹è¯ä¹¦ï¼Œé‡Œé¢åŒ…å«è¯ä¹¦æœåŠ¡å™¨çš„å…¬é’¥ã€‚è·å–äº†æ ¹è¯ä¹¦åï¼Œå¯ä»¥é€šè¿‡fingerprintç¦»å…ˆéªŒè¯è¯ä¹¦æœåŠ¡å™¨ã€‚\n5. ç”³è¯·ä¸ªäººè¯ä¹¦ã€‚æ¯ä¸€ä¸ªå®ä½“å‘é€è‡ªå·±çš„ä¸ªäººä¿¡æ¯å’Œå…¬é’¥åˆ°PKIã€‚ï¼ˆåœ¨çº¿å’Œç¦»çº¿æ–¹å¼ï¼‰\n6. [[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/RA|RA]]å®¡æ ¸å¹¶ç­¾åè¯ä¹¦ã€‚ç®¡ç†å‘˜å¯¹æ¯ä¸€ä¸ªè¯ä¹¦è¯·æ±‚è¿›è¡Œå®¡æ ¸ï¼Œå¹¶å¯¹ä¸ªäººä¿¡æ¯å’Œå…¬é’¥å†…å®¹è¿›è¡Œæ•°å­—ç­¾åï¼Œç­¾ååçš„æ–‡ä»¶å³ä¸º[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/æ•°å­—è¯ä¹¦|æ•°å­—è¯ä¹¦]]ã€‚\n7. [[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CA|CA]]é¢å‘æ•°å­—è¯ä¹¦ç»™è®¾å¤‡ã€‚è¯ä¹¦æœåŠ¡å™¨æŠŠç­¾åçš„[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/è¯ä¹¦é¢å‘|è¯ä¹¦é¢å‘]]ç»™å®ä½“ã€‚\n8. è®¾å¤‡ç›¸äº’äº¤æ¢è¯ä¹¦ã€‚\n\n## è¯ä¹¦ç”³è¯·æ–¹å¼\n\n- SCEPï¼ˆSimple Certificate Enrollment Protocolï¼‰for VPN devicesã€‚\n- File-basedï¼ˆPKCS#10ï¼‰\n- Web-based(browser-to-CA)\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/%E8%AF%81%E4%B9%A6%E9%A2%81%E5%8F%91":{"title":"è¯ä¹¦é¢å‘","content":"\n# è¯ä¹¦é¢å‘\n\n- æ¯ä¸ªå®ä½“éƒ½è¦è·å–[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CA|CA]]çš„å…¬é’¥ï¼ˆè®¤è¯CAçš„è¿‡ç¨‹ï¼‰\n- æ¯ä¸ªå®ä½“éƒ½è¦æäº¤è‡ªå·±çš„å…¬é’¥ç»™CAï¼ˆæ³¨å†Œåˆ°PKIï¼‰\n- è¿™ä¸ªåˆå§‹æ­¥éª¤ï¼Œå¿…é¡»æ‰‹åŠ¨è®¤è¯æˆ–è€…é€šè¿‡ä¸€ä¸ªå¯ä¿¡ä»»çš„ä¼ è¾“ç½‘ç»œæ¥æ‰§è¡Œã€‚\n- CAä½¿ç”¨è‡ªå·±çš„ç§é’¥ä¸ºæäº¤çš„å…¬é’¥åšæ•°å­—ç­¾åã€‚\n- è¢«æ•°å­—ç­¾äº†åçš„å…¬é’¥ï¼ˆèº«ä»½è¯ä¹¦ï¼‰å†è¿”å›ç»™å®ä½“ã€‚\n- å®ä½“ç°åœ¨å¯ä»¥é€šè¿‡éä¿¡ä»»çš„ç½‘ç»œæ¥å½¼æ­¤äº¤æ¢è¢«CAç­¾äº†åçš„å…¬é’¥äº†ã€‚\n- æ”¶åˆ°çš„å…¬é’¥éƒ½æ˜¯è¢«CAçš„å…¬é’¥æ‰€ç¡®è®¤çš„ï¼ŒCAçš„å…¬é’¥åœ¨æ¯ä¸ªå®ä½“æœ¬åœ°å¿…é¡»æ˜¯æœ‰æ•ˆçš„ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81":{"title":"è¯ä¹¦éªŒè¯","content":"\n# è¯ä¹¦éªŒè¯\n\n## å‡†å¤‡é˜¶æ®µ\n\n- å®ä½“Aï¼šéœ€è¦æœ‰Açš„å…¬é’¥ã€Açš„ç§é’¥ã€Aè¯ä¹¦ã€CAè¯ä¹¦\n- å®ä½“Bï¼šéœ€è¦æœ‰Bçš„å…¬é’¥ã€Bçš„ç§é’¥ã€Bè¯ä¹¦ã€CAè¯ä¹¦\n\n\u003e Aè¯ä¹¦å†…å®¹ï¼šã€Aå…¬é’¥ + CAç§é’¥ç­¾å[Hashï¼ˆAçš„å…¬é’¥ + ä¸ªäººä¿¡æ¯ï¼‰]ã€‘\n\u003e Bè¯ä¹¦å†…å®¹ï¼šã€Bå…¬é’¥ + CAç§é’¥ç­¾å[Hashï¼ˆBçš„å…¬é’¥ + ä¸ªäººä¿¡æ¯ï¼‰]ã€‘\n\u003e CAè¯ä¹¦å†…å®¹ï¼šã€CAå…¬é’¥ + CAç§é’¥ç­¾å[Hashï¼ˆCAçš„å…¬é’¥ + ä¸ªäººä¿¡æ¯ï¼‰]ã€‘\n\näº’ç›¸äº¤æ¢äº¤æ¢è¯ä¹¦åï¼Œå®ä½“Aæœ‰äº†Bè¯ä¹¦ï¼Œå®ä½“Bæœ‰äº†Aè¯ä¹¦ã€‚\n\n## éªŒè¯è¯ä¹¦åˆæ³•æ€§\n\nä¸¾ä¾‹ï¼šAéªŒè¯Bè¯ä¹¦æ˜¯å¦åˆæ³•ï¼š\n\n\u003e Bè¯ä¹¦å†…å®¹ï¼šã€Bå…¬é’¥ + CAç§é’¥ç­¾å[Hashï¼ˆBçš„å…¬é’¥ + ä¸ªäººä¿¡æ¯ï¼‰]ã€‘\n\u003e CAè¯ä¹¦å†…å®¹ï¼šã€CAå…¬é’¥ + CAç§é’¥ç­¾å[Hashï¼ˆCAçš„å…¬é’¥ + ä¸ªäººä¿¡æ¯ï¼‰]ã€‘\n\n1. ç”¨CAå…¬è§£å¯†Bè¯ä¹¦â€”â€”å¾—åˆ°HASHå€¼12345ã€‚\n2. ä½¿ç”¨Bè¯ä¹¦æä¾›çš„ä¸ªäººä¿¡æ¯ï¼Œå…¬é’¥ï¼Œç­¾åç®—æ³•ä¹ŸåšHASHå€¼å¾—åˆ°12345 ã€‚\n3. å¦‚æœä¸¤æ¬¡hashå€¼ç›¸åŒï¼Œå³éªŒè¯äº†Bè¯ä¹¦çš„åˆæ³•ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/CA":{"title":"CA","content":"\n# CA\n\nCertification Authorityï¼Œè®¤è¯ä¸­å¿ƒã€‚\n\nè´Ÿè´£è¯ä¹¦çš„é¢å‘å’ŒåŠé”€ï¼ˆRevokeï¼‰ï¼Œæ¥æ”¶æ¥è‡ª [[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/RA|RA]] çš„è¯·æ±‚ï¼Œæ˜¯æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚\n\n## å­˜åœ¨æ„ä¹‰\n\nå³ä½¿æ˜¯éå¯¹ç§°åŠ å¯†ç³»ç»Ÿï¼Œä¹Ÿä¸èƒ½ä¿è¯å…¬é’¥çš„åˆ†å‘æ˜¯å¯é çš„ã€‚ ä¸ºäº†é˜²èŒƒå…¬é’¥åˆ†å‘è¿‡ç¨‹ä¸­çš„ä¸­é—´äººæ”»å‡»ï¼Œéœ€è¦ä¸€ä¸ªå¯ä¿¡çš„\"å§‹ç¥–\"å…¬è¯äººï¼Œè¿™å°±æ˜¯CAæœºæ„å­˜åœ¨çš„æ„ä¹‰ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/CRL":{"title":"CRL","content":"\n# CRL\n\nè¯ä¹¦æ’¤é”€åˆ—è¡¨ (Certificate Revocation List, CRL) ç”¨äºåˆ—å‡ºå®¢æˆ·æœºæˆ–æœåŠ¡å™¨ç”¨æˆ·ä¸åº”å†ä¿¡ä»»çš„æ‰€æœ‰è¯ä¹¦å’Œå¯†é’¥ã€‚å¦‚æœè¯ä¹¦ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨è¯ä¹¦åˆ°æœŸä¹‹å‰æ¢å•ä½æˆ–ç¦»èŒï¼‰ï¼Œè¯¥è¯ä¹¦å°†è¢«æ’¤é”€ï¼Œå¹¶ä¸”å…¶æ•°æ®å°†æ˜¾ç¤ºåœ¨ CRL ä¸­ã€‚CRL ç”± [[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CA|CA]] ç”Ÿæˆå¹¶å®šæœŸæ›´æ–°ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/CSR":{"title":"CSR","content":"\n# CSR\n\nCertificate Signing Requestï¼Œè¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/DES":{"title":"DES","content":"# DES\n\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/PKCS":{"title":"PKCS","content":"\n# PKCS\n\nThe Public-Key Cryptography Standards (PKCS)ï¼Œ\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/PKI":{"title":"PKI","content":"\n# PKI\n\nPublicÂ KeyÂ Infrastructureï¼Œå…¬é’¥åŸºç¡€è®¾æ–½ã€‚\n\n## ç»„æˆ\n\nä¸€ä¸ªPKIä½“ç³»ç”±ç»ˆç«¯å®ä½“ã€è¯ä¹¦è®¤è¯æœºæ„ã€è¯ä¹¦æ³¨å†Œæœºæ„å’Œè¯ä¹¦/[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CRL|CRL]]å­˜å‚¨åº“å››éƒ¨åˆ†å…±åŒç»„æˆã€‚\n\n- è¯ä¹¦é¢å‘æœºæ„ï¼ˆ[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CA|CA]]ï¼‰\n- è¯ä¹¦æ³¨å†Œæœºæ„ï¼ˆ[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/RA|RA]])\n- è¯ä¹¦åº“\n- å¯†é’¥å¤‡ä»½åŠæ¢å¤ç³»ç»Ÿ\n- è¯ä¹¦åºŸé™¤å¤„ç†ç³»ç»Ÿ\n- åº”ç”¨ç³»ç»Ÿæ¥å£\n- [[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/æ•°å­—è¯ä¹¦|æ•°å­—è¯ä¹¦]]\n\n## é‡è¦è§’è‰²\n\n1. ç»ˆç«¯å®ä½“ï¼ˆEE, End Entityï¼‰: è¯ä¹¦çš„æœ€ç»ˆä½¿ç”¨è€…ï¼Œä¾‹å¦‚æ€»éƒ¨å’Œåˆ†æ”¯çš„ç½‘å…³ã€‚\n2. è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼Œ Certificate Authorityï¼‰ï¼šæ˜¯ä¸€ä¸ªæƒå¨çš„ã€å¯ä¿¡çš„ç¬¬ä¸‰æ–¹æœºæ„ï¼Œè´Ÿè½½[[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/è¯ä¹¦é¢å‘|è¯ä¹¦é¢å‘]]ã€æŸ¥è¯¢ä»¥åŠæ›´æ–°ç­‰å·¥ä½œã€‚\n3. è¯ä¹¦æ³¨å†Œæœºæ„ï¼ˆRAï¼‰\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/RA":{"title":"RA","content":"\n# RA\n\nRegistration Authorityï¼Œæ³¨å†Œæœºæ„ã€‚\n\nå¯¹ç”¨æˆ·èº«ä»½è¿›è¡ŒéªŒè¯ï¼Œæ ¡éªŒæ•°æ®åˆæ³•æ€§ï¼Œè´Ÿè´£ç™»è®°ï¼Œå®¡æ ¸è¿‡äº†å°±å‘ç»™ [[2-æ•°å­¦/2_0_0_2-å¯†ç å­¦/CA|CA]]ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/2-%E6%95%B0%E5%AD%A6/2_0_0_2-%E5%AF%86%E7%A0%81%E5%AD%A6/SSL%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B":{"title":"SSLè¿æ¥å»ºç«‹","content":"\n# SSLè¿æ¥å»ºç«‹\n\n1. HTTPSæœåŠ¡å™¨å‘PKIè®¤è¯ä¸­å¿ƒç”³è¯·æœ¬åœ°è¯ä¹¦ã€‚\n2. PKIè®¤è¯ä¸­å¿ƒå‘HTTPSæœåŠ¡å™¨é¢å‘æœ¬åœ°è¯ä¹¦ã€‚\n3. HTTPSæœåŠ¡å™¨å°†æºå¸¦è‡ªå·±å…¬é’¥ä¿¡æ¯çš„æ•°å­—è¯ä¹¦å‘é€ç»™HTTPSå®¢æˆ·ç«¯ã€‚\n4. HTTPSå®¢æˆ·ç«¯éªŒè¯HTTPSæœåŠ¡å™¨çš„æœ¬åœ°è¯ä¹¦åˆæ³•åï¼Œåˆ©ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥åŠ å¯†HTTPSå®¢æˆ·ç«¯éšæœºç”Ÿæˆçš„å¯†é’¥ï¼Œå¹¶å‘é€ç»™HTTPSæœåŠ¡å™¨ã€‚\n5. HTTPSå®¢æˆ·ç«¯å’ŒHTTPSæœåŠ¡å™¨é€šè¿‡åå•†ï¼Œæœ€ç»ˆç¡®å®šæ‰€ä½¿ç”¨çš„å¯†é’¥å’ŒåŠ å¯†å¥—ä»¶ã€‚åç»­ä¼ è¾“çš„æ•°æ®ï¼ŒåŒæ–¹éƒ½ä¼šä½¿ç”¨è¯¥å¯†é’¥å’ŒåŠ å¯†å¥—ä»¶è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE":{"title":"äºŒåˆ†æŸ¥æ‰¾","content":"# äºŒåˆ†æŸ¥æ‰¾\n\n\u003e https://www.zhihu.com/question/36132386\n\n## äºŒåˆ†æŸ¥æ‰¾çš„é‡ç‚¹\n- å°†æ•°æ®åˆ†æˆä¸‰ä¸ªåŒºé—´ å·¦ ä¸­ å³\n\t- å·¦ å³æ˜¯å·²ç»æœç´¢è¿‡çš„åŒºé—´ï¼Œä¸­é—´æ˜¯å¾…æœç´¢åŒºé—´\n\t- åŒºé—´å…¨éƒ¨é‡‡ç”¨**å·¦é—­å³å¼€**\n\n## æœç´¢åŒºé—´\n\n- æœç´¢çš„è¿‡ç¨‹å°±æ˜¯å°½é‡æ‰©å¤§å·¦ å³ åŒºé—´çš„èŒƒå›´ï¼Œæœ€ç»ˆæ¶ˆç­ä¸­é—´åŒºé—´\n- å¯èƒ½çš„ç›®æ ‡ä¼šå‡ºç°åœ¨å››ä¸ªä½ç½®ï¼š\n\t- å·¦åŒºé—´ä¸‹ç•Œ\n\t- ä¸­åŒºé—´ä¸Šç•Œ\n\t- ä¸­åŒºé—´ä¸‹ç•Œ\n\t- å³åŒºé—´ä¸Šç•Œ\n\t![[z-oblib/z2-attachments/Pasted image 20220426105510.png]]\n- å››ç§æƒ…å†µä¸¤ä¸¤å·®åˆ«ä¸€ä½ï¼Œå› æ­¤å¯ä»¥é€šè¿‡\n\n## å¦‚ä½•å–ä¸­ç‚¹\n\n```java\n// é€šç”¨\nmid = first + (last - first) / 2;\n\n// java \u003e\u003e\u003e ä¸ºå¸¦ç¬¦å·ä½ç§»ï¼Œæº¢å‡ºåˆ°ç¬¦å·ä½çš„æ•°å­—ä¼šç§»å›æ¥\nmid = (first+last) \u003e\u003e\u003e 1;\n```\n\n## å¤„ç†ä¸­ç‚¹\n\n```python\ndef lower_bound(array, first, last, value):\n    while first \u003c last: # æœç´¢åŒºé—´[first, last)ä¸ä¸ºç©º\n        mid = first + (last - first) // 2  # é˜²æº¢å‡º\n        if array[mid] \u003c value: first = mid + 1\n        else: last = mid\n    return first  # lastä¹Ÿè¡Œï¼Œå› ä¸ºæ­¤æ—¶é‡åˆ\n```\n\n**å¯¹ä¸­é—´çš„å¤„ç†å®é™…ä¸Šå°±æ˜¯å†³å®šæŠŠç»ˆç‚¹å½’å…¥å·¦åŒºé—´è¿˜æ˜¯å³åŒºé—´ã€‚**\n- æ”¾å…¥å·¦åŒºé—´åˆ™å·¦åŒºé—´ä¸‹ç•Œ = mid +1ï¼Œ+1æ˜¯å› ä¸ºåŒºé—´å³å¼€\n- æ”¾å…¥å³åŒºé—´åˆ™å³åŒºé—´ä¸Šç•Œ = midï¼Œä¸+1æ˜¯å› ä¸ºåŒºé—´ä¿æŒå·¦é—­\n\n## ä¾‹å­\n\nä¸¾ä¸ªæ —å­ï¼Œæœç´¢æ•´ä¸ª`array = [-1, 0, 0, 3, 3, 3, 7, 8, 9]`ï¼Œ`value = 3`\n\n![[z-oblib/z2-attachments/v2-6fc0ed8d64174bc1d494236e1cce95bf_1440w.jpg]]\n\nåˆå§‹çŠ¶æ€ï¼Œæœç´¢åŒºé—´ä¸¤ä¾§éƒ½ä¸ºç©ºï¼Œæ»¡è¶³loop invariant 2å’Œ3\n\nä¸€å¼€å§‹é»„è‰²çš„æœç´¢åŒºé—´å·¦å³(é’ã€ç´«)éƒ½æ˜¯ç©ºçš„ï¼Œloop invariantsçš„2å’Œ3è‡ªç„¶æ»¡è¶³ã€‚\n\nä¸Šå›¾`array[mid] \u003e= 3`ï¼Œè¯´æ˜`mid`å±äºç´«è‰²ï¼\n\nåœ¨å·²çŸ¥ä¿¡æ¯ä¸‹ï¼Œæœ€å¤§é™åº¦åˆç†æ‰©å¼ ç´«è‰²åŒºé—´ã€ç¼©å°é»„è‰²æœç´¢åŒºé—´é•¿åº¦çš„æ“ä½œæ˜¯ï¼š\n\næŠŠ`last`æ”¾åˆ°ä¸Šå›¾ä¸­`mid`çš„ä½ç½®ï¼Œå³`last = mid` ï¼š\n\n![[z-oblib/z2-attachments/v2-7ef64338dd2ac43768e965a04ef4930c_1440w.jpg]]\n\nç´«è‰²åŒºé—´æœ€å¤§é™åº¦å‘å·¦æ‰©å¼ äº†\n\nå¦‚ä¸Šå›¾ï¼Œæ–°çš„`mid`æ»¡è¶³`array[mid] \u003c 3`ï¼Œè¯´æ˜`mid`å±äºé’è‰²ï¼åœ¨å·²çŸ¥ä¿¡æ¯ä¸‹ï¼Œæœ€å¤§é™åº¦åˆç†æ‰©å¼ é’è‰²åŒºé—´ã€ç¼©å°é»„è‰²æœç´¢åŒºé—´é•¿åº¦çš„æ“ä½œæ˜¯ï¼š`first = mid + 1`ï¼š\n\n![[z-oblib/z2-attachments/v2-f3e9d6b819f0c54851d5ed9f9d7db4eb_1440w.jpg]]\n\næ­¤æ—¶æœç´¢åŒºé—´é•¿åº¦ä¸º1ï¼Œåªå‰©æœ€åä¸€æ­¥ï¼Œç­”æ¡ˆè¦ä¹ˆæ˜¯firstè¦ä¹ˆæ˜¯last\n\nç°åœ¨æœç´¢åŒºé—´é•¿åº¦ç¼©çŸ­åˆ°1äº†ï¼å¯ä»¥è¿”å›`first`äº†å—ï¼Ÿä¸è¡Œï¼Œæˆ‘ä»¬æ£€æŸ¥è¿‡äº†çº¢åœˆå·¦è¾¹å’Œå³è¾¹ï¼Œå´æ²¡æœ‰æ£€æŸ¥çº¢åœˆæœ¬èº«ã€‚å¦‚æœçº¢åœˆæ˜¯2ï¼Œé‚£ä¹ˆç­”æ¡ˆåº”è¯¥æ˜¯ä¸Šå›¾çš„`last`æ‰å¯¹ã€‚\n\nä¹‹æ‰€ä»¥æ›´æ–°`first`æˆ–`last`çš„æ—¶å€™è¦æœ€å¤§é™åº¦ç¼©å°æœç´¢åŒºé—´ï¼ˆ`first`æ›´æ–°ä¸º`mid + 1`è€Œéå¼±ä¸€ç‚¹çš„`mid`ï¼Œ`last`æ›´æ–°ä¸º`mid`è€Œéå¼±ä¸€ç‚¹çš„`mid + 1`ï¼‰ï¼Œä¸»è¦è€ƒè™‘å¹¶ä¸æ˜¯è¿™ä¸ªæ•ˆç‡efficiencyï¼Œè€Œæ˜¯ä¸Šå›¾åŒºé—´é•¿åº¦ä¸º1çš„æƒ…å†µï¼æ­¤æ—¶`mid`å°±æ˜¯`first`ï¼Œ`mid + 1`å°±æ˜¯`last`ï¼Œäºæ˜¯å¼±ä¸€ç‚¹çš„æ›´æ–°ç­‰äºæ²¡æœ‰æ›´æ–°ï¼Œä¼šå¯¼è‡´æ­»å¾ªç¯ï¼\n\næœ€åä¸€æ­¥ï¼Œä¸Šå›¾ä¸­`array[mid] \u003e= 3`ï¼Œmidå±äºç´«è‰²ï¼Œäºæ˜¯`last`å·¦ç§»ä¸€ä½ï¼Œæœç´¢ç»“æŸï¼š\n\n![[z-oblib/z2-attachments/v2-bcc8f37438db16ca4952ff9542b46691_1440w.jpg]]\n\næœ€ååŒºé—´`[first, last)`ä¸ºç©ºï¼Œé’åŒºé—´å’Œç´«åŒºé—´éƒ½æœ€å¤§é™åº¦æ‰©å¼ äº†ã€‚æ‰€ä»¥ï¼Œæ ¹æ®ç´«åŒºé—´çš„å®šä¹‰`ä»»æ„å…ƒç´  \u003e= 3`ï¼Œå·²ç»é¥±å’Œçš„å®ƒï¼Œç¬¬ä¸€ä¸ªå…ƒç´ (è‹¥å­˜åœ¨)çš„ä½ç½®`last`å°±æ˜¯ç­”æ¡ˆï¼è‹¥æ²¡æœ‰æ»¡è¶³è¦æ±‚`x \u003e= 3`çš„å…ƒç´ ï¼Œé‚£ä¹ˆç´«åŒºé—´å°±æ˜¯ç©ºçš„ï¼Œåœç•™åœ¨åˆå§‹çŠ¶æ€`[last0, last0)`ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯`last0`ï¼Œå³åˆå§‹èŒƒå›´ä¹‹åçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¡¨ç¤ºâ€œä¸å­˜åœ¨â€ï¼Œæ— éœ€ç‰¹æ®Šå¤„ç†ï¼\n\nçš†å¤§æ¬¢å–œçš„æ˜¯ï¼Œ`first`ä¸`last`é‡åˆï¼Œæ‰€ä»¥å®Œå…¨ä¸éœ€è¦çº ç»“è¿”å›å“ªä¸ªï¼","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F":{"title":"å†’æ³¡æ’åº","content":"# å†’æ³¡æ’åº\n\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%8D%95%E8%B0%83%E6%A0%88":{"title":"å•è°ƒæ ˆ","content":"\n# å•è°ƒæ ˆ\n\nhttps://www.cnblogs.com/liang24/p/14200734.html\n#TODO\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%B9%B6%E6%9F%A5%E9%9B%86":{"title":"å¹¶æŸ¥é›†","content":"# å¹¶æŸ¥é›†\n\nå¹¶æŸ¥é›†å¸¸ç”¨æ¥è§£å†³è¿é€šæ€§çš„é—®é¢˜ï¼Œå³å°†ä¸€ä¸ªå›¾ä¸­è¿é€šçš„éƒ¨åˆ†åˆ’åˆ†å‡ºæ¥ã€‚å½“æˆ‘ä»¬åˆ¤æ–­å›¾ä¸­ä¸¤ä¸ªç‚¹ä¹‹é—´æ˜¯å¦å­˜åœ¨è·¯å¾„æ—¶ï¼Œå°±å¯ä»¥æ ¹æ®åˆ¤æ–­ä»–ä»¬æ˜¯å¦åœ¨ä¸€ä¸ªè¿é€šåŒºåŸŸã€‚\n\n## è§£é‡Š\n\n- å¹¶æŸ¥é›†å…¶å®å®Œæˆäº†ä¸¤ä¸ªæ“ä½œ\n    - æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ çš„æ ¹æ˜¯è°\n    - åˆå¹¶ä¸¤ä¸ªä¸åŒçš„æ ‘\n\n## ç”¨å¤„\n\n\n\n## å¹¶æŸ¥é›†åˆå§‹åŒ–\n\nå¹¶æŸ¥é›†ä¸€èˆ¬æ˜¯ç”¨ä¸€ä¸ªä¸€ç»´æ•°ç»„æ¥å­˜å‚¨çš„ï¼Œå…¶ä¸­pre[i]=iè¡¨ç¤ºè‡ªå·±å’Œè‡ªå·±æ˜¯è¿é€šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æ²¡æœ‰å¾€ç‚¹ä¹‹é—´æ·»åŠ è·¯å¾„ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220506195441.png]]\n\n## find() æ‰¾èŠ‚ç‚¹å¯¹åº”æ ¹èŠ‚ç‚¹\n\n```cpp\n// æ‰¾æŸä¸ªèŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹\nint find(int x)\n{\n    while (fams[x]!=x)  // å¦‚æœçˆ¶èŠ‚ç‚¹æŒ‡å‘è‡ªå·±ï¼Œåˆ™ä¸ºæ ¹ï¼Œå¦åˆ™ç»§ç»­æ‰¾\n        x = fams[x];\n    return x;\n}\n```\n\n### è·¯å¾„å‹ç¼©\n\næˆ‘ä»¬ä½¿ç”¨äº†å¤ªå¤šæ²¡ç”¨çš„ä¿¡æ¯ï¼Œæˆ‘çš„ç¥–å…ˆæ˜¯è°ä¸æˆ‘çˆ¶äº²æ˜¯è°æ²¡ä»€ä¹ˆå…³ç³»ï¼Œè¿™æ ·ä¸€å±‚ä¸€å±‚æ‰¾å¤ªæµªè´¹æ—¶é—´ï¼Œä¸å¦‚æˆ‘ç›´æ¥å½“ç¥–å…ˆçš„å„¿å­ï¼Œé—®ä¸€æ¬¡å°±å¯ä»¥å‡ºç»“æœäº†ã€‚ç”šè‡³ç¥–å…ˆæ˜¯è°éƒ½æ— æ‰€è°“ï¼Œåªè¦è¿™ä¸ªäººå¯ä»¥ä»£è¡¨æˆ‘ä»¬å®¶æ—å°±èƒ½å¾—åˆ°æƒ³è¦çš„æ•ˆæœã€‚**æŠŠåœ¨è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç›´æ¥è¿æ¥åˆ°æ ¹ä¸Š**ï¼Œè¿™å°±æ˜¯è·¯å¾„å‹ç¼©ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220508192509.png]]\n\n```cpp\nint find(int x) {\n  if (x != fa[x])  // x ä¸æ˜¯è‡ªèº«çš„çˆ¶äº²ï¼Œå³ x ä¸æ˜¯è¯¥é›†åˆçš„ä»£è¡¨\n    fa[x] = find(fa[x]);  // æŸ¥æ‰¾ x çš„ç¥–å…ˆç›´åˆ°æ‰¾åˆ°ä»£è¡¨ï¼Œäºæ˜¯é¡ºæ‰‹è·¯å¾„å‹ç¼©\n  return fa[x];\n}\n```\n\n## join/union() å‘å„å­æ ‘æ·»åŠ èŠ‚ç‚¹\n\nä¸»è¦æ˜¯ç”¨æ¥å¾€å­˜æ”¾å¹¶æŸ¥é›†çš„ä¸€ç»´æ•°ç»„ä¸­æ·»åŠ è·¯å¾„çš„ï¼Œå…ˆåˆ¤æ–­ä¸¤ä¸ªç‚¹ä¹‹é—´æ˜¯å¦è¿é€šï¼Œå¦‚æœè¿é€šå°±ä¸ç”¨æ·»åŠ è·¯å¾„äº†ï¼Œå¦‚æœä¸è¿é€šé‚£ä¹ˆå°†ä¸¤ä¸ªç‚¹çš„æ ¹èŠ‚ç‚¹è¿åœ¨ä¸€èµ·ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220506195527.png]]\n\n```cpp\nvoid my_union(int x, int y)\n{\n\t// æŸ¥è¯¢ä¸¤ä¸ªèŠ‚ç‚¹å„è‡ªçš„æ ¹èŠ‚ç‚¹\n    int rx = find(x);\n    int ry = find(y);\n    \n    // æ ¹èŠ‚ç‚¹ä¸åŒåˆ™å°†æ ¹èŠ‚ç‚¹è¿èµ·æ¥\n    if (rx!=ry)\n        fams[ry] = rx;\n}\n```\n\n### å¯å‘å¼åˆå¹¶/æŒ‰ç§©åˆå¹¶\n\nä¸€ä¸ªç¥–å…ˆçªç„¶æŠ–äº†ä¸ªæœºçµï¼šã€Œä½ ä»¬å®¶æ—äººæ¯”è¾ƒå°‘ï¼Œæ¬å®¶åˆ°æˆ‘ä»¬å®¶æ—é‡Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œæˆ‘ä»¬è¦æ˜¯æ¬è¿‡å»çš„è¯å¤ªè´¹äº‹äº†ã€‚ã€\n\nç”±äºéœ€è¦æˆ‘ä»¬æ”¯æŒçš„åªæœ‰é›†åˆçš„åˆå¹¶ã€æŸ¥è¯¢æ“ä½œï¼Œå½“æˆ‘ä»¬éœ€è¦å°†ä¸¤ä¸ªé›†åˆåˆäºŒä¸ºä¸€æ—¶ï¼Œæ— è®ºå°†å“ªä¸€ä¸ªé›†åˆè¿æ¥åˆ°å¦ä¸€ä¸ªé›†åˆçš„ä¸‹é¢ï¼Œéƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚ä½†ä¸åŒçš„è¿æ¥æ–¹æ³•å­˜åœ¨æ—¶é—´å¤æ‚åº¦çš„å·®å¼‚ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬å°†ä¸€æ£µç‚¹æ•°ä¸æ·±åº¦éƒ½è¾ƒå°çš„é›†åˆæ ‘è¿æ¥åˆ°ä¸€æ£µæ›´å¤§çš„é›†åˆæ ‘ä¸‹ï¼Œæ˜¾ç„¶ç›¸æ¯”äºå¦ä¸€ç§è¿æ¥æ–¹æ¡ˆï¼Œæ¥ä¸‹æ¥æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œçš„ç”¨æ—¶æ›´å°ï¼ˆä¹Ÿä¼šå¸¦æ¥æ›´ä¼˜çš„æœ€åæ—¶é—´å¤æ‚åº¦ï¼‰ã€‚\n\nå½“ç„¶ï¼Œæˆ‘ä»¬ä¸æ€»èƒ½é‡åˆ°æ°å¥½å¦‚ä¸Šæ‰€è¿°çš„é›†åˆâ€”â€”â€”â€”ç‚¹æ•°ä¸æ·±åº¦éƒ½æ›´å°ã€‚é‰´äºç‚¹æ•°ä¸æ·±åº¦è¿™ä¸¤ä¸ªç‰¹å¾éƒ½å¾ˆå®¹æ˜“ç»´æŠ¤ï¼Œæˆ‘ä»¬å¸¸å¸¸ä»ä¸­æ‹©ä¸€ï¼Œä½œä¸ºä¼°ä»·å‡½æ•°ã€‚è€Œæ— è®ºé€‰æ‹©å“ªä¸€ä¸ªï¼Œæ—¶é—´å¤æ‚åº¦éƒ½ä¸º$O(m\\log n)$ï¼Œå…·ä½“çš„è¯æ˜å¯å‚è§ References ä¸­å¼•ç”¨çš„è®ºæ–‡ã€‚\n\nåœ¨ç®—æ³•ç«èµ›çš„å®é™…ä»£ç ä¸­ï¼Œå³ä¾¿ä¸ä½¿ç”¨å¯å‘å¼åˆå¹¶ï¼Œä»£ç ä¹Ÿå¾€å¾€èƒ½å¤Ÿåœ¨è§„å®šæ—¶é—´å†…å®Œæˆä»»åŠ¡ã€‚åœ¨ Tarjan çš„è®ºæ–‡[1]ä¸­ï¼Œè¯æ˜äº†ä¸ä½¿ç”¨å¯å‘å¼åˆå¹¶ã€åªä½¿ç”¨è·¯å¾„å‹ç¼©çš„æœ€åæ—¶é—´å¤æ‚åº¦æ˜¯$O(m\\log n)$ã€‚åœ¨å§šæœŸæ™ºçš„è®ºæ–‡[2]ä¸­ï¼Œè¯æ˜äº†ä¸ä½¿ç”¨å¯å‘å¼åˆå¹¶ã€åªä½¿ç”¨è·¯å¾„å‹ç¼©ï¼Œåœ¨å¹³å‡æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯$O(m\\alpha(m,n))$ã€‚\n\nå¦‚æœåªä½¿ç”¨å¯å‘å¼åˆå¹¶ï¼Œè€Œä¸ä½¿ç”¨è·¯å¾„å‹ç¼©ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(m\\log n)$ã€‚ç”±äºè·¯å¾„å‹ç¼©å•æ¬¡åˆå¹¶å¯èƒ½é€ æˆå¤§é‡ä¿®æ”¹ï¼Œæœ‰æ—¶è·¯å¾„å‹ç¼©å¹¶ä¸é€‚åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨å¯æŒä¹…åŒ–å¹¶æŸ¥é›†ã€çº¿æ®µæ ‘åˆ†æ²» + å¹¶æŸ¥é›†ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨åªå¯å‘å¼åˆå¹¶çš„å¹¶æŸ¥é›†ã€‚\n\n```cpp\n// C++ Version\nstd::vector\u003cint\u003e size(N, 1);  // è®°å½•å¹¶åˆå§‹åŒ–å­æ ‘çš„å¤§å°ä¸º 1\n\nvoid unionSet(int x, int y) {\n  int xx = find(x), yy = find(y);\n  if (xx == yy) return;\n  if (size[xx] \u003e size[yy])  // ä¿è¯å°çš„åˆåˆ°å¤§çš„é‡Œ\n    swap(xx, yy);\n  fa[xx] = yy;\n  size[yy] += size[xx];\n}\n```\n\n## ä¾‹é¢˜\n\n## é¢˜ç›®æè¿°\n\næœ‰nä¸ªäººï¼Œç¼–å·ä¸º1,2,â€¦â€¦nï¼Œå¦å¤–è¿˜çŸ¥é“å­˜åœ¨Kä¸ªå…³ç³»ã€‚ä¸€ä¸ªå…³ç³»çš„è¡¨è¾¾ä¸ºäºŒå…ƒç»„ï¼ˆÎ±ï¼ŒÎ²ï¼‰å½¢å¼ï¼Œè¡¨ç¤ºÎ±ï¼ŒÎ²ä¸ºåŒä¸€å®¶åº­çš„æˆå‘˜ã€‚\nå½“nï¼Œkå’Œkä¸ªå…³ç³»ç»™å‡ºä¹‹åï¼Œæ±‚å‡ºå…¶ä¸­å…±æœ‰å¤šå°‘ä¸ªå®¶åº­ã€æœ€å¤§çš„å®¶åº­ä¸­æœ‰å¤šå°‘äººï¼Ÿ\nä¾‹å¦‚ï¼šnï¼6ï¼Œkï¼3ï¼Œä¸‰ä¸ªå…³ç³»ä¸ºï¼ˆ1,2ï¼‰ï¼Œ(1,3)ï¼Œ(4,5)\næ­¤æ—¶ï¼Œ6ä¸ªäººç»„æˆä¸‰ä¸ªå®¶åº­ï¼Œå³ï¼šï½›1,2,3ï½ä¸ºä¸€ä¸ªå®¶åº­ï¼Œï½›4,5ï½ä¸ºä¸€ä¸ªå®¶åº­ï¼Œï½›6ï½å•ç‹¬ä¸ºä¸€ä¸ªå®¶åº­ï¼Œç¬¬ä¸€ä¸ªå®¶åº­çš„äººæ•°ä¸ºæœ€å¤šã€‚\n\nInput\n\n```\nç¬¬ä¸€è¡Œä¸ºn,käºŒä¸ªæ•´æ•°ï¼ˆ1â‰¤nâ‰¤100ï¼Œ0\u003c=k\u003c=1000ï¼‰ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰ã€‚\næ¥ä¸‹æ¥çš„kè¡Œï¼Œæ¯è¡ŒäºŒä¸ªæ•´æ•°ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰è¡¨ç¤ºå…³ç³»ã€‚\n```\n\nOutput\n\näºŒä¸ªæ•´æ•°ï¼ˆåˆ†åˆ«è¡¨ç¤ºå®¶åº­ä¸ªæ•°å’Œæœ€å¤§å®¶åº­äººæ•°ï¼‰ã€‚\n\nSample Input\n\n```\n6 3\n1 2\n1 3\n4 5\n```\n\nSample Output\n\n```\n3 3\n```\n\nHINT\n\n```\n1â‰¤nâ‰¤100ï¼Œ0\u003c=k\u003c=1000\n```\n\n## ä»£ç \n\n```cpp\n#include \u003ciostream\u003e\nusing namespace std;\n\nint fams[101];  //æ ‡è®°æ ¹èŠ‚ç‚¹çš„æ•°ç»„ï¼Œä¸‹æ ‡ä¸ºå„¿å­ï¼Œå€¼ä¸ºå¯¹åº”çˆ¶äº²\nint peops[101] = {0};  // çˆ¶äº²æœ‰å‡ ä¸ªå„¿å­çš„è®¡æ•°æ•°ç»„\nint find(int x)\n{\n    while (fams[x]!=x)  // å¦‚æœçˆ¶äº²å€¼æŒ‡å‘è‡ªå·±ï¼Œåˆ™ä¸ºæ ¹ï¼Œå¦åˆ™ç»§ç»­æ‰¾\n        x = fams[x];\n    return x;\n}\n\nvoid my_union(int x, int y)\n{\n    int rx = find(x);\n    int ry = find(y);\n    if (rx!=ry)  // å¦‚æœä¸¤ä¸ªå„¿å­çš„æ ¹ä¸åŒï¼Œåˆ™æŠŠä¸€ä¸ªæ ¹åŠ åˆ°å¦ä¸€ä¸ªæ ¹çš„å„¿å­ä½ç½®\n        fams[ry] = rx;\n}\n\nint main (void)\n{\n    int n = 0, k = 0;\n    int fams_num = 0, max = 0;\n    cin\u003e\u003en\u003e\u003ek;\n    for (int i=0; i\u003c=n; i++)\n        fams[i] = i;\n    for (int i=0; i\u003ck; i++)\n    {\n        int p1 = 0, p2 = 0;\n        cin\u003e\u003ep1\u003e\u003ep2;  //è¯»å–è¦åˆå¹¶çš„ä¸¤ä¸ªå„¿å­\n        my_union(p1, p2);  // å°è¯•åˆå¹¶\n    }\n    for (int i=1; i\u003c=n; i++)\n        if (find(i)==i) fams_num++;  // éå†æœ‰å‡ ä¸ªçˆ¶äº²\n    for (int i=1; i\u003c=n; i++)\n        peops[find(i)]++;  // å°†å„å„¿å­å¯¹åº”çˆ¶äº²ä½ç½®++è®°å½•æ¯ä¸ªçˆ¶äº²å‡ ä¸ªå„¿å­\n    for (int i=1; i\u003c=n; i++)\n        if (peops[i]\u003e=max) max = peops[i];  // æ‰¾å„¿å­æœ€å¤šçš„çˆ¶äº²æœ‰å‡ ä¸ªå„¿å­\n\n    cout\u003c\u003cfams_num\u003c\u003c' '\u003c\u003cmax\u003c\u003cendl;\n}\n```\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%BF%AB%E9%80%9F%E5%8F%96%E6%A8%A1":{"title":"å¿«é€Ÿå–æ¨¡","content":"# å¿«é€Ÿå–æ¨¡\n\nä½¿ç”¨ä½è¿ç®—ä»£æ›¿å–æ¨¡ï¼š\nå‰æï¼šbä¸º2^n\n$a \\% b == a \\\u0026 (b - 1)$\n\n## åŸç†\n\n$X \\% 2^n = X \\\u0026 (2^n - 1)$\n\nå‡è®¾ n ä¸º 3ï¼Œåˆ™ 2^3 = 8ï¼Œè¡¨ç¤ºæˆ 2 è¿›åˆ¶å°±æ˜¯ 1000ã€‚2^3 - 1 = 7 ï¼Œå³ 0111ã€‚\n\næ­¤æ—¶ $X \\\u0026 (2^3 - 1)$ å°±ç›¸å½“äºå– X çš„ 2 è¿›åˆ¶çš„æœ€åä¸‰ä½æ•°ã€‚","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%BF%AB%E9%80%9F%E5%B9%82":{"title":"å¿«é€Ÿå¹‚","content":"# å¿«é€Ÿå¹‚\n\n\u003e äºŒåˆ†çš„æ€æƒ³ã€‚\n\u003e 1. æŒ‡æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶\n\u003e 2. äºŒè¿›åˆ¶æ ‘åˆå¯ä»¥æ‹†åˆ†æˆ1 2 4 8...çš„å’Œ\n\u003e 3. è€Œ1 2 4 8...ä¹‹é—´éƒ½æ˜¯ X2çš„å…³ç³»ï¼Œæ¯ä¸€ä½éƒ½æ˜¯å‰ä¸€ä½çš„2å€ï¼Œè®¡ç®—æ›´é«˜ä½åªç”¨x2\n\u003e 4. è¿™æ ·æ—¶é—´å¤æ‚åº¦å°±é™ä½äº†\n\n\u003e åŒæ ·çš„æ€è·¯å¯ä»¥å®ç°å¿«é€Ÿä¹˜ï¼Œåªè¦å°†éƒ¨åˆ†ä¹˜æ³•æ¢æˆåŠ æ³•å³å¯ã€‚\n\n## åŸºæœ¬æ–¹æ³•\n\n```java\npublic class FastPower {  \n\t// é€’å½’\n    static int byRecursion(int base, int exponent) {  \n        if (exponent==0)  // æŒ‡æ•°ä¸º0  \n            return 1;  \n        if (exponent % 2 == 1) {  // æŒ‡æ•°ä¸ºå¥‡æ•°  \n            return byRecursion(base, exponent-1) * base;  \n        }  \n        int tmp = byRecursion(base, exponent/2);  // æŒ‡æ•°ä¸ºå¶æ•°  \n        return tmp * tmp;  // é™¤ä»¥2åï¼Œæ—¶é—´å¤æ‚åº¦é™ä¸º log(n)ï¼Œä¸ç”¨é‡å¤ç®—ä¸¤æ¬¡byRecursion(base, exponent/2)äº†ã€‚  \n    }  \n\n\t// è¿­ä»£\n    static int byIteration(int base, int exponent) {  \n        int ans = 1;  \n        while(exponent\u003e0) {  \n            if ((exponent \u0026 1) == 1) {  // åˆ¤æ–­æŒ‡æ•°æœ€ä½ä½æ˜¯å¦ä¸º1ï¼Œæ˜¯çš„è¯åˆ™å°†å½“å‰  \n                ans *= base;  // åº•æ•°ç›¸ä¹˜æŒ‡æ•°ç›¸åŠ   \n            }  \n            base *= base;  // ä¸æ–­è®¡ç®—å‡º x^2 x^4 x*8 ... çš„ç»“æœ  \n            exponent \u003e\u003e= 1;  // ç§»ä½ç›¸å½“äºé™¤ä»¥2  \n        }  \n        return ans;  \n    }  \n  \n    public static void main(String[] args) {  \n        System.out.println(byRecursion(2, 5));  \n        System.out.println(byIteration(2, 6));  \n    }  \n}\n```\n\n## ç»“åˆå–ä½™\n\nç»ˆäºæ¥åˆ°äº†æœ€å…³é”®çš„åœ°æ–¹ï¼Œç»“åˆå¿«é€Ÿå¹‚ç®—æ³•åä¼šæœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ\n\nå…¶å®åœ¨æˆ‘ä»¬æ—¥å¸¸åšé¢˜ä¸­ï¼Œä½ ä¼šçœ‹åˆ°**è¾“å‡ºç»“æœå¯¹ xxxx å–æ¨¡**ã€‚è¿™ç§é¢˜ç›®å¯èƒ½æ˜¯æœ‰ä¸¤ç§è€ƒå¯Ÿæ–¹å‘:\n\n1. **åœ¨åŸç®—æ³•çš„åŸºç¡€ä¸Šï¼Œå¤šä¸€ä¸ªå–æ¨¡è¿ç®—æ¥è€ƒå¯Ÿä½ å¯¹å–æ¨¡è¿ç®—è§„å¾‹çš„æŒæ¡ï¼›**\n2. **å¤§æ•°æ®æ—¶æ•°æ®å¢é•¿å¤ªå¿«ï¼Œ64 ä½ç”šè‡³ 128 ä½çš„æ•´å½¢æ— æ³•è¡¨ç¤ºï¼›**\n\nå¯¹åº”çš„ï¼Œæˆ‘ä»¬å¿«é€Ÿå¹‚çš„é¢˜ç›®å°±æ˜¯è¿™æ ·ï¼Œå‡è®¾è®©ä½ æ±‚ a çš„ b æ¬¡æ–¹ï¼Œå½“ `a = 10` ä¸” `b = 20` æ¬¡æ–¹å°±å·²ç»è¶…è¿‡äº† 64 ä½ `Int` ç±»å‹çš„èŒƒå›´ï¼ˆ 2642^{64}264 æ¬¡æ–¹çº¦ç­‰äº `1.84 * 10^19`ï¼‰ã€‚\n\n```java\nstatic int byIteration(int base, int exponent) {  \n\tint ans = 1;  \n\twhile(exponent\u003e0) {  \n\t\tif ((exponent \u0026 1) == 1) {  // å…³æ³¨ç‚¹ 1\n\t\t\tans *= base;\n\t\t}  \n\t\tbase *= base;  // å…³æ³¨ç‚¹ 2\n\t\texponent \u003e\u003e= 1;  \n\t}  \n\treturn ans;  \n}\n```\n\næˆ‘ä»¬æ¥çœ‹å…³æ³¨ç‚¹ 1 å’Œå…³æ³¨ç‚¹ 2 ä¸¤ä¸ªåœ°æ–¹ï¼Œåˆ†æå¾—åˆ°è¿™ä¸¤ä¸ªç»“è®ºï¼š\n\n1. æˆ‘ä»¬çš„å¿«é€Ÿå¹‚ç®—æ³•å…¶å®å¹¶æ²¡æœ‰çœŸæ­£çš„ä¼˜åŒ–ä¹˜æ³•æ•ˆç‡ï¼Œè€Œæ˜¯é€šè¿‡äºŒè¿›åˆ¶æ‹†åˆ†ï¼Œä»è€Œä¼˜åŒ–äº†ä¹˜æ³•è¿ç®—çš„æ¬¡æ•°ï¼Œå…·ä½“çš„è¡¨ç°å°±æ˜¯ `base *= base` æ¥æ‰©å¤§ä¹˜å­çš„åŸºæ•°ï¼›\n2. åœ¨è®¡ç®— `res` çš„æ—¶å€™ï¼Œ`res *= base` ä»æ—§æ˜¯ä¸€ä¸ªç´¯ä¹˜çš„è¿‡ç¨‹ï¼Œå”¯ä¸€çš„å˜åŒ–å°±æ˜¯ `base` åœ¨ç”±äº `base *= base` é€æ¸å˜åŒ–ã€‚è¿™ä¸¤ä¸ªå¼å­ç»“åˆèµ·æ¥ï¼Œå…¶å®å°±æ˜¯ `res` ä¸æ–­çš„å»ç´¯ä¹˜å¤šä¸ª `base` ã€‚\n\næœ‰äº†è¿™ä¸¤ç‚¹åˆ†æï¼Œæˆ‘ä»¬å°±å¯ä»¥å¥—ç”¨æ±‚æ¨¡è¿ç®—è§„å¾‹äº†ã€‚\n\n(a * b) % p = (a % p * b % p) % p\n\næˆ‘ä»¬åœ¨æ‰€æœ‰ä¹˜æ³•è¡¨è¾¾å¼çš„åœ°æ–¹å¢åŠ æ±‚æ¨¡è¿ç®—ï¼Œå…¶å®åæ˜ å‡ºæ¥çš„ç»“æœå°±æ˜¯ `res` ä¸æ–­ç´¯ä¹˜æ—¶å€™æ¯ä¸€é¡¹éƒ½åšä¸€æ¬¡æ±‚æ¨¡è¿ç®—ã€‚\n\næœ‰ç€ä»¥ä¸Šæ€è·¯æˆ‘ä»¬æ¥ä¿®æ”¹ä»£ç ï¼š\n\n```java\nstatic int byIteration(int base, int exponent) {\n\tint m = 1000000007  // æ¨¡æ•°\n\tint ans = 1;  \n\twhile(exponent\u003e0) {  \n\t\tif ((exponent \u0026 1) == 1) {  // å…³æ³¨ç‚¹ 1\n\t\t\tans = (ans * base) % m;\n\t\t}  \n\t\tbase = (base * base) % m\n\t\texponent \u003e\u003e= 1;  \n\t}  \n\treturn ans;  \n}\n```","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F":{"title":"å¿«é€Ÿæ’åº","content":"\n# å¿«é€Ÿæ’åº\n\nå¿«é€Ÿæ’åºæ˜¯ [[3-è®¡ç®—æœºç§‘å­¦/0-æ•°æ®ç»“æ„ä¸ç®—æ³•/å†’æ³¡æ’åº|å†’æ³¡æ’åº]] çš„æ”¹è¿›ç‰ˆæœ¬ã€‚\n\nå¿«æ’çš„æ¯ä¸€è½®éƒ½æ˜¯è®²ä¸€ä¸ªåŸºæ•°å½’ä¸ºï¼Œæ‰€ä»¥å¤–å±‚è¦å¾ªç¯ n æ¬¡ï¼š\n![[z-oblib/z2-attachments/3.9-1.png]]\n\n## æ—¶é—´å¤æ‚åº¦\n\nå¿«é€Ÿæ’åºä¹‹æ‰€æ¯”è¾ƒå¿«ï¼Œå› ä¸ºç›¸æ¯”å†’æ³¡æ’åºï¼Œæ¯æ¬¡äº¤æ¢æ˜¯è·³è·ƒå¼çš„ã€‚\næ¯æ¬¡æ’åºçš„æ—¶å€™è®¾ç½®ä¸€ä¸ªåŸºå‡†ç‚¹ï¼Œå°†å°äºç­‰äºåŸºå‡†ç‚¹çš„æ•°å…¨éƒ¨æ”¾åˆ°åŸºå‡†ç‚¹çš„å·¦è¾¹ï¼Œå°†å¤§äºç­‰äºåŸºå‡†ç‚¹çš„æ•°å…¨éƒ¨æ”¾åˆ°åŸºå‡†ç‚¹çš„å³è¾¹ã€‚\nè¿™æ ·åœ¨æ¯æ¬¡äº¤æ¢çš„æ—¶å€™å°±ä¸ä¼šåƒå†’æ³¡æ’åºä¸€æ ·æ¯æ¬¡åªèƒ½åœ¨ç›¸é‚»çš„æ•°ä¹‹é—´è¿›è¡Œäº¤æ¢ï¼Œäº¤æ¢çš„è·ç¦»å°±å¤§çš„å¤šäº†ã€‚\nå½“ç„¶åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä»å¯èƒ½æ˜¯ç›¸é‚»çš„ä¸¤ä¸ªæ•°è¿›è¡Œäº†äº¤æ¢ã€‚\nå› æ­¤å¿«é€Ÿæ’åºçš„æœ€å·®æ—¶é—´å¤æ‚åº¦å’Œå†’æ³¡æ’åºæ˜¯ä¸€æ ·çš„éƒ½æ˜¯ **O(N2)**ï¼Œå®ƒçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º **O(NlogN)**ã€‚\nå…¶å®å¿«é€Ÿæ’åºæ˜¯åŸºäºä¸€ç§å«åšâ€œäºŒåˆ†â€çš„æ€æƒ³ã€‚\n\n## å®ç°\n\n### åŒæŒ‡é’ˆç‰ˆ\n\n```java\n// å¿«é€Ÿæ’åº  \npublic void quickSort(int left, int right) {  \n    // å­é›†åªæœ‰ä¸€ä¸ªå…ƒç´ æ—§æ²¡å¿…è¦ç»§ç»­åˆ‡åˆ†å¿«æ’äº†  \n    int lens = right - left + 1;  \n    if (lens\u003c2)  \n        return;  \n  \n    int base = num[left];  // å–åŒºé—´ç¬¬ä¸€ä¸ªå…ƒç´ ä½œbaseå€¼  \n    int curLeft = left;  // è®°å½•å½“å‰å·¦åŒºé—´ä¸‹æ ‡ï¼Œç”¨äºé€’å½’  \n    int curRight = right;  // è®°å½•å½“å‰å³åŒºé—´ä¸‹æ ‡ï¼Œç”¨äºé€’å½’  \n    boolean leftReady = false, rightReady = false;  // æ ‡å¿—æ˜¯å¦æ‰¾åˆ°éœ€è¦äº¤æ¢çš„æ•°  \n    while (left!=right) {  \n        if (!rightReady) {  \n            if (num[right]\u003ebase)  // å³è¾¹çš„æ•°éƒ½å¤§äºbase  \n                right--;  \n            else                rightReady = true;  \n        }  \n        if (!leftReady) {  \n            if (num[left]\u003cbase)  // å·¦è¾¹çš„æ•°éƒ½å°äºbase  \n                left++;  \n            else                leftReady = true;  \n        }  \n        // å·¦å³éƒ½æ‰¾åˆ°éœ€è¦äº¤æ¢çš„æ•°ï¼Œæ‰§è¡Œäº¤æ¢  \n        if (leftReady \u0026\u0026 rightReady) {  \n            swap(left, right);  \n            rightReady = false;  \n            leftReady = false;  \n        }  \n    }  \n    if (lens \u003e 2) {  \n        quickSort(curLeft, left);  \n        quickSort( left+1, curRight);  \n    }  \n}\n```\n\n### æ— è„‘å¾€å³æ”¾ç‰ˆ\n\n```java\n// å¿«æ’ç¬¬äºŒç§å†™æ³•  \npublic void quickSort2(int left, int right) {  \n    if (left\u003cright) {  \n        int pivot = partition(left, right);  \n        quickSort2(left, pivot-1);  \n        quickSort2(pivot+1, right);  \n    }  \n}  \n  \nint partition(int left, int right) {  \n    int pivot = left;  // åŸºå‡†å€¼  \n    // indexæŒ‡å‘æœ€æ–°ä¸ç¡®å®šä½\n    int index = pivot + 1;  \n    // leftéå†åˆ°rightï¼Œåªè¦æ˜¯å°äºnum[pivot]çš„éƒ½æ”¾åˆ°å³è¾¹å»  \n    // è¯¥æ–¹æ¡ˆäº¤æ¢æ—¶ä¸è€ƒè™‘é—¨å½“æˆ·å¯¹ï¼Œæ‰€ä»¥ä¸­é—´å¯èƒ½æœ‰å°äºnum[pivot]è¢«æš‚æ—¶æ”¾åˆ°å·¦è¾¹  \n    // ä½†å› ä¸ºæ˜¯å¯¹æ•´ä¸ªåŒºé—´è¿›è¡Œéå†ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä¼šæ¢åˆ°å³è¾¹å»  \n    // æ•ˆç‡æ²¡æœ‰åŒæŒ‡é’ˆé«˜ï¼Œä½†é€»è¾‘ç¨å¾®ç®€å•ä¸€ç‚¹  \n    for (int i = index; i \u003c= right; i++) {  \n        if (num[i]\u003cnum[pivot])  \n            swap(i, index++);  \n    }  \n    swap(pivot, index-1);  \n    return index-1;  \n}\n```\n\n\u003e index æ˜¯æŒ‡å°† index å·¦ä¾§çš„èŠ‚ç‚¹ä¸€ä¸ªä¸ªæ¢åˆ° index å¤´å¤„ï¼Œè¢« indexâ€œåä¸‹â€ï¼Œè¿™æ · index èº«ä½“é‡Œï¼ˆå·¦è¾¹ï¼‰éƒ½æ˜¯æ¯” pivot å°çš„å€¼ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84":{"title":"æœ€çŸ­è·¯å¾„","content":"# æœ€çŸ­è·¯å¾„\n\nè¯¥ç®—æ³•çš„å…³é”®æ˜¯ï¼š æ‰¾ä¸¤ä¸ªé›†åˆä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œåˆ†åˆ«æ˜¯å·²ç»ç¡®å®šçš„ç‚¹çš„é›†åˆ/æœªç¡®å®šç‚¹çš„é›†åˆã€‚ æ¯æ¬¡éƒ½åœ¨å·²ç¡®å®šç‚¹ä¸­çš„æœªçŸ¥é“è·¯æ‰¾æœ€çŸ­çš„è·¯ã€‚ å› æ­¤å¯ä»¥å°†è·¯éƒ½åŠ å…¥ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œè‡ªåŠ¨æ’åºã€‚\n\n```java\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.PriorityQueue;\n\npublic class Test {\n\n    public static void main(String[] args) {\n        Graph gp = testGraph();\n        Integer end = 4;  // ç›®çš„ç‚¹\n        Integer start = 0;  // èµ·ç‚¹\n        int length = 0;  // è·¯å¾„é•¿åº¦\n        List\u003cInteger\u003e path = new ArrayList\u003c\u003e();  // è·¯å¾„\n        //\u003cè¾¹æƒé‡ï¼Œå½“å‰ç‚¹ï¼Œå‰åºç‚¹\u003e\n        // æœªé€‰ç‚¹é›†åˆåˆ°å·²é€‰ç‚¹é›†åˆçš„æœ€çŸ­è·ç¦»ï¼Œé‡ç‚¹æ˜¯é›†åˆåˆ°é›†åˆçš„æœ€çŸ­è·ç¦»\n        // æ¯æ¬¡åŠ å…¥é›†åˆçš„æ˜¯ç›®å‰èƒ½èµ°çš„æœ€çŸ­çš„è¾¹ï¼Œè€Œä¸æ˜¯ç‚¹\n        // å¼ºè¡Œè®°å½•å½“å‰èŠ‚ç‚¹å’Œå‰åºèŠ‚ç‚¹å³å¯ä¿å­˜è·¯å¾„\n        // ä½¿ç”¨MyEntryæ˜¯ä¸ºäº†å…¼å®¹jdk8ï¼Œåç»­ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨Map.entryç›´æ¥è¿”å›Map.Entryå¯¹è±¡\n        PriorityQueue\u003cMyEntry\u003cInteger, MyEntry\u003cInteger, Integer\u003e\u003e\u003e pq = new PriorityQueue\u003c\u003e((e1, e2) -\u003e {return e1.getKey() - e2.getKey();});\n        // åˆå§‹åŒ–è®¿é—®è®°å½•\n        Map\u003cInteger, Boolean\u003e visited = new HashMap\u003c\u003e();\n        visited.put(0, false);\n        visited.put(1, false);\n        visited.put(2, false);\n        visited.put(3, false);\n        visited.put(4, false);\n        visited.put(5, false);\n\n        // é˜Ÿåˆ—ä¸­æ·»åŠ èµ·ç‚¹\n        pq.add(new MyEntry\u003cInteger, MyEntry\u003cInteger, Integer\u003e\u003e(gp.getWeight(start, start), new MyEntry\u003cInteger, Integer\u003e(gp.getValue(start), gp.getValue(start))));\n\n\n        while(!pq.isEmpty()) {\n            MyEntry\u003cInteger, MyEntry\u003cInteger, Integer\u003e\u003e tmp_entry = pq.poll();\n            if (visited.get(tmp_entry.getValue().getKey()) == true) {\n                continue;\n            }\n            visited.put(tmp_entry.getValue().getKey(), true);\n            path.add(tmp_entry.getValue().getKey());\n\n            // æ±‚è·¯å¾„é•¿åº¦ï¼Œåˆ°è¾¾ç›®çš„ç‚¹å°±åœæ­¢\n            if (tmp_entry.getValue().getKey()==end) {\n                length = tmp_entry.getKey();\n                break;\n            }\n            //éå†è¿™ä¸ªç‚¹çš„ç›¸é‚»èŠ‚ç‚¹å¹¶å…¥é˜Ÿ\n            for (int i=0; i\u003cgp.nodeNum(); i++) {\n                if (gp.getWeight(tmp_entry.getValue().getKey(), i)==0) {\n                    continue;\n                }\n                // ï¼ˆæ–°åŠ å…¥ç‚¹åˆ°èµ·å§‹ç‚¹çš„è·ç¦»ï¼Œï¼ˆæ–°åŠ å…¥ç‚¹å˜ä¸ºå½“å‰ç‚¹ï¼Œå½“å‰ç‚¹å˜ä¸ºå‰åºç‚¹ï¼‰ï¼‰\n                pq.add(new MyEntry\u003cInteger, MyEntry\u003cInteger, Integer\u003e\u003e(tmp_entry.getKey() + gp.getWeight(tmp_entry.getValue().getKey(), i),new MyEntry\u003cInteger, Integer\u003e(gp.getValue(i),tmp_entry.getValue().getKey())));\n            }\n        }\n\n        System.out.println(length);\n        for (Integer i : path) {\n            System.out.print(\" \"+i+\" \");\n        }\n    }\n\n    public static Graph testGraph() {\n\n        // **1--\u003e2 çš„æœ€çŸ­è·¯å¾„æ˜¯ï¼š7\n        // **1--\u003e3 çš„æœ€çŸ­è·¯å¾„æ˜¯ï¼š9\n        // **1--\u003e4 çš„æœ€çŸ­è·¯å¾„æ˜¯ï¼š20\n        // **1--\u003e5 çš„æœ€çŸ­è·¯å¾„æ˜¯ï¼š20\n        // **1--\u003e6 çš„æœ€çŸ­è·¯å¾„æ˜¯ï¼š11 \n        // 1--\u003e2--\u003e3--\u003e6--\u003e4--\u003e5--\u003e\n\n        int n = 6; // èŠ‚ç‚¹çš„ä¸ªæ•°\n        Integer vertexString[] = { 0,1,2,3,4,5 };\n        // åˆ›å»ºå›¾å¯¹è±¡\n        Graph gp = new Graph(n);\n        // å‘å›¾å¯¹è±¡æ·»åŠ èŠ‚ç‚¹\n        for (Integer value : vertexString) {\n            gp.addVer(value);\n        }\n        // æ·»åŠ è¾¹ä¿¡æ¯\n        gp.addNum(0, 1, 7);\n        gp.addNum(0, 2, 9);\n        gp.addNum(0, 5, 14);\n        gp.addNum(1, 0, 7);\n        gp.addNum(1, 2, 10);\n        gp.addNum(1, 3, 15);\n        gp.addNum(2, 0, 9);\n        gp.addNum(2, 1, 10);\n        gp.addNum(2, 3, 11);\n        gp.addNum(2, 5, 2);\n        gp.addNum(3, 1, 15);\n        gp.addNum(3, 2, 11);\n        gp.addNum(3, 4, 6);\n        gp.addNum(4, 3, 6);\n        gp.addNum(4, 5, 9);\n        gp.addNum(5, 0, 14);\n        gp.addNum(5, 2, 2);\n        gp.addNum(5, 4, 9);\n\n\n        // æ˜¾ç¤ºå›¾çš„çŸ©é˜µ\n        gp.show();\n        return gp;\n    }\n}\n\nclass Graph {\n    private ArrayList\u003cInteger\u003e vertexList; // å­˜æ”¾é¡¶ç‚¹é›†åˆ\n    private int[][] edges; // çŸ©é˜µ\n    private int num; // è¾¹çš„æ•°ç›®\n\n    public Graph(int n) {\n        edges = new int[n][n];\n        vertexList = new ArrayList\u003cInteger\u003e(n);\n        num = 0;\n    }\n\n    // æ’å…¥èŠ‚ç‚¹\n    public void addVer(int vertex) {\n        vertexList.add(vertex);\n    }\n\n    // æ·»åŠ è¾¹\n    public void addNum(int v1, int v2, int weight) {\n        // v1å’Œv2æŒ‡çš„æ˜¯ç‚¹çš„ä¸‹æ ‡ã€‚weightè¡¨ç¤ºæƒå€¼\n        edges[v1][v2] = weight;\n        edges[v2][v1] = weight;\n        num++;\n    }\n\n    // è¿”å›èŠ‚ç‚¹çš„ä¸ªæ•°\n    public int nodeNum() {\n        return vertexList.size();\n    }\n\n    // è¿”å›è¾¹ä¸€å…±æœ‰å¤šå°‘æ¡\n    public int edgeNum() {\n        return num;\n    }\n\n    // é€šè¿‡ç´¢å¼•è¿”å›å€¼\n    public Integer getValue(Integer i) {\n        return vertexList.get(i);\n    }\n\n    // è¿”å›v1å’Œv2çš„æƒå€¼\n    public int getWeight(int v1, int v2) {\n        return edges[v1][v2];\n    }\n\n    // æ˜¾ç¤ºå›¾å¯¹åº”çš„çŸ©é˜µ\n    public void show() {\n        for (int[] link : edges) {\n            System.err.println(Arrays.toString(link));\n        }\n    }\n}\n\n// ä¸ºäº†å…¼å®¹java8ï¼Œä¸èƒ½ç”¨Map.entry()\nfinal class MyEntry\u003cK, V\u003e implements Map.Entry\u003cK, V\u003e {\n    private final K key;\n    private V value;\n\n    public MyEntry(K key, V value) {\n        this.key = key;\n        this.value = value;\n    }\n\n    @Override\n    public K getKey() {\n        return key;\n    }\n\n    @Override\n    public V getValue() {\n        return value;\n    }\n\n    @Override\n    public V setValue(V value) {\n        V old = this.value;\n        this.value = value;\n        return old;\n    }\n}\n```","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E8%B7%B3%E8%A1%A8":{"title":"è·³è¡¨","content":"# è·³è¡¨\n\n\u003ehttps://www.jianshu.com/p/9d8296562806\n\né’ˆå¯¹é¡ºåºè¡¨ï¼Œä»¥æŸä¸€æ¦‚ç‡åœ¨å½“å‰æœ€ä¸Šå±‚é€‰ç‚¹æ„å»ºæ–°çš„ä¸€å±‚ï¼Œä»¥æ­¤æ„å»ºå¤šå±‚ç´¢å¼•ï¼Œç”±ä¸Šå¾€ä¸‹é€å±‚å¢åŠ ç¨ å¯†åº¦ã€‚\n\n![[z-oblib/z2-attachments/19063731-70b00aafa9f5b793.webp]]\n![[z-oblib/z2-attachments/19063731-4f4535e6d0959c32.webp]]\n![[z-oblib/z2-attachments/19063731-3852cc36af701f46.webp]]\n\n## ç´¢å¼•é«˜åº¦\n\nå‡è®¾åŸå§‹é“¾è¡¨æœ‰nä¸ªå…ƒç´ ï¼Œä»¥æ¯ä¸¤ä¸ªèŠ‚ç‚¹æŠ½å‡ºä¸€ä¸ªèŠ‚ç‚¹ä¸ºä¾‹ï¼Œå³æŸä¸ªç‚¹æœ‰1/2çš„æ¦‚ç‡è¢«é€‰ä¸­ï¼š\n- 1çº§ç´¢å¼•èŠ‚ç‚¹æ•°ï¼šn/2\n- 2çº§ç´¢å¼•èŠ‚ç‚¹æ•°ï¼šn/4\n- kçº§ç´¢å¼•èŠ‚ç‚¹æ•°ï¼š$n/2^k$\næ­¤ä¾‹ä¸­è·³è¡¨ç´¢å¼•é«˜åº¦ä¸ºï¼š$h = log_2{n} - 1$ï¼Œ-1æ˜¯å› ä¸ºæœ€ä¸Šå±‚ä¸ä¼šæœ‰èŠ‚ç‚¹ä¸ªæ•°ä¸º1çš„å±‚ï¼Œæ‰€ä»¥å‡æ‰1ã€‚\n\nå› æ­¤åŸå§‹é“¾è¡¨æœ‰nä¸ªå…ƒç´ ï¼Œå„çº§è·³è¡¨çš„é€‰å–æ¦‚ç‡ä¸ºpï¼Œåˆ™ç¬¬kå±‚çš„èŠ‚ç‚¹æ•° $m_k = m_{k-1} \\times 1/p$ï¼Œç´¢å¼•çš„é«˜åº¦ä¸º$h = log_{1/p}{n} - 1$ã€‚\n\n## æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦\n\næ—¶é—´å¤æ‚åº¦ = ç´¢å¼•çš„é«˜åº¦ * ç›¸é‚»ç´¢å¼•é—´åŒ…å«çš„ä¸‹å±‚ç´¢å¼•ä¸ªæ•°ï¼ˆå‡å€¼ï¼‰ã€‚\n\n![[z-oblib/z2-attachments/19063731-5ec10e6ae2c32587.webp]]\n\nå›¾ä¸­æ‰€ç¤ºï¼Œç°åœ¨åˆ°è¾¾ç¬¬ k çº§ç´¢å¼•ï¼Œæˆ‘ä»¬å‘ç°è¦æŸ¥æ‰¾çš„å…ƒç´  x æ¯” y å¤§æ¯” z å°ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä» y å¤„ä¸‹é™åˆ° k-1 çº§ç´¢å¼•ç»§ç»­æŸ¥æ‰¾ï¼Œk-1çº§ç´¢å¼•ä¸­æ¯” y å¤§æ¯” z å°çš„åªæœ‰ä¸€ä¸ª wï¼Œæ‰€ä»¥åœ¨ k-1 çº§ç´¢å¼•ä¸­ï¼Œæˆ‘ä»¬éå†çš„å…ƒç´ æœ€å¤šå°±æ˜¯ yã€wã€zï¼Œå‘ç° x æ¯” wå¤§æ¯” z å°ä¹‹åï¼Œå†ä¸‹é™åˆ° k-2 çº§ç´¢å¼•ã€‚æ‰€ä»¥ï¼Œk-2 çº§ç´¢å¼•æœ€å¤šéå†çš„å…ƒç´ ä¸º wã€uã€zã€‚å…¶å®æ¯çº§ç´¢å¼•éƒ½æ˜¯ç±»ä¼¼çš„é“ç†ï¼Œæ¯çº§ç´¢å¼•ä¸­éƒ½æ˜¯ä¸¤ä¸ªç»“ç‚¹æŠ½å‡ºä¸€ä¸ªç»“ç‚¹ä½œä¸ºä¸Šä¸€çº§ç´¢å¼•çš„ç»“ç‚¹ã€‚ ç°åœ¨æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šå½“æ¯çº§ç´¢å¼•éƒ½æ˜¯ä¸¤ä¸ªç»“ç‚¹æŠ½å‡ºä¸€ä¸ªç»“ç‚¹ä½œä¸ºä¸Šä¸€çº§ç´¢å¼•çš„ç»“ç‚¹æ—¶ï¼Œæ¯ä¸€å±‚æœ€å¤šéå†3ä¸ªç»“ç‚¹ã€‚\n\nå¯çŸ¥å„çº§ç´¢å¼•ä¸ªæ•°å’Œé€‰å–çš„æ¦‚ç‡ç›¸å…³ï¼Œä¸ªæ•°$q = 1/p + 1$ï¼Œ+1æ˜¯å› ä¸ºä¸Šå±‚ç´¢å¼•è¿›å…¥ä¸‹å±‚ç´¢å¼•æ—¶ï¼Œä¼šé‡å¤è®¿é—®ä¸€æ¬¡ï¼ˆä¾‹å­ä¸­çš„wï¼‰ã€‚\n\nåˆ™æ—¶é—´å¤æ‚åº¦ä¸º\n$$\n\\begin{split}\nO(h*q) \u0026= O((log_{1/p}{n} - 1) * (1/p + 1)) \\\\\n\u0026= O(log{n})\n\\end{split}\n$$\næœ€åç®€åŒ–çš„åŸå› æ˜¯ï¼Œåœ¨å…·ä½“å®ç°ä¸Špä¼šå–ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œä¾‹å¦‚å‰ä¾‹ä¸­çš„1/2ï¼Œæ‰€ä»¥è¿™é‡Œpæ˜¯å¸¸æ•°ï¼Œè€Œæ—¶é—´å¤æ‚åº¦è®¡ç®—æ—¶å¯ä»¥çœç•¥å¸¸æ•°ã€‚\n\nä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œpçš„å–å€¼ä¼šå½±å“å…·ä½“ç®—æ³•å®ç°çš„æ•ˆç‡ã€‚Redis çš„ zset ä¸­ SKIPLIST_P è®¾å®šçš„ 0.25ï¼Œå³éš”4ä¸ªå–ä¸€ä¸‹ã€‚\n\n#TODO \n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/B+%E6%A0%91":{"title":"B+æ ‘","content":"# B+æ ‘\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/OJ%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81":{"title":"OJå¸¸ç”¨ä»£ç ","content":"# OJå¸¸ç”¨ä»£ç \n\n## è¿›åˆ¶è½¬æ¢\n\n### ä»»æ„è¿›åˆ¶è½¬ 10 è¿›åˆ¶\n\nå¯¹äºä¸€ä¸ª p è¿›åˆ¶çš„ n ä½æ•° y æ¥è¯´, å…¶æ¯ä¸€ä½$a_n$çš„å…³ç³»æ˜¯\n$$\ny = a_1 \\times p^{n-1} + n_2 \\times p^{n-2} + ... + a_{n-1} \\times p^1 + a_n \\times p^0\n$$\n\nè½¬æ¢ä»£ç å®ç°:\n\n```c++\n#include \u003ciostream\u003e\nusing namespace std;\n\nint main(void)\n{\n\tint y = 0, a = 0, p = 1, result = 0;  // p åˆå§‹ä¸º1, ä»£è¡¨p^0 \n\tcin\u003e\u003ey\u003e\u003ea;\n\twhile (y!=0)\n\t{\n\t    result += (y % 10) * a;  // å°†æœ€ä½ä½ä¹˜ä»¥p^n å†ç´¯åŠ  \n\t    y /= 10;  //æ¯æ¬¡å»æ‰æœ€ä½ä½ \n\t    p *= a;  // æ¬¡æ•°é€’å¢ \n    }\n    cout\u003c\u003cresult;\n\treturn 0;\n}\n```\n\n### 10 è¿›åˆ¶è½¬ä»»æ„è¿›åˆ¶\n\né‡‡ç”¨é™¤åŸºå–ä½™æ³•:\n- åŸºä»£è¡¨ç›®æ ‡è¿›åˆ¶ q\n\næ­¥éª¤:\n1. æ¯æ¬¡å°†ä¸Šä¸€æ­¥çš„å•†é™¤ä»¥ç›®æ ‡è¿›åˆ¶ q\n1. ä½™æ•°æ’å…¥ç»“æœ, ä»å·¦å‘å³æ’å…¥\n1. ç›´åˆ°å•†ä¸º 0 , æ’å…¥æœ¬æ¬¡ä½™æ•°ååœæ­¢\n\nä»£ç å®ç°(10è¿›åˆ¶æ•° y è½¬åŒ–ä¸º q è¿›åˆ¶æ•°):\n\n```c++\n#include \u003ciostream\u003e\nusing namespace std;\n\nint main(void)\n{\n\tint y = 0, q = 0, p = 1;\n    string result; \n\tcin\u003e\u003ey\u003e\u003eq;\n\t/* å•†ä¸º0åˆ™åœæ­¢, ä¸ºäº†ä¿è¯æœ€åä¸€æ¬¡ä½™æ•°çš„å­˜å‚¨, ç”¨ do..while */\n\tdo\n\t{\n\t    string str = to_string(y%q);  // å¯¹ q å–ä½™ \n\t    result.insert(0, str);\n\t    y /= q;\n    } while(y!=0);\n    \n    cout\u003c\u003cresult;\n\treturn 0;\n}\n```\n\n### ä»»æ„è¿›åˆ¶é—´è½¬æ¢\n\nå°†ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ç»“åˆèµ·æ¥å³å¯.\n\n## æœ€å°å…¬å› æ•°\n\né€’å½’å®ç°:\n\n```c++\n#include \u003ciostream\u003e\nusing namespace std;\n\nint gcd(int a, int b)\n{\n    return b==0 ? a : gcd(b, a%b);\n}\n```\n\n## äº’è´¨\n\nåˆ¤æ–­ä¸¤ä¸ªæ•°äº’è´¨æˆ–è€…æ˜¯åˆ†æ•°çš„åŒ–ç®€:\n- å°±æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ•°çš„æœ€å°å…¬å› æ•°æ˜¯ä¸æ˜¯1\n\n## æœ€å°å…¬å€æ•°\n\na,bä¸¤æ•°æ±‚æœ€å°å…¬å€æ•°:\n1. å…ˆæ±‚å®ƒä»¬çš„æœ€å°å…¬å› æ•°gcd\n1. å†ç®— $a * b / gcd$\n\n\n## æ’åº\n\n### å†’æ³¡æ’åº\n\n[[3-è®¡ç®—æœºç§‘å­¦/0-æ•°æ®ç»“æ„ä¸ç®—æ³•/å†’æ³¡æ’åº|å†’æ³¡æ’åº]]\n\n1. æœ‰nä¸ªå…ƒç´ åˆ™å¾ªç¯n-1æ¬¡\n1. å¥½åƒä¼ æ‰‹å¸•ä¸€èˆ¬, æ¯æ¬¡å°†å½“å‰ä¸ºå›ºå®šæ•°ä¸­æœ€å¤§çš„é‚£ä¸ªä¼ åˆ°å³è¾¹å›ºå®š\n1. æœ€åä¸€æ­¥åˆ™æ˜¯æ ¹æ®æƒ…å†µäº¤æ¢ç¬¬ä¸€å’Œç¬¬äºŒä¸ªå…ƒç´ \n\n```c++\n#include \u003ciostream\u003e\nusing namespace std;\n\nint main(void)\n{\n\tint a[5] = {3,1,4,5,2};\n\tint n = sizeof(a) / 4;  // å…ƒç´ ä¸ªæ•° \n\tfor (int i=0; i\u003cn-1; i++)\n\t{\n\t    /* nä¸ªå…ƒç´ æ€»å…±æ‰§è¡Œn-1æ¬¡ */ \n\t    for (int j=0; j\u003cn-1-i; j++)\n\t    {\n\t        int temp;\n\t        /* å·¦å¤§äºå³åˆ™äº¤æ¢ä¸ºå‡åº */\n\t        /* æ¯ä¸€è½®éå†éƒ½æ˜¯å°†ä¸ºå›ºå®šä¸­æœ€å¤§çš„ç§»åˆ°å³è¾¹å›ºå®š */ \n\t        if (a[j]\u003ea[j+1])\n\t        {\n\t            temp = a[j];\n\t            a[j] = a[j+1];\n\t            a[j+1] = temp;\n            }\n        }\n    }\n    for (int i=0; i\u003cn; i++)\n    {\n        printf(\"%d \", a[i]);\n    }\n\treturn 0;\n}\n```\n\n### ç®€å•é€‰æ‹©æ’åº\n\n1. å¤–å›´å¾ªç¯ä¸ºå½“å‰æœ€å°äº¤æ¢ä½æ ‡è®°\n1. å†…å±‚å¾ªç¯æ¯æ¬¡æŠŠå½“å‰æœ€å°çš„å’Œæ ‡è®°ä½äº’æ¢\n    1. å†…å¾ªç¯ç»“æŸä¸€è½®æ—¶æ ‡è®°ä½ä¸ºå½“å‰å­åºåˆ—ä¸­æœ€å°çš„\n1. ä¾æ¬¡ä»å°åˆ°å¤§æ”¾åˆ°å·¦è¾¹\n\nå®ç°:\n\n```c++\n#include \u003ciostream\u003e\nusing namespace std;\n\nint main(void)\n{\n\tint a[5] = {3,1,4,5,2};\n\tint n = sizeof(a) / 4;  // å…ƒç´ ä¸ªæ•° \n\tfor (int i=0; i\u003cn; i++)  // å…¶å®i\u003cn-1å³å¯\n\t{\n\t    for (int j=i+1; j\u003cn; j++)\n\t    {\n\t        int temp;\n\t        if (a[i]\u003ea[j])\n            {\n                temp = a[i];\n                a[i] = a[j];\n                a[j] = temp;\n            }\n        }\n    }\n    for (int i=0; i\u003cn; i++)\n    {\n        printf(\"%d \", a[i]);\n    }\n\treturn 0;\n}\n```\n\n### ç›´æ¥æ’å…¥æ’åº\n\n1. å°†ç¬¬ä¸€ä¸ªå…ƒç´ å½“ä½œåˆå§‹æœ‰åºå­åºåˆ—, ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹éå†\n1. æš‚å­˜å½“å‰å…ƒç´ å€¼\n1. ä»å½“å‰éå†å…ƒç´ å¼€å§‹å¾€å›(å·¦)éå†, å¦‚æœæ¯”å½“å‰å…ƒç´ å°åˆ™å¾€å³æŒª\n    1. å¦‚æœæŒªåŠ¨, è‡ªç„¶ä¼šè¦†ç›–æ‰å½“å‰å…ƒç´ çš„å‘ä½\n1. å½“å‰å…ƒç´ æ’å…¥æŒªå‡ºçš„å‘ä½, å·¦ä¾§å­åºåˆ—è¿˜ä¿æŒæœ‰åº\n\nå®ç°:\n\n```c++\n#include \u003ciostream\u003e\nusing namespace std;\n\nint main(void)\n{\n\tint a[5] = {3,1,4,5,2};\n\tint n = sizeof(a) / 4;  // å…ƒç´ ä¸ªæ•° \n\tfor (int i=1; i\u003cn; i++)\n\t{\n\t    int temp = a[i];\n\t    int j = i;\n\t    /* å°†æ¯”å½“å‰æ•°å­—å¤§çš„æ•°å¾€å³ç§»åŠ¨ä¸€ä¸ª, ç»™å½“å‰æ•°ç•™å‡ºå‘ä½ */\n\t    /* å·¦ä¾§åºåˆ—ä¿æŒæœ‰åº, æ‰€ä»¥ä¸€æ—¦ä¸å¤§äºå½“å‰æ•°åˆ™ä¸ç”¨ç»§ç»­éå†äº† */ \n\t    for (; j\u003e=0 \u0026\u0026 a[j-1]\u003etemp; j--)\n        {\n            a[j] = a[j-1];\n        }\n        a[j] = temp;   // å½“å‰æ•°æ’å…¥å‘ä½ \n    }\n    for (int i=0; i\u003cn; i++)\n    {\n        printf(\"%d \", a[i]);\n    }\n\treturn 0;\n}\n```\n\n### 2è·¯å½’å¹¶æ’åº\n\n#### é€’å½’ç‰ˆ\n\n```c++\n#include \u003ciostream\u003e\nusing namespace std;\n\nvoid merge(int a[], int l1, int r1, int l2, int r2);\nvoid sort_merge(int a[], int left, int right);\n\nint main(void)\n{\n\tint a[6] = {5,2,4,1,3,6};\n\tfor (int i=0; i\u003c6; i++)\n\t{\n\t    printf(\"%d \", a[i]);\n    }\n\tprintf(\"\\n\");\n\tsort_merge(a, 0, 5);\n\tfor (int i=0; i\u003c6; i++)\n\t{\n\t    printf(\"%d \", a[i]);\n    }\n\treturn 0;\n}\n\nvoid merge(int a[], int l1, int r1, int l2, int r2)\n{\n    int i = l1, j = l2;\n    int temp[100] = {0};  // ä¸´æ—¶æ•°ç»„ \n    int index = 0;\n    /* ä¸¤ä¸ªæ•°ç»„åŒæ—¶éå†, ä¸€ä¸ªéå†å®Œåˆ™åœæ­¢ */ \n    for (; i\u003c=r1 \u0026\u0026 j\u003c=r2;)\n    {\n        if (a[i]\u003ca[j])\n            temp[index++] = a[i++];\n        else\n            temp[index++] = a[j++];\n    }\n    /* ä¸¤ä¸ªæ•°ç»„ä¸ç­‰é•¿åˆ™è¾“å‡ºå‰©ä½™å…ƒç´ (å¿…å®šæœ‰åº) */ \n    while(i\u003c=r1) temp[index++] = a[i++];\n    while(j\u003c=r2) temp[index++] = a[j++];\n    /* å°†ç»“æœèµ‹å›åŸæ•°ç»„ */ \n    for (int i=0; i\u003cindex; i++)\n        a[l1+i] = temp[i];\n}\n\nvoid sort_merge(int a[], int left, int right)\n{\n    if (left\u003cright)  // é€’å½’åˆ°è¢«æ‹†åˆ†æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶åœæ­¢\n    {\n        int mid = (left + right) / 2;  // ä»ä¸­é—´æ‹†åˆ†æ•°ç»„ \n        /* å…ˆç®—å®Œå·¦åŠè¾¹, å†ç®—å³åŠè¾¹ */ \n        sort_merge(a, left, mid);    // å¯¹å·¦åŠè¾¹æ•°ç»„é€’å½’ \n        sort_merge(a, mid+1, right);  // å¯¹å³åŠè¾¹æ•°ç»„é€’å½’ \n        merge(a, left, mid, mid+1, right);  // æœ‰åºå½’å¹¶ä¸¤ä¸ªæ•°ç»„ \n    }\n}\n```\n\n#### å¾ªç¯ç‰ˆ\n\n```c++\n#include \u003ciostream\u003e\n#include \u003calgorithm\u003e\nusing namespace std;\n\nvoid merge(int a[], int l1, int r1, int l2, int r2);\n\nint main(void)\n{\n\tint a[5] = {5,2,4,1,3};\n\tint len = sizeof(a) / 4;\n\tfor (int i=0; i\u003clen; i++)\n\t{\n\t    printf(\"%d \", a[i]);\n    }\n\tprintf(\"\\n\");\n\t/* stepç›¸å½“äºå½’å¹¶çš„æ•°ç»„å¤§å°, ä»2å¼€å§‹, 2çš„æŒ‡æ•°å¢é•¿ */\n\t/* step/2\u003clen æŒ‡å¿…é¡»è¦æœ‰ä¸€ç»„æ•°ç»„å®Œå…¨ä½äºæ€»æ•°ç»„å†…,å¹¶ä¸”è‡³å°‘è¿˜è¦ç•™ç»™ç¬¬äºŒæ­¥1ä¸ªå…ƒç´ (ä¸å–ç­‰å·) */\n\t/* ä¾‹å¦‚stepå¢é•¿åˆ°4æ—¶, åˆ†ç»„ä¸º{1,2,3,4},{5}, ç¬¦åˆè¦æ±‚ä½†ä¸èƒ½ç»§ç»­å¢é•¿ */ \n\tfor (int step=2; step/2\u003clen; step*=2)\n\t{\n\t    /* å¯¹æ¯ä¸ªå­ç»„å½’å¹¶ */ \n\t    for (int i=0; i\u003c=len; i+=step)\n\t    {\n\t        /* å½“å‰æ­¥å­ä¸€åˆ†ä¸ºäºŒ, å·¦å³å½’å¹¶ */\n\t        int mid = i + step / 2 - 1;\n\t        /* æ³¨æ„åˆ¤æ–­ä¸è¦è¶Šç•Œ */\n\t        merge(a,i, mid, mid+1, min(i+step, len));  // sort() å‰é—­åå¼€ \n        }\n    }\n\t\n\tfor (int i=0; i\u003clen; i++)\n\t{\n\t    printf(\"%d \", a[i]);\n    }\n\treturn 0;\n}\n\nvoid merge(int a[], int l1, int r1, int l2, int r2)\n{\n    int i = l1, j = l2;\n    int temp[100] = {0};  // ä¸´æ—¶æ•°ç»„ \n    int index = 0;\n    /* ä¸¤ä¸ªæ•°ç»„åŒæ—¶éå†, ä¸€ä¸ªéå†å®Œåˆ™åœæ­¢ */ \n    for (; i\u003c=r1 \u0026\u0026 j\u003c=r2;)\n    {\n        if (a[i]\u003ca[j])\n            temp[index++] = a[i++];\n        else\n            temp[index++] = a[j++];\n    }\n    /* ä¸¤ä¸ªæ•°ç»„ä¸ç­‰é•¿åˆ™è¾“å‡ºå‰©ä½™å…ƒç´ (å¿…å®šæœ‰åº) */ \n    while(i\u003c=r1) temp[index++] = a[i++];\n    while(j\u003c=r2) temp[index++] = a[j++];\n    /* å°†ç»“æœèµ‹å›åŸæ•°ç»„ */ \n    for (int i=0; i\u003cindex; i++)\n        a[l1+i] = temp[i];\n}\n```\n\n#### å¾ªç¯æ¨¡æ‹Ÿç‰ˆ\n\n```c++\n#include \u003ciostream\u003e\n#include \u003calgorithm\u003e\nusing namespace std;\n\nint main(void)\n{\n\tint a[5] = {5,2,4,1,3};\n\tint len = sizeof(a) / 4;\n\tfor (int i=0; i\u003clen; i++)\n\t{\n\t    printf(\"%d \", a[i]);\n    }\n\tprintf(\"\\n\");\n\t/* stepç›¸å½“äºå½’å¹¶çš„æ•°ç»„å¤§å°, ä»2å¼€å§‹, 2çš„æŒ‡æ•°å¢é•¿ */\n\t/* step/2\u003clen æŒ‡å¿…é¡»è¦æœ‰ä¸€ç»„æ•°ç»„å®Œå…¨ä½äºæ€»æ•°ç»„å†…,å¹¶ä¸”è‡³å°‘è¿˜è¦ç•™ç»™ç¬¬äºŒæ­¥1ä¸ªå…ƒç´ (ä¸å–ç­‰å·) */\n\t/* ä¾‹å¦‚stepå¢é•¿åˆ°4æ—¶, åˆ†ç»„ä¸º{1,2,3,4},{5}, ç¬¦åˆè¦æ±‚ä½†ä¸èƒ½ç»§ç»­å¢é•¿ */ \n\tfor (int step=2; step/2\u003clen; step*=2)\n\t{\n\t    /* å¯¹æ¯ä¸ªå­ç»„æ’åº, ç›¸å½“äºè¿›è¡Œä¸€æ¬¡ä¸‹çº§å½’å¹¶ç»“æœ */ \n\t    for (int i=0; i\u003c=len; i+=step)\n\t    { \n\t        /* æ³¨æ„åˆ¤æ–­ä¸è¦è¶Šç•Œ */\n\t        if (i+step-1\u003c=len-1)\n\t           sort(a+i, a+i+step);  // sort() å‰é—­åå¼€ \n\t        else sort(a+i, a+len);\n        }\n    }\n\t\n\tfor (int i=0; i\u003clen; i++)\n\t{\n\t    printf(\"%d \", a[i]);\n    }\n\treturn 0;\n}\n```\n\n### å¿«é€Ÿæ’åº\n\n[[3-è®¡ç®—æœºç§‘å­¦/0-æ•°æ®ç»“æ„ä¸ç®—æ³•/å¿«é€Ÿæ’åº|å¿«é€Ÿæ’åº]]\n\n## sort()\n\n### cmp() å‡½æ•°æ„é€ \n\n```c++\nbool cmp(a,b)\n{\n    return a\u003eb; // é™åº\n    return a\u003cb  // å‡åº\n}\n```\n\nå¯ä»¥ä½¿ç”¨ `else if` å®ç°å¤šæ¡ä»¶æ’åº.\n\n## è´ªå¿ƒç®—æ³•\n\n## two pointers\n\næœ‰åºåºåˆ—çš„ä¸¤å±‚å¾ªç¯, å¯ä»¥æƒ³åŠæ³•å˜æˆå·¦å³ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨, å‡å°æ—¶é—´å¤æ‚åº¦.\n\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/kmp":{"title":"kmp","content":"# kmp\n\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/0-%E5%9F%BA%E7%A1%80%E5%85%83%E5%99%A8%E4%BB%B6/%E6%99%B6%E4%BD%93%E7%AE%A1":{"title":"æ™¶ä½“ç®¡","content":"# æ™¶ä½“ç®¡\n\næ‰€æœ‰å¯ä»¥é€šè¿‡ä¸€ä¸ªç”µæµæˆ–ç”µå‹æ§åˆ¶å¦ä¸€ä¸ªç”µæµæˆ–ç”µå‹çš„å™¨ä»¶ã€‚","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/0-%E5%9F%BA%E7%A1%80%E5%85%83%E5%99%A8%E4%BB%B6/%E9%94%81%E5%AD%98%E5%99%A8":{"title":"é”å­˜å™¨","content":"# é”å­˜å™¨\n\næˆ‘ä»¬å°†èƒ½å¤Ÿå­˜å‚¨ä¸€ä¸ªçŠ¶æ€çš„ç”µè·¯å«åš**é”å­˜å™¨**ã€‚è®¾æƒ³ä¸€ä¸ªç”µè·¯ï¼Œåˆå§‹è¾“å…¥ä¸º0ï¼Œè¾“å‡ºä¸º0ï¼›ç„¶åè¾“å…¥ä¸º1ï¼Œè¾“å‡ºå˜ä¸º1ï¼ˆçŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼‰ã€‚å¯¹äºè¿„ä»Šä¸ºæ­¢æ‰€æœ‰çš„ç”µè·¯ï¼Œæˆ‘ä»¬éƒ½èƒ½ä¿è¯å½“è¾“å…¥å›åˆ°0æ—¶ï¼Œè¾“å‡ºä¹Ÿä¼šåŒæ—¶å½’0ï¼›ä½†è¿™ä¸ªç”µè·¯ä¸åŒï¼Œå®ƒä¿æŒåœ¨äº†1ï¼Œä¹Ÿå°±æ˜¯çŠ¶æ€æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè€Œæ˜¯è¢«å­˜å‚¨äº†ä¸‹æ¥ã€‚æ­¤æ—¶ï¼Œè¿™ç§ç”µè·¯ä¾¿å¯ä»¥è¢«å«åšé”å­˜å™¨ã€‚\n\nä¸ºäº†è®©ç”µè·¯æ‹¥æœ‰è‡ªå·±çš„â€çŠ¶æ€â€œï¼Œå¿…é¡»è¦æœ‰æŸç§â€åé¦ˆâ€œæœºåˆ¶ï¼Œå°†è¾“å‡ºè¾“å…¥å½¢æˆä¸€ä¸ªé—­ç¯ã€‚\n\n## åˆ†ç±»\n\n- [[3-è®¡ç®—æœºç§‘å­¦/1-è®¡ç®—æœºç¡¬ä»¶/0-åŸºç¡€å…ƒå™¨ä»¶/RSé”å­˜å™¨|RSé”å­˜å™¨]]\n- ","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/0-%E5%9F%BA%E7%A1%80%E5%85%83%E5%99%A8%E4%BB%B6/CMOS":{"title":"CMOS","content":"# CMOS\n\nCMOSæ˜¯Complementary Metal Oxide Semiconductorï¼ˆäº’è¡¥é‡‘å±æ°§åŒ–ç‰©åŠå¯¼ä½“ï¼‰çš„ç¼©å†™ã€‚\n\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/0-%E5%9F%BA%E7%A1%80%E5%85%83%E5%99%A8%E4%BB%B6/RS%E9%94%81%E5%AD%98%E5%99%A8":{"title":"RSé”å­˜å™¨","content":"# RSé”å­˜å™¨\n\nRSé”å­˜å™¨æ˜¯ä¸€ä¸¤è¾“å…¥ã€ä¸¤è¾“å‡ºçš„ç”µè·¯ï¼Œå…¶ç”µè·¯å¦‚ä¸‹å›¾aï¼Œå…¶æœ‰ä¸¤ä¸ªäº’ç›¸äº¤å‰åé¦ˆç›¸è¿çš„ä¸¤ä¸ªä¸éé—¨æ„æˆï¼Œå…¶ä¸¤ä¸ªè¾“å‡ºä¸ºä¸¤ä¸ªç›¸åçš„è¾“å‡ºï¼ˆæˆ–ç§°ä¸ºäº’è¡¥è¾“å‡ºï¼‰ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220904151011.png]]","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/0-%E5%9F%BA%E7%A1%80%E5%85%83%E5%99%A8%E4%BB%B6/SRAM":{"title":"SRAM","content":"# SRAM\n\né™æ€éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆStatic Random-Access Memoryï¼ŒSRAMï¼‰æ˜¯éšæœºå­˜å–å­˜å‚¨å™¨çš„ä¸€ç§ã€‚æ‰€è°“çš„â€œé™æ€â€ï¼Œæ˜¯æŒ‡è¿™ç§å­˜å‚¨å™¨åªè¦ä¿æŒé€šç”µï¼Œé‡Œé¢å‚¨å­˜çš„æ•°æ®å°±å¯ä»¥æ’å¸¸ä¿æŒã€‚ç›¸å¯¹ä¹‹ä¸‹ï¼ŒåŠ¨æ€éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆDRAMï¼‰é‡Œé¢æ‰€å‚¨å­˜çš„æ•°æ®å°±éœ€è¦å‘¨æœŸæ€§åœ°æ›´æ–°ã€‚ç„¶è€Œï¼Œå½“ç”µåŠ›ä¾›åº”åœæ­¢æ—¶ï¼ŒSRAMå‚¨å­˜çš„æ•°æ®è¿˜æ˜¯ä¼šæ¶ˆå¤±ï¼ˆè¢«ç§°ä¸ºvolatile memoryï¼‰ï¼Œè¿™ä¸åœ¨æ–­ç”µåè¿˜èƒ½å‚¨å­˜èµ„æ–™çš„ROMæˆ–é—ªå­˜æ˜¯ä¸åŒçš„ã€‚\n\n\n## å­˜å‚¨ç»“æ„\n\n![[z-oblib/z2-attachments/Pasted image 20220904150755.png]]\n\n6T:æŒ‡çš„æ˜¯ç”±å…­ä¸ªæ™¶ä½“ç®¡ç»„æˆï¼Œå¦‚å›¾ä¸­çš„M1ã€M2ã€ M3ã€M4ã€M5ã€M6. SRAMä¸­çš„æ¯ä¸€bitå­˜å‚¨åœ¨ç”±4ä¸ªåœºæ•ˆåº”ç®¡(M1, M2, M3, M4)æ„æˆä¸¤ä¸ªäº¤å‰è€¦åˆçš„åç›¸å™¨ä¸­ã€‚å¦å¤–ä¸¤ä¸ªåœºæ•ˆåº”ç®¡(M5, M6)æ˜¯å­˜å‚¨åŸºæœ¬å•å…ƒåˆ°ç”¨äºè¯»å†™çš„ä½çº¿(BitLine)çš„æ§åˆ¶å¼€å…³ã€‚\n\n6Tç”µè·¯ç­‰ä»·äºSRé”å­˜å™¨ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220904150813.png]]\n\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/mcu/PUF":{"title":"PUF","content":"# PUF\n\n## ç‰¹ç‚¹\n\n- å”¯ä¸€æ€§ï¼šæ¯ä¸€ä¸ªèŠ¯ç‰‡éƒ½æ˜¯éšæœºåˆ†å¸ƒçš„ã€å”¯ä¸€çš„ã€‚\n- é˜²å…‹éš†æ€§ï¼šèŠ¯ç‰‡æœ¬èº«å°±æ˜¯åœ¨èŠ¯ç‰‡åˆ¶é€ è¿‡ç¨‹ä¸­ç”±äºä¸ç¡®å®šå› ç´ æå–å‡ºæ¥çš„ï¼Œæ— æ³•é‡æ–°å¤åˆ¶ç›¸åŒçš„PUFå€¼ã€‚è¯¯å·®æœ¬å°±æ˜¯ä¸å¯æ§å› ç´ ï¼Œå› æ­¤ä¸èƒ½é€†å‘å»ç”ŸæˆæŒ‡å®šçš„â€œè¯¯å·®â€ã€‚\n- ä¸å¯é¢„æµ‹æ€§ï¼šç”±äºèŠ¯ç‰‡åœ¨åˆ¶é€ å‡ºæ¥ä¹‹å‰ï¼Œæ²¡æœ‰åŠæ³•æ¥é¢„æµ‹ã€‚\n- é˜²ç¯¡æ”¹æ€§ï¼šèŠ¯ç‰‡æœ¬èº«PUFå€¼æ— æ³•å®šä½ä¿®æ”¹ã€‚\n- æ— éœ€å­˜å‚¨ï¼šæ¯æ¬¡èŠ¯ç‰‡å¯åŠ¨åªéœ€è¦åœ¨ç”µè·¯ç»“æ„ä¸­æå–ï¼Œæ— éœ€å­˜å‚¨å™¨ä»¶æ¥å­˜å‚¨ã€‚\n\n## å®ç°åˆ†ç±»\n\n![[z-oblib/z2-attachments/Pasted image 20220904144719.png]]\n\n- SRAM PUF\n\tSRAM PUFåˆ©ç”¨[[3-è®¡ç®—æœºç§‘å­¦/1-è®¡ç®—æœºç¡¬ä»¶/0-åŸºç¡€å…ƒå™¨ä»¶/SRAM|SRAM]] Cellï¼Œé¦–å°¾ç›¸æ¥çš„åç›¸å™¨ï¼Œåœ¨åˆ¶é€ è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶ç”µè·¯æ¶æ„å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯ç”µè·¯é©±åŠ¨èƒ½åŠ›æœ‰å¼ºå¼±ä¹‹åˆ†ï¼Œå¯¼è‡´SRAMåœ¨ä¸Šç”µæ—¶çš„Cellä¸Š0,1çš„åˆ†å¸ƒæ˜¯éšæœºåˆ†å¸ƒçš„ï¼Œå› æ­¤ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹å¾å¯ä»¥æå–å‡ºPUF\n- ä»²è£PUF\n\tä»²è£PUFï¼ŒåŒä¸€ä¸ªä¿¡å·ä»èµ·ç‚¹åˆ°ç»ˆç‚¹æ‰€ç”¨çš„æ—¶é—´ï¼ˆå»¶è¿Ÿï¼‰ï¼Œåœ¨åˆ¶é€ è¿‡ç¨‹ä¸­ä¼šå­˜åœ¨è¯¯å·®ã€‚\n- RO PUFï¼ˆç¯å½¢æŒ¯è¡å™¨ï¼‰\n\tç¯å½¢æŒ¯è¡å™¨PUFï¼Œåˆ©ç”¨ç¯å½¢æŒ¯è¡å™¨ç”µè·¯ï¼Œåœ¨ä¸åŒèŠ¯ç‰‡åˆ¶é€ å‡ºæ¥ä¹‹åï¼Œé¢‘ç‡äº§ç”Ÿä¹Ÿä¼šå­˜åœ¨è¯¯å·®\n- VIA PUF\n\tå®é™…è®¾è®¡ä¸­ï¼ŒVIAå­˜åœ¨è®¾è®¡è§„åˆ™ï¼Œåˆ©ç”¨è®¾è®¡è§„åˆ™ï¼Œè®¾è®¡ä»å°åˆ°å¤§çš„å­”æ´ï¼Œæ ¹æ®å·¥è‰ºçš„ç‰¹æ€§ï¼Œæ¥æå–å‡ºVIA PUF\n\n## SRAMå®ç°\n\n### å·¥ä½œåŸç†\n\n\u003e [[3-è®¡ç®—æœºç§‘å­¦/1-è®¡ç®—æœºç¡¬ä»¶/0-åŸºç¡€å…ƒå™¨ä»¶/é”å­˜å™¨|é”å­˜å™¨]]åœ¨åˆå§‹æ— è¾“å…¥æƒ…å†µä¸‹ï¼Œè¾“å‡ºä¼šå› ç”Ÿæˆå·¥ä¸šçš„ä¸å¯æ§è¯¯å·®äº§ç”Ÿä¸åŒçš„åˆå§‹è¾“å‡ºå€¼ã€‚\n\nåˆ©ç”¨åŠå¯¼ä½“ç‰©ç†ç”Ÿäº§è¿‡ç¨‹ä¸­è‡ªç„¶å‘ç”Ÿçš„æ·±äºšå¾®ç±³å˜åŒ–ï¼Œå¹¶èµ‹äºˆæ¯ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/1-è®¡ç®—æœºç¡¬ä»¶/0-åŸºç¡€å…ƒå™¨ä»¶/æ™¶ä½“ç®¡|æ™¶ä½“ç®¡]]è½»å¾®çš„éšæœºçš„ç”µç‰¹æ€§ã€‚è¿™äº›ç‹¬ç‰¹çš„ç‰¹æ€§æ„æˆäº†èŠ¯ç‰‡ç‹¬ç‰¹èº«ä»½çš„åŸºç¡€ã€‚\n\nåŸºäº SRAM çš„ PUF è¯„ä¼°çš„æ˜¯æ ‡å‡†çš„ 6Tï¼ˆ6 ä¸ªæ™¶ä½“ç®¡ï¼‰ SRAM é˜µåˆ—çš„ä¸Šç”µæ¨¡å¼ã€‚é˜µåˆ—ä¸­çš„æ¯ä¸ª SRAM å•å…ƒç”±ä¸¤ä¸ªç†è®ºå’Œè®¾è®¡ä¸ŠåŒ¹é…çš„ CMOS åå‘å™¨ç»„æˆï¼Œå®ƒä»¬æ˜¯äº¤å‰è€¦åˆçš„ï¼ˆå‚è§å›¾ 2ï¼‰ã€‚ä½†æ˜¯åœ¨èŠ¯ç‰‡åˆ¶é€ æ—¶ï¼Œç”±äºåœ¨ç‰©ç†ä¸Šæ— æ³•æ§åˆ¶çš„[[3-è®¡ç®—æœºç§‘å­¦/1-è®¡ç®—æœºç¡¬ä»¶/0-åŸºç¡€å…ƒå™¨ä»¶/CMOS|CMOS]] å·¥è‰ºå¼•å…¥æ·±äºšå¾®ç±³å˜åŒ–ï¼Œä½¿æ¯ä¸ªæ™¶ä½“ç®¡å…·æœ‰ç•¥å¸¦éšæœºçš„ç”µæ°”ç‰¹æ€§ã€‚ SRAM å•å…ƒçš„ä¸Šç”µçŠ¶æ€ä¸»è¦å–å†³äº PMOS æ™¶ä½“ç®¡ P1 å’Œ P2 çš„é˜ˆå€¼ç”µå‹ ï¼ˆVthï¼‰ ä¹‹é—´çš„å·®å¼‚ã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘éšæœºå˜åŒ–å¯¼è‡´|Vth,P1|å°äº|Vth,P2|ã€‚ å› æ­¤ï¼Œåœ¨é€šç”µï¼ˆVdd ä¸Šå‡ï¼‰é˜¶æ®µ P1 å°†åœ¨ P2 ä¹‹å‰å¼€å§‹å¯¼é€šï¼Œå¯¼è‡´ A åœ¨é€»è¾‘ä¸Šå¤„äºé«˜ä½ï¼Œå¹¶é˜»æ­¢ P2 æ‰“å¼€ã€‚ å› æ­¤ï¼Œå•å…ƒçš„ä¸Šç”µçŠ¶æ€ä¸º A=1ã€‚Vth,P1å’ŒVth,P2ä¹‹é—´çš„ä¸åŒ¹é…è¶Šå¤§ï¼Œå•å…ƒçš„ä¸Šç”µä¼˜å…ˆæƒè¶Šå¼ºï¼Œå› æ­¤é€šç”µåæ˜¯å¦ä¸€ä¸ªçŠ¶æ€çš„æ¦‚ç‡è¶Šå°ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220904145457.png]]\n\nSRAM PUFåŸºäºä»»ä½•æ•°å­—èŠ¯ç‰‡ä¸­éƒ½å¯ä»¥ä½¿ç”¨çš„æ ‡å‡† SRAM å­˜å‚¨å™¨çš„è¡Œä¸ºã€‚æ¯æ¬¡SRAMä¾›ç”µæ—¶ï¼Œç”±äºæ™¶ä½“ç®¡é˜ˆå€¼ç”µå‹çš„éšæœºå·®å¼‚ï¼Œæ¯ä¸ªSRAMå•å…ƒéƒ½æœ‰è‡ªå·±çš„é¦–é€‰çŠ¶æ€ã€‚å› æ­¤ï¼Œå½“SRAMå­˜å‚¨å™¨ä¾›ç”µæ—¶ï¼Œæ¯ä¸€ä¸ªå•å…ƒéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªç‹¬ç‰¹ä¸”éšæœºçš„0å’Œ1æ¨¡å¼ã€‚è¿™äº›æ¨¡å¼å°±åƒèŠ¯ç‰‡æŒ‡çº¹ï¼Œå› ä¸ºæ¯ä¸ªæ¨¡å¼å¯¹äºç‰¹å®šçš„SRAMéƒ½æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤å¯¹äºç‰¹å®šçš„èŠ¯ç‰‡ä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚\n\n\n![[z-oblib/z2-attachments/Pasted image 20220904142722.png]]\n\n### å™ªå£°\n\nä½†æ˜¯ï¼Œåœ¨ SRAMæ¯æ¬¡ä¸Šç”µåï¼Œä¸€äº›å…¶ä¸­æ™¶ä½“ç®¡çš„é©±åŠ¨èƒ½åŠ›å¾ˆå¹³è¡¡çš„å•å…ƒï¼Œå¯èƒ½å…¶åˆå§‹å€¼æ˜¯0è¿˜æ˜¯1æ˜¯ä¸å›ºå®šçš„ã€‚ è¿™éƒ¨åˆ†å•å…ƒçš„æ•°é‡é™¤ä»¥é˜µåˆ—ä¸­æ€»å•å…ƒçš„æ•°é‡å®šä¹‰ä¸º SRAM PUF å™ªå£°ã€‚å•å…ƒç¿»è½¬ä¸»è¦å—å±€éƒ¨æ¸©å·®ã€å±€éƒ¨ç”µæºç”µå‹å˜åŒ–å’Œè€åŒ–çš„å½±å“ã€‚\n\nVth,P1â‰ˆVth,P2çš„å•å…ƒæœ‰è¾ƒé«˜çš„æ¦‚ç‡åœ¨æ¯æ¬¡ä¸Šç”µæ—¶å®ƒä»¬çš„è¾“å‡ºå€¼ä¹Ÿç›¸å¯¹å‰ä¸€æ¬¡ä¸Šç”µçš„è¾“å‡ºå€¼å‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤ï¼Œåœ¨SRAMçš„PUFå“åº”ä¸­ä¼šå¯¼è‡´ç›¸åº”SARMå•å…ƒæ¯”ç‰¹ç¿»è½¬æˆ–å™ªå£°ï¼ˆè¿™ä¹Ÿæ˜¯æœ¬æ–‡ä¸­å¯¹â€œå™ªå£°â€çš„å®šä¹‰ï¼‰ã€‚ ç”±äºé˜ˆå€¼ç”µå‹å¯¹æ¸©åº¦ã€ä¾›ç”µç”µå‹ã€è€åŒ–ç­‰å› ç´ æ•æ„Ÿï¼ŒSRAM PUFçš„å™ªå£°ä¹Ÿä¼šå¯¹è¿™äº›ä¸æ–­å˜åŒ–çš„æ¡ä»¶æ•æ„Ÿã€‚ \n\n\n\n![[z-oblib/z2-attachments/Pasted image 20220904143849.png]]\n\n### é’ˆå¯¹å™ªå£°çš„çº é”™\n\n\u003e å½±å“å› ç´ å’Œå¯¹ç­–è¯¦ç»†å‚è€ƒï¼š[Intrinsic IDåŸºäºSRAMçš„PUFå¯é æ€§åˆ†æ (ip-soc.com)](https://www.ip-soc.com/jishu/36.html)\n\n### å¯†é’¥æå–\n\nä¸ºäº†å°†æœ‰å™ªå£°çš„SRAM PUFçš„å“åº”è½¬æ¢ä¸ºå¯é è€Œä¸”å®‰å…¨çš„è®¾å¤‡å”¯ä¸€çš„å¯†é’¥ï¼Œä½¿ç”¨äº†æ¨¡ç³Šæå–å™¨æˆ–è¾…åŠ©æ•°æ®ç®—æ³•ã€‚è¿™ç§ç®—æ³•å®ç°ä¸¤ä¸ªå¤„ç†æ­¥éª¤ï¼šiï¼‰çº é”™å’Œ iiï¼‰ éšæœºæå–ã€‚\n\n#### çº é”™\n\nä¸ºäº†è¯´æ˜çº é”™çš„æ¦‚å¿µï¼Œä»¥ä¸€ä¸ªéå¸¸å°çš„ã€ç”±ä¸€ä¸ªå­—èŠ‚ç»„æˆçš„ SRAM PUFä¸ºä¾‹ã€‚SRAM PUF å“åº”å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå…«ä½ç»„æˆçš„ä½ä¸²ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»è¿™ä¸ªå…«ä½çš„SRAM PUF ä¸­æå–ä¸€ä¸ªæœºå¯†ä½ ï¼ˆ1 æˆ– 0ï¼‰ï¼Œè¯¥ä½å¯¹åº”äº 1/8 çš„ç ç‡ã€‚æœ¬ç¤ºä¾‹ä¸­ä½¿ç”¨çš„çº é”™ç æ˜¯é•¿åº¦ä¸º 8 çš„é‡å¤ä»£ç ã€‚è¿™æ„å‘³ç€æœºå¯†ä½'0'å°†è¢«ç¼–ç ä¸ºç å­—C0=(00000000)å’Œç§˜å¯†ä½'1'å°†è¢«ç¼–ç ä¸ºç å­—C1=(11111111)ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220904145844.png]]\n\n#TODO \n\n\u003e [Intrinsic IDåŸºäºSRAMçš„PUFå¯é æ€§åˆ†æ (ip-soc.com)](https://www.ip-soc.com/jishu/36.html)\n\n\n\n### æ–¹æ¡ˆä¼˜åŠ¿\n\nä¸ä¼ ç»Ÿçš„éæ˜“å¤±æ€§å†…å­˜(NVM)ä¸­çš„å¯†é’¥å­˜å‚¨ç›¸æ¯”ï¼Œè¿™ç§ä»SRAMå±æ€§ä¸­è·å–å¯†é’¥çš„æ–¹å¼å…·æœ‰å¾ˆå¤§çš„å®‰å…¨ä¼˜åŠ¿ã€‚å› ä¸ºå¯†é’¥ä¸æ˜¯æ°¸ä¹…å­˜å‚¨çš„ï¼Œæ‰€ä»¥å½“è®¾å¤‡å¤„äºéæ´»åŠ¨çŠ¶æ€æ—¶(åœ¨æ‰ç”µçŠ¶æ€æ—¶æˆ–è€…ä¸éœ€è¦ä½¿ç”¨å¯†é’¥æ—¶ï¼Œæ²¡æœ‰æ˜æ–‡å¯†é’¥)ï¼Œå¯†é’¥å°±ä¸å­˜åœ¨ï¼Œå› æ­¤æ”»å‡»è€…æ— æ³•æ‰“å¼€è®¾å¤‡å¹¶ç ´åå…¶å­˜å‚¨å™¨å†…çš„å†…å®¹ã€‚\n\n### å¦‚ä½•å°†SRAM PUFç”¨ä½œä¿¡ä»»æ ¹\n\nè®¾å¤‡ï¼Œå°¤å…¶æ˜¯ç‰©è”ç½‘çš„è®¾å¤‡ï¼Œéœ€è¦å¯†é’¥æ¥ä¿æŠ¤å…¶æ•°æ®ã€IP å’Œæ“ä½œã€‚å¦‚æœè¿™äº›å¯†é’¥çš„æ¥æºæ˜¯å¯ä¿¡çš„ï¼Œå¹¶ä¸”å¯†é’¥å®‰å…¨åœ°å­˜å‚¨åœ¨å¯ä»¥æŠµå¾¡æ”»å‡»çš„ç¡¬ä»¶ä¸­ï¼Œåˆ™å®ƒä»¬å°†å½¢æˆè®¾å¤‡æ‰€è°“çš„\"ä¿¡ä»»æ ¹\"ã€‚\n\nè¿™äº›å¯†é’¥å¯ä»¥ç”±è®¾å¤‡åˆ¶é€ å•†ï¼ˆä¹Ÿç§°ä¸º OEMï¼‰è‡ªå·±é…ç½®åˆ°è®¾å¤‡ä¸Šï¼Œä¹Ÿå¯ä»¥ç”±èŠ¯ç‰‡ä¾›åº”å•†åœ¨æ›´æ—©çš„é˜¶æ®µæä¾›ã€‚å½“èŠ¯ç‰‡ä¾›åº”å•†æä¾›é¢„å…ˆé…ç½®çš„èŠ¯ç‰‡æ—¶ï¼Œè¿™å°±å¢åŠ äº†ä»–ä»¬é”€å”®ç»™ OEM çš„äº§å“çš„ä»·å€¼ã€‚å¦‚æœ OEM å†³å®šè‡ªå·±è¿›è¡Œé…ç½®ï¼Œä»–ä»¬é€šå¸¸ä¼šè´­ä¹°æˆæœ¬æ›´ä½çš„èŠ¯ç‰‡ã€‚\n\næ— è®ºåŒæ–¹ä¸­å“ªä¸€æ–¹è´Ÿè´£æä¾›åŠ å¯†å¯†é’¥ï¼Œæ‰§è¡Œè¿™ä¸€ä»»åŠ¡éƒ½ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ã€‚å°†å¯†é’¥æ³¨å…¥èŠ¯ç‰‡éœ€è¦å€¼å¾—ä¿¡èµ–çš„å·¥å‚ï¼Œè¿™å¢åŠ äº†ç”Ÿäº§è¿‡ç¨‹çš„æˆæœ¬å’Œå¤æ‚æ€§ï¼Œå¹¶é™åˆ¶äº†çµæ´»æ€§ã€‚è¿™ç§å¤æ‚æ€§å¯ä»¥é€šè¿‡åœ¨èŠ¯ç‰‡å†…éƒ¨åˆ›å»ºå¯†é’¥æ¥é¿å…ï¼Œæ¯”å¦‚ä½¿ç”¨å†…éƒ¨éšæœºæ•°ç”Ÿæˆå™¨(RNG)æˆ–PUFã€‚\n\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%B4%E7%95%8C%E5%8C%BA":{"title":"ä¸´ç•ŒåŒº","content":"\n# ä¸´ç•ŒåŒº\n\ncritical  section\n\nä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å †å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸ºä¸´ç•ŒåŒºã€‚\n\n```java\nstatic int counter = 0;\n\nstatic void increment()\n// ä¸´ç•ŒåŒº\n{\n\tcounter++;\n}\n\nstatic void decrement()\n// ä¸´ç•ŒåŒº\n{\n\tcounter--;\n}\n```\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B9%90%E8%A7%82%E9%94%81":{"title":"ä¹è§‚é”","content":"# ä¹è§‚é”\n\nä¹è§‚é”åˆç§°ä¸ºâ€œæ— é”â€ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯ä¹è§‚æ´¾ã€‚ä¹è§‚é”æ€»æ˜¯å‡è®¾å¯¹å…±äº«èµ„æºçš„è®¿é—®æ²¡æœ‰å†²çªï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]å¯ä»¥ä¸åœåœ°æ‰§è¡Œï¼Œæ— éœ€åŠ é”ä¹Ÿæ— éœ€ç­‰å¾…ã€‚è€Œä¸€æ—¦å¤šä¸ªçº¿ç¨‹å‘ç”Ÿå†²çªï¼Œä¹è§‚é”é€šå¸¸æ˜¯ä½¿ç”¨ä¸€ç§ç§°ä¸º[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]çš„æŠ€æœ¯æ¥ä¿è¯çº¿ç¨‹æ‰§è¡Œçš„å®‰å…¨æ€§ã€‚\n\nç”±äºæ— é”æ“ä½œä¸­æ²¡æœ‰é”çš„å­˜åœ¨ï¼Œå› æ­¤ä¸å¯èƒ½å‡ºç°æ­»é”çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´**ä¹è§‚é”å¤©ç”Ÿå…ç–«æ­»é”**ã€‚\n\nä¹è§‚é”å¤šç”¨äºâ€œ**è¯»å¤šå†™å°‘**â€œçš„ç¯å¢ƒï¼Œé¿å…é¢‘ç¹åŠ é”å½±å“æ€§èƒ½ï¼›è€Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/æ‚²è§‚é”|æ‚²è§‚é”]]å¤šç”¨äºâ€å†™å¤šè¯»å°‘â€œçš„ç¯å¢ƒï¼Œé¿å…é¢‘ç¹å¤±è´¥å’Œé‡è¯•å½±å“æ€§èƒ½ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%BA%8C%E7%BA%A7%E9%A1%B5%E8%A1%A8":{"title":"äºŒçº§é¡µè¡¨","content":"# äºŒçº§é¡µè¡¨\n\näºŒçº§é¡µè¡¨çš„ä½œç”¨ï¼š\n\né¡µè¡¨æœ¬èº«ä¹Ÿå ç”¨å†…å­˜ç©ºé—´ï¼Œä¸”è¿˜ä¸å°ï¼Œè€Œç¨‹åºè¿è¡Œæ—¶ä¹Ÿä¸ä¸€å®šè¦æŠŠæ‰€æœ‰é¡µè¡¨éƒ½è½½å…¥åˆ°å†…å­˜ã€‚\n\næ‰€ä»¥è¿é¡µè¡¨æœ¬èº«ä¹Ÿå¯ä»¥éƒ¨åˆ†è½½å…¥å†…å­˜ï¼Œè¿™å°±éœ€è¦å¯¹é¡µè¡¨ä¹Ÿåˆ†æ®µï¼Œå½¢æˆäºŒçº§é¡µè¡¨ç»“æ„ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80%E5%9C%A8%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E8%8A%B1%E5%BC%8F%E5%8F%AB%E6%B3%95":{"title":"å†…å­˜åœ°å€åœ¨ä¸åŒåœºæ™¯ä¸‹çš„èŠ±å¼å«æ³•","content":"\n# å†…å­˜åœ°å€åœ¨ä¸åŒåœºæ™¯ä¸‹çš„èŠ±å¼å«æ³•\n\n- æŒ‡é’ˆ -- c/c++è¯­è¨€ç­‰\n- å¥æŸ„ -- c/c++ä¸‹å°±æ˜¯ä¸€ä¸ªå¯¹è±¡çš„åœ°å€\n- å‘é‡ -- å¦‚ä¸­æ–­å‘é‡ï¼Œæ˜¯æŒ‡å‘ä¸­æ–­å·å¯¹åº”ä¸­æ–­å¤„ç†ç¨‹åºçš„åœ°å€\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%88%86%E6%AE%B5":{"title":"åˆ†æ®µ","content":"\n# åˆ†æ®µ\n\nåˆ†é¡µæ˜¯é’ˆå¯¹ç¨‹åºå†…å®¹çš„ï¼š\n**åˆ†æ®µå­˜å‚¨ç®¡ç†èƒ½åæ˜ ç¨‹åºçš„é€»è¾‘ç»“æ„å¹¶æœ‰åˆ©äºæ®µçš„å…±äº«**\n\nç¨‹åºæŒ‰å†…å­˜ç‰©ç†åœ°å€ç›´æ¥åŠ è½½ï¼Œå†…å­˜çš„ç©ºé—´åˆ©ç”¨ç‡ä¸é«˜ï¼Œå› ä¸ºç¨‹åºä¸­çš„å„ä¸ªéƒ¨åˆ†åœ¨æ‰§è¡Œæ—¶åªæœ‰éƒ¨åˆ†åœ¨å‘æŒ¥ä½œç”¨ï¼Œå¹¶ä¸”ç¨‹åºèƒ½ç›´æ¥è®¿é—®å†…å­˜ï¼Œå®‰å…¨æ€§ä¸é«˜ã€‚\n\nå› æ­¤å°†ç¨‹åºæŒ‰è‡ªèº«çš„ç»„ç»‡ç»“æ„è¿›è¡Œåˆ’åˆ†ï¼Œä¾‹å¦‚åˆ’åˆ†å‡ºä»£ç æ®µã€æ•°æ®æ®µç­‰ã€‚\n\nåœ¨åˆ†æ®µä¸­ï¼ŒCPUäº§ç”Ÿä¸€ä¸ªåŒ…å«æ®µå·å’Œæ®µåç§»é‡çš„é€»è¾‘åœ°å€ï¼Œå¦‚æœæ®µåç§»é‡æ¯”`limits`å°ï¼Œåˆ™è¯¥åœ°å€ä¸ºæœ‰æ•ˆåœ°å€ï¼Œå¦åˆ™ä¼šå› ä¸ºåœ°å€æ— æ•ˆè€Œå¼•å‘è®¡ç®—é”™è¯¯ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923202813.png]]\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%88%86%E9%A1%B5":{"title":"åˆ†é¡µ","content":"\n# åˆ†é¡µ\n\nåˆ†é¡µæ˜¯é’ˆå¯¹å†…å­˜ç©ºé—´çš„ï¼š\n**é¡µå¼å­˜å‚¨ç®¡ç†èƒ½æœ‰æ•ˆåœ°æé«˜å†…å­˜åˆ©ç”¨ç‡**\n\n[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]çš„åœ°å€ç©ºé—´è¢«åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„å—ã€‚[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è™šæ‹Ÿå†…å­˜|è™šæ‹Ÿå†…å­˜]]å’Œç‰©ç†å†…å­˜éƒ½è¢«åˆ’åˆ†æˆç›¸ç­‰çš„å›ºå®šå¤§å°çš„å—ã€‚**è™šæ‹Ÿå†…å­˜ä¸­çš„å—ç§°ä¸ºé¡µï¼Œç‰©ç†å†…å­˜ä¸­çš„å—ç§°ä¸ºé¡µå¸§**ã€‚åˆ†é¡µ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å¤šçº§é¡µè¡¨æé«˜å†…å­˜ä½¿ç”¨æ•ˆç‡çš„åŸç†|é«˜æ•ˆç‡]]åœ°åˆ©ç”¨å†…å­˜ï¼Œå¯ä»¥è¿è¡Œæ¯”ç‰©ç†å†…å­˜ç©ºé—´æ›´å¤§çš„ç¨‹åºã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923202623.png]]\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%88%86%E9%A1%B5%E4%B8%8E%E5%88%86%E6%AE%B5%E7%9A%84%E5%8C%BA%E5%88%AB":{"title":"åˆ†é¡µä¸åˆ†æ®µçš„åŒºåˆ«","content":"\n# åˆ†é¡µä¸åˆ†æ®µçš„åŒºåˆ«\n\n[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åˆ†é¡µ|åˆ†é¡µ]] VS [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åˆ†æ®µ|åˆ†æ®µ]]\n\n| åˆ†é¡µ                        | åˆ†æ®µ                     |\n|---------------------------|------------------------|\n| åœ¨åˆ†é¡µä¸­ï¼Œè¿›ç¨‹çš„åœ°å€ç©ºé—´è¢«åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µé¢   | åœ¨åˆ†æ®µä¸­ï¼Œè¿›ç¨‹çš„åœ°å€ç©ºé—´è¢«åˆ’åˆ†ä¸ºå¤§å°ä¸åŒçš„æ®µ |\n| æ“ä½œç³»ç»Ÿè´Ÿè´£åˆ†é¡µ                  | ç¼–è¯‘å™¨è´Ÿè´£åˆ†æ®µ                |\n| é¡µå¤§å°ç”±ç¡¬ä»¶å†³å®š                  | æ®µå¤§å°ç”±ç”¨æˆ·ç»™å‡º               |\n| é€Ÿåº¦æ¯”åˆ†æ®µå—                    | åˆ†æ®µé€Ÿåº¦æ…¢                  |\n| åˆ†é¡µä¼šå¯¼è‡´å†…éƒ¨ç¢ç‰‡                 | åˆ†æ®µå¯¼è‡´å¤–éƒ¨ç¢ç‰‡               |\n| åˆ†é¡µä¸­ï¼Œé€»è¾‘åœ°å€è¢«åˆ’åˆ†ä¸ºé¡µå·å’Œé¡µåç§»        | åˆ†æ®µä¸­ï¼Œé€»è¾‘åœ°å€è¢«åˆ’åˆ†ä¸ºæ®µå·å’Œæ®µåç§»     |\n| åˆ†é¡µåŒ…å«ä¸€ä¸ªé¡µè¡¨ï¼Œé¡µè¡¨åŒ…å«æ¯ä¸ªé¡µçš„åŸºåœ°å€      | åˆ†æ®µåŒ…å«æ®µè¡¨ï¼Œæ®µè¡¨ä¸­åŒ…å«æ®µå·å’Œæ®µåç§»é‡    |\n| åˆ†é¡µå¯¹äºç”¨æˆ·ä¸å¯è§                 | åˆ†æ®µå¯¹äºç”¨æˆ·å¯è§               |\n| åœ¨åˆ†é¡µä¸­ï¼Œå¤„ç†å™¨éœ€è¦é¡µå·å’Œé¡µåç§»æ¥è®¡ç®—å®é™…ç‰©ç†åœ°å€ | åˆ†æ®µä¸­ï¼Œå¤„ç†å™¨ä½¿ç”¨æ®µå·å’Œæ®µåç§»é‡è®¡ç®—åœ°å€   |\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%8F%AF%E9%87%8D%E5%85%A5%E5%87%BD%E6%95%B0":{"title":"å¯é‡å…¥å‡½æ•°","content":"\n# å¯é‡å…¥å‡½æ•°\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/z-attachments/Pasted image 20221018165205.png]]\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%90%8C%E6%AD%A5":{"title":"åŒæ­¥","content":"# åŒæ­¥\n\næ‰€æœ‰çš„æ‰§è¡Œé¡ºåºéƒ½**ä¸¥æ ¼åœ°å’Œä»£ç ä¹¦å†™çš„é¡ºåºä¸€è‡´**ã€‚\n\n## ä»¥è°ƒç”¨æ–¹è§’åº¦\n\néœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯åŒæ­¥ã€‚\n\n## çº¿ç¨‹åŒæ­¥\n\nçº¿ç¨‹åŒæ­¥æ˜¯çº¿ç¨‹ä¹‹é—´æŒ‰ç…§**ä¸€å®šçš„é¡ºåº**æ‰§è¡Œã€‚\n\n## ä¼˜ç‚¹\n\nåŒæ­¥æœ€å¤§çš„ä¼˜ç‚¹æ˜¯æ€è·¯æ¸…æ™°ã€‚ä½ æ°¸è¿œå¯ä»¥çŸ¥é“ä½ çš„ç¨‹åºæ˜¯æŒ‰ç…§æ€æ ·çš„é¡ºåºæ‰§è¡Œçš„ï¼Œä¸ç”¨æ‹…å¿ƒä»»ä½•æ„æ–™ä¹‹å¤–çš„æƒ…å†µã€‚\n\n## ç¼ºç‚¹\n\nåœ¨æŸäº›æƒ…å¢ƒä¸‹ï¼Œå®ƒä¼šå¸¦æ¥æ€§èƒ½çš„æµªè´¹ã€‚\n\nä»¥ä¸€ä¸ªç”Ÿæ´»ä¸­çš„åœºæ™¯ä¸ºä¾‹ï¼šä½ åœ¨ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æ–‡ä»¶å¾ˆå¤§ï¼Œéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½ä¸‹å®Œã€‚è¿™æ—¶å€™ï¼Œä½ è‚¯å®šä¸ä¼šç›¯ç€è¿›åº¦æ¡ä¸€ç‚¹ç‚¹èµ°ï¼Œè€Œæ˜¯å»åšç‚¹åˆ«çš„äº‹æƒ…ï¼Œè¯»ä¸€ä¼šä¹¦ï¼Œçœ‹ä¸€ä¼šç”µå½±ï¼Œä¹‹ç±»çš„ã€‚\n\nä½†å¦‚æœæœ‰ä¸€ä¸ªå®Œå…¨â€œåŒæ­¥â€çš„äººï¼Œä»–ä¸ºè‡ªå·±è®¾å®šçš„ç¨‹åºæ˜¯ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åè¿è¡Œå®ƒï¼Œè¿™æ ·çš„è¯ï¼Œä»–ä¸ºäº†ä¸è®©è‡ªå·±çš„è¿è¡Œé€»è¾‘ä¹±æ‰ï¼Œå°±ä¼šä¸€ç›´å®ˆåœ¨ç”µè„‘å‰ï¼Œç›´åˆ°æ–‡ä»¶ä¸‹è½½å®Œæˆæ‰åšä¸‹ä¸€æ­¥çš„å·¥ä½œã€‚æ­£å¸¸äººè‚¯å®šä¸èƒ½å¿å—è¿™æ ·æ— èŠçš„ç­‰å¾…ï¼Œä¹Ÿä¸ä¼šå¸Œæœ›è‡ªå·±çš„ç¨‹åºåœ¨è¿™ç§æ— èŠçš„äº‹ä¸Šæµªè´¹æ—¶é—´ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%9B%9E%E8%B0%83":{"title":"å›è°ƒ","content":"# å›è°ƒ\n\n\u003e Aç±»aæ–¹æ³•è°ƒç”¨Bç±»çš„bæ–¹æ³•ï¼Œbæ–¹æ³•å†è°ƒç”¨Aç±»çš„cæ–¹æ³•\n\u003e å°±æ˜¯ä¸å…‰æŠŠå·¥ä½œå†…å®¹äº¤ç»™åˆ«çš„çº¿ç¨‹åšï¼Œè¿˜è¦æŠŠç»“æœå¤„ç†ä¹Ÿäº¤ç»™åˆ«çš„çº¿ç¨‹åšã€‚\n\nå›è°ƒçš„æœ¬è´¨ï¼Œæ˜¯å°†ä¸€ä¸ªä»»åŠ¡åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œåœ¨è€—æ—¶æ“ä½œä¹‹å‰çš„éƒ¨åˆ†ï¼Œå’Œè€—æ—¶æ“ä½œä¹‹åçš„éƒ¨åˆ†ï¼Œåè€…æ˜¯å‰è€…çš„ç»§ç»­ï¼Œæˆ–è€…å«åš[[ç»­ä½“]]ï¼ˆcontinuationï¼‰ã€‚å›è°ƒå¼å°±æ˜¯æŠŠç»­ä½“å†™æˆå›è°ƒå‡½æ•°çš„å½¢å¼ï¼Œä¼ é€’åˆ°å…¶ä»–åœ°æ–¹ï¼Œè¿™ç§æ“ä½œåˆå«åšç»­ä½“ä¼ é€’ï¼ˆcontinuation-passingï¼‰ã€‚ä»è¿™ä¸ªå±‚é¢ä¸Šçœ‹ï¼Œå›è°ƒæ˜¯ç»­ä½“ä¼ é€’é£æ ¼ï¼ˆContinuation-Passing Style, CPSï¼‰çš„ä¸€ç§ã€‚\n\n## ä¸¾ä¾‹\n\nç°åœ¨é¢†å¯¼è¦å‘˜å·¥Aåšä¸€ä»¶äº‹ï¼Œç»™ä»–å‘å¸ƒäº†ä»»åŠ¡ï¼Œéœ€è¦å‘˜å·¥Aåšå®Œåå†é€šçŸ¥é¢†å¯¼ã€‚\n\nå¯¹äºé¢†å¯¼æ¥è¯´ï¼šå‘å¸ƒä»»åŠ¡ï¼ˆfabuTaskï¼‰,è·å¾—ç»“æœï¼ˆresultï¼‰\n\nå¯¹äºå‘˜å·¥æ¥è¯´ï¼šå¤„ç†ä»»åŠ¡ï¼ˆdoSomthingï¼‰,é€šçŸ¥é¢†å¯¼ç»“æœï¼ˆresultï¼‰\n\n### ä»»åŠ¡å‘å¸ƒè€…\n\n\u003e ä»»åŠ¡å‘å¸ƒè€…å®šä¹‰äº†å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°å°±æ˜¯æœªæ¥ä»»åŠ¡æ‰§è¡Œè€…æäº¤çš„ç»“æœã€‚\n\n```java\n/**\n * å›è°ƒçš„æ–¹æ³•\n *\n */\npublic interface CallBack {\n\tvoid result(String result);\n}\n```\n\né¢†å¯¼å‘å¸ƒçš„ä»»åŠ¡ï¼šè®©å‘˜å·¥åšäº‹ï¼š\n\n```java\n/**\n * é¢†å¯¼å‘å¸ƒä»»åŠ¡ã€è·å¾—ç»“æœ\n *\n */\npublic class Manager implements CallBack{\n \n\t@Override\n\tpublic void result(String result) {\n\t\tSystem.out.println(result);\n\t}\n\t\n\tpublic void fabuTask(EmployeeInterfce employee) throws InterruptedException {\n\t\tSystem.out.println(\"é¢†å¯¼å‘å¸ƒä»»åŠ¡\");\n\t\temployee.doSomthing(new Manager());\t\t\n\t\t\n\t}\n \n}\n```\n\né¢†å¯¼è¿˜æœ‰å…¶å®ƒä»»åŠ¡çš„è¯ï¼š\n\n```java\n/**\n * é¢†å¯¼å‘å¸ƒä»»åŠ¡ã€è·å¾—ç»“æœ\n *\n */\npublic class Manager implements CallBack{\n \n\t@Override\n\tpublic void result(String result) {\n\t\tSystem.out.println(result);\n\t}\n\t\n\tpublic void fabuTask(EmployeeInterfce employee) throws InterruptedException {\n\t\tSystem.out.println(\"é¢†å¯¼å‘å¸ƒä»»åŠ¡\");\n\t\tnew Thread(new Runnable() {\t\t\n\t\t\t@Override\n\t\t\tpublic void run() {\n\t\t\t\temployee.doSomthing(new Manager());\t\n\t\t\t}\n\t\t}).start();\t\t\n\t}\n}\n```\n\n### ä»»åŠ¡æ‰§è¡Œè€…\n\n\u003e ä»»åŠ¡æ‰§è¡Œè€…è®¡ç®—å‡ºç»“æœåï¼Œä¼šè°ƒç”¨å‘å¸ƒè€…çš„å›è°ƒå‡½æ•°ï¼Œå¹¶å°†ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ã€‚\n\u003e è¿™é‡Œä»»åŠ¡æ‰§è¡Œå®Œæ¯•åä¸ä¼šå›åˆ°åŸæ¥çš„çº¿ç¨‹å†æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨å·¥ä½œçº¿ç¨‹ä¸­newäº†ä¸€ä¸ªå‘å¸ƒè€…å¹¶è°ƒç”¨å›è°ƒå‡½æ•°å¤„ç†ç»“æœã€‚\n\nå‘˜å·¥å¤„ç†äº‹æƒ…ï¼Œéœ€è¦æ¥æ”¶ä¸€ä¸ªCallBackå‚æ•°,è¿™æ ·æ‰èƒ½çŸ¥é“è¦å‘è°åé¦ˆ\n\n```java\n/**\n * å‘˜å·¥åšäº‹ã€é€šçŸ¥é¢†å¯¼\n *\n */\npublic class Employee implements EmployeeInterfce{\n\t\n\t@Override\n\tpublic void doSomthing(CallBack callBack) {\n\t\tString result = \"åšå®Œäº†\";\n\t\tcallBack.result(result);\n\t}\n}\n```\n\n```java\npublic class Test {\n \n\tpublic static void main(String[] args) throws InterruptedException {\n\t\tEmployee employee = new Employee();\n\t\tManager manager = new Manager();\n\t\tmanager.fabuTask(employee);\n\t\tSystem.out.println(\"é¢†å¯¼ç»§ç»­åšäº‹\");\n\t}\n \n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œé¢†å¯¼åœ¨å‘å¸ƒç©ä»»åŠ¡åï¼Œå°±ä¸ç”¨ç®¡å‘˜å·¥æ˜¯å¦åšå®Œå°±å¯ä»¥æ¥ç€åšè‡ªå·±çš„äº‹ï¼Œè¿™ç§å°±æ˜¯å¼‚æ­¥è°ƒç”¨Â ã€‚\n\n## æ€»ç»“\n\næ„Ÿè§‰å›è°ƒå‡½æ•°å°±æ˜¯ä¸€ä¸ªå¤„ç†ç»“æœçš„å‡½æ•°ï¼Œä»»åŠ¡å‘å¸ƒè€…å°†ä»»åŠ¡æŠ›ç»™å…¶å®ƒçº¿ç¨‹çš„åŒæ—¶ï¼Œå®šä¹‰äº†è‡ªå·±æœªæ¥æ¥æ”¶åˆ°ç»“æœåçš„è¡Œä¸ºã€‚\nå½“å…¶å®ƒçº¿ç¨‹å·¥ä½œå®Œæ¯•ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°è®©å‘å¸ƒè€…å¤„ç†ç»“æœã€‚\n\n\u003e å¤„ç†ç»“æœçš„é€»è¾‘ä»ä»»åŠ¡å‘å¸ƒè€…çš„çº¿ç¨‹è½¬ç§»åˆ°äº†ä»»åŠ¡æ‰§è¡Œè€…çš„çº¿ç¨‹ä¸­äº†ã€‚\n\u003e ä»»åŠ¡å‘å¸ƒè€…å°±ä¸ç”¨ä¸ºäº†ç­‰å¾…ç»“æœè€Œé˜»å¡äº†ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%A4%9A%E7%BA%A7%E9%A1%B5%E8%A1%A8%E6%8F%90%E9%AB%98%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E6%95%88%E7%8E%87%E7%9A%84%E5%8E%9F%E7%90%86":{"title":"å¤šçº§é¡µè¡¨æé«˜å†…å­˜ä½¿ç”¨æ•ˆç‡çš„åŸç†","content":"\n# å¤šçº§é¡µè¡¨æé«˜å†…å­˜ä½¿ç”¨æ•ˆç‡çš„åŸç†\n\n## æé«˜å¯»å€æ•ˆç‡\n\nä¸åˆ†é¡µï¼š 16\nå‡åˆ†ä¸¤é¡µï¼š16 --\u003e 8+8ï¼Œ8 * 8 = 64ï¼›\nä»¥æ­¤ç±»æ¨...\n\nå‡è®¾ä¸¤çº§[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åˆ†é¡µ|åˆ†é¡µ]]ï¼Œä¸€çº§ç”¨äºå®šä½åœ¨ç¬¬å‡ ä¸ªäºŒçº§[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/é¡µè¡¨|é¡µè¡¨]]ï¼Œæ¯ä¸ªäºŒçº§é¡µè¡¨åˆèƒ½å®šä½æŸä¸€å—å†…å­˜ç©ºé—´ï¼Œå³ 8**=64ï¼›\n\n## æé«˜ç©ºé—´æ•ˆç‡\n\n[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]çš„åœ°å€ç©ºé—´å¾ˆå°‘æœ‰å®Œå…¨æ˜ å°„çš„æƒ…å†µã€‚æ­£æ˜¯å› ä¸ºçœå´äº†å¤§é‡æœªæ˜ å°„çš„é¡µè¡¨é¡¹ä½¿å¾—é¡µè¡¨çš„ç©ºé—´å¤§å¹…å‡å°‘ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923203858.png]]\n\n## å‚è€ƒ\n\n[é¡µè¡¨æ˜¯å•¥ä»¥åŠä¸ºå•¥å¤šçº§é¡µè¡¨èƒ½å¤ŸèŠ‚çœç©ºé—´_wx61307a0120efdçš„æŠ€æœ¯åšå®¢_51CTOåšå®¢](https://blog.51cto.com/u_15352922/3742181)\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F":{"title":"å¯»å€æ–¹å¼","content":"# å¯»å€æ–¹å¼\n\n\u003e å¯»å€æ–¹å¼: æŒ‡ä»¤ä¸­æŒ‡æ˜æ“ä½œæ•°å­˜æ”¾ä½ç½®çš„è¡¨è¾¾æ–¹å¼.  \n\n## æŒ‡ä»¤ä¸­æ“ä½œæ•°çš„æ•°æ®å­˜æ”¾ä½ç½®æƒ…å†µ\n\n- å­˜æ”¾æŒ‡ä»¤ä¸­ (ç«‹å³æ•°)\n    - æ“ä½œæ•°åŒ…å«åœ¨æŒ‡ä»¤ä¸­\n    - å¤‡æ“ä½œæ•°æ®ç›´æ¥è¡¨ç¤ºåœ¨æŒ‡ä»¤çš„æ“ä½œæ•°å­—æ®µä¸­\n    - ç´§è·Ÿåœ¨æ“ä½œç ä¹‹å\n    - ä¾‹å¦‚ `MOV AL, 10H`\n- å­˜æ”¾äºå¯„å­˜å™¨ä¸­ (å¯„å­˜å™¨æ“ä½œæ•°) \n    - æ•°æ®å­˜æ”¾åœ¨ CPU çš„ä¸€ä¸ªå¯„å­˜å™¨ä¸­\n    - ä¾‹å¦‚ `INC CX`\n- å­˜æ”¾äºå­˜å‚¨å™¨ä¸­ (å­˜å‚¨å™¨æ“ä½œæ•°)\n    - æ•°æ®å†å†…å­˜æˆ– I/I ç«¯å£ä¸­\n    - å­˜æ”¾æ•°æ®çš„åç§»åœ°å€ä»¥æŸç§æ–¹å¼è¡¨ç¤ºåœ¨æŒ‡ä»¤ä¸­\n    - ä¾‹å¦‚ `MOV AX, [2500H]`\n        - å…¶ä¸­ [2500] ä¸ºå­˜å‚¨å™¨æ“ä½œæ•°\n        - å­˜å‚¨å™¨æ“ä½œæ•°ä¸­æ“ä½œçš„æ•°å­—æ®µæŒ‡ç¤ºæ­¤æ“ä½œæ•°çš„åç§»åœ°å€\n        - æ®µåœ°å€ç”±æŸä¸ªæ®µå¯„å­˜å™¨æä¾›\n        - é»˜è®¤ä¸º DS æä¾›\n\n## å¯»å€æ–¹å¼åˆ†ç±»\n\n- ç«‹å³æ•°å¯»å€\n    - æ“ä½œæ•°ä¸ºç«‹å³æ•°\n    - ç›´æ¥å­˜æ”¾åœ¨æŒ‡ä»¤çš„æ“ä½œæ•°å­—æ®µ\n    - åªå…è®¸æºæ“ä½œæ•°ä¸ºç«‹å³æ•°\n    - ç›®æ ‡æ“ä½œæ•°å¿…é¡»æ˜¯å¯„å­˜å™¨æˆ–å­˜å‚¨å•å…ƒ\n        - ç»™å¯„å­˜å™¨æˆ–å­˜å‚¨å•å…ƒèµ‹å€¼\n- å¯„å­˜å™¨å¯»å€\n    - ç›´æ¥åœ¨æŒ‡ä»¤ä¸­å†™å‡ºå¯„å­˜å™¨åç§°\n- å­˜å‚¨å™¨å¯»å€\n    - ç›´æ¥å¯»å€\n        - æ“ä½œæ•°å­˜åœ¨å†…å­˜ä¸­, æ“ä½œæ•°çš„åç§»åœ°å€ç›´æ¥è¡¨ç¤ºåœ¨æŒ‡ä»¤ä¸­\n        - è¡¨ç¤ºæ ¼å¼: [åç§»åœ°å€]\n        - é»˜è®¤æ“ä½œæ•°å­˜æ”¾åœ¨å†…å­˜çš„æ•°æ®æ®µä¸­\n        - ä¾‹å¦‚ `MOV AL, [1064H]`\n        - æ®µè¶…è¶ŠæŒ‡æ˜ä½¿ç”¨çš„æ®µ\n    - å¯„å­˜å™¨é—´æ¥å¯»å€\n    - åŸºå€åŠ å˜å€å¯»å€\n    - ç›¸å¯¹åŠ åŸºå€å˜å€å¯»å€","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%B9%B6%E5%8F%91":{"title":"å¹¶å‘","content":"# å¹¶å‘\n\nå¹¶å‘ï¼ˆconcurrentï¼‰æ˜¯åŒä¸€æ—¶é—´åº”å¯¹ï¼ˆdealing withï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ã€‚\næ“ä½œç³»ç»Ÿé€šè¿‡ä»»åŠ¡è°ƒåº¦å™¨ç»„ä»¶ï¼Œå°†CPUçš„æ—¶é—´ç‰‡ï¼ˆwinä¸‹æœ€å°15msï¼‰åˆ†ç»™ä¸åŒçš„ä»»åŠ¡ä½¿ç”¨ã€‚CPUåœ¨å¤šä¸ªä»»åŠ¡ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ï¼Œæ—¶é—´éå¸¸çŸ­ï¼Œè®©äººäº§ç”Ÿäº†ä¸€ç§å¤šä¸ªä»»åŠ¡åœ¨åŒæ—¶æ‰§è¡Œçš„é”™è§‰ï¼Œå®é™…ä¸Šä»»åŠ¡è¿˜æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220525143804.png]]","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%B9%B6%E8%A1%8C":{"title":"å¹¶è¡Œ","content":"# å¹¶è¡Œ\n\nå¹¶è¡Œï¼ˆparallelï¼‰æ˜¯åŒä¸€æ—¶é—´åŠ¨æ‰‹åšï¼ˆdoingï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ã€‚\nä¸¤ä¸ªCPUæ ¸å¿ƒçœŸæ­£åŒæ—¶è¿è¡Œä¸¤ä¸ªä»»åŠ¡ï¼ˆçº¿ç¨‹ï¼‰ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220525143900.png]]\n\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%BC%82%E6%AD%A5":{"title":"å¼‚æ­¥","content":"# å¼‚æ­¥\n\n## ä»¥è°ƒç”¨æ–¹è§’åº¦\n\nä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯å¼‚æ­¥ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%82%B2%E8%A7%82%E9%94%81":{"title":"æ‚²è§‚é”","content":"# æ‚²è§‚é”\n\næ‚²è§‚é”å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„é”ã€‚å¯¹äºæ‚²è§‚é”æ¥è¯´ï¼Œå®ƒæ€»æ˜¯è®¤ä¸ºæ¯æ¬¡è®¿é—®å…±äº«èµ„æºæ—¶ä¼šå‘ç”Ÿå†²çªï¼Œæ‰€ä»¥å¿…é¡»å¯¹**æ¯æ¬¡æ•°æ®æ“ä½œåŠ ä¸Šé”**ï¼Œä»¥ä¿è¯ä¸´ç•ŒåŒºçš„ç¨‹åºåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]åœ¨æ‰§è¡Œã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%8C%87%E4%BB%A4%E7%BA%A7%E5%B9%B6%E8%A1%8C":{"title":"æŒ‡ä»¤çº§å¹¶è¡Œ","content":"# æŒ‡ä»¤çº§å¹¶è¡Œ\n\n## åè¯è§£é‡Š\n\n### Clock Cycle Time \nä¸»é¢‘çš„æ¦‚å¿µå¤§å®¶æ¥è§¦çš„æ¯”è¾ƒå¤šï¼Œè€Œ CPU çš„ Clock Cycle Timeï¼ˆæ—¶é’Ÿå‘¨æœŸæ—¶é—´ï¼‰ï¼Œç­‰äºä¸»é¢‘çš„å€’æ•°ï¼Œæ„æ€æ˜¯ CPU èƒ½å¤Ÿè¯†åˆ«çš„æœ€å°æ—¶é—´å•ä½ï¼Œæ¯”å¦‚è¯´ 4G ä¸»é¢‘çš„ CPU çš„ Clock Cycle Time å°±æ˜¯ 0.25 nsï¼Œä½œä¸ºå¯¹æ¯”ï¼Œæˆ‘ä»¬å¢™ä¸ŠæŒ‚é’Ÿçš„Cycle Time æ˜¯ 1sã€‚\nä¾‹å¦‚ï¼Œè¿è¡Œä¸€æ¡åŠ æ³•æŒ‡ä»¤ä¸€èˆ¬éœ€è¦ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸæ—¶é—´ã€‚\n### CPI \næœ‰çš„æŒ‡ä»¤éœ€è¦æ›´å¤šçš„æ—¶é’Ÿå‘¨æœŸæ—¶é—´ï¼Œæ‰€ä»¥å¼•å‡ºäº† CPI ï¼ˆCycles Per Instructionï¼‰æŒ‡ä»¤å¹³å‡æ—¶é’Ÿå‘¨æœŸæ•°ã€‚\n### IPC \nIPCï¼ˆInstruction Per Clock Cycleï¼‰ å³ CPI çš„å€’æ•°ï¼Œè¡¨ç¤ºæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸèƒ½å¤Ÿè¿è¡Œçš„æŒ‡ä»¤æ•°ã€‚\n### CPU æ‰§è¡Œæ—¶é—´ \nç¨‹åºçš„ CPU æ‰§è¡Œæ—¶é—´ï¼Œå³æˆ‘ä»¬å‰é¢æåˆ°çš„ user + system æ—¶é—´ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å…¬å¼æ¥è¡¨ç¤ºã€‚\nç¨‹åº CPU æ‰§è¡Œæ—¶é—´ = æŒ‡ä»¤æ•° * CPI * Clock Cycle Time\n## é±¼ç½å¤´çš„æ•…äº‹\n\nåŠ å·¥ä¸€æ¡é±¼éœ€è¦ 50 åˆ†é’Ÿï¼Œåªèƒ½ä¸€æ¡é±¼ã€ä¸€æ¡é±¼é¡ºåºåŠ å·¥...\n![[z-oblib/z2-attachments/Pasted image 20220531001400.png]]\n\nå¯ä»¥å°†æ¯ä¸ªé±¼ç½å¤´çš„åŠ å·¥æµç¨‹ç»†åˆ†ä¸º 5 ä¸ªæ­¥éª¤ï¼š\n- å»é³æ¸…æ´— 10åˆ†é’Ÿ\n- è’¸ç…®æ²¥æ°´ 10åˆ†é’Ÿ\n- åŠ æ³¨æ±¤æ–™ 10åˆ†é’Ÿ\n- æ€èŒå‡ºé”… 10åˆ†é’Ÿ\n- çœŸç©ºå°ç½ 10åˆ†é’Ÿ\n\n![[z-oblib/z2-attachments/Pasted image 20220531001700.png]]\n\nå³ä½¿åªæœ‰ä¸€ä¸ªå·¥äººï¼Œæœ€ç†æƒ³çš„æƒ…å†µæ˜¯ï¼šä»–èƒ½å¤Ÿåœ¨ 10 åˆ†é’Ÿå†…åŒæ—¶åšå¥½è¿™ 5 ä»¶äº‹ï¼Œå› ä¸ºå¯¹ç¬¬ä¸€æ¡é±¼çš„çœŸç©ºè£…ç½ï¼Œä¸ä¼šå½±å“å¯¹ç¬¬äºŒæ¡é±¼çš„æ€èŒå‡ºé”…...\n\n## æŒ‡ä»¤é‡æ’åºä¼˜åŒ–\n\näº‹å®ä¸Šï¼Œç°ä»£å¤„ç†å™¨ä¼šè®¾è®¡ä¸ºä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æ‰§è¡Œæ—¶é—´æœ€é•¿çš„ CPU æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥æƒ³åˆ°æŒ‡ä»¤è¿˜å¯ä»¥å†åˆ’åˆ†æˆä¸€ä¸ªä¸ªæ›´å°çš„é˜¶æ®µï¼Œä¾‹å¦‚ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥åˆ†ä¸ºï¼š å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å› è¿™ 5 ä¸ªé˜¶æ®µã€‚\n\n```java\n// å¯ä»¥é‡æ’çš„ä¾‹å­\nint a = 10; // æŒ‡ä»¤1\nint b = 20; // æŒ‡ä»¤2\nSystem.out.println( a + b );\n \n// ä¸èƒ½é‡æ’çš„ä¾‹å­\nint a = 10; // æŒ‡ä»¤1\nint b = a - 5; // æŒ‡ä»¤2\n```\n\nç°ä»£ CPU æ”¯æŒå¤šçº§æŒ‡ä»¤æµæ°´çº¿ï¼Œä¾‹å¦‚æ”¯æŒåŒæ—¶æ‰§è¡Œ å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å› çš„å¤„ç†å™¨ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºäº”çº§æŒ‡ä»¤æµæ°´çº¿ã€‚è¿™æ—¶ CPU å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒåŒæ—¶è¿è¡Œäº”æ¡æŒ‡ä»¤çš„ä¸åŒé˜¶æ®µï¼ˆç›¸å½“äºä¸€æ¡æ‰§è¡Œæ—¶é—´æœ€é•¿çš„å¤æ‚æŒ‡ä»¤ï¼‰ï¼ŒIPC = 1ï¼Œæœ¬è´¨ä¸Šï¼Œæµæ°´çº¿æŠ€æœ¯å¹¶ä¸èƒ½ç¼©çŸ­å•æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œä½†å®ƒå˜ç›¸åœ°æé«˜äº†æŒ‡ä»¤åœ°ååç‡ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220531005822.png]]\nä¼˜åŒ–ä¸º\n![[z-oblib/z2-attachments/Pasted image 20220531005812.png]]\n\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E5%BA%8F":{"title":"æŒ‡ä»¤é‡æ’åº","content":"# æŒ‡ä»¤é‡æ’åº\n\nè®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’ã€‚\n\n**ä¸ºä»€ä¹ˆæŒ‡ä»¤é‡æ’åºå¯ä»¥æé«˜æ€§èƒ½ï¼Ÿ**\n\nç®€å•åœ°è¯´ï¼Œæ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåŒ…å«å¤šä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤å¯èƒ½ä½¿ç”¨ä¸åŒçš„ç¡¬ä»¶ã€‚å› æ­¤ï¼Œ**æµæ°´çº¿æŠ€æœ¯**äº§ç”Ÿäº†ï¼Œå®ƒçš„åŸç†æ˜¯æŒ‡ä»¤1è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå°±å¯ä»¥å¼€å§‹æ‰§è¡ŒæŒ‡ä»¤2ï¼Œè€Œä¸ç”¨ç­‰åˆ°æŒ‡ä»¤1æ‰§è¡Œç»“æŸä¹‹åå†æ‰§è¡ŒæŒ‡ä»¤2ï¼Œè¿™æ ·å°±å¤§å¤§æé«˜äº†æ•ˆç‡ã€‚\n\nä½†æ˜¯ï¼Œæµæ°´çº¿æŠ€æœ¯æœ€å®³æ€•**ä¸­æ–­**ï¼Œæ¢å¤ä¸­æ–­çš„ä»£ä»·æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³å°½åŠæ³•ä¸è®©æµæ°´çº¿ä¸­æ–­ã€‚æŒ‡ä»¤é‡æ’å°±æ˜¯å‡å°‘ä¸­æ–­çš„ä¸€ç§æŠ€æœ¯ã€‚\n\næˆ‘ä»¬åˆ†æä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä»£ç çš„æ‰§è¡Œæƒ…å†µï¼š\n\n```java\na = b + c;\nd = e - f;\n```\n\nå…ˆåŠ è½½bã€cï¼ˆ**æ³¨æ„ï¼Œå³æœ‰å¯èƒ½å…ˆåŠ è½½bï¼Œä¹Ÿæœ‰å¯èƒ½å…ˆåŠ è½½c**ï¼‰ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œadd(b,c)çš„æ—¶å€™ï¼Œéœ€è¦ç­‰å¾…bã€cè£…è½½ç»“æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å¢åŠ äº†åœé¡¿ï¼Œé‚£ä¹ˆåé¢çš„æŒ‡ä»¤ä¹Ÿä¼šä¾æ¬¡æœ‰åœé¡¿,è¿™é™ä½äº†è®¡ç®—æœºçš„æ‰§è¡Œæ•ˆç‡ã€‚\n\nä¸ºäº†å‡å°‘è¿™ä¸ªåœé¡¿ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåŠ è½½eå’Œf,ç„¶åå†å»åŠ è½½add(b,c),è¿™æ ·åšå¯¹ç¨‹åºï¼ˆä¸²è¡Œï¼‰æ˜¯æ²¡æœ‰å½±å“çš„,ä½†å´å‡å°‘äº†åœé¡¿ã€‚æ—¢ç„¶add(b,c)éœ€è¦åœé¡¿ï¼Œé‚£è¿˜ä¸å¦‚å»åšä¸€äº›æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚\n\nç»¼ä¸Šæ‰€è¿°ï¼Œ**æŒ‡ä»¤é‡æ’å¯¹äºæé«˜CPUå¤„ç†æ€§èƒ½ååˆ†å¿…è¦ã€‚è™½ç„¶ç”±æ­¤å¸¦æ¥äº†ä¹±åºçš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç‚¹ç‰ºç‰²æ˜¯å€¼å¾—çš„ã€‚**\n\næŒ‡ä»¤é‡æ’ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š\n\n- **ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’**\n    ç¼–è¯‘å™¨åœ¨**ä¸æ”¹å˜å•[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ç¨‹åºè¯­ä¹‰**çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚\n- **æŒ‡ä»¤å¹¶è¡Œé‡æ’**\n    ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœ**ä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§**(å³åä¸€ä¸ªæ‰§è¡Œçš„è¯­å¥æ— éœ€ä¾èµ–å‰é¢æ‰§è¡Œçš„è¯­å¥çš„ç»“æœ)ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”çš„æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚\n- **å†…å­˜ç³»ç»Ÿé‡æ’**\n    ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»å†™ç¼“å­˜å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½(load)å’Œå­˜å‚¨(store)æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œï¼Œå› ä¸ºä¸‰çº§ç¼“å­˜çš„å­˜åœ¨ï¼Œå¯¼è‡´å†…å­˜ä¸ç¼“å­˜çš„æ•°æ®[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åŒæ­¥|åŒæ­¥]]å­˜åœ¨æ—¶é—´å·®ã€‚\n\n**æŒ‡ä»¤é‡æ’å¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰ä¸€è‡´ï¼Œä½†æ˜¯æ²¡æœ‰ä¹‰åŠ¡ä¿è¯å¤šçº¿ç¨‹é—´çš„è¯­ä¹‰ä¹Ÿä¸€è‡´**ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8":{"title":"æ ‡å¿—å¯„å­˜å™¨","content":"# æ ‡å¿—å¯„å­˜å™¨\n\nç»“æ„ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220912223816.png]]\n\n\nå«ä¹‰ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220912223822.png]]\n\n- çŠ¶æ€æ ‡å¿—\n    - ç”¨äºè®°å½•ç¨‹åºè¿è¡Œç»“æœçš„çŠ¶æ€ä¿¡æ¯\n        - CF è¿›ä½æ ‡å¿— (Carry Flag)\n            - å½“è¿ç®—ç»“æœçš„æœ€é«˜æœ‰æ•ˆä½æœ‰è¿›ä½(åŠ æ³•)æˆ–å€Ÿä½(å‡æ³•)æ—¶, ç½® 1, å¦åˆ™ 0\n        - ZF é›¶æ ‡å¿— (Zero Flag)\n            - å¼±è¿ç®—ç»“æœä¸º 0, åˆ™ç½® 1, å¦åˆ™ 0\n        - SF ç¬¦å·æ ‡å¿— (Sign Flag)\n            - è‹¥è¿ç®—ç»“æœæœ€é«˜ä½(ç¬¦å·ä½)ä¸º 1, åˆ™ç½® 1, å¦åˆ™ 0\n        - PF å¥‡å¶æ ‡å¿— (Parity Flag)\n            - è¿ç®—ç»“æœæœ€ä½å­—èŠ‚ä¸­ 1 çš„ä¸ªæ•°ä¸º 0 æˆ–å¶æ•°, åˆ™ç½® 1, å¦åˆ™ 0\n        - OF æº¢å‡ºæ ‡å¿— (Overflow Flag)\n            - è¿ç®—ç»“æœæœ‰æº¢å‡º, åˆ™ç½® 1, å¦åˆ™ 0\n            - æº¢å‡º: æœ‰ç¬¦å·æ•°çš„è¿ç®—ç»“æœä¸æ­£ç¡®\n        - AF è¾…åŠ©è¿›ä½æ ‡å¿— (Auxiliary Carry Flag)\n            - è¿ç®—æ—¶ D3 (ä½åŠå­—èŠ‚) æœ‰è¿›ä½æˆ–å€Ÿä½, ç½®1, å¦åˆ™ 0\n- æ§åˆ¶æ ‡å¿—\n    - ç”¨äºæ§åˆ¶å¤„ç†å™¨æ‰§è¡ŒæŒ‡ä»¤\n        - DF æ–¹å‘æ ‡å¿— (Direction Flag)\n            - ç”¨äºä¸²æ“ä½œæŒ‡ä»¤, æ§åˆ¶åœ°å€çš„å˜åŒ–æ–¹å‘\n            - 1 åˆ™å­˜å‚¨å™¨åœ°å€è‡ªåŠ¨å¢åŠ \n            - 0 åˆ™å­˜å‚¨å™¨åœ°å€è‡ªåŠ¨å‡å°‘\n            - `CLD` ç”¨äºå¤ä½ DF = 0\n            - `STD` ç”¨äºç½®ä½ DF = 1\n        - IF ç»ˆç«¯å…è®¸æ ‡å¿— (Interrupt-enable Flag)\n            - 0 ç¦æ­¢ä¸­æ–­\n            - 1 å…è®¸ä¸­æ–­\n            - `CLI` ç”¨äºå¤ä½ IF = 0\n            - `STI` ç”¨äºç½®ä½ IF = 1\n        - TF é™·é˜±æ ‡å¿— (Trap Flag)\n            - 0 å¤„ç†å™¨æ­£å¸¸å·¥ä½œ\n            - 1 å¤„ç†å™¨å•æ­¥æ‰§è¡Œ\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%A0%88%E5%B8%A7":{"title":"æ ˆå¸§","content":"\n# æ ˆå¸§\n\nå½“å‰å‡½æ•°å¯ç”¨çš„æ ˆç©ºé—´ï¼Œç§°ä¸ºè¯¥å‡½æ•°çš„æ ˆå¸§ã€‚\n\nå‡½æ•°çš„å±€éƒ¨å˜é‡å’Œå½¢å‚ä¼šåˆ†é…åœ¨æ ˆå¸§ä¸­ã€‚\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AE%B5%E5%AF%84%E5%AD%98%E5%99%A8":{"title":"æ®µå¯„å­˜å™¨","content":"# æ®µå¯„å­˜å™¨\n\n- 8086CPU æœ‰ 4 ä¸ªæ®µå¯„å­˜å™¨\n- æ¯ä¸ªæ®µå¯„å­˜å™¨ç”¨æ¥ç¡®å®šä¸€ä¸ªé€»è¾‘æ®µçš„èµ·å§‹ä½ç½®\n- æ¯ç§é€»è¾‘æ®µå‡æœ‰è‡ªå·±çš„ç”¨é€”\n    - CS: ä»£ç æ®µå¯„å­˜å™¨ (Code Segment)\n        - åˆ©ç”¨ CS:IP å–å¾—ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤\n    - DS: æ•°æ®æ®µå¯„å­˜å™¨ (Data Segment)\n        - åˆ©ç”¨ DS:EA å­˜å–æ•°æ®æ®µä¸­çš„æ•°æ®\n    - SS: æ ˆæ®µå¯„å­˜å™¨ (Stach Segment)\n        - åˆ©ç”¨ CS:IP æ“ä½œå †æ ˆé¡¶çš„æ•°æ®\n    - ES: é™„åŠ æ®µå¯„å­˜å™¨ (Extra Segment)\n        - åˆ©ç”¨ ES:EA å­˜å–é™„åŠ æ®µä¸­çš„æ•°æ®\n\n- EA æ˜¯åç§»åœ°å€, ç§°ä¹‹ä¸ºæœ‰æ•ˆåœ°å€ EA\n- è‹¥æ“ä½œæ•°åœ¨ä¸»å­˜ä¸­, å­˜å–çš„æ–¹å¼æœ‰:\n\t- ç›´æ¥å¯»å€\n\t- å¯„å­˜å™¨é—´æ¥å¯»å€\n\t- å¯„å­˜å™¨ç›¸å¯¹å¯»å€\n\t- åŸºå€å˜å€å¯»å€\n\t- ç›¸å¯¹åŸºå€å˜å€å¯»å€\n\n- æ²¡æœ‰æŒ‡æ˜æ®µå‰ç¼€æ—¶, ä¸€èˆ¬çš„æ•°æ®è®¿é—®åœ¨ DS (uæ•°æ®) æ®µ\n    - `MOV AX, [1000H]` == `MOV AX,DS:[1000H]`\n        - ä»é»˜è®¤çš„ DS æ®µä¸­å–å‡ºæ•°æ®\n    - `MOV AX,CS:[1000H]`\n        - ä»æŒ‡å®šçš„ CS æ®µå–å‡ºæ•°æ®\n\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AE%B5%E5%AF%84%E5%AD%98%E5%99%A8-1":{"title":"æ®µå¯„å­˜å™¨","content":"\n# æ®µå¯„å­˜å™¨\n\næ®µå¯„å­˜å™¨æ˜¯å› ä¸ºå¯¹å†…å­˜çš„[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åˆ†æ®µ|åˆ†æ®µ]]ç®¡ç†è€Œè®¾ç½®çš„ã€‚\nè®¡ç®—æœºéœ€è¦å¯¹å†…å­˜åˆ†æ®µï¼Œä»¥åˆ†é…ç»™ä¸åŒçš„ç¨‹åºä½¿ç”¨ã€‚åœ¨æè¿°å†…å­˜åˆ†æ®µæ—¶ï¼Œéœ€è¦æœ‰å¦‚ä¸‹æ®µçš„ä¿¡æ¯ï¼š\n1. æ®µçš„å¤§å°\n2. æ®µçš„èµ·å§‹åœ°å€\n3. æ®µçš„ç®¡ç†å±æ€§ï¼ˆç¦æ­¢å†™å…¥/ç¦æ­¢æ‰§è¡Œ/ç³»ç»Ÿä¸“ç”¨ç­‰ï¼‰ã€‚\n\néœ€è¦ç”¨8ä¸ªå­—èŠ‚ï¼ˆ64ä½ï¼‰å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼Œä½†æ®µå¯„å­˜å™¨åªæœ‰16ä½ï¼Œå› æ­¤æ®µå¯„å­˜å™¨ä¸­åªèƒ½å­˜å‚¨æ®µå·ï¼ˆsegment selectorï¼Œä¹Ÿè¯‘ä½œâ€œæ®µé€‰æ‹©ç¬¦â€ï¼‰ï¼Œå†ç”±æ®µå·æ˜ å°„åˆ°å­˜åœ¨å†…å­˜ä¸­çš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/GDT|GDT]]ï¼Œè¯»å–æ®µçš„ä¿¡æ¯ã€‚\n\n## å¯„å­˜å™¨å€¼\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923214544.png]]\n\næ®µå¯„å­˜å™¨åŒ…å«indexã€LDT/GDTã€PL\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AE%B5%E7%9A%84%E7%BB%84%E7%BB%87%E6%96%B9%E5%BC%8F":{"title":"æ®µçš„ç»„ç»‡æ–¹å¼","content":"\n# æ®µçš„ç»„ç»‡æ–¹å¼\n\næ“ä½œç³»ç»Ÿè¦æ±‚ç¼–å†™çš„ç¨‹åºè¿›è¡Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åˆ†æ®µ|åˆ†æ®µ]]ï¼ŒC/CPPç¼–è¯‘å™¨å¸®æˆ‘ä»¬åšäº†è¿™ä¸ªæ“ä½œã€‚\n\n## æ®µçš„å½¢æˆ\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20221002203843.png]]\n\nå¤šä¸ªåŒç±»å‹çš„.oæ–‡ä»¶çš„åŒºé—´ï¼ˆèŠ‚ï¼‰ä¼šåˆå¹¶æˆä¸€ä¸ªæ®µã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20221002211006.png]]\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AE%B5%E9%A1%B5%E5%BC%8F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86":{"title":"æ®µé¡µå¼å†…å­˜ç®¡ç†","content":"\n# æ®µé¡µå¼å†…å­˜ç®¡ç†\n\nç»“åˆäº†[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åˆ†æ®µ|åˆ†æ®µ]]å’Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åˆ†é¡µ|åˆ†é¡µ]]çš„ä¼˜ç‚¹ï¼š\n\nå°†ç¨‹åºåˆ†ä¸ºå¤šä¸ªé€»è¾‘æ®µï¼Œåœ¨**æ¯ä¸ªæ®µé‡Œé¢åˆè¿›è¡Œåˆ†é¡µ**ï¼Œå³å°†åˆ†æ®µå’Œåˆ†é¡µç»„åˆèµ·æ¥ä½¿ç”¨ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923210822.png]]\n\n## å®ç°\n\nåœ¨æ®µé¡µå¼ç³»ç»Ÿä¸­ï¼Œä½œä¸šçš„é€»è¾‘åœ°å€åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ®µå·ã€é¡µå·å’Œé¡µå†…åç§»é‡ï¼š\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923210848.png]]\né€šè¿‡åœ¨å“ªä¸€æ®µçš„é‚£ä¸€é¡µçš„åç§»å¤šå°‘æ¥å®šä½å†…å­˜ä½ç½®ã€‚\n\nç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹å»ºç«‹ä¸€å¼ æ®µè¡¨ï¼Œè€Œæ¯ä¸ªåˆ†æ®µæœ‰ä¸€å¼ é¡µè¡¨ï¼ˆåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ®µè¡¨åªæœ‰ä¸€ä¸ªï¼Œè€Œé¡µè¡¨å¯èƒ½æœ‰å¤šä¸ªï¼‰ã€‚ç³»ç»Ÿä¸­è¿˜åº”æœ‰ä¸€ä¸ªæ®µå¯„å­˜å™¨ï¼ŒæŒ‡å‡ºä½œä¸šçš„æ®µè¡¨èµ·å§‹åœ°å€å’Œæ®µè¡¨é•¿åº¦ã€‚\n\n## åœ°å€å˜æ¢\n\né¦–å…ˆé€šè¿‡**æ®µè¡¨æŸ¥åˆ°é¡µè¡¨èµ·å§‹åœ°å€ï¼Œç„¶åé€šè¿‡é¡µè¡¨æ‰¾åˆ°é¡µå¸§å·ï¼Œæœ€åå½¢æˆç‰©ç†åœ°å€**ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè¿›è¡Œä¸€æ¬¡è®¿é—®å®é™…éœ€è¦ä¸‰æ¬¡è®¿é—®ä¸»å­˜ï¼Œè¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨å¿«è¡¨ä»¥åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦ï¼Œå…¶å…³é”®å­—ç”±æ®µå·ã€é¡µå·ç»„æˆï¼Œå€¼æ˜¯å¯¹åº”çš„é¡µå¸§å·å’Œä¿æŠ¤ç ã€‚\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923212952.png]]\n\n## å‚è€ƒ\n\n[(1æ¡æ¶ˆæ¯) æ®µé¡µå¼å†…å­˜ç®¡ç†_~é’èä¹‹æœ«~çš„åšå®¢-CSDNåšå®¢_æ®µé¡µå¼å†…å­˜ç®¡ç†](https://blog.csdn.net/daaikuaichuan/article/details/88649113)\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%B5%81":{"title":"æµ","content":"# æµ\n\n\u003e [2ã€æ–‡ä»¶æŒ‡é’ˆä¸æ–‡ä»¶æè¿°ç¬¦ - å­¤æƒ…å‰‘å®¢ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/The-explosion/articles/12246297.html)\n\nåœ¨Cè¯­è¨€ä¸­å¼•å…¥äº†æµ(stream)çš„æ¦‚å¿µã€‚å®ƒ**å°†æ•°æ®çš„è¾“å…¥è¾“å‡ºçœ‹åšæ˜¯æ•°æ®çš„æµå…¥å’Œæµå‡º**ï¼Œè¿™æ ·ä¸ç®¡æ˜¯ç£ç›˜æ–‡ä»¶æˆ–è€…æ˜¯ç‰©ç†è®¾å¤‡ï¼ˆæ‰“å°æœºï¼Œæ˜¾ç¤ºå™¨ï¼Œé”®ç›˜ç­‰ï¼‰éƒ½å¯ä»¥çœ‹åšä¸€ç§æµçš„æºå’Œç›®çš„åœ°ï¼Œè§†ä»–ä»¬ä¸ºåŒä¸€ç§ä¸œè¥¿ï¼Œè€Œä¸ç®¡å…¶å…·ä½“çš„ç‰©ç†ç»“æ„ï¼Œå³å¯¹ä»–ä»¬çš„æ“ä½œï¼Œå°±æ˜¯æ•°æ®çš„æµå…¥å’Œæµå‡ºã€‚è¿™ç§æŠŠæ•°æ®çš„è¾“å…¥è¾“å‡ºä½œä¸ºæ“ä½œå¯¹è±¡ï¼ŒæŠ½è±¡åŒ–ä¸ºä¸€ç§æµï¼Œè€Œä¸ç®¡å®ƒçš„å…·ä½“ç»“æ„çš„æ–¹æ³•æœ‰åˆ©äºç¼–ç¨‹ï¼Œè€Œè®¾è®¡æµçš„è¾“å‡ºæ“ä½œçš„å‡½æ•°å¯ç”¨äºå„ç§å¯¹è±¡ï¼Œä¸å…·ä½“çš„å®ä½“æ— å…³ï¼Œå³å…·æœ‰é€šç”¨æ€§ã€‚\n\næ ‡å‡†I/Oåº“çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å›´ç»•æµæ¥è¿›è¡Œçš„ï¼Œåœ¨æ ‡å‡†I/Oä¸­æµç”¨FILE *æ¥æè¿°ã€‚\n\næ ‡å‡†I/Oçš„æ ¸å¿ƒå¯¹è±¡å°±æ˜¯æµã€‚å½“ç”¨æ ‡å‡†I/Oæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªFILEç»“æ„ä½“æè¿°è¯¥æ–‡ä»¶ï¼ˆæˆ–è€…ç†è§£ä¸ºåˆ›å»ºä¸€ä¸ªFILEç»“æ„ä½“å’Œå®é™…æ‰“å¼€çš„æ–‡ä»¶å…³è”èµ·æ¥ï¼‰ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªFILEç»“æ„ä½“å½¢è±¡çš„ç§°ä¸ºæµã€‚æ ‡å‡†I/Oå‡½æ•°éƒ½åŸºäºæµè¿›è¡Œå„ç§æ“ä½œã€‚\n\nCè¯­è¨€å°†æ¯ä¸ªæ–‡ä»¶ç®€å•åœ°ä½œä¸ºé¡ºåºå­—èŠ‚æµ(å¦‚ä¸‹å›¾)ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220802234132.png]]\n\næ¯ä¸ªæ–‡ä»¶ç”¨æ–‡ä»¶ç»“æŸç¬¦ç»“æŸï¼Œæˆ–è€…åœ¨ç‰¹å®šå­—èŠ‚æ•°çš„åœ°æ–¹ç»“æŸï¼Œè¿™ä¸ªç‰¹å®šçš„å­—èŠ‚æ•°å¯ä»¥å­˜å‚¨åœ¨ç³»ç»Ÿç»´æŠ¤çš„ç®¡ç†æ•°æ®ç»“æ„ä¸­ã€‚\nå½“æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œå°±å»ºç«‹äº†å’Œæ–‡ä»¶çš„å…³ç³»ã€‚åœ¨å¼€å§‹æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œå°†è‡ªåŠ¨æ‰“å¼€3ä¸ªæ–‡ä»¶å’Œç›¸å…³çš„æµï¼šæ ‡å‡†è¾“å…¥æµã€æ ‡å‡†è¾“å‡ºæµå’Œæ ‡å‡†é”™è¯¯ã€‚**æµæä¾›äº†æ–‡ä»¶å’Œç¨‹åºçš„é€šä¿¡é€šé“**ã€‚ä¾‹å¦‚ï¼Œæ ‡å‡†è¾“å…¥æµä½¿å¾—ç¨‹åºå¯ä»¥ä»é”®ç›˜è¯»å–æ•°æ®ï¼Œè€Œæ ‡å‡†è¾“å‡ºæµä½¿å¾—ç¨‹åºå¯ä»¥åœ¨å±å¹•ä¸Šè¾“å‡ºæ•°æ®ã€‚\n\næ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å°†è¿”å›æŒ‡å‘FILEç»“æ„(åœ¨stdio.hä¸­å®šä¹‰)çš„æŒ‡é’ˆï¼Œå®ƒåŒ…å«ç”¨äºå¤„ç†æ–‡ä»¶çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªç»“æ„åŒ…å«[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ–‡ä»¶æè¿°ç¬¦|æ–‡ä»¶æè¿°ç¬¦]]ã€‚æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯æ˜¯ç”¨[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ–‡ä»¶æŒ‡é’ˆ|æ–‡ä»¶æŒ‡é’ˆ]]stdinã€stdoutå’Œstderræ¥å¤„ç†çš„ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E7%A8%8B%E5%BA%8F":{"title":"ç¨‹åº","content":"\n# ç¨‹åº\n\nç¨‹åºæ˜¯è®¡ç®—æœºæŒ‡ä»¤çš„é›†åˆï¼Œå­˜æ”¾åœ¨ç£ç›˜ä¸­ã€‚\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6":{"title":"ç«æ€æ¡ä»¶","content":"# ç«æ€æ¡ä»¶\n\nrace condition\n\nå¤šä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]åœ¨[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/ä¸´ç•ŒåŒº|ä¸´ç•ŒåŒº]]å†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒï¼Œè€Œå¯¼è‡´çš„ç»“æœæ— æ³•é¢„æµ‹ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E7%BA%BF%E7%A8%8B":{"title":"çº¿ç¨‹","content":"# çº¿ç¨‹\n\nçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„å­ä»»åŠ¡ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹å æœ‰çš„å†…å­˜ç©ºé—´å’ŒI/Oã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81":{"title":"çº¿ç¨‹çŠ¶æ€","content":"# çº¿ç¨‹çŠ¶æ€\n\næ“ä½œç³»ç»Ÿå±‚é¢æœ‰5ç§çŠ¶æ€ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220526173846.png]]\n\n- ã€åˆå§‹çŠ¶æ€ã€‘ä»…æ˜¯åœ¨è¯­è¨€å±‚é¢åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æœªä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ã€‚\n- ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰æŒ‡è¯¥çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼ˆä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼‰ï¼Œå¯ä»¥ç”± CPU è°ƒåº¦æ‰§è¡Œã€‚\n- ã€è¿è¡ŒçŠ¶æ€ã€‘æŒ‡è·å–äº† CPU æ—¶é—´ç‰‡è¿è¡Œä¸­çš„çŠ¶æ€ã€‚\n\t- å½“ CPU æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¼šä»ã€è¿è¡ŒçŠ¶æ€ã€‘è½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢\n- ã€é˜»å¡çŠ¶æ€ã€‘ã€‚\n\t- å¦‚æœè°ƒç”¨äº†é˜»å¡ APIï¼Œå¦‚ BIO è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹å®é™…ä¸ä¼šç”¨åˆ° CPUï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥ã€é˜»å¡çŠ¶æ€ã€‘ã€‚\n\t- ç­‰ BIO æ“ä½œå®Œæ¯•ï¼Œä¼šç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œè½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ã€‚\n\t- ä¸ã€å¯è¿è¡ŒçŠ¶æ€ã€‘çš„åŒºåˆ«æ˜¯ï¼Œå¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„çº¿ç¨‹æ¥è¯´åªè¦å®ƒä»¬ä¸€ç›´ä¸å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸€ç›´ä¸ä¼šè€ƒè™‘è°ƒåº¦å®ƒä»¬ã€‚\n- ã€ç»ˆæ­¢çŠ¶æ€ã€‘è¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E8%87%AA%E6%97%8B":{"title":"è‡ªæ—‹","content":"# è‡ªæ—‹\n\nä¸æ–­å°è¯•å»è·å–é”ï¼Œä¸€èˆ¬ç”¨å¾ªç¯æ¥å®ç°ã€‚\n\nè‡ªæ—‹æ˜¯éœ€è¦æ¶ˆè€—CPUçš„ï¼Œå¦‚æœä¸€ç›´è·å–ä¸åˆ°é”çš„è¯ï¼Œé‚£è¯¥çº¿ç¨‹å°±ä¸€ç›´å¤„åœ¨è‡ªæ—‹çŠ¶æ€ï¼Œç™½ç™½æµªè´¹CPUèµ„æºã€‚ ^f17d9d","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98":{"title":"è™šæ‹Ÿå†…å­˜","content":"\n# è™šæ‹Ÿå†…å­˜\n\nå¯¹äºç¨‹åºæ¥è¯´ï¼Œç†è®ºä¸Šå¯ä»¥ç”Ÿæˆæ•´ä¸ªå†…å­˜å¯»å€èŒƒå›´è¿™ä¹ˆå¤§çš„å†…å­˜ï¼Œä½†å®é™…ä¸Šå†…å­˜æ˜¯å¤šä¸ªç¨‹åºå…±äº«çš„ã€‚\n\nè™šæ‹Ÿæ˜¯æŒ‡ï¼šæ“ä½œç³»ç»Ÿéª—ç¨‹åºæˆ‘ç»™ä½ äº†æ•´ç‰‡ç©ºé—´ï¼Œä½†å®é™…ç‰©ç†å†…å­˜å¹¶æ²¡æœ‰åˆ†é…ï¼Œä¸ºäº†é˜²æ­¢ç¨‹åºå‘è§‰åˆ°é—®é¢˜ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡è™šæ‹Ÿå†…å­˜æ˜ å°„å’Œäº¤æ¢å†…å­˜çš„æ–¹å¼ï¼Œå°†è™šæ‹Ÿå†…å­˜æŒ‰éœ€æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œæš‚æ—¶ä¸ç”¨çš„å°±æ”¾åˆ°ç£ç›˜ä¸Šï¼Œç”¨åˆ°äº†å°±èµ¶ç´§æ‹¿è¿‡æ¥æ”¾åˆ°å†…å­˜é‡Œã€‚\n\nä¸ºäº†åŠ é€Ÿè™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€çš„è½¬æ¢ï¼Œä½¿ç”¨ä¸“é—¨çš„ç¡¬ä»¶è®¾å¤‡æ¥åšæ˜ å°„ï¼šMMUã€‚\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E8%BF%9B%E7%A8%8B":{"title":"è¿›ç¨‹","content":"\n# è¿›ç¨‹\n\nè¿›ç¨‹æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/ç¨‹åº|ç¨‹åº]]è¿è¡Œçš„å®ä¾‹ï¼Œå¯¹ç¨‹åºè¿è¡Œæ—¶å¯¹è®¡ç®—æœºèµ„æºä½¿ç”¨æƒ…å†µçš„æè¿°ã€‚\nè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB":{"title":"è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«","content":"# è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«\n\n- [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]åŸºæœ¬ä¸Šç›¸äº’ç‹¬ç«‹çš„ï¼Œç›¸äº’ä¹‹é—´ç‹¬å å†…å­˜åœ°å€ç©ºé—´å’Œç³»ç»Ÿèµ„æºï¼ˆI/Oç­‰ï¼‰ï¼›è€Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›†ã€‚\n- è¿›ç¨‹æ‹¥æœ‰å…±äº«çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ç­‰ï¼Œä¾›å…¶å†…éƒ¨çš„çº¿ç¨‹å…±äº«ã€‚\n- è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ã€‚\n\t- åŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡ç§°ä¸º IPCï¼ˆInter-process communicationï¼‰ã€‚\n\t- ä¸åŒè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶éµå®ˆå…±åŒçš„åè®®ï¼Œä¾‹å¦‚ HTTPã€‚\n- çº¿ç¨‹é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ï¼Œä¸€ä¸ªä¾‹å­æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ã€‚\n- è¿›ç¨‹ç®¡ç†å¼€é”€æ›´å¤§ï¼Œè¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ä¸ä»…éœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œè¿˜éœ€è¦èµ„æºçš„åˆ†é…å›æ”¶ä»¥åŠé¡µè°ƒåº¦ã€‚\n- çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½ï¼Œçº¿ç¨‹åªéœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ã€‚\n\n## ä¸åŒå¹³å°å’Œè¯­è¨€ä¸‹çš„åŒºåˆ«\n\n- Java ä¸­ï¼Œçº¿ç¨‹ä½œä¸ºæœ€å°è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚\n- åœ¨ windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œä¸ºçº¿ç¨‹çš„å®¹å™¨ã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E9%A1%B5%E8%A1%A8":{"title":"é¡µè¡¨","content":"\n# é¡µè¡¨\n\n\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923202638.png]]\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/CPU%E7%BC%93%E5%AD%98":{"title":"CPUç¼“å­˜","content":"# CPUç¼“å­˜\n\n![[z-oblib/z2-attachments/Pasted image 20220602143516.png]]\n\n| ä» cpu åˆ° | å¤§çº¦éœ€è¦çš„æ—¶é’Ÿå‘¨æœŸ                 |\n|------------|-----------------------|\n| å¯„å­˜å™¨ | 1 cycle (4GHz çš„ CPU çº¦ä¸º0.25ns) |\n| L1| 3~4 cycle                      |\n| L2| 10~20 cycle                    |\n| L3| 40~45 cycle                    |\n| å†…å­˜| 120~240 cycle                  |\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/DMA":{"title":"DMA","content":"\n# DMA\n\nDirect Memory Access ç›´æ¥å†…å­˜è®¿é—®æ§åˆ¶å™¨\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/MESI":{"title":"MESI","content":"# MESI\n\n**Mï¼šä»£è¡¨å·²ä¿®æ”¹ï¼ˆModifiedï¼‰**ï¼šCache Block é‡Œé¢çš„å†…å®¹æˆ‘ä»¬å·²ç»æ›´æ–°è¿‡äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å†™å›åˆ°ä¸»å†…å­˜é‡Œé¢ï¼›  \n**Eï¼šä»£è¡¨ç‹¬å ï¼ˆExclusiveï¼‰**ï¼šCache Block é‡Œé¢çš„æ•°æ®å’Œä¸»å†…å­˜é‡Œé¢çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼›  \n**Sï¼šä»£è¡¨å…±äº«ï¼ˆSharedï¼‰**ï¼šCache Block é‡Œé¢çš„æ•°æ®å’Œä¸»å†…å­˜é‡Œé¢çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼›  \n**Iï¼šä»£è¡¨å·²å¤±æ•ˆï¼ˆInvalidatedï¼‰**ï¼šCache Block é‡Œé¢çš„æ•°æ®å·²ç»å¤±æ•ˆäº†ï¼Œä¸å¯ä»¥ç›¸ä¿¡è¿™ä¸ª Cache Block é‡Œé¢çš„æ•°æ®ï¼›\n\n![[z-oblib/z2-attachments/24483793-3cef70653d60cdf9.webp]]\n\n## é—®é¢˜\nCPUæ“ä½œåˆ†ä¸ºä¸¤ç§ï¼šloadï¼ˆè¯»ï¼‰ã€storeï¼ˆå†™ï¼‰ï¼ŒåŠ å…¥ç¼“å­˜çš„ç›®çš„æ˜¯æå‰ç¼“å­˜å†…å­˜çš„æ•°æ®ï¼Œæé«˜loadçš„æ•ˆç‡ï¼Œä½†æ˜¯storeçš„é€Ÿåº¦é™ä½äº†ï¼Œå› ä¸ºCPUå°†æ•°æ®storeåˆ°å†…å­˜å¤šäº†å†™ç¼“å­˜çš„æ­¥éª¤ï¼Œå¹¶ä¸”éœ€è¦åŒæ­¥æ‰€æœ‰CPUçš„ç§æœ‰ç¼“å­˜ã€‚è¿™æ ·storeæ“ä½œä¼šä¸¥é‡é˜»å¡åç»­çš„loadæ“ä½œï¼Œè¿™æ ·åŠ ç¼“å­˜çš„æ„ä¹‰å®Œå…¨å°±æ²¡æœ‰äº†ï¼Œä¸ä»…æ²¡èƒ½æé«˜loadçš„æ•ˆç‡ï¼Œåè€Œé˜»å¡äº†loadã€‚ä¸ºäº†è§£å†³loadè¢«é˜»å¡çš„é—®é¢˜ï¼Œåœ¨CPUä¸­åŠ å…¥äº†æ–°çš„ç»„ä»¶store bufferï¼ˆå†™é˜Ÿåˆ—ï¼‰ï¼›\n\n![[z-oblib/z2-attachments/24483793-80300b10191392a0.webp]]\næ¯ä¸ªCPUéƒ½æœ‰ä¸€ä¸ªstore bufferï¼Œå½“CPUéœ€è¦æ‰§è¡Œstoreæ“ä½œæ—¶ï¼Œä¼šå°†storeæ“ä½œå…ˆæ”¾å…¥store bufferä¸­ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œstoreæ“ä½œï¼Œç­‰å¾…`åˆé€‚çš„æ—¶æœº`å†æ‰§è¡Œï¼ˆstore bufferæ»¡äº†ç­‰ç­‰æƒ…å†µä¼šçœŸæ­£æ‰§è¡Œstoreæ“ä½œï¼‰ï¼Œåœ¨storeåé¢çš„loadæ“ä½œä¸ç”¨å†ç­‰storeçœŸæ­£æ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œï¼Œåªè¦storeæ”¾å…¥äº†store bufferä¸­ï¼Œloadå°±å¯ä»¥æ‰§è¡Œäº†ã€‚\n\n## æ€»ç»“\n\nMESIåè®®çš„å¼•å…¥ä¼šå¯¼è‡´ç¼“å­˜çš„å†™å…¥æ•ˆç‡é™ä½ï¼Œæ‰€ä»¥å¼•å…¥äº†store bufferç­‰éƒ¨ä»¶ï¼Œstore bufferå°†storeæ“ä½œç¼“å­˜èµ·æ¥ï¼Œä¸ä¼šç«‹å³å†™å…¥ç¼“å­˜ï¼Œ**å¯¼è‡´å¤šCPUå†…çš„å€¼åŒæ­¥ä¼šæœ‰ä¸€å®šå»¶è¿Ÿ**ï¼Œé—´æ¥å¯¼è‡´cpuçš„æ“ä½œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/æŒ‡ä»¤é‡æ’åº|é‡æ’åº]]ï¼Œå¤šcpuçš„å…±äº«å˜é‡çš„æ“ä½œä¼šå‘ç”Ÿæ··ä¹±ï¼Œæ‰€ä»¥JMMä¸­å¯ä»¥ä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]]å¼ºåˆ¶åˆ·æ–°store bufferï¼Œè®©å¤šCPUä¸­çš„å€¼[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åŒæ­¥|åŒæ­¥]]æ²¡æœ‰å»¶è¿Ÿï¼Œä¿è¯å¤šCPUå…±äº«å˜é‡ä¸ä¼šå‘ç”Ÿæ··ä¹±ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/MMU":{"title":"MMU","content":"\n# MMU\n\nMemory Management Unitï¼Œå†…å­˜ç®¡ç†å•å…ƒã€‚\nè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ï¼ˆå³è™šæ‹Ÿå†…å­˜ç®¡ç†ï¼‰ã€å†…å­˜ä¿æŠ¤ã€ä¸­å¤®å¤„ç†å™¨é«˜é€Ÿç¼“å­˜çš„æ§åˆ¶ï¼Œåœ¨è¾ƒä¸ºç®€å•çš„è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­ï¼Œè´Ÿè´£æ€»çº¿çš„ä»²è£ä»¥åŠå­˜å‚¨ä½“åˆ‡æ¢ï¼ˆbank switchingï¼Œå°¤å…¶æ˜¯åœ¨8ä½çš„ç³»ç»Ÿä¸Šï¼‰ã€‚\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/TLB":{"title":"TLB","content":"\n# TLB\n\nTranslation Lookaside Bufferï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/é¡µè¡¨|é¡µè¡¨]]ç¼“å­˜ï¼Œè½¬å€æ—è·¯ç¼“å­˜ã€‚ç”±[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/MMU|MMU]]ç”¨äºæ”¹è¿›è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬è¯‘é€Ÿåº¦ã€‚\n\nä¸ºäº†åŠ å¿«MMUè§„åˆ™åŒ¹é…çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ‰æ•ˆåœ°å€å’Œå®é™…ç‰©ç†åœ°å€çš„å¯¹åº”è¡¨é€šå¸¸ä¿å­˜åœ¨ä¸€å—å•ç‹¬çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œ\n","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/x86%E5%AF%84%E5%AD%98%E5%99%A8":{"title":"x86å¯„å­˜å™¨","content":"# x86å¯„å­˜å™¨\n\n![[z-oblib/z2-attachments/Pasted image 20220912222502.png]]\n\nè¿™å…«ä¸ªå¯„å­˜å™¨çš„åç§°å¦‚ä¸‹ï¼šEAXï¼ˆç´¯åŠ å™¨ï¼‰ã€EBXï¼ˆåŸºå€ï¼‰ã€ECXï¼ˆè®¡æ•°ï¼‰ã€EDXï¼ˆæ•°æ®ï¼‰ã€ESPï¼ˆæ ˆæŒ‡é’ˆï¼‰ã€EBPï¼ˆåŸºå€æŒ‡é’ˆï¼‰ã€ESIï¼ˆæºå˜å€ï¼‰ã€EDIï¼ˆç›®çš„å˜å€ï¼‰ã€‚","lastmodified":"2023-01-23T15:37:51.542678635Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E4%BF%A1%E5%8F%B7":{"title":"ä¿¡å·","content":"\n# ä¿¡å·\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005234142.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005234938.png]]\n\nLinuxä¸­çš„ç»å¤§å¤šæ•°ä¿¡å·éƒ½æ˜¯ç”±å†…æ ¸å‘é€çš„ï¼Œæ‰€ä»¥åœ¨å‘é€ä¿¡å·ç»™æŸ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]ä¹‹å‰ï¼Œéœ€è¦å…ˆé™·å…¥å†…æ ¸ã€‚\n\nLinuxä¸­å®šä¹‰äº†å¾ˆå¤šä¿¡å·ç±»å‹ï¼Œè¿™äº›ä¿¡å·éƒ½æœ‰é»˜è®¤çš„å¤„ç†æ–¹å¼ï¼ˆä¾‹å¦‚çº¢ç¯äº®çš„ä¿¡å·ï¼Œäººçš„é»˜è®¤å¤„ç†æ–¹å¼æ˜¯åœä¸‹ï¼‰ï¼Œä½†ç¨‹åºå†…ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¿¡å·çš„å¤„ç†æ–¹å¼ï¼ˆä¾‹å¦‚ï¼Œçº¢ç¯äº®äº†åä¸åœï¼‰ã€‚å½“å†…æ ¸å°†ç›¸å…³ä¿¡å·å‘é€ç»™è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹æ¥æ”¶åˆ°è¿™äº›ä¿¡å·åï¼Œä¼šè§¦å‘å¯¹åº”çš„ä¿¡å·å¤„ç†ç¨‹åºå»å¤„ç†è¯¥ä¿¡å·ï¼Œä»è€Œæ‰“æ–­è¯¥è¿›ç¨‹çš„æ­£å¸¸æ‰§è¡Œæµç¨‹ã€‚\n\nåœ¨shellä¸­ï¼Œä¹Ÿæ”¯æŒä¿¡å·æœºåˆ¶ï¼Œå¯é€šè¿‡killå‘½ä»¤å‘é€ä¿¡å·ç»™æŒ‡å®šè¿›ç¨‹ã€‚å¯èƒ½è¿™é‡Œä¼šå‡ºç°ä¸€ä¸ªç–‘æƒ‘ï¼Œåˆšæ‰è¯´ä¿¡å·ç»å¤§å¤šæ•°æ˜¯ç”±å†…æ ¸å‘é€çš„ï¼Œä¸ºä»€ä¹ˆkillå‘½ä»¤ï¼ˆbashä¸‹æœ‰ä¸¤ä¸ªkillå‘½ä»¤ï¼Œä¸€ä¸ªæ˜¯bashå†…ç½®killå‘½ä»¤ï¼Œä¸€ä¸ªæ˜¯å¤–ç½®killå‘½ä»¤ï¼Œä½†æ— è®ºå¦‚ä½•ï¼Œéƒ½æ˜¯ç”¨æˆ·è¿›ç¨‹ï¼‰å¯¹åº”çš„è¿›ç¨‹èƒ½å¤Ÿå‘é€ä¿¡å·ç»™å…¶å®ƒè¿›ç¨‹ï¼Ÿè¿™æ˜¯å› ä¸ºkillå‘é€çš„ä¿¡å·å…ˆæ˜¯ä¼ é€’ç»™å†…æ ¸çš„ï¼Œå†…æ ¸å†å°†è¿™ä¸ªä¿¡å·ä¼ é€’ç»™å¯¹åº”è¿›ç¨‹ã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦è¿›è¡Œä¸€æ¬¡[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¸Šä¸‹æ–‡åˆ‡æ¢|ä¸Šä¸‹æ–‡åˆ‡æ¢]]ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803161416.png]]\n\n\n1-31æ˜¯ä¸å¯é ä¿¡å·ï¼Œä¹‹åçš„æ˜¯å¯é ä¿¡å·ã€‚å¯é æ˜¯æŒ‡é˜»å¡æ—¶å‘é€ä¿¡å·ä¼šåœ¨é‡æ–°æ¥æ”¶ä¿¡å·åå…¨éƒ¨æ”¶åˆ°è€Œä¸ä¸¢å¤±ã€‚\n\n## ç¼–ç¨‹æ¥å£\n\nå­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå­è¿›ç¨‹å¯ä»¥æ³¨å†Œæ–°çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¦†ç›–çˆ¶è¿›ç¨‹æä¾›çš„è¡Œä¸ºã€‚\n\n### æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005235717.png]]\n\n### äº§ç”Ÿä¿¡å·\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006000842.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006000914.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006005101.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006010248.png]]\n\n### æœªå†³ä¿¡å·\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006010520.png]]\n\n### ä¿¡å·é›†ç±»å‹\n\næœ¬è´¨æ˜¯æ•°ç»„ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£çœ‹æˆä¸€ä¸ªç±»å‹ï¼š\næœ‰2ä¸ªä¿¡å·é›†ï¼Œé˜»å¡ä¿¡å·ï¼Œæœªå†³ä¿¡å·ã€‚\nä¿¡å·åˆ°è¾¾å¹¶ä¸”åœ¨é˜»å¡ä¿¡å·é›†ä¸­ï¼Œåˆ™è¯¥ä¿¡å·æ˜¯ä¸€ä¸ªæœªå†³ä¿¡å·ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006010756.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006010911.png]]\n\nsetã€deleteå‰ä¿¡å·é›†å¿…é¡»åˆå§‹åŒ–ï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006010941.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006011030.png]]\n\n### è®¾ç½®è¿›ç¨‹ä¿¡å·æ©ç é›†ï¼ˆéœ€è¦å±è”½çš„ä¿¡å·é›†åˆï¼‰å¯¹æŸä¿¡å·é˜»å¡\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006011355.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006011530.png]]\n\n### è·å–è¿›ç¨‹æœªå†³ä¿¡å·é›†\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006012305.png]]\n\n### é˜»å¡ä¿¡å·\n\nå°±æ˜¯å°†ä¿¡å·åŠ å…¥åˆ°å±è”½ä¿¡å·é›†ã€‚\n","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E4%BF%A1%E5%8F%B7%E9%87%8F":{"title":"ä¿¡å·é‡","content":"# ä¿¡å·é‡\n\nä¿¡å·é‡ï¼ˆ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/Semaphore|Semaphore]]ï¼‰ä¹Ÿç§°ä¸ºä¿¡å·ç¯ï¼Œå…¸æ•…æ¥æºäºè·å…°ï¼šç«è½¦æ ¹æ®æ——æ ‡æ¥å†³å®šæ˜¯å¦é€šè¡Œã€‚\né€šè¿‡çº¢ç»¿ç¯ç†è§£[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ä¿¡å·|ä¿¡å·]]å’Œä¿¡å·é‡ï¼Œæ„Ÿè§‰å®ƒä»¬ä¼¼ä¹æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œ**ä¿¡å·é‡æœºåˆ¶æ˜¯æ ¹æ®çº¢ç»¿ç¯çš„äº‹ä»¶è®©äººç­‰å¾…ï¼ˆè¿›ç¨‹é˜»å¡ï¼‰æˆ–ä¸ç­‰å¾…ï¼ˆè¿›ç¨‹ç»§ç»­è¿è¡Œï¼‰ï¼Œåªæœ‰è¿™ä¸¤ç§è¡Œä¸º**ï¼›è€Œ**ä¿¡å·æœºåˆ¶æ˜¯æ ¹æ®çº¢ç»¿ç¯äº‹ä»¶åšå‡ºä»»ä½•å¯èƒ½çš„å¤„ç†ï¼Œå¹¶ä¸ä¸€å®šæ˜¯ç­‰å¾…ï¼ˆé˜»å¡ï¼‰æˆ–å‰è¡Œï¼ˆä¸é˜»å¡ï¼‰**ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803161603.png]]\n\nä¿¡å·é‡æœ‰å¾ˆå¤šç§å˜ä½“ï¼Œä¸‹é¢ç®€å•æè¿°å…¶ä¸­ä¸€ç§ä¿¡å·é‡çš„è§„åˆ™ï¼š\n\n\u003eåœ¨è·å…°æ–‡ä¸­ï¼Œé€šè¿‡å«passerenï¼Œé‡Šæ”¾å«vrijgevenï¼ŒPVæ“ä½œå› æ­¤å¾—åã€‚\n\n1. å¦‚æœä¸€ä¸ªè¿›ç¨‹è¯·æ±‚Pæ“ä½œ(å‡1æ“ä½œï¼Œå³è¯·æ±‚ä¸€ä¸ªä¿¡å·ç¯)ï¼Œå¦‚æœå‡å»ä¹‹åä¿¡å·é‡çš„æ•°å€¼ä¸ºè´Ÿæ•°ï¼Œåˆ™è¯¥è¿›ç¨‹è¢«é˜»å¡ï¼Œå¦‚æœå‡å»ä¹‹åä¸º0æˆ–æ­£æ•°ï¼Œåˆ™æ”¾è¡Œè¯¥è¿›ç¨‹\n2. å¦‚æœä¸€ä¸ªè¿›ç¨‹è¯·æ±‚Væ“ä½œ(åŠ 1æ“ä½œï¼Œå³é‡Šæ”¾æˆ–å¢åŠ ä¸€ä¸ªä¿¡å·ç¯)ï¼Œè¿›ç¨‹ç›´æ¥æ”¾è¡Œ\n3. å¦‚æœè¯·æ±‚Væ“ä½œï¼Œå¦‚æœåŠ 1ä¹‹åä»ä¸º0æˆ–è´Ÿæ•°ï¼Œåˆ™æ”¾è¡Œè¯¥è¿›ç¨‹çš„åŒæ—¶è¿˜å”¤é†’å¦ä¸€ä¸ªè¢«é˜»å¡çš„è¿›ç¨‹ã€‚å¦‚æœåŠ 1åä¸ºæ­£æ•°ï¼Œåˆ™ç›´æ¥æ·»åŠ ä¸€ä¸ªä¿¡å·ç¯èµ„æº\n\næ€»ç»“èµ·æ¥å¾ˆç®€å•ï¼šå¦‚æœå½“å‰æ²¡æœ‰ä¿¡å·ç¯èµ„æº(å°äºæˆ–ç­‰äº0)ï¼Œé‚£ä¹ˆæ¶ˆè´¹ä¿¡å·ç¯(PåŸè¯­)çš„è¿›ç¨‹å°±ä¼šè¢«é˜»å¡ï¼›å¦‚æœæœ‰ä¿¡å·ç¯èµ„æº(å¤§äº0)ï¼Œå°±ç›´æ¥æ”¾è¡Œã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹æ˜¯æ¥ç”Ÿäº§ä¿¡å·ç¯èµ„æºçš„(VåŸè¯­)ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹å½“ç„¶è¦æ”¾è¡Œï¼›å› ä¸ºæ·»åŠ äº†ä¸€ä¸ªä¿¡å·ç¯ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥æ‹¥æœ‰å”¤é†’ä¸€ä¸ªè¢«é˜»å¡è¿›ç¨‹çš„èƒ½åŠ›(å¦‚æœæœ‰è¢«é˜»å¡è¿›ç¨‹çš„è¯)ã€‚\n\næœ€ç®€å•çš„ä¿¡å·é‡å½“ç„¶æ˜¯åˆå§‹æ—¶åªä½¿ç”¨1ä¸ªä¿¡å·ç¯ï¼Œä»è€Œå®ç°äº’æ–¥é”ï¼ˆä¹Ÿç§°ä¸ºäº’æ–¥é‡ï¼‰æœºåˆ¶ï¼šPæ˜¯ç”³è¯·é”æ“ä½œï¼Œåªæœ‰åœ¨æœ‰å€¼ä¸º1çš„æ—¶å€™æ‰èƒ½ç”³è¯·é”ï¼Œå¦åˆ™è¢«é˜»å¡ï¼›Væ˜¯é‡Šæ”¾é”ï¼Œä¸€ç›´è¢«æ”¾è¡Œã€‚\n\n## ç¼–ç¨‹æ¥å£\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221103103419.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221103103430.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221103104219.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221103104243.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221103104551.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221103104901.png]]\n\n","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B":{"title":"åƒµå°¸è¿›ç¨‹","content":"\n# åƒµå°¸è¿›ç¨‹\n\nè¿›ç¨‹ç»ˆæ­¢åï¼Œå‰©ä½™çš„éƒ¨åˆ†ç³»ç»Ÿèµ„æºä¾‹å¦‚[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/PCB|PCB]]ç­‰ï¼Œæ²¡æœ‰è¢«çˆ¶è¿›ç¨‹[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/Linuxè¿›ç¨‹èµ„æºå›æ”¶|å›æ”¶]]ã€‚\n","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98":{"title":"å…±äº«å†…å­˜","content":"\n# å…±äº«å†…å­˜\n\nå…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰æ˜¯ç›´æ¥ä»å†…æ ¸ç»´æŠ¤çš„å†…å­˜ä¸­åˆ’åˆ†ä¸€ç‰‡å†…å­˜ï¼Œå¹¶å°†è¯¥å†…å­˜æ˜ å°„åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]ä¸­ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006014232.png]]\n\nå› ä¸ºå¯èƒ½å¤šä¸ªè¿›ç¨‹æ˜ å°„åˆ°åŒä¸€å…±äº«å†…å­˜ï¼Œæ‰€ä»¥æŸè¿›ç¨‹å¯¹æ­¤å†…å­˜æ•°æ®çš„ä¿®æ”¹ä¼šç›´æ¥å½±å“å…¶å®ƒè¿›ç¨‹ï¼Œè¿™æ ·å°±èƒ½åœ¨è¿›ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯ã€‚ä½†ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨ä½¿ç”¨å…±äº«å†…å­˜æ—¶ï¼Œåº”å½“ä¿è¯æ²¡æœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„è¿›ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«å†…å­˜æ•°æ®ã€‚\n\nå…±äº«å†…å­˜æ˜¯æ•ˆç‡æœ€é«˜çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œå®ƒå®Œå…¨å†…å­˜åŒ–æ“ä½œï¼Œä¸”æ²¡æœ‰ä»»ä½•å†…å­˜æ‹·è´è¡Œä¸ºï¼Œæ­¤å¤–ï¼Œå†…å­˜æ˜ å°„åˆ°ä¸åŒè¿›ç¨‹ä¹‹åï¼Œæ“ä½œç³»ç»Ÿå°±ä¸å†å‚ä¸è¯¥ç‰‡å†…å­˜çš„æ“ä½œï¼Œç”¨æˆ·è¿›ç¨‹å¯ä»¥æœ‰æƒè®¿é—®è¿™æ®µå†…å­˜ã€‚\n\nå†…å­˜å…±äº«å’Œ[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ–‡ä»¶æ˜ å°„|æ–‡ä»¶æ˜ å°„]]éå¸¸åƒï¼Œä¸åŒä¹‹å¤„å°±åœ¨**äºå…±äº«å†…å­˜æ²¡æœ‰å¯¹å…·ä½“çš„ç£ç›˜æ–‡ä»¶è¿›è¡Œæ˜ å°„ï¼Œè€Œæ˜¯ç›´æ¥æ˜ å°„ç‰©ç†å†…å­˜åˆ°è¿›ç¨‹ä¸­**ã€‚æ‰€ä»¥ï¼Œå®ƒä¹Ÿæ˜ å°„åœ¨è¿›ç¨‹å †æ ˆä¸­é—´çš„é‚£ç‰‡æœªåˆ†é…å†…å­˜ä¸Šã€‚å¦‚å›¾ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803160824.png]]\n\n## ç¼–ç¨‹æ¥å£\n\n### åˆ›å»ºsvipcå¯¹è±¡\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006155122.png]]\n\n### åˆ›å»ºå…±äº«å†…å­˜\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006161526.png]]\n\n### å…±äº«å†…å­˜ä¸è¿›ç¨‹å…³è”\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006162428.png]]\n\n### å…±äº«å†…å­˜ä¸è¿›ç¨‹è§£ç»‘\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006165944.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%86%99%E6%97%B6%E6%8B%B7%E8%B4%9D":{"title":"å†™æ—¶æ‹·è´","content":"\n# å†™æ—¶æ‹·è´\n\nå…±äº«æ˜ å°„æ—¶ï¼Œå†™æ“ä½œä¼šå‘ç”Ÿåœ¨æ‹·è´ç©ºé—´ï¼Œé¿å…å…¶å®ƒçº¿ç¨‹å¯¹å…±äº«å†…å­˜çš„è¯»ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004011513.png]]\n","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83":{"title":"å˜é‡å‘½åè§„èŒƒ","content":"\n# å˜é‡å‘½åè§„èŒƒ\n\n## H\n\n- hdr = HeaDeR = header\n\t- å¸¸å‡ºç°åœ¨[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ELF|elf]]ç»“æ„å®šä¹‰ä¸­ï¼Œå¦‚shdrä¸º section header\n\n## R\n\n- rel = relocation = é‡å®šä½\n\t- rel.textæŒ‡textæ®µå¯¹åº”çš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/é‡å®šä½è¡¨|é‡å®šä½è¡¨]]\n","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%9F%BA%E5%9C%B0%E5%9D%80":{"title":"åŸºåœ°å€","content":"# åŸºåœ°å€\n\n## è®¡ç®—\n\n\u003e [linux - ELFçš„åŸºåœ°å€ | ç å†œä¿±ä¹éƒ¨ - Golangä¸­å›½ - Goè¯­è¨€ä¸­æ–‡ç¤¾åŒº (mlog.club)](https://mlog.club/article/241831)\n\u003e [ELF æ–‡ä»¶ - CTF Wiki (ctf-wiki.org)](https://ctf-wiki.org/executable/elf/structure/basic-info/#-base-address)\n\n### æ–‡ä»¶çš„é»˜è®¤åŠ è½½åŸºåœ°å€\n\né€šè¿‡ `readelf -l a.out` å¯ä»¥æŸ¥çœ‹åˆ°ç¨‹åºçš„å¤´ä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªç±»å‹ä¸º`LOAD`çš„æ®µçš„è™šæ‹Ÿåœ°å€å°±æ˜¯åŸºåœ°å€ï¼š\n![[z-oblib/z2-attachments/1L)((}ZXMQ(U$39~Z`AM53R.png]]\n\nä½†è¿™ä¸ªåœ°å€å¯èƒ½å¹¶ä¸æ˜¯ç¨‹åºå†…å­˜é•œåƒä¸­å®é™…çš„è™šæ‹Ÿåœ°å€ã€‚\n\n### å†…å­˜é•œåƒçš„åŸºåœ°å€\n\nåœ°å€æ— å…³ä»£ç ä½¿ç”¨æ®µä¹‹é—´çš„ç›¸å¯¹åœ°å€æ¥è¿›è¡Œå¯»å€ï¼Œå†…å­˜ä¸­çš„è™šæ‹Ÿåœ°å€ä¹‹é—´çš„å·®å¿…é¡»ä¸æ–‡ä»¶ä¸­çš„è™šæ‹Ÿåœ°å€ä¹‹é—´çš„å·®ç›¸åŒ¹é…ã€‚\n\nå†…å­˜ä¸­ä»»ä½•æ®µçš„è™šæ‹Ÿåœ°å€ä¸æ–‡ä»¶ä¸­å¯¹åº”çš„è™šæ‹Ÿåœ°å€ä¹‹é—´çš„å·®å€¼å¯¹äºä»»ä½•ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æˆ–å…±äº«å¯¹è±¡æ¥è¯´æ˜¯ä¸€ä¸ªå•ä¸€å¸¸é‡å€¼ã€‚è¿™ä¸ªå·®å€¼å°±æ˜¯åŸºåœ°å€ï¼ŒåŸºåœ°å€çš„ä¸€ä¸ªç”¨é€”å°±æ˜¯åœ¨åŠ¨æ€é“¾æ¥æœŸé—´é‡æ–°å®šä½ç¨‹åºã€‚\n\nè¦è®¡ç®—åŸºåœ°å€ï¼Œé¦–å…ˆæ‹¿åˆ°æ–‡ä»¶é»˜è®¤åŠ è½½åŸºåœ°å€ï¼Œä¹‹åæŠŠè¯¥åœ°å€ç¼©å°ä¸ºä¸ä¹‹æœ€è¿‘çš„æœ€å¤§é¡µé¢çš„æ•´æ•°å€å³æ˜¯å†…å­˜åŸºåœ°å€ã€‚æ ¹æ®è¦åŠ è½½åˆ°å†…å­˜ä¸­çš„æ–‡ä»¶çš„ç±»å‹ï¼Œå†…å­˜åœ°å€å¯èƒ½ä¸ p_vaddr ç›¸åŒä¹Ÿå¯èƒ½ä¸åŒã€‚\n\n","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%A5%97%E6%8E%A5%E5%AD%97":{"title":"å¥—æ¥å­—","content":"# å¥—æ¥å­—\n\nå¥—æ¥å­—ï¼ˆSocketï¼‰ç”¨äºåè°ƒä¸åŒè®¡ç®—æœºä¸Šçš„[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]é—´é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯åŸºäºç½‘ç»œçš„é€šä¿¡ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨æœ¬æœºä¸Šä½¿ç”¨å¥—æ¥å­—è¿›è¡Œè¿›ç¨‹é—´çš„é€šä¿¡ã€‚\n\nå¥—æ¥å­—é€šä¿¡çš„æ–¹å¼éå¸¸å¤šï¼Œæœ‰UnixåŸŸå¥—æ¥å­—ã€TCPå¥—æ¥å­—ã€UDPå¥—æ¥å­—ã€é“¾è·¯å±‚å¥—æ¥å­—ç­‰ç­‰ã€‚ä½†æœ€å¸¸ç”¨çš„è‚¯å®šæ˜¯TCPå¥—æ¥å­—ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œä»‹ç»ä¸‹TCP Socketé€šä¿¡æ–¹å¼ï¼Œç¨åå†å•ç‹¬ä»‹ç»UnixåŸŸå¥—æ¥å­—ã€‚\n\nTCP Socketç”¨äºå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯çš„åŸºäºTCPåè®®çš„é€šä¿¡ï¼Œæ‰€ä»¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å‡éœ€è¦åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ã€‚åˆ›å»ºTCPå¥—æ¥å­—æ—¶ä¼šè¿”å›è¿™ä¸ªå¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯é€šè¿‡è¿™ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ–‡ä»¶æè¿°ç¬¦|æ–‡ä»¶æè¿°ç¬¦]]å¯¹å¥—æ¥å­—è¿›è¡Œè¯»å’Œå†™æ“ä½œã€‚\n\nå¯¹æ¯”ä¸€ä¸‹ï¼Œå½“ä¸€ä¸ªç¨‹åºéœ€è¦å¯¹ä¸€ä¸ªç£ç›˜æ–‡ä»¶åŒæ—¶è¿›è¡Œè¯»å†™æ“ä½œï¼ˆåœ¨å‘½ä»¤è¡Œä¸‹ä¼¼ä¹æ²¡æœ‰æ‰¾åˆ°è¿™ç§å‘½ä»¤ï¼Œä½†é€šè¿‡ç¼–ç¨‹æ–¹å¼æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ï¼‰æ—¶ï¼Œç”±äºåªé€šè¿‡å•ä¸ªæ–‡ä»¶æè¿°ç¬¦åŒæ—¶è´Ÿè´£è¯»å’Œå†™ï¼Œå¾ˆå¯èƒ½éœ€è¦é€šè¿‡ä¸æ–­ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆçš„æ–¹å¼æ¥æ”¹å˜è¯»å†™çš„ä½ç½®ï¼Œå¦åˆ™æ•°æ®å¾ˆå®¹æ˜“é”™ä¹±ã€‚\n\nè€ŒTCPå¥—æ¥å­—ä¹Ÿæ˜¯é€šè¿‡å•ä¸ªæ–‡ä»¶æè¿°ç¬¦è¿›è¡Œè¯»å†™å¥—æ¥å­—çš„ï¼Œä¸ºäº†ä¿è¯è¯»å’Œå†™çš„ä½ç½®ä¸é”™ä¹±ï¼Œæ“ä½œç³»ç»Ÿåœ¨å†…æ ¸ç©ºé—´ä¸º**æ¯ä¸ªTCPå¥—æ¥å­—ç»´æŠ¤äº†ä¸¤ä¸ªbufferç©ºé—´**ï¼Œä¸€ä¸ªbufferç”¨äºå†™ã€ä¸€ä¸ªbufferç”¨äºè¯»ã€‚æä¾›è¯»çš„bufferç©ºé—´ç§°ä¸ºrecv bufferï¼Œæä¾›å†™çš„bufferç©ºé—´ç§°ä¸ºsend bufferï¼Œå®ƒä»¬ç»Ÿç§°ä¸ºsocket bufferã€‚\n\næ‰€ä»¥ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é€šè¿‡ä¸¤ä¸ªå¥—æ¥å­—é€šä¿¡å°±ç®€å•äº†ï¼Œä¸€ç«¯å‘send bufferå†™æ•°æ®ï¼Œè¯¥bufferçš„æ•°æ®ä¼šé€šè¿‡å·²ç»å»ºç«‹å¥½çš„TCPè¿æ¥å‘é€åˆ°å¦ä¸€ç«¯çš„recv bufferï¼Œäºæ˜¯å¦ä¸€ç«¯åªéœ€ä»recv bufferä¸­è¯»æ•°æ®å³å¯å®ç°ä¸åŒè®¡ç®—æœºä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ã€‚è¿‡ç¨‹å¦‚å›¾ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803132920.png]]","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A1%A8":{"title":"å­—ç¬¦ä¸²è¡¨","content":"# å­—ç¬¦ä¸²è¡¨\n\nå­—ç¬¦ä¸²è¡¨èŠ‚åŒ…å«ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦åºåˆ—ï¼Œé€šå¸¸ç§°ä¸ºå­—ç¬¦ä¸²ã€‚ç›®æ ‡æ–‡ä»¶ä½¿ç”¨è¿™äº›å­—ç¬¦ä¸²è¡¨ç¤ºç¬¦å·å’ŒèŠ‚çš„åç§°ã€‚å¯ä»¥å°†å­—ç¬¦ä¸²ä½œä¸ºå­—ç¬¦ä¸²è¡¨èŠ‚çš„ç´¢å¼•è¿›è¡Œå¼•ç”¨ã€‚\n\nç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ˆç´¢å¼•é›¶ï¼‰åŒ…å«ç©ºå­—ç¬¦ã€‚åŒæ ·ï¼Œå­—ç¬¦ä¸²è¡¨çš„æœ€åä¸€ä¸ªå­—èŠ‚ä¹ŸåŒ…å«ç©ºå­—ç¬¦ï¼Œä»è€Œç¡®ä¿æ‰€æœ‰å­—ç¬¦ä¸²éƒ½ä»¥ç©ºå­—ç¬¦ç»“å°¾ã€‚æ ¹æ®ä¸Šä¸‹æ–‡ï¼Œç´¢å¼•ä¸ºé›¶çš„å­—ç¬¦ä¸²ä¸ä¼šæŒ‡å®šä»»ä½•åç§°æˆ–æŒ‡å®šç©ºåç§°ã€‚\n\nå…è®¸ä½¿ç”¨ç©ºå­—ç¬¦ä¸²è¡¨èŠ‚ã€‚èŠ‚å¤´çš„Â sh_sizeÂ æˆå‘˜å€¼ä¸ºé›¶ã€‚å¯¹äºç©ºå­—ç¬¦ä¸²è¡¨ï¼Œéé›¶ç´¢å¼•æ— æ•ˆã€‚\n\nèŠ‚å¤´çš„Â sh_nameÂ æˆå‘˜åŒ…å«èŠ‚å¤´å­—ç¬¦ä¸²è¡¨çš„èŠ‚ç´¢å¼•ã€‚èŠ‚å¤´å­—ç¬¦ä¸²è¡¨ç”± ELF å¤´çš„Â e_shstrndxÂ æˆå‘˜æŒ‡å®šã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å…·æœ‰Â 25Â ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²è¡¨ï¼Œå¹¶ä¸”å…¶å­—ç¬¦ä¸²ä¸å„ç§ç´¢å¼•å…³è”ã€‚\n\n## ä¸¾ä¾‹\n\nELF å­—ç¬¦ä¸²è¡¨ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220911030139.png]]\n\nÂ ELF å­—ç¬¦ä¸²è¡¨ç´¢å¼•ï¼š\n\n| ç´¢å¼• | å­—ç¬¦ä¸²      |\n|----|----------|\n| 0  | æ—         |\n| 1  | name     |\n| 7  | Variable |\n| 11 | able     |\n| 16 | able     |\n| 24 | ç©ºå­—ç¬¦ä¸²     |\n\n## ç‰¹ç‚¹\n\nå­—ç¬¦ä¸²è¡¨ç´¢å¼•å¯ä»¥æŒ‡å‘èŠ‚ä¸­çš„ä»»ä½•å­—èŠ‚ã€‚ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥å‡ºç°å¤šæ¬¡ã€‚å¯ä»¥å­˜åœ¨å¯¹å­å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥å¤šæ¬¡å¼•ç”¨ã€‚å¦å¤–ï¼Œè¿˜å…è®¸ä½¿ç”¨æœªå¼•ç”¨çš„å­—ç¬¦ä¸²ã€‚","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B":{"title":"å­¤å„¿è¿›ç¨‹","content":"\n# å­¤å„¿è¿›ç¨‹\n\nçˆ¶è¿›ç¨‹ç»ˆæ­¢ä½†å­è¿›ç¨‹æœªç»“æŸï¼Œå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ä¼šå˜ä¸ºinitè¿›ç¨‹ï¼Œè¯¥å­è¿›ç¨‹ä¸ºå­¤å„¿è¿›ç¨‹ï¼Œinitä¸ºå­¤å„¿é™¢ã€‚\n","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%AF%BC%E5%85%A5%E8%A1%A8":{"title":"å¯¼å…¥è¡¨","content":"# å¯¼å…¥è¡¨\n\n\u003e [(34æ¡æ¶ˆæ¯) PEå¯¼å…¥è¡¨å’ŒIATè¡¨çš„åŸç†åŠå·¥ä½œå…³ç³»_C4ckeçš„åšå®¢-CSDNåšå®¢_peæ–‡ä»¶iatè¡¨](https://blog.csdn.net/qq_35289660/article/details/107329444)\n\n## åˆ†ç±»\n\n- IAT: Import Address Table å¯¼å…¥ï¼ˆå‡½æ•°ï¼‰åœ°å€è¡¨\n- INT: Import Name Table å¯¼å…¥ï¼ˆå‡½æ•°ï¼‰åç§°è¡¨\n\n## ç»“æ„\n\nImport Descriptor å¯¼å…¥è¡¨ï¼Œæ˜¯è®°å½•PEæ–‡ä»¶ä¸­ç”¨åˆ°çš„åŠ¨æ€è¿æ¥åº“çš„é›†åˆï¼Œä¸€ä¸ªdllåº“åœ¨å¯¼å…¥è¡¨ä¸­å ç”¨ä¸€ä¸ªå…ƒç´ ä¿¡æ¯çš„ä½ç½®ï¼Œè¿™ä¸ªå…ƒç´ æè¿°äº†è¯¥å¯¼å…¥dllçš„å…·ä½“ä¿¡æ¯ã€‚å¦‚dllçš„æœ€æ–°ä¿®æ”¹æ—¶é—´ã€dllä¸­å‡½æ•°çš„åå­—/åºå·ã€dllåŠ è½½åçš„å‡½æ•°åœ°å€ç­‰ã€‚è€Œä¸€ä¸ªå…ƒç´ å³ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸€ä¸ªå¯¼å…¥è¡¨å³è¯¥ç»“æ„ä½“çš„æ•°ç»„ï¼Œå…¶ç»“æ„ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```cpp\ntypedef struct _IMAGE_IMPORT_DESCRIPTOR {\n    union {\n        DWORD   Characteristics;            //å¯¼å…¥è¡¨ç»“æŸæ ‡å¿—\n        DWORD   OriginalFirstThunk;         //RVAæŒ‡å‘ä¸€ä¸ªç»“æ„ä½“æ•°ç»„(INTè¡¨)\n    };\n    DWORD   TimeDateStamp;                  //æ—¶é—´æˆ³\n    DWORD   ForwarderChain;                 // -1 if no forwarders\n    DWORD   Name;                           //RVAæŒ‡å‘dllåå­—ï¼Œä»¥0ç»“å°¾\n    DWORD   FirstThunk;                     //RVAæŒ‡å‘ä¸€ä¸ªç»“æ„ä½“æ•°ç»„(IATè¡¨)\n} IMAGE_IMPORT_DESCRIPTOR, *PIMAGE_IMPORT_DESCRIPTOR;\n```\n\n## ä½œç”¨\n\nè¯´åˆ°å¯¼å…¥è¡¨ï¼Œè‚¯å®šå°±æ˜¯å¯¹åº”å¯¼å‡ºè¡¨ã€‚è€Œå¯¼å‡ºè¡¨çš„ä½œç”¨æ˜¯è‡ªèº«æä¾›ä¸€å¼ æ¸…å•ï¼Œè¡¨æ˜è‡ªå·±åˆå“ªäº›å‡½æ•°ï¼Œå¤§å¤šæ˜¯dllä¸ºexeæä¾›å‡½æ•°ï¼Œå­˜åœ¨å¯¼å‡ºè¡¨ã€‚é‚£ç›¸åï¼Œexeä¸ºäº†è¡¨æ˜è‡ªèº«éœ€è¦å“ªäº›dllçš„å‡½æ•°ï¼Œä¹Ÿä¼šç”Ÿæˆä¸€å¼ è¡¨ï¼Œé‚£è¿™å¼ è¡¨å°±æ˜¯å¯¼å…¥è¡¨ã€‚\n\næœ‰äº›dllä¸€ä¼šéœ€è¦ä½¿ç”¨åˆ«çš„dllçš„å‡½æ•°ï¼Œé‚£è¿™ç±»dllä¹Ÿä¼šæœ‰å¯¼å…¥è¡¨ã€‚\n\nåŒæ ·ï¼Œå¯¼å‡ºè¡¨æ˜¯æä¾›çš„è‡ªèº«è¦å¯¼å‡ºçš„å‡½æ•°çš„åœ°å€ï¼Œå¯¹åº”å¯¼å…¥è¡¨ï¼Œä¹Ÿæ˜¯ä¸ºäº†æä¾›çš„è¦å¯¼å…¥çš„dllçš„å‡½æ•°çš„åœ°å€ï¼Œåªä¸è¿‡ç”±äºè¿™ä¸ªåœ°å€ä¸å›ºå®šï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šé‡æ–°ä¿®æ­£ã€‚\n\n## å·¥ä½œåŸç†\n\nå¯¼å…¥è¡¨åœ¨ç›®å½•é¡¹ä¸­çš„ç¬¬äºŒé¡¹ï¼ˆå¯¼å‡ºè¡¨ä¹‹åï¼‰ã€‚å¯¹åº”ç›®å½•é¡¹ä¸­çš„VirtualAddressï¼ˆRVAï¼‰å³æŒ‡å‘çš„å¯¼å…¥è¡¨ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220907164948.png]]\n\n\u003e ä¸Šå›¾PEæ–‡ä»¶åœ¨åŠ è½½å‰çš„æ ·å­ã€‚\n\nä¸Šé¢æ¶‰åŠåˆ°çš„IMAGE_THUNK_DATAè¿™ä¸ªç»“æ„æ•°ç»„ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª4å­—èŠ‚æ•°ï¼Œæœ¬æ¥æ˜¯ä¸€ä¸ªunionç±»å‹ï¼Œèƒ½è¡¨ç¤º4ä¸ªæ•°ï¼Œä½†æˆ‘ä»¬åªéœ€æŒæ¡ä¸¤ç§å³å¯ï¼Œå…¶ä½™ä¸¤ç§å·²ç»æˆä¸ºå†å²é—ç•™äº†ã€‚\n\n### OriginalFirstThunk\n\n\u003e originalæ„æ€æ˜¯ï¼šç”±nameæŸ¥åˆ°addressï¼Œæ‰€ä»¥nameæ˜¯åŸå§‹çš„ã€‚\n\nOriginalFirstThunkè¿™ä¸ªRVAæ‰€æŒ‡å‘çš„æ˜¯INTè¡¨ï¼ˆImport Name Tableï¼‰ï¼Œè¿™ä¸ªè¡¨æ¯ä¸ªæ•°æ®å 4ä¸ªå­—èŠ‚ã€‚é¡¾åæ€ä¹‰å°±æ˜¯è¡¨ç¤ºè¦å¯¼å…¥çš„å‡½æ•°çš„åå­—è¡¨ã€‚\n\n**å¯¼å‡ºå‡½æ•°å¯ä»¥ä»¥åå­—å¯¼å‡ºï¼Œäº¦å¯ä»¥åºå·å¯¼å‡º**ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿åŒºåˆ†ï¼Œå°±å°†è¿™INTè¡¨çš„æ¯ä¸ªå€¼åšäº†ç»†å¾®è°ƒæ•´ï¼š\n\nINTï¼šå¦‚æœè¿™ä¸ª4å­—èŠ‚æ•°çš„**æœ€é«˜ä½**ï¼ˆäºŒè¿›åˆ¶ï¼‰ä¸º1ï¼Œé‚£ä¹ˆæŠ¹å»è¿™ä¸ªæœ€é«˜ä½ä¹‹åï¼Œæ‰€è¡¨ç¤ºçš„æ•°å°±æ˜¯è¦å¯¼å…¥çš„å‡½æ•°çš„åºå·ï¼›å¦‚æœæœ€é«˜ä½æ˜¯0ï¼Œé‚£è¿™ä¸ªæ•°å°±ä¹Ÿæ˜¯ä¸€ä¸ªRVAï¼ŒæŒ‡å‘IMAGE_IMPORT_BY_NAMEç»“æ„ä½“ï¼ˆåŒ…å«çœŸæ­£çš„å¯¼å…¥å‡½æ•°çš„åå­—å­—ç¬¦ä¸²ï¼Œä»¥0ç»“å°¾ï¼‰ã€‚INTè¡¨ä»¥4å­—èŠ‚0ç»“å°¾ã€‚\n\n`IMAGE_IMPORT_BY_NAME`: å‰ä¸¤ä¸ªå­—èŠ‚æ˜¯ä¸€ä¸ªåºå·ï¼Œä¸æ˜¯å¯¼å…¥åºå·ï¼Œä¸€èˆ¬æ— ç”¨ï¼Œåé¢æ¥ç€å°±æ˜¯å¯¼å…¥å‡½æ•°åå­—çš„å­—ç¬¦ä¸²ï¼Œä»¥0ç»“å°¾ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220907181810.png]]\n\n### Name\n\nè¿™ä¸ªç»“æ„ä½“å˜é‡ä¹Ÿæ˜¯ä¸€ä¸ªRVAï¼Œç›´æ¥æŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯è¿™ä¸ª**å¯¼å…¥è¡¨å¯¹åº”çš„DLLçš„åå­—**ã€‚è¯´åˆ°è¿™ï¼Œå¤§å®¶æ˜ç™½ï¼Œ**ä¸€ä¸ªå¯¼å…¥è¡¨åªå¯¹åº”ä¸€ä¸ªDLL**ã€‚é‚£è‚¯å®šä¼šæœ‰å¤šä¸ªå¯¼å…¥è¡¨ã€‚æ‰€ä»¥å¯¹åº”ç›®å½•é¡¹é‡Œçš„VirtualAddressï¼ˆRVAï¼‰æŒ‡å‘çš„æ˜¯æ‰€æœ‰å¯¼å…¥è¡¨çš„é¦–åœ°å€ï¼Œæ¯ä¸ªå¯¼å…¥è¡¨å 20å­—èŠ‚ï¼ŒæŒ¨ç€ã€‚æœ€åä»¥ä¸€ä¸ªç©ºç»“æ„ä½“ä½œä¸ºç»“å°¾ï¼ˆ20å­—èŠ‚å…¨0ç»“æ„ä½“ï¼‰ã€‚\n\n### FirstAddress\n\nFirstAddressï¼ˆRVAï¼‰æŒ‡å‘çš„å°±æ˜¯IATè¡¨ï¼IATè¡¨ä¹Ÿæ˜¯æ¯ä¸ªæ•°æ®å 4ä¸ªå­—èŠ‚ã€‚æœ€åä»¥4å­—èŠ‚0ç»“å°¾ã€‚\n\næ³¨æ„ä¸Šå›¾PEæ–‡ä»¶åŠ è½½å‰ï¼ŒIATè¡¨å’ŒINTè¡¨çš„å®Œå…¨ç›¸åŒçš„ï¼Œæ‰€ä»¥æ­¤æ—¶IATè¡¨ä¹Ÿå¯ä»¥åˆ¤æ–­å‡½æ•°å¯¼å‡ºåºå·ï¼Œæˆ–æŒ‡å‘å‡½æ•°åå­—ç»“æ„ä½“ã€‚\n\nè€Œåœ¨åŠ è½½åï¼Œå·®åˆ«å°±æ˜¯IATè¡¨å‘ç”Ÿå˜åŒ–ï¼Œç³»ç»Ÿä¼šå…ˆæ ¹æ®ç»“æ„ä½“å˜é‡NameåŠ è½½å¯¹åº”çš„dllï¼ˆæ‹‰ä¼¸ï¼‰ï¼Œè¯»å–dllçš„å¯¼å‡ºè¡¨ï¼Œå¯¹åº”åŸç¨‹åºçš„INTè¡¨ï¼ŒåŒ¹é…dllå¯¼å‡ºå‡½æ•°çš„åœ°å€ï¼Œè¿”å›å…¶åœ°å€ï¼Œè´´åœ¨å¯¹åº”çš„IATè¡¨ä¸Šï¼ŒæŒ¨ä¸ªä¿®æ­£åœ°å€ï¼ˆä¹Ÿå°±æ˜¯GetProcAddressçš„åŠŸèƒ½ï¼‰ã€‚\n\næ‰€ä»¥ä¸Šæ–‡è¯´åˆ°ï¼ŒIATè¡¨ä¼šå­˜å‚¨dllçš„å‡½æ•°çš„åœ°å€ï¼Œæ–¹ä¾¿è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œç›´æ¥å–IATè¡¨è¿™ä¸ªåœ°å€å†…çš„å€¼ï¼Œä½œä¸ºå‡½æ•°åœ°å€ï¼Œå»CALLã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220907181908.png]]\n\n\u003e æ³¨æ„IATè¡¨å‘ç”Ÿå˜åŒ–ã€‚","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%AF%BC%E5%87%BA%E8%A1%A8":{"title":"å¯¼å‡ºè¡¨","content":"# å¯¼å‡ºè¡¨\n\nå¯¼å‡ºè¡¨çš„ä½œç”¨æ˜¯è‡ªèº«æä¾›ä¸€å¼ æ¸…å•ï¼Œè¡¨æ˜è‡ªå·±åˆå“ªäº›å‡½æ•°ï¼Œå¤§å¤šæ˜¯dllä¸ºexeæä¾›å‡½æ•°ï¼Œå­˜åœ¨å¯¼å‡ºè¡¨ã€‚","lastmodified":"2023-01-23T15:37:51.730680336Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E6%96%87%E4%BB%B6%E6%8C%87%E9%92%88":{"title":"æ–‡ä»¶æŒ‡é’ˆ","content":"# æ–‡ä»¶æŒ‡é’ˆ\n\n\u003e [2ã€æ–‡ä»¶æŒ‡é’ˆä¸æ–‡ä»¶æè¿°ç¬¦ - å­¤æƒ…å‰‘å®¢ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/The-explosion/articles/12246297.html)\n\n\"æ–‡ä»¶æŒ‡é’ˆ(file pointer)\"æŒ‡å‘è¿›ç¨‹ç”¨æˆ·åŒºä¸­çš„ä¸€ä¸ªè¢«ç§°ä¸ºFILEç»“æ„çš„æ•°æ®ç»“æ„ã€‚FILEç»“æ„åŒ…æ‹¬ä¸€ä¸ªç¼“å†²åŒºå’Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å€¼ã€‚è€Œæ–‡ä»¶æè¿°ç¬¦å€¼æ˜¯æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´æ–‡ä»¶æŒ‡é’ˆå°±æ˜¯å¥æŸ„çš„å¥æŸ„ã€‚\næ¯ä¸ªè¢«ä½¿ç”¨çš„æ–‡ä»¶éƒ½åœ¨å†…å­˜ä¸­å¼€è¾Ÿäº†ä¸€ä¸ªåŒºåŸŸï¼Œç”¨æ¥å­˜æ”¾æ–‡ä»¶çš„æœ‰å…³ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªç»“æ„ä½“ç±»å‹çš„å˜é‡ä¸­ï¼Œè¯¥ç»“æ„ä½“ç±»å‹æ˜¯ç”±ç³»ç»Ÿå®šä¹‰çš„ï¼Œå–åä¸ºFILEã€‚\n\n\n\n```c\n/*FILEç»“æ„ä½“*/\n#ifndef _FILE_DEFINED\nstruct _iobuf \n{\n    char *_ptr;       //æ–‡ä»¶è¾“å…¥çš„ä¸‹ä¸€ä¸ªä½ç½® \n    int  _cnt;        //å½“å‰ç¼“å†²åŒºçš„ç›¸å¯¹ä½ç½® \n    char *_base;      //æŒ‡åŸºç¡€ä½ç½®(å³æ˜¯æ–‡ä»¶çš„å…¶å§‹ä½ç½®) \n    int  _flag;       //æ–‡ä»¶æ ‡å¿— \n    int  _file;       //æ–‡ä»¶çš„æœ‰æ•ˆæ€§éªŒè¯ \n    int  _charbuf;    //æ£€æŸ¥ç¼“å†²åŒºçŠ¶å†µ,å¦‚æœæ— ç¼“å†²åŒºåˆ™ä¸è¯»å– \n    int  _bufsiz;     //ç¼“å†²åŒºå¤§å° \n    char *_tmpfname;  //ä¸´æ—¶æ–‡ä»¶å\n};\ntypedef struct _iobuf FILE;\n```\n\nå®é™…ä¸Šï¼ŒFILEç»“æ„æ˜¯é—´æ¥åœ°æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ§åˆ¶å— (FCB)æ¥å®ç°å¯¹æ–‡ä»¶çš„æ“ä½œçš„ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220802233104.png]]\n\nä¸Šé¢å›¾ä¸­çš„_fileå®é™…ä¸Šæ˜¯ä¸€ä¸ªæè¿°ç¬¦ï¼Œä½œä¸ºè¿›å…¥æ‰“å¼€æ–‡ä»¶è¡¨ç´¢å¼•çš„æ•´æ•°ã€‚\n\næ–‡ä»¶æ˜¯å­˜æ”¾åœ¨ç‰©ç†ç£ç›˜ä¸Šçš„ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ§åˆ¶å—(FCB)å’Œæ•°æ®å—ã€‚æ–‡ä»¶æ§åˆ¶å—é€šå¸¸åŒ…æ‹¬æ–‡ä»¶æƒé™ã€æ—¥æœŸï¼ˆåˆ›å»ºã€è¯»å–ã€ä¿®æ”¹ï¼‰ã€æ‹¥æœ‰è€…ã€æ–‡ä»¶å¤§å°ã€æ•°æ®å—ä¿¡æ¯ã€‚æ•°æ®å—ç”¨æ¥å­˜å‚¨å®é™…çš„å†…å®¹ã€‚å¯¹äºæ‰“å¼€çš„æ–‡ä»¶ï¼Œæ“ä½œç³»ç»Ÿæ˜¯è¿™æ ·ç®¡ç†çš„ï¼šç³»ç»Ÿç»´æŠ¤äº†ä¸¤å¼ è¡¨ï¼Œä¸€å¼ æ˜¯ç³»ç»Ÿçº§æ‰“å¼€æ–‡ä»¶è¡¨ã€æŒ‡å‘ièŠ‚ç‚¹ã€‘ï¼Œä¸€å¼ æ˜¯è¿›ç¨‹çº§æ‰“å¼€æ–‡ä»¶è¡¨ï¼ˆæ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªï¼‰ã€æŒ‡å‘FILEç»“æ„ä½“ã€‘ã€‚ç³»ç»Ÿçº§æ‰“å¼€æ–‡ä»¶è¡¨å¤åˆ¶äº†æ–‡ä»¶æ§åˆ¶å—çš„ä¿¡æ¯ç­‰ï¼›è¿›ç¨‹çº§æ‰“å¼€æ–‡ä»¶è¡¨ä¿å­˜äº†æŒ‡å‘ç³»ç»Ÿçº§æ–‡ä»¶è¡¨çš„æŒ‡é’ˆåŠå…¶ä»–ä¿¡æ¯ã€‚\n\nç³»ç»Ÿçº§æ–‡ä»¶è¡¨æ¯ä¸€é¡¹éƒ½ä¿å­˜ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå³è¯¥æ–‡ä»¶æ‰“å¼€çš„æ¬¡æ•°ã€‚æˆ‘ä»¬åˆæ¬¡æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿé¦–å…ˆæŸ¥çœ‹è¯¥æ–‡ä»¶æ˜¯å¦å·²åœ¨ç³»ç»Ÿçº§æ–‡ä»¶è¡¨ä¸­ï¼Œå¦‚æœä¸åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥é¡¹ä¿¡æ¯ï¼Œå¦åˆ™ï¼Œè®¡æ•°å™¨åŠ 1ã€‚å½“æˆ‘ä»¬å…³é—­ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œç›¸åº”çš„è®¡æ•°ä¹Ÿä¼šå‡1ï¼Œå½“å‡åˆ°0æ—¶ï¼Œç³»ç»Ÿå°†ç³»ç»Ÿçº§æ–‡ä»¶è¡¨ä¸­çš„é¡¹åˆ é™¤ã€‚ \n\nè¿›ç¨‹æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¼šåœ¨è¿›ç¨‹çº§æ–‡ä»¶è¡¨ä¸­æ·»åŠ ä¸€é¡¹ã€‚æ¯é¡¹çš„ä¿¡æ¯åŒ…æ‹¬å½“å‰æ–‡ä»¶åç§»é‡ï¼ˆè¯»å†™æ–‡ä»¶çš„ä½ç½®ï¼‰ã€å­˜å–æƒé™ã€å’Œ**ä¸€ä¸ªæŒ‡å‘ç³»ç»Ÿçº§æ–‡ä»¶è¡¨ä¸­å¯¹åº”æ–‡ä»¶é¡¹çš„æŒ‡é’ˆ**ã€‚ç³»ç»Ÿçº§æ–‡ä»¶è¡¨ä¸­çš„æ¯ä¸€é¡¹é€šè¿‡æ–‡ä»¶æè¿°ç¬¦ï¼ˆä¸€ä¸ªéè´Ÿæ•´æ•°ï¼‰æ¥æ ‡è¯†ã€‚\n\né€šè¿‡ä¸Šé¢æ‰€è®²è¿°çš„å¯ä»¥å‘ç°ï¼šFILEç»“æ„ä½“ä¸­çš„_fileæˆå‘˜åº”è¯¥æ˜¯æŒ‡å‘è¿›ç¨‹çº§æ‰“å¼€æ–‡ä»¶è¡¨ï¼Œç„¶åï¼Œ**é€šè¿‡è¿›ç¨‹çº§æ‰“å¼€æ–‡ä»¶è¡¨å¯ä»¥æ‰¾åˆ°ç³»ç»Ÿçº§æ‰“å¼€æ–‡ä»¶è¡¨**ï¼Œè¿›è€Œå¯ä»¥é€šè¿‡FCBæ“ä½œç‰©ç†ç£ç›˜ä¸Šé¢çš„æ–‡ä»¶ã€‚","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6":{"title":"æ–‡ä»¶æè¿°ç¬¦","content":"\næ–‡ä»¶æè¿°ç¬¦è¡¨é¡¹çš„ä¸‹æ ‡ï¼Œå°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚\n\n# æ–‡ä»¶æè¿°ç¬¦\n\n\u003e [2ã€æ–‡ä»¶æŒ‡é’ˆä¸æ–‡ä»¶æè¿°ç¬¦ - å­¤æƒ…å‰‘å®¢ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/The-explosion/articles/12246297.html)\n\n**æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°**ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ª**ç´¢å¼•å€¼**ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„**è®°å½•è¡¨**ã€‚è¯¥è¡¨çš„è®°å½•å€¼æ˜¯ä¸€ä¸ª**file_structå¯¹è±¡**ï¼Œæˆå‘˜å­—æ®µè®°å½•äº†æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ã€è¯»å†™ä½ç½®ã€è·¯å¾„ç­‰ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/z-attachments/Pasted image 20221002224808.png]]\n\n\u003eæ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äºUNIXã€Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚\n\nç³»ç»Ÿä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œè¯¥è¡¨çš„å€¼éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ä½ ä¼šçœ‹åˆ°ç›¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ç§æƒ…å†µä¸‹ç›¸åŒæ–‡ä»¶æè¿°ç¬¦æœ‰å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½æŒ‡å‘ä¸åŒçš„æ–‡ä»¶ã€‚\n\nå…·ä½“æƒ…å†µè¦å…·ä½“åˆ†æï¼Œè¦ç†è§£å…·ä½“å…¶æ¦‚å†µå¦‚ä½•ï¼Œéœ€è¦æŸ¥çœ‹ç”±å†…æ ¸ç»´æŠ¤çš„3ä¸ªæ•°æ®ç»“æ„ã€‚å†…æ ¸ä½¿ç”¨3ç§æ•°æ®ç»“æ„è¡¨ç¤ºæ‰“å¼€çš„æ–‡ä»¶ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»å†³å®šäº†åœ¨æ–‡ä»¶å…±äº«æ–¹é¢ä¸€ä¸ªè¿›ç¨‹å¯¹å¦ä¸€ä¸ªè¿›ç¨‹çš„å½±å“ã€‚\n\n1. è¿›ç¨‹çº§çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ã€‚æ¯ä¸ªè¿›ç¨‹åœ¨è¿›ç¨‹è¡¨ä¸­éƒ½æœ‰ä¸€ä¸ªçºªå½•é¡¹ï¼Œçºªå½•é¡¹ä¸­åŒ…å«ä¸€å¼ æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œæ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦å„å ä¸€é¡¹ï¼Œä¸æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ç›¸å…³çš„æ˜¯ï¼š\n\t1. æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—\n\t2. æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹çš„æŒ‡é’ˆ\n2. ç³»ç»Ÿçº§çš„æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦è¡¨ã€‚å†…æ ¸ä¸ºæ‰€æœ‰æ‰“å¼€æ–‡ä»¶ç»´æŠ¤ä¸€å¼ æ–‡ä»¶è¡¨é¡¹ï¼Œæ¯ä¸ªæ–‡ä»¶è¡¨é¡¹åŒ…å«ï¼š\n\t1. æ–‡ä»¶çŠ¶æ€(è¯» å†™ åŒæ­¥ éé˜»å¡ç­‰)\n\t2. å½“å‰æ–‡ä»¶åç§»é‡\n\t3. æŒ‡å‘æ”¹æ–‡ä»¶inodeï¼ˆLinuxï¼‰èŠ‚ç‚¹(vèŠ‚ç‚¹unix )çš„æŒ‡é’ˆ\n4. æ–‡ä»¶ç³»ç»Ÿçš„i-nodeè¡¨ã€‚æ¯æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æˆ–è®¾å¤‡ï¼Œéƒ½æœ‰ä¸€ä¸ªinodeèŠ‚ç‚¹ç»“æ„ï¼ŒinodeèŠ‚ç‚¹åŒ…å«äº†æ–‡ä»¶ç±»å‹å’Œå¯¹æ­¤æ–‡ä»¶è¿›è¡Œæ“ä½œå‡½æ•°çš„æŒ‡é’ˆï¼Œå¯¹äºå¤§å¤šæ•°æ–‡ä»¶ï¼ŒinodeèŠ‚ç‚¹è¿˜åŒ…å«äº†æ–‡ä»¶çš„ièŠ‚ç‚¹ç´¢å¼•èŠ‚ç‚¹ï¼Œè¿™äº›ä¿¡æ¯æ˜¯åœ¨æ‰“å¼€æ–‡ä»¶æ—¶ä»ç£ç›˜è¯»å…¥å†…å­˜çš„ï¼Œæ‰€ä»¥ï¼Œæ–‡ä»¶çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯éƒ½æ˜¯éšæ—¶å¯ç”¨çš„ã€‚inodeèŠ‚ç‚¹åŒ…å«äº†æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œæ–‡ä»¶é•¿åº¦ï¼ŒæŒ‡å‘æ–‡ä»¶å®é™…æ•°æ®å—åœ¨ç£ç›˜ä¸Šä½ç½®çš„æŒ‡é’ˆç­‰ã€‚\n5. \n\n## file_structçš„å­˜æ”¾\n\nä»æ–‡ä»¶æè¿°ç¬¦è¡¨çš„å‰ç«¯å¼€å§‹æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ²¡æœ‰è¢«ä½¿ç”¨çš„å•å…ƒæ ¼ã€‚\n\n\n## ä¸åŒçš„è¿›ç¨‹æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶\n\nÂ Â ä¸åŒçš„è¿›ç¨‹æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆä»–ä»¬åº”è¯¥æœ‰å„è‡ªå¯¹åº”çš„æ–‡ä»¶è¡¨è¡¨é¡¹ã€‚å› ä¸ºæ–‡ä»¶è¡¨è¡¨é¡¹è®°å½•äº†è¿›ç¨‹è¯»å†™æ–‡ä»¶æ—¶çš„åç§»é‡å’Œå­˜å–æƒé™ã€‚å¤šä¸ªè¿›ç¨‹ä¸å¯èƒ½å…±äº«ä¸€ä¸ªæ–‡ä»¶åç§»é‡ã€‚å¦å¤–ä»–ä»¬å„è‡ªæ‰“å¼€æ–‡ä»¶çš„æƒé™ä¹Ÿå¯èƒ½æ˜¯ä¸åŒçš„ï¼Œæœ‰çš„æ˜¯ä¸ºäº†è¯»ã€æœ‰çš„ä¸ºäº†å†™ï¼Œæœ‰çš„ä¸ºäº†è¯»å†™ã€‚æ‰€ä»¥ï¼Œä»–ä»¬åº”è¯¥æœ‰ä¸åŒçš„æ–‡ä»¶è¡¨è¡¨é¡¹ã€‚\n\næ­¤å¤–ï¼Œå› ä¸ºæ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œå¤šä¸ªè¿›ç¨‹ä¼šå…±äº«åŒä¸€ä¸ªç´¢å¼•ç»“ç‚¹è¡¨é¡¹ã€‚å³ä»–ä»¬çš„æ–‡ä»¶è¡¨è¡¨é¡¹æŒ‡é’ˆä¼šæŒ‡å‘åŒä¸€ä¸ªç´¢å¼•ç»“ç‚¹ï¼Œæœ€ç»ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220803012527.png]]\n\n## åŒä¸€ä¸ªè¿›ç¨‹å¤šæ¬¡æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶\n\næ¯æ‰“å¼€ä¸€æ¬¡åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå†…æ ¸å°±ä¼šåœ¨æ–‡ä»¶è¡¨ä¸­å¢åŠ ä¸€ä¸ªè¡¨é¡¹ã€‚è¿™æ˜¯å› ä¸ºæ¯æ¬¡openæ–‡ä»¶æ—¶ä½¿ç”¨äº†ä¸åŒçš„è¯»å†™æƒé™ï¼Œè€Œè¯»å†™æƒé™æ˜¯ä¿å­˜åœ¨æ–‡ä»¶è¡¨è¡¨é¡¹é‡Œé¢çš„ã€‚æ‰€ä»¥ï¼Œæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220803012609.png]]\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E6%96%87%E4%BB%B6%E6%98%A0%E5%B0%84":{"title":"æ–‡ä»¶æ˜ å°„","content":"# æ–‡ä»¶æ˜ å°„\n\næ–‡ä»¶æ˜ å°„ï¼ˆMemory-mapped fileï¼‰æ˜¯å°†ç£ç›˜ä¸Šæ–‡ä»¶çš„æŸæ®µæ•°æ®æ˜ å°„åˆ°å†…æ ¸çš„ä¸€æ®µç‰©ç†å†…å­˜ä¸Šï¼Œç„¶åå°†æ­¤ç‰©ç†å†…å­˜æ˜ å°„åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ä¸­ã€‚æ˜ å°„äº†æ–‡ä»¶çš„è¿›ç¨‹å¯ä»¥ç›´æ¥è¯»ã€å†™è¿™æ®µå†…å­˜æ¥è¾¾åˆ°è¯»ã€å†™ç£ç›˜æ–‡ä»¶çš„åŠŸèƒ½ã€‚å¦‚æœå¤šä¸ªè¿›ç¨‹è¯·æ±‚æ˜ å°„çš„æ–‡ä»¶åŒºæ®µç›¸åŒï¼Œåˆ™åªæ˜ å°„ä¸€æ¬¡ã€‚\n\næ‰€ä»¥ï¼Œæ–‡ä»¶æ˜ å°„è¿›è¡Œäº†ä¸¤æ¬¡æ˜ å°„ï¼Œä¸€æ¬¡æ˜ å°„æ˜¯å°†å±äºç£ç›˜æ–‡ä»¶çš„éƒ¨åˆ†æˆ–å…¨éƒ¨æ•°æ®å—æ˜ å°„åˆ°ç‰©ç†å†…å­˜é¡µä¸­ï¼Œå¦ä¸€æ¬¡æ˜ å°„æ˜¯å°†ç‰©ç†å†…å­˜é¡µæ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿé¡µä¸Šã€‚\n\nå¦‚å›¾ï¼Œå›¾ä¸­å‡è®¾ç£ç›˜æ•°æ®å—å¤§å°å’Œå†…å­˜é¡µå¤§å°ç›¸åŒï¼Œå°†æŸæ–‡ä»¶ä¸­çš„6ä¸ªæ•°æ®å—ï¼ˆå¯èƒ½åªæ˜¯è¯¥æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼‰æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„é¡µ1ã€2ã€3ã€4ã€5ã€6ä¸­ï¼Œå¹¶ä¸”ä¸¤ä¸ªè¿›ç¨‹éƒ½æ˜ å°„è¯¥ç£ç›˜æ–‡ä»¶ç›¸åŒçš„æ•°æ®åŒºåŸŸï¼Œæ‰€ä»¥ä¸¤ä¸ªè¿›ç¨‹éƒ½æŒ‡å‘ç›¸åŒçš„ç‰©ç†å†…å­˜é¡µã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803141346.png]]\n\nä½¿ç”¨æ–‡ä»¶æ˜ å°„æ—¶ï¼Œæœ€å¼€å§‹è¯¥å†…å­˜åŒºæ˜¯ç©ºçš„ã€‚å½“è®¿é—®è¿™æ®µå†…å­˜æ—¶ï¼Œå¦‚æœè®¿é—®çš„æ•°æ®ä¸åœ¨å†…å­˜ä¸­ï¼ˆä¾‹å¦‚ç¬¬ä¸€æ¬¡è®¿é—®ï¼‰ï¼Œå°†å‡ºç°page faultï¼Œäºæ˜¯ä¼šä»ç£ç›˜ä¸­è¯»å–ç›¸åº”çš„æ•°æ®å—æ‹·è´åˆ°è¿™æ®µå†…å­˜ï¼ˆåŸºäºæ“ä½œç³»ç»Ÿæä¾›çš„é¢„è¯»ä¼˜åŒ–ï¼Œå¯èƒ½ä¸€æ¬¡æ€§ä¼šå¤šè¯»ä¸€äº›æ•°æ®åˆ°æ˜ å°„çš„å†…å­˜ä¸­ï¼‰ã€‚å½“**å‘æ­¤å†…å­˜åŒºå†™æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶å¯¹åº”çš„æ•°æ®å—ä¸­**ï¼ˆå¯ä»¥è®¾ç½®ä¸ºå…¶å®ƒå†™æ–¹å¼ï¼‰ã€‚\n\næ­¤å¤–ï¼Œé€šè¿‡è®¾ç½®æ–‡ä»¶æ˜ å°„æ–¹å¼ï¼Œè¿˜æ”¯æŒ**å†™æ—¶å¤åˆ¶**ã€‚æŸè¿›ç¨‹è¦å‘è¯¥æ˜ å°„åŒºçš„æŸå†…å­˜é¡µå†™æ•°æ®æ—¶ï¼Œä¼šæ‹·è´è¯¥é¡µåˆ°è‡ªå·±çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œç„¶åå†™æ•°æ®åˆ°è¯¥å‰¯æœ¬é¡µï¼Œè€Œä¸ä¼šå½±å“æ˜ å°„åŒºçš„æ•°æ®ï¼Œè€Œä¸”ä»¥åè¯¥è¿›ç¨‹å¯¹è¯¥é¡µçš„æ“ä½œéƒ½å°†ä½¿ç”¨è¯¥å‰¯æœ¬ã€‚\n\næ—¢ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½è®¿é—®åˆ°æ–‡ä»¶æ˜ å°„çš„ç‰©ç†å†…å­˜ï¼Œé‚£ä¹ˆè¿™æ®µç‰©ç†å†…å­˜åˆ†é…åœ¨è¿›ç¨‹è™šæ‹Ÿå†…å­˜å¸ƒå±€çš„å“ªä¸€éƒ¨åˆ†å‘¢ï¼Ÿè¿™ä¸ªç®€å•æ€è€ƒä¸‹å³å¯å¾—çŸ¥ç­”æ¡ˆï¼Œè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œåªæœ‰å †å†…å­˜å’Œå †æ ˆä¸­é—´çš„æœªåˆ†é…åœ°å€ç©ºé—´æ˜¯å¯ä»¥ç”±ç”¨æˆ·è¿›ç¨‹è‡ªç”±ä½¿ç”¨çš„åœ°å€åŒºåŸŸï¼Œå¦‚æœå°†æ–‡ä»¶æ˜ å°„åˆ°å †ä¸­ï¼Œå‡å¦‚æ˜ å°„çš„æ–‡ä»¶æ•°æ®è¾ƒå¤§ï¼Œå·²åˆ†é…çš„å †å†…å­˜ä¸­ç©ºé—²é¡µå¾ˆå¯èƒ½ä¸è¶³ä»¥æ˜ å°„è¯¥æ–‡ä»¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ä¸ºå…¶åˆ†é…æ›´å¤šçš„å †å†…å­˜ï¼Œå¦ä¸€æ–¹é¢ï¼Œå°±ç®—å½“å‰å †å†…å­˜èƒ½æ”¾ä¸‹æ–‡ä»¶æ˜ å°„ï¼Œä½†ä¹Ÿå¾ˆå¯èƒ½å› æ­¤è€Œå¯¼è‡´ç©ºé—²é¡µæ‰€å‰©ä¸å¤šï¼Œè¿›ç¨‹ä¹‹åçš„è¿è¡Œå¾ˆå¯èƒ½è¿˜æ˜¯è¦è¯·æ±‚åˆ†é…æ–°çš„å †å†…å­˜ï¼Œå¦‚æ­¤çœ‹æ¥ï¼Œå€’ä¸å¦‚ç›´æ¥æ˜ å°„åœ¨å †æ ˆä¸­é—´é‚£ç‰‡æœªåˆ†é…çš„åœ°å€ç©ºé—´ï¼Œå¹¶ä¸”ä¸ºå †å’Œæ ˆéƒ½é¢„ç•™ä¸€æ®µæœªåˆ†é…ç©ºé—´ã€‚å›¾ä¸­ç»™å‡ºæ–‡ä»¶æ˜ å°„åœ¨è¿›ç¨‹å†…å­˜å¸ƒå±€ä¸­çš„ä½ç½®ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803141403.png]]\n\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90":{"title":"æ–‡ä»¶æƒé™","content":"\n# æ–‡ä»¶æƒé™\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221003222654.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221003222943.png]]\n\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F":{"title":"æ¡ä»¶å˜é‡","content":"\n# æ¡ä»¶å˜é‡\n\n## ç¼–ç¨‹æ¥å£\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221022013734.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221022013742.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221102011938.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221102011949.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221102012001.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221102012023.png]]\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97":{"title":"æ¶ˆæ¯é˜Ÿåˆ—","content":"# æ¶ˆæ¯é˜Ÿåˆ—\n\næ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ç”¨äºåœ¨[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]ä¹‹é—´ä¼ é€’è¾ƒå°çš„æ•°æ®ï¼Œè¿›ç¨‹å¯ä»¥å‘ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ”¾å…¥æ•°æ®ï¼ˆæ¶ˆæ¯ï¼‰ï¼Œå…¶å®ƒè¿›ç¨‹å¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æŒ‰ç…§å„ç§æ–¹å¼ï¼ˆä¾‹å¦‚æœ€å…¸å‹çš„å…ˆè¿›å…ˆå‡ºFIFOæ–¹å¼ï¼‰å–å‡ºæ¶ˆæ¯ï¼Œä»è€Œå®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚\n\næ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ç”Ÿäº§è€…æ¶ˆè´¹è€…|ç”Ÿäº§è€…æ¶ˆè´¹è€…]]æ¨¡å‹ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…è¢«æ¶ˆè´¹è€…æ¶ˆè´¹èµ°ã€‚å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…è¢«é˜»å¡ï¼Œå¦‚æœé˜Ÿåˆ—å·²ç©ºï¼Œæ¶ˆè´¹è€…è¢«é˜»å¡ã€‚å½“ç„¶ï¼ŒæŒ‰ç…§ä¸åŒè®¾è®¡æ–¹å¼ï¼Œå¯èƒ½ä¼šä»¥é€šçŸ¥çš„æ–¹å¼æ›¿ä»£é˜»å¡è¡Œä¸ºã€‚\n\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¹Ÿå¸¸ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹ï¼ˆå¦‚RabbitMQã€Kafkaï¼‰åœ¨å¤šä¸ªæœåŠ¡ç¨‹åºä¹‹é—´å¼‚æ­¥åœ°ä¼ é€’æ¶ˆæ¯ã€‚\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E7%AC%A6%E5%8F%B7%E8%A1%A8":{"title":"ç¬¦å·è¡¨","content":"# ç¬¦å·è¡¨\n\n## ä½œç”¨\n\n\u003e ä¸€å¼ â€œæŸ¥è¯¢è¡¨ã€‚\n\nç¬¦å·è¡¨åŒ…å«äº†**ä¸€äº›é€šç”¨çš„ç¬¦å·**ï¼Œè¿™éƒ¨åˆ†ä¿¡æ¯åœ¨è¿›è¡Œäº†Â `strip`Â æ“ä½œåå°±ä¼šæ¶ˆå¤±ã€‚è¿™äº›ç¬¦å·ä¿¡æ¯å¯èƒ½åŒ…æ‹¬å˜é‡åã€å‡½æ•°åã€‚\nç¬¦å·è¡¨æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œä¸¾ä¸ªä¾‹å­ï¼šæŸè¡ŒäºŒè¿›åˆ¶æ±‡ç¼–ä»£ç æ˜ å°„åˆ°æºç ç¬¬å‡ è¡Œã€‚\n\nç¬¦å·è¡¨çš„ä½œç”¨ï¼š\n\n1. è°ƒè¯•ï¼šæ±‡ç¼–--æŸ¥æ‰¾--\u003eæºç ä½ç½®\n2. é‡å®šä½ï¼šå‡½æ•°å--æŸ¥æ‰¾--\u003eæ±‡ç¼–ä½ç½®\n\n### è°ƒè¯•\n\n- windowå·¥ç¨‹æœ‰ä¸€ä¸ª*.pdbæ–‡ä»¶,é‡Œé¢ç¼–åŒ…å«è°ƒè¯•ç¬¦å·.å¯å‚é˜…wiki window pdbæ ¼å¼ã€‚\n- åœ¨javaå·¥ç¨‹ä¼šä½¿ç”¨ä¸€ä¸ªå«æ··æ·†çš„æŠ€æœ¯ï¼Œæ··æ·†åä¼šç”Ÿæˆæ··æ·†å‰åçš„æ˜ å°„æ–‡ä»¶mapping.txt,è¿™ä¸ªä¹Ÿå¯ä»¥ç†è§£ä¸ºç¬¦å·è¡¨çš„ä¸€ç§ã€‚\n- åœ¨linuxæœ‰ä¸€ä¸ªdwarfçš„æ–‡ä»¶æ ¼å¼ä¹Ÿæ˜¯ä¸“é—¨ç”¨äºè°ƒè¯•çš„æ–‡ä»¶ã€‚å‚é˜…wiki DWARFã€‚\n\n\n### é‡å®šä½\n\né‡å®šä½å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç§ç±»åˆ«`åŠ¨æ€é‡å®šä½`ä¸`é™æ€é‡å®šä½`\n\n#### åŠ¨æ€é‡å®šä½\n\nå‡è®¾Aç¨‹åºéœ€è¦`xxx.so`ä¸­çš„`yyyy`å‡½æ•°é‚£ä¹ˆå°±éœ€è¦ä»`xxx.so`ä¸­çš„ç¬¦å·è¡¨è¿›è¡Œè¯»å–ã€‚\n\n#### é™æ€é‡å®šä½\n\n[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/é™æ€é‡å®šä½|é™æ€é‡å®šä½]]\n\n## åŸºæœ¬ç»“æ„\n\nELFæ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨å¾€å¾€æ˜¯æ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ®µï¼Œæ®µåä¸€èˆ¬å«\".symtab\"ã€‚ç¬¦å·è¡¨çš„ç»“æ„å¾ˆç®€å•ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¬¦å·è¡¨é¡¹æ•°ç»„æ•°ç»„ï¼Œæ¯ä¸ªç¬¦å·è¡¨é¡¹ç»“æ„å¯¹åº”ä¸€ä¸ªç¬¦å·ã€‚è¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ ‡0çš„å…ƒç´ ä¸ºæ— æ•ˆçš„\"æœªå®šä¹‰\"ç¬¦å·ã€‚\n\nElf32_Symçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š\n\n```cpp\ntypedef struct {  \n\tElf32_Word st_name;  \n\tElf32_Addr st_value;  \n\tElf32_Word st_size;  \n\tunsigned char st_info;  \n\tunsigned char st_other;  \n\tElf32_Half st_shndx;  \n} Elf32_Sym;\n```\n\n| åç§°       | æè¿°                                                                      |\n|----------|-------------------------------------------------------------------------|\n| st_name  | ç¬¦å·åã€‚è¿™ä¸ªæˆå‘˜åŒ…å«äº†è¯¥ç¬¦å·ååœ¨å­—ç¬¦ä¸²è¡¨ä¸­çš„ä¸‹æ ‡ï¼ˆè¿˜è®°å¾—å­—ç¬¦ä¸²è¡¨å§ï¼Ÿï¼‰                                     |\n| st_value | ç¬¦å·ç›¸å¯¹åº”çš„å€¼ã€‚è¿™ä¸ªå€¼è·Ÿç¬¦å·æœ‰å…³ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªåœ°å€ç­‰ï¼Œä¸åŒçš„ç¬¦å·ï¼Œå®ƒæ‰€å¯¹åº”çš„å€¼å«ä¹‰ä¸åŒï¼Œè§ä¸‹æ–‡â€œç¬¦å·å€¼â€ã€‚          |\n| st_size  | ç¬¦å·å¤§å°ã€‚å¯¹äºåŒ…å«æ•°æ®çš„ç¬¦å·ï¼Œè¿™ä¸ªå€¼æ˜¯è¯¥æ•°æ®ç±»å‹çš„å¤§å°ã€‚æ¯”å¦‚ä¸€ä¸ªdoubleå‹çš„ç¬¦å·å®ƒå ç”¨8ä¸ªå­—èŠ‚ã€‚å¦‚æœè¯¥å€¼ä¸º0ï¼Œåˆ™è¡¨ç¤ºè¯¥ç¬¦å·å¤§å°ä¸º0æˆ–æœªçŸ¥ã€‚ |\n| st_info  | ç¬¦å·ç±»å‹å’Œç»‘å®šä¿¡æ¯ï¼Œè§ä¸‹æ–‡â€œç¬¦å·ç±»å‹ä¸ç»‘å®šä¿¡æ¯â€                                                |\n| st_other | è¯¥æˆå‘˜ç›®å‰ä¸º0ï¼Œæ²¡ç”¨                                                              |\n| st_shndx | ç¬¦å·æ‰€åœ¨çš„æ®µï¼Œè§ä¸‹æ–‡â€œç¬¦å·æ‰€åœ¨æ®µâ€                                                       |\n\n\nElf64_Symbolå®šä¹‰å¦‚ä¸‹ï¼š\n\n```cpp\ntypedef struct { \n    int   name;      /* String table offset */ \n    char  type:4,    /* Function or data (4 bits) */ \n    binding:4;       /* Local or global (4 bits) */ \n    char  reserved;  /* Unused */  \n    short section;   /* Section header index */\n    long  value;     /* Section offset or absolute address */ \n    long  size;      /* Object size in bytes */ \n} Elf64_Symbol; \n```\n\næ³¨æ„ï¼š  \næœ‰ä¸‰ç±»ä¼ªèŠ‚æ˜¯æ²¡æœ‰èŠ‚å¤´è¡¨æ¡ç›®çš„\n- `ABS` \n    ä¸éœ€è¦é‡å®šä½çš„ç¬¦å·ï¼Œæ¯”å¦‚æºä»£ç çš„è·¯å¾„åï¼›\n- `COMMON` \n    æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼›  \n    `.bss`ä¿å­˜çš„æ˜¯æœªåˆå§‹åŒ–çš„é™æ€å˜é‡ï¼ŒåŠåˆå§‹åŒ–ä¸º0çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼›\n- `UND` \n    åœ¨ç›®æ ‡æ–‡ä»¶`m`ä¸­å¼•ç”¨ï¼Œä½†å®šä¹‰åœ¨åˆ«çš„æ–‡ä»¶ä¸­çš„ç¬¦å·ï¼›\n\nå…¶ä¸­ï¼Œç¬¦å·è¡¨ä¸­ä¸‹æ ‡ 0 å­˜å‚¨äº†ç¬¦å·è¡¨çš„ä¸€ä¸ªå…ƒç´ ï¼ŒåŒæ—¶è¿™ä¸ªå…ƒç´ ä¹Ÿç›¸å¯¹æ¯”è¾ƒç‰¹æ®Šï¼Œä½œä¸ºæ‰€æœ‰æœªå®šä¹‰ç¬¦å·çš„ç´¢å¼•ï¼Œå…·ä½“å¦‚ä¸‹ï¼š\n| åç§°       | å–å€¼ | è¯´æ˜       |\n|----------|----|----------|\n| st_name  | 0  | æ— åç§°      |\n| st_value | 0  | 0 å€¼      |\n| st_size  | 0  | æ— å¤§å°      |\n| st_info  | 0  | æ— ç±»å‹ï¼Œå±€éƒ¨ç»‘å®š |\n| st_other | 0  | æ— é™„åŠ ä¿¡æ¯    |\n| st_shndx | 0  | æ— èŠ‚åŒº      |\n\n\n## st_info[Â¶](https://ctf-wiki.org/executable/elf/structure/symbol-table/#st_info \"Permanent link\")\n\nst_info ä¸­åŒ…å«ç¬¦å·ç±»å‹å’Œç»‘å®šä¿¡æ¯ï¼Œè¿™é‡Œç»™å‡ºäº†æ§åˆ¶å®ƒçš„å€¼çš„æ–¹å¼å…·ä½“ä¿¡æ¯å¦‚ä¸‹\n\n`#define ELF32_ST_TYPE(i)    ((i)\u00260xf) #define ELF32_ST_INFO(b, t) (((b)\u003c\u003c4) + ((t)\u00260xf))`ã€‚\n\n## ç¬¦å·ç±»å‹å’Œç»‘å®šä¿¡æ¯ï¼ˆst_infoï¼‰\n\nè¯¥æˆå‘˜ä½4ä½è¡¨ç¤ºç¬¦å·çš„ç±»å‹ï¼ˆSymbol Typeï¼‰ï¼Œé«˜28ä½è¡¨ç¤ºç¬¦å·ç»‘å®šä¿¡æ¯ï¼ˆSymbol Bindingï¼‰\n\nç¬¦å·ç»‘å®šä¿¡æ¯ï¼š\n| å®å®šä¹‰å       | å€¼ | è¯´æ˜                |\n|------------|---|-------------------|\n| STB_LOCAL  | 0 | å±€éƒ¨ç¬¦å·ï¼Œå¯¹äºç›®æ ‡æ–‡ä»¶çš„å¤–éƒ¨ä¸å¯è§ |\n| STB_GLOBAL | 1 | å…¨å±€ç¬¦å·ï¼Œå¤–éƒ¨å¯è§         |\n| STB_WEAK   | 2 | å¼±å¼•ç”¨ï¼Œè¯¦è§â€œå¼±ç¬¦å·ä¸å¼ºç¬¦å·â€   |\n\nst_info çš„ä½ 4 ä½è¡¨ç¤ºç¬¦å·ç±»å‹ï¼š\n| å®å®šä¹‰å        | å€¼ | è¯´æ˜                 |\n|-------------|---|--------------------|\n| STT_NOTYPE  | 0 | æœªçŸ¥ç±»å‹ç¬¦å·             |\n| STT_OBJECT  | 1 | è¯¥ç¬¦å·æ˜¯ä¸ªæ•°æ®å¯¹è±¡ï¼Œæ¯”å¦‚å˜é‡ã€æ•°ç»„ç­‰ |\n| STT_FUNC    | 2 | è¯¥ç¬¦å·æ˜¯ä¸ªå‡½æ•°æˆ–å…¶ä»–å¯æ‰§è¡Œä»£ç     |\n| STT_SECTION | 3 | è¯¥ç¬¦å·è¡¨ç¤ºä¸€ä¸ªæ®µï¼Œè¿™ç§ç¬¦å·å¿…é¡»æ˜¯   |\n|             |   | STB_LOCALçš„         |\n| STT_FILE    | 4 | è¯¥ç¬¦å·è¡¨ç¤ºæ–‡ä»¶åï¼Œä¸€èˆ¬éƒ½æ˜¯è¯¥ç›®æ ‡æ–‡  |\n|             |   | ä»¶æ‰€å¯¹åº”çš„æºæ–‡ä»¶åï¼Œå®ƒä¸€å®šæ˜¯     |\n|             |   | STB_LOCALç±»å‹çš„ï¼Œå¹¶ä¸”å®ƒçš„  |\n|             |   | st_shndxä¸€å®šæ˜¯SHN_ABS |\n\n### ç¬¦å·æ‰€åœ¨æ®µï¼ˆst_shndxï¼‰\n\nå¦‚æœç¬¦å·å®šä¹‰åœ¨æœ¬ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆå‘˜è¡¨ç¤ºç¬¦å·æ‰€åœ¨çš„æ®µåœ¨æ®µè¡¨ä¸­çš„ä¸‹æ ‡ï¼›ä½†æ˜¯å¦‚æœç¬¦å·ä¸æ˜¯å®šä¹‰åœ¨æœ¬ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œæˆ–è€…å¯¹äºæœ‰äº›ç‰¹æ®Šç¬¦å·ï¼Œsh_shndxçš„å€¼æœ‰äº›ç‰¹æ®Šï¼š\nç‰¹æ®Šå¸¸é‡ï¼š\n| å®å®šä¹‰å       | å€¼      | è¯´æ˜                                                                                                                   |\n|------------|--------|----------------------------------------------------------------------------------------------------------------------|\n| SHN_ABS    | 0xfff1 | è¡¨ç¤ºè¯¥ç¬¦å·åŒ…å«äº†ä¸€ä¸ªç»å¯¹çš„å€¼ã€‚æ¯”å¦‚è¡¨ç¤ºæ–‡ä»¶åçš„ç¬¦å·å°±å±äºè¿™ç§ç±»å‹çš„                                                                                    |\n| SHN_COMMON | 0xfff2 | è¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªâ€œCOMMONå—â€ç±»å‹çš„ç¬¦å·ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæœªåˆå§‹åŒ–çš„å…¨å±€ç¬¦å·å®šä¹‰å°±æ˜¯è¿™ç§ç±»å‹çš„ï¼Œæ¯”å¦‚SimpleSection.oé‡Œé¢çš„global_uninit_varã€‚ |\n| SHN_UNDEF  | 0      | è¡¨ç¤ºè¯¥ç¬¦å·æœªå®šä¹‰ã€‚è¿™ä¸ªç¬¦å·è¡¨ç¤ºè¯¥ç¬¦å·åœ¨æœ¬ç›®æ ‡æ–‡ä»¶è¢«å¼•ç”¨åˆ°ï¼Œä½†æ˜¯å®šä¹‰åœ¨å…¶ä»–ç›®æ ‡æ–‡ä»¶ä¸­ã€‚                                                                           |\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90":{"title":"ç¬¦å·è§£æ","content":"# ç¬¦å·è§£æ\n\n## ä½œç”¨\n\nç¡®å®šç¬¦å·å¼•ç”¨å…³ç³»ï¼Œå°†æ¯ä¸ªæ¨¡å—ä¸­å¼•ç”¨çš„ç¬¦å·ä¸æŸä¸ªç›®æ ‡æ¨¡å—çš„å®šä¹‰ç¬¦å·å»ºç«‹å…³è”ã€‚\n\nåœ¨æˆ‘ä»¬é€šå¸¸çš„è§‚å¿µé‡Œ,ä¹‹æ‰€ä»¥è¦é“¾æ¥æ˜¯å› ä¸ºæˆ‘ä»¬ç›®æ ‡æ–‡ä»¶ä¸­ç”¨åˆ°çš„ç¬¦å·è¢«å®šä¹‰åœ¨å…¶ä»–ç›®æ ‡æ–‡ä»¶,æ‰€ä»¥è¦å°†å®ƒä»¬é“¾æ¥èµ·æ¥ã€‚æ¯”å¦‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ldæ¥é“¾æ¥â€œa.oâ€,è€Œä¸å°†â€œb.oâ€ä½œä¸ºè¾“å…¥ã€‚é“¾æ¥å™¨å°±ä¼šå‘ç° sharedå’Œswapä¸¤ä¸ªç¬¦å·æ²¡æœ‰è¢«å®šä¹‰,æ²¡æœ‰åŠæ³•å®Œæˆé“¾æ¥å·¥ä½œï¼š\n![[z-oblib/z2-attachments/Pasted image 20220911163933.png]]\nè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶åœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™æœ€å¸¸ç¢°åˆ°çš„é—®é¢˜ä¹‹ä¸€,å°±æ˜¯é“¾æ¥æ—¶ç¬¦å·æœªå®šä¹‰ã€‚å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„åŸå› å¾ˆå¤š,æœ€å¸¸è§çš„ä¸€èˆ¬éƒ½æ˜¯é“¾æ¥æ—¶ç¼ºå°‘äº†æŸä¸ªåº“,æˆ–è€…è¾“å…¥ç›®æ ‡æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®æˆ–ç¬¦å·çš„å£°æ˜ä¸å®šä¹‰ä¸ä¸€æ ·ã€‚æ‰€ä»¥ä»æ™®é€šç¨‹åºå‘˜çš„è§’åº¦çœ‹,ç¬¦å·çš„è§£æå æ®äº†é“¾æ¥è¿‡ç¨‹çš„ä¸»è¦å†…å®¹ã€‚\né‡å®šä½è¿‡ç¨‹ä¹Ÿä¼´éšç€ç¬¦å·çš„è§£æè¿‡ç¨‹,æ¯ä¸ªç›®æ ‡æ–‡ä»¶éƒ½å¯èƒ½å®šä¹‰ä¸€äº›ç¬¦å·ä¹Ÿå¯èƒ½å¼•ç”¨åˆ°å®šä¹‰åœ¨å…¶ä»–ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·ã€‚é‡å®šä½çš„è¿‡ç¨‹ä¸­,æ¯ä¸ªé‡å®šä½çš„å…¥å£éƒ½æ˜¯å¯¹ä¸€ä¸ªç¬¦å·çš„å¼•ç”¨,é‚£ä¹ˆå½“é“¾æ¥å™¨é¡»è¦å¯¹æŸä¸ªç¬¦å·çš„å¼•ç”¨è¿›è¡Œé‡å®šä½æ—¶,å®ƒå°±è¦ç¡®å®šè¿™ä¸ªç¬¦å·çš„ç›®æ ‡åœ°å€ã€‚è¿™æ—¶å€™é“¾æ¥å™¨å°±ä¼šå»æŸ¥æ‰¾ç”±æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ç»„æˆçš„å…¨å±€ç¬¦å·è¡¨,æ‰¾åˆ°ç›¸åº”çš„ç¬¦å·åè¿›è¡Œé‡å®šä½ã€‚æ¯”å¦‚æˆ‘ä»¬æŸ¥çœ‹â€œa.oâ€çš„ç¬¦å·è¡¨ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220911164046.png]]\nGLOBALâ€ç±»å‹çš„ç¬¦å·,é™¤äº†â€œmainâ€å‡½æ•°æ˜¯å®šä¹‰åœ¨ä»£ç æ®µä¹‹å¤–,å…¶ä»–ä¸¤ä¸ªâ€œ sharedå’Œâ€œswapâ€éƒ½æ˜¯â€œUNDâ€,å³â€œundefinedâ€æœªå®šä¹‰ç±»å‹,è¿™ç§æœªå®šä¹‰çš„ç¬¦å·éƒ½æ˜¯å› ä¸ºè¯¥ç›®æ ‡æ–‡ä»¶ä¸­æœ‰å…³äºå®ƒä»¬çš„é‡å®šä½é¡¹ã€‚æ‰€ä»¥åœ¨é“¾æ¥å™¨æ‰«æå®Œæ‰€æœ‰çš„è¾“å…¥ç›®æ ‡æ–‡ä»¶ä¹‹å,æ‰€æœ‰è¿™äº›æœªå®šä¹‰çš„ç¬¦å·éƒ½åº”è¯¥èƒ½å¤Ÿåœ¨å…¨å±€ç¬¦å·è¡¨ä¸­æ‰¾åˆ°,å¦åˆ™é“¾æ¥å™¨å°±æŠ¥ç¬¦å·æœªå®šä¹‰é”™è¯¯ã€‚\n\n## æµç¨‹\n\n\u003e [ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹ç•ªå¤–ç¬”è®°â€”â€”ç¬¦å·è§£æä¸é‡å®šä½ - SegmentFault æ€å¦](https://segmentfault.com/a/1190000021551701)\n\né‡å®šä½è¿‡ç¨‹ä¹Ÿä¼´éšç€ç¬¦å·çš„è§£æè¿‡ç¨‹ï¼Œæ¯ä¸ªç›®æ ‡æ–‡ä»¶éƒ½å¯èƒ½å®šä¹‰ä¸€äº›ç¬¦å·ï¼Œä¹Ÿå¯èƒ½å¼•ç”¨åˆ°å®šä¹‰åœ¨å…¶ä»–ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·ã€‚é‡å®šä½çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªé‡å®šä½çš„å…¥å£éƒ½æ˜¯å¯¹ä¸€ä¸ªç¬¦å·çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå½“é“¾æ¥å™¨éœ€è¦å¯¹æŸä¸ªç¬¦å·çš„å¼•ç”¨è¿›è¡Œé‡å®šä½æ—¶ï¼Œå®ƒå°±è¦ç¡®å®šè¿™ä¸ªç¬¦å·çš„ç›®æ ‡åœ°å€ã€‚è¿™æ—¶å€™é“¾æ¥å™¨å°±ä¼šå»æŸ¥æ‰¾**ç”±æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶**çš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ç¬¦å·è¡¨|ç¬¦å·è¡¨]]ç»„æˆçš„**å…¨å±€ç¬¦å·è¡¨**ï¼Œæ‰¾åˆ°ç›¸åº”çš„ç¬¦å·åè¿›è¡Œé‡å®šä½ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220911033037.png]]\n![[z-oblib/z2-attachments/Pasted image 20220911033032.png]]\n\né€šè¿‡å‘½ä»¤æŸ¥çœ‹â€œa.oâ€çš„ç¬¦å·è¡¨ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220911033013.png]]\n\nå¯ä»¥çœ‹åˆ°sharedå’Œswapçš„ç±»å‹éƒ½æ˜¯â€œUNDâ€ï¼Œå³â€œundefinedâ€æœªå®šä¹‰ç±»å‹ï¼Œåœ¨é“¾æ¥å™¨æ‰«æå®Œæ‰€æœ‰çš„è¾“å…¥ç›®æ ‡æ–‡ä»¶åï¼Œæ‰€æœ‰è¿™äº›æœªå®šä¹‰çš„ç¬¦å·éƒ½åº”è¯¥èƒ½å¤Ÿåœ¨å…¨å±€ç¬¦å·è¡¨ä¸­æ‰¾åˆ°ï¼Œå¦åˆ™é“¾æ¥å™¨å°±æŠ¥**ç¬¦å·æœªå®šä¹‰**é”™è¯¯ã€‚è¿™ç§ä¸€èˆ¬éƒ½æ˜¯é“¾æ¥æ—¶**ç¼ºå°‘äº†æŸäº›åº“**ï¼Œæˆ–è€…è¾“å…¥ç›®æ ‡æ–‡ä»¶**è·¯å¾„ä¸æ­£ç¡®**æˆ–ç¬¦å·çš„**å£°æ˜ä¸å®šä¹‰ä¸ä¸€æ ·**ã€‚\n\n## æŒ‡ä»¤ä¿®æ”¹æ–¹å¼\n\n- ä¸åŒçš„å¤„ç†å™¨æŒ‡ä»¤å¯¹äºåœ°å€çš„æ ¼å¼å’Œæ–¹å¼éƒ½ä¸ä¸€æ ·ã€‚\n- å¯¹äº32ä½x86å¹³å°ä¸‹çš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ELF|ELF]]æ–‡ä»¶çš„é‡å®šä½å…¥å£æ‰€ä¿®æ­£çš„æŒ‡ä»¤å¯»å€æ–¹å¼åªæœ‰ä¸¤ç§ï¼š\n    - ç»å¯¹è¿‘å€32ä½å¯»å€ã€‚\n    - ç›¸å¯¹è¿‘å€32ä½å¯»å€ã€‚\n- è¿™ä¸¤ç§é‡å®šä½æ–¹å¼æŒ‡ä»¤ä¿®æ­£æ–¹å¼æ¯ä¸ªè¢«ä¿®æ­£çš„ä½ç½®çš„é•¿åº¦éƒ½æ˜¯32ä½ã€‚\n\nè¿™ä¸¤ç§æ–¹å¼çš„å®šä¹‰ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220911033329.png]]\n\n- é€šè¿‡å‰é¢çš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/é‡å®šä½è¡¨|é‡å®šä½è¡¨]]å¯ä»¥çœ‹åˆ°swapç¬¦å·çš„ç±»å‹ä¸ºR_386_PC32ï¼Œè¿™æ˜¯ä¸€æ¡ç›¸å¯¹ä½ç§»è°ƒç”¨æŒ‡ä»¤ã€‚è€Œsharedç¬¦å·çš„ç±»å‹ä¸ºR_386_32ï¼Œå®ƒä¿®æ­£çš„æ˜¯ä¸€æ¡ä¼ è¾“æŒ‡ä»¤çš„æºï¼Œå³sharedçš„ç»å¯¹åœ°å€ã€‚\n- å‡è®¾åœ¨å°†a.oå’Œb.oé“¾æ¥æˆæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶åï¼Œmainå‡½æ•°çš„è™šæ‹Ÿåœ°å€ä¸º0x1000ï¼Œswapå‡½æ•°çš„è™šæ‹Ÿåœ°å€ä¸º0x2000ï¼Œsharedå˜é‡çš„è™šæ‹Ÿåœ°å€ä¸º0x3000ã€‚\n- é¦–å…ˆçœ‹åç§»ä¸º0x18çš„è¿™æ¡movæŒ‡ä»¤çš„ä¿®æ­£ï¼Œå®ƒæ˜¯ç»å¯¹å¯»å€ä¿®æ­£ï¼Œå®ƒä¿®æ­£åçš„ç»“æœæ˜¯S+Aã€‚\n    - Sæ˜¯ç¬¦å·sharedçš„å®é™…åœ°å€ï¼Œå³0x3000ã€‚\n    - Aæ˜¯è¢«ä¿®æ­£ä½ç½®çš„**åŸå§‹å€¼**ï¼ˆé»˜è®¤å¡«å……å€¼ï¼‰ï¼Œå³0x00000000ã€‚\n- æ‰€ä»¥å®ƒçš„ä¿®æ­£åçš„åœ°å€ä¸ºï¼š0x3000+0x00000000=0x3000ã€‚\n\t![[z-oblib/z2-attachments/Pasted image 20220911033447.png]]\n- å†æ¥çœ‹åç§»ä¸º0x26çš„è¿™æ¡callæŒ‡ä»¤çš„ä¿®æ­£ï¼Œå®ƒæ˜¯ç›¸å¯¹å¯»å€ä¿®æ­£ï¼Œå®ƒä¿®æ­£åçš„ç»“æœæ˜¯S+A-Pã€‚\n    - Sæ˜¯ç¬¦å·swapçš„å®é™…åœ°å€ï¼Œå³0x2000ã€‚\n    - Aæ˜¯è¢«ä¿®æ­£ä½ç½®çš„å€¼ï¼Œå³0xFFFFFFFC(-4)ã€‚\n    - Pä¸ºè¢«ä¿®æ­£çš„ä½ç½®ï¼Œå½“é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œ**è¿™ä¸ªå€¼åº”è¯¥æ˜¯è¢«ä¿®æ­£ä½ç½®çš„è™šæ‹Ÿåœ°å€**ï¼Œå³0x1000+0x27ã€‚\n- æ‰€ä»¥å®ƒçš„ä¿®æ­£åçš„åœ°å€ä¸º0x2000+(-4)-(0x1000+0x27)=0xFD5ã€‚\n\t![[z-oblib/z2-attachments/Pasted image 20220911033509.png]]\n- è¿™æ¡ç›¸å¯¹ä½ç§»è°ƒç”¨æŒ‡ä»¤çš„è°ƒç”¨åœ°å€æ˜¯è¯¥æŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤çš„èµ·å§‹åœ°å€åŠ ä¸Šåç§»é‡ï¼Œå³ï¼š0x102b+0xfd5=0x2000ï¼Œåˆšå¥½æ˜¯swapå‡½æ•°çš„åœ°å€ã€‚\n- ä»è¿™ä¸¤ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œç»å¯¹å¯»å€ä¿®æ­£å’Œç›¸å¯¹å¯»å€ä¿®æ­£çš„åŒºåˆ«ï¼šæ˜¯å¦å‡è¢«ä¿®æ­£ä½ç½®çš„åœ°å€ï¼š\n\t- **ç»å¯¹**å¯»å€ä¿®æ­£åçš„åœ°å€ä¸º**è¯¥ç¬¦å·çš„å®é™…åœ°å€**\n\t- **ç›¸å¯¹**å¯»å€ä¿®æ­£åçš„åœ°å€ä¸º**ç¬¦å·è·ç¦»è¢«ä¿®æ­£ä½ç½®çš„åœ°å€å·®**","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E7%AE%A1%E9%81%93":{"title":"ç®¡é“","content":"\n# ç®¡é“\n\nç®¡é“æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§æœ€åŸºæœ¬çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚æ¯åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œå°±æœ‰ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€ä¸ªæ˜¯è´Ÿè´£è¯»ç®¡é“çš„ï¼Œä¸€ä¸ªæ˜¯è´Ÿè´£å†™ç®¡é“çš„ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨ç®¡é“é€šä¿¡æ—¶ï¼Œå¯ä»¥çœ‹ä½œæ˜¯**ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦åŠ ä¸€æ®µå†…æ ¸ç©ºé—´ä¸­çš„å†…å­˜**ï¼Œå¦‚å›¾ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803110054.png]]\n\nç®¡é“åªèƒ½åè°ƒæœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œæ‰€è°“äº²ç¼˜ï¼Œæ¯”å¦‚**çˆ¶å­è¿›ç¨‹ã€å…„å¼Ÿè¿›ç¨‹**ã€‚å½“æŸè¿›ç¨‹åˆ›å»ºä¸€ä¸ªç®¡é“åï¼Œå®ƒå°±æ‹¥æœ‰äº†è¿™ä¸ªç®¡é“çš„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒçš„å­è¿›ç¨‹ä¼šç»§æ‰¿è¿™ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥å­è¿›ç¨‹ä¹Ÿèƒ½è¯»å†™è¿™ä¸ªç®¡é“ã€‚å¦‚å›¾ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803110138.png]]\n\nä½†ä¸ºäº†è®©ç®¡é“é€šä¿¡æ›´å®‰å…¨ã€æ›´æ–¹ä¾¿ï¼Œä¸€èˆ¬ç®¡é“ä¸¤ç«¯çš„æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šå„è‡ªå…³é—­ä¸€ä¸ªç®¡é“çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¾‹å¦‚çˆ¶è¿›ç¨‹å…³é—­è¯»æè¿°ç¬¦ï¼Œè¿™æ ·çˆ¶è¿›ç¨‹åªèƒ½å‘ç®¡é“å†™æ•°æ®ï¼Œå­è¿›ç¨‹å…³é—­å†™æè¿°ç¬¦ï¼Œè¿™æ ·å­è¿›ç¨‹åªèƒ½ä»ç®¡é“è¯»æ•°æ®ã€‚æˆ–è€…ç›¸åã€‚å¦‚å›¾ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803110147.png]]\n\nShellä¹Ÿæä¾›äº†ç®¡é“ï¼Œåªéœ€ä½¿ç”¨ä¸€æ ¹ç«–çº¿è¿æ¥ä¸¤ä¸ªå‘½ä»¤å³å¯ã€‚ä¾‹å¦‚ï¼š\n\n```shell\nps -elf | grep \"sshd\"\n\ncat a.log | grep \"hello world\"\n```\n\nåœ¨shellä¸‹ï¼Œè¿™ç§ç®¡é“ç§°ä¸º**åŒ¿åç®¡é“**ï¼Œå³æ²¡æœ‰åç§°çš„ç®¡é“ã€‚å®ƒå¯¹äºç¼–å†™å‘½ä»¤è¡Œæ¥è¯´éå¸¸æ–¹ä¾¿ï¼Œä¸”é€»è¾‘æ¸…æ™°æ˜“æ‡‚ï¼Œshellè„šæœ¬å’Œshellå‘½ä»¤è¡Œå‡ ä¹é å®ƒæ‰“ä¸‹äº†åŠå£æ±Ÿå±±ã€‚\n\nåœ¨shellä¸‹ï¼Œè¿˜æ”¯æŒä½¿ç”¨mkfifoå‘½ä»¤åˆ›å»º**å‘½åç®¡é“**ï¼ˆnamed pipeï¼‰ï¼Œå³æœ‰åç§°çš„ç®¡é“ï¼Œå®ƒä¹Ÿç§°ä¸ºFIFOï¼Œå®ƒå¯ä»¥åè°ƒä»»æ„è¿›ç¨‹é—´çš„æ•°æ®é€šä¿¡ã€‚\n\nä¾‹å¦‚ï¼Œåˆ›å»ºå‘½åç®¡é“æ–‡ä»¶a.fifoï¼Œa.fifoå°±æ˜¯è¿™ä¸ªå‘½åç®¡é“çš„åç§°ã€‚è™½ç„¶å®ƒä»¥æ–‡ä»¶çš„æ–¹å¼å­˜åœ¨äºç£ç›˜ä¸Šï¼Œä½†å®ƒä¼ é€’æ•°æ®çš„æ–¹å¼**ä¸ä¼šç»è¿‡ç£ç›˜IO**ï¼Œè€Œæ˜¯**ç›´æ¥åœ¨å†…å­˜ä¸­ä¼ é€’**ï¼Œæ‰€ä»¥é€Ÿåº¦éå¸¸å¿«ï¼Œæ–‡ä»¶åä»…ä»…åªæ˜¯è¿™ä¸ªå‘½åç®¡é“çš„åç§°è€Œå·²ï¼Œæ˜¯**å¼•ç”¨è¿™ä¸ªç®¡é“çš„å…¥å£å’Œå‡ºå£**ã€‚\n\n```shell\n$ mkfifo a.fifo\n$ ls -l a.fifo\nprw-r--r-- 1 root root 0 Apr 30 23:52 a.fifo  # æ–‡ä»¶ç±»å‹ä¸ºp\n```\n\nå‘½åç®¡é“æ˜¯é˜»å¡å¼çš„åŒå‘é€šä¿¡ç®¡é“ï¼Œä»»æ„ä¸€æ–¹éƒ½å¯ä»¥è¯»ã€å†™ï¼Œä½†æ˜¯åªæœ‰è¯»ã€å†™ç«¯åŒæ—¶æ‰“å¼€äº†å‘½åç®¡é“æ—¶ï¼Œæ•°æ®æ‰ä¼šå†™å…¥å¹¶è¢«è¯»å–ã€‚ä¾‹å¦‚ï¼Œä¸‹å›¾ä¸­æ˜¾ç¤ºäº†åœ¨æœªæ‰“å¼€è¯»ç«¯å‘½åç®¡é“çš„æ—¶å€™ï¼Œæ‰€æœ‰å†™å‘½åç®¡é“çš„æ“ä½œéƒ½è¢«é˜»å¡ã€‚æœcat a.fifoæŒ‰ä¸‹å›è½¦é”®æ‰“å¼€è¯»ç«¯å‘½åç®¡é“ï¼Œå†™å’Œè¯»æ“ä½œéƒ½å°†æ­£å¸¸æ‰§è¡Œã€‚åŒç†ï¼Œåªæ‰“å¼€è¯»ç«¯è€Œæœªæ‰“å¼€å†™ç«¯å‘½åç®¡é“æ—¶ï¼Œè¯»æ“ä½œä¹Ÿä¼šè¢«é˜»å¡ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803110301.png]]\n\n## ç¼–ç¨‹æ¥å£\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005231142.png]]\n\n### æ— åç®¡é“\n\n\u003e è¯¥ç®¡é“æ˜¯å•å‘çš„ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005231241.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005231305.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005231452.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005231535.png]]\n\n### æœ‰åç®¡é“\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005232835.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5":{"title":"è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥","content":"# è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥\n\n## PLTä¸GOTå…³ç³»\n\nPLTPLTè¡¨ä¸­çš„æ•°æ®å°±æ˜¯GOTGOTè¡¨ä¸­çš„ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€å®šæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼š\nPLTPLTè¡¨ä¸­çš„æ¯ä¸€é¡¹çš„æ•°æ®å†…å®¹éƒ½æ˜¯å¯¹åº”çš„GOTGOTè¡¨ä¸­ä¸€é¡¹çš„åœ°å€è¿™ä¸ªæ˜¯å›ºå®šä¸å˜çš„ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220908214812.png]]\n\n## æµç¨‹\n\n\u003e [(35æ¡æ¶ˆæ¯) PWNåŸºç¡€15ï¼šGOTè¡¨ å’Œ PLTè¡¨_prettyXçš„åšå®¢-CSDNåšå®¢_æŸ¥çœ‹gotè¡¨](https://blog.csdn.net/prettyX/article/details/107404509?spm=1001.2101.3001.4242.2\u0026utm_relevant_index=4)\n\n1. ç¨‹åºåŠ è½½\n2. è§¦å‘é‡å®šå‘\n\t1. ä¿®æ”¹GOTè¡¨[0]ï¼Œå‘å…¶å¡«å……PLTè¡¨é¦–åœ°å€ï¼Œç”¨äºè§¦å‘æŸ¥æ‰¾\n\t2. ä¿®æ”¹GOTè¡¨[2]ï¼Œå‘å…¶å¡«å……è¿æ¥å™¨æŸ¥æ‰¾å‡½æ•°åœ°å€ï¼Œç”¨äºæŸ¥æ‰¾ç›®æ ‡å‡½æ•°çœŸå®åœ°å€\n3. é¦–æ¬¡è°ƒç”¨ç›®æ ‡åŠ¨æ€è¿æ¥å‡½æ•°ï¼Œå‡è®¾ç›®æ ‡å‡½æ•°æ ‡å·ä¸ºnï¼š\n4. PLTè·³è½¬åˆ°GOT[n]\n5. GOT[n]åˆå§‹å¡«å……çš„æ˜¯PLT[n]åä¸€æ¡åœ°å€ï¼Œæ¥ç€ä¸¤æ¡æŒ‡ä»¤ï¼š\n\t1. push ç¼–å·n\n\t2. è·³è½¬åˆ°PLT[0]\n6. PLT[0] åŒ…å«ä¸¤æ¡æŒ‡ä»¤ï¼š\n\t1. push GOT[1] -- å¡«å……çš„æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥#link_map|link_map]]çš„åœ°å€\n\t2. è·³è½¬åˆ°GOT[2]å†…å¡«å……çš„åœ°å€ç©ºé—´  -- é“¾æ¥å™¨\n3. æ­¤æ—¶ä¸€å…±pushäº†2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªç›®æ ‡å‡½æ•°IDï¼Œä¸€ä¸ªlink_mapåœ°å€ï¼Œæ­£å¥½æ˜¯_dl_runtime_resolveçš„ä¸¤ä¸ªå‚æ•°ã€‚\n4. \\_dl_runtime_resolve æ‰¾åˆ°åŠ¨æ€é“¾æ¥å‡½æ•°çœŸå®åœ°å€ï¼Œå›å¡«åˆ°GOT[n]ã€‚\n\t\u003e [_dl_runtime_resolve - ç®€ä¹¦ (jianshu.com)](https://www.jianshu.com/p/57f6474fe4c6)\n\n## link_map\n\nGOT[1]ï¼šä¸€ä¸ªæŒ‡å‘å†…éƒ¨æ•°æ®ç»“æ„çš„æŒ‡é’ˆï¼Œç±»å‹æ˜¯ link_mapï¼Œåœ¨åŠ¨æ€è£…è½½å™¨ï¼ˆ[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/_dl_runtime_resolve|_dl_runtime_resolve()]]ï¼‰å†…éƒ¨ä½¿ç”¨ï¼ŒåŒ…å«äº†è¿›è¡Œ[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ç¬¦å·è§£æ|ç¬¦å·è§£æ]]éœ€è¦çš„å½“å‰ ELF å¯¹è±¡çš„ä¿¡æ¯ã€‚\n\n## 2æ¬¡è°ƒç”¨å¯¹æ¯”\n\n![[z-oblib/z2-attachments/Pasted image 20220908214703.png]]\n\n![[z-oblib/z2-attachments/Pasted image 20220908214706.png]]","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E9%81%97%E8%A8%80%E5%87%BD%E6%95%B0":{"title":"é—è¨€å‡½æ•°","content":"\n# é—è¨€å‡½æ•°\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005023226.png]]\n\n## æ³¨å†Œé—è¨€å‡½æ•°\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005023259.png]]\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8":{"title":"é‡å®šä½è¡¨","content":"# é‡å®šä½è¡¨\n\n\u003e ä¸€å¼ â€œéœ€æ±‚è¡¨â€ï¼šå‘Šè¯‰é“¾æ¥å™¨å“ªäº›æŒ‡ä»¤å³è¯¥æŒ‡ä»¤çš„å“ªäº›éƒ¨åˆ†è¦è°ƒæ•´ã€‚\n\né‡å®šä½è¡¨ï¼ˆRelocation Tableï¼‰ç”¨äºåœ¨ç¨‹åºåŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼Œè¿›è¡Œå†…å­˜åœ°å€çš„ä¿®æ­£ã€‚\n\nå¯¹äºå¯é‡å®šä½çš„ELFæ–‡ä»¶æ¥è¯´ï¼Œå®ƒå¿…é¡»åŒ…å«æœ‰é‡å®šä½è¡¨ï¼Œç”¨æ¥æè¿°**å¦‚ä½•ä¿®æ”¹ç›¸åº”çš„æ®µé‡Œçš„å†…å®¹**ã€‚\n\nå¯¹äº**æ¯ä¸ªè¦é‡å®šä½çš„ELFæ®µéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„é‡å®šä½è¡¨**ï¼Œè€Œä¸€ä¸ªé‡å®šä½è¡¨å¾€å¾€å°±æ˜¯ELFæ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ®µï¼Œæ‰€ä»¥å…¶å®é‡å®šä½è¡¨ä¹Ÿå¯ä»¥å«é‡å®šä½æ®µã€‚\n\n## ç»“æ„\n\næ¯”å¦‚ä»£ç æ®µâ€œtextâ€å¦‚æœ‰è¦è¢«é‡å®šä½çš„åœ°æ–¹,é‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªç›¸å¯¹åº”å«â€œ, rel.textâ€çš„æ®µä¿å­˜äº†ä»£ç æ®µçš„é‡å®šä½è¡¨;å¦‚æœä»£ç æ®µâ€œdataâ€æœ‰è¦è¢«é‡å®šä½çš„åœ°æ–¹,å°±ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹åº”å«â€œ rel.data\"â€çš„æ®µä¿å­˜äº†æ•°æ®æ®µçš„é‡å®šä½è¡¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ objdumpæ¥æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„é‡å®šä½è¡¨ã€‚\n![[z-oblib/z2-attachments/Pasted image 20220911164434.png]]\n\næ¯ä¸ªè¦è¢«é‡å®šä½çš„åœ°æ–¹å«ä¸€ä¸ªé‡å®šå…¥å£( Relocation Entry,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°â€œa.o\"é‡Œé¢æœ‰ä¸¤ä¸ªé‡å®šä½å…¥å£ã€‚\n\né‡å®šä½å…¥å£çš„åç§»(Oset)è¡¨ç¤ºè¯¥å…¥å£åœ¨è¦è¢«é‡å®šä½çš„**æ®µä¸­çš„ä½ç½®**,\n`RELOCATION RECORDS FOR .text`è¡¨ç¤ºè¿™ä¸ªé‡å®šä½è¡¨æ˜¯ä»£ç æ®µçš„é‡å®šä½è¡¨ï¼Œæ‰€ä»¥**åç§»è¡¨ç¤ºä»£ç æ®µä¸­é¡»è¦è¢«è°ƒæ•´çš„ä½ç½®**ã€‚\nå¯¹ç…§åæ±‡ç¼–ç»“æœå¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œçš„0xlcå’Œ0x27åˆ†åˆ«å°±æ˜¯ä»£ç æ®µä¸­â€œmovâ€æŒ‡ä»¤å’Œâ€œcallâ€æŒ‡ä»¤çš„åœ°å€éƒ¨åˆ†ã€‚\n\nå¯¹äº32ä½çš„ Intel x86ç³»åˆ—å¤„ç†å™¨æ¥è¯´,é‡å®šä½è¡¨çš„ç»“æ„ä¹Ÿå¾ˆç®€å•,å®ƒæ˜¯ä¸€ä¸ªEl32 Rel ç»“æ„çš„æ•°ç»„,æ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”ä¸€ä¸ªé‡å®šä½å…¥å£ã€‚Ef32Relçš„å®šä¹‰å¦‚ä¸‹ï¼š\n\n```c\ntypedef uint32_t Elf32_Addr;\ntypedef uint32_t Elf32_Word;\n\ntypedef struct\n{\n  Elf32_Addr    r_offset;       /* Address */\n  Elf32_Word    r_info;         /* Relocation type and symbol index */\n} Elf32_Rel;\n\ntypedef uint64_t Elf64_Addr;\ntypedef uint64_t Elf64_Xword;\ntypedef int64_t  Elf64_Sxword;\n\ntypedef struct\n{\n  Elf64_Addr    r_offset;       /* Address */\n  Elf64_Xword   r_info;         /* Relocation type and symbol index */\n  Elf64_Sxword  r_addend;       /* Addend */\n} Elf64_Rela;\n```\n\n![[z-oblib/z2-attachments/Pasted image 20220911164813.png]]\n\n32 ä½ç¨‹åºä½¿ç”¨ RELï¼Œè€Œ 64 ä½ç¨‹åºä½¿ç”¨ RELAã€‚\n\nä¸‹é¢çš„å®æè¿°äº† r_info æ˜¯æ€æ ·è¢«è§£æå’Œæ’å…¥çš„ï¼š\n\n```c\n/* How to extract and insert information held in the r_info field.  */\n\n#define ELF32_R_SYM(val)        ((val) \u003e\u003e 8)\n#define ELF32_R_TYPE(val)       ((val) \u0026 0xff)\n#define ELF32_R_INFO(sym, type)     (((sym) \u003c\u003c 8) + ((type) \u0026 0xff))\n\n#define ELF64_R_SYM(i)          ((i) \u003e\u003e 32)\n#define ELF64_R_TYPE(i)         ((i) \u0026 0xffffffff)\n#define ELF64_R_INFO(sym,type)      ((((Elf64_Xword) (sym)) \u003c\u003c 32) + (type))\n```\n\nä¸¾ä¸ªä¾‹å­ï¼š\n\n```c\nELF32_R_SYM(Elf32_Rel-\u003er_info) = (Elf32_Rel-\u003er_info) \u003e\u003e 8\n```\n\næ¯ä¸ªç¬¦å·ä½¿ç”¨ Elf_Sym ç»“æ„ä½“æ¥æè¿°ï¼Œå­˜åœ¨äºÂ `.dynsym`Â æ®µå’ŒÂ `.symtab`Â æ®µä¸­ï¼Œè€ŒÂ `.symtab`Â åœ¨ strip ä¹‹åä¼šè¢«åˆ æ‰ï¼š\n\n```c\ntypedef struct\n{\n  Elf32_Word    st_name;        /* Symbol name (string tbl index) */\n  Elf32_Addr    st_value;       /* Symbol value */\n  Elf32_Word    st_size;        /* Symbol size */\n  unsigned char st_info;        /* Symbol type and binding */\n  unsigned char st_other;       /* Symbol visibility */\n  Elf32_Section st_shndx;       /* Section index */\n} Elf32_Sym;\n\ntypedef struct\n{\n  Elf64_Word    st_name;        /* Symbol name (string tbl index) */\n  unsigned char st_info;        /* Symbol type and binding */\n  unsigned char st_other;       /* Symbol visibility */\n  Elf64_Section st_shndx;       /* Section index */\n  Elf64_Addr    st_value;       /* Symbol value */\n  Elf64_Xword   st_size;        /* Symbol size */\n} Elf64_Sym;\n```\n\nä¸‹é¢çš„å®æè¿°äº† `st_info` æ˜¯æ€æ ·è¢«è§£æå’Œæ’å…¥çš„ï¼š\n\n```c\n/* How to extract and insert information held in the st_info field.  */\n\n#define ELF32_ST_BIND(val)      (((unsigned char) (val)) \u003e\u003e 4)\n#define ELF32_ST_TYPE(val)      ((val) \u0026 0xf)\n#define ELF32_ST_INFO(bind, type)   (((bind) \u003c\u003c 4) + ((type) \u0026 0xf))\n\n/* Both Elf32_Sym and Elf64_Sym use the same one-byte st_info field.  */\n#define ELF64_ST_BIND(val)      ELF32_ST_BIND (val)\n#define ELF64_ST_TYPE(val)      ELF32_ST_TYPE (val)\n#define ELF64_ST_INFO(bind, type)   ELF32_ST_INFO ((bind), (type))\n```\n\n## å·¥ä½œæ–¹å¼\n\n![[z-oblib/z2-attachments/Pasted image 20220911032644.png]]\n\n- \"main\"çš„èµ·å§‹åœ°å€ä¸º0x00000000ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æœªè¿›è¡Œç©ºé—´åˆ†é…ä¹‹å‰ï¼Œç›®æ ‡æ–‡ä»¶ä»£ç æ®µä¸­çš„èµ·å§‹åœ°å€ä»¥0x00000000å¼€å§‹ï¼Œç­‰åˆ°ç©ºé—´åˆ†é…å®Œæˆä»¥åï¼Œå„ä¸ªå‡½æ•°æ‰ä¼šç¡®å®šè‡ªå·±åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä½ç½®ã€‚\n- åç§»ä¸º0x18çš„åœ°å€ä¸Šæ˜¯ä¸€æ¡movæŒ‡ä»¤ï¼Œæ€»å…±8ä¸ªå­—èŠ‚ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†â€œsharedâ€çš„åœ°å€èµ‹å€¼åˆ°espå¯„å­˜å™¨+4çš„åç§»åœ°å€ä¸­å»ï¼Œå‰é¢4ä¸ªå­—èŠ‚â€œc7442404â€æ˜¯movçš„æŒ‡ä»¤ç ï¼Œåé¢4ä¸ªå­—èŠ‚æ˜¯â€œsharedâ€çš„åœ°å€ã€‚\n- åç§»ä¸º0x26çš„åœ°å€ä¸Šæ˜¯ä¸€æ¡è°ƒç”¨æŒ‡ä»¤ï¼Œå®ƒè¡¨ç¤ºå¯¹swapå‡½æ•°çš„è°ƒç”¨ã€‚è¿™æ¡æŒ‡ä»¤å…±5ä¸ªå­—èŠ‚ï¼Œå‰é¢çš„0xe8æ˜¯æ“ä½œç ï¼Œè¿™æ˜¯ä¸€æ¡**è¿‘å€ç›¸å¯¹ä½ç§»è°ƒç”¨æŒ‡ä»¤**ï¼Œåé¢4ä¸ªå­—èŠ‚å°±æ˜¯è¢«è°ƒç”¨å‡½æ•°çš„ç›¸å¯¹äºè°ƒç”¨æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åç§»é‡ã€‚åœ¨æ²¡æœ‰é‡å®šä½ä¹‹å‰ï¼Œç›¸å¯¹åç§»è¢«ç½®ä¸º0xFFFFFFFCï¼ˆå°ç«¯ï¼‰ï¼Œå®ƒæ˜¯å¸¸é‡â€œ-4â€çš„è¡¥ç å½¢å¼ã€‚\n\né€šè¿‡å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„é‡å®šä½è¡¨ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220911032735.png]]\n\nOFFSETæ˜¯é‡å®šä½çš„å…¥å£åç§»ï¼Œè¡¨ç¤º**è¯¥å…¥å£åœ¨è¦è¢«é‡å®šä½çš„æ®µä¸­çš„ä½ç½®**ã€‚â€œ.textâ€è¡¨ç¤ºè¿™ä¸ªé‡å®šä½è¡¨ç¤ºä»£ç æ®µçš„é‡å®šä½è¡¨ï¼Œæ‰€ä»¥åç§»è¡¨ç¤ºä»£ç æ®µä¸­éœ€è¦è¢«è°ƒæ•´çš„ä½ç½®ã€‚è¿™é‡Œçš„0x1cå’Œ0x27åˆ†åˆ«å°±æ˜¯ä»£ç æ®µä¸­â€œmovâ€æŒ‡ä»¤å’Œâ€œcallâ€æŒ‡ä»¤æ‰€åœ¨è¡Œçš„**åœ°å€éƒ¨åˆ†**ï¼Œå³å‚æ•°ã€‚\n\n","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E9%94%81":{"title":"é”","content":"# é”\n\nè®¡ç®—æœºé¢†åŸŸä¸­ï¼Œé”æœºåˆ¶ä½¿ç”¨çš„éå¸¸å¤šã€‚å®ƒä¸»è¦æ˜¯ä¸ºäº†é¿å…å¤šä¸ªè¿›ç¨‹è®¿é—®åŒä¸€èµ„æºæ—¶ï¼Œå¯èƒ½å‡ºç°çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚\n\nä¾‹å¦‚ï¼Œcatå‘½ä»¤è¾“å‡ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ–‡ä»¶å†…å®¹ï¼Œcatå‘½ä»¤çš„ç‰¹æ€§æ˜¯éœ€è¦å…ˆå°†æ‰€æœ‰ç£ç›˜æ–‡ä»¶æ•°æ®è¯»å–åˆ°å†…å­˜åå†è¾“å‡ºï¼Œæ‰€ä»¥catè¾“å‡ºä¸€ä¸ªå¤§æ–‡ä»¶å¯èƒ½éœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´ã€‚å¦‚æœåœ¨catåœ¨åŠ è½½æ–‡ä»¶æ—¶ï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šå‘è¿™ä¸ªæ–‡ä»¶è¿½åŠ äº†ä¸€è¡Œæ•°æ®ï¼Œé‚£ä¹ˆcatæœ€ç»ˆåŠ è½½çš„æ•°æ®ä¼šåŒ…å«è¿™è¡Œæ–°è¿½åŠ çš„æ•°æ®å—ï¼Ÿ\n\nå†æ›´ç®€å•çš„ä¸€ä¸ªç¤ºä¾‹æ˜¯ï¼Œä¸¤ä¸ªç”¨æˆ·åŒæ—¶ç”¨vimæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å»ä¿®æ”¹æ•°æ®ï¼Œé‚£ä¹ˆä»¥è°ä¿®æ”¹çš„æ•°æ®ä¸ºå‡†å‘¢ï¼Ÿæ‰€ä»¥ï¼Œvimä¸ºäº†é¿å…è¿™ç§é—®é¢˜ï¼Œæ¯æ¬¡æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œéƒ½ä¼šåœ¨æ–‡ä»¶çš„åŒä¸€ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªéšè—çš„.swpä¸´æ—¶æ–‡ä»¶ï¼ˆä¾‹å¦‚vim a.logæ—¶ä¼šç”Ÿæˆä¸€ä¸ª.a.log.swpçš„æ–‡ä»¶ï¼‰ï¼Œå¦‚æœæœ‰å…¶å®ƒç”¨æˆ·ç”¨vimå»æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¼šæ£€æŸ¥è¿™ä¸ªéšè—æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨è¯´æ˜æœ‰äººæ­£åœ¨ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ã€‚\n\né”çš„å†…å®¹éå¸¸å¤šï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸‹å®ƒæœ€åŸºæœ¬ä¹Ÿæœ€å®ç”¨çš„åŸºç¡€çŸ¥è¯†ã€‚\n\nå¦‚æœä¸ä½¿ç”¨é”ï¼Œä¹Ÿå°±æ˜¯å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶æ›´æ–°ã€è¯»å–åŒä¸€ä»½æ•°æ®ï¼Œå°†å¯èƒ½å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š\n\n1. è„è¯»ï¼šè¯»å–åˆ°è„æ•°æ®ã€‚ä¾‹å¦‚ç”¨æˆ·Aç”¨vimå°†æ–‡ä»¶ä¸­çš„å­—æ¯xä¿®æ”¹ä¸ºäº†yï¼Œç”¨æˆ·Båœ¨vimä¿å­˜ä¹‹å‰é€šè¿‡catè¯»å–ï¼Œå¾—åˆ°çš„è¿™ä¸ªå­—æ¯å°†æ˜¯xï¼Œè¿™ç§ç°è±¡ç§°ä¸ºè„è¯»ã€‚ä½†å…¶å®Aå·²ç»å°†å®ƒä¿®æ”¹ä¸ºäº†yï¼Œåªä¸è¿‡è¯¥ä¿®æ”¹åªå­˜åœ¨äºAçš„vimç¼“å­˜ä¸­ï¼Œè¿˜æ²¡æœ‰ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚é€šå¸¸ï¼Œ**å°†ç¼“å­˜ä¸­ä¿®æ”¹åä½†æ²¡æœ‰ä¿å­˜çš„æ•°æ®ç§°ä¸ºè„æ•°æ®**ã€‚\n2. æ›´æ–°ä¸¢å¤±ï¼šæŸç”¨æˆ·çš„æ•°æ®æ›´æ–°æ“ä½œè¢«å…¶å®ƒç”¨æˆ·è¦†ç›–ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·Aå’Œç”¨æˆ·BåŒæ—¶ä¿®æ”¹åŒä¸€æ–‡ä»¶ä¸­çš„æœ€åä¸€ä¸ªå­—ç¬¦aï¼ŒAå°†aä¿®æ”¹ä¸ºxï¼ŒBå°†aä¿®æ”¹ä¸ºyï¼Œé‚£ä¹ˆAå…ˆä¿å­˜çš„è¯ï¼ŒBçš„ä¿®æ”¹å°†è¦†ç›–Açš„ä¿®æ”¹ï¼Œæœ€ç»ˆä¿å­˜çš„ç»“æœæ˜¯yï¼Œå¦‚æœBå…ˆä¿å­˜çš„è¯ï¼ŒAçš„ä¿®æ”¹å°†è¦†ç›–Bçš„ä¿®æ”¹ï¼Œæœ€ç»ˆç»“æœå¾—åˆ°å­—ç¬¦xã€‚æ‰€ä»¥ï¼ŒåŒæ—¶ä¿®æ”¹æ•°æ®æ—¶ï¼Œæœ‰ä¸€ä¸ªè¿›ç¨‹çš„æ›´æ–°è¢«è¦†ç›–äº†ï¼Œä¹Ÿå°±æ˜¯ä¸¢å¤±äº†ã€‚\n\né™¤è¿™ä¸¤ä¸ªé—®é¢˜ä¹‹å¤–ï¼Œåœ¨å¤šè¿›ç¨‹åŒæ—¶æ›´æ–°ã€è¯»å–åŒä¸€ä»½æ•°æ®æ—¶ï¼Œè¿˜å¯èƒ½ä¼šå‡ºç°å…¶å®ƒç°è±¡ï¼Œè¿™é‡Œä¸å†å¤šåšæè¿°ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹é”çš„æœºåˆ¶ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803161908.png]]\n\nå½“éœ€è¦è¯»æ•°æ®æ—¶ï¼Œå°†ç”³è¯·è¯»é”ï¼Œå½“éœ€è¦ä¿®æ”¹æ•°æ®æ—¶ï¼Œå°†ç”³è¯·å†™é”ã€‚\n\nç”³è¯·é”çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæ£€æŸ¥è¯¥èµ„æºä¸Šæ˜¯å¦å·²ç»æœ‰é”ï¼Œå¦‚æœæœ‰é”ï¼Œæ£€æŸ¥å·²å­˜åœ¨çš„é”ä¸å¾…ç”³è¯·çš„é”æ˜¯å¦å¯ä»¥å…¼å®¹å…±å­˜ã€‚\n\n1. å½“å¤šä¸ªè¿›ç¨‹éƒ½åªæ˜¯è¯»å–åŒä¸€ä»½èµ„æºï¼ˆå³éƒ½ç”³è¯·Sé”ï¼‰ï¼Œå› ä¸ºæ²¡æœ‰ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥**å…è®¸å®ƒä»¬åŒæ—¶è¯»å–**ï¼Œæ‰€ä»¥Sé”ä¸Sé”æ˜¯å¯ä»¥å…±å­˜çš„ã€‚\n2. å¦‚æœæœ‰ä¸€ä¸ªè¿›ç¨‹ä¿®æ”¹æ•°æ®ï¼Œå®ƒå°†ç”³è¯·Xé”ï¼Œè¿™æ—¶æ˜¾ç„¶ä¸èƒ½è®©å…¶å®ƒè¿›ç¨‹è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œæ‰€ä»¥Xé”ä¸Sé”ã€Xé”å’ŒXé”éƒ½æ˜¯äº’æ–¥çš„ã€‚\n3. å¦‚æœä¸€ä¸ªè¿›ç¨‹æ­£åœ¨è¯»å–æ•°æ®ï¼ˆå³å·²ç”³è¯·Sé”ï¼‰ï¼Œå…¶å®ƒè¿›ç¨‹æƒ³ä¿®æ”¹æ•°æ®ï¼Œä¹Ÿæ˜¯ä¸å…è®¸çš„ï¼Œæ‰€ä»¥Sé”å’ŒXé”æ˜¯äº’æ–¥çš„ã€‚\n\næ­¤å¤–ï¼Œä½¿ç”¨é”éœ€è¦è€ƒè™‘é”çš„ç²’åº¦ï¼Œå³å¯¹å¤šå°‘èµ„æºé‡ä¸Šé”ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œå¯ä»¥ç›´æ¥å¯¹æ•´ä¸ªæ–‡ä»¶ä¸Šé”ï¼Œä¹Ÿå¯ä»¥åªå¯¹æ–‡ä»¶ä¸­æƒ³è¦è®¿é—®çš„é‚£éƒ¨åˆ†æ•°æ®ä¸Šé”ã€‚å¦‚æœç›´æ¥å¯¹æ•´ä¸ªæ–‡ä»¶ä¸Šé”ï¼Œå…¶å®ƒè¿›ç¨‹ç”³è¯·è¯¥æ–‡ä»¶çš„äº’æ–¥é”å°†æ€»æ˜¯è¢«é˜»å¡ï¼Œè€Œå¦‚æœåªæ˜¯é”å®šè¯¥æ–‡ä»¶ä¸­çš„å‰10Kæ•°æ®ï¼Œé‚£ä¹ˆå…¶å®ƒè¿›ç¨‹å¦‚æœç”³è¯·çš„äº’æ–¥é”ä»ç¬¬20Kå¼€å§‹çš„æ•°æ®ï¼Œå°±ä¸ä¼šæ”¶åˆ°å½±å“ã€‚\n\næ‰€ä»¥ï¼Œé”çš„ç²’åº¦è¶Šå¤§ï¼Œé˜»æ­¢å…¶å®ƒè¿›ç¨‹çš„å¯èƒ½æ€§å°±è¶Šå¤§ï¼Œå¤šè¿›ç¨‹å¹¶å‘çš„èƒ½åŠ›å°±è¶Šå·®ã€‚é”çš„ç²’åº¦è¶Šå°ï¼Œé˜»æ­¢å…¶å®ƒè¿›ç¨‹çš„å¯èƒ½æ€§å°±è¶Šå°ï¼Œå¹¶å‘çš„èƒ½åŠ›å°±è¶Šå¼ºã€‚\n\nä½†æ˜¯ï¼Œé”çš„ç²’åº¦å¤ªå°ä¹Ÿä¸ä¸€å®šå¥½ï¼Œå› ä¸ºæ¯ä¸ªé”éƒ½æ˜¯éœ€è¦é¢å¤–ç®¡ç†çš„ï¼Œç²’åº¦è¶Šå°ï¼Œéœ€è¦ç»´æŠ¤çš„é”æ•°é‡è¶Šå¤šã€‚æ¯”å¦‚é¢‘ç¹åˆ›å»ºé”å’Œé¢‘ç¹é‡Šæ”¾é”çš„å¼€é”€å¹¶ä¸ä¸€å®šå°ï¼Œç”šè‡³åœ¨æç«¯çš„æ—¶å€™æ¯”ç»´æŠ¤å•ä¸ªç²—ç²’åº¦çš„é”æ•ˆç‡æ›´ä½ã€‚\n\nåœ¨shellå‘½ä»¤è¡Œä¸‹ï¼Œæä¾›äº†ä¸€ä¸ªflockå‘½ä»¤ï¼Œå®ƒå¯ä»¥é€šè¿‡æŸä¸ªæ–‡ä»¶æ¥å®ç°é”æœºåˆ¶ï¼šè¿è¡ŒæŸä¸ªå‘½ä»¤æ—¶åœ¨æŸä¸ªæ–‡ä»¶ä¸Šç”³è¯·é”ï¼ˆè¯»é”æˆ–å†™é”ï¼‰ï¼Œå¦å¤–ä¸€ä¸ªå‘½ä»¤è¿è¡Œæ—¶ä¹Ÿç”³è¯·è¯¥æ–‡ä»¶ä¸Šçš„é”ï¼ˆè¯»é”æˆ–å†™é”ï¼‰ï¼Œå¦‚æœé”å¯ä»¥å…±å­˜ï¼Œåˆ™ç¬¬äºŒä¸ªå‘½ä»¤å¯ä»¥æ‰§è¡Œï¼Œå¦åˆ™é»˜è®¤é˜»å¡ã€‚\n\nä¸‹é¢æ˜¯shellå‘½ä»¤è¡Œä¸‹flockå‘½ä»¤çš„ç®€å•ç”¨æ³•ï¼Œæ›´è¯¦ç»†å†…å®¹å¯man flockè‡ªè¡Œæ¢ç´¢ã€‚\n\n```shell\n# ä»¥ä¸‹ä»£ç åœ¨ç»ˆç«¯1ä¸Šæ‰§è¡Œ\n# åœ¨/tmp/a.lockä¸Šç”³è¯·å…±äº«é”ï¼ˆ-sï¼‰ï¼Œç”³è¯·æˆåŠŸå°±è¿è¡Œsleep 10å‘½ä»¤\n# å› ä¸ºæ­¤æ—¶/tmp/a.lockä¸Šè¿˜æ²¡æœ‰ä»»ä½•é”ï¼Œæ‰€ä»¥ç”³è¯·æˆåŠŸ\n$ flock -s /tmp/a.lock sleep 10\n\n# ä»¥ä¸‹ä»£ç åœ¨ç»ˆç«¯2ä¸Šæ‰§è¡Œ\n# åœ¨/tmp/a.lockä¸Šç”³è¯·äº’æ–¥é”ï¼ˆ-xï¼‰ï¼Œç”³è¯·æˆåŠŸå°±è¿è¡Œcat /etc/passwdå‘½ä»¤\n# å› ä¸º/tmp/a.lockä¸Šå·²ç»æœ‰å…±äº«é”ï¼Œæ‰€ä»¥é˜»å¡ï¼Œç›´åˆ°10såå…±äº«é”é‡Šæ”¾\n$ flock -x /tmp/a.lock cat /etc/passwd\n```","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E9%9D%99%E6%80%81%E9%87%8D%E5%AE%9A%E4%BD%8D":{"title":"é™æ€é‡å®šä½","content":"# é™æ€é‡å®šä½\n\n```cpp\n//mainA.c\n\nint globalvar=0x123;\nfun test(){\n}\n\n//mainB.c\nextern test();\nextern int globalvar;\nfun testFunB(){\n\ttest();\n\tprintf(\"I am  %d\\r\\n\",globalvar)\n}\n```\n\næˆ‘ä»¬ç¨‹åºæœ‰ä¸¤ä¸ªæºä»£ç ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ç¼–è¯‘çš„æ—¶å€™æˆ‘ä»¬é¦–å…ˆå…ˆå°†ç¨‹åºç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶ã€‚\nä¹Ÿå°±æ˜¯mainB.o mainA.oï¼Œåœ¨ç›®æ ‡æ–‡ä»¶ä¸­mainB.oä¸çŸ¥é“testå‡½æ•°å’Œglobalvarå˜é‡çš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨é“¾æ¥æ—¶ä¿®æ­£mainB.oå‡½æ•°è°ƒç”¨åœ°å€ã€‚\n\nåœ¨ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠŠæ–‡ä»¶ä¸­æ‰€æœ‰çš„å‡½æ•°ä¸å˜é‡åœ°å€æ”¾å…¥ä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ç¬¦å·è¡¨|ç¬¦å·è¡¨]]ä¸­ã€‚\nåœ¨é“¾æ¥æ—¶æŠŠæ‰€æœ‰ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨åˆæˆä¸€ä¸ªï¼Œç„¶ååˆ©ç”¨[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/é‡å®šä½è¡¨|é‡å®šä½è¡¨]]å’Œç¬¦å·è¡¨å®Œæˆå‡½æ•°è°ƒç”¨åœ°å€ä¿®æ­£ã€‚\n\næˆ‘ä»¬çœ‹é“¾æ¥å‰ç¤ºæ„å›¾ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220911031654.png]]\né“¾æ¥åï¼š\n![[z-oblib/z2-attachments/Pasted image 20220911031703.png]]","lastmodified":"2023-01-23T15:37:51.734680372Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/ELF":{"title":"ELF","content":"# ELF\n\n## æ–‡ä»¶æ ¼å¼\n\nç›®æ ‡æ–‡ä»¶æ—¢ä¼šå‚ä¸ç¨‹åºé“¾æ¥åˆä¼šå‚ä¸ç¨‹åºæ‰§è¡Œã€‚å‡ºäºæ–¹ä¾¿æ€§å’Œæ•ˆç‡è€ƒè™‘ï¼Œæ ¹æ®è¿‡ç¨‹çš„ä¸åŒï¼Œç›®æ ‡æ–‡ä»¶æ ¼å¼æä¾›äº†å…¶å†…å®¹çš„ä¸¤ç§å¹¶è¡Œè§†å›¾ï¼Œå¦‚ä¸‹ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220912001910.png]]\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/GDT":{"title":"GDT","content":"\n# GDT\n\nGDTæ®µæè¿°ç¬¦ç±»ä¼¼ä¸€ä¸ªå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªListï¼Œè¿™ä¸ªListä¿å­˜çš„æ˜¯Longå€¼ï¼ˆ64ä½ï¼‰ï¼Œå¯å‡è®¾ä¸º`List\u003cLong\u003e list = new ArrayList\u003cLong\u003e();`\n\nè¿™ä¸ªListåˆšå¼€å§‹çš„æ—¶å€™ç”±æ“ä½œç³»ç»Ÿåˆ›å»ºï¼Œæ”¾åœ¨å†…å­˜çš„æŸä¸ªä½ç½®ï¼Œä½ç½®åœ°å€ä¼šä¿å­˜åˆ°GDTRå¯„å­˜å™¨ä¸­ï¼Œç»“æ„å¦‚ä¸‹ï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923205651.png]]\n![[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/z-attachments/Pasted image 20220923205738.png]]\nè¿™é‡Œæ®µåŸºåœ°å€å’Œæ®µå±æ€§æ‹†åˆ†æ˜¯ä¸ºäº†å…¼å®¹16ä½ç¨‹åºï¼Œä¸€å¼€å§‹åªæœ‰å³åŠæ®µï¼Œåæ¥åŠ äº†å·¦è¾¹çš„ã€‚\n\n## å‚è€ƒ\n\n[ã€ŒCoding Masterã€ç¬¬28è¯ ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼çš„åˆ‡æ¢ä»£ç _å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1a54y1G7Re/?spm_id_from=333.337.search-card.all.click\u0026vd_source=dc239faaaafac9ea3e7880710bece137)\n[GDTã€GDTRå’Œæ®µå¯„å­˜å™¨çš„å…³ç³» - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/512150749)\n","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/GOT%E8%A1%A8":{"title":"GOTè¡¨","content":"# GOTè¡¨\n\n\u003e [æ·±å…¥ç†è§£GOTè¡¨å’ŒPLTè¡¨ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/130271689)\n\nGOT(Global Offset Table)å…¨å±€åç§»è¡¨ï¼Œé“¾æ¥å™¨ä¸ºå¤–éƒ¨ç¬¦å·å¡«å……çš„å®é™…åç§»åœ°å€è¡¨ã€‚\n\nä½äºæ•°æ®æ®µï¼Œå†…å®¹å¯ä¿®æ”¹ã€‚\n\n## ç»“æ„\n\n- GOT[1]ï¼šä¸€ä¸ªæŒ‡å‘å†…éƒ¨æ•°æ®ç»“æ„çš„æŒ‡é’ˆï¼Œç±»å‹æ˜¯ link_mapï¼Œåœ¨åŠ¨æ€è£…è½½å™¨å†…éƒ¨ä½¿ç”¨ï¼ŒåŒ…å«äº†è¿›è¡Œ[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ç¬¦å·è§£æ|ç¬¦å·è§£æ]]éœ€è¦çš„å½“å‰ ELF å¯¹è±¡çš„ä¿¡æ¯ã€‚åœ¨å®ƒçš„Â `l_info`Â åŸŸä¸­ä¿å­˜äº†Â `.dynamic`Â æ®µä¸­å¤§å¤šæ•°æ¡ç›®çš„æŒ‡é’ˆæ„æˆçš„ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬åé¢ä¼šåˆ©ç”¨å®ƒã€‚\n- GOT[2]ï¼šä¸€ä¸ªæŒ‡å‘åŠ¨æ€è£…è½½å™¨ä¸­Â [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/_dl_runtime_resolve|_dl_runtime_resolve]]Â å‡½æ•°çš„æŒ‡é’ˆã€‚","lastmodified":"2023-01-23T15:37:51.550678708Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E5%85%B3%E9%97%AD%E6%96%87%E4%BB%B6":{"title":"Linuxå…³é—­æ–‡ä»¶","content":"\n# Linuxå…³é—­æ–‡ä»¶\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221003231213.png]]\n\né€šè¿‡å¼•ç”¨è®¡æ•°æ¥ç¡®å®šæœ‰å‡ ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ–‡ä»¶æè¿°ç¬¦|æ–‡ä»¶æè¿°ç¬¦]]è¡¨å¼•ç”¨äº†è¯¥æ–‡ä»¶æè¿°ï¼Œå¦‚æœæœ¬æ¬¡å…³é—­åå¯¹åº”æ–‡ä»¶çš„åº•å±‚æ–‡ä»¶æè¿°å¼•ç”¨è®¡æ•°ä½0ï¼Œåˆ™å†…æ ¸é‡Šæ”¾è¯¥æ–‡ä»¶èµ„æºã€‚\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B":{"title":"Linuxåˆ›å»ºè¿›ç¨‹","content":"\n# Linuxåˆ›å»ºè¿›ç¨‹\n\n## fork\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005015332.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005015435.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005020045.png]]\n\n2.4å†…æ ¸ä¸‹forkæ—¶ä¼šæ‹·è´è¿›ç¨‹æ˜ åƒï¼ŒåŠä»£ç æ®µã€æ•°æ®æ®µã€æ ˆæ®µã€å †ç­‰ã€‚\n2.6å†…æ ¸ä¼šé‡‡ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œä¸å…¨é‡å¤åˆ¶PCBï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%96%87%E4%BB%B6%E5%85%83%E6%95%B0%E6%8D%AE":{"title":"Linuxæ–‡ä»¶å…ƒæ•°æ®","content":"\n# Linuxæ–‡ä»¶å…ƒæ•°æ®\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004222858.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004225821.png]]\n\næ•°æ®å—è¡¨æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º15çš„æ•´å‹æ•°ç»„ï¼Œæ¯ä¸ªå•å…ƒå­˜æ”¾ä¸€ä¸ªæ•°æ®å—ç¼–å·ã€‚å…¶ä¸­å‰11ä¸ªç›´æ¥å­˜æ”¾æ•°æ®å—ï¼Œå4ä¸ªæ˜¯å—é“¾çš„å½¢å¼ï¼Œå…¶ä¸­æ¯ä¸ªå—ï¼ˆ4Kæƒ…å†µï¼‰å¯ä»¥å­˜æ”¾1024ä¸ªæ•´æ•°ä»£è¡¨å…¶å®ƒå—çš„ç¼–å·ã€‚\n\n1K * 1K * 4K = 4G\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%96%87%E4%BB%B6%E5%A4%B9":{"title":"Linuxæ–‡ä»¶å¤¹","content":"\n# Linuxæ–‡ä»¶å¤¹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005003720.png]]\n\n## ä»£ç æ“ä½œ\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005003841.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005004007.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005004012.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%96%87%E4%BB%B6%E6%98%A0%E5%B0%84":{"title":"Linuxæ–‡ä»¶æ˜ å°„","content":"\n# Linuxæ–‡ä»¶æ˜ å°„\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004003539.png]]\n\n## mmap\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004003800.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004005826.png]]\nè¿”å›çš„æ˜¯è™šæ‹Ÿåœ°å€ã€‚\n\n## munmap\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004011854.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90":{"title":"Linuxæ–‡ä»¶æƒé™","content":"\n# Linuxæ–‡ä»¶æƒé™\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004232406.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B":{"title":"Linuxæ–‡ä»¶ç±»å‹","content":"\n# Linuxæ–‡ä»¶ç±»å‹\n\n## ç±»å‹æ£€æµ‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005001659.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005001956.png]]\n\nå·¦ä¾§0ä»£è¡¨8è¿›åˆ¶ï¼Œå³ä¾§4ä¸ª0ä»£è¡¨æ–‡ä»¶æƒé™ï¼Œ\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005003454.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%96%87%E4%BB%B6%E9%94%81":{"title":"Linuxæ–‡ä»¶é”","content":"\n# Linuxæ–‡ä»¶é”\n\nå¤šè¿›ç¨‹å¼‚æ­¥è®¿é—®æ–‡ä»¶éœ€è¦ä½¿ç”¨æ–‡ä»¶é”å®ç°åŒæ­¥ã€‚\n\n## è¿‡ç¨‹\n\nè¿›ç¨‹æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šäº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„struct fileå˜é‡ï¼Œç¡¬é“¾æ¥åˆ°å¯¹åº”inodeã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005004428.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005004553.png]]\n\n## fcntlä½¿ç”¨\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005004626.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005005033.png]]\n\n\t\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%9A%82%E5%81%9C%E8%BF%9B%E7%A8%8B":{"title":"Linuxæš‚åœè¿›ç¨‹","content":"\n# Linuxæš‚åœè¿›ç¨‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/z-attachments/Pasted image 20221006005459.png]]\n\nä»»æ„ä¿¡å·åˆ°è¾¾åï¼ˆä¿¡å·ä¸èƒ½è¢«å¿½ç•¥ï¼‰éƒ½ä¼šæ‰“æ–­ä¼‘çœ ã€‚\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%9B%B4%E6%96%B0%E8%BF%9B%E7%A8%8B%E6%98%A0%E5%83%8F":{"title":"Linuxæ›´æ–°è¿›ç¨‹æ˜ åƒ","content":"\n# Linuxæ›´æ–°è¿›ç¨‹æ˜ åƒ\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005181438.png]]\n\n## execveç³»ç»Ÿè°ƒç”¨\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005181921.png]]\n\n## åº“å‡½æ•°\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005183604.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005194047.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005195339.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF":{"title":"LinuxæŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯","content":"\n# LinuxæŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005012151.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F":{"title":"Linuxç¯å¢ƒå˜é‡","content":"\n# Linuxç¯å¢ƒå˜é‡\n\næ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ã€‚è¿›ç¨‹ä½¿ç”¨è¿™äº›å˜é‡çš„å€¼å»ä½¿ç”¨ç³»ç»Ÿæä¾›çš„èµ„æºã€‚æœ¬èŠ‚ä¸»è¦ä»‹ç»ä½¿ç”¨åº“å‡½æ•°æ“ä½œè¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚\n\n```\nchar *getenv(const char *name);\n\nåŠŸèƒ½ï¼šè·å–ç¯å¢ƒå˜é‡nameçš„å€¼\n\nå‚æ•°ï¼šname æŒ‡å®šç¯å¢ƒå˜é‡çš„åå­—ã€‚\n\nè¿”å›å€¼ï¼šæˆåŠŸÂ Â  è¿”å›ç¯å¢ƒå˜é‡nameçš„å€¼çš„é¦–åœ°å€Â Â Â Â \n\t\tè¿”å›NULLÂ Â Â  ä»£è¡¨æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªç¯å¢ƒå˜é‡\n\t\t\nint putenv(char *string);\n\nÂ Â Â Â  åŠŸèƒ½ï¼šå°†å­—ç¬¦ä¸²è®¾ç½®ä¸ºè¿›ç¨‹çš„ç¯å¢ƒå˜é‡\n\nÂ Â Â Â  å‚æ•°ï¼šstring ä»¥æ ¼å¼name=valueçš„å­—ç¬¦ä¸²ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²è®¾ç½®åˆ°è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ä¸­ã€‚Â  å¦‚æœè¿›ç¨‹ä¸­æœ‰å’ŒnameåŒåçš„ç¯å¢ƒå˜é‡ï¼Œåˆ™ä½¿ç”¨valueçš„å€¼æ›¿æ¢æ‰åŸæ¥çš„å€¼ã€‚å¦‚æœæ²¡æœ‰Â  åŒåçš„ç¯å¢ƒå˜é‡ï¼Œåˆ™å°†å­—ç¬¦ä¸²è®¾ç½®ä¸ºè¿›ç¨‹çš„ç¯å¢ƒå˜é‡\n\nÂ Â Â Â  è¿”å›å€¼ï¼šæˆåŠŸÂ Â  è¿”å› 0Â Â Â Â \n\nÂ  Â Â Â Â Â  é”™è¯¯Â Â  è¿”å›é0Â Â Â  errnoè¢«è®¾ç½®ä¸ºç›¸åº”çš„é”™è¯¯å€¼\n\nåˆ‡è®°ï¼šåªæ˜¯å°†å­—ç¬¦ä¸²è®¾ç½®åˆ°è¿›ç¨‹ç¯å¢ƒå˜é‡åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯æ‹·è´ã€‚å¦‚æœstringæŒ‡å‘çš„å­—ç¬¦ä¸²çš„å†…å®¹æ”¹å˜ï¼Œåˆ™å€¼åšç›¸åº”çš„æ”¹å˜\n\nÂ Â Â Â  Â int setenv(const char *name, const char *value, int overwrite);\n\nÂ Â Â Â  åŠŸèƒ½ï¼šå¦‚æœç¯å¢ƒå˜é‡å­˜åœ¨ï¼Œæ ¹æ®overriteçš„å€¼å¯¹ç¯å¢ƒå˜é‡æ“ä½œã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºç¯å¢ƒå˜é‡\n\nÂ Â Â Â  å‚æ•°ï¼šnameÂ  ç¯å¢ƒå˜é‡çš„åå­—\n\nÂ  Â Â  valueÂ  ç¯å¢ƒå˜é‡çš„å€¼\n\nÂ  Â Â  overwriteÂ  0Â  å¦‚æœç¯å¢ƒå˜é‡å·²ç»åœ¨åˆ—è¡¨ä¸­ï¼Œä¸æ”¹å˜ç¯å¢ƒå˜é‡çš„å€¼\n\nÂ  Â Â Â Â Â Â Â  é0Â  å¦‚æœç¯å¢ƒå˜é‡å·²ç»åœ¨åˆ—è¡¨ä¸­ï¼Œä½¿ç”¨valueçš„å€¼æ›¿æ¢æ‰åŸæ¥çš„å€¼\n\nÂ Â Â Â  è¿”å›å€¼ï¼šæˆåŠŸÂ Â  è¿”å› 0Â Â Â Â \n\nÂ  Â Â Â Â Â  é”™è¯¯Â Â  -1Â Â  errnoè¢«è®¾ç½®ä¸ºç›¸åº”çš„é”™è¯¯å€¼\n\nÂ Â Â  int unsetenv(const char *name);\n\nÂ Â Â Â  åŠŸèƒ½ï¼šä»ç¯å¢ƒå˜é‡åˆ—è¡¨ä¸­åˆ é™¤ç¯å¢ƒå˜é‡ï¼Œå¦‚æœç¯å¢ƒå˜é‡ä¸å­˜åœ¨ï¼Œä»€ä¹ˆéƒ½ä¸åš\n\nÂ Â Â Â  å‚æ•°ï¼šnameÂ  ç¯å¢ƒå˜é‡çš„åå­—\n\nÂ Â Â Â  è¿”å›å€¼ï¼šæˆåŠŸÂ Â  è¿”å› 0Â Â Â Â \n\nÂ  Â Â Â Â Â  é”™è¯¯Â Â  -1Â Â  errnoè¢«è®¾ç½®ä¸ºç›¸åº”çš„é”™è¯¯å€¼\n\nÂ Â Â Â  int clearenv(void);\n\nÂ Â Â  åŠŸèƒ½ï¼šæ¸…é™¤è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨å¹¶å°†å…¨å±€å˜é‡environè®¾ç½®ä¸ºNULLã€‚\n\nÂ Â Â Â  è¿”å›å€¼ï¼šæˆåŠŸÂ Â Â  0Â Â Â Â Â  é”™è¯¯Â Â  é0\n```\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84":{"title":"Linuxç”¨æˆ·å’Œç”¨æˆ·ç»„","content":"\n# Linuxç”¨æˆ·å’Œç”¨æˆ·ç»„\n\n## ç”¨æˆ·\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005000840.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005001013.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005001044.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005001117.png]]\n\n## ç”¨æˆ·ç»„\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005001417.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005001508.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E7%A1%AC%E8%BF%9E%E6%8E%A5%E6%95%B0":{"title":"Linuxç¡¬è¿æ¥æ•°","content":"\n# Linuxç¡¬è¿æ¥æ•°\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004232553.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E7%BA%BF%E7%A8%8B":{"title":"Linuxçº¿ç¨‹","content":"\n# Linuxçº¿ç¨‹\n\n## ç¼–ç¨‹æ¥å£\n\t\n### åˆ›å»ºçº¿ç¨‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012013033.png]]\n\n### è·å–è‡ªèº«tid\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012013146.png]]\n\n### ç»ˆæ­¢çº¿ç¨‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012013612.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012014007.png]]\n\n### çº¿ç¨‹åˆ†ç¦»ä¸æ±‡åˆ\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012014015.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012014124.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012014146.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5":{"title":"Linuxçº¿ç¨‹åŒæ­¥","content":"\n# Linuxçº¿ç¨‹åŒæ­¥\n\n- mutexé”\n- æ¡ä»¶å˜é‡\n- ä¿¡å·é‡\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E7%BB%88%E6%AD%A2%E8%BF%9B%E7%A8%8B":{"title":"Linuxç»ˆæ­¢è¿›ç¨‹","content":"\n# Linuxç»ˆæ­¢è¿›ç¨‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005020247.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91":{"title":"Linuxè¾“å…¥è¾“å‡ºé‡å®šå‘","content":"\n# Linuxè¾“å…¥è¾“å‡ºé‡å®šå‘\n\né‡å®šå‘æœ¬è´¨å°±æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ–‡ä»¶æè¿°ç¬¦|æ–‡ä»¶æè¿°ç¬¦]]çš„å¤åˆ¶ã€‚\n\n## æ–‡ä»¶æè¿°ç¬¦å¤åˆ¶\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004000920.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004000951.png]]\n\n## ä¸¾ä¾‹\n\næŸä¸ªbashè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004001748.png]]\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004002145.png]]\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004002250.png]]\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81":{"title":"Linuxè¿›ç¨‹çŠ¶æ€","content":"\n# Linuxè¿›ç¨‹çŠ¶æ€\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005012919.png]]\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005013249.png]]\n\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E8%BF%9B%E7%A8%8B%E8%B5%84%E6%BA%90%E5%9B%9E%E6%94%B6":{"title":"Linuxè¿›ç¨‹èµ„æºå›æ”¶","content":"\n# Linuxè¿›ç¨‹èµ„æºå›æ”¶\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005162512.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005163152.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005164405.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005164513.png]]\n\n\nwaitç­‰å¾…çš„æ˜¯å­è¿›ç¨‹ç»“æŸåå‘é€çš„SIGCHLDä¿¡å·ã€‚\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E8%AE%AF":{"title":"Linuxè¿›ç¨‹é—´é€šè®¯","content":"\n# Linuxè¿›ç¨‹é—´é€šè®¯\n\næƒ³è¦è¿›è¡Œè¿›ç¨‹é—´é€šè®¯ï¼Œéœ€è¦å€ŸåŠ©å†…æ ¸ç©ºé—´ã€‚\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005230322.png]]\n\nå•æœºæ“ä½œç³»ç»Ÿä¸Šçš„[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š\n\n1. ç‹¬ç«‹è¿›ç¨‹ï¼šè¿™ç±»è¿›ç¨‹ä¸ä¼šå’Œå…¶å®ƒè¿›ç¨‹æœ‰ä»»ä½•äº¤[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/æµ|æµ]]ã€‚\n2. åä½œè¿›ç¨‹ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ä¹‹é—´éœ€è¦äº¤æµã€‚\n\nä¾‹å¦‚ï¼Œ`ls /tmp`å‘½ä»¤æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œä¸ä¾èµ–äºå…¶å®ƒè¿›ç¨‹ï¼Œè€Œ`cat a.log | grep 'abc'`å‘½ä»¤ä¸­çš„ä¸¤ä¸ªè¿›ç¨‹æ˜¯åä½œè¿›ç¨‹ï¼Œgrepè¿›ç¨‹ä¾èµ–äºcatè¿›ç¨‹ï¼Œgrepåªæœ‰ç­‰å¾…åˆ°äº†catè¿›ç¨‹äº§ç”Ÿçš„æ•°æ®æ‰èƒ½ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚\n\nå¯¹äºå•æœºä¸Šä¸åŒè¿›ç¨‹ä¹‹é—´çš„åä½œï¼Œå„è¿›ç¨‹ä¹‹é—´éœ€è¦è¿›è¡Œæ•°æ®çš„äº¤æµï¼Œè¿™ç§è¡Œä¸ºç§°ä¸ºè¿›ç¨‹é—´é€šä¿¡ï¼ˆInter-process communicationï¼ŒIPCï¼‰ï¼Œå³è¿›ç¨‹ä¸è¿›ç¨‹çš„é€šä¿¡ã€‚\n\né™¤äº†å•æœºä¸Šçš„å¤šä¸ªè¿›ç¨‹å¯èƒ½éœ€è¦è¿›ç¨‹é—´é€šä¿¡ï¼Œå¤šè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹æœ‰æ—¶å€™ä¹Ÿéœ€è¦è¿›è¡Œè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œè¿™å¾ˆå¸¸è§ï¼Œä¾‹å¦‚æœ¬æœºä¸Šçš„QQå®¢æˆ·ç«¯è¿›ç¨‹éœ€è¦å’Œè…¾è®¯çš„QQæœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œæµè§ˆå™¨æµè§ˆç½‘é¡µæ—¶ï¼Œæµè§ˆå™¨è¿›ç¨‹éœ€è¦å’Œç½‘é¡µæ‰€åœ¨çš„æœåŠ¡ç«¯è¿›ç¨‹è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œç­‰ç­‰ã€‚\n\nè¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼æœ‰å¾ˆå¤šç§ã€‚ä»å¹¿ä¹‰ä¸Šè®²ï¼Œåªè¦è¿›ç¨‹é—´èƒ½å…±äº«æ•°æ®æˆ–ä¼ é€’æ•°æ®å°±ç®—æ˜¯è¿›ç¨‹é—´é€šä¿¡ã€‚ä¸‹é¢åˆ—å‡ºå¸¸è§çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼š\n\n| è¿›ç¨‹é—´é€šä¿¡æ–¹å¼                                            | æè¿°                                                 |\n|----------------------------------------------------|----------------------------------------------------|\n| æ–‡ä»¶ï¼ˆFileï¼‰                                           | å¤šä¸ªè¿›ç¨‹å¯ä»¥è·å–åˆ°åŒä¸€ä¸ªæ–‡ä»¶çš„æ•°æ®                                  |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ç®¡é“ \\| ç®¡é“]]ï¼ˆpipeï¼‰                                           | å•æ–¹å‘ä¼ è¾“æ•°æ®çš„ç®¡é“ï¼Œåªèƒ½ä¸€æ–¹å†™ï¼Œå¦ä¸€æ–¹è¯»                              |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/å¥—æ¥å­—\\|å¥—æ¥å­—]]ï¼ˆSocketï¼‰                                        | å¤šæœºè¿›ç¨‹é—´é€šä¿¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨æœ¬æœºè®©ä¸¤ä¸ªè¿›ç¨‹ä½¿ç”¨socketé€šä¿¡                    |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/UnixåŸŸå¥—æ¥å­—\\|UnixåŸŸå¥—æ¥å­—]]ï¼ˆUnix Domain Socketï¼‰                       | å•æœºè¿›ç¨‹é—´é€šè¿‡åŸŸå¥—æ¥å­—æ¨¡å¼é€šä¿¡ï¼Œå¯çœ‹ä½œæ˜¯åŒå‘ç®¡é“                           |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/å…±äº«å†…å­˜\\|å…±äº«å†…å­˜]]ï¼ˆShared Memoryï¼Œshmï¼‰                            | åœ¨ç‰©ç†å†…å­˜ä¸Šåˆ’åˆ†ä¸€ç‰‡å†…å­˜ï¼Œå¤šä¸ªè¿›ç¨‹å…±äº«è¿™ç‰‡å†…å­˜                            |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ–‡ä»¶æ˜ å°„\\|æ–‡ä»¶æ˜ å°„]]ï¼ˆMemory-maped fileï¼‰                            | å°†æ–‡ä»¶ä¸­çš„ä¸€æ®µæ•°æ®æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œå¤šä¸ªè¿›ç¨‹å…±äº«è¿™ç‰‡å†…å­˜                        |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ¶ˆæ¯é˜Ÿåˆ—\\|æ¶ˆæ¯é˜Ÿåˆ—]]ï¼ˆMessage Queueï¼‰                                | æŸè¿›ç¨‹å°†æ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå…¶å®ƒè¿›ç¨‹ä»é˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯                          |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ä¿¡å·\\|ä¿¡å·]]ï¼ˆSignalï¼‰                                         | é€šè¿‡å‘é€æŸäº›ä¿¡å·é€šçŸ¥å…¶å®ƒè¿›ç¨‹ï¼Œè¿›ç¨‹æ”¶åˆ°ä¿¡å·åšå‡ºä¸åŒçš„å¤„ç†                       |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ä¿¡å·é‡\\|ä¿¡å·é‡]]ï¼ˆSemaphoreï¼‰                                     | å°±æ˜¯ä¿¡å·ç¯ã€‚åº”ç”¨æ–¹å¼æœ‰å¤šç§ï¼Œå…¶ä½œç”¨æ¦‚æ‹¬èµ·æ¥å°±æ˜¯ï¼Œæ ¹æ®æ˜¯å¦æœ‰ä¿¡å·ç¯æˆ–ä¿¡å·ç¯çš„æ•°é‡å¤šå°‘æ¥å†³å®šæ˜¯å¦é˜»å¡è¿›ç¨‹ |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/é”\\|é”]]ï¼ˆLockï¼‰                                            | å¯¹èµ„æºä¸Šé”ï¼Œå¦‚æœèµ„æºå·²è¢«æŸè¿›ç¨‹é”ä½ï¼Œåˆ™å…¶å®ƒè¿›ç¨‹æƒ³è¦ä¿®æ”¹ç”šè‡³è¯»å–è¿™äº›èµ„æºï¼Œéƒ½å°†è¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«æ‰“å¼€ã€‚  |\n| [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/system_v_ipc\\|system_v_ipc]]                                            |   |\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E9%93%BE%E6%8E%A5%E6%96%87%E4%BB%B6":{"title":"Linuxé“¾æ¥æ–‡ä»¶","content":"\n# Linuxé“¾æ¥æ–‡ä»¶\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221004232735.png]]\n\nfileCæ˜¯fileBçš„è½¯é“¾æ¥ï¼ŒfileAå’ŒfileBæ˜¯ç¡¬é“¾æ¥ã€‚\n\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux_TCP%E7%BC%96%E7%A8%8B":{"title":"Linux_TCPç¼–ç¨‹","content":"\n# Linux_TCPç¼–ç¨‹\n\n## ç¼–ç¨‹æ¨¡å‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006193131.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006193853.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006193901.png]]\n\n## ä¸»è¦æ¥å£\n\n### socket\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006193943.png]]\n\n### bind\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006194037.png]]\n\n### listen\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006194147.png]]\n\nå®¢æˆ·ç«¯è¿æ¥åˆ°æ¥åä¼šæŠŠè¿æ¥æ”¾å…¥æœªå†³è¿æ¥é˜Ÿåˆ—ä¸­ã€‚\n\n### accept\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006194258.png]]\n\n### connect\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006195543.png]]\n\n### é€šç”¨åœ°å€å®¶æ—\n\n```c\nstruct sockaddr{\nÂ  sa_family_t sa_family;\nÂ Â charÂ sa_data[14];\n};\n```\n\n### ipv4åœ°å€å®¶æ—\n\n```c\nÂ Â Â Â  struct sockaddr_in {\n\nÂ Â Â Â Â Â  sa_family_tÂ  sin_family; /* address family: AF_INET */\n\nÂ Â Â Â Â Â  in_port_tÂ Â Â  sin_port; /* port in network byte order */\n\nÂ Â Â Â Â Â  struct in_addr sin_addr;Â Â  /* internet address */\n\n};\n\n/* Internet address. */\n\nstruct in_addr {\n\nÂ Â Â Â  uint32_tÂ Â  s_addr;Â Â Â Â  /* address in network byte order */\n\n};\n```\n\n### ipv6åœ°å€å®¶æ—\n\n```c\nÂ Â Â  struct sockaddr_in6 {\n\nÂ Â Â Â Â Â  sa_family_tÂ Â Â Â  sin6_family;Â Â  /* AF_INET6 */\n\nÂ Â Â Â Â Â  in_port_tÂ Â Â Â Â Â  sin6_port;Â Â Â Â  /* port number */\n\nÂ Â Â Â Â Â  uint32_tÂ Â Â  sin6_flowinfo; /* IPv6 flow information */\n\nÂ Â Â Â Â Â  struct in6_addr sin6_addr;Â Â Â Â  /* IPv6 address */\n\nÂ Â Â Â Â Â  uint32_tÂ Â Â  sin6_scope_id; /* Scope ID (new in 2.4) */\n\n};\n\nstruct in6_addr {\n\nÂ Â Â Â Â Â  unsigned charÂ Â  s6_addr[16];Â Â  /* IPv6 address */\n\n};\n```\n\n### å­—èŠ‚åºè½¬æ¢\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006195021.png]]\n\n### åœ°å€è½¬æ¢\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006195141.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006214207.png]]\n\n## æ¡ˆä¾‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006195719.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221006195805.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux_UDP%E7%BC%96%E7%A8%8B":{"title":"Linux_UDPç¼–ç¨‹","content":"\n# Linux_UDPç¼–ç¨‹\n\n## ç¼–ç¨‹æ¨¡å‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012002622.png]]\n\n### æœåŠ¡ç«¯\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012002909.png]]\n\n### å®¢æˆ·ç«¯\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012004639.png]]\n\n## ç¼–ç¨‹æ¥å£\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012004717.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012004748.png]]\n\n## æ¡ˆä¾‹\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221012005303.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/PCB":{"title":"PCB","content":"\n# PCB\n\nProcess Control Blockï¼Œè¿›ç¨‹æ§åˆ¶å—ï¼Œè®°å½•äº†è¿›ç¨‹ä½¿ç”¨åˆ°çš„è®¡ç®—æœºèµ„æºçš„æƒ…å†µã€‚\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/PLT%E8%A1%A8":{"title":"PLTè¡¨","content":"# PLTè¡¨\n\n\u003e [æ·±å…¥ç†è§£GOTè¡¨å’ŒPLTè¡¨ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/130271689)\n\nPLTï¼ˆProcedure Linkage Tableï¼‰è¿‡ç¨‹é“¾æ¥è¡¨ï¼Œä½äºä»£ç æ®µï¼Œå†…å®¹ä¸å¯ä¿®æ”¹ã€‚\nPLTè¡¨é€šè¿‡å¼•ç”¨GOTè¡¨ä¸­çš„å‡½æ•°çš„ç»å¯¹åœ°å€ï¼Œæ¥æŠŠæ§åˆ¶è½¬ç§»åˆ°å®é™…çš„å‡½æ•°ã€‚\nåœ¨å®é™…çš„å¯æ‰§è¡Œç¨‹åºæˆ–è€…å…±äº«ç›®æ ‡æ–‡ä»¶ä¸­ï¼ŒPLTè¡¨åœ¨åç§°ä¸º.pltçš„sectionä¸­ã€‚\n\n## ç»“æ„\n\nPLT[0]ï¼šä¿å­˜ä¸€æ®µæ“ä½œï¼Œæ“ä½œå†…å®¹ï¼špushç›®æ ‡å‡½æ•°ç¼–å·ï¼Œè·³è½¬åˆ°GOT[2]\n\n## æ¥æº\n\n\u003e [GOTè¡¨å’ŒPLTè¡¨çŸ¥è¯†è¯¦è§£_77458çš„åšå®¢-CSDNåšå®¢_gotè¡¨](https://blog.csdn.net/qq_18661257/article/details/54694748)\n\nè¿™ä¸ªå‡½æ•°æ˜¯ç¼–è¯‘ç³»ç»Ÿè‡ªå·±åŠ çš„ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡`disas gets`çœ‹çœ‹é‡Œé¢çš„ä»£ç ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220907230615.png]]\n\nè¿™ä¸ªå‡½æ•°åªæœ‰ä¸‰è¡Œä»£ç ï¼Œç¬¬ä¸€è¡Œè·³è½¬ï¼Œç¬¬äºŒè¡Œå‹æ ˆï¼Œç¬¬ä¸‰è¡Œåˆæ˜¯è·³è½¬ï¼Œè§£é‡Šï¼š\nç¬¬ä¸€è¡Œè·³è½¬ï¼Œå®ƒçš„ä½œç”¨æ˜¯é€šè¿‡PLTè¡¨è·³è½¬åˆ°GOTè¡¨ï¼Œè€Œåœ¨ç¬¬ä¸€æ¬¡è¿è¡ŒæŸä¸€ä¸ªå‡½æ•°ä¹‹å‰ï¼Œè¿™ä¸ªå‡½æ•°PLTPLTè¡¨å¯¹åº”çš„GOTè¡¨ä¸­çš„æ•°æ®ä¸º@plt@pltå‡½æ•°ä¸­ç¬¬äºŒè¡ŒæŒ‡ä»¤çš„åœ°å€ï¼Œé’ˆå¯¹å›¾ä¸­æ¥è¯´æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. jmp æŒ‡ä»¤è·³è½¬åˆ° GOT è¡¨\n2. GOT è¡¨ä¸­çš„æ•°æ®ä¸º0x400486\n3. è·³è½¬åˆ°æŒ‡ä»¤åœ°å€ä¸º0x400486\n4. æ‰§è¡Œpush 0x3 (è¿™ä¸ªä¸ºåœ¨GOTGOTä¸­çš„ä¸‹æ ‡åºå·)\n5. å†æ‰§è¡Œjmp 0x400440\n6. è€Œ0x400440ä¸ºPLT[0]çš„åœ°å€\n7. PLT[0]çš„æŒ‡ä»¤ä¼šè¿›å…¥åŠ¨æ€é“¾æ¥å™¨çš„å…¥å£\n8. æ‰§è¡Œä¸€ä¸ªå‡½æ•°å°†çœŸæ­£çš„å‡½æ•°åœ°å€è¦†ç›–åˆ°[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/GOTè¡¨|GOTè¡¨]]ä¸­\n\n## é—®é¢˜\n\n### PLT[0]å¤„åˆ°åº•åšäº†ä»€ä¹ˆï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„æ€è·¯å®ƒä¸æ˜¯åº”è¯¥è·³è½¬åˆ°GOT[0]å—ï¼Ÿ\n\n![[z-oblib/z2-attachments/Pasted image 20220907230947.png]]\n\n\næˆ‘ä»¬å°è¯•ç€æŸ¥çœ‹0x400440åœ°å€çš„æ•°æ®å†…å®¹å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œä»0x400440âˆ’0x400450ä¹‹é—´çš„æ•°æ®å®Œå…¨ä¸çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œè€ŒçœŸæ­£çš„PLT[x]ä¸­çš„æ•°æ®æ˜¯ä»0x400450å¼€å§‹çš„ï¼Œä»è¿™é‡Œæ‰æœ‰äº†@pltä¸ºåç¼€çš„åœ°å€ï¼Œä½†æ˜¯æˆ‘ä»¬disas getsçœ‹ä»£ç çš„æ—¶å€™æ˜¯ä»0x400440å¼€å§‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡x /5i 0x400440æŸ¥çœ‹0x400440å¤„çš„ä»£ç ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220907231232.png]]\n\nåé¢çš„#ä¹‹ååˆä¸€ä¸ª1616è¿›åˆ¶æ•°ï¼Œä¸€çœ‹ä¾¿å¯ä»¥çŸ¥é“æ˜¯GOTè¡¨çš„åœ°å€ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè‚¯å®šå‘¢ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡`objdump -R ./a.out`æŸ¥çœ‹ä¸€ä¸ªç¨‹åºçš„GOTå‡½æ•°çš„åœ°å€ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220907231301.png]]\n\nè¿™é‡Œéƒ½æ˜¯äº›GOTGOTåœ°å€ï¼Œæˆ‘ä»¬å‘ç°éƒ½æ˜¯0x601...0x601...è¿™äº›ï¼Œæ‰€ä»¥å¯ä»¥æ–­å®šå›¾77ä¸­çš„ä¹Ÿæ˜¯GOTGOTåœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çŒœæƒ³å‡ºï¼Œåœ¨æ­£å¼å­˜å‚¨ä¸€ä¸ªå‡½æ•°çš„GOTåœ°å€å‰ï¼Œæˆ‘ä»¬çš„PLTPLTè¡¨å‰é¢æœ‰ä¸€é¡¹è¿›è¡Œä¸€äº›å¤„ç†ï¼Œæˆ‘ä»¬æš‚ä¸”ä¸å…·ä½“æ·±å…¥å‰–æè¿™äº›ä»£ç æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è‚¯å®šputs@pltputs@pltå‰é¢é‚£1616ä¸ªå­—èŠ‚ä¹Ÿç®—æ˜¯PLTPLTè¡¨ä¸­çš„å†…å®¹ï¼Œè¿™å…¶å®å°±æ˜¯æˆ‘ä»¬çš„PLT[0]ï¼Œæ­£å¦‚æˆ‘ä»¬ä¹‹å‰é—®é¢˜æåˆ°çš„é‚£æ ·ï¼Œæˆ‘ä»¬çš„PLT[0]æ ¹æœ¬æ²¡æœ‰è·³è½¬åˆ°GOT[0]ï¼Œå®ƒä¸åƒæˆ‘ä»¬çš„PLT[1]è¿™äº›å­˜å‚¨çš„æ˜¯GOTè¡¨é¡¹çš„åœ°å€ï¼Œå®ƒæ˜¯ä¸€äº›ä»£ç æŒ‡ä»¤ï¼Œæ¢å¥è¯è¯´ï¼ŒPLT[0]æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡GOT[1]å’ŒGOT[2]æ¥æ­£ç¡®ç»‘å®šä¸€ä¸ªå‡½æ•°çš„æ­£å¼åœ°å€åˆ°GOTè¡¨ä¸­æ¥ã€‚\n\næœ¬æ¥æŒ‰ç…§æœ€å¼€å§‹çš„æ€è·¯PLT[1]ä¹Ÿæ˜¯è·³è½¬åˆ°GOT[1]çš„ï¼ŒGOT[2]åŒç†ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ•°æ®å¥½åƒè¢«PLT[0]åˆ©ç”¨äº†ï¼ŒåŒæ—¶GOT[0]å¥½åƒæ¶ˆå¤±äº†ï¼Œè¿™é‡ŒGOT[0]æš‚ä¸”ä¸è¯´å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œé’ˆå¯¹GOT[1]å’ŒGOT[2]è¢«PLT[0]åˆ©ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¨‹åºä¸­çœŸå®æƒ…å†µå…¶å®æ˜¯ä»PLT[1]åˆ°GOT[3],PLT[2]åˆ°GOT[4]ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨ç¿»äº†ä¹‹å‰çš„å›¾ï¼Œå»ºç«‹ä¸€å¼ æ–°çš„å¤„ç†è¡¨ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220907231548.png]]\n\nè€Œplt[0]ä»£ç åšçš„äº‹æƒ…åˆ™æ˜¯ï¼šç”±äºGOT[2]ä¸­å­˜å‚¨çš„æ˜¯åŠ¨æ€é“¾æ¥å™¨çš„å…¥å£åœ°å€ï¼Œæ‰€ä»¥é€šè¿‡GOT[1]ä¸­çš„æ•°æ®ä½œä¸ºGOT[2]å‚æ•°ï¼Œè·³è½¬åˆ°GOT[2]æ‰€å¯¹åº”çš„å‡½æ•°å…¥å£åœ°å€ï¼Œè¿™ä¸ªåŠ¨æ€é“¾æ¥å™¨ä¼šå°†ä¸€ä¸ªå‡½æ•°çš„çœŸæ­£åœ°å€ç»‘å®šåˆ°ç›¸åº”çš„GOT[x]ä¸­ã€‚\n\nè¿™å°±æ˜¯PLTè¡¨å’ŒGOTè¡¨ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡PLTè¡¨è°ƒç”¨ï¼Œä¸€ä¸ªåˆ™æ˜¯é€šè¿‡GOTè¡¨è°ƒç”¨ï¼Œå› ä¸ºPLTè¡¨æœ€ç»ˆä¹Ÿæ˜¯è·³è½¬GOTè¡¨ï¼ŒGOTè¡¨ä¸­åˆ™æ˜¯ä¸€ä¸ªå‡½æ•°çœŸæ­£çš„åœ°å€ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿è¡Œä¸€æ¬¡ä¹‹å‰ï¼ŒGOTè¡¨ä¸­çš„æ•°æ®ä¸º@pltå‡½æ•°ä¸­ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå›¾55æœ‰è¯´ã€‚\n\n### ä¸ºä»€ä¹ˆä¸­é—´è¦è¿›è¡Œpushå‹æ ˆæ“ä½œï¼Ÿ\n\nä¸­é—´è¿›è¡Œçš„å‹æ ˆæ˜¯ä¸ºäº†ç¡®å®šPLTå¯¹åº”çš„GOTè¡¨é¡¹ï¼Œå³æ˜¯PLT[1]âˆ’\u003eGOT[3]ï¼Œ0x3å°±æ˜¯GOTçš„ä¸‹æ ‡3ï¼Œä¹Ÿå°±æ˜¯è¯´å‹æ ˆåæˆ‘ä»¬è·³è½¬åˆ°PLT[0],æ¥ç€PLT[0]ä¸­çš„æŒ‡ä»¤ä¼šé€šè¿‡è¿™æ¬¡å‹æ ˆçš„åºå·æ¥ç¡®å®šæ“ä½œçš„GOTè¡¨é¡¹ä¸ºå¤šå°‘ã€‚\n\n### å‹å…¥çš„åºå·ä¸ºä»€ä¹ˆä¸º0x3ï¼Œä¸æ˜¯æœ€å¼€å§‹åº”è¯¥ä¸º0x0å—ï¼Ÿ\n\nè¿™é‡Œå‹å…¥0x3çš„åŸå› æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬çš„GOT[0],GOT[1],GOT[2]éƒ½æœ‰é¢å¤–ç”¨å¤„ã€‚è¦ä»GOT[3]å¼€å§‹ã€‚","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Unix%E5%9F%9F%E5%A5%97%E6%8E%A5%E5%AD%97":{"title":"UnixåŸŸå¥—æ¥å­—","content":"# UnixåŸŸå¥—æ¥å­—\n\nUnixåŸŸå¥—æ¥å­—æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/å¥—æ¥å­—|å¥—æ¥å­—]]çš„ä¸€ç§ï¼Œ**ç”¨äºæœ¬æœºè¿›ç¨‹é—´é€šä¿¡**ï¼Œä¸€èˆ¬ç”¨æ¥å®ç°**åŒå‘**é€šä¿¡çš„ç®¡é“ã€‚UnixåŸŸå¥—æ¥å­—æ˜¯æ¯”ç½‘ç»œå¥—æ¥å­—**è½»é‡çº§ä¸”é«˜æ•ˆ**çš„å¤šï¼Œå› ä¸ºå®ƒä¸æ¶‰åŠç½‘ç»œé€šä¿¡ï¼Œä¸éœ€è¦ç›‘å¬è¿æ¥ï¼Œä¸éœ€è¦ç»‘å®šåœ°å€ï¼Œä¸éœ€è¦å…³å¿ƒåè®®ç±»å‹ï¼Œç­‰ç­‰ã€‚\n\nåˆ›å»ºUnixåŸŸå¥—æ¥å­—åè¿”å›ä¸¤ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/æ–‡ä»¶æè¿°ç¬¦|æ–‡ä»¶æè¿°ç¬¦]]ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å‡å¯¹å¥—æ¥å­—å¯è¯»ã€å¯å†™ï¼Œä»è€Œå®ç°å…¨åŒå·¥çš„åŒå‘é€šä¿¡ã€‚\n\nåŒæ ·çš„ï¼Œä¸ºäº†é¿å…ä½¿ç”¨å•ä¸ªæ–‡ä»¶æè¿°ç¬¦åŒæ—¶è¯»ã€å†™é€ æˆçš„æ•°æ®é”™ä¹±ï¼ŒUnixåŸŸå¥—æ¥å­—ä¹Ÿæœ‰ä¸¤ä¸ªbufferç©ºé—´ã€‚\n\n\u003e åˆ›å»ºäº†ä¸¤ä¸ªæ–¹å‘ä¸åŒçš„åŠåŒå·¥ç¼“å†²åŒºï¼Œæ‹¼åœ¨ä¸€èµ·ç»„æˆæ‰€è°“å…¨åŒå·¥ã€‚å•ä¸€bufferä¸ä¼šæ¶‰åŠåŒæ—¶çš„å†™å…¥æ“ä½œã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220803133056.png]]","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/VFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F":{"title":"VFSæ–‡ä»¶ç³»ç»Ÿ","content":"\n# VFSæ–‡ä»¶ç³»ç»Ÿ\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221005010403.png]]\n\ntask_stuctå°±æ˜¯è¿›ç¨‹çš„PCBã€‚\nf_entryæ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸€èˆ¬ä¼šå…ˆæŒ‡å‘ä¸€ä¸ªç¼“å†²ï¼Œå›¾ä¸­ä¾¿äºç†è§£ç›´æ¥æŒ‡å‘äº†dentryï¼ˆdirectory entryï¼‰ã€‚\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/_dl_runtime_resolve":{"title":"_dl_runtime_resolve","content":"# _dl_runtime_resolve\n\n1. é¦–å…ˆç”¨`link_map`è®¿é—®`.dynamic`ï¼Œåˆ†åˆ«å–å‡º`.dynstr`ã€`.dynsym`ã€`.rel.plt`çš„åœ°å€\n2. `.rel.plt`+å‚æ•°`relic_index`ï¼Œæ±‚å‡ºå½“å‰å‡½æ•°çš„é‡å®šä½è¡¨é¡¹`Elf32_Rel`çš„æŒ‡é’ˆï¼Œè®°ä½œ`rel`\n3. `rel-\u003er_info` \u003e\u003e `8` ä½œä¸º`.dynsym`çš„ä¸‹æ ‡ï¼Œæ±‚å‡ºå½“å‰å‡½æ•°çš„ç¬¦å·è¡¨é¡¹`Elf32_Sym`çš„æŒ‡é’ˆï¼Œè®°ä½œ`sym`\n4. `.dynstr` + `sym-\u003est_name`å¾—å‡ºç¬¦å·å å­—ç¬¦ä¸²æŒ‡é’ˆ\n5. åœ¨åŠ¨æ€é“¾æ¥åº“æŸ¥æ‰¾è¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼Œå¹¶ä¸”æŠŠåœ°å€èµ‹å€¼ç»™`*rel-\u003er_offset`ï¼Œå³`GOT`è¡¨\n6. æœ€åè°ƒç”¨è¿™ä¸ªå‡½æ•°\n\n![[z-oblib/z2-attachments/Pasted image 20220911014856.png]]\n\n## æ–¹æ³•è¿‡ç¨‹\n\n[6.1.3 pwn XDCTF2015 pwn200 Â· CTF All In One (gitbooks.io)](https://firmianay.gitbooks.io/ctf-all-in-one/content/doc/6.1.3_pwn_xdctf2015_pwn200.html)\n\n```asm\ngdb-peda$ disassemble 0xf7fec370\nDump of assembler code for function _dl_runtime_resolve:\n   0xf7fec370 \u003c+0\u003e:     push   eax\n   0xf7fec371 \u003c+1\u003e:     push   ecx\n   0xf7fec372 \u003c+2\u003e:     push   edx\n   0xf7fec373 \u003c+3\u003e:     mov    edx,DWORD PTR [esp+0x10]\n   0xf7fec377 \u003c+7\u003e:     mov    eax,DWORD PTR [esp+0xc]\n   0xf7fec37b \u003c+11\u003e:    call   0xf7fe6080 \u003c_dl_fixup\u003e\n   0xf7fec380 \u003c+16\u003e:    pop    edx\n   0xf7fec381 \u003c+17\u003e:    mov    ecx,DWORD PTR [esp]\n   0xf7fec384 \u003c+20\u003e:    mov    DWORD PTR [esp],eax\n   0xf7fec387 \u003c+23\u003e:    mov    eax,DWORD PTR [esp+0x4]\n   0xf7fec38b \u003c+27\u003e:    ret    0xc\nEnd of assembler dump.\n```\n\nè¯¥å‡½æ•°åœ¨Â `glibc/sysdeps/i386/dl-trampoline.S`Â ä¸­ç”¨æ±‡ç¼–å®ç°ï¼Œå…ˆä¿å­˜å¯„å­˜å™¨ï¼Œç„¶åå°†ä¸¤ä¸ªå€¼åˆ†åˆ«ä¼ å…¥å¯„å­˜å™¨ï¼Œè°ƒç”¨Â `_dl_fixup`ï¼Œæœ€åæ¢å¤å¯„å­˜å™¨ã€‚\nè¿™é‡Œä¼ é€’çš„å‚æ•°å°±æ˜¯åŠ¨æ€é“¾æ¥æ—¶å‹å…¥çš„ä¸¤ä¸ªå‚æ•°ï¼š\n\n```asm\ngdb-peda$ x/w $esp+0x10\n0xffffd598:     0x00000020\ngdb-peda$ x/w $esp+0xc\n0xffffd594:     0xf7ffd900\n```\n\nä¸€ä¸ªæ˜¯åœ¨Â `\u003cwrite@plt+6\u003e: push 0x20`Â ä¸­å‹å…¥çš„åç§»é‡ï¼Œä¸€ä¸ªæ˜¯ PLT[0] ä¸­Â `push DWORD PTR ds:0x804a004`Â å‹å…¥çš„ GOT[1]ã€‚\n\nå‡½æ•°Â `_dl_fixup(struct link_map *l, ElfW(Word) reloc_arg)`ï¼Œå…¶å‚æ•°åˆ†åˆ«ç”±å¯„å­˜å™¨Â `eax`Â å’ŒÂ `edx`Â æä¾›ã€‚\nå³ä½¿æˆ‘ä»¬ä½¿ç”¨å•æ­¥è¿›å…¥ï¼Œä¹Ÿä¸èƒ½è°ƒè¯•Â `_dl_fixup`ï¼Œå®ƒç›´æ¥å°±æ‰§è¡Œå®Œæˆå¹¶è·³è½¬åˆ° write å‡½æ•°äº†ï¼Œè€Œæ­¤æ—¶ï¼ŒGOT çš„åœ°å€å·²ç»è¢«è¦†ç›–ä¸ºå®é™…åœ°å€ï¼š\n\n```\ngdb-peda$ x/w 0x804a01c\n0x804a01c:      0xf7ea3100\n```\n\nå†å¼ºè°ƒä¸€éï¼šfixup æ˜¯é€šè¿‡å¯„å­˜å™¨å–å‚æ•°çš„ï¼Œè¿™ä¼¼ä¹è¿èƒŒäº† 32 ä½ç¨‹åºçš„è°ƒç”¨çº¦å®šï¼Œä½†å®ƒå°±æ˜¯è¿™æ ·ï¼Œä¸Šé¢ gdb ä¸­æ˜¾ç¤ºçš„å‚æ•°æ˜¯é”™è¯¯çš„ï¼Œè¯¥å‡½æ•°å¯¹ç¨‹åºå‘˜æ¥è¯´æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥ä¼šå°½é‡å°‘ç”¨æ ˆå»åšæ“ä½œã€‚\n\næ—¢ç„¶ä¸èƒ½è°ƒè¯•ï¼Œç›´æ¥çœ‹ä»£ç å§ï¼Œåœ¨Â `glibc/elf/dl-runtime.c`Â ä¸­ï¼š\n\n```c\nDL_FIXUP_VALUE_TYPE\nattribute_hidden __attribute ((noinline)) ARCH_FIXUP_ATTRIBUTE\n_dl_fixup (\n# ifdef ELF_MACHINE_RUNTIME_FIXUP_ARGS\n       ELF_MACHINE_RUNTIME_FIXUP_ARGS,\n# endif\n       struct link_map *l, ElfW(Word) reloc_arg)\n{\n  // åˆ†åˆ«è·å–åŠ¨æ€é“¾æ¥ç¬¦å·è¡¨å’ŒåŠ¨æ€é“¾æ¥å­—ç¬¦ä¸²è¡¨çš„åŸºå€\n  const ElfW(Sym) *const symtab\n    = (const void *) D_PTR (l, l_info[DT_SYMTAB]);\n  const char *strtab = (const void *) D_PTR (l, l_info[DT_STRTAB]);\n\n  // é€šè¿‡å‚æ•° reloc_arg è®¡ç®—é‡å®šä½å…¥å£ï¼Œè¿™é‡Œçš„ DT_JMPREL å³ .rel.pltï¼Œreloc_offset å³ reloc_arg\n  const PLTREL *const reloc\n    = (const void *) (D_PTR (l, l_info[DT_JMPREL]) + reloc_offset);\n\n  // æ ¹æ®å‡½æ•°é‡å®šä½è¡¨ä¸­çš„åŠ¨æ€é“¾æ¥ç¬¦å·è¡¨ç´¢å¼•ï¼Œå³ reloc-\u003er_infoï¼Œè·å–å‡½æ•°åœ¨åŠ¨æ€é“¾æ¥ç¬¦å·è¡¨ä¸­å¯¹åº”çš„æ¡ç›®\n  const ElfW(Sym) *sym = \u0026symtab[ELFW(R_SYM) (reloc-\u003er_info)];\n  const ElfW(Sym) *refsym = sym;\n  void *const rel_addr = (void *)(l-\u003el_addr + reloc-\u003er_offset);\n  lookup_t result;\n  DL_FIXUP_VALUE_TYPE value;\n\n  /* Sanity check that we're really looking at a PLT relocation.  */\n  assert (ELFW(R_TYPE)(reloc-\u003er_info) == ELF_MACHINE_JMP_SLOT);\n\n   /* Look up the target symbol.  If the normal lookup rules are not\n      used don't look in the global scope.  */\n  if (__builtin_expect (ELFW(ST_VISIBILITY) (sym-\u003est_other), 0) == 0)\n    {\n      const struct r_found_version *version = NULL;\n\n      if (l-\u003el_info[VERSYMIDX (DT_VERSYM)] != NULL)\n    {\n      const ElfW(Half) *vernum =\n        (const void *) D_PTR (l, l_info[VERSYMIDX (DT_VERSYM)]);\n      ElfW(Half) ndx = vernum[ELFW(R_SYM) (reloc-\u003er_info)] \u0026 0x7fff;\n      version = \u0026l-\u003el_versions[ndx];\n      if (version-\u003ehash == 0)\n        version = NULL;\n    }\n\n      /* We need to keep the scope around so do some locking.  This is\n     not necessary for objects which cannot be unloaded or when\n     we are not using any threads (yet).  */\n      int flags = DL_LOOKUP_ADD_DEPENDENCY;\n      if (!RTLD_SINGLE_THREAD_P)\n    {\n      THREAD_GSCOPE_SET_FLAG ();\n      flags |= DL_LOOKUP_GSCOPE_LOCK;\n    }\n\n#ifdef RTLD_ENABLE_FOREIGN_CALL\n      RTLD_ENABLE_FOREIGN_CALL;\n#endif\n      // æ ¹æ® strtab+sym-\u003est_name åœ¨å­—ç¬¦ä¸²è¡¨ä¸­æ‰¾åˆ°å‡½æ•°åï¼Œç„¶åè¿›è¡Œç¬¦å·æŸ¥æ‰¾è·å– libc åŸºå€ result\n      result = _dl_lookup_symbol_x (strtab + sym-\u003est_name, l, \u0026sym, l-\u003el_scope,\n                    version, ELF_RTYPE_CLASS_PLT, flags, NULL);\n\n      /* We are done with the global scope.  */\n      if (!RTLD_SINGLE_THREAD_P)\n    THREAD_GSCOPE_RESET_FLAG ();\n\n#ifdef RTLD_FINALIZE_FOREIGN_CALL\n      RTLD_FINALIZE_FOREIGN_CALL;\n#endif\n\n      /* Currently result contains the base load address (or link map)\n     of the object that defines sym.  Now add in the symbol\n   offset.  */\n\n      // å°†è¦è§£æçš„å‡½æ•°çš„åç§»åœ°å€åŠ ä¸Š libc åŸºå€ï¼Œå¾—åˆ°å‡½æ•°çš„å®é™…åœ°å€\n      value = DL_FIXUP_MAKE_VALUE (result,\n                   sym ? (LOOKUP_VALUE_ADDRESS (result)\n                      + sym-\u003est_value) : 0);\n    }\n  else\n    {\n      /* We already found the symbol.  The module (and therefore its load\n     address) is also known.  */\n      value = DL_FIXUP_MAKE_VALUE (l, l-\u003el_addr + sym-\u003est_value);\n      result = l;\n    }\n\n  /* And now perhaps the relocation addend.  */\n  value = elf_machine_plt_value (l, reloc, value);\n\n  // å°†å·²ç»è§£æå®Œæˆçš„å‡½æ•°åœ°å€å†™å…¥ç›¸åº”çš„ GOT è¡¨ä¸­\n  if (sym != NULL\n      \u0026\u0026 __builtin_expect (ELFW(ST_TYPE) (sym-\u003est_info) == STT_GNU_IFUNC, 0))\n    value = elf_ifunc_invoke (DL_FIXUP_VALUE_ADDR (value));\n\n  /* Finally, fix up the plt itself.  */\n  if (__glibc_unlikely (GLRO(dl_bind_not)))\n    return value;\n\n  return elf_machine_fixup_plt (l, result, refsym, sym, reloc, rel_addr, value);\n}\n```","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/bash%E5%86%85%E9%83%A8%E5%91%BD%E4%BB%A4%E5%92%8C%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4":{"title":"bashå†…éƒ¨å‘½ä»¤å’Œå¤–éƒ¨å‘½ä»¤","content":"\n# bashå†…éƒ¨å‘½ä»¤å’Œå¤–éƒ¨å‘½ä»¤\n\nå†…éƒ¨å‘½ä»¤ï¼šå‘½ä»¤çš„ä»£ç å†™åœ¨bashç¨‹åºä¸­ï¼Œå†…éƒ¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™å’Œbashæ˜¯åŒä¸€ä¸ªè¿›ç¨‹ã€‚\nå¤–éƒ¨å‘½ä»¤ï¼šå¤–éƒ¨å‘½ä»¤æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯æ‰§è¡Œç¨‹åºï¼Œåœ¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™å’Œbashä¸æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ã€‚\n\nåœ¨bashä¸Šæ‰§è¡Œä¸€ä¸ªå¤–éƒ¨å‘½ä»¤çš„æ—¶å€™ï¼Œbashé¦–å…ˆè°ƒç”¨fork(2)åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åè°ƒç”¨exec(3)å®¶æ—çš„å‡½æ•°ï¼Œåœ¨å­è¿›ç¨‹çš„ç©ºé—´é‡ŒåŠ è½½å¤–éƒ¨å‘½ä»¤çš„ä»£ç ã€‚bashå†è°ƒç”¨wait(2)ç­‰å¾…å­è¿›ç¨‹çš„ç»“æŸã€‚å­è¿›ç¨‹ç»ˆæ­¢ä»¥åï¼Œå‘çˆ¶è¿›ç¨‹å‘é€SIGCHLDä¿¡å·ï¼Œå¹¶å°†è‡ªå·±çš„é€€å‡ºçŠ¶æ€ç è¿”å›ç»™bashã€‚\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/call":{"title":"call","content":"# call\n\n- `push eip+4`\n- `mov eip, func`","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/cmpxchg":{"title":"cmpxchg","content":"# cmpxchg\n\n\u003ehttps://zhuanlan.zhihu.com/p/34556594\n\n## åº•å±‚å®ç°\n\nlinux_x86çš„å®ç°ï¼š\n\n![[z-oblib/z2-attachments/v2-918101df747ba9d03815cefff3955d74_1440w.jpg]]\n\nwindows_x86çš„å®ç°ï¼š\n\n![[z-oblib/z2-attachments/v2-cd24129a2b8f106ec3179083d3e8cfd1_1440w.jpg]]\n\nmpæ˜¯â€œos::is_MP()â€çš„è¿”å›ç»“æœï¼Œâ€œos::is_MP()â€æ˜¯ä¸€ä¸ªå†…è”å‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­å½“å‰ç³»ç»Ÿæ˜¯å¦ä¸ºå¤šå¤„ç†å™¨ã€‚\n\n1.  å¦‚æœå½“å‰ç³»ç»Ÿæ˜¯å¤šå¤„ç†å™¨ï¼Œè¯¥å‡½æ•°è¿”å›1ã€‚\n2.  å¦åˆ™ï¼Œè¿”å›0ã€‚\n\nLOCK_IF_MP(mp)ä¼šæ ¹æ®mpçš„å€¼æ¥å†³å®šæ˜¯å¦ä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€ã€‚\n\n1.  å¦‚æœé€šè¿‡mpåˆ¤æ–­å½“å‰ç³»ç»Ÿæ˜¯å¤šå¤„ç†å™¨ï¼ˆå³mpå€¼ä¸º1ï¼‰ï¼Œåˆ™ä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€ã€‚\n2.  å¦åˆ™ï¼Œä¸åŠ lockå‰ç¼€ã€‚\n\nè¿™æ˜¯ä¸€ç§ä¼˜åŒ–æ‰‹æ®µï¼Œè®¤ä¸ºå•å¤„ç†å™¨çš„ç¯å¢ƒæ²¡æœ‰å¿…è¦æ·»åŠ lockå‰ç¼€ï¼Œåªæœ‰åœ¨å¤šæ ¸æƒ…å†µä¸‹æ‰ä¼šæ·»åŠ lockå‰ç¼€ï¼Œå› ä¸ºlockä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚cmpxchgæ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼Œä½œç”¨æ˜¯æ¯”è¾ƒå¹¶äº¤æ¢æ“ä½œæ•°ã€‚\n\n  \n\nintelæ‰‹å†Œå¯¹lockå‰ç¼€çš„è¯´æ˜å¦‚ä¸‹ï¼š\n\n1.  ç¡®ä¿å¯¹å†…å­˜çš„è¯»-æ”¹-å†™æ“ä½œåŸå­æ‰§è¡Œã€‚åœ¨PentiumåŠPentiumä¹‹å‰çš„å¤„ç†å™¨ä¸­ï¼Œå¸¦æœ‰lockå‰ç¼€çš„æŒ‡ä»¤åœ¨æ‰§è¡ŒæœŸé—´ä¼š**é”ä½æ€»çº¿**ï¼Œä½¿å¾—å…¶ä»–å¤„ç†å™¨æš‚æ—¶æ— æ³•é€šè¿‡æ€»çº¿è®¿é—®å†…å­˜ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¼šå¸¦æ¥æ˜‚è´µçš„å¼€é”€ã€‚ä»Pentium 4ï¼ŒIntel XeonåŠP6å¤„ç†å™¨å¼€å§‹ï¼Œintelåœ¨åŸæœ‰æ€»çº¿é”çš„åŸºç¡€ä¸Šåšäº†ä¸€ä¸ªå¾ˆæœ‰æ„ä¹‰çš„ä¼˜åŒ–ï¼šå¦‚æœè¦è®¿é—®çš„å†…å­˜åŒºåŸŸï¼ˆarea of memoryï¼‰åœ¨lockå‰ç¼€æŒ‡ä»¤æ‰§è¡ŒæœŸé—´å·²ç»åœ¨å¤„ç†å™¨å†…éƒ¨çš„ç¼“å­˜ä¸­è¢«é”å®šï¼ˆå³åŒ…å«è¯¥å†…å­˜åŒºåŸŸçš„ç¼“å­˜è¡Œå½“å‰å¤„äºç‹¬å æˆ–ä»¥ä¿®æ”¹çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸”è¯¥å†…å­˜åŒºåŸŸè¢«å®Œå…¨åŒ…å«åœ¨å•ä¸ªç¼“å­˜è¡Œï¼ˆcache lineï¼‰ä¸­ï¼Œé‚£ä¹ˆå¤„ç†å™¨å°†ç›´æ¥æ‰§è¡Œè¯¥æŒ‡ä»¤ã€‚ç”±äºåœ¨æŒ‡ä»¤æ‰§è¡ŒæœŸé—´è¯¥ç¼“å­˜è¡Œä¼šä¸€ç›´è¢«é”å®šï¼Œå…¶å®ƒå¤„ç†å™¨æ— æ³•è¯»/å†™è¯¥æŒ‡ä»¤è¦è®¿é—®çš„å†…å­˜åŒºåŸŸï¼Œå› æ­¤èƒ½ä¿è¯æŒ‡ä»¤æ‰§è¡Œçš„åŸå­æ€§ã€‚è¿™ä¸ªæ“ä½œè¿‡ç¨‹å«åš**ç¼“å­˜é”å®š**ï¼ˆcache lockingï¼‰ï¼Œç¼“å­˜é”å®šå°†å¤§å¤§é™ä½lockå‰ç¼€æŒ‡ä»¤çš„æ‰§è¡Œå¼€é”€ï¼Œä½†æ˜¯å½“å¤šå¤„ç†å™¨ä¹‹é—´çš„ç«äº‰ç¨‹åº¦å¾ˆé«˜æˆ–è€…æŒ‡ä»¤è®¿é—®çš„å†…å­˜åœ°å€æœªå¯¹é½æ—¶ï¼Œä»ç„¶ä¼šé”ä½æ€»çº¿ã€‚\n2.  ç¦æ­¢è¯¥æŒ‡ä»¤ä¸ä¹‹å‰å’Œä¹‹åçš„è¯»å’Œå†™æŒ‡ä»¤[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/æŒ‡ä»¤é‡æ’åº|é‡æ’åº]]ã€‚\n3.  æŠŠå†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ã€‚\n\n## åœ¨Javaä¸­\n\nä¸Šé¢çš„ç¬¬1ç‚¹ä¿è¯äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]æ“ä½œæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œç¬¬2ç‚¹å’Œç¬¬3ç‚¹æ‰€å…·æœ‰çš„å†…å­˜å±éšœæ•ˆæœï¼Œä¿è¯äº†CASåŒæ—¶å…·æœ‰[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]]è¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ã€‚","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/epoll":{"title":"epoll","content":"# epoll\n\n## ç‰¹æ€§\n\n### è§¦å‘æ¨¡å¼\n\n#### æ°´å¹³è§¦å‘\n\næ°´å¹³è§¦å‘ä¸ºLevel Triggeredï¼Œç®€ç§°LTã€‚  \næ°´å¹³è§¦å‘å…³å¿ƒçš„æ˜¯ç¼“å†²åŒºçš„çŠ¶æ€ï¼Œå½“ç¼“å†²åŒºå¯è¯»çš„æ—¶å€™ï¼Œå°±ä¼šå‘å‡ºé€šçŸ¥ï¼Œä¹Ÿå°±æ˜¯å½“ç¼“å†²åŒºä¸­åªè¦æœ‰æ•°æ®å°±ä¼šå‘å‡ºé€šçŸ¥ã€‚\n\n#### è¾¹ç¼˜è§¦å‘\n\nè¾¹ç¼˜è§¦å‘ä¸ºEdge Triggeredï¼Œç®€ç§°ETã€‚  \nè¾¹ç¼˜è§¦å‘å…³å¿ƒçš„æ˜¯ç¼“å†²åŒºçŠ¶æ€çš„å˜åŒ–ï¼Œå½“ç¼“å†²åŒºçŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šå‘å‡ºé€šçŸ¥ï¼Œæ¯”å¦‚ç¼“å†²åŒºä¸­æ¥äº†æ–°çš„æ•°æ®ã€‚\n\n#### åŒºåˆ«\n\nè®¾æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œå½“ä¸€æ¬¡read()è¯»å–æ²¡æœ‰è¯»å–å®Œç¼“å†²åŒºä¸­çš„æ•°æ®æ—¶ï¼ŒLTå’ŒETçš„åŒºåˆ«ï¼š  \n1ã€LTï¼Œæ­¤æ—¶ç¼“å†²åŒºä¸­è¿˜æœ‰æ•°æ®ï¼Œä¼šç»§ç»­å‘é€šçŸ¥\n\n2ã€ETï¼Œæ­¤æ—¶ç¼“å†²åŒºçŠ¶æ€å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¹¶æ²¡æœ‰æ¥æ–°çš„æ•°æ®ï¼Œå°±ä¸ä¼šå‘é€šçŸ¥ï¼Œåœ¨æ–°æ•°æ®åˆ°æ¥ä¹‹å‰ï¼Œä¹‹å‰å‰©ä½™çš„æ•°æ®å°±æ— æ³•å–å‡ºã€‚\n\næ‰€ä»¥åœ¨ETæ¨¡å¼ä¸‹ï¼Œå½“è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¸€å®šè¦å¾ªç¯è¯»å–æ•°æ®ï¼Œç›´åˆ°ç¼“å†²åŒºä¸­çš„æ•°æ®**å…¨éƒ¨è¯»å–**å®Œæˆï¼Œä¸€æ¬¡æ€§å°†æ•°æ®å–å‡ºã€‚\n\n\n## åŸç†æµç¨‹\n\n\u003e ç±»ä¼¼java [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ReentrantLock|ReentrantLock]] çš„å®ç°ï¼Œæˆ–è€…åƒ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/monitor|Monitor]]ç®¡ç¨‹çš„è®¾è®¡ã€‚çº¿ç¨‹è®¿é—®èµ„æºå°±åˆ°ç­‰å¾…å®¤ä¸­ç­‰å¾…ï¼›å‡†å¤‡å¥½äº†çš„èµ„æºä¼šæ”¾å…¥çº¢é»‘æ ‘ä¾¿äºæ£€ç´¢ï¼›æœ‰èµ„æºå¥½äº†æ“ä½œç³»ç»Ÿå°±ä¼šå”¤é†’ç­‰å¾…å®¤ä¸­çš„çº¿ç¨‹ã€‚\n\n### 1ã€åˆ›å»ºepollå¯¹è±¡\n\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æŸä¸ªè¿›ç¨‹è°ƒç”¨epoll_createæ–¹æ³•æ—¶ï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ªeventpollå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ç¨‹åºä¸­epfdæ‰€ä»£è¡¨çš„å¯¹è±¡ï¼‰ã€‚eventpollå¯¹è±¡ä¹Ÿæ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€å‘˜ï¼Œå’Œsocketä¸€æ ·ï¼Œå®ƒä¹Ÿä¼šæœ‰ç­‰å¾…é˜Ÿåˆ—ã€‚\n\nå†…æ ¸åˆ›å»ºeventpollå¯¹è±¡ï¼š\n![[z-oblib/z2-attachments/v2-e3467895734a9d97f0af3c7bf875aaeb_720w.jpg]]\n\nåˆ›å»ºä¸€ä¸ªä»£è¡¨è¯¥epollçš„eventpollå¯¹è±¡æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºå†…æ ¸è¦ç»´æŠ¤â€œå°±ç»ªåˆ—è¡¨â€ç­‰æ•°æ®ï¼Œâ€œå°±ç»ªåˆ—è¡¨â€å¯ä»¥ä½œä¸ºeventpollçš„æˆå‘˜ã€‚\n\n### 2ã€ç»´æŠ¤ç›‘è§†åˆ—è¡¨\n\nåˆ›å»ºepollå¯¹è±¡åï¼Œå¯ä»¥ç”¨epoll_ctlæ·»åŠ æˆ–åˆ é™¤æ‰€è¦ç›‘å¬çš„socketã€‚ä»¥æ·»åŠ socketä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾ï¼Œå¦‚æœé€šè¿‡epoll_ctlæ·»åŠ sock1ã€sock2å’Œsock3çš„ç›‘è§†ï¼Œå†…æ ¸ä¼šå°†eventpollæ·»åŠ åˆ°è¿™ä¸‰ä¸ªsocketçš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚\n\næ·»åŠ æ‰€è¦ç›‘å¬çš„socketï¼š\n\n![[z-oblib/z2-attachments/v2-b49bb08a6a1b7159073b71c4d6591185_720w 1.jpg]]\n\nå½“socketæ”¶åˆ°æ•°æ®åï¼Œä¸­æ–­ç¨‹åºä¼šæ“ä½œeventpollå¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œè¿›ç¨‹ã€‚\n\n### 3ã€æ¥æ”¶æ•°æ®\n\nå½“socketæ”¶åˆ°æ•°æ®åï¼Œä¸­æ–­ç¨‹åºä¼šç»™eventpollçš„â€œå°±ç»ªåˆ—è¡¨â€æ·»åŠ socketå¼•ç”¨ã€‚å¦‚ä¸‹å›¾å±•ç¤ºçš„æ˜¯sock2å’Œsock3æ”¶åˆ°æ•°æ®åï¼Œä¸­æ–­ç¨‹åºè®©rdlistå¼•ç”¨è¿™ä¸¤ä¸ªsocketã€‚\n\nç»™å°±ç»ªåˆ—è¡¨æ·»åŠ å¼•ç”¨ï¼š\n![[z-oblib/z2-attachments/v2-18b89b221d5db3b5456ab6a0f6dc5784_720w.jpg]]\n\neventpollå¯¹è±¡ç›¸å½“äºæ˜¯socketå’Œè¿›ç¨‹ä¹‹é—´çš„ä¸­ä»‹ï¼Œsocketçš„æ•°æ®æ¥æ”¶å¹¶**ä¸ç›´æ¥å½±å“è¿›ç¨‹**ï¼Œè€Œæ˜¯é€šè¿‡æ”¹å˜eventpollçš„å°±ç»ªåˆ—è¡¨æ¥æ”¹å˜è¿›ç¨‹çŠ¶æ€ã€‚\n\nå½“ç¨‹åºæ‰§è¡Œåˆ°epoll_waitæ—¶ï¼Œå¦‚æœrdlistå·²ç»å¼•ç”¨äº†socketï¼Œé‚£ä¹ˆepoll_waitç›´æ¥è¿”å›ï¼Œå¦‚æœrdlistä¸ºç©ºï¼Œ**é˜»å¡**è¿›ç¨‹ã€‚\n\n### 4ã€é˜»å¡å’Œå”¤é†’è¿›ç¨‹\n\nå‡è®¾è®¡ç®—æœºä¸­æ­£åœ¨è¿è¡Œè¿›ç¨‹Aå’Œè¿›ç¨‹Bï¼Œåœ¨æŸæ—¶åˆ»è¿›ç¨‹Aè¿è¡Œåˆ°äº†epoll_waitè¯­å¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå†…æ ¸ä¼šå°†è¿›ç¨‹Aæ”¾å…¥eventpollçš„**ç­‰å¾…é˜Ÿåˆ—**ä¸­ï¼Œé˜»å¡è¿›ç¨‹ã€‚\n\nepoll_waité˜»å¡è¿›ç¨‹ï¼š\n![[z-oblib/z2-attachments/v2-90632d0dc3ded7f91379b848ab53974c_720w.jpg]]\n\nå½“socketæ¥æ”¶åˆ°æ•°æ®ï¼Œä¸­æ–­ç¨‹åºä¸€æ–¹é¢ä¿®æ”¹rdlistï¼Œå¦ä¸€æ–¹é¢å”¤é†’eventpollç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ï¼Œè¿›ç¨‹Aå†æ¬¡è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚ä¹Ÿå› ä¸ºrdlistçš„å­˜åœ¨ï¼Œè¿›ç¨‹Aå¯ä»¥**çŸ¥é“å“ªäº›socketå‘ç”Ÿäº†å˜åŒ–**ã€‚\n\nepollå”¤é†’è¿›ç¨‹ï¼š\n![[z-oblib/z2-attachments/v2-40bd5825e27cf49b7fd9a59dfcbe4d6f_720w.jpg]]\n\n## å®ç°ç»†èŠ‚\n\neventpollçš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ\nå°±ç»ªé˜Ÿåˆ—åº”è¯¥åº”ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ï¼Ÿ\neventpollåº”ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„æ¥ç®¡ç†é€šè¿‡epoll_ctlæ·»åŠ æˆ–åˆ é™¤çš„socketï¼Ÿ\n\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒeventpollåŒ…å«äº†lockã€mtxã€wqï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰ã€rdlistç­‰æˆå‘˜ã€‚rdlistå’Œrbræ˜¯æˆ‘ä»¬æ‰€å…³å¿ƒçš„ã€‚\n\nepollåŸç†ç¤ºæ„å›¾ï¼š\n![[z-oblib/z2-attachments/v2-e63254878f67751dcc07a25b93f974bb_720w.jpg]]\nå›¾ç‰‡æ¥æºï¼šã€Šæ·±å…¥ç†è§£Nginxï¼šæ¨¡å—å¼€å‘ä¸æ¶æ„è§£æ(ç¬¬äºŒç‰ˆ)ã€‹ï¼Œé™¶è¾‰\n\n### å°±ç»ªåˆ—è¡¨çš„æ•°æ®ç»“æ„\n\n\u003e å°±ç»ªé˜Ÿåˆ— --\u003e åŒå‘é“¾è¡¨\n\nå°±ç»ªåˆ—è¡¨å¼•ç”¨ç€å°±ç»ªçš„socketï¼Œæ‰€ä»¥å®ƒåº”èƒ½å¤Ÿå¿«é€Ÿçš„**æ’å…¥**æ•°æ®ã€‚\n\nç¨‹åºå¯èƒ½éšæ—¶è°ƒç”¨epoll_ctlæ·»åŠ ç›‘è§†socketï¼Œä¹Ÿå¯èƒ½éšæ—¶åˆ é™¤ã€‚å½“åˆ é™¤æ—¶ï¼Œè‹¥è¯¥socketå·²ç»å­˜æ”¾åœ¨å°±ç»ªåˆ—è¡¨ä¸­ï¼Œå®ƒä¹Ÿåº”è¯¥è¢«ç§»é™¤ã€‚\n\næ‰€ä»¥å°±ç»ªåˆ—è¡¨åº”æ˜¯ä¸€ç§èƒ½å¤Ÿå¿«é€Ÿæ’å…¥å’Œåˆ é™¤çš„æ•°æ®ç»“æ„ã€‚åŒå‘é“¾è¡¨å°±æ˜¯è¿™æ ·ä¸€ç§æ•°æ®ç»“æ„ï¼Œepollä½¿ç”¨**åŒå‘é“¾è¡¨**æ¥å®ç°å°±ç»ªé˜Ÿåˆ—ï¼ˆå¯¹åº”ä¸Šå›¾çš„rdllistï¼‰ã€‚\n\n### ç´¢å¼•ç»“æ„\n\n\u003e ç´¢å¼•ç»“æ„ --\u003e çº¢é»‘æ ‘\n\næ—¢ç„¶epollå°†â€œç»´æŠ¤ç›‘è§†é˜Ÿåˆ—â€å’Œâ€œè¿›ç¨‹é˜»å¡â€åˆ†ç¦»ï¼Œä¹Ÿæ„å‘³ç€éœ€è¦æœ‰ä¸ªæ•°æ®ç»“æ„æ¥ä¿å­˜ç›‘è§†çš„socketã€‚è‡³å°‘è¦æ–¹ä¾¿çš„æ·»åŠ å’Œç§»é™¤ï¼Œè¿˜è¦**ä¾¿äºæœç´¢**ï¼Œä»¥é¿å…é‡å¤æ·»åŠ ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæœç´¢ã€æ’å…¥å’Œåˆ é™¤æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(log(N))ï¼Œæ•ˆç‡è¾ƒå¥½ã€‚epollä½¿ç”¨äº†çº¢é»‘æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼ˆå¯¹åº”ä¸Šå›¾çš„rbrï¼‰ã€‚\n\n\u003e psï¼šå› ä¸ºæ“ä½œç³»ç»Ÿè¦å…¼é¡¾å¤šç§åŠŸèƒ½ï¼Œä»¥åŠç”±æ›´å¤šéœ€è¦ä¿å­˜çš„æ•°æ®ï¼Œrdlistå¹¶éç›´æ¥å¼•ç”¨socketï¼Œè€Œæ˜¯é€šè¿‡epitemé—´æ¥å¼•ç”¨ï¼Œçº¢é»‘æ ‘çš„èŠ‚ç‚¹ä¹Ÿæ˜¯epitemå¯¹è±¡ã€‚åŒæ ·ï¼Œæ–‡ä»¶ç³»ç»Ÿä¹Ÿå¹¶éç›´æ¥å¼•ç”¨ç€socketã€‚ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæœ¬æ–‡ä¸­çœç•¥äº†ä¸€äº›é—´æ¥ç»“æ„ã€‚\n\n## ç»“è®º\n\nepollåœ¨selectå’Œpollï¼ˆpollå’ŒselectåŸºæœ¬ä¸€æ ·ï¼Œæœ‰å°‘é‡æ”¹è¿›ï¼‰çš„åŸºç¡€å¼•å…¥äº†eventpollä½œä¸ºä¸­é—´å±‚ï¼Œä½¿ç”¨äº†å…ˆè¿›çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚\n\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/gcc%E7%BC%96%E8%AF%91%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93":{"title":"gccç¼–è¯‘åŠ¨æ€é“¾æ¥åº“","content":"\n# gccç¼–è¯‘åŠ¨æ€é“¾æ¥åº“\n\n`gcc -shared -fPIC xxx.c -o libxxx.so`\n\n- -sharedå‘Šè¯‰gccæˆ‘æ­£åœ¨ç¼–è¯‘ä¸€ä¸ªdllè€Œä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸è¦å»æ‰¾mainå‡½æ•°ç­‰ç”Ÿæˆå…¥å£ç‚¹ã€‚\n- -fPIC è¡¨ç¤ºç”Ÿæˆåœ°å€æ— å…³ä»£ç ï¼Œå®é™…ä¸Šæ˜¯\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/leave":{"title":"leave","content":"# leave\n\n- `mov esp, ebp` æ¸…ç©ºå½“å‰å‡½æ•°æ ˆä»¥è¿˜åŸæ ˆç©ºé—´ï¼ˆç›´æ¥ç§»åŠ¨æ ˆé¡¶æŒ‡é’ˆÂ **esp**Â åˆ°å½“å‰å‡½æ•°çš„æ ˆåº•Â **ebp**Â ï¼‰ï¼›\n- `pop ebp` è¿˜åŸæ ˆåº•ï¼ˆå°†æ­¤æ—¶Â **esp**Â æ‰€æŒ‡çš„ä¸Šå±‚å‡½æ•°æ ˆåº• old ebp å¼¹å…¥Â **ebp**Â å¯„å­˜å™¨å†…ï¼‰ï¼›","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/mutex%E9%94%81":{"title":"mutexé”","content":"\n# mutexé”\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221018173135.png]]\n\n## ç¼–ç¨‹æ¥å£\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221018173154.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221018173201.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221018173230.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/ret":{"title":"ret","content":"# ret\n\n- `pop eip` è¿˜åŸæ‰§è¡Œæµï¼ˆå°†æ­¤æ—¶Â **esp**Â æ‰€æŒ‡çš„ä¸Šå±‚å‡½æ•°è°ƒç”¨fooæ—¶çš„åœ°å€å¼¹å…¥Â **eip**Â å¯„å­˜å™¨å†…ï¼‰ï¼›","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/system_v_ipc":{"title":"system_v_ipc","content":"\n# system_v_ipc\n\né€šè¿‡å†…æ ¸ä¸­çš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/å…±äº«å†…å­˜|å…±äº«å†…å­˜]]å®Œæˆè¿›ç¨‹é—´é€šè®¯ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/z-attachments/Pasted image 20221006013354.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/z-attachments/Pasted image 20221006013446.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/z-attachments/Pasted image 20221006013548.png]]\n\n## è·å–é”®å€¼\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/z-attachments/Pasted image 20221006013755.png]]\n\nproj_idé‡‡ç”¨8ä½æœ€ä½æœ‰æ•ˆã€‚257=1\n\n## å…·ä½“é€šè®¯æ–¹å¼\n\n- [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/å…±äº«å†…å­˜|å…±äº«å†…å­˜]]\n- \n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/unistd_lseek":{"title":"unistd_lseek","content":"\n# unistd_lseek\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221003234354.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/unistd_read":{"title":"unistd_read","content":"\n# unistd_read\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221003234253.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/unistd_write":{"title":"unistd_write","content":"\n# unistd_write\n\n![[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/z-attachments/Pasted image 20221003234323.png]]\n","lastmodified":"2023-01-23T15:37:51.554678744Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E5%8D%95%E5%85%83":{"title":"åè®®æ•°æ®å•å…ƒ","content":"\n# åè®®æ•°æ®å•å…ƒ\n\nActually, there are five words commonly used when we talk about layers of reference models (or protocol stacks):Â `data`,Â `segment`,Â `packet`,Â `frame`Â andÂ `bit`. And the term PDU (`Protocol Data Unit`) is a generic term used to refer to the packets in different layers of the OSI model. Thus PDU gives an abstract idea of the data packets. The PDU has a different meaning in different layers still we can use it as a common term.\n\nWhen we come to your question, we can call all of them by using the general termÂ `PDU`, but if you want to call them specifically at a given layer:\n\n- **Data:**Â PDU of Application, Presentation and Session Layers\n- **Segment:**Â PDU of Transport Layer\n- **Packet:**Â PDU of network Layer\n- **Frame:**Â PDU of data-link Layer\n- **Bit:**Â PDU of physical Layer\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2-%E4%BC%A0%E8%BE%93%E5%B1%82/tcp/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B":{"title":"ä¸‰æ¬¡æ¡æ‰‹","content":"\n# ä¸‰æ¬¡æ¡æ‰‹\n\nå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯éƒ½è¦ç¡®è®¤ä¸¤ä»¶äº‹ï¼š\n1. æˆ‘å‘å‡ºå»çš„åŒ…å¯¹é¢èƒ½ä¸èƒ½æ”¶åˆ°\n2. å¯¹é¢å‘ç»™æˆ‘çš„åŒ…æˆ‘èƒ½ä¸èƒ½æ”¶åˆ°\n\n\u003e è¿™ä¹Ÿæ˜¯å› ä¸ºç½‘ç»œæ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥å¯ä»¥æƒ³æˆæœ‰ä¸¤æ¡é“ï¼ŒåŒæ–¹éƒ½è¦ç¡®è®¤è¿™ä¸¤æ¡é“è·¯é€šç•…ã€‚\n\n1. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªæ§åˆ¶ä½ACK=0ï¼ŒSYN=1çš„æ•°æ®åŒ…è¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ï¼Œå‘é€åå®¢æˆ·ç«¯è¿›å…¥SYN-SENTçŠ¶æ€ã€‚\n\t1. æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è™½ç„¶å‘å‡ºäº†æ•°æ®ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“ä»»ä½•å¯ç”¨çš„ä¿¡æ¯ã€‚\n2. æœåŠ¡ç«¯æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œåˆ†é…ç¼“å­˜ç©ºé—´ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªACK=1ï¼ŒSYN=1çš„æ•°æ®åŒ…ï¼Œç¡®è®¤å·ackä¸ºå®¢æˆ·ç«¯æ•°æ®åŒ…åºåˆ—å·åŠ ä¸€ï¼ŒæœåŠ¡ç«¯è¿›å…¥SYN-RCVDçŠ¶æ€ã€‚\n\t1. æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„åŒ…åçŸ¥é“äº†ï¼š**å®¢æˆ·ç«¯å‘ç»™æˆ‘çš„åŒ…ï¼Œæˆ‘èƒ½æ”¶åˆ°**ã€‚\n\t2. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”åçŸ¥é“ï¼š**æœåŠ¡ç«¯å‘ç»™æˆ‘çš„åŒ…ï¼Œæˆ‘èƒ½æ”¶åˆ°**ã€‚\n\t3. æ ¹æ®åŒ…çš„ackå’Œsynå­—æ®µå®¢æˆ·ç«¯è¿˜èƒ½çŸ¥é“ï¼š**æˆ‘å‘ç»™æœåŠ¡ç«¯çš„åŒ…ï¼ŒæœåŠ¡ç«¯èƒ½æ”¶åˆ°**ã€‚\n\u003e è¿™ä¸€æ­¥å®¢æˆ·ç«¯ä¸€æ–¹æƒ³è¦çš„ä¿¡æ¯éƒ½é½äº†ï¼Œä½†æœåŠ¡ç«¯è¿˜å·®ä¸€ç‚¹ã€‚\n3. å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ACK=1çš„æ•°æ®åŒ…ï¼Œè¿›å…¥EstablishçŠ¶æ€ï¼Œä¼ è¾“è¿æ¥æ­£å¼å»ºç«‹ã€‚\n\t1. æœåŠ¡ç«¯æ”¶åˆ°æœ€ç»ˆä¸€æ­¥çš„åŒ…åçŸ¥é“ï¼š**æˆ‘å‘ç»™å®¢æˆ·ç«¯çš„åŒ…ï¼Œå®¢æˆ·ç«¯èƒ½æ”¶åˆ°**ã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2-%E4%BC%A0%E8%BE%93%E5%B1%82/tcp/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B":{"title":"å››æ¬¡æŒ¥æ‰‹","content":"\n# å››æ¬¡æŒ¥æ‰‹\n\n1. **æˆ‘è¦èµ°äº†**ï¼šå®¢æˆ·ç«¯å®Œæˆæ‰€æœ‰æ•°æ®ä¼ è¾“ï¼Œå‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªFIN=1çš„ç»ˆæ­¢è¿æ¥æŠ¥æ–‡ï¼Œå¹¶è®¾ç½®åºåˆ—å·ä¸ºä¼ è¾“æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚åºå·ï¼Œå‘é€åå®¢æˆ·ç«¯è¿›å…¥FIN-Waitä¸€é˜¶æ®µã€‚\n2. **çŸ¥é“äº†ï¼Œæœ€åä¸€ç‚¹ä¸œè¥¿ç»™ä½ æ‰“åŒ…å¸¦ä¸Šï¼Œç¨ç­‰**ï¼šæœåŠ¡ç«¯æ¥æ”¶åˆ°ç»ˆæ­¢è¿æ¥æŠ¥æ–‡ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªACKç¡®è®¤æŠ¥æ–‡ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥FIN-WaitäºŒé˜¶æ®µï¼Œå®¢æˆ·ç«¯æ— æ³•å†è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œç„¶è€ŒæœåŠ¡ç«¯å¯èƒ½è¿˜å­˜åœ¨æ²¡æœ‰å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œå› æ­¤ä¸èƒ½ç«‹åˆ»å…³é—­è¿æ¥ã€‚\n3. **æ‰€æœ‰ä¸œè¥¿éƒ½åœ¨è¿™é‡Œäº†ï¼Œæ‹¿å¥½**ï¼šæœåŠ¡ç«¯åœ¨å‘é€å®Œæ‰€æœ‰æ•°æ®åï¼Œå†å‘é€ä¸€ä¸ªACK=1ï¼ŒFIN=1çš„ç»ˆæ­¢ç¡®è®¤ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶æœåŠ¡ç«¯è¿›å…¥LAST-ACKçŠ¶æ€ã€‚\n4. **å¥½çš„ï¼Œä½ å¿™å§2MSLä¸æ‰¾æˆ‘ï¼Œæˆ‘å°±è‡ªå·±èµ°äº†**ï¼šå®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œè¿”å›ç»™æœåŠ¡ç«¯ä¸€ä¸ªACK=1çš„å“åº”ï¼Œå¹¶è¿›å…¥TIME-WAITçŠ¶æ€ï¼Œç­‰å¾…æ—¶é—´ä¸º2MSLï¼Œå³ä¸¤å€çš„æœ€å¤§æ•°æ®æ®µä¼ è¾“æ—¶é—´ã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3-%E5%BA%94%E7%94%A8%E5%B1%82/dhcp":{"title":"dhcp","content":"\n# dhcp\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3-%E5%BA%94%E7%94%A8%E5%B1%82/mqtt%E7%AE%80%E4%BB%8B":{"title":"mqttç®€ä»‹","content":"\n# mqttç®€ä»‹\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP%E6%95%B0%E6%8D%AE%E5%8C%85%E7%BB%93%E6%9E%84":{"title":"IPæ•°æ®åŒ…ç»“æ„","content":"\n# IPæ•°æ®åŒ…ç»“æ„\n\n![[3-è®¡ç®—æœºç§‘å­¦/4-è®¡ç®—æœºç½‘ç»œ/z-attachments/Pasted image 20221116105529.png]]\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/flow":{"title":"flow","content":"\n# flow\n\nflowæ˜¯æŒ‡`äº”å…ƒç»„`\u003cåè®®ç±»å‹ã€æºIPåœ°å€ã€ç›®çš„IPåœ°å€ã€æºç«¯å£å·ã€ç›®çš„ç«¯å£å·\u003eç›¸åŒçš„æ•°æ®åŒ…ã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/5-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/%E7%B4%A2%E5%BC%95":{"title":"ç´¢å¼•","content":"# ç´¢å¼•\n\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/5-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2":{"title":"è”åˆæŸ¥è¯¢","content":"# è”åˆæŸ¥è¯¢\n\n\u003e è”åˆç´¢å¼•å°±æ˜¯å¤åˆç´¢å¼•ã€ç»„åˆç´¢å¼•ã€å¤šåˆ—ç´¢å¼•ã€‚\n\nè”åˆæŸ¥è¯¢æ˜¯åœ¨[[3-è®¡ç®—æœºç§‘å­¦/5-æ•°æ®åº“ç³»ç»Ÿ/ç´¢å¼•|ç´¢å¼•]]çš„åŸºç¡€ä¸Šï¼Œä¸€ä¸ªèŠ‚ç‚¹å‹ç¼©æ”¾å…¥å¤šä¸ªåˆ—ã€‚ç±»ä¼¼ä¸€ä¸ªå¤šæ¡ä»¶è”åˆçš„ifè¯­å¥\n\n![[z-oblib/z2-attachments/3f7c0b118d08445d9a66131124ec2276.png]]\n\n```java\nif (name==Bill \u0026\u0026 age==30 \u0026\u0026 role==dev)\n```\n\n**é‡å¤å€¼è¶Šå°‘çš„è¶Šæ”¾å‰é¢**ï¼Œæ¯”å¦‚ä¸€ä¸ªåˆ— 95%çš„å€¼éƒ½ä¸é‡å¤ï¼Œé‚£ä¹ˆä¸€èˆ¬å¯ä»¥å°†è¿™ä¸ªåˆ—æ”¾æœ€å‰é¢ã€‚å¦å¤–ï¼Œ**å¤åˆç´¢å¼•çš„å­—æ®µæ•°å°½é‡ä¸è¦è¶…è¿‡ 3ä¸ª**ï¼Œä¸€æ—¦è¶…è¿‡ï¼Œè¦æ…é‡è€ƒè™‘å¿…è¦æ€§ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/%E9%9D%9E%E8%8E%B7%E5%8F%96%E5%8C%B9%E9%85%8D":{"title":"éè·å–åŒ¹é…","content":"\n# éè·å–åŒ¹é…\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/æ­£åˆ™è¡¨è¾¾å¼/z-attachments/Pasted image 20221118003943.png]]\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/%E6%B1%87%E7%BC%96/arm/ARM%E7%9A%8437%E4%B8%AA%E5%AF%84%E5%AD%98%E5%99%A8%E5%92%8C%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6":{"title":"ARMçš„37ä¸ªå¯„å­˜å™¨å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶","content":"\n# ARMçš„37ä¸ªå¯„å­˜å™¨å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶\n\n## å‚è€ƒ\n\n[(1æ¡æ¶ˆæ¯) ARMçš„37ä¸ªå¯„å­˜å™¨å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶è¯¦è§£_æ­£åœ¨èµ·é£çš„èœ—ç‰›çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/weixin_42031299/article/details/114737622)\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/%E6%B1%87%E7%BC%96/arm/CPSR":{"title":"CPSR","content":"\n# CPSR\n\nCPSR(current program status register)å¯„å­˜å™¨ï¼Œ**32ä½**çŠ¶æ€å¯„å­˜å™¨ã€‚\n\nCPSRå¯„å­˜å™¨æ˜¯æŒ‰ä½èµ·ä½œç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒçš„æ¯ä¸€ä½éƒ½æœ‰ä¸“é—¨çš„å«ä¹‰ï¼Œè®°å½•ç‰¹å®šçš„ä¿¡æ¯ã€‚\n\n## å„ä½å«ä¹‰\n\n- CPSRçš„ä½8ä½ï¼ˆåŒ…æ‹¬Iã€Fã€Tå’ŒM[4ï¼š0]ï¼‰ç§°ä¸ºæ§åˆ¶ä½ï¼Œç¨‹åºæ— æ³•ä¿®æ”¹,é™¤éCPUè¿è¡Œäºç‰¹æƒæ¨¡å¼ä¸‹,ç¨‹åºæ‰èƒ½ä¿®æ”¹æ§åˆ¶ä½ã€‚\n- Nã€Zã€Cã€Vå‡ä¸ºæ¡ä»¶ç æ ‡å¿—ä½ã€‚å®ƒä»¬çš„å†…å®¹å¯è¢«ç®—æœ¯æˆ–é€»è¾‘è¿ç®—çš„ç»“æœæ‰€æ”¹å˜ï¼Œå¹¶ä¸”å¯ä»¥å†³å®šæŸæ¡æŒ‡ä»¤æ˜¯å¦è¢«æ‰§è¡Œã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/æ±‡ç¼–/arm/z-attachments/Pasted image 20220923161543.png]]\n\n### æ¡ä»¶ç \n\n| æ ‡å¿—ä½ | å«Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ä¹‰                                                                                                                                                  |\n|-----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| N   | å½“ç”¨ä¸¤ä¸ªè¡¥ç è¡¨ç¤ºçš„å¸¦ç¬¦å·æ•°è¿›è¡Œè¿ç®—æ—¶ï¼ŒN=1è¡¨ç¤ºè¿ç®—çš„ç»“æœä¸ºè´Ÿæ•°ï¼›N=0è¡¨ç¤ºè¿ç®—çš„ç»“æœä¸ºæ­£æ•°æˆ–é›¶                                                                                                                                    |\n| Z   | Z=1è¡¨ç¤ºè¿ç®—çš„ç»“æœä¸ºé›¶ï¼ŒZ=0è¡¨ç¤ºè¿ç®—çš„ç»“æœéé›¶ã€‚                                                                                                                                                          |\n| C   | å¯ä»¥æœ‰4ç§æ–¹æ³•è®¾ç½®Cçš„å€¼ï¼š\u003cbr/\u003eåŠ æ³•è¿ç®—ï¼ˆåŒ…æ‹¬CMPï¼‰ï¼šå½“è¿ç®—ç»“æœäº§ç”Ÿäº†è¿›ä½æ—¶ï¼ˆæ— ç¬¦å·æ•°æº¢å‡ºï¼‰ï¼ŒC=1ï¼Œå¦åˆ™C=0ã€‚\u003cbr/\u003eå‡æ³•è¿ç®—ï¼ˆåŒ…æ‹¬CMPï¼‰ï¼šå½“è¿ç®—æ—¶äº§ç”Ÿäº†å€Ÿä½æ—¶ï¼ˆæ— ç¬¦å·æ•°æº¢å‡ºï¼‰ï¼ŒC=0ï¼Œå¦åˆ™C=1ã€‚\u003cbr/\u003eå¯¹äºåŒ…å«ç§»ä½æ“ä½œçš„éåŠ /å‡è¿ç®—æŒ‡ä»¤ï¼ŒCä¸ºç§»å‡ºå€¼çš„æœ€åä¸€ä½ã€‚\u003cbr/\u003eå¯¹äºå…¶å®ƒçš„éåŠ /å‡è¿ç®—æŒ‡ä»¤ï¼ŒCçš„å€¼é€šå¸¸ä¸ä¼šæ”¹å˜ã€‚\u003cbr/\u003e\u003cbr/\u003e |\n| V   | å¯ä»¥æœ‰2ç§æ–¹æ³•è®¾ç½®Vçš„å€¼ï¼š\u003cbr/\u003eå¯¹äºåŠ å‡æ³•è¿ç®—æŒ‡ä»¤ï¼Œå½“æ“ä½œæ•°å’Œè¿ç®—ç»“æœä¸ºäºŒè¿›åˆ¶çš„è¡¥ç è¡¨ç¤ºçš„å¸¦ç¬¦å·æ•°æ—¶ï¼ŒV=1è¡¨ç¤ºç¬¦å·ä½æº¢å‡º\u003cbr/\u003eå¯¹äºå…¶å®ƒçš„éåŠ /å‡è¿ç®—æŒ‡ä»¤ï¼ŒVçš„å€¼é€šå¸¸ä¸ä¼šæ”¹å˜ã€‚\u003cbr/\u003e                                                                                   |\n| Q   | åœ¨ARM V5åŠä»¥ä¸Šç‰ˆæœ¬çš„Eç³»åˆ—å¤„ç†å™¨ä¸­ï¼Œç”¨Qæ ‡å¿—ä½æŒ‡ç¤ºå¢å¼ºçš„DSPè¿ç®—æŒ‡ä»¤æ˜¯å¦å‘ç”Ÿäº†æº¢å‡ºã€‚åœ¨å…¶å®ƒç‰ˆæœ¬çš„å¤„ç†å™¨ä¸­ï¼ŒQæ ‡å¿—ä½æ— å®šä¹‰                                                                                                                    |\n\n### æ§åˆ¶ä½\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/%E6%B1%87%E7%BC%96/arm/FIQ":{"title":"FIQ","content":"\n# FIQ\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/%E6%B1%87%E7%BC%96/arm/MSR":{"title":"MSR","content":"\n# MSR\n\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/%E6%B1%87%E7%BC%96/x86%E6%B1%87%E7%BC%96%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8":{"title":"x86æ±‡ç¼–å¿«é€Ÿå…¥é—¨","content":"\n# x86æ±‡ç¼–å¿«é€Ÿå…¥é—¨\n\n## å¯„å­˜å™¨\n\n### CS : IP\n\n- ç‰©ç†åœ°å€ = æ®µåœ°å€ X 10H + åç§»åœ°å€\n    - ç‰©ç†åœ°å€: 200H(æ®µåœ°å€) X 10H + 1F60H(åç§»åœ°å€) = 21F60H\n- åŒä¸€ä¸ªç‰©ç†åœ°å€å¯ä»¥ç”±ä¸åŒçš„æ®µåœ°å€å’Œåç§»åœ°å€æ„æˆ\n\n#### æ®µå¯„å­˜å™¨\n\n- CS: ä»£ç æ®µå¯„å­˜å™¨ (Code Segment)\n    - ä¸»è¦å…³æ³¨æ­¤å¯„å­˜å™¨\n- DS: æ•°æ®æ®µå¯„å­˜å™¨ (Data Segment)\n- SS: æ ˆæ®µå¯„å­˜å™¨ (Stach Segment)\n- ES: é™„åŠ æ®µå¯„å­˜å™¨ (Extra Segment)\n\n#### ç¨‹åºæ‰§è¡Œ\n\nä»»æ„æ—¶åˆ», CPU å°† CS:IP æŒ‡å‘çš„å†…å®¹ä½œä¸ºå³å°†æ‰§è¡Œçš„æŒ‡ä»¤:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/æ±‡ç¼–/z-attachments/Pasted image 20220917151311.png]]\n\n#### ä¿®æ”¹ CS:IP æ§åˆ¶æµç¨‹\n\n1. ä¿®æ”¹ CS å’Œ IP\n    1. `jmp æ®µåœ°å€:åç§»åœ°å€`\n        - `jmp  2AE3:3` -\u003e ä» 2AE33H å¤„è¯»å–æŒ‡ä»¤\n        - `jmp  3:0B16` -\u003e ä» 00B46H å¤„è¯»å–æŒ‡ä»¤\n1. åªä¿®æ”¹ IP\n    1. `jmp æŸåˆæ³•å¯„å­˜å™¨`\n        - `jmp  bx`\n            - æ‰§è¡Œå‰: bx = 0B16H, CS = 2000H, IP = 0003H\n            - æ‰§è¡Œå: BX = 0B16H, CS = 2000H, IP = 0B16H\n        - `jmp  bx` ç±»ä¼¼ `mov   IP, bx` (æŠŠå¯„å­˜å™¨çš„å€¼å½“ä½œ IP)\n\n## Winodws ä¸‹çš„æ±‡ç¼–å·¥å…·\n\n### å‡†å¤‡\n\n- DOSBox ç¯å¢ƒæ¨¡æ‹Ÿå™¨\n- debug.exe\n    - win7 åŠä»¥ä¸Šç³»ç»Ÿä¸è‡ªå¸¦\n\n### ç¯å¢ƒé…ç½®\n\n1. å®‰è£… DOSBox0.74-win32-installer.exe\n1. è‡ªåŠ¨é…ç½® DOSBox æ“ä½œç›®å½•\n    1. è¿è¡Œå®‰è£…ç›®å½•ä¸­çš„ `DOSBox 0.74 Options.bat`\n    1. å¼¹å‡ºçš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹:\n\t\n\t```\n\tMOUNT C E:\\masmpro         # å°†åé¢çš„ç›®å½•æŒ‚è½½åˆ°dosçš„cç›˜ç¬¦ä¸‹\n\tset PATH=$PATH$;E:\\masmpro # $PATH$ä»£è¡¨å·²æœ‰ç¯å¢ƒå˜é‡, åé¢æ˜¯å½“å‰ç›®å½•\n\tç›®å½•ä¸èƒ½å¸¦ä¸­æ–‡å’Œç©ºæ ¼.\n\t```\n\t\n\n1. æ‰‹åŠ¨é…ç½® DOSBox æ“ä½œç›®å½•\n    1. å¯åŠ¨ dosbox\n    1. æ‰‹åŠ¨è¾“å…¥ `MOUNT C E:\\masmpro`\n2. é…ç½® masmpro\n    1. å°† debug.exe ç­‰è½¯ä»¶æ‹·è´åˆ°ç›®å½•ä¸‹\n\n### debug å·¥å…·\n\n- debug æ˜¯ Dos, Windows æä¾›çš„å®æ¨¡å¼ (8086æ–¹å¼) ç¨‹åºçš„è°ƒè¯•å·¥å…·\n- debug åŠŸèƒ½\n    - æŸ¥çœ‹ CPU å„ä¸ªå¯„å­˜å™¨å†…å®¹\n    - æŸ¥çœ‹å†…å­˜æƒ…å†µ\n    - åœ¨æœºå™¨ç çº§åˆ«è·Ÿè¸ªç¨‹åºçš„è¿è¡Œ\n- å¸¸ç”¨æ“ä½œ\n    - `R` æŸ¥çœ‹æ›´æ”¹ cpu å¯„å­˜å™¨å†…å®¹\n        1. `R AX`\n        1. å‡ºç° `:` åè¾“å…¥è¦å†™å…¥çš„æ•°æ®\n        1. å›è½¦\n        1. å†æŒ‰ `R` æŸ¥çœ‹ä¿®æ”¹æƒ…å†µ\n    - `D` æŸ¥çœ‹å†…å­˜å†…å®¹\n        - `D æ®µåœ°å€:åç§»åœ°å€`\n    - `E` æ”¹å†™å†…å­˜å†…å®¹\n    - `U` å°†å†…å­˜ä¸­æœºå™¨æŒ‡ä»¤ç¿»è¯‘ä¸ºæ±‡ç¼–æŒ‡ä»¤\n    - `T` æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤\n    - `A` ä»¥æ±‡ç¼–æ ¼å¼åœ¨å†…å­˜ä¸­å†™å…¥ä¸€æ¡æŒ‡ä»¤  \n\n    \n    ```\n    å‚è€ƒ ç‹çˆ½ \u003cæ±‡ç¼–è¯­è¨€ç¬¬ä¸‰ç‰ˆ\u003e p35.\n    ```\n    \n\n## åˆ†æ®µç®¡ç†åŠæ ‡å¿—å¯„å­˜å™¨\n\n- ä¸€ä¸ªå­˜å‚¨å•å…ƒæœ‰ä¸€ä¸ªç‰©ç†åœ°å€\n    - ä¸€ä¸ªå­˜å‚¨å•å…ƒçš„ç¼–å·\n    - æ¯ä¸ªç‰©ç†å­˜å‚¨å•å…ƒéƒ½æœ‰ä¸€ä¸ª 20 ä½ç¼–å·\n    - 8086CPU ç‰©ç†åœ°å€èŒƒå›´: 00000H ~ FFFFFH\n    - ç‰©ç†åœ°å€ä¸ºé€»è¾‘åœ°å€å·¦ç§» 4 ä½ (ä¹˜ä»¥10h), åŠ ä¸Šåç§»åœ°å€\n        - `1230:100`, `1030:2100`, `1100:1400` å¯¹åº”çš„ç‰©ç†åœ°å€éƒ½æ˜¯ `12400`\n- ä¸€ä¸ªå­˜å‚¨å•å…ƒå¯¹åº”å¤šä¸ªé€»è¾‘åœ°å€\n    - ç”¨æˆ·ç¼–ç¨‹æ—¶, é‡‡ç”¨é€»è¾‘åœ°å€\n        - `æ®µåŸºåœ°å€ : æ®µå†…åç§»åœ°å€`\n\n### æ®µå¯„å­˜å™¨å’Œé€»è¾‘æ®µ\n\n- 8086CPU æœ‰ 4 ä¸ªæ®µå¯„å­˜å™¨\n- æ¯ä¸ªæ®µå¯„å­˜å™¨ç”¨æ¥ç¡®å®šä¸€ä¸ªé€»è¾‘æ®µçš„èµ·å§‹ä½ç½®\n- æ¯ç§é€»è¾‘æ®µå‡æœ‰è‡ªå·±çš„ç”¨é€”\n    - CS: ä»£ç æ®µå¯„å­˜å™¨ (Code Segment)\n        - åˆ©ç”¨ CS:IP å–å¾—ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤\n    - DS: æ•°æ®æ®µå¯„å­˜å™¨ (Data Segment)\n        - åˆ©ç”¨ DS:EA å­˜å–æ•°æ®æ®µä¸­çš„æ•°æ®\n    - SS: æ ˆæ®µå¯„å­˜å™¨ (Stach Segment)\n        - åˆ©ç”¨ CS:IP æ“ä½œå †æ ˆé¡¶çš„æ•°æ®\n    - ES: é™„åŠ æ®µå¯„å­˜å™¨ (Extra Segment)\n        - åˆ©ç”¨ ES:EA å­˜å–é™„åŠ æ®µä¸­çš„æ•°æ®\n\n    \n    ```\n    - EA æ˜¯åç§»åœ°å€, ç§°ä¹‹ä¸ºæœ‰æ•ˆåœ°å€ EA\n    - è‹¥æ“ä½œæ•°åœ¨ä¸»å­˜ä¸­, å­˜å–çš„æ–¹å¼æœ‰:\n        - ç›´æ¥å¯»å€\n        - å¯„å­˜å™¨é—´æ¥å¯»å€\n        - å¯„å­˜å™¨ç›¸å¯¹å¯»å€\n        - åŸºå€å˜å€å¯»å€\n        - ç›¸å¯¹åŸºå€å˜å€å¯»å€\n    ```\n    \n- æ²¡æœ‰æŒ‡æ˜æ®µå‰ç¼€æ—¶, ä¸€èˆ¬çš„æ•°æ®è®¿é—®åœ¨ DS (uæ•°æ®) æ®µ\n    - `MOV AX, [1000H]` == `MOV AX,DS:[1000H]`\n        - ä»é»˜è®¤çš„ DS æ®µä¸­å–å‡ºæ•°æ®\n    - `MOV AX,CS:[1000H]`\n        - ä»æŒ‡å®šçš„ CS æ®µå–å‡ºæ•°æ®\n\n## æ ‡å¿—å¯„å­˜å™¨\n\nç»“æ„å›¾:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/æ±‡ç¼–/z-attachments/Pasted image 20220917151340.png]]\n\nå«ä¹‰:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/æ±‡ç¼–/z-attachments/Pasted image 20220917151353.png]]\n\n- çŠ¶æ€æ ‡å¿—\n    - ç”¨äºè®°å½•ç¨‹åºè¿è¡Œç»“æœçš„çŠ¶æ€ä¿¡æ¯\n        - CF è¿›ä½æ ‡å¿— (Carry Flag)\n            - å½“è¿ç®—ç»“æœçš„æœ€é«˜æœ‰æ•ˆä½æœ‰è¿›ä½(åŠ æ³•)æˆ–å€Ÿä½(å‡æ³•)æ—¶, ç½® 1, å¦åˆ™ 0\n        - ZF é›¶æ ‡å¿— (Zero Flag)\n            - å¼±è¿ç®—ç»“æœä¸º 0, åˆ™ç½® 1, å¦åˆ™ 0\n        - SF ç¬¦å·æ ‡å¿— (Sign Flag)\n            - è‹¥è¿ç®—ç»“æœæœ€é«˜ä½(ç¬¦å·ä½)ä¸º 1, åˆ™ç½® 1, å¦åˆ™ 0\n        - PF å¥‡å¶æ ‡å¿— (Parity Flag)\n            - è¿ç®—ç»“æœæœ€ä½å­—èŠ‚ä¸­ 1 çš„ä¸ªæ•°ä¸º 0 æˆ–å¶æ•°, åˆ™ç½® 1, å¦åˆ™ 0\n        - OF æº¢å‡ºæ ‡å¿— (Overflow Flag)\n            - è¿ç®—ç»“æœæœ‰æº¢å‡º, åˆ™ç½® 1, å¦åˆ™ 0\n            - æº¢å‡º: æœ‰ç¬¦å·æ•°çš„è¿ç®—ç»“æœä¸æ­£ç¡®\n        - AF è¾…åŠ©è¿›ä½æ ‡å¿— (Auxiliary Carry Flag)\n            - è¿ç®—æ—¶ D3 (ä½åŠå­—èŠ‚) æœ‰è¿›ä½æˆ–å€Ÿä½, ç½®1, å¦åˆ™ 0\n- æ§åˆ¶æ ‡å¿—\n    - ç”¨äºæ§åˆ¶å¤„ç†å™¨æ‰§è¡ŒæŒ‡ä»¤\n        - DF æ–¹å‘æ ‡å¿— (Direction Flag)\n            - ç”¨äºä¸²æ“ä½œæŒ‡ä»¤, æ§åˆ¶åœ°å€çš„å˜åŒ–æ–¹å‘\n            - 1 åˆ™å­˜å‚¨å™¨åœ°å€è‡ªåŠ¨å¢åŠ \n            - 0 åˆ™å­˜å‚¨å™¨åœ°å€è‡ªåŠ¨å‡å°‘\n            - `CLD` ç”¨äºå¤ä½ DF = 0\n            - `STD` ç”¨äºç½®ä½ DF = 1\n        - IF ç»ˆç«¯å…è®¸æ ‡å¿— (Interrupt-enable Flag)\n            - 0 ç¦æ­¢ä¸­æ–­\n            - 1 å…è®¸ä¸­æ–­\n            - `CLI` ç”¨äºå¤ä½ IF = 0\n            - `STI` ç”¨äºç½®ä½ IF = 1\n        - TF é™·é˜±æ ‡å¿— (Trap Flag)\n            - 0 å¤„ç†å™¨æ­£å¸¸å·¥ä½œ\n            - 1 å¤„ç†å™¨å•æ­¥æ‰§è¡Œ\n\n## æŒ‡ä»¤åŠå¯»å€æ–¹å¼\n\n- é›¶æ“ä½œæ•°æŒ‡ä»¤\n- ä¸€æ“ä½œæ•°æŒ‡ä»¤\n- äºŒæ“ä½œæ•°æŒ‡ä»¤\n    - `æ“ä½œç  ç›®çš„æ“ä½œæ•° æºæ“ä½œæ•°`\n\n### ä¸ƒç§å¯»å€æ–¹å¼\n\n\u003e å¯»å€æ–¹å¼: æŒ‡ä»¤ä¸­æŒ‡æ˜æ“ä½œæ•°å­˜æ”¾ä½ç½®çš„è¡¨è¾¾æ–¹å¼.  \n\næŒ‡ä»¤ä¸­æ“ä½œæ•°çš„æ•°æ®å­˜æ”¾ä½ç½®æœ‰ 3 ç§æƒ…å†µ:\n\n- å­˜æ”¾æŒ‡ä»¤ä¸­ (ç«‹å³æ•°)\n    - æ“ä½œæ•°åŒ…å«åœ¨æŒ‡ä»¤ä¸­\n    - å¤‡æ“ä½œæ•°æ®ç›´æ¥è¡¨ç¤ºåœ¨æŒ‡ä»¤çš„æ“ä½œæ•°å­—æ®µä¸­\n    - ç´§è·Ÿåœ¨æ“ä½œç ä¹‹å\n    - ä¾‹å¦‚ `MOV AL, 10H`\n- å­˜æ”¾äºå¯„å­˜å™¨ä¸­ (å¯„å­˜å™¨æ“ä½œæ•°) \n    - æ•°æ®å­˜æ”¾åœ¨ CPU çš„ä¸€ä¸ªå¯„å­˜å™¨ä¸­\n    - ä¾‹å¦‚ `INC CX`\n- å­˜æ”¾äºå­˜å‚¨å™¨ä¸­ (å­˜å‚¨å™¨æ“ä½œæ•°)\n    - æ•°æ®å†å†…å­˜æˆ– I/I ç«¯å£ä¸­\n    - å­˜æ”¾æ•°æ®çš„åç§»åœ°å€ä»¥æŸç§æ–¹å¼è¡¨ç¤ºåœ¨æŒ‡ä»¤ä¸­\n    - ä¾‹å¦‚ `MOV AX, [2500H]`\n        - å…¶ä¸­ [2500] ä¸ºå­˜å‚¨å™¨æ“ä½œæ•°\n        - å­˜å‚¨å™¨æ“ä½œæ•°ä¸­æ“ä½œçš„æ•°å­—æ®µæŒ‡ç¤ºæ­¤æ“ä½œæ•°çš„åç§»åœ°å€\n        - æ®µåœ°å€ç”±æŸä¸ªæ®µå¯„å­˜å™¨æä¾›\n        - é»˜è®¤ä¸º DS æä¾›\n\n### å¯»å€æ–¹å¼åˆ†ç±»\n\n- ç«‹å³æ•°å¯»å€\n    - æ“ä½œæ•°ä¸ºç«‹å³æ•°\n    - ç›´æ¥å­˜æ”¾åœ¨æŒ‡ä»¤çš„æ“ä½œæ•°å­—æ®µ\n    - åªå…è®¸æºæ“ä½œæ•°ä¸ºç«‹å³æ•°\n    - ç›®æ ‡æ“ä½œæ•°å¿…é¡»æ˜¯å¯„å­˜å™¨æˆ–å­˜å‚¨å•å…ƒ\n        - ç»™å¯„å­˜å™¨æˆ–å­˜å‚¨å•å…ƒèµ‹å€¼\n- å¯„å­˜å™¨å¯»å€\n    - ç›´æ¥åœ¨æŒ‡ä»¤ä¸­å†™å‡ºå¯„å­˜å™¨åç§°\n- å­˜å‚¨å™¨å¯»å€\n    - ç›´æ¥å¯»å€\n        - æ“ä½œæ•°å­˜åœ¨å†…å­˜ä¸­, æ“ä½œæ•°çš„åç§»åœ°å€ç›´æ¥è¡¨ç¤ºåœ¨æŒ‡ä»¤ä¸­\n        - è¡¨ç¤ºæ ¼å¼: [åç§»åœ°å€]\n        - é»˜è®¤æ“ä½œæ•°å­˜æ”¾åœ¨å†…å­˜çš„æ•°æ®æ®µä¸­\n        - ä¾‹å¦‚ `MOV AL, [1064H]`\n        - æ®µè¶…è¶ŠæŒ‡æ˜ä½¿ç”¨çš„æ®µ\n    - å¯„å­˜å™¨é—´æ¥å¯»å€\n    - åŸºå€åŠ å˜å€å¯»å€\n    - ç›¸å¯¹åŠ åŸºå€å˜å€å¯»å€\n\n## å¸¸è§æ±‡ç¼–æŒ‡ä»¤\n\n### æ•°æ®ä¼ é€æŒ‡ä»¤\n\n#### é€šç”¨ä¼ é€æŒ‡ä»¤\n\n\u003e æ‰€æœ‰é€šç”¨ä¼ é€æŒ‡ä»¤éƒ½ä¸å½±å“æ ‡å¿—ä½.  \n\n- MOV DST, SRC;\n    - å°† SRC å†…å®¹èµ‹å€¼ç»™ DST\n    - å­˜å‚¨å™¨æ“ä½œæ•°ä¹‹é—´ä¸èƒ½ç›´æ¥ä¼ é€’\n        - åä¾‹: `MOV [1000H], [DI]`\n        - åº”æ”¹ä¸º: `MOV AX, [DI]`; `MOV [1000H], AX`\n    - ç«‹å³æ•°ä¸èƒ½ç›´æ¥ç»™æ®µå¯„å­˜å™¨\n        - åä¾‹: `MOV DS, 2000H`\n        - åº”æ”¹ä¸º: `MOV AX, 2000H`, `MOV DS, AX`\n    - æ®µå¯„å­˜å™¨ä¹‹é—´ä¸èƒ½ç›´æ¥ä¼ é€’\n    - CS å€¼å¯ä»¥ä½œä¸ºæºæ“ä½œæ•°\n    - æºæ“ä½œæ•°å’Œç›®çš„æ“ä½œæ•°å®½åº¦å¿…é¡»ç›¸ç­‰\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/æ±‡ç¼–/z-attachments/Pasted image 20220917151408.png]]\n\n#### å †æ ˆæŒ‡ä»¤\n\n\u003e åè¿›å…ˆå‡º.  \n\u003e èµ‹å€¼éµå¾ªé«˜é«˜ä½ä½åŸåˆ™.\n\n- PUSH src\n    1. (SP) \u003c- (SP) - 2\n        - å †æ ˆæ“ä½œä»¥å­—ä¸ºå•ä½, æ‰€ä»¥ -2\n    1. ((SP)+1,(SP)) \u003c- (src)\n- POP\n    - æŠŠ SP æ‰€æŒ‡å‘çš„å †æ ˆé¡¶éƒ¨çš„ä¸€ä¸ªå­—é€å…¥ç›®çš„åœ°å€, åŒæ—¶è°¢ç›–å †æ ˆæŒ‡é’ˆ\n    1. (dst) \u003c- ((SP)+1,(SP))\n    1. (SP) \u003c- (SP)+2\n\n#### äº¤æ¢æŒ‡ä»¤\n\n- XCHG dst, src\n    - å¯ä»¥å®ç°å¯„å­˜å™¨ä¹‹é—´, å¯„å­˜å™¨å’Œå­˜å‚¨å™¨ä¹‹é—´çš„äº¤æ¢æ“ä½œ\n    - å­˜å‚¨å™¨ä¹‹é—´ä¸èƒ½ç›´æ¥äº¤æ¢\n    - æ®µå¯„å­˜å™¨ä¸èƒ½ä½œä¸ºæ“ä½œæ•°\n    - å…è®¸å­—æˆ–å­—èŠ‚æ“ä½œ\n\n#### è¾“å…¥æŒ‡ä»¤\n\n- IN\n    - ç”¨äº CPU ä»å¤–è®¾ç«¯å£æ¥æ”¶æ•°æ®\n\n#### è¾“å‡ºæŒ‡ä»¤\n\n- OUT\n    - ç”¨äº CPU å‘å¤–è®¾ç«¯å£ä¼ è¾“æ•°æ®\n\n#### ç›®çš„åœ°å€ä¼ é€æŒ‡ä»¤\n\n- LEA reg16, mem\n    - reg16 -- 16ä½é€šç”¨å¯„å­˜å™¨\n    - mem -- å­˜å‚¨å•å…ƒ\n    - å°†å…ƒæ“ä½œæ•°çš„åç§»åœ°å€ä¼ ç»™ç›®çš„æ“ä½œæ•°\n    - æºæ“ä½œæ•°å¿…é¡»ä»¥å¯„å­˜å™¨é—´æ¥å¯»å€, å˜å€å¯»å€, åŸºå€åŠ å˜å€å¯»å€ç­‰æ–¹å¼è¡¨ç¤ºçš„å­˜å‚¨å™¨æ“ä½œæ•°\n- LDS reg16, mem\n\n#### æ ‡å¿—ä¼ é€æŒ‡ä»¤\n\n- LAHF\n    - å°†æ ‡å¿—å¯„å­˜å™¨ä½å…«ä½ä¼ é€ç»™ AH\n- SAHF\n    - å°† AH èµ‹å€¼ç»™æ ‡å¿—å¯„å­˜å™¨ä½å…«ä½\n- PUSHF\n    - æ ‡å¿—è¿›æ ˆ\n- POPF\n    - æ ‡å¿—å‡ºæ ˆ\n\n### ç®—æ•°è¿ç®—ç±»æŒ‡ä»¤\n\n#### åŠ æ³•æŒ‡ä»¤\n\n- ADD (Addition) åŠ æ³•æŒ‡ä»¤\n    - `ADD dest, src`\n    - (data) \u003c- (dest) + (src)\n    - æºå’Œç›®çš„ä¸èƒ½åŒæ—¶ä¸ºå­˜å‚¨å™¨, ä¸èƒ½ä¸ºæ®µå¯„å­˜å™¨\n- ADC (Add with Carry) å¸¦è¿›ä½åŠ æ³•æŒ‡ä»¤\n    - `ADC dest, src`\n    - (dest) \u003c- (dest) + (src) + C\n    - C æ˜¯ä¸Šä¸€æ¡æŒ‡ä»¤çš„è¿›ä½ç»“æœ\n    - ç”¨äºå¤šå­—èŠ‚æ‹†åˆ†è¿ç®—\n- INC (Increment) åŠ  1 æŒ‡ä»¤\n    - `INC dest`\n    - (dest) \u003c- (dest) + 1\n    - å¤šç”¨äºå¾ªç¯ä¸­ä¿®æ”¹åœ°å€æŒ‡é’ˆå’Œå¾ªç¯æ¬¡æ•°\n    - å½±å“æ ‡å¿—ä½ S, Z, A, P, O\n\n#### å‡æ³•æŒ‡ä»¤\n\n- SUB\n    - `SUB dest, src`\n    - (data) \u003c- (dest) - (src)\n- SBB\n    - `SBB dest, src`\n    - (dest) \u003c- (dest) - (src) - C\n- DEC\n    - `DEC dest`\n    - (dest) \u003c- (dest) - 1\n    - å¤šç”¨äºå¾ªç¯ä¸­ä¿®æ”¹åœ°å€æŒ‡é’ˆå’Œå¾ªç¯æ¬¡æ•°\n    - å½±å“æ ‡å¿—ä½ S, Z, A, P, O\n\n#### æ±‚è¡¥æŒ‡ä»¤\n\n- `NEG dest`\n    - (dest) \u003c- 0 - (dest)\n    - æŠŠæ“ä½œæ•°æŒ‰ä½æ±‚åå†åŠ ä¸€\n\n#### æ¯”è¾ƒæŒ‡ä»¤\n\n- `CMP dest, src`\n    - (dest) - (src)\n    - ç»“æœä¸ä¿ç•™, åªç”¨æ¥å½±å“æ ‡å¿—ä½\n        - A, C, O, P, S, Z\n    - æ¯”è¾ƒä¸¤ä¸ªæ•°çš„å¤§å°å…³ç³»\n        - Z: åˆ¤æ–­ä¸¤è€…æ˜¯å¦ç›¸ç­‰\n        - C: åˆ¤æ–­ä¸¤ä¸ªæ— ç¬¦å·æ•°çš„å¤§å°\n        - S, O: åˆ¤æ–­ä¸¤ä¸ªå¸¦ç¬¦å·æ•°çš„å¤§å°\n    - cmp ç®—æœ¯å‡æ³•è¿ç®—ç»“æœä¸ºé›¶,å°±æŠŠZF(é›¶æ ‡å¿—)ç½®1\n\n#### ä¹˜æ³•æŒ‡ä»¤\n\n- MUL æ— ç¬¦å·ä¹˜æ³•\n    - `MUL SRC`\n    - å­—èŠ‚æ“ä½œæ•°: AX \u003c- (AL) * (SRC)\n    - å­—æ“ä½œæ•°: DX:AX \u003c- (AX) * (SRC)\n- IMUL å¸¦ç¬¦å·ä¹˜æ³•\n    - ä¸ä¸Šé¢ç±»ä¼¼\n\n#### é™¤æ³•æŒ‡ä»¤\n\n- DIV æ— ç¬¦å·é™¤æ³•\n    - `DIV SRC`\n    - å­—èŠ‚é™¤æ³•:\n        - AL \u003c- (AX) / (SRC) çš„å•†\n        - AL \u003c- (AX) / (SRC) çš„ä½™æ•°\n    - å­—é™¤æ³•:\n        - AL \u003c- (DX:AX) / (SRC) çš„å•†\n        - AL \u003c- (DX:AX) / (SRC) çš„ä½™æ•°\n- IDIV æœ‰ç¬¦å·é™¤æ³•\n    - ä¸ä¸Šé¢ç±»ä¼¼\n\n### é€»è¾‘è¿ç®—æŒ‡ä»¤ (ä½æ“ä½œ)\n\n- AND dest, src\n    - (dest) \u003c- (dest) and (src)\n- TEST dest, src\n    - ä¸ and ç±»ä¼¼\n    - ä¸ä¿å­˜ç»“æœ, åªæ”¹å˜æ ‡å¿—ä½\n    - testé€»è¾‘ä¸è¿ç®—ç»“æœä¸ºé›¶,å°±æŠŠZF(é›¶æ ‡å¿—)ç½®1\n- OR dest, src\n    - ä¸ and ç›¸å\n- XOR dest, src\n    - ç›¸åŒä¸º 0\n- NOT dest\n    - æŒ‰ä½å–å\n\n### ç§»ä½æŒ‡ä»¤ (ä½æ“ä½œ)\n\n- SAL (Shift Arithmetic Left) ç®—æœ¯å·¦ç§»\n    - ç›¸å½“äºæ— ç¬¦å·ä¹˜ä»¥2^n\n    - æœ€ä½ä½å¡«å…… 0\n- SAR (shift arithmetic right) ç®—æœ¯å³ç§»\n    - æœ€é«˜ä½ä¸å˜\n    - æœ€ä½ä½ç§»å…¥å¯„å­˜å™¨ CL\n- SHL (shift logical left) é€»è¾‘å·¦ç§»\n    - ç›¸å½“äºæ— ç¬¦å·ä¹˜ä»¥2^n\n    - æœ€ä½ä½å¡«å…… 0\n- SHR (shift logical right) é€»è¾‘å³ç§»\n    - ç›¸å½“äºæ— ç¬¦å·é™¤ä»¥2^n\n    - æœ€é«˜ä½å¡«å…… 0\n    - æœ€ä½ä½è¿›å…¥å¯„å­˜å™¨ CF\n- ROL (rotate left) å¾ªç¯å·¦ç§»\n    - æœ€é«˜ä½æ”¾å…¥æœ€ä½ä½\n    - æœ€é«˜ä½å¤åˆ¶åˆ° CF\n- ROR (rotate right) å¾ªç¯å³ç§»\n    - æœ€ä½ä½æ”¾å…¥æœ€é«˜ä½\n    - æœ€ä½ä½å¤åˆ¶åˆ° CF\n- RCL (rotate left with carry) å¸¦è¿›ä½å¾ªç¯å·¦ç§»\n    - CF è¿›ä½å€¼æ”¾ä½ä½\n    - é«˜ä½æ”¾ CF\n- RCR (rotate right with carry) å¸¦è¿›ä½å¾ªç¯å³ç§»\n    - CF è¿›ä½å€¼æ”¾é«˜å±\n    - ä½ä½æ”¾ CF\n\næŒ‡ä»¤æ ¼å¼:  \n\n```x86arm\næ“ä½œç  reg/mem, count   # count=1æˆ–CL, æŒ‡å®šç§»ä½æ¬¡æ•°\n```\n\n### ä¸²æ“ä½œ\n\n\u003e ä¸²æ˜¯å†…å­˜ä¸­ä¸€æ®µåœ°å€ç›¸è¿çš„å­—èŠ‚æˆ–å­—.\n\n- ä¸²æ“ä½œä¹Ÿå«æ•°æ®å—æ“ä½œ\n- å¯å®ç°å­˜å‚¨å™¨æ•°æ®é—´çš„ç›´æ¥ä¼ é€\n- 8086 æœ‰ 5 ç§åŸºæœ¬ä¸²æ“ä½œ\n- å¯¹å­—æ“ä½œä»¥ B ç»“å°¾, å¯¹å­—èŠ‚æ“ä½œä»¥ W ç»“å°¾\n    - MOVS (move string) ä¸²ä¼ é€\n    - CMPS (compare string) ä¸²æ¯”è¾ƒ\n    - SCAS (scan string) ä¸²æ‰«æ\n    - LODS (load from string) å–ä¸²\n    - STOS (store in to string) å­˜ä¸²\n    - REP é‡å¤ä¸²æ“ä½œæ‰§è¡Œè¿‡ç¨‹\n        - å½“ CX != 0 åˆ™æ‰§è¡Œ CX \u003c- CX - 1, å†æ‰§è¡Œåç»­ä¸²æŒ‡ä»¤\n        - å½“ CX == 0, ç»“æŸ REP, æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤\n\n```\nå¯ä»¥ä¸å€ŸåŠ©å¯„å­˜å™¨ç›´æ¥åœ¨å­˜å‚¨å™¨é—´ä¼ é€’æ•°æ®.\n```\n\n### æ§åˆ¶ç±»æŒ‡ä»¤\n\n#### éæ¡ä»¶è½¬ç§»\n\n- JMP \n    - `JMP ä½ç½®`\n\n#### æ¡ä»¶è½¬ä¹‰\n\n- æ ¹æ®å•ä¸ªæ¡ä»¶æ ‡å¿—\n    - Z æ ‡å¿—\n        - JZ / JNZ (jump on zero; jump on no zero)\n    - C æ ‡å¿—\n        - JC / JNC (jump if carry)\n    - p æ ‡å¿—\n        - JP (JPE) / JNP (JPO) (jump on parity; jump on even; jump on odd)\n    - S æ ‡å¿—\n        - JS (è´Ÿå·è·³è½¬) / JNS\n    - 0\n        - JO (æº¢å‡ºè·³è½¬) / JNO\n- æ ¹æ®ä¸¤ä¸ªæ— ç¬¦å·æ•°å¤§å°å…³ç³»\n    - JB ä½äºè·³è½¬\n    - JBE ä¸é«˜äºè·³è½¬\n    - JA é«˜äºè·³è½¬\n    - JAE é«˜äºç­‰äºè·³è½¬\n    - JNB ä¸ä½äºè·³è½¬\n- æ ¹æ®ä¸¤ä¸ªå¸¦ç¬¦å·æ•°æ¯”è¾ƒç»“æœ\n    - JL (JNGE) å°äºè·³è½¬\n    - JNL (JGE) ä¸å°äºè·³è½¬\n\n```\næ‰€æœ‰æ¡ä»¶è½¬ä¹‰æŒ‡ä»¤éƒ½æ˜¯æ®µå†… (-128 ~ +127) èŒƒå›´å†…è½¬ç§»\n```\n\n#### è¿‡ç¨‹(å­ç¨‹åº)è°ƒç”¨\n\n- è‡ªç¨‹åºè°ƒç”¨\n    - CALL å­è¿‡ç¨‹å\n- è¿”å›æŒ‡ä»¤\n    - RET\n        - åœ¨å­ç¨‹åºçš„ç»“å°¾\n        - ç”¨äºè¿”å›ä¸»ç¨‹åº\n\n#### æ— æ¡ä»¶å¾ªç¯\n\n- LOOP è¯­å¥æ ‡å·\n    - CX \u003c- CX - 1\n    - è‹¥ CX != 0 è½¬å‘ç›®æ ‡åœ°å€å»æ‰§è¡Œ\n    - å¦åˆ™æ‰§è¡Œ LOOP ä¹‹åçš„æŒ‡ä»¤\n    - è¿‡ç¨‹è§£é‡Š\n        1. é¦–å…ˆæ‰§è¡Œ CX = CX - 1\n        1. åˆ¤æ–­ CX çš„å€¼\n        1. è‹¥ CX != 0 åˆ™è½¬ç§»åˆ° Lable å¤„æ‰§è¡Œ\n        1. å¦åˆ™å‘ä¸‹ç»§ç»­\n\n#### æ¡ä»¶å¾ªç¯\n\n- LOOPZ / LOOPE è¯­å¥æ ‡å·\n    - CX \u003c- CX - 1\n    - è‹¥ CX != 0 ä¸” ZF == 1, è½¬å‘ç›®æ ‡åœ°å€æ‰§è¡Œ\n    - å¦åˆ™æ‰§è¡Œä¹‹åçš„è¯­å¥\n    - è¿‡ç¨‹è§£é‡Š\n        - é¦–å…ˆæ‰§è¡Œ CX = CX - 1\n        - åˆ¤æ–­ CX != 0 å’Œ ZF == 1 æ»¡è¶³åˆ™è½¬åˆ° Lable æ‰§è¡Œ\n        - å¦åˆ™å‘ä¸‹ç»§ç»­\n\n#### ä¸­æ–­æŒ‡ä»¤\n\n- ä¸­æ–­è°ƒç”¨\n    - INT n\n    - nä¸ºä¸­æ–­å·, 0 ~ 255\n- ä¸­æ–­è¿”å›\n    - IRET\n\n#### æ ‡å¿—å¤„ç†æŒ‡ä»¤\n\n- CLC (clear carry flag) æ¸… C\n- STC (set carry flag) ç½® C\n- CMC (complement carry flag) C æ±‚å\n- CLD (clear direction flag) æ¸… D\n- STD (set direction flag) ç½® D\n- CLI (clear interrupt flag) æ¸… I\n- STI (set interrupt enable flag) ç½® I\n\n#### å…¶å®ƒå¤„ç†æœºæ§åˆ¶æŒ‡ä»¤\n\n- NOP (no operation)\n\n## OPCode\n\n- ä¸€ä¸ª opcode ä¸ä¸€å®šå¯¹åº”ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤\n- ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤ä¸ä¸€å®šå¯¹åº”ä¸€ä¸ª opcode\n\n### OPCode ä¸»è¦æ•°æ®åŸŸ\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/æ±‡ç¼–/z-attachments/Pasted image 20220917151425.png]]\n\n- ä»¥ä¸Šåªæœ‰ Code åŸŸæ˜¯å¿…é¡»å­˜åœ¨çš„\n- å…¶å®ƒæ•°æ®åŸŸè§†æŒ‡ä»¤æ ¼å¼è€Œå®šæœ‰æ— \n- ä¸€ä¸ªæŒ‡ä»¤çš„é•¿åº¦åœ¨ `1Byte ~ 16Byte` ä¹‹é—´\n- å®é™…æ­£å¸¸çš„æœ€é•¿æŒ‡ä»¤ä¸º `13Byte`\n\n### æŒ‡ä»¤å‰ç¼€\n\n- å‰ç¼€(Prefixes)å¤§å°ä¸º `Byte, å¯ä»¥è¢«åˆ’åˆ†ä¸º 5 ä¸ªé›†åˆ\n    - åˆ‡æ¢æ“ä½œæ•°å¤§å° 66\n    - åˆ‡æ¢åœ°å€å¤§å° 67\n        - åˆ‡æ¢æ˜¯ç‰¹æŒ‡åœ¨ 2 ç§çŠ¶æ€é—´åˆ‡æ¢, è€Œéåˆ‡æ¢åˆ°ç‰¹æŒ‡çš„æŸçŠ¶æ€\n    - é‡å¤æ“ä½œå‰ç¼€ F2/F3\n    - ä¿®æ”¹é»˜è®¤æ®µ 2E/36/3E/26/64/65\n        - å°†é»˜è®¤å€¼ä¿®æ”¹ä¸ºå…¶å®ƒæ®µ\n    - é”å®šå‰ç¼€ F0\n- è¿™äº›æŒ‡ä»¤ç‹¬æ­¤ä¸€ä»½, ä¸å¯èƒ½ä¸ºå…¶å®ƒæœºå™¨ç \n- å¦‚æœæœ‰å¤šä¸ª prefixes, é¡ºåºå¯èƒ½æ˜¯ä¹±åº\n- å¦‚æœ prefixes ä¸èƒ½å¯¹åç»­çš„ opcode èµ·ä½œç”¨, é‚£å°±è¢«å¿½ç•¥\n- å‡ºç°ç‰¹å®šæ“ä½œç æ—¶ç”¨ä½œè¡¥å……è¯´æ˜, ä¸€èˆ¬æ˜¯æŒ‡ä»¤å†’å·å‰çš„éƒ¨åˆ†\n\n### ModR/M\n\n- è¾…åŠ©è¯´æ˜æ“ä½œç çš„æ“ä½œæ•°\n    - æ“ä½œæ•°çš„ä¸ªæ•°\n    - æ“ä½œæ•°çš„ç§ç±» [å¯„å­˜å™¨, å†…å­˜åœ°å€, å¸¸é‡]\n\n### D-SIB\n\n- ç”¨æ¥è¾…åŠ©è¯´æ˜ ModR/M\n- è¾…åŠ©å¯»å€\n- éœ€è¦å’Œ ModR/M ä¸€èµ·ä½¿ç”¨\n\n### ä½ç§»\n\n- æ“ä½œç çš„æ“ä½œæ•°ä¸ºå†…å­˜åœ°å€äº‹, ç”¨æ¥è¡¨ç¤ºä½ç§»æ“ä½œ\n\n### ç«‹å³æ•°\n\n- æ“ä½œç çš„æ“ä½œæ•°æ˜¯å¸¸é‡, è¯¥å¸¸é‡ä¸ºç«‹å³æ•°\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/%E6%B1%87%E7%BC%96/x86/%E5%AF%84%E5%AD%98%E5%99%A8testcmp%E5%89%96%E6%9E%90":{"title":"å¯„å­˜å™¨ï¼Œtestï¼Œcmpå‰–æ","content":"# å¯„å­˜å™¨ï¼Œtestï¼Œcmpå‰–æ\n\n## çŠ¶æ€å¯„å­˜å™¨\n\n\u003e é¦–å…ˆå¤ä¹ ä¸€ä¸‹çŠ¶æ€å¯„å­˜å™¨.\n\nPSW(Program Status Word)ç¨‹åºçŠ¶æ€å­—(å³æ ‡å¿—)å¯„å­˜å™¨,æ˜¯ä¸€ä¸ª16ä½å¯„å­˜å™¨,ç”±æ¡ä»¶ç æ ‡å¿—(flag)å’Œæ§åˆ¶æ ‡å¿—æ„æˆ,å¦‚ä¸‹æ‰€ç¤ºï¼š  \n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/æ±‡ç¼–/z-attachments/Pasted image 20220917161214.png]]\n\næ¡ä»¶ç ï¼š  \n- OF(Overflow Flag)æº¢å‡ºæ ‡å¿—\n    - æº¢å‡ºæ—¶ä¸º1ï¼Œå¦åˆ™ç½®0\n    - æ ‡æ˜ä¸€ä¸ªæº¢å‡ºäº†çš„è®¡ç®—\n- SF(Sign Flag)ç¬¦å·æ ‡å¿—\n    - ç»“æœä¸ºè´Ÿæ—¶ç½®1ï¼Œå¦åˆ™ç½®0\n- ZF(Zero Flag)é›¶æ ‡å¿—,\n    - è¿ç®—ç»“æœä¸º0æ—¶ç½®1ï¼Œå¦åˆ™ç½®0\n- CF(Carry Flag)è¿›ä½æ ‡å¿—\n- è¿›ä½æ—¶ç½®1ï¼Œå¦åˆ™ç½®0\n- æ³¨æ„:Carryæ ‡å¿—ä¸­å­˜æ”¾è®¡ç®—åæœ€å³çš„ä½\n- AF(Auxiliary carry Flag)è¾…åŠ©è¿›ä½æ ‡å¿—\n    - è®°å½•è¿ç®—æ—¶ç¬¬3ä½(åŠä¸ªå­—èŠ‚)äº§ç”Ÿçš„è¿›ä½ç½®\n    æœ‰è¿›ä½æ—¶1,å¦åˆ™ç½®0ã€‚\n- PF(Parity Flag)å¥‡å¶æ ‡å¿—\n    - ç»“æœæ“ä½œæ•°ä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°æ—¶ç½®1ï¼Œå¦åˆ™ç½®0  \n    - \næ§åˆ¶æ ‡å¿—ä½ï¼š  \n- DF(Direction Flag)æ–¹å‘æ ‡å¿—\n    - åœ¨ä¸²å¤„ç†æŒ‡ä»¤ä¸­æ§åˆ¶ä¿¡æ¯çš„æ–¹å‘\n- IF(Interrupt Flag)ä¸­æ–­æ ‡å¿—\n- TF(Trap Flag)é™·äº•æ ‡å¿—  \n\n\u003e testå’ŒcmpæŒ‡ä»¤è¿è¡Œåéƒ½ä¼šè®¾ç½®æ ‡å¿—ä½.\n\n## test\n\n\u003e test æ˜¯é€»è¾‘è¿ç®—ç¬¦\n\n- æ‰§è¡ŒBITä¸BITä¹‹é—´çš„é€»è¾‘è¿ç®—\n- ä¸¤æ“ä½œæ•°ä½œä¸è¿ç®—,ä»…ä¿®æ”¹æ ‡å¿—ä½ï¼Œä¸å›é€ç»“æœ\n- `test r/m, r/m/data`\n- å½±å“æ ‡å¿—ä½ C,O,P,Z,S(å…¶ä¸­Cä¸Oä¸¤ä¸ªæ ‡å¿—ä¼šè¢«è®¾ä¸º0)\n- test çš„ä¸€ä¸ªéå¸¸æ™®éçš„ç”¨æ³•æ˜¯ç”¨æ¥æµ‹è¯•ä¸€æ–¹å¯„å­˜å™¨æ˜¯å¦ä¸ºç©º\n    - test ecx, ecx\n    - jz somewhere\n    - å¦‚æœecxä¸ºé›¶ï¼Œè®¾ç½®ZFé›¶æ ‡å¿—ä¸º1ï¼ŒJzè·³è½¬\n\n## cmp\n\n\u003e cmp å±äºç®—æœ¯è¿ç®—æŒ‡ä»¤\n\n- æ¯”è¾ƒä¸¤ä¸ªå€¼(å¯„å­˜å™¨,å†…å­˜,ç›´æ¥æ•°å€¼)\n- ä¸¤æ“ä½œæ•°ä½œå‡æ³•,ä»…ä¿®æ”¹æ ‡å¿—ä½,ä¸å›é€ç»“æœ\n- `CMP r/m,r/m/data`\n- å½±å“æ ‡å¿—ä½ C,P,A,Z,O\n\n## æ€»ç»“\n\n- test é€»è¾‘ä¸è¿ç®—ç»“æœä¸ºé›¶,å°±æŠŠZF(é›¶æ ‡å¿—)ç½®1\n- cmp ç®—æœ¯å‡æ³•è¿ç®—ç»“æœä¸ºé›¶,å°±æŠŠZF(é›¶æ ‡å¿—)ç½®1","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/%E7%BC%96%E7%A0%81%E6%8A%80%E5%B7%A7/Java%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7":{"title":"Javaè°ƒè¯•æŠ€å·§","content":"\n# Javaè°ƒè¯•æŠ€å·§\n\n## æ‰¾æŸä¸ªå€¼çš„é»˜è®¤å‚æ•°\n\n1. æ¨ç†æŸä¸ªå˜é‡å€¼åœ¨å“ªä¸ªæ–¹æ³•é‡Œç”¨åˆ°\n2. mavenä¸­ä¸‹è½½å¯¹åº”åŒ…çš„source\n3. å…¨å±€æœç´¢è¯¥æ–¹æ³•\n4. **find usages**æ‰¾åˆ°æ–¹æ³•è°ƒç”¨å¤„\n5. æ‰¾åˆ°ä¸Šå±‚æ–¹æ³•ä¸­å¯¹åº”è¯¥è¯¥å˜é‡çš„å‚æ•°\n6. é€çº§å¾€ä¸Šå¯»æ‰¾ï¼Œé‡åˆ°æ¥å£è·³è½¬åˆ°å¯¹åº”æ¨¡å—ä¸‹çš„å®ç°\n7. æ‰¾åˆ°æœ€ç»ˆçš„æºå¤´\n\n### æ€»ç»“\n\nå·§ç”¨find usagesï¼Œæ‰¾åˆ°è°ƒç”¨å¤„ã€‚\né€‰ä¸­å˜é‡ï¼Œåœ¨å³ä¾§æ»šåŠ¨æ¡ä¸­ä¼šç”¨ç²‰çº¢è‰²æ ‡é¢˜èµ‹å€¼ä½ç½®ã€‚\n\n## åˆ©ç”¨debugå †æ ˆå›æº¯\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/0-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%86%85%E9%83%A8%E7%B1%BB":{"title":"å†…éƒ¨ç±»","content":"# å†…éƒ¨ç±»\n\nè¢«å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»çš„å†…éƒ¨ï¼Œæ‰€ä»¥ç§°ä¸ºå†…éƒ¨ç±»ï¼ˆNested Classï¼‰ã€‚Javaçš„å†…éƒ¨ç±»åˆ†ä¸ºå¥½å‡ ç§ï¼Œé€šå¸¸æƒ…å†µç”¨å¾—ä¸å¤šï¼Œä½†ä¹Ÿéœ€è¦äº†è§£å®ƒä»¬æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚\n\n## Inner Class\n\n```java\nclass Outer {\n    class Inner {\n        // å®šä¹‰äº†ä¸€ä¸ªInner Class\n    }\n}\n```\n\nä¸Šè¿°å®šä¹‰çš„`Outer`æ˜¯ä¸€ä¸ªæ™®é€šç±»ï¼Œè€Œ`Inner`æ˜¯ä¸€ä¸ªInner Classï¼Œå®ƒä¸æ™®é€šç±»æœ‰ä¸ªæœ€å¤§çš„ä¸åŒï¼Œå°±æ˜¯**Inner Classçš„å®ä¾‹ä¸èƒ½å•ç‹¬å­˜åœ¨**ï¼Œå¿…é¡»ä¾é™„äºä¸€ä¸ªOuter Classçš„å®ä¾‹ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```java\npublic class Main {\n    public static void main(String[] args) {\n        Outer outer = new Outer(\"Nested\"); // å®ä¾‹åŒ–ä¸€ä¸ªOuter\n        Outer.Inner inner = outer.new Inner(); // å®ä¾‹åŒ–ä¸€ä¸ªInner\n        inner.hello();\n    }\n}\n\nclass Outer {\n    private String name;\n\n    Outer(String name) {\n        this.name = name;\n    }\n\n    class Inner {\n        void hello() {\n            System.out.println(\"Hello, \" + Outer.this.name);\n        }\n    }\n}\n```\n\nè¦å®ä¾‹åŒ–ä¸€ä¸ª`Inner`ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆåˆ›å»ºä¸€ä¸ª`Outer`çš„å®ä¾‹ï¼Œç„¶åï¼Œè°ƒç”¨`Outer`å®ä¾‹çš„`new`æ¥åˆ›å»º`Inner`å®ä¾‹ï¼š\n\n```java\nOuter.Inner inner = outer.new Inner();\n```\n\nInner Classå’Œæ™®é€šClassç›¸æ¯”ï¼Œé™¤äº†èƒ½å¼•ç”¨Outerå®ä¾‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„â€œç‰¹æƒâ€ï¼Œå°±æ˜¯å¯ä»¥**ä¿®æ”¹Outer Classçš„`private`å­—æ®µ**ï¼Œå› ä¸ºInner Classçš„ä½œç”¨åŸŸåœ¨Outer Classå†…éƒ¨ï¼Œæ‰€ä»¥èƒ½è®¿é—®Outer Classçš„`private`å­—æ®µå’Œæ–¹æ³•ã€‚\n\nè§‚å¯Ÿ[[Javaç¼–è¯‘å™¨]]ç¼–è¯‘åçš„`.class`æ–‡ä»¶å¯ä»¥å‘ç°ï¼Œ`Outer`ç±»è¢«ç¼–è¯‘ä¸º`Outer.class`ï¼Œè€Œ`Inner`ç±»è¢«ç¼–è¯‘ä¸º`Outer$Inner.class`ã€‚\n\n## Anonymous Class\n\né€šè¿‡[[åŒ¿åç±»]]ï¼ˆAnonymous Classï¼‰å®šä¹‰Inner Classã€‚\n\n```java\npublic class Main {\n    public static void main(String[] args) {\n        Outer outer = new Outer(\"Nested\");\n        outer.asyncHello();\n    }\n}\n\nclass Outer {\n    private String name;\n\n    Outer(String name) {\n        this.name = name;\n    }\n\n    void asyncHello() {\n\t    // å®ä¾‹åŒ–æ¥å£æ—¶ç›´æ¥\n        Runnable r = new Runnable() {\n            @Override\n            public void run() {\n                System.out.println(\"Hello, \" + Outer.this.name);\n            }\n        };\n        new Thread(r).start();\n    }\n}\n\n```\n\nè§‚å¯Ÿ`asyncHello()`æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨æ–¹æ³•å†…éƒ¨å®ä¾‹åŒ–äº†ä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/Runnable]]ã€‚`Runnable`æœ¬èº«æ˜¯[[æ¥å£]]ï¼Œæ¥å£æ˜¯ä¸èƒ½å®ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥è¿™é‡Œå®é™…ä¸Šæ˜¯å®šä¹‰äº†ä¸€ä¸ªå®ç°äº†`Runnable`æ¥å£çš„åŒ¿åç±»ï¼Œå¹¶ä¸”é€šè¿‡`new`å®ä¾‹åŒ–è¯¥åŒ¿åç±»ï¼Œç„¶åè½¬å‹ä¸º`Runnable`ã€‚åœ¨å®šä¹‰åŒ¿åç±»çš„æ—¶å€™å°±å¿…é¡»å®ä¾‹åŒ–å®ƒï¼Œå®šä¹‰åŒ¿åç±»çš„å†™æ³•å¦‚ä¸‹ï¼š\n\n```java\nRunnable r = new Runnable() {\n    // å®ç°å¿…è¦çš„æŠ½è±¡æ–¹æ³•...\n};\n```\n\nåŒ¿åç±»å’ŒInner Classä¸€æ ·ï¼Œå¯ä»¥è®¿é—®Outer Classçš„`private`å­—æ®µå’Œæ–¹æ³•ã€‚ä¹‹æ‰€ä»¥æˆ‘ä»¬è¦å®šä¹‰åŒ¿åç±»ï¼Œæ˜¯å› ä¸ºåœ¨è¿™é‡Œæˆ‘ä»¬é€šå¸¸ä¸å…³å¿ƒç±»åï¼Œæ¯”ç›´æ¥å®šä¹‰Inner Classå¯ä»¥å°‘å†™å¾ˆå¤šä»£ç ã€‚\n\nè§‚å¯ŸJavaç¼–è¯‘å™¨ç¼–è¯‘åçš„`.class`æ–‡ä»¶å¯ä»¥å‘ç°ï¼Œ`Outer`ç±»è¢«ç¼–è¯‘ä¸º`Outer.class`ï¼Œè€ŒåŒ¿åç±»è¢«ç¼–è¯‘ä¸º`Outer$1.class`ã€‚å¦‚æœæœ‰å¤šä¸ªåŒ¿åç±»ï¼ŒJavaç¼–è¯‘å™¨ä¼šå°†æ¯ä¸ªåŒ¿åç±»ä¾æ¬¡å‘½åä¸º`Outer$1`ã€`Outer$2`ã€`Outer$3`â€¦â€¦\né™¤äº†æ¥å£å¤–ï¼ŒåŒ¿åç±»ä¹Ÿå®Œå…¨å¯ä»¥ç»§æ‰¿è‡ªæ™®é€šç±»ã€‚è§‚å¯Ÿä»¥ä¸‹ä»£ç ï¼š\n\n```java\nimport java.util.HashMap;\n\npublic class Main {\n    public static void main(String[] args) {\n        HashMap\u003cString, String\u003e map1 = new HashMap\u003c\u003e();\n        HashMap\u003cString, String\u003e map2 = new HashMap\u003c\u003e() {}; // åŒ¿åç±»!\n        HashMap\u003cString, String\u003e map3 = new HashMap\u003c\u003e() {\n            {\n                put(\"A\", \"1\");\n                put(\"B\", \"2\");\n            }\n        };\n        System.out.println(map3.get(\"A\"));\n    }\n}\n```\n\n`map1`æ˜¯ä¸€ä¸ªæ™®é€šçš„`[[HashMap]]`å®ä¾‹ï¼Œä½†`map2`æ˜¯ä¸€ä¸ªåŒ¿åç±»å®ä¾‹ï¼Œåªæ˜¯è¯¥åŒ¿åç±»ç»§æ‰¿è‡ª`HashMap`ã€‚`map3`ä¹Ÿæ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª`HashMap`çš„åŒ¿åç±»å®ä¾‹ï¼Œå¹¶ä¸”æ·»åŠ äº†`static`ä»£ç å—æ¥åˆå§‹åŒ–æ•°æ®ã€‚è§‚å¯Ÿç¼–è¯‘è¾“å‡ºå¯å‘ç°`Main$1.class`å’Œ`Main$2.class`ä¸¤ä¸ªåŒ¿åç±»æ–‡ä»¶ã€‚\n\n## Static Nested Class\n\nä½¿ç”¨`static`ä¿®é¥°ï¼Œç§°ä¸ºé™æ€å†…éƒ¨ç±»ï¼ˆStatic Nested Classï¼‰ï¼š\n\n```java\npublic class Main {\n    public static void main(String[] args) {\n        Outer.StaticNested sn = new Outer.StaticNested();\n        sn.hello();\n    }\n}\n\nclass Outer {\n    private static String NAME = \"OUTER\";\n\n    private String name;\n\n    Outer(String name) {\n        this.name = name;\n    }\n\n    static class StaticNested {\n        void hello() {\n            System.out.println(\"Hello, \" + Outer.NAME);\n        }\n    }\n}\n\n```\n\nç”¨`static`ä¿®é¥°çš„å†…éƒ¨ç±»å’ŒInner Classæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå®ƒä¸å†ä¾é™„äº`Outer`çš„å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç±»ï¼Œå› æ­¤**æ— æ³•å¼•ç”¨`Outer.this`**ï¼Œä½†å®ƒ**å¯ä»¥è®¿é—®`Outer`çš„`private`é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•**ã€‚å¦‚æœæŠŠ`StaticNested`ç§»åˆ°`Outer`ä¹‹å¤–ï¼Œå°±å¤±å»äº†è®¿é—®`private`çš„æƒé™ã€‚\n\n## å°ç»“\n\nJavaçš„å†…éƒ¨ç±»å¯åˆ†ä¸º**Inner Class**ã€**Anonymous Class**å’Œ**Static Nested Class**ä¸‰ç§ï¼š\n\n* Inner Classå’ŒAnonymous Classæœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ï¼Œéƒ½å¿…é¡»ä¾é™„äºOuter Classçš„å®ä¾‹ï¼Œå³éšå«åœ°æŒæœ‰`Outer.this`å®ä¾‹ï¼Œå¹¶æ‹¥æœ‰Outer Classçš„`private`è®¿é—®æƒé™ï¼›\n    \n* Static Nested Classæ˜¯ç‹¬ç«‹ç±»ï¼Œä½†æ‹¥æœ‰Outer Classçš„`private`è®¿é—®æƒé™ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/0-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%BC%82%E5%B8%B8":{"title":"å¼‚å¸¸","content":"\n# å¼‚å¸¸\n\né€šå¸¸ï¼ŒJavaçš„å¼‚å¸¸(åŒ…æ‹¬Exceptionå’ŒError)åˆ†ä¸ºï¼š\n- æ£€æŸ¥å¼‚å¸¸ï¼ˆchecked exceptionsï¼‰\n- éæ£€æŸ¥çš„å¼‚å¸¸ï¼ˆunchecked exceptionsï¼‰ã€‚\nå…¶ä¸­æ ¹æ®Exceptionå¼‚å¸¸è¿›è¡Œåˆ’åˆ†ï¼Œå¯åˆ†ä¸ºï¼š\n- è¿è¡Œæ—¶å¼‚å¸¸\n- éè¿è¡Œæ—¶å¼‚å¸¸\n\n## æ£€æŸ¥å¼‚å¸¸\n\nå°±æ˜¯**ç¼–è¯‘å™¨**è¦æ±‚ä½ **å¿…é¡»**å¤„ç½®çš„å¼‚å¸¸ã€‚ä¸çŸ¥é“ä½ ç¼–ç¨‹çš„æ—¶å€™æœ‰æ²¡æœ‰é‡åˆ°è¿‡ï¼Œä½ å†™çš„æŸæ®µä»£ç ï¼Œç¼–è¯‘å™¨è¦æ±‚ä½ å¿…é¡»è¦å¯¹è¿™æ®µä»£ç try...catchï¼Œæˆ–è€…throws exceptionï¼Œå¦‚æœä½ é‡è§è¿‡ï¼Œæ²¡é”™ï¼Œè¿™å°±æ˜¯æ£€æŸ¥å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä»£ç è¿˜æ²¡è¿è¡Œå‘¢ï¼Œç¼–è¯‘å™¨å°±ä¼šæ£€æŸ¥ä½ çš„ä»£ç ï¼Œä¼šä¸ä¼šå‡ºç°å¼‚å¸¸ï¼Œè¦æ±‚ä½ å¯¹å¯èƒ½å‡ºç°çš„å¼‚å¸¸å¿…é¡»åšå‡ºç›¸åº”çš„å¤„ç†ã€‚\n\n### å¤„ç†\n\n1ã€ç»§ç»­æŠ›å‡ºï¼Œæ¶ˆæçš„æ–¹æ³•ï¼Œä¸€ç›´å¯ä»¥æŠ›åˆ°javaè™šæ‹Ÿæœºæ¥å¤„ç†ï¼Œå°±æ˜¯é€šè¿‡throws exceptionæŠ›å‡ºã€‚  \n2ã€ç”¨try...catchæ•è·  \næ³¨æ„ï¼Œå¯¹äºæ£€æŸ¥çš„å¼‚å¸¸å¿…é¡»å¤„ç†ï¼Œæˆ–è€…å¿…é¡»æ•è·æˆ–è€…å¿…é¡»æŠ›å‡º\n\n### åˆ†ç±»\n\né™¤äº†RuntimeExceptionä¸å…¶å­ç±»ï¼Œä»¥åŠé”™è¯¯ï¼ˆErrorï¼‰ï¼Œå…¶ä»–çš„éƒ½æ˜¯æ£€æŸ¥å¼‚å¸¸ï¼ˆç»å¯¹çš„å¤§å®¶æ—ï¼‰ã€‚\n\n## éæ£€æŸ¥å¼‚å¸¸\n\nç¼–è¯‘å™¨ä¸è¦æ±‚å¼ºåˆ¶å¤„ç½®çš„å¼‚å¸¸ï¼Œè™½ç„¶ä½ æœ‰å¯èƒ½å‡ºç°é”™è¯¯ï¼Œä½†æ˜¯æˆ‘ä¸ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥ï¼Œæ²¡å¿…è¦ï¼Œä¹Ÿä¸å¯èƒ½ã€‚\n\n### å¤„ç†\n\n1ã€æ•è·  \n2ã€ç»§ç»­æŠ›å‡º  \n3ã€ä¸å¤„ç†\n\nä¸€èˆ¬æˆ‘ä»¬æ˜¯ä¸å¤„ç†çš„ï¼Œå› ä¸ºä½ å¾ˆéš¾åˆ¤æ–­ä¼šå‡ºä»€ä¹ˆé—®é¢˜ï¼Œè€Œä¸”æœ‰äº›å¼‚å¸¸ä½ ä¹Ÿæ— æ³•è¿è¡Œæ—¶å¤„ç†ï¼Œæ¯”å¦‚ç©ºæŒ‡é’ˆï¼Œéœ€è¦äººæ‰‹åŠ¨çš„å»æŸ¥æ‰¾ã€‚\n\nè€Œä¸”ï¼Œæ•æ‰å¼‚å¸¸å¹¶å¤„ç†çš„ä»£ä»·è¿œè¿œå¤§äºç›´æ¥æŠ›å‡ºã€‚\n\n### ä¸ºä½•å­˜åœ¨\n\nä½ æƒ³æƒ³éæ£€æŸ¥å¼‚å¸¸éƒ½æœ‰å“ªäº›ï¼ŸNullPointerExceptionï¼ŒIndexOutOfBoundsExceptionï¼ŒVirtualMachineErrorç­‰ï¼Œè¿™äº›å¼‚å¸¸ä½ ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥å—ï¼Ÿå†è¯´äº†ï¼Œæ˜æ˜å¯ä»¥è¿è¡Œæ—¶æ£€æŸ¥ï¼Œéƒ½åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥ï¼Œä½ å†™çš„ä»£ç è¿˜èƒ½çœ‹å—ï¼Ÿè€Œä¸”æœ‰äº›å¼‚å¸¸åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½æ£€æŸ¥å‡ºæ¥ï¼Œæ¯”å¦‚ç©ºæŒ‡é’ˆï¼Œå †æº¢å‡ºç­‰ã€‚\n\n### åˆ†ç±»\n\nRuntimeExceptionä¸å…¶å­ç±»ï¼Œä»¥åŠé”™è¯¯ï¼ˆErrorï¼‰ã€‚\n\n## è¿è¡Œæ—¶å¼‚å¸¸\n\néƒ½æ˜¯**RuntimeExceptionç±»åŠå…¶å­ç±»**å¼‚å¸¸ï¼Œå¦‚NullPointerException(ç©ºæŒ‡é’ˆå¼‚å¸¸)ã€IndexOutOfBoundsException(ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸)ç­‰ï¼Œè¿™äº›å¼‚å¸¸æ˜¯**éæ£€æŸ¥**å¼‚å¸¸ï¼Œç¨‹åºä¸­å¯ä»¥é€‰æ‹©æ•è·å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä¸å¤„ç†ã€‚è¿™äº›å¼‚å¸¸ä¸€èˆ¬æ˜¯ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¼•èµ·çš„ï¼Œç¨‹åºåº”è¯¥ä»é€»è¾‘è§’åº¦å°½å¯èƒ½é¿å…è¿™ç±»å¼‚å¸¸çš„å‘ç”Ÿã€‚\n\nè¿è¡Œæ—¶å¼‚å¸¸çš„ç‰¹ç‚¹æ˜¯Javaç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥å®ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¨‹åºä¸­å¯èƒ½å‡ºç°è¿™ç±»å¼‚å¸¸ï¼Œå³ä½¿æ²¡æœ‰ç”¨try-catchè¯­å¥æ•è·å®ƒï¼Œä¹Ÿæ²¡æœ‰ç”¨throwså­å¥å£°æ˜æŠ›å‡ºå®ƒï¼Œä¹Ÿä¼šç¼–è¯‘é€šè¿‡ã€‚\n\n## éè¿è¡Œæ—¶å¼‚å¸¸\n\næ˜¯**RuntimeExceptionä»¥å¤–**çš„å¼‚å¸¸ï¼Œç±»å‹ä¸Šéƒ½å±äºExceptionç±»åŠå…¶å­ç±»ã€‚ä»ç¨‹åºè¯­æ³•è§’åº¦è®²æ˜¯**å¿…é¡»è¿›è¡Œå¤„ç†**çš„å¼‚å¸¸ï¼Œå¦‚æœä¸å¤„ç†ï¼Œç¨‹åºå°±ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚å¦‚IOExceptionã€SQLExceptionç­‰ä»¥åŠç”¨æˆ·è‡ªå®šä¹‰çš„Exceptionå¼‚å¸¸ï¼Œ**ä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦è‡ªå®šä¹‰æ£€æŸ¥å¼‚å¸¸**ã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/0-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E6%9E%9A%E4%B8%BE":{"title":"æšä¸¾","content":"# æšä¸¾\n\næšä¸¾æ˜¯ä¸€ä¸ªç±»ï¼Œå†…éƒ¨å†™è§„å®šäº†è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹ã€‚\n\n## ç”¨é€”\n\n### ç¼–è¯‘å™¨ç±»å‹æ£€æµ‹\n\nå’Œ`int`å®šä¹‰çš„å¸¸é‡ç›¸æ¯”ï¼Œä½¿ç”¨`enum`å®šä¹‰æšä¸¾æœ‰å¦‚ä¸‹å¥½å¤„ï¼š\n\né¦–å…ˆï¼Œ`enum`å¸¸é‡æœ¬èº«å¸¦æœ‰ç±»å‹ä¿¡æ¯ï¼Œå³`Weekday.SUN`ç±»å‹æ˜¯`Weekday`ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ£€æŸ¥å‡ºç±»å‹é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¯­å¥ä¸å¯èƒ½ç¼–è¯‘é€šè¿‡ï¼š\n\n```java\nint day = 1;\nif (day == Weekday.SUN) { // Compile error: bad operand types for binary operator '=='\n}\n```\n\nå…¶æ¬¡ï¼Œä¸å¯èƒ½å¼•ç”¨åˆ°éæšä¸¾çš„å€¼ï¼Œå› ä¸ºæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚\n\næœ€åï¼Œä¸åŒç±»å‹çš„æšä¸¾ä¸èƒ½äº’ç›¸æ¯”è¾ƒæˆ–è€…èµ‹å€¼ï¼Œå› ä¸ºç±»å‹ä¸ç¬¦ã€‚ä¾‹å¦‚ï¼Œä¸èƒ½ç»™ä¸€ä¸ª`Weekday`æšä¸¾ç±»å‹çš„å˜é‡èµ‹å€¼ä¸º`Color`æšä¸¾ç±»å‹çš„å€¼ï¼š\n\n```java\nWeekday x = Weekday.SUN; // ok!\nWeekday y = Color.RED; // Compile error: incompatible types\n```\n\nè¿™å°±ä½¿å¾—ç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘æœŸè‡ªåŠ¨æ£€æŸ¥å‡ºæ‰€æœ‰å¯èƒ½çš„æ½œåœ¨é”™è¯¯ã€‚\n\n## ç”¨æ³•\n\n### å€¼æ¯”è¾ƒ\n\nä½¿ç”¨`enum`å®šä¹‰çš„æšä¸¾ç±»æ˜¯ä¸€ç§å¼•ç”¨ç±»å‹ã€‚å‰é¢æˆ‘ä»¬è®²åˆ°ï¼Œå¼•ç”¨ç±»å‹æ¯”è¾ƒï¼Œè¦ä½¿ç”¨`equals()`æ–¹æ³•ï¼Œå¦‚æœä½¿ç”¨`==`æ¯”è¾ƒï¼Œå®ƒæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¼•ç”¨ç±»å‹çš„å˜é‡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚å› æ­¤ï¼Œå¼•ç”¨ç±»å‹æ¯”è¾ƒï¼Œè¦å§‹ç»ˆä½¿ç”¨`equals()`æ–¹æ³•ï¼Œä½†`enum`ç±»å‹å¯ä»¥ä¾‹å¤–ã€‚\n\nè¿™æ˜¯å› ä¸º`enum`ç±»å‹çš„æ¯ä¸ªå¸¸é‡åœ¨JVMä¸­åªæœ‰ä¸€ä¸ªå”¯ä¸€å®ä¾‹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨`==`æ¯”è¾ƒï¼š\n\n```java\nif (day == Weekday.FRI) { // ok!\n}\nif (day.equals(Weekday.SUN)) { // ok, but more code!\n}\n```\n\n### æ¨èç”¨æ³•\n\nå¦‚æœä¸å°å¿ƒä¿®æ”¹äº†æšä¸¾çš„é¡ºåºï¼Œç¼–è¯‘å™¨æ˜¯æ— æ³•æ£€æŸ¥å‡ºè¿™ç§é€»è¾‘é”™è¯¯çš„ã€‚è¦ç¼–å†™å¥å£®çš„ä»£ç ï¼Œå°±ä¸è¦ä¾é `ordinal()`çš„è¿”å›å€¼ã€‚å› ä¸º`enum`æœ¬èº«æ˜¯`class`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰`private`çš„æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”ï¼Œç»™æ¯ä¸ªæšä¸¾å¸¸é‡æ·»åŠ å­—æ®µï¼š\n```java\npublic class Main {\n    public static void main(String[] args) {\n        Weekday day = Weekday.SUN;\n        if (day.dayValue == 6 || day.dayValue == 0) {\n            System.out.println(\"Work at home!\");\n        } else {\n            System.out.println(\"Work at office!\");\n        }\n    }\n}\n\nenum Weekday {\n    MON(1), TUE(2), WED(3), THU(4), FRI(5), SAT(6), SUN(0);\n\n    public final int dayValue;\n\n    private Weekday(int dayValue) {\n        this.dayValue = dayValue;\n    }\n}\n\n```\n\n## æ€»ç»“\n\n- Javaä½¿ç”¨`enum`å®šä¹‰æšä¸¾ç±»å‹ï¼Œå®ƒè¢«ç¼–è¯‘å™¨ç¼–è¯‘ä¸º`final class Xxx extends Enum { â€¦ }`ï¼›\n- é€šè¿‡`name()`è·å–å¸¸é‡å®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œæ³¨æ„ä¸è¦ä½¿ç”¨`toString()`ï¼›\n- é€šè¿‡`ordinal()`è¿”å›å¸¸é‡å®šä¹‰çš„é¡ºåºï¼ˆæ— å®è´¨æ„ä¹‰ï¼‰ï¼›\n- å¯ä»¥ä¸º`enum`ç¼–å†™æ„é€ æ–¹æ³•ã€å­—æ®µå’Œæ–¹æ³•\n- `enum`çš„æ„é€ æ–¹æ³•è¦å£°æ˜ä¸º`private`ï¼Œå­—æ®µå¼ºçƒˆå»ºè®®å£°æ˜ä¸º`final`ï¼›\n- `enum`é€‚åˆç”¨åœ¨`switch`è¯­å¥ä¸­ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/0-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E6%B3%9B%E5%9E%8B":{"title":"æ³›å‹","content":"\n# æ³›å‹\n\n## ç±»å‹æ“¦é™¤\n\nä¸‹é¢çš„ä¾‹å­æ— æ³•ç¼–è¯‘é€šè¿‡ï¼š\n\n```java\n// generics/HasF.java\n\npublic class HasF {\npublic void f() {\nSystem.out.println(\"HasF.f()\");\n}\n}\n```\n\n```java\n// generics/Manipulation.java  \n// {WillNotCompile}  \n  \nclass Manipulator\u003cT\u003e {  \n    private T obj;  \n  \n    Manipulator(T x) {  \n        obj = x;  \n    }  \n  \n    // Error: cannot find symbol: method f():  \n    // ä¼ å…¥æ—¶ç±»å‹å°±æ“¦é™¤äº†ï¼Œobjç°åœ¨æ—¶Objectç±»å‹ï¼Œæ²¡æœ‰fæ–¹æ³•\n    public void manipulate() {  \n        obj.f();  \n    }  \n  \n}  \n  \npublic class Manipulation {  \n    public static void main(String[] args) {  \n        HasF hf = new HasF();  \n        // è¿™é‡Œåªåšäº†ä¼ å…¥çš„å¯¹è±¡æ˜¯å¦æœªHasFç±»å‹åˆ¤æ–­ï¼Œä¹‹åå°±æ“¦é™¤äº†ç±»å‹\n        Manipulator\u003cHasF\u003e manipulator = new Manipulator\u003c\u003e(hf);  \n        manipulator.manipulate();  \n    }  \n}\n```\n\nå› ä¸º`Manipulator\u003cHasF\u003e`è¿™é‡Œ`\u003cHasF\u003e`çš„ä½œç”¨åªæ˜¯å¯¹ç­‰å·å³è¾¹ä¼ å…¥çš„`new Manipulator\u003c\u003e(hf)`è¿›è¡Œäº†ç±»å‹æ£€æµ‹ï¼Œéšåå°±å°†å…¶ç±»å‹æ“¦é™¤ä¸ºObjcetã€‚åœ¨`manipulate()`æ–¹æ³•ä¸­ç¼–è¯‘å™¨åªçŸ¥é“objå¯¹è±¡æ˜¯ä¸ªObjectç±»å‹ï¼Œæ²¡æœ‰f()æ–¹æ³•ã€‚\n\n### ç»™å®šæ³›å‹è¾¹ç•Œ\n\nä¸ºäº†è°ƒç”¨ f()ï¼Œæˆ‘ä»¬å¿…é¡»ååŠ©æ³›å‹ç±»ï¼Œç»™å®š æ³›å‹ç±»ä¸€ä¸ªè¾¹ç•Œï¼Œä»¥æ­¤å‘Šè¯‰ç¼–è¯‘å™¨åªèƒ½æ¥å—éµå¾ªè¿™ä¸ªè¾¹ç•Œçš„ç±»å‹ã€‚è¿™é‡Œé‡ç”¨äº† extends å…³é”®å­—ã€‚ç”±äºæœ‰äº†è¾¹ç•Œï¼Œä¸‹é¢çš„ä»£ç å°±èƒ½é€šè¿‡ç¼–è¯‘ï¼š\n\n```java\npublic class Manipulator2\u003cT extends HasF\u003e {  \n    private T obj;  \n  \n    Manipulator2(T x) {  \n        obj = x;  \n    }  \n  \n    public void manipulate() {  \n        obj.f();  \n    }  \n  \n}\n```\n\nè¾¹ç•Œ `\u003cT extends HasF\u003e` å£°æ˜ T å¿…é¡»æ˜¯ HasF ç±»å‹æˆ–å…¶å­ç±»ã€‚å¦‚æœæƒ…å†µç¡®å®å¦‚æ­¤ï¼Œ å°±å¯ä»¥å®‰å…¨åœ°åœ¨ obj ä¸Šè°ƒç”¨ f() æ–¹æ³•ã€‚\n**æ³›å‹ç±»å‹å‚æ•°ä¼šæ“¦é™¤åˆ°å®ƒçš„ç¬¬ä¸€ä¸ªè¾¹ç•Œ**ï¼ˆå¯èƒ½æœ‰å¤šä¸ªè¾¹ç•Œï¼Œç¨åä½ å°†çœ‹åˆ°ï¼‰ã€‚\njavaè¿˜æåˆ°äº†ç±»å‹å‚æ•°çš„æ“¦é™¤ã€‚ç¼–è¯‘å™¨å®é™…ä¸Šä¼šæŠŠç±»å‹å‚æ•°æ›¿æ¢ä¸ºå®ƒçš„æ“¦é™¤è¾¹ç•Œï¼Œå°±åƒä¸Šé¢ çš„ç¤ºä¾‹ï¼ŒT æ“¦é™¤åˆ°äº† HasFï¼Œå°±åƒåœ¨ç±»çš„å£°æ˜ä¸­ç”¨ HasF æ›¿æ¢äº† T ä¸€æ ·ã€‚\n\n\u003e ä¾‹å¦‚ï¼Œ`List\u003cT\u003e` è¿™æ ·çš„ç±»å‹æ³¨è§£ä¼šè¢« æ“¦é™¤ä¸º Listï¼Œæ™®é€šçš„ç±»å‹å˜é‡åœ¨æœªæŒ‡å®šè¾¹ç•Œçš„æƒ…å†µä¸‹ä¼šè¢«æ“¦é™¤ä¸º Objectã€‚\n\n```java\n// generics/Manipulator3.java  \n  \nclass Manipulator3 {  \n    private HasF obj;  \n  \n    Manipulator3(HasF x) {  \n        obj = x;  \n    }  \n  \n    public void manipulate() {  \n        obj.f();  \n    }  \n}\n```\n\nè¿™æå‡ºäº†å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼šæ³›å‹åªæœ‰åœ¨ç±»å‹å‚æ•°æ¯”æŸä¸ªå…·ä½“ç±»å‹ï¼ˆä»¥åŠå…¶å­ç±»ï¼‰æ›´åŠ \nâ€œæ³›åŒ–â€â€”â€”ä»£ç èƒ½è·¨å¤šä¸ªç±»å·¥ä½œæ—¶æ‰æœ‰ç”¨ã€‚å› æ­¤ï¼Œç±»å‹å‚æ•°å’Œå®ƒä»¬åœ¨æœ‰ç”¨çš„æ³›å‹ä»£ç ä¸­\nçš„åº”ç”¨ï¼Œé€šå¸¸æ¯”ç®€å•çš„ç±»æ›¿æ¢æ›´åŠ å¤æ‚ã€‚ä½†æ˜¯ï¼Œä¸èƒ½å› æ­¤è®¤ä¸ºä½¿ç”¨ `\u003cT extends HasF\u003e`\nå½¢å¼å°±æ˜¯æœ‰ç¼ºé™·çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªç±»æœ‰ä¸€ä¸ªè¿”å› T çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæ³›å‹å°±æœ‰æ‰€å¸®åŠ©ï¼Œå› \nä¸ºå®ƒä»¬ä¹‹åå°†è¿”å›ç¡®åˆ‡çš„ç±»å‹ï¼š\n\n```java\n// generics/ReturnGenericType.java  \n  \npublic class ReturnGenericType\u003cT extends HasF\u003e {  \n    private T obj;  \n  \n    ReturnGenericType(T x) {  \n        obj = x;  \n    }  \n  \n    public T get() {  \n        return obj;  \n    }  \n  \n}\n```\n\n### ä»£ä»·\n\næ“¦é™¤çš„ä»£ä»·æ˜¯æ˜¾è‘—çš„ã€‚æ³›å‹ä¸èƒ½ç”¨äºæ˜¾å¼åœ°å¼•ç”¨è¿è¡Œæ—¶ç±»å‹çš„æ“ä½œä¸­ï¼Œä¾‹å¦‚è½¬å‹ã€ instanceof æ“ä½œå’Œ new è¡¨è¾¾å¼ã€‚å› ä¸ºæ‰€æœ‰å…³äºå‚æ•°çš„ç±»å‹ä¿¡æ¯éƒ½ä¸¢å¤±äº†ï¼Œå½“ä½ åœ¨ç¼–å†™ æ³›å‹ä»£ç æ—¶ï¼Œå¿…é¡»æ—¶åˆ»æé†’è‡ªå·±ï¼Œä½ åªæ˜¯çœ‹èµ·æ¥æ‹¥æœ‰æœ‰å…³å‚æ•°çš„ç±»å‹ä¿¡æ¯è€Œå·²ã€‚\nè€ƒè™‘å¦‚ä¸‹çš„ä»£ç æ®µï¼š\n\n```java\nclass Foo\u003cT\u003e {  \n    T var;  \n}\n```\n\n```java\nFoo\u003cCat\u003e f = new Foo\u003c\u003e();\n```\n\nçœ‹ä¸Šå»å½“ä½ åˆ›å»ºä¸€ä¸ª Foo å®ä¾‹æ—¶ï¼šclass Foo ä¸­çš„ä»£ç åº”è¯¥çŸ¥é“ç°åœ¨å·¥ä½œäº Cat ä¹‹ä¸Šã€‚æ³›å‹è¯­æ³•ä¹Ÿåœ¨å¼ºçƒˆæš—ç¤ºæ•´ä¸ªç±»ä¸­æ‰€æœ‰ T å‡ºç°çš„åœ°æ–¹éƒ½è¢«æ›¿æ¢ï¼Œå°±åƒåœ¨ C++ ä¸­ä¸€æ ·ã€‚ä½†æ˜¯äº‹å®å¹¶éå¦‚æ­¤ï¼Œå½“ä½ åœ¨ç¼–å†™è¿™ä¸ªç±»çš„ä»£ç æ—¶ï¼Œå¿…é¡»æé†’è‡ªå·±ï¼š\"ä¸ï¼Œè¿™åªæ˜¯ä¸€ä¸ª **Object**\"ã€‚\n\n### æ—¶æœº\n\næ³›å‹çš„æ‰€æœ‰åŠ¨ä½œéƒ½å‘ç”Ÿåœ¨è¾¹ ç•Œå¤„â€”â€”å¯¹å…¥å‚çš„ç¼–è¯‘å™¨æ£€æŸ¥å’Œå¯¹è¿”å›å€¼çš„è½¬å‹ã€‚è¿™æœ‰åŠ©äºæ¾„æ¸…å¯¹æ“¦é™¤çš„å›°æƒ‘ï¼Œè®°ä½ï¼š â€œè¾¹ç•Œå°±æ˜¯åŠ¨ä½œå‘ç”Ÿçš„åœ°æ–¹â€ã€‚\n\nå¯¹æ¯”æ³›å‹å’Œéæ³›å‹çš„ä¸¤æ®µä»£ç å¯¹åº”çš„å­—èŠ‚ç ï¼š\n\néæ³›å‹ï¼š\n\n```java\n// generics/SimpleHolder.java  \n  \npublic class SimpleHolder {  \n    private Object obj;  \n  \n    public void set(Object obj) {  \n        this.obj = obj;  \n    }  \n  \n    public Object get() {  \n        return obj;  \n    }  \n  \n    public static void main(String[] args) {  \n        SimpleHolder holder = new SimpleHolder();  \n        holder.set(\"Item\");  \n        // éœ€è¦æ‰‹åŠ¨ç±»å‹è½¬æ¢\n        String s = (String) holder.get();  \n    }  \n  \n}\n```\n\néæ³›å‹å­—èŠ‚ç ï¼š\n\n```java\npublic void set(java.lang.Object);  \n        0: aload_0  \n        1: aload_1  \n        2: putfield #2; // Field obj:Object;  \n        5: return  \n  \npublic java.lang.Object get();  \n        0: aload_0  \n        1: getfield #2; // Field obj:Object;  \n        4: areturn  \n  \npublic static void main(java.lang.String[]);  \n        0: new #3; // class SimpleHolder  \n        3: dup  \n        4: invokespecial #4; // Method \"\u003cinit\u003e\":()V  \n        7: astore_1  \n        8: aload_1  \n        9: ldc #5; // String Item  \n        11: invokevirtual #6; // Method set:(Object;)V  \n        14: aload_1  \n        15: invokevirtual #7; // Method get:()Object;  \n        18: checkcast #8; // class java/lang/String  \n        21: astore_2  \n        22: return\n```\n\næ³›å‹ï¼š\n\n```java\n// generics/GenericHolder2.java  \n  \npublic class GenericHolder2\u003cT\u003e {  \n    private T obj;  \n  \n    public void set(T obj) {  \n        this.obj = obj;  \n    }  \n  \n    public T get() {  \n        return obj;  \n    }  \n  \n    public static void main(String[] args) {  \n        GenericHolder2\u003cString\u003e holder = new GenericHolder2\u003c\u003e();  \n        holder.set(\"Item\"); \n        // ä½¿ç”¨äº†æ³›å‹ï¼Œè¿™é‡Œä¸ç”¨æ‰‹åŠ¨ç±»å‹è½¬æ¢äº† \n        String s = holder.get();  \n    }  \n  \n}\n```\n\næ³›å‹å­—èŠ‚ç ï¼š\n\n```java\npublic void set(java.lang.Object);  \n        0: aload_0  \n        1: aload_1  \n        2: putfield #2; // Field obj:Object;  \n        5: return  \n  \npublic java.lang.Object get();  \n        0: aload_0  \n        1: getfield #2; // Field obj:Object;  \n        4: areturn  \n  \npublic static void main(java.lang.String[]);  \n        0: new #3; // class GenericHolder2  \n        3: dup  \n        4: invokespecial #4; // Method \"\u003cinit\u003e\":()V  \n        7: astore_1  \n        8: aload_1  \n        9: ldc #5; // String Item  \n        11: invokevirtual #6; // Method set:(Object;)V  \n        14: aload_1  \n        15: invokevirtual #7; // Method get:()Object;  \n        18: checkcast #8; // class java/lang/String  \n        21: astore_2  \n        22: return\n```\n\nä¸¤ä¸ªä»£ç æ‰€äº§ç”Ÿçš„å­—èŠ‚ç æ˜¯ç›¸åŒçš„ã€‚\nå¯¹è¿›å…¥ set() çš„ç±»å‹è¿›è¡Œæ£€æŸ¥æ˜¯ä¸éœ€è¦çš„ï¼Œå› ä¸ºè¿™å°†ç”±ç¼–è¯‘å™¨æ‰§è¡Œã€‚è€Œå¯¹ get() è¿”å›çš„å€¼è¿›è¡Œè½¬å‹ä»ç„¶æ˜¯éœ€è¦çš„ï¼Œåªä¸è¿‡ä¸éœ€è¦ä½ æ¥æ“ä½œï¼Œå®ƒç”±**ç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥**ã€‚\nget() å’Œ set() äº§ç”Ÿäº†ç›¸åŒçš„å­—èŠ‚ç ï¼Œè¿™å°±å‘Šè¯‰æˆ‘ä»¬æ³›å‹çš„æ‰€æœ‰åŠ¨ä½œéƒ½å‘ç”Ÿåœ¨è¾¹ ç•Œå¤„â€”â€”å¯¹å…¥å‚çš„ç¼–è¯‘å™¨æ£€æŸ¥å’Œå¯¹è¿”å›å€¼çš„è½¬å‹ã€‚è¿™æœ‰åŠ©äºæ¾„æ¸…å¯¹æ“¦é™¤çš„å›°æƒ‘ï¼Œè®°ä½ï¼š â€œè¾¹ç•Œå°±æ˜¯åŠ¨ä½œå‘ç”Ÿçš„åœ°æ–¹â€ã€‚\n\n## è¾¹ç•Œ\n\nç”±äºæ“¦é™¤ä¼šåˆ é™¤ç±»å‹ä¿¡æ¯ï¼Œå› æ­¤å”¯ä¸€å¯ç”¨äºæ— é™åˆ¶æ³›å‹å‚æ•°çš„æ–¹æ³•æ˜¯é‚£äº› Object å¯ç”¨çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†è¯¥å‚æ•°é™åˆ¶ä¸ºæŸç±»å‹çš„å­é›†ï¼Œåˆ™å¯ä»¥è°ƒç”¨è¯¥å­é›†ä¸­çš„æ–¹æ³•ã€‚\nä¸ºäº†åº”ç”¨çº¦æŸï¼ŒJava æ³›å‹ä½¿ç”¨äº† extends å…³é”®å­—ã€‚\n\n## æ•°ç»„åå˜\n\nåœ¨äº†è§£é€šé…ç¬¦ä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹æ•°ç»„ã€‚Java ä¸­çš„æ•°ç»„æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/åå˜|åå˜]]çš„ï¼Œä»€ä¹ˆæ„æ€ï¼Ÿçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```java\nclass Fruit {}\nclass Apple extends Fruit {}\nclass Jonathan extends Apple {}\nclass Orange extends Fruit {}\n\npublic class CovariantArrays {\n    public static void main(String[] args) {       \n        Fruit[] fruit = new Apple[10];\n        fruit[0] = new Apple(); // OK\n        fruit[1] = new Jonathan(); // OK\n        // Runtime type is Apple[], not Fruit[] or Orange[]:\n        try {\n            // Compiler allows you to add Fruit:\n            fruit[0] = new Fruit(); // ArrayStoreException\n        } catch(Exception e) { System.out.println(e); }\n        try {\n            // Compiler allows you to add Oranges:\n            fruit[0] = new Orange(); // ArrayStoreException\n        } catch(Exception e) { System.out.println(e); }\n        }\n} /* Output:\njava.lang.ArrayStoreException: Fruit\njava.lang.ArrayStoreException: Orange\n*///:~\n```\n\n`main` æ–¹æ³•ä¸­çš„ç¬¬ä¸€è¡Œï¼Œåˆ›å»ºäº†ä¸€ä¸ª `Apple` æ•°ç»„å¹¶æŠŠå®ƒèµ‹ç»™ `Fruit` æ•°ç»„çš„å¼•ç”¨ã€‚è¿™æ˜¯æœ‰æ„ä¹‰çš„ï¼Œ`Apple` æ˜¯ `Fruit` çš„å­ç±»ï¼Œä¸€ä¸ª `Apple` å¯¹è±¡ä¹Ÿæ˜¯ä¸€ç§ `Fruit` å¯¹è±¡ï¼Œæ‰€ä»¥ä¸€ä¸ª `Apple` æ•°ç»„ä¹Ÿæ˜¯ä¸€ç§ `Fruit` çš„æ•°ç»„ã€‚è¿™ç§°ä½œ**æ•°ç»„çš„åå˜**ï¼ŒJava æŠŠæ•°ç»„è®¾è®¡ä¸ºåå˜çš„ï¼Œå¯¹æ­¤æ˜¯æœ‰äº‰è®®çš„ï¼Œæœ‰äººè®¤ä¸ºè¿™æ˜¯ä¸€ç§ç¼ºé™·ã€‚\n\nå°½ç®¡ `Apple[]` å¯ä»¥ â€œå‘ä¸Šè½¬å‹â€ ä¸º `Fruit[]`ï¼Œä½†æ•°ç»„å…ƒç´ çš„å®é™…ç±»å‹è¿˜æ˜¯ `Apple`ï¼Œæˆ‘ä»¬åªèƒ½å‘æ•°ç»„ä¸­æ”¾å…¥ `Apple`æˆ–è€… `Apple` çš„å­ç±»ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå‘æ•°ç»„ä¸­æ”¾å…¥äº† `Fruit` å¯¹è±¡å’Œ `Orange` å¯¹è±¡ã€‚å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œè¿™æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶æœŸï¼ŒJVM èƒ½å¤ŸçŸ¥é“æ•°ç»„çš„å®é™…ç±»å‹æ˜¯ `Apple[]`ï¼Œæ‰€ä»¥å½“å…¶å®ƒå¯¹è±¡åŠ å…¥æ•°ç»„çš„æ—¶å€™å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\n\næ³›å‹è®¾è®¡çš„ç›®çš„ä¹‹ä¸€æ˜¯è¦ä½¿è¿™ç§è¿è¡Œæ—¶æœŸçš„é”™è¯¯åœ¨ç¼–è¯‘æœŸå°±èƒ½å‘ç°ï¼Œçœ‹çœ‹ç”¨æ³›å‹å®¹å™¨ç±»æ¥ä»£æ›¿æ•°ç»„ä¼šå‘ç”Ÿä»€ä¹ˆï¼š\n\n```java\n// Compile Error: incompatible types:\nArrayList\u003cFruit\u003e flist = new ArrayList\u003cApple\u003e();\n\n```\n\nä¸Šé¢çš„ä»£ç æ ¹æœ¬å°±æ— æ³•ç¼–è¯‘ã€‚å½“æ¶‰åŠåˆ°æ³›å‹æ—¶ï¼Œ å°½ç®¡ `Apple` æ˜¯ `Fruit` çš„å­ç±»å‹ï¼Œä½†æ˜¯ `ArrayList\u003cApple\u003e` ä¸æ˜¯ `ArrayList\u003cFruit\u003e` çš„å­ç±»å‹ï¼Œæ³›å‹ä¸æ”¯æŒåå˜ã€‚\n\n## é€šé…ç¬¦\n\nä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“ï¼Œ`List\u003cNumber\u003e list = ArrayList\u003cInteger\u003e` è¿™æ ·çš„è¯­å¥æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ï¼Œå°½ç®¡ `Integer` æ˜¯ `Number` çš„å­ç±»å‹ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç¡®å®éœ€è¦å»ºç«‹è¿™ç§ â€œå‘ä¸Šè½¬å‹â€ çš„å…³ç³»æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™å°±éœ€è¦é€šé…ç¬¦æ¥å‘æŒ¥ä½œç”¨äº†ã€‚\n\n### ä¸Šè¾¹ç•Œ\n\n\u003e æ‰€æœ‰å¯¹è±¡éƒ½å½“ä½œæ˜¯T\n\u003e ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†æ³›å‹æ–¹æ³•çš„è¿”å›å€¼ï¼Œè¿”å›çš„ä¸œè¥¿å½“ä½œæ˜¯Tç±»å‹å¯¹å¾…\n\nåˆ©ç”¨ `\u003c? extends Fruit\u003e` å½¢å¼çš„é€šé…ç¬¦ï¼Œå¯ä»¥å®ç°æ³›å‹çš„å‘ä¸Šè½¬å‹ï¼š\n\n```java\npublic class GenericsAndCovariance {\n    public static void main(String[] args) {\n        // Wildcards allow covariance:\n        List\u003c? extends Fruit\u003e flist = new ArrayList\u003cApple\u003e();\n        // Compile Error: canâ€™t add any type of object:\n        // flist.add(new Apple());\n        // flist.add(new Fruit());\n        // flist.add(new Object());\n        flist.add(null); // Legal but uninteresting\n        // We know that it returns at least Fruit:\n        Fruit f = flist.get(0);\n    }\n}\n```\n\n`flist` çš„ç±»å‹å¯ä»¥çœ‹ä½œæ˜¯List\u003cæŸä¸ªç»§æ‰¿äº†Fruitçš„ç±»å‹\u003eã€‚\næ³¨æ„ä¸æ˜¯æŒ‡è¿™ä¸ªlisté‡Œå¯ä»¥**åŒæ—¶**æ”¾ä¸åŒçš„Fruitå­ç±»ï¼Œè€Œæ˜¯æŒ‡flistå¯ä»¥æŒ‡å‘æŒ‡å®šè¾¹ç•Œå†…çš„List\u003c\u003eå¯¹è±¡ã€‚\n\næ— æ³•ä¼ é€’å¯¹è±¡äº†ï¼šåŠ äº†ç•Œé™ï¼Œä½†åˆä¸å®Œå…¨ç¡®å®šåˆ°åº•æ˜¯å“ªä¸ªå…·ä½“ç±»ï¼Œå¯¼è‡´æ— æ³•å‘å…¶ä¸­æ·»åŠ ä»»æ„å…ƒç´ ï¼Œç”šè‡³Objectéƒ½ä¸å¯ä»¥ï¼Œåªèƒ½æ·»åŠ nullã€‚\n\n### ä¸‹è¾¹ç•Œ\n\n\u003e æ‰€æœ‰å¯¹è±¡èµ·ç æ˜¯ä¸ªT\n\u003e ä¸»è¦æ˜¯å¤„ç†å‘æ³›å‹æ–¹æ³•ä¼ é€’å‚æ•°ï¼Œæ‰€æœ‰ä¼ å…¥çš„å¯¹è±¡èµ·ç æ˜¯ä¸ªTï¼Œæˆ–è€…æ˜¯Tçš„å­ç±»ã€‚\n\n\u003e è¶…ç±»å‹é€šé…ç¬¦ã€‚\n\u003e é€†å˜ã€‚\n\né€šé…ç¬¦çš„å¦ä¸€ä¸ªæ–¹å‘æ˜¯ã€€â€œè¶…ç±»å‹çš„é€šé…ç¬¦â€œ: `? super T`ï¼Œ`T` æ˜¯ç±»å‹å‚æ•°çš„ä¸‹ç•Œã€‚ä½¿ç”¨è¿™ç§å½¢å¼çš„é€šé…ç¬¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥ â€ä¼ é€’å¯¹è±¡â€ äº†ã€‚è¿˜æ˜¯ç”¨ä¾‹å­è§£é‡Šï¼š\n\n```java\npublic class SuperTypeWildcards {\n    static void writeTo(List\u003c? super Apple\u003e apples) {\n        apples.add(new Apple());\n        apples.add(new Jonathan());\n        // apples.add(new Fruit()); // Error\n    }\n}\n```\n\n`writeTo` æ–¹æ³•çš„å‚æ•° `apples` çš„ç±»å‹æ˜¯ `List\u003c? super Apple\u003e`ï¼Œå®ƒè¡¨ç¤ºæŸç§ç±»å‹çš„ Listï¼Œæˆ‘ä»¬ä¸çŸ¥é“å®é™…ç±»å‹æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯è¿™ä¸ªç±»å‹è‚¯å®šæ˜¯ `Apple` çš„çˆ¶ç±»å‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å‘è¿™ä¸ª List æ·»åŠ ä¸€ä¸ª `Apple` æˆ–è€…å…¶å­ç±»å‹çš„å¯¹è±¡æ˜¯å®‰å…¨çš„ï¼Œè¿™äº›å¯¹è±¡éƒ½å¯ä»¥**å‘ä¸Š**è½¬å‹ä¸º `Apple`ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“åŠ å…¥ `Fruit` å¯¹è±¡æ˜¯å¦å®‰å…¨ï¼Œå› ä¸ºé‚£æ ·ä¼šä½¿å¾—è¿™ä¸ª List æ·»åŠ è·Ÿ `Apple` æ— å…³çš„ç±»å‹ã€‚\n\n### åˆ©ç”¨ä¸Šä¸‹è¾¹ç•Œé¢å‘æ³›å‹ç±»å‹è¿›è¡Œè¯»å–å’Œå†™å…¥\n\nå¦‚ä½•å‘æ³›å‹ç±»å‹ä¸­ â€œå†™å…¥â€ ( ä¼ é€’å¯¹è±¡ç»™æ–¹æ³•å‚æ•°) ä»¥åŠå¦‚ä½•ä»æ³›å‹ç±»å‹ä¸­ â€œè¯»å–â€ ( ä»æ–¹æ³•ä¸­è¿”å›å¯¹è±¡ )ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\n\n```java\npublic class Collections { \n  public static \u003cT\u003e void copy(List\u003c? super T\u003e dest, List\u003c? extends T\u003e src) \n  {\n      for (int i=0; i\u003csrc.size(); i++) \n        dest.set(i,src.get(i)); \n  } \n}\n```\n\n`src` æ˜¯åŸå§‹æ•°æ®çš„ Listï¼Œå› ä¸ºè¦ä»è¿™é‡Œé¢è¯»å–æ•°æ®ï¼Œæ‰€ä»¥ç”¨äº†ä¸Šè¾¹ç•Œé™å®šé€šé…ç¬¦ï¼š`\u003c? extends T\u003e`ï¼Œå–å‡ºçš„å…ƒç´ è½¬å‹ä¸º `T`ã€‚`dest` æ˜¯è¦å†™å…¥çš„ç›®æ ‡ Listï¼Œæ‰€ä»¥ç”¨äº†ä¸‹è¾¹ç•Œé™å®šé€šé…ç¬¦ï¼š`\u003c? super T\u003e`ï¼Œå¯ä»¥å†™å…¥çš„å…ƒç´ ç±»å‹æ˜¯ `T` åŠå…¶å­ç±»å‹ã€‚\n\n### æ— è¾¹ç•Œ\n\nè¿˜æœ‰ä¸€ç§é€šé…ç¬¦æ˜¯æ— è¾¹ç•Œé€šé…ç¬¦ï¼Œå®ƒçš„ä½¿ç”¨å½¢å¼æ˜¯ä¸€ä¸ªå•ç‹¬çš„é—®å·ï¼š`List\u003c?\u003e`ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä»»ä½•é™å®šã€‚ä¸åšä»»ä½•é™åˆ¶ï¼Œå’Œ`\u003c? extends Object\u003e`æ•ˆæœä¸€æ ·ã€‚\n\nè·Ÿä¸ç”¨ç±»å‹å‚æ•°çš„ `List` æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\n`List\u003c?\u003e list` è¡¨ç¤º `list` æ˜¯æŒæœ‰æŸç§ç‰¹å®šç±»å‹çš„ Listï¼Œä½†æ˜¯ä¸çŸ¥é“å…·ä½“æ˜¯å“ªç§ç±»å‹ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å‘å…¶ä¸­æ·»åŠ å¯¹è±¡å—ï¼Ÿå½“ç„¶**ä¸å¯ä»¥**ï¼Œå› ä¸ºå¹¶ä¸çŸ¥é“å®é™…æ˜¯å“ªç§ç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½æ·»åŠ ä»»ä½•ç±»å‹ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„ã€‚\nè€Œå•ç‹¬çš„ `List list` ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä¼ å…¥æ³›å‹å‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ª list æŒæœ‰çš„å…ƒç´ çš„ç±»å‹æ˜¯ `Object`ï¼Œå› æ­¤**å¯ä»¥**æ·»åŠ ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œåªä¸è¿‡ç¼–è¯‘å™¨ä¼šæœ‰è­¦å‘Šä¿¡æ¯ã€‚\n\n\u003e List`\u003c?\u003e`é‡Œé¢çš„å…ƒç´ ï¼Œå¦‚æœä½ å–å‡ºæ¥ï¼Œä¼šéƒ½è¢«è½¬åŒ–ä¸ºObjectã€‚\n\u003e åŠ äº†`\u003c?\u003e`é‚£ä¹ˆä¼šæŠŠè¿”å›å€¼è‡ªåŠ¨è½¬æ¢ä¸ºObjectã€‚\n\u003e ä¸åŠ åˆ™éœ€è¦è‡ªå·±æ‰‹åŠ¨è½¬æ¢ã€‚\n\n## æ€»ç»“\n\né€šé…ç¬¦çš„ä½¿ç”¨å¯ä»¥å¯¹æ³›å‹å‚æ•°åšå‡ºæŸäº›é™åˆ¶ï¼Œä½¿ä»£ç æ›´å®‰å…¨ï¼Œå¯¹äºä¸Šè¾¹ç•Œå’Œä¸‹è¾¹ç•Œé™å®šçš„é€šé…ç¬¦æ€»ç»“å¦‚ä¸‹ï¼š\n\n- ä½¿ç”¨ `List\u003c? extends C\u003e list` è¿™ç§å½¢å¼ï¼Œè¡¨ç¤º list å¯ä»¥å¼•ç”¨ä¸€ä¸ª `ArrayList` ( æˆ–è€…å…¶å®ƒ List çš„ å­ç±» ) çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«çš„å…ƒç´ ç±»å‹æ˜¯ `C` çš„å­ç±»å‹ ( åŒ…å« `C` æœ¬èº«ï¼‰çš„ä¸€ç§ã€‚\n- ä½¿ç”¨ `List\u003c? super C\u003e list` è¿™ç§å½¢å¼ï¼Œè¡¨ç¤º list å¯ä»¥å¼•ç”¨ä¸€ä¸ª `ArrayList` ( æˆ–è€…å…¶å®ƒ List çš„ å­ç±» ) çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«çš„å…ƒç´ å°±ç±»å‹æ˜¯ `C` çš„è¶…ç±»å‹ ( åŒ…å« `C` æœ¬èº« ) çš„ä¸€ç§ã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/0-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E7%AC%A6":{"title":"è®¿é—®æ§åˆ¶ç¬¦","content":"# è®¿é—®æ§åˆ¶ç¬¦\n\n![[z-oblib/z2-attachments/v2-315cda6274202d57b75be7641eba442f_1440w.png]]\n\n## public\n\n- å¯ä»¥è¢«æ‰€æœ‰å…¶å®ƒç±»è®¿é—®ã€‚\n\n## private\n\n- åªèƒ½è¢«è‡ªå·±è®¿é—®ã€‚\n\n## protected\n\n- åªèƒ½è¢«è‡ªèº«ã€å­ç±»ã€åŒå±ä¸€ä¸ªåŒ…çš„å…¶ä»–ç±»è®¿é—®ã€‚\n\t- åœ¨åŒä¸€ä¸ªåŒ…ç›¸å½“äºpublicã€‚\n\n## default\n\n- é»˜è®¤ä¿®é¥°ç¬¦ï¼ˆfriendlyï¼‰ã€‚\n- åªèƒ½è¢«è‡ªèº«ã€åŒå±ä¸€ä¸ªåŒ…çš„å…¶ä»–ç±»è®¿é—®ã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/0-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/final":{"title":"final","content":"# final\n\n\u003e finalæ˜¯å¯è¢«ç»§æ‰¿çš„ï¼Œè¿™ç‚¹å’Œstaticä¸åŒã€‚\n\n## ä¿®é¥°ç±»\n\n**ä¸å¯ç»§æ‰¿**\n\nå½“ç”¨finalä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç±»ä½ æ°¸è¿œä¸ä¼šè®©ä»–è¢«ç»§æ‰¿ï¼Œå°±å¯ä»¥ç”¨finalè¿›è¡Œä¿®é¥°ã€‚finalç±»ä¸­çš„æˆå‘˜å˜é‡å¯ä»¥æ ¹æ®éœ€è¦è®¾ä¸ºfinalï¼Œä½†æ˜¯è¦æ³¨æ„finalç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸ºfinalæ–¹æ³•ã€‚\n\n## ä¿®é¥°æ–¹æ³•\n\n**ä¸å¯é‡å†™**\n\n\u003eä½¿ç”¨finalæ–¹æ³•çš„åŸå› æœ‰ä¸¤ä¸ªã€‚ç¬¬ä¸€ä¸ªåŸå› æ˜¯æŠŠæ–¹æ³•é”å®šï¼Œä»¥é˜²ä»»ä½•ç»§æ‰¿ç±»ä¿®æ”¹å®ƒçš„å«ä¹‰ï¼›ç¬¬äºŒä¸ªåŸå› æ˜¯æ•ˆç‡ã€‚åœ¨æ—©æœŸçš„Javaå®ç°ç‰ˆæœ¬ä¸­ï¼Œä¼šå°†finalæ–¹æ³•è½¬ä¸ºå†…åµŒè°ƒç”¨ã€‚ä½†æ˜¯å¦‚æœæ–¹æ³•è¿‡äºåºå¤§ï¼Œå¯èƒ½çœ‹ä¸åˆ°å†…åµŒè°ƒç”¨å¸¦æ¥çš„ä»»ä½•æ€§èƒ½æå‡ã€‚åœ¨æœ€è¿‘çš„Javaç‰ˆæœ¬ä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨finalæ–¹æ³•è¿›è¡Œè¿™äº›ä¼˜åŒ–äº†ã€‚\n\u003e--æ‘˜è‡ªã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ç¬¬å››ç‰ˆç¬¬143é¡µ\n\n- å¦‚æœåªæœ‰åœ¨æƒ³æ˜ç¡®ç¦æ­¢ è¯¥æ–¹æ³•åœ¨å­ç±»ä¸­è¢«è¦†ç›–çš„æƒ…å†µä¸‹æ‰å°†æ–¹æ³•è®¾ç½®ä¸ºfinalçš„ã€‚\n- ç±»çš„privateæ–¹æ³•ä¼šéšå¼åœ°è¢«æŒ‡å®šä¸ºfinalæ–¹æ³•ã€‚\n\n## ä¿®é¥°å˜é‡\n\n**ä¸å¯å˜**\n\n- å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œåˆ™å…¶æ•°å€¼ä¸€æ—¦åœ¨åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½æ›´æ”¹\n- å¦‚æœæ˜¯å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåˆ™åœ¨å¯¹å…¶åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½å†è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚\n\nä½†æ˜¯å’Œstaticä¸åŒï¼Œfinalåœ¨å£°æ˜æ—¶ä¸è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†æ˜¯åç»­åªèƒ½ç»™ç»™æœªåˆå§‹åŒ–çš„finalå˜é‡èµ‹å€¼ä¸€æ¬¡ã€‚å†æ¬¡èµ‹å€¼ä¼šæŠ¥é”™ã€‚\n\n\n## åŸç†\n\n```java\npublic class TestFinal {\n    final int a = 20;\n}\n```\n\nå­—èŠ‚ç ï¼š\n\n```java\n0: aload_0\n1: invokespecial #1                  // Method java/lang/Object.\"\u003cinit\u003e\":()V\n4: aload_0\n5: bipush        20\n7: putfield      #2                  // Field a:I\n    \u003c-- å†™å±éšœ\n10: return\n```\n\nå‘ç° ï¬nal å˜é‡çš„èµ‹å€¼ä¹Ÿä¼šé€šè¿‡ putï¬eld æŒ‡ä»¤æ¥å®Œæˆï¼ŒåŒæ ·åœ¨è¿™æ¡æŒ‡ä»¤ä¹‹åä¹Ÿä¼šåŠ å…¥å†™å±éšœï¼Œä¿è¯åœ¨å…¶å®ƒçº¿ç¨‹è¯»åˆ° å®ƒçš„å€¼æ—¶ä¸ä¼šå‡ºç°ä¸º 0 çš„æƒ…å†µ\n\n### è®¾ç½®final\n\nç†è§£äº† volatile åŸç†ï¼Œå†å¯¹æ¯” ï¬nal çš„å®ç°å°±æ¯”è¾ƒç®€å•äº†\n\n### è·å–final\n\n\nstaticå˜é‡çš„è¯»å–ä¼šç”¨getstaticè®¿é—®å…±äº«å†…å­˜\nè€Œfinal staticå˜é‡çš„è¯»å–ï¼Œä¼šæŠŠå€¼èµ‹å€¼ä¸€ä»½ï¼Œé¿å…å…±äº«ï¼š\n- å˜é‡è¾ƒå°åˆ™èµ‹å¤åˆ¶åˆ°å½“å‰çº¿ç¨‹çš„æ ˆç©ºé—´ã€‚\n- å˜é‡è¾ƒå¤§åˆ™å¤åˆ¶åˆ°å¸¸é‡åŒºã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/0-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/static":{"title":"static","content":"# static\n\nçˆ¶ç±»çš„privateæˆå‘˜æ–¹æ³•æ˜¯ä¸èƒ½è¢«å­ç±»æ–¹æ³•è¦†ç›–çš„ï¼Œå› æ­¤privateç±»å‹çš„æ–¹æ³•é»˜è®¤æ˜¯finalç±»å‹çš„ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E7%AE%97%E6%B3%95":{"title":"ä¸‰è‰²æ ‡è®°ç®—æ³•","content":"# ä¸‰è‰²æ ‡è®°ç®—æ³•\n\n## è§£å†³çš„é—®é¢˜\n\nCMSåƒåœ¾å›æ”¶æœºåˆ¶ä¸‹ï¼Œå¯¹è±¡æ ‡è®°çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œç”¨æˆ·çº¿ç¨‹ä¼šå½±å“æ ‡è®°å‡†ç¡®åº¦ï¼Œå¯¼è‡´ï¼š\n1. æµ®æ¸¸åƒåœ¾é—®é¢˜\n\t1. è¯¥é—®é¢˜ä¸åŒç‰¹åˆ«åœ¨æ„ï¼Œå› ä¸ºæµ®åŠ¨åƒåœ¾ä¼šåœ¨ä¸‹æ¬¡GCæ—¶è¢«æ¸…ç†ã€‚\n2. é”™è¯¯å›æ”¶é—®é¢˜\n\t1. è¯¥é—®é¢˜è¦ç‰¹åˆ«åœ¨æ„ï¼Œå› ä¸ºå›æ”¶äº†ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡æ˜¯ä¸¥é‡çš„BUGã€‚\n\n## è§£å†³æ€è·¯\n\né€šè¿‡å¹¿åº¦ä¼˜å…ˆç®—æ³•æ‰«ægcæ ‘ä¸Šçš„èŠ‚ç‚¹ï¼Œå¹¶ç”¨é»‘è‰²æ ‡è®°å·²ç»æ‰«æå®Œæˆçš„èŠ‚ç‚¹ï¼Œç°è‰²æ ‡è®°æ­£åœ¨æ‰«æçš„èŠ‚ç‚¹ï¼Œç™½çš„æœªæ‰«æçš„èŠ‚ç‚¹ï¼Œè¾¾åˆ°æ€§è´¨ï¼š\n1. é»‘è‰²èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½åº”è¯¥æ˜¯ç°è‰²èŠ‚ç‚¹ã€‚\n2. æ‰€æœ‰ç™½è‰²èŠ‚ç‚¹éƒ½æ˜¯åƒåœ¾ã€‚\n\nå› ä¸º**é»‘è‰²èŠ‚ç‚¹æ˜¯å·²ç»æ‰«æå®Œæˆçš„ï¼Œä¸ä¼šå†å¤„ç†**ï¼Œæ‰€ä»¥è‹¥ç”¨æˆ·çº¿ç¨‹æŠŠç™½è‰²èŠ‚ç‚¹æ¥å…¥é»‘è‰²èŠ‚ç‚¹å°±ä¼šäº§ç”Ÿé”™è¯¯ï¼šè¯¥ç™½è‰²èŠ‚ç‚¹ä¸åº”è¯¥è¢«å›æ”¶ä½†ä¸ä¼šå†å˜è‰²äº†ã€‚\n\n## é—®é¢˜äº§ç”Ÿæ¡ä»¶\n\næˆ‘ä»¬å°†ç”¨æˆ·çº¿ç¨‹é’ˆå¯¹å¯¹è±¡å¼•ç”¨çš„æ“ä½œæˆä¸ºèµ‹å€¼ï¼ˆä¿®æ”¹åº”ç”¨æˆ–è€…ç½®nullï¼‰ï¼Œåˆ™æœ‰ï¼š\n1. èµ‹å€¼å™¨æ’å…¥äº†è‹¥å¹²æ¡ **é»‘è‰² --\u003e ç™½è‰²** çš„æ–°å¼•ç”¨ã€‚\n2. èµ‹å€¼å™¨åˆ é™¤äº†é’ˆå¯¹æŸç™½è‰²èŠ‚ç‚¹çš„æ‰€æœ‰ **ç°è‰² --\u003e ç™½è‰²** çš„å¼•ç”¨ã€‚\n\t1. å¯èƒ½è¯¥ç™½è‰²èŠ‚ç‚¹å°±æ˜¯åƒåœ¾ã€‚\n\t2. èµ‹å€¼å™¨å¯èƒ½æ¥ä¸‹æ¥ä¼šæŠŠç™½è‰²èŠ‚ç‚¹æ¥å…¥é»‘è‰²èŠ‚ç‚¹ï¼Œè¿›å…¥æƒ…å†µ1ã€‚\n\n## è§£å†³æ–¹æ¡ˆ\n\nåªè¦æ‰“ç ´ä¸Šè¿°ä¸¤ç§æƒ…å†µçš„ä»»æ„ä¸€ç§å³å¯ï¼Œåˆ™å¯¹åº”æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š\n\n### å¢é‡æ›´æ–°\n\né€šè¿‡â€œå†™å±éšœâ€ï¼ˆç±»ä¼¼AOPï¼‰ï¼Œè®°å½•ç”¨æˆ·å°†ç™½è‰²èŠ‚ç‚¹é“¾åˆ°é»‘è‰²èŠ‚ç‚¹çš„æ“ä½œã€‚é‡æ–°æ ‡è®°é˜¶æ®µå°±ä¼šæ ¹æ®è¯¥è®°å½•ä»¥è¿™éƒ¨åˆ†é»‘è‰²èŠ‚ç‚¹ä¸ºæ ¹å†æ‰«æä¸€æ¬¡ã€‚\n\n### åŸå§‹å¿«ç…§\n\nåœ¨ç”¨æˆ·çº¿ç¨‹æ–­å¼€ç°ç™½é—´å¼•ç”¨å…³ç³»å‰åŠ å…¥â€œå†™å±éšœâ€ï¼Œå°†è¿™ä¸ªè¦åˆ é™¤çš„å¼•ç”¨è®°å½•ä¸‹æ¥ã€‚å‘æ‰«æç»“æŸä¹‹åï¼Œå†å°†è¿™äº›è®°å½•è¿‡å¾—å¼•ç”¨å…³ç³»ä¸­çš„ç°è‰²å¯¹è±¡ä¸ºæ ¹ï¼Œé‡æ–°æ‰«æä¸€æ¬¡ã€‚\n\n### æ€»ç»“\n\nåŸå§‹å¿«ç…§å…³æ³¨çš„æ˜¯å¼•ç”¨åˆ é™¤ï¼Œå¢é‡æ›´æ–°å…³æ³¨çš„æ˜¯å¼•ç”¨å¢åŠ ã€‚\nä½¿ç”¨å¢é‡æ›´æ–°ç®—æ³•ï¼Œé‚£å˜æˆç°è‰²çš„å¯¹è±¡è¿˜è¦é‡æ–°æ‰«æä¸€éï¼Œæ•ˆç‡å¤ªä½äº†ï¼Œæ‰€ä»¥G1åœ¨å¤„ç†å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹æ¯”CMSæ•ˆç‡è¦é«˜ï¼Œè¿™ä¸ªä¸»è¦æ˜¯è§£å†³æ¼æ ‡çš„ç®—æ³•å†³å®šçš„ã€‚\nå› æ­¤G1ä¸é‡‡ç”¨å¢é‡æ›´æ–°ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86":{"title":"åŠ¨æ€ä»£ç†","content":"# åŠ¨æ€ä»£ç†\n\n## æ¡ˆä¾‹\n\n```java\npublic class DynamicProxySample {\n\n    interface Greet {\n        Object sayHello(String name);\n    }\n\n    public static void main(String[] args) {\n        InvocationHandler handler = new InvocationHandler() {\n            @Override\n            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n                System.out.println(\"method: \" + method.getName());\n                return args[0];\n            }\n        };\n\n        Greet proxy = (Greet) Proxy.newProxyInstance(Greet.class.getClassLoader(), new Class[]{Greet.class}, handler);\n        System.out.println(proxy.sayHello(\"creativeworkes\"));\n    }\n}\n```\n\n\u003e å…³é”®é—®é¢˜ï¼šä¸ºä»€ä¹ˆè°ƒç”¨`proxy.sayHello`ï¼Œè‡ªåŠ¨ä¼šå°†ä»£ç†ç±»çš„æ–¹æ³•å’Œè¢«ä»£ç†ç±»çš„æ–¹æ³•å…³è”èµ·æ¥ï¼Ÿ\n\n## åŸºæœ¬æµç¨‹\n\n\u003e https://blog.csdn.net/cicada_smile/article/details/118280698\n\n1. åŠ¨æ€ç”Ÿæˆä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¼ªè£…æˆå®ç°äº†æŸä¸ªæ¥å£çš„æ ·å­ã€‚\n2. å®ç°ä¸­å®é™…è°ƒç”¨çš„æ˜¯InvocationHandlerå¯¹è±¡çš„invokeæ–¹æ³•ã€‚\n3. InvocationHandleræ˜¯ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨åªå£°æ˜é¢å¤–çš„åŠ¨ä½œï¼Œä¸ä¼šæŒ‡å®šæ‹¦æˆªç›®æ ‡ã€‚\n\t1. æ‹¦æˆªå™¨å®é™…ä¸Šä¼šæ‹¦æˆªæ‰æ‰€æœ‰å‡½æ•°ï¼Œåªæ˜¯ä½ å¯ä»¥åœ¨æ‹¦æˆªå™¨é‡Œåšåˆ¤æ–­ï¼Œé‡åˆ°ç‰¹å®šå‡½æ•°æ‰åšç‰¹å®šæ“ä½œã€‚\n4. Proxy.newProxyInstance(ç›®æ ‡ç±»åŠ è½½å™¨ï¼Œç›®æ ‡æ¥å£ï¼Œæ‹¦æˆªå™¨)ä¼šæ ¹æ®å‰ä¸¤ä¸ªå‚æ•°**åŠ¨æ€ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»**ï¼Œå¹¶å®ä¾‹åŒ–ä»£ç†ç±»åŒæ—¶å°†æ‹¦æˆªå™¨ä¼ é€’ç»™ä»£ç†å¯¹è±¡ã€‚\n\t1. ä»£ç†ç±»å®é™…ä¸Šæ˜¯ä¸€ä¸ªProxyå¯¹è±¡ï¼Œåªæ˜¯é¢å¤–è¿˜å®ç°äº†ç›®æ ‡æ¥å£ã€‚\n\t2. **ä»£ç†ç±»é‡Œé¢ä¼šé‡å†™æ‰€æœ‰ç›®æ ‡æ¥å£çš„æ–¹æ³•ï¼Œç”¨æ‹¦æˆªå™¨.invoke(åŸå§‹æ–¹æ³•)**\n5. è°ƒç”¨ä»£ç†ç±».method()å®é™…ä¸Šæ˜¯è°ƒç”¨äº†h.invoke(method())\n6. methodä¼ å…¥æ‹¦æˆªå™¨åï¼Œå°±å¯ä»¥æ ¹æ®åŸå§‹æ–¹æ³•å‡½æ•°åç­‰ä¿¡æ¯è¿›è¡Œé€»è¾‘å¤„ç†ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è°ƒç”¨åŸå§‹æ–¹æ³•ã€‚\n\nJDKåŠ¨æ€ä»£ç†**åªèƒ½ä»£ç†æ¥å£**ï¼Œå› ä¸ºè‡ªåŠ¨ç”Ÿæˆçš„å¯¹è±¡ä¼šå®ç°ç›®æ ‡æ¥å£ï¼ˆä¼ªè£…æˆç›®æ ‡æ¥å£çš„æŒ‡å®šçš„æ ·å­ï¼‰ï¼Œä¼ªè£…çš„æ—¶å€™ä¼šâ€œå®ç°æ¥å£çš„æ–¹æ³•â€ï¼Œè€Œæ–¹æ³•é‡Œå®é™…è°ƒç”¨çš„æ˜¯ InvocationHandler å¯¹è±¡çš„invokeæ–¹æ³•ï¼ŒInvocationHandler å¯ä»¥ç†è§£æˆæ‹¦æˆªå™¨ï¼Œé€šè¿‡Javaåå°„å¯¹ä¼ å…¥å¯¹è±¡çš„æŒ‡å®šæ–¹æ³•è¿›è¡Œæ‹¦æˆªã€‚**invokeæ–¹æ³•æ˜¯å¯¹æŸä¸€å®ç°ç›®æ ‡æ¥å£çš„ç±»çš„å¯¹è±¡æ–¹æ³•çš„é‡æ–°åŒ…è£…ã€‚**\n\nJDKåŠ¨æ€ä»£ç†æ¨¡å¼é‡Œæœ‰ä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨JDKä¸­ï¼Œåªè¦å®ç°äº†**InvocationHandler**æ¥å£çš„ç±»å°±æ˜¯ä¸€ä¸ª**æ‹¦æˆªå™¨ç±»**ã€‚\n\nå‡å¦‚å†™äº†ä¸ªè¯·æ±‚åˆ°actionï¼Œç»è¿‡æ‹¦æˆªå™¨ï¼Œç„¶åæ‰ä¼šåˆ°actionï¼Œæ‰§è¡Œåç»­æ“ä½œã€‚ æ‹¦æˆªå™¨å°±åƒä¸€ä¸ªè¿‡æ»¤ç½‘ï¼Œä¸€å±‚å±‚è¿‡æ»¤ï¼Œåªæœ‰æ»¡è¶³ä¸€å®šæ¡ä»¶ï¼Œæ‰èƒ½ç»§ç»­å‘åæ‰§è¡Œã€‚ **æ‹¦æˆªå™¨çš„ä½œç”¨**ï¼šæ§åˆ¶ç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œã€‚\n\næ‹¦æˆªå™¨çš„å…·ä½“æ“ä½œæ­¥éª¤ï¼š\n\n1. å¼•å…¥ç±» ç›®æ ‡ç±»å’Œä¸€äº›æ‰©å±•æ–¹æ³•ç›¸å…³çš„ç±»\n2. èµ‹å€¼ è°ƒç”¨æ„é€ å™¨ï¼Œç»™ç›¸å…³å¯¹è±¡èµ‹å€¼\n3. åˆå¹¶é€»è¾‘å¤„ç† åœ¨invokeæ–¹æ³•ä¸­æŠŠæ‰€æœ‰çš„é€»è¾‘ç»“åˆåœ¨ä¸€èµ·ã€‚æœ€ç»ˆå†³å®šç›®æ ‡æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨\n\n### è§£é‡Šç”¨ä¾‹\n\nç›®æ ‡æ¥å£ï¼š\n```java\npackage com.mgg.styproxy;  \n  \npublic interface TargetInterface {  \n    void business();  \n}\n```\n\nç›®æ ‡ç±»ï¼š\n```java\npackage com.mgg.styproxy;  \n  \npublic class TargetObject implements TargetInterface{  \n    @Override  \n    public void business() {  \n        System.out.println(\"business\");  \n    }  \n}\n```\n\næ‹¦æˆªå™¨åŠä½¿ç”¨ï¼š\n```java\npackage com.mgg.styproxy;  \n  \nimport java.lang.reflect.InvocationHandler;  \nimport java.lang.reflect.Method;  \nimport java.lang.reflect.Proxy;  \n  \npublic class MyInterceptor implements InvocationHandler {  \n\t// è¢«ä»£ç†å¯¹è±¡\n    private Object target;  \n    public MyInterceptor(Object target) {this.target = target;}  \n  \n    // è°ƒç”¨å¯¹è±¡targetçš„æŒ‡å®šæ–¹æ³•å®é™…æ˜¯è°ƒç”¨äº†è¿™é‡Œï¼Œæœ¬ä¾‹æ˜¯business() \n    @Override  \n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {  \n        System.out.println(\"before calling \" + method);  \n        method.invoke(this.target, args);  \n        System.out.println(\"after calling \" + method);  \n        return null;    }  \n  \n    public static void main(String[] args) {  \n        TargetObject target = new TargetObject();  // ç›®æ ‡å¯¹è±¡  \n        MyInterceptor myInterceptor = new MyInterceptor(target);  // æ‹¦æˆªæ‰ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•  \n        TargetInterface proxyObj = (TargetInterface) Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), myInterceptor);  // ä»£ç†æ‰åŸæ¥çš„å¯¹è±¡ï¼Œè°ƒç”¨æ¥å£æ–¹æ³•æ—¶ä¼šè¢«æŒ‡å®šçš„æ‹¦æˆªå™¨æ‹¦æˆªã€‚ä»£ç†å¯¹è±¡æ˜¯ç”±JVMåŠ¨æ€ç”Ÿæˆçš„  \n        proxyObj.business();  // è¿™é‡Œå®é™…ä¸Šè°ƒç”¨äº†myInterceptor.invoke()ï¼Œåœ¨é‡Œé¢å¯èƒ½ä¼šå†è°ƒç”¨targetçš„businessæ–¹æ³•ã€‚  \n  \n    }  \n}\n```\n\n## æºç è§£æ\n\nå¾ˆå¤šåŒå­¦å¯¹åŠ¨æ€ä»£ç†è¿·ç³Šï¼Œåœ¨äº`proxyObj.business();`ç†è§£é”™äº†ï¼Œè‡³å°‘æ˜¯è¢«è¡¨é¢æ‰€è¿·æƒ‘ï¼Œæ²¡æœ‰å‘ç°è¿™ä¸ªproxyObjå’ŒProxyä¹‹é—´çš„è”ç³»ï¼Œä¸€åº¦çº ç»“æœ€åè°ƒç”¨çš„è¿™ä¸ª`business()`æ˜¯æ€ä¹ˆå’Œ`invoke()`è”ç³»ä¸Šçš„ï¼Œè€Œinvokeåˆæ€ä¹ˆçŸ¥é“businesså­˜åœ¨çš„ã€‚\n\nå…¶å®ä¸Šé¢çš„trueå’Œclass $ Proxy0å°±èƒ½è§£å†³å¾ˆå¤šçš„ç–‘é—®ï¼Œå†åŠ ä¸Šä¸‹é¢å°†è¦è¯´çš„$ Proxy0çš„æºç ï¼Œå®Œå…¨å¯ä»¥è§£å†³åŠ¨æ€ä»£ç†çš„ç–‘æƒ‘äº†ã€‚\n\næˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾å¼è°ƒç”¨invoke()ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ç¡®å®æ‰§è¡Œäº†ã€‚ä¸‹é¢åˆ†æï¼š\n\nä»Clientä¸­çš„ä»£ç çœ‹ï¼Œå¯ä»¥ä»newProxyInstanceè¿™ä¸ªæ–¹æ³•ä½œä¸ºçªç ´å£ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹Proxyç±»ä¸­newProxyInstanceæ–¹æ³•çš„æºä»£ç ï¼š\n\n```java\npublic static Object newProxyInstance(ClassLoader loader,\n                                      Class\u003c?\u003e[] interfaces,\n                                      InvocationHandler h) {\n    final Class\u003c?\u003e[] intfs = interfaces.clone();\n    final SecurityManager sm = System.getSecurityManager();\n    if (sm != null) {\n        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);\n    }\n\n    /*\n     * æŸ¥æ‰¾æˆ–ç”ŸæˆæŒ‡å®šçš„ä»£ç†ç±»ï¼Œä»ç›®æ ‡èº«ä¸Šè·å–åˆ°å¯¹åº”çš„ç±»åŠ è½½å™¨å’Œæ¥å£\n     * ç”¨å¯¹åº”çš„ç±»åŠ è½½å™¨å’Œæ¥å£åˆ›å»ºä»£ç†ç±»$Proxy0\n     * $Proxy0ç±»å®ç°äº†interfacesç±»å‹çš„æ¥å£,å¹¶ç»§æ‰¿äº†Proxyç±»\n     */\n    Class\u003c?\u003e cl = getProxyClass0(loader, intfs);\n\n    /*\n     * ä½¿ç”¨æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºè°ƒç”¨å…¶æ„é€ å™¨\n     */\n    try {\n        if (sm != null) {\n            checkNewProxyPermission(Reflection.getCallerClass(), cl);\n        }\n        // å½¢å‚ä¸ºInvocationHandlerç±»å‹çš„æ„é€ å™¨\n        final Constructor\u003c?\u003e cons = cl.getConstructor(constructorParams);  // è·å¾—ç›®æ ‡ç±»çš„æ„é€ å‡½æ•°\n        final InvocationHandler ih = h;\n        if (!Modifier.isPublic(cl.getModifiers())) {\n            AccessController.doPrivileged(new PrivilegedAction\u003cVoid\u003e() {\n                public Void run() {\n                    cons.setAccessible(true);\n                    return null;\n                }\n            });\n        }\n        return cons.newInstance(new Object[]{h});  // åˆ›å»ºç±»çš„å®ä¾‹å¹¶è¿”å›ï¼ŒåŒæ—¶ä¼ å…¥æ‹¦æˆªå™¨\n    } ...\n}\n```\n\nProxy.newProxyInstanceåšäº†å¦‚ä¸‹äº‹ï¼š\n\n- æ ¹æ®å‚æ•°loaderå’Œinterfacesè°ƒç”¨æ–¹æ³• getProxyClass(loader, interfaces)åˆ›å»ºä»£ç†ç±»`$Proxy0`ã€‚`$Proxy0`ç±» å®ç°äº†ç›®æ ‡æ¥å£ï¼Œå¹¶ç»§æ‰¿äº†Proxyç±»\n\t- loaderå‚æ•°æ˜¯ä¸ºäº†ä¿è¯ä»£ç†ç±»å’Œæ¥å£ç±»ç”±åŒä¸€ä¸ªåŠ è½½å™¨åŠ è½½\n- å®ä¾‹åŒ–`$Proxy0`ï¼Œå¹¶åœ¨æ„é€ å™¨æŠŠæ‹¦æˆªå™¨ä¼ è¿‡å»ï¼Œæ¥ç€`$Proxy0`è°ƒç”¨Proxyçˆ¶ç±»çš„æ„é€ å™¨ï¼Œä¸ºhèµ‹å€¼\n\n$Proxy0çš„æºç ï¼š\nè¿™ä¸ªç±»æ˜¯åŠ¨æ€ç”Ÿæˆçš„\n```java\npackage com.sun.proxy;\n\npublic final class $Proxy0 extends Proxy implements TargetInterface {\n    private static Method m1;\n    private static Method m3;  // è¢«ä»£ç†ç±»çš„åŸå§‹æ–¹æ³•ï¼Œæœ¬ä¾‹ä¼šå½“ä½œå‚æ•°ä¼ ç»™h.invoke()\n    private static Method m2;\n    private static Method m0;\n\n\t// newProxyInstanceåˆ›å»ºå®Œç±»åè¿›è¡Œå®ä¾‹åŒ–ï¼ŒåŒæ—¶ä¼ å…¥æ‹¦æˆªå™¨\n    public $Proxy0(InvocationHandler var1) throws  {\n\t    // Proxyç±»çš„æ„é€ æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªInvocationHandlerç±»å‹å‚æ•°\n\t    // ä¸»è¦å·¥ä½œå°±æ˜¯ç»™proxy.hèµ‹å€¼ä¸€ä¸ªæ‹¦æˆªå™¨\n        super(var1);\n    }\n\n    public final boolean equals(Object var1) throws  {\n        try {\n            return (Boolean)super.h.invoke(this, m1, new Object[]{var1});\n        }...\n    }\n\n\t// mainä¸­è°ƒç”¨çš„å®é™…æ˜¯è¿™ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯åŸç›®æ ‡ä¸­çš„æ–¹æ³•äº†\n\t// ä»£ç†ç±»ç”Ÿæˆçš„åŒåçš„æ–¹æ³•æ‹¦æˆªæ‰äº†ç›®æ ‡æ–¹æ³•\n    public final void business() throws  {\n        try {\n            super.h.invoke(this, m3, (Object[])null);\n        }...\n    }\n\n    public final String toString() throws  {\n        try {\n            return (String)super.h.invoke(this, m2, (Object[])null);\n        }...\n    }\n\n    public final int hashCode() throws  {\n        try {\n            return (Integer)super.h.invoke(this, m0, (Object[])null);\n        }...\n    }\n\n    static {\n        try {\n            m1 = Class.forName(\"java.lang.Object\").getMethod(\"equals\", Class.forName(\"java.lang.Object\"));\n            m3 = Class.forName(\"com.javaedge.design.pattern.structural.proxy.dynamicproxy.jdkdynamicproxy.TargetInterface\").getMethod(\"business\");\n            m2 = Class.forName(\"java.lang.Object\").getMethod(\"toString\");\n            m0 = Class.forName(\"java.lang.Object\").getMethod(\"hashCode\");\n        }...\n    }\n}\n```\n\næ¥ç€æŠŠå¾—åˆ°çš„`$Proxy0`å®ä¾‹å¼ºè½¬æˆTargetInterfaceï¼Œå¹¶å°†å¼•ç”¨èµ‹ç»™TargetInterfaceã€‚å½“æ‰§è¡ŒproxyObj.business()ï¼Œå°±è°ƒç”¨äº†`$Proxy0`ç±»ä¸­çš„business()æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨çˆ¶ç±»Proxyä¸­çš„hçš„invoke()æ–¹æ³•ã€‚å³`InvocationHandler.invoke()`ã€‚\n\nProxy#getProxyClassè¿”å›çš„æ˜¯Proxyçš„Classç±»ï¼Œè€Œéâ€œè¢«ä»£ç†ç±»çš„Classç±»â€ï¼\n\n## æ€»ç»“\n\nä¸Šé¢æ˜¯æ¡ˆä¾‹æ‰§è¡Œçš„è¿‡ç¨‹å’ŒåŸç†ï¼Œè¿˜æœ‰ä¸€ä¸ªå…³é”®ç‚¹è¦æ˜ç™½ï¼Œå³JDKæºç çš„é€»è¾‘ï¼š\n\n```java\nIUser proxyUser = (IUser) Proxy.newProxyInstance(classLoader,interfaces,userHandler);\n```\n\nProxyæä¾›çš„é™æ€æ–¹æ³•`newProxyInstance()`ï¼Œé€šè¿‡å„ä¸ªå‚æ•°çš„ä¼ å…¥ï¼Œæ„å»ºä¸€ä¸ªæ–°çš„ä»£ç†Classå¯¹è±¡ï¼Œå³$Proxy0ç±»çš„ç»“æ„ä¿¡æ¯ï¼Œè¿™é‡Œå†å›é¦–çœ‹ä¸‹ä¸‰ä¸ªæ ¸å¿ƒå‚æ•°ï¼š\n\n- ClassLoaderï¼šåŸºäºJVMè¿è¡Œè¿‡ç¨‹ï¼Œæ‰€ä»¥éœ€è¦è·å–ç›®æ ‡ç±»UserServiceçš„ç±»åŠ è½½å™¨ï¼›\n    \n- Interfacesï¼šç›®æ ‡ç±»UserServiceå®ç°çš„æ¥å£ï¼Œä»é¢å‘å¯¹è±¡æ¥è€ƒè™‘ï¼Œæ¥å£ä¸å®ç°åˆ†ç¦»ï¼Œä»£ç†ç±»é€šè¿‡å®ç°IUseræ¥å£ï¼Œæ¨¡æ‹Ÿç›®æ ‡ç±»çš„éœ€æ±‚ï¼›\n    \n- InvocationHandlerï¼šä»£ç†ç±»æä¾›çš„åŠŸèƒ½å°è£…å³UserHandlerï¼Œå¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨å‰ååšå¢å¼ºå¤„ç†ï¼›","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E5%8D%8F%E5%8F%98":{"title":"åå˜","content":"# åå˜\n\nå­ç±»å‹å¯ä»¥éšæ€§çš„è½¬æ¢ä¸ºçˆ¶ç±»å‹ã€‚\n\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE":{"title":"åŒäº²å§”æ´¾","content":"# åŒäº²å§”æ´¾\n\n\u003e https://blog.csdn.net/weixin_36586120/article/details/117457014\n\n## å®šä¹‰\n\n1. ç±»åŠ è½½å™¨åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼Œä¼šå…ˆå°†å…¶é€çº§ä¸Šäº¤ç»™çˆ¶çº§åŠ è½½å™¨å°è¯•åŠ è½½\n\t1. çˆ¶å­å…³ç³»ä¸æ˜¯ç»§æ‰¿ç»´æŠ¤ï¼Œè€Œæ˜¯**ç»„åˆ**ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æŒæœ‰ä¸€ä¸ª `parent` å­—æ®µï¼ŒæŒ‡å‘çˆ¶åŠ è½½å™¨ã€‚\n2. çˆ¶çº§åŠ è½½å™¨å…ˆæ£€æŸ¥æ˜¯å¦å·²åŠ è½½ï¼Œå†å°è¯•é€’å½’ä¸Šäº¤\n3. è‹¥æ— æ³•å¤„ç†å†å‘ä¸‹å§”æ´¾åŠ è½½ä»»åŠ¡ã€‚\n\n![[z-oblib/z2-attachments/20210601230727770.png]]\n\n## ç›®çš„\n\nåŒäº²å§”æ´¾ä¿è¯ç±»åŠ è½½å™¨ï¼Œè‡ªä¸‹è€Œä¸Šçš„å§”æ´¾ï¼Œåˆè‡ªä¸Šè€Œä¸‹çš„åŠ è½½ï¼Œä¿è¯æ¯ä¸€ä¸ªç±»åœ¨å„ä¸ªç±»åŠ è½½å™¨ä¸­éƒ½æ˜¯åŒä¸€ä¸ªç±»ã€‚\n\n## ç ´å\n\n#TODO","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E6%9E%84%E6%88%90":{"title":"å¯¹è±¡å†…å­˜æ„æˆ","content":"# å¯¹è±¡å†…å­˜æ„æˆ\n\nJava ä¸­é€šè¿‡ new å…³é”®å­—åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå¯¹è±¡å­˜äºå†…å­˜çš„å †ä¸­å¹¶ç»™å…¶åˆ†é…ä¸€ä¸ªå†…å­˜åœ°å€ã€‚\n![[z-oblib/z2-attachments/Pasted image 20220428151815.png]]\nåœ¨ JVM ä¸­ï¼ŒJavaå¯¹è±¡ä¿å­˜åœ¨å †ä¸­æ—¶ï¼Œç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n-   **[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/å¯¹è±¡å¤´|å¯¹è±¡å¤´]]ï¼ˆobject headerï¼‰**ï¼šåŒ…æ‹¬äº†å…³äºå †å¯¹è±¡çš„å¸ƒå±€ã€ç±»å‹ã€GCçŠ¶æ€ã€åŒæ­¥çŠ¶æ€å’Œæ ‡è¯†å“ˆå¸Œç çš„åŸºæœ¬ä¿¡æ¯ã€‚Javaå¯¹è±¡å’Œvmå†…éƒ¨å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„å¯¹è±¡å¤´æ ¼å¼ã€‚\n-   **å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰**ï¼šä¸»è¦æ˜¯å­˜æ”¾ç±»çš„æ•°æ®ä¿¡æ¯ï¼Œçˆ¶ç±»çš„ä¿¡æ¯ï¼Œå¯¹è±¡å­—æ®µå±æ€§ä¿¡æ¯ã€‚\n-   **å¯¹é½å¡«å……ï¼ˆPaddingï¼‰**ï¼šä¸ºäº†å­—èŠ‚å¯¹é½ï¼Œå¡«å……çš„æ•°æ®ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220428151834.png]]","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E5%AF%B9%E8%B1%A1%E5%A4%B4":{"title":"å¯¹è±¡å¤´","content":"# å¯¹è±¡å¤´\n\n![[z-oblib/z2-attachments/Pasted image 20220428151706.png]]\n\nåœ¨JVMä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­é™¤äº†æœ¬èº«çš„æ•°æ®å¤–è¿˜ä¼šæœ‰ä¸ªå¯¹è±¡å¤´ï¼Œå¯¹äºæ™®é€šå¯¹è±¡è€Œè¨€ï¼Œå…¶å¯¹è±¡å¤´ä¸­æœ‰ä¸¤ç±»ä¿¡æ¯ï¼šmark wordå’Œç±»å‹æŒ‡é’ˆã€‚å¦å¤–å¯¹äºæ•°ç»„è€Œè¨€è¿˜ä¼šæœ‰ä¸€ä»½è®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ã€‚ç±»å‹æŒ‡é’ˆæ˜¯æŒ‡å‘è¯¥å¯¹è±¡æ‰€å±ç±»å¯¹è±¡çš„æŒ‡é’ˆã€‚\n\n## æ™®é€šå¯¹è±¡\n\n```text\n|--------------------------------------------------------------|\n|                     Object Header (64 bits)                  |\n|------------------------------------|-------------------------|\n|        Mark Word (32 bits)         |    Klass Word (32 bits) |\n|------------------------------------|-------------------------|\n```\n\n## æ•°ç»„å¯¹è±¡\n\n```text\n|------------------------------------------------------------------------------|\n|                               Object Header (96 bits)                        |\n|------------------------------|----------------------|------------------------|\n|       Mark Word(32bits)      |   Klass Word(32bits) |  array length(32bits)  |\n|------------------------------|----------------------|------------------------|\n```\n\n## Mark Word\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/Mark Word|Mark Word]]","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BC%95%E7%94%A8":{"title":"å¯¹è±¡çš„å¼•ç”¨","content":"# å¯¹è±¡çš„å¼•ç”¨\n\n| å¼•ç”¨ç±»å‹  | è¢«åƒåœ¾å›æ”¶æ—¶é—´  | ç”¨é€”       | ç”Ÿå­˜æ—¶é—´       |\n|-------|----------|----------|------------|\n| å¼ºå¼•ç”¨   | ä»æ¥ä¸ä¼š     | å¯¹è±¡çš„ä¸€èˆ¬çŠ¶æ€  | JVMåœæ­¢è¿è¡Œæ—¶ç»ˆæ­¢ |\n| è½¯å¼•ç”¨   | å½“å†…å­˜ä¸è¶³æ—¶   | å¯¹è±¡ç¼“å­˜     | å†…å­˜ä¸è¶³æ—¶ç»ˆæ­¢    |\n| å¼±å¼•ç”¨  | æ­£å¸¸åƒåœ¾å›æ”¶æ—¶  | å¯¹è±¡ç¼“å­˜       | åƒåœ¾å›æ”¶åç»ˆæ­¢ |\n| è™šå¼•ç”¨  | æ­£å¸¸åƒåœ¾å›æ”¶æ—¶  | è·Ÿè¸ªå¯¹è±¡çš„åƒåœ¾å›æ”¶  | åƒåœ¾å›æ”¶åç»ˆæ­¢ |\n\n\n\u003e https://juejin.cn/post/6844903665241686029\n\nä»`JDK 1.2`ç‰ˆæœ¬å¼€å§‹ï¼Œå¯¹è±¡çš„å¼•ç”¨è¢«åˆ’åˆ†ä¸º`4`ç§çº§åˆ«ï¼Œä»è€Œä½¿ç¨‹åºèƒ½æ›´åŠ çµæ´»åœ°æ§åˆ¶**å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ**ã€‚è¿™`4`ç§çº§åˆ«**ç”±é«˜åˆ°ä½**ä¾æ¬¡ä¸ºï¼š**å¼ºå¼•ç”¨**ã€**è½¯å¼•ç”¨**ã€**å¼±å¼•ç”¨**å’Œ**è™šå¼•ç”¨**ã€‚\n\n![[z-oblib/z2-attachments/16576be9ee015804~tplv-t2oaga2asx-zoom-in-crop-mark-1304-0-0-0.webp]]\n\n## å¼ºå¼•ç”¨\n\n**å¼ºå¼•ç”¨**æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£**åƒåœ¾å›æ”¶å™¨**ç»ä¸ä¼šå›æ”¶å®ƒã€‚å¦‚ä¸‹ï¼š\n\nå½“**å†…å­˜ç©ºé—´ä¸è¶³**æ—¶ï¼Œ`Java`è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º`OutOfMemoryError`é”™è¯¯ï¼Œä½¿ç¨‹åº**å¼‚å¸¸ç»ˆæ­¢**ï¼Œä¹Ÿä¸ä¼šé éšæ„**å›æ”¶**å…·æœ‰**å¼ºå¼•ç”¨**çš„**å¯¹è±¡**æ¥è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚ å¦‚æœå¼ºå¼•ç”¨å¯¹è±¡**ä¸ä½¿ç”¨æ—¶**ï¼Œéœ€è¦å¼±åŒ–ä»è€Œä½¿`GC`èƒ½å¤Ÿå›æ”¶ï¼Œå¦‚ä¸‹ï¼š\n\n```java\n strongReference = null;\n```\n\næ˜¾å¼åœ°è®¾ç½®`strongReference`å¯¹è±¡ä¸º`null`ï¼Œæˆ–è®©å…¶**è¶…å‡º**å¯¹è±¡çš„**ç”Ÿå‘½å‘¨æœŸ**èŒƒå›´ï¼Œåˆ™`gc`è®¤ä¸ºè¯¥å¯¹è±¡**ä¸å­˜åœ¨å¼•ç”¨**ï¼Œè¿™æ—¶å°±å¯ä»¥å›æ”¶è¿™ä¸ªå¯¹è±¡ã€‚å…·ä½“ä»€ä¹ˆæ—¶å€™æ”¶é›†è¿™è¦å–å†³äº`GC`ç®—æ³•ã€‚\n\n```java\npublic void test() {\n\tObject strongReference = new Object();\n\t// çœç•¥å…¶ä»–æ“ä½œ\n}\n```\n\nåœ¨ä¸€ä¸ª**æ–¹æ³•çš„å†…éƒ¨**æœ‰ä¸€ä¸ª**å¼ºå¼•ç”¨**ï¼Œè¿™ä¸ªå¼•ç”¨ä¿å­˜åœ¨`Java`**æ ˆ**ä¸­ï¼Œè€ŒçœŸæ­£çš„å¼•ç”¨å†…å®¹(`Object`)ä¿å­˜åœ¨`Java`**å †**ä¸­ã€‚ å½“è¿™ä¸ª**æ–¹æ³•è¿è¡Œå®Œæˆ**åï¼Œå°±ä¼šé€€å‡º**æ–¹æ³•æ ˆ**ï¼Œåˆ™å¼•ç”¨å¯¹è±¡çš„**å¼•ç”¨æ•°**ä¸º`0`ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«å›æ”¶ã€‚\n\nä½†æ˜¯å¦‚æœè¿™ä¸ª`strongReference`æ˜¯**å…¨å±€å˜é‡**æ—¶ï¼Œå°±éœ€è¦åœ¨**ä¸ç”¨è¿™ä¸ªå¯¹è±¡æ—¶èµ‹å€¼ä¸º`null`**ï¼Œå› ä¸º**å¼ºå¼•ç”¨**ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚\n\n**ArrayListçš„Clearæ–¹æ³•ï¼š**\nåœ¨`ArrayList`ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ª`elementData`æ•°ç»„ï¼Œåœ¨è°ƒç”¨`clear`æ–¹æ³•æ¸…ç©ºæ•°ç»„æ—¶ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ è¢«èµ‹å€¼ä¸º`null`ã€‚ ä¸åŒäº`elementData=null`ï¼Œå¼ºå¼•ç”¨ä»ç„¶å­˜åœ¨ï¼Œé¿å…åœ¨åç»­è°ƒç”¨`add()`ç­‰æ–¹æ³•æ·»åŠ å…ƒç´ æ—¶è¿›è¡Œå†…å­˜çš„**é‡æ–°åˆ†é…**ã€‚ ä½¿ç”¨å¦‚`clear()`æ–¹æ³•**å†…å­˜æ•°ç»„**ä¸­å­˜æ”¾çš„**å¼•ç”¨ç±»å‹**è¿›è¡Œ**å†…å­˜é‡Šæ”¾**ç‰¹åˆ«é€‚ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥åŠæ—¶é‡Šæ”¾å†…å­˜ã€‚\n![[z-oblib/z2-attachments/Pasted image 20220428164341.png]]\n\n## è½¯å¼•ç”¨(SoftReference)\n\nå¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰**è½¯å¼•ç”¨**ï¼Œåˆ™**å†…å­˜ç©ºé—´å……è¶³**æ—¶ï¼Œ**åƒåœ¾å›æ”¶å™¨**å°±**ä¸ä¼š**å›æ”¶å®ƒï¼›å¦‚æœ**å†…å­˜ç©ºé—´ä¸è¶³**äº†ï¼Œå°±ä¼š**å›æ”¶**è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚\n\n```java\n// å¼ºå¼•ç”¨\nString strongReference = new String(\"abc\");\n// è½¯å¼•ç”¨\nString str = new String(\"abc\");\nSoftReference\u003cString\u003e softReference = new SoftReference\u003cString\u003e(str);\n```\n\n**è½¯å¼•ç”¨**å¯ä»¥å’Œä¸€ä¸ª**å¼•ç”¨é˜Ÿåˆ—**(`ReferenceQueue`)è”åˆä½¿ç”¨ã€‚å¦‚æœ**è½¯å¼•ç”¨**æ‰€å¼•ç”¨å¯¹è±¡è¢«**åƒåœ¾å›æ”¶**ï¼Œ`JAVA`è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ª**è½¯å¼•ç”¨**åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„**å¼•ç”¨é˜Ÿåˆ—**ä¸­ã€‚\n\n## å¼±å¼•ç”¨(WeakReference)\n\n**å¼±å¼•ç”¨**ä¸**è½¯å¼•ç”¨**çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰**å¼±å¼•ç”¨**çš„å¯¹è±¡æ‹¥æœ‰**æ›´çŸ­æš‚**çš„**ç”Ÿå‘½å‘¨æœŸ**ã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰**å¼±å¼•ç”¨**çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰**å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦**ï¼Œéƒ½ä¼š**å›æ”¶**å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ª**ä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹**ï¼Œå› æ­¤**ä¸ä¸€å®š**ä¼š**å¾ˆå¿«**å‘ç°é‚£äº›åªå…·æœ‰**å¼±å¼•ç”¨**çš„å¯¹è±¡ã€‚\n\n  \n```java\n    String str = new String(\"abc\");\n    WeakReference\u003cString\u003e weakReference = new WeakReference\u003c\u003e(str);\n    str = null;\n```\n\nä¸‹é¢çš„ä»£ç ä¼šè®©ä¸€ä¸ª**å¼±å¼•ç”¨**å†æ¬¡å˜ä¸ºä¸€ä¸ª**å¼ºå¼•ç”¨**ï¼š\n\n```java\nString str = new String(\"abc\");\n    WeakReference\u003cString\u003e weakReference = new WeakReference\u003c\u003e(str);\n    // å¼±å¼•ç”¨è½¬å¼ºå¼•ç”¨\nString strongReference = weakReference.get();\n```\n\n## è™šå¼•ç”¨(PhantomReference)\n\n**è™šå¼•ç”¨**é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯**å½¢åŒè™šè®¾**ã€‚ä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œ**è™šå¼•ç”¨**å¹¶**ä¸ä¼š**å†³å®šå¯¹è±¡çš„**ç”Ÿå‘½å‘¨æœŸ**ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡**ä»…æŒæœ‰è™šå¼•ç”¨**ï¼Œé‚£ä¹ˆå®ƒå°±å’Œ**æ²¡æœ‰ä»»ä½•å¼•ç”¨**ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚\n\n**åº”ç”¨åœºæ™¯ï¼š**\n\n**è™šå¼•ç”¨**ä¸»è¦ç”¨æ¥**è·Ÿè¸ªå¯¹è±¡**è¢«åƒåœ¾å›æ”¶å™¨**å›æ”¶**çš„æ´»åŠ¨ã€‚ **è™šå¼•ç”¨**ä¸**è½¯å¼•ç”¨**å’Œ**å¼±å¼•ç”¨**çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼š\n\n**è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—(ReferenceQueue)è”åˆä½¿ç”¨**ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99":{"title":"å¼€é—­åŸåˆ™","content":"# å¼€é—­åŸåˆ™\n\nå¼€é—­åŸåˆ™ï¼ˆOpen-Closed Principle, OCPï¼‰æ˜¯æŒ‡ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥**å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­**ã€‚\n\n## é—­åˆåŸåˆ™\n\nä¸æƒ³å‘å¤–æš´éœ²çš„è®¾ç½®æˆfinal/privateã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E6%B5%81":{"title":"æµ","content":"\n# æµ\n\n## åŸºæœ¬æ¦‚å¿µ\n\n\næµåªæ˜¯ä¸€ä¸ªæ¯”å–»ã€‚\n\nä»»ä½•æ¯”å–»éƒ½æ— æ³•å®Œç¾ã€‚\n\næµæ¯”å–»æ•°æ®çš„å‡åŒ€è¿ç»­æ€§ã€‚\n\nä½ ä»æ°´é¾™å¤´æ¥æ°´ï¼Œæ— è®ºæ‹¿æ¯å­ï¼Œè„¸ç›˜ï¼Œè¿˜æ˜¯æ¡¶ã€‚åªè¦æ°´æµä¸æ–­ï¼Œä½ éƒ½å¯ä»¥æ¥æ»¡ã€‚\n\nå‡è®¾æ°´é¾™å¤´åå‡ºçš„æ˜¯å¤§å°ä¸ä¸€çš„å†°å—ï¼Œé‚£å°±ä¸å«è¿ç»­äº†ã€‚\n\nå½“ç„¶ï¼Œè®¡ç®—æœºæœ€å°å•ä½æ˜¯å­—èŠ‚ï¼Œæ‰€ä»¥æµæ•°æ®æœ€å°å•ä½ä¹Ÿæ˜¯å­—èŠ‚ï¼ˆbyte)ã€‚å½“ç„¶å¯ä»¥é€šè¿‡å†™ç¨‹åºæ¨¡æ‹Ÿä»¥ä½(bit æ¯å­—èŠ‚8ä½ï¼‰ä¸ºå•ä½çš„bitæµã€‚\n\næ¨¡æ‹Ÿbitæµå¤šç”¨åœ¨å‹ç¼©ç®—æ³•ã€‚å¹³å¸¸æˆ‘ä»¬æ›´å¤šæ—¶å€™æ˜¯éœ€è¦è¿ç»­çš„å­—èŠ‚ä»¥æŸç§æ–¹å¼ç»„åˆèµ·æ¥è¯»å…¥æˆ–å†™å‡ºï¼Œæ¯”å¦‚ä»¥å­—ç¬¦å½¢å¼å°±æ˜¯ä¸¤ä¸ªä¸¤ä¸ªè¯»ï¼ˆcharï¼Œåœ¨javaé‡Œæ˜¯ä¸¤ä¸ªå­—èŠ‚ã€‚ï¼‰ã€‚çœ‹çœ‹jdké‡Œæœ‰ä»€xxxstreamçš„ç±»ã€‚\n\nä½ çš„é—®é¢˜æ˜¯è‡ªæˆ‘æƒ³åƒæµä¸€å®šæ˜¯ä¸ªç®¡å­ã€‚å…¶å®åœ¨è®¡ç®—æœºä¸–ç•Œé‡Œï¼Œç®¡å­æ˜¯ç®¡å­ï¼Œæµæ˜¯æµã€‚\n\nä»¥æ–‡ä»¶æµä¸ºæ¯”å–»ã€‚ä½ ä¸‹è½½äº†1ä¸ªGçš„æŸç‰‡ï¼Œå­˜åœ¨ç£ç›˜ä¸Šæ€»è¦å ç”¨ä¸€å¤§å—ç£ç›˜ç©ºé—´ï¼ˆç‰©ç†ä¸Šå¾ˆå¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œä½†æš‚æ—¶æƒ³åƒå®ƒä»¬æ˜¯å®¶é‡Œç“·ç›˜ä¸Šçš„ä¸€æ±ªæ°´ï¼‰ç„¶åä½ å‡‘è¿‡å˜´ï¼ŒæŠŠå˜´å˜Ÿèµ·æ¥ï¼Œé™¶é†‰ï¼ˆå‡è£…ï¼‰åœ°å¸ä¸Šä¸€å£ï¼Œå­—èŠ‚å¸¦ç€ç»†å¾®çš„æ°´èŠ±ä»ä½ å˜´å”‡ç©¿å…¥ï¼Œè¿™æ—¶å€™ç£ç›˜çš„ä¸€æ±ªå­—èŠ‚å’Œä½ äº§ç”Ÿå¸åŠ›çš„å˜´ä¹‹é—´ï¼Œæ²¡æœ‰å¸ç®¡ï¼Œä½†çœŸçš„æœ‰æµã€‚\n\n  \n\nä½ è¯´å˜´å·´å¸ä¸äº†ç£ç›˜ä¸Šçš„å­—èŠ‚ã€‚ä½ è¯´ç”šè‡³ä¸€Gçš„æ–‡ä»¶åœ¨ç£ç›˜ä¸Šå¾ˆå¯èƒ½æ˜¯åˆ†åœ¨ä¸è¿ç»­çš„æ‰‡åŒºå­˜å‚¨çš„ï¼Œæ€ä¹ˆæœ‰è¿ç»­çš„æµå‘¢ï¼Ÿ\n\n  \n\nä½ è¯´å¾—å¾ˆå¯¹ã€‚ã€‚ã€‚ä¹Ÿè®¸ä½ çœ‹æœ¬åœ°ç‰‡å­æ—¶ï¼Œçªç„¶æŸå¤„ç¨å¡äº†ä¸€ä¸‹ï¼Œä½ æ€€ç–‘æ˜¯ä¸æ˜¯æ­£å¥½ä¸Šä¸ªå­—èŠ‚å’Œä¸‹ä¸ªå­—èŠ‚ä¹‹é—´ éš”äº†å‡ ä¸ªæ‰‡åŒºå‡ ä¸ª[ç£é“](https://www.zhihu.com/search?q=%E7%A3%81%E9%81%93\u0026search_source=Entity\u0026hybrid_search_source=Entity\u0026hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A44911601%7D)\n\nã€‚ã€‚ã€‚ä½†å…¶å®é€šå¸¸ä¸æ˜¯çš„ã€‚æ“ä½œç³»ç»Ÿä¸ä¼šè¿™ä¹ˆç›´æ¥ã€‚å®ƒä¼šè¶ä½ æ…¢æ…¢æ¬£èµæŸäº›ç‰‡æ®µæ—¶ï¼Œæ—©å°±å°†æ•°æ®ä»æ…¢è…¾è…¾çš„ç£ç›˜é¢„è¯»åˆ°å¿«å¦‚é—ªç”µçš„å†…å­˜ä¸­äº†ï¼Œè¿™ä¸ªä½äºç£ç›˜å’Œæ’­æ”¾å™¨ç¨‹åºä¹‹é—´çš„ç¼“å­˜åŒºï¼Œæ˜¯å¾ˆåƒä½ è¯´çš„ç®¡å­ï¼Œä½†å®ƒçœŸçš„å’Œæµè¿™ä¸ªå¯¹è±¡æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œåœ¨ä»£ç ä¸­çš„æµå¯¹è±¡çœ‹æ¥ é‚£ç¼“å­˜åŒºå°±æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„æ–‡ä»¶ã€‚\n\nJAVAä»£ç æ˜¯åœ¨[è™šæ‹Ÿæœº](https://www.zhihu.com/search?q=%E8%99%9A%E6%8B%9F%E6%9C%BA\u0026search_source=Entity\u0026hybrid_search_source=Entity\u0026hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A44911601%7D)\n\nä¸Šè·‘çš„ï¼Œæ‰€ä»¥åœ¨æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„ç¼“å­˜åŒºè¿™ç®¡å­åé¢ï¼Œå¯èƒ½è¿˜è¦å†æ¥ä¸€æˆªè™šæ‹Ÿæœºæä¾›çš„ç®¡å­ã€‚å¹¶ä¸”ï¼Œçœ‹è¿‡å‡€æ°´æœºçš„å¹¿å‘Šå§ï¼Ÿ ä»€ä¹ˆåå…«è¿‡æ»¤èŠ¯å±‚å±‚å‡€åŒ–ï¼Œé‚£å°±æ˜¯JAVAè™šæ‹Ÿæœºæˆ–è¿è¡Œæ—¶æä¾›çš„ï¼Œç”¨äºè½¬æ¢æ•°æ®ç¼–ç ä»€ä¹ˆçš„ã€‚\n\n  \n\næµè¿™ä¸ªæ¯”å–»çš„æœ¬è´¨å°±æ˜¯ä¸ºäº†è®©æŸä¸ªå¯¹è±¡å¯ä»¥å‡åŒ€æŒç»­åœ°åå‡ºæ— é—´éš”çš„æ•°æ®ï¼Œæˆ–è€…ä½ å¯ä»¥å‘è¿™ä¸ªå¯¹è±¡æ¯«æ— å‹åŠ›åœ°æŒç»­ä¸æ–­å¡è¿›æ•°æ®ã€‚ã€‚ã€‚ã€‚è‡³äºé‚£äº›ç®¡å­ã€‚ã€‚ã€‚æ°æ°æ˜¯å› ä¸ºç°å®ä¸–ç•Œä¸å¤Ÿç¬¦åˆè¿™ä¸ªè¦æ±‚ï¼Œæ‰€ä»¥å¿…é¡»æœ‰ã€‚ç»å…¸ä¾‹å­æ”¹æˆç½‘ä¸Šçœ‹è¶…å¤§çš„ç‰‡å­ã€‚æˆ‘ä»¬å¸Œæœ›ç½‘ç»œæ˜¯ä¸€ä¸ªç¬¦åˆæˆ‘ä»¬è¯´çš„æ¡ä»¶çš„æµï¼Œå®ƒå¿…é¡»è¿ç»­å‡ºæ•°æ®ï¼Œä½†å®ƒåšä¸åˆ°ï¼Œå®ƒå¡å¡å¡çš„ï¼Œå¤ªåƒæ˜¯åœ¨å’³å—½åç»“çŸ³äº†â€¦â€¦è®¤çœŸå›ç­”æˆ‘ï¼Œçœ‹ç‰‡å­å¾ˆå¡ï¼Œä½ ä¼šæœ‰â€œæµâ€çš„ä»»ä½•è”æƒ³å’Œæ„Ÿå—å—ã€‚ã€‚æ€ä¹ˆåŠï¼Ÿä½ å…ˆç­‰ç­‰ï¼Œæ“ä½œç³»ç»Ÿå·²ç»å‡†å¤‡äº†ä¸ªé•¿ç®¡å­ï¼Œå¸®ä½ ç¼“å­˜ä¸€å¤§æ®µä½ å†çœ‹ï¼Œè¿™å›å°±å¾ˆæµå¾ˆæµçš„æ„Ÿè§‰äº†ã€‚\n\n  \n\næ‰€ä»¥ï¼Œç®¡å­ä»€ä¹ˆçš„ï¼Œé‚£ä¸æ˜¯æµï¼Œé‚£æ˜¯ä¸å¾—ä¸è¦é å®ƒä»¬æ¥è£…ï¼ˆè£…é€¼çš„è£… ä¸æ˜¯è£…æ”¾çš„è£…ï¼‰æµçš„æèŠ‚ã€‚é€šå¸¸æ˜¯ä¼Ÿå¤§çš„Cç¨‹åºå‘˜ä»¬è¦ç®¡çš„äº‹ã€‚\n\næœ€åæœ‰å…³ç½‘çº¿ã€‚ã€‚ã€‚ä½ è¦ä»å…¬å¸å›å®¶ï¼Œå…¬å¸æ˜¯Aç«¯ï¼Œå®¶æ˜¯Bç«¯ï¼Œä½ æ˜¯æ•°æ®ï¼Œä¸¤ä¸ªé—®é¢˜è¯·å›ç­”ï¼š\n\nä¸€ï¼Œä½ å›å®¶ä¸ä»ä»»ä½•è·¯ä¸Šç»è¿‡ï¼Œä½ é—­ä¸Šçœ¼ç›å¿ƒé‡Œé»˜å¿µæˆ‘è¦å›å®¶ï¼Œç„¶åå°±ç¬é—´è½¬ç§»åˆ°å®¶é‡Œå‡ºç°äº†ï¼Ÿï¼Ÿ\n\näºŒï¼Œä½ æ‹‰å¼€å®¶é—¨ï¼Œä½ è€å©†ä¼šè¯´ï¼šå“Ÿï¼Œä»å…¬å¸å›æ¥äº†å‘€ï¼Ÿ è¿˜æ˜¯å¥¹å¾ˆè®¤çœŸä¸¥è°¨åœ°è¯´ï¼šå“Ÿï¼Œä»é©¬è·¯ä¸Šå›æ¥äº†å‘€ï¼Ÿ\n\nå†è¯´ä¸‰ç‚¹ï¼šä¸€ï¼Œç‰©ç†ä¸Šä½ æ— æ³•ç›´æ¥ä»å…¬å¸è½¬ç§»åˆ°å®¶ï¼Œæ‰€ä»¥éœ€è¦é©¬è·¯ç®¡å­ã€‚äºŒï¼Œä½ è€å©†å…³å¿ƒä»¥åŠè®¤çŸ¥ä½ æ˜¯ä»å…¬å¸è¿˜æ˜¯æŸäº›å¥¹ä¸å–œæ¬¢çš„åº—å›æ¥çš„ï¼Œé€šå¸¸ä¸å…³å¿ƒä½ ä»å“ªæ¡é©¬è·¯å›æ¥äº†ã€‚ä¸‰ï¼Œä½†ä½ ä¹Ÿä¸æ˜¯ä¸€ä¸ªæµï¼Œé™¤éå“ªå¤©ä½ æœ‰ä¸ªå­©å­ï¼Œå¹¶ä¸”å­©å­æ—¥å¿—é‡Œå†™åˆ°ï¼šä¸‹åˆï¼Œçˆ¸çˆ¸é™†é™†ç»­ç»­åœ°å›æ¥äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\n\n## javaä¸­çš„æµ\n\nJavaæ‰€æœ‰çš„I/Oæœºåˆ¶éƒ½æ˜¯åŸºäºæ•°æ®æµè¿›è¡Œè¾“å…¥è¾“å‡ºï¼Œè¿™äº›æ•°æ®æµè¡¨ç¤ºäº†å­—ç¬¦æˆ–è€…å­—èŠ‚æ•°æ®çš„æµåŠ¨åºåˆ—ã€‚Javaçš„I/Oæµæä¾›äº†è¯»å†™æ•°æ®çš„æ ‡å‡†æ–¹æ³•ã€‚ä»»ä½•Javaä¸­è¡¨ç¤ºæ•°æ®æºçš„å¯¹è±¡éƒ½ä¼šæä¾›ä»¥æ•°æ®æµçš„æ–¹å¼è¯»å†™å®ƒçš„æ•°æ®çš„æ–¹æ³•ã€‚\n\næ ‡å‡†è¾“å…¥è¾“å‡ºï¼Œæ–‡ä»¶çš„æ“ä½œï¼Œç½‘ç»œä¸Šçš„æ•°æ®æµï¼Œå­—ç¬¦ä¸²æµï¼Œå¯¹è±¡æµï¼Œzipæ–‡ä»¶æµç­‰ç­‰ï¼Œjavaä¸­å°†è¾“å…¥è¾“å‡ºæŠ½è±¡ç§°ä¸ºæµï¼Œå°±å¥½åƒæ°´ç®¡ï¼Œå°†ä¸¤ä¸ªå®¹å™¨è¿æ¥èµ·æ¥ã€‚å°†æ•°æ®å†²å¤–å­˜ä¸­è¯»å–åˆ°å†…å­˜ä¸­ï¼ˆä¾›Javaç¨‹åºä½¿ç”¨ï¼‰çš„ç§°ä¸º[è¾“å…¥æµ](https://www.zhihu.com/search?q=%E8%BE%93%E5%85%A5%E6%B5%81\u0026search_source=Entity\u0026hybrid_search_source=Entity\u0026hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A260699828%7D)\n\nï¼Œå°†æ•°æ®ä»å†…å­˜å†™å…¥å¤–å­˜ä¸­çš„ç§°ä¸º[è¾“å‡ºæµ](https://www.zhihu.com/search?q=%E8%BE%93%E5%87%BA%E6%B5%81\u0026search_source=Entity\u0026hybrid_search_source=Entity\u0026hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A260699828%7D)\n\nã€‚\n\næµæ˜¯ä¸€ä¸ªå¾ˆå½¢è±¡çš„æ¦‚å¿µï¼Œå½“ç¨‹åºéœ€è¦è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šå¼€å¯ä¸€ä¸ªé€šå‘æ•°æ®æºçš„æµï¼Œè¿™ä¸ªæ•°æ®æºå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œå†…å­˜ï¼Œæˆ–æ˜¯ç½‘ç»œè¿æ¥ã€‚ç±»ä¼¼çš„ï¼Œå½“ç¨‹åºéœ€è¦å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šå¼€å¯ä¸€ä¸ªé€šå‘ç›®çš„åœ°çš„æµã€‚\n\næµæ˜¯ä¸€ç»„æœ‰é¡ºåºçš„ï¼Œæœ‰èµ·ç‚¹å’Œç»ˆç‚¹çš„å­—èŠ‚é›†åˆï¼Œæ˜¯å¯¹æ•°æ®ä¼ è¾“çš„æ€»ç§°æˆ–æŠ½è±¡ã€‚å³æ•°æ®åœ¨ä¸¤è®¾å¤‡é—´çš„ä¼ è¾“ç§°ä¸ºæµï¼Œæµçš„æœ¬è´¨æ˜¯æ•°æ®ä¼ è¾“ï¼Œæ ¹æ®æ•°æ®ä¼ è¾“ç‰¹æ€§å°†æµæŠ½è±¡ä¸ºå„ç§ç±»ï¼Œæ–¹ä¾¿æ›´ç›´è§‚çš„è¿›è¡Œæ•°æ®æ“ä½œã€‚\n\næµçš„åˆ†ç±»ï¼š\n\næµçš„åˆ†ç±»ï¼ŒJavaçš„æµåˆ†ç±»æ¯”è¾ƒä¸°å¯Œï¼Œåˆšæ¥è§¦çš„äººçœ‹äº†åä¼šæ„Ÿè§‰å¾ˆæ™•ã€‚æµåˆ†ç±»çš„æ–¹å¼å¾ˆå¤šï¼š\n\n1ã€æŒ‰ç…§è¾“å…¥çš„æ–¹å‘åˆ†ï¼Œè¾“å…¥æµå’Œè¾“å‡ºæµï¼Œè¾“å…¥è¾“å‡ºçš„å‚ç…§å¯¹è±¡æ˜¯Javaç¨‹åºã€‚\n\n2ã€æŒ‰ç…§å¤„ç†æ•°æ®çš„å•ä½ä¸åŒåˆ†ï¼Œå­—èŠ‚æµå’Œ[å­—ç¬¦æµ](https://www.zhihu.com/search?q=%E5%AD%97%E7%AC%A6%E6%B5%81\u0026search_source=Entity\u0026hybrid_search_source=Entity\u0026hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A260699828%7D)\n\nï¼Œå­—èŠ‚æµè¯»å–çš„æœ€å°å•ä½æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼ˆ1byte=8bitï¼‰ï¼Œè€Œå­—ç¬¦æµä¸€æ¬¡å¯ä»¥è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼ˆ1char = 2byte = 16bitï¼‰ã€‚\n\n3ã€æŒ‰ç…§åŠŸèƒ½çš„ä¸åŒåˆ†ï¼Œåˆ†èŠ‚ç‚¹æµå’Œå¤„ç†æµï¼ŒèŠ‚ç‚¹æµæ˜¯ç›´æ¥ä»ä¸€ä¸ªæºè¯»å†™æ•°æ®çš„æµï¼ˆè¿™ä¸ªæµæ²¡æœ‰ç»è¿‡åŒ…è£…å’Œä¿®é¥°ï¼‰ï¼Œå¤„ç†æµæ˜¯åœ¨å¯¹èŠ‚ç‚¹æµå°è£…çš„åŸºç¡€ä¸Šçš„ ä¸€ç§æµï¼ŒFileInputStreamæ˜¯ä¸€ä¸ªèŠ‚ç‚¹æµï¼Œå¯ä»¥ç›´æ¥ä»æ–‡ä»¶è¯»å–æ•°æ®ï¼Œä½†æ˜¯BufferedInputStreamå¯ä»¥åŒ…è£… FileInputStreamï¼Œä½¿å¾—å…¶æœ‰ç¼“å†²åŠŸèƒ½ã€‚\n\næµçš„ç±»ç»“æ„å›¾ï¼š\n\n![[z-oblib/z2-attachments/20191013212051298.png]]\n\n![[z-oblib/z2-attachments/20191014111930276.png]]\n\nJavaä¸­â€œæµâ€çš„æ¦‚å¿µä¸ç®€ä»‹\n\nå­—èŠ‚æµä¸å­—ç¬¦æµï¼š\n\nå­—ç¬¦æµçš„ç”±æ¥ï¼š å› ä¸ºæ•°æ®ç¼–ç çš„ä¸åŒï¼Œè€Œæœ‰äº†å¯¹å­—ç¬¦è¿›è¡Œé«˜æ•ˆæ“ä½œçš„æµå¯¹è±¡ã€‚æœ¬è´¨å…¶å®å°±æ˜¯**åŸºäºå­—èŠ‚æµè¯»å–æ—¶ï¼Œå»æŸ¥äº†æŒ‡å®šçš„ç è¡¨**ã€‚ å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«ï¼š\n\nè¯»å†™å•ä½ä¸åŒï¼šå­—èŠ‚æµä»¥å­—èŠ‚ï¼ˆ8bitï¼‰ä¸ºå•ä½ï¼Œå­—ç¬¦æµä»¥å­—ç¬¦ä¸ºå•ä½ï¼Œæ ¹æ®ç è¡¨æ˜ å°„å­—ç¬¦ï¼Œä¸€æ¬¡å¯èƒ½è¯»å¤šä¸ªå­—èŠ‚ã€‚\n\nå¤„ç†å¯¹è±¡ä¸åŒï¼šå­—èŠ‚æµèƒ½å¤„ç†æ‰€æœ‰ç±»å‹çš„æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€aviç­‰ï¼‰ï¼Œè€Œå­—ç¬¦æµåªèƒ½å¤„ç†å­—ç¬¦ç±»å‹çš„æ•°æ®ã€‚\n\nç»“è®ºï¼šåªè¦æ˜¯å¤„ç†çº¯æ–‡æœ¬æ•°æ®ï¼Œå°±ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨å­—ç¬¦æµã€‚é™¤æ­¤ä¹‹å¤–éƒ½ä½¿ç”¨å­—èŠ‚æµã€‚\n\nè¿™é‡Œéœ€è¦æåˆ°çš„ä¸€å¥æ˜¯ï¼šä¸€ä¸ªè‹±æ–‡å­—ç¬¦çš„é•¿åº¦æ˜¯1byteï¼Œè€Œæ±‰å­—çš„é•¿åº¦æ˜¯2byte. å¦‚æœæˆ‘ä»¬æŠŠè‹±æ±‰æ··åˆçš„æ–‡æ¡£ç»Ÿä¸€æŒ‰ç…§å­—èŠ‚æµå¤„ç†ï¼Œå°±ä¼šå‡ºç°åˆ†å‰²æ··ä¹±ï¼Œå‡ºç°ä¹±ç ã€‚è¿™æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å­—ç¬¦æµæ¥å¤„ç†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å¤„ç†æ–‡æ¡£çš„æ—¶å€™ï¼Œéƒ½è¦æŠŠinputstreamæ”¾åˆ°FileReaderä¸­ã€‚\n\næ–¹å‘æ€§ï¼š\n\næµåˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµã€‚ä½†è¿™éƒ½æ˜¯ç›¸å¯¹çš„ã€‚ç‰¹åˆ«æ˜¯åœ¨Hadoopçš„åºåˆ—åŒ–æ—¶ï¼Œæ€»æ˜¯ä¸çŸ¥é“åˆ°åº•ä½¿ç”¨è¾“å…¥æµè¿˜æ˜¯è¾“å‡ºæµã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åšä¸ªåŒºåˆ†ï¼š\n\nåºåˆ—åŒ–ï¼Œå°±æ˜¯æŠŠæ•°æ®åšå­—èŠ‚æµå¤„ç†ã€‚è€Œå­—èŠ‚æµåªæ˜¯ä¸€ç§å­˜å‚¨å½¢å¼ã€‚ä»–ä¸ä¼šè¢«ç¨‹åºè¯†åˆ«ï¼Œéœ€è¦æŠŠå­—èŠ‚æµååºåˆ—åŒ–ä¸ºjavaè¯†åˆ«çš„å¯¹è±¡ï¼Œæ‰å¯ä»¥è¢«javaç¨‹åºè¯†åˆ«ã€‚æ‰€ä»¥ï¼Œåºåˆ—åŒ–å°±æ˜¯å­—èŠ‚æµåŒ–ï¼Œå°±æ˜¯ä»javaä»£ç æˆ–å†…å­˜ä¸­è¾“å‡ºåˆ°å¤–å­˜ã€‚è€Œååºåˆ—åŒ–å°±æ˜¯å¯¹è±¡åŒ–ï¼Œå°±æ˜¯ä»å¤–å­˜ä¸­å°†å­—èŠ‚æµæ•°æ®è½¬åŒ–ä¸ºç¨‹åºè¯†åˆ«çš„å¯¹è±¡ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8":{"title":"ç±»åŠ è½½å™¨","content":"# ç±»åŠ è½½å™¨\n\n## ç®€ä»‹\n\nä¸€ä¸ªå¯ä»¥å°†Javaå­—èŠ‚ç åŠ è½½ä¸º`java.lang.Class`å®ä¾‹çš„å·¥å…·ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬ï¼Œè¯»å–å­—èŠ‚æ•°ç»„ã€éªŒè¯ã€è§£æã€åˆå§‹åŒ–ç­‰ã€‚å¦å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥åŠ è½½èµ„æºï¼ŒåŒ…æ‹¬å›¾åƒæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ã€‚\n\n## ç‰¹ç‚¹\n\n- åŠ¨æ€åŠ è½½ï¼Œæ— éœ€åœ¨ç¨‹åºä¸€å¼€å§‹è¿è¡Œçš„æ—¶å€™åŠ è½½ï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€æŒ‰éœ€åŠ è½½ï¼Œå­—èŠ‚ç çš„æ¥æºä¹Ÿå¾ˆå¤šï¼Œå‹ç¼©åŒ…jarã€warä¸­ï¼Œç½‘ç»œä¸­ï¼Œæœ¬åœ°æ–‡ä»¶ç­‰ã€‚ç±»åŠ è½½å™¨åŠ¨æ€åŠ è½½çš„ç‰¹ç‚¹ä¸ºçƒ­éƒ¨ç½²ï¼Œçƒ­åŠ è½½åšäº†æœ‰åŠ›æ”¯æŒã€‚\n- å…¨ç›˜è´Ÿè´£ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼Œè¿™ä¸ªç±»æ‰€ä¾èµ–çš„ã€å¼•ç”¨çš„å…¶ä»–æ‰€æœ‰ç±»éƒ½ç”±è¿™ä¸ªç±»åŠ è½½å™¨åŠ è½½ï¼Œé™¤éåœ¨ç¨‹åºä¸­æ˜¾å¼åœ°æŒ‡å®šå¦å¤–ä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½ã€‚æ‰€ä»¥ç ´ååŒäº²å§”æ´¾ä¸èƒ½ç ´åæ‰©å±•ç±»åŠ è½½å™¨ä»¥ä¸Šçš„é¡ºåºã€‚\n\n## ä¸ºä½•éœ€è¦å¤šä¸ªç±»åŠ è½½å™¨\n\n**æ€è€ƒä»¥ä¸‹æƒ…æ™¯ï¼š**\n\n1. **é¦–å…ˆï¼Œæ˜¯ä¸ºäº†åŒºåˆ†åŒåçš„ç±»**ï¼šå‡å®šå­˜åœ¨ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œä¸Šé¢éƒ¨ç½²ç€è®¸å¤šç‹¬ç«‹çš„åº”ç”¨ï¼ŒåŒæ—¶ä»–ä»¬æ‹¥æœ‰è®¸å¤šåŒåå´ä¸åŒç‰ˆæœ¬çš„ç±»åº“ã€‚è¯•æƒ³ï¼Œè¿™æ—¶å€™ jvm è¯¥æ€ä¹ˆåŠ è½½è¿™äº›ç±»åŒæ—¶èƒ½å°½å¯èƒ½çš„é¿å…æ‰ç±»åŠ è½½æ—¶å¯¹åŒåç±»çš„å·®å¼‚æ£€æµ‹å‘¢ï¼Ÿ_å½“ç„¶æ˜¯ä¸åŒçš„åº”ç”¨éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç±»åŠ è½½å™¨äº†ã€‚_\n2. **å…¶æ¬¡ï¼Œæ˜¯ä¸ºäº†æ›´æ–¹ä¾¿çš„åŠ å¼ºç±»çš„èƒ½åŠ›**ï¼šç±»åŠ è½½å™¨å¯ä»¥åœ¨ load class æ—¶å¯¹ class è¿›è¡Œé‡å†™å’Œè¦†ç›–ï¼Œåœ¨æ­¤æœŸé—´å°±å¯ä»¥å¯¹ç±»è¿›è¡ŒåŠŸèƒ½æ€§çš„å¢å¼ºã€‚æ¯”å¦‚æ·»åŠ é¢å‘åˆ‡é¢ç¼–ç¨‹æ—¶ç”¨åˆ°çš„åŠ¨æ€ä»£ç†ï¼Œä»¥åŠ debug ç­‰åŸç†ã€‚æ€ä¹ˆæ ·è¾¾åˆ°ä»…ä¿®æ”¹ä¸€ä¸ªç±»åº“è€Œä¸å¯¹å…¶ä»–ç±»åº“äº§ç”Ÿå½±å“çš„æ•ˆæœå‘¢ï¼Ÿ_ä¸€ä¸ªæ¯”è¾ƒæ–¹ä¾¿çš„æ¨¡å¼å°±æ˜¯æ¯ä¸ªç±»åº“éƒ½å¯ä»¥ä½¿ç”¨ç‹¬ç«‹çš„ç±»åŠ è½½å™¨_\n\nä¸€ä¸ªç±»çš„å”¯ä¸€æ€§ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»çš„æœ¬èº«å†³å®šï¼ˆç±»çš„å…¨é™å®šå+ç±»åŠ è½½å™¨çš„å®ä¾‹IDä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼‰ã€‚æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦ç›¸ç­‰ï¼ˆåŒ…æ‹¬Classå¯¹è±¡çš„`equals()`ã€`isAssignableFrom()`ã€`isInstance()`ä»¥åŠ`instanceof`å…³é”®å­—ç­‰ï¼‰ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œè¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ã€‚\n\njvm éœ€è¦æœ‰ä¸åŒçš„ç±»åŠ è½½å™¨ï¼Œå› ä¸ºå®ƒä¸€æ–¹é¢å…è®¸ä½ åœ¨ä¸€ä¸ª jvm é‡Œè¿è¡Œä¸åŒçš„åº”ç”¨ç¨‹åºï¼Œå¦ä¸€æ–¹é¢æ–¹ä¾¿ä½ ç‹¬ç«‹çš„å¯¹ä¸åŒç±»åº“è¿›è¡Œè¿è¡Œæ—¶å¢å¼ºã€‚\n\n## åˆ†ç±»\n\nä»å®ç°æ–¹å¼ä¸Šï¼Œç±»åŠ è½½å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯**å¯åŠ¨ç±»åŠ è½½å™¨**ï¼Œç”±C++è¯­è¨€å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼›å¦ä¸€ç§æ˜¯ç»§æ‰¿äº`java.lang.ClassLoader`çš„ç±»åŠ è½½å™¨ï¼ŒåŒ…æ‹¬**æ‰©å±•ç±»åŠ è½½å™¨**ã€**åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨**ä»¥åŠè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚\n\n### å¯åŠ¨ç±»åŠ è½½å™¨\n\nï¼ˆ`Bootstrap ClassLoader`ï¼‰ï¼šè´Ÿè´£åŠ è½½`\u003cJAVA_HOME\u003e\\lib`ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«`-Xbootclasspath`å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆä»…æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨libç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚**å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨**ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœæƒ³è®¾ç½®`Bootstrap ClassLoader`ä¸ºå…¶`parent`ï¼Œ**å¯ç›´æ¥è®¾ç½®null**ã€‚\n\n### æ‰©å±•ç±»åŠ è½½å™¨\n\nï¼ˆ`Extension ClassLoader`ï¼‰ï¼šè´Ÿè´£åŠ è½½`\u003cJAVA_HOME\u003e\\lib\\ext`ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«`java.ext.dirs`ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ã€‚è¯¥ç±»åŠ è½½å™¨ç”±`sun.misc.Launcher$ExtClassLoader`å®ç°ã€‚æ‰©å±•ç±»åŠ è½½å™¨ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œå…¶çˆ¶ç±»åŠ è½½å™¨ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå³`parent=null`ã€‚\n\n### åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨\n\nï¼ˆ`Application ClassLoader`ï¼‰ï¼šè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆ`ClassPath`ï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ï¼Œç”±`sun.misc.Launcher$App-ClassLoader`å®ç°ã€‚å¼€å‘è€…å¯ç›´æ¥é€šè¿‡`java.lang.ClassLoader`ä¸­çš„`getSystemClassLoader()`æ–¹æ³•è·å–åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œæ‰€ä»¥ä¹Ÿå¯ç§°å®ƒä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ä¹Ÿæ˜¯å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œä½†æ˜¯å®ƒçš„çˆ¶ç±»åŠ è½½å™¨æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ã€‚åœ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ä¸€èˆ¬æ˜¯é»˜è®¤ç±»åŠ è½½å™¨ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E7%BB%84%E5%90%88%E4%BC%98%E4%BA%8E%E7%BB%A7%E6%89%BF":{"title":"ç»„åˆä¼˜äºç»§æ‰¿","content":"# ç»„åˆä¼˜äºç»§æ‰¿\n\n\u003e 1. Program to an interface, not an implementation. (é¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°)  \n\u003e   \n\u003e 2. Favor object composition over class inheritance.ï¼ˆå¦‚æœæŸä¸ªåœºæ™¯çš„ä»£ç å¤ç”¨æ—¢å¯ä»¥é€šè¿‡ç±»ç»§æ‰¿å®ç°ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡å¯¹è±¡ç»„åˆå®ç°ï¼Œ å°½é‡é€‰æ‹©å¯¹è±¡ç»„åˆçš„è®¾è®¡æ–¹å¼ï¼‰\n\nç¬¬ä¸€ä¸ªåŸåˆ™çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š å¯ä»¥æå¤§ç¨‹åº¦åœ°å‡å°‘å­ç³»ç»Ÿå…·ä½“å®ç°ä¹‹é—´çš„ç›¸äº’ä¾èµ–ã€‚  \nç¬¬äºŒä¸ªåŸåˆ™åˆ™ä¸é‚£ä¹ˆå®¹æ˜“ç†è§£ï¼Œ ä¸‹é¢å±•å¼€å™è¿° ã€‚\n\n## ç»„åˆå’Œç»§æ‰¿çš„åŒºåˆ«\n\n| ç»„åˆ           | ç»§æ‰¿                        |\n|--------------|---------------------------|\n| has-a        | is-a                      |\n| ä¸ç ´åå°è£…        | ç ´åå°è£…ï¼Œå­ç±»ä¾èµ–çˆ¶ç±»               |\n| æ”¯æŒæ‰©å±•ï¼Œéšæ„å¢åŠ ç»„åˆç±» | åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œå¿…é¡»åŒ…å«æ‰€æœ‰æ–¹æ³•ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ |\n\n- é€šè¿‡**ç»§æ‰¿**å®ç°çš„ä»£ç å¤ç”¨å¸¸å¸¸æ˜¯ä¸€ç§â€œ**ç™½ç›’å¤ç”¨**â€ï¼Œ è¿™é‡Œçš„ç™½ç›’æŒ‡çš„æ˜¯å¯è§æ€§ï¼š å¯¹äºç»§æ‰¿æ¥è¯´ï¼Œçˆ¶ç±»çš„å†…éƒ¨å®ç°å¯¹äºå­ç±»æ¥è¯´æ˜¯ä¸é€æ˜çš„ï¼ˆå®ç°ä¸€ä¸ªå­ç±»æ—¶ï¼Œ ä½ éœ€è¦äº†è§£çˆ¶ç±»çš„å®ç°ç»†èŠ‚ï¼Œ ä»¥æ­¤å†³å®šæ˜¯å¦éœ€è¦é‡å†™æŸä¸ªæ–¹æ³•ï¼‰ã€‚\n- å¯¹è±¡**ç»„åˆ**å®ç°çš„ä»£ç å¤ç”¨åˆ™æ˜¯ä¸€ç§â€œ**é»‘ç›’å¤ç”¨**â€: å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ä¸å¯è§ï¼Œå¯¹è±¡ä»…ä»…æ˜¯ä»¥â€œé»‘ç›’â€çš„æ–¹å¼å‡ºç°ï¼ˆå¯ä»¥é€šè¿‡æ”¹å˜å¯¹è±¡å¼•ç”¨æ¥æ”¹å˜å…¶è¡Œä¸ºæ–¹å¼ï¼‰ã€‚\n\n## åˆ¤æ–­æ˜¯ç»§æ‰¿è¿˜æ˜¯ç»„åˆ\n\næ‰€ä»¥ä¸éš¾å‘ç°ï¼Œ å½“æˆ‘ä»¬æ‹¿**ç±»ç»§æ‰¿**å’Œ**ç»„åˆ**åœ¨ä¸€èµ·è¿›è¡Œå¯¹æ¯”æ—¶ï¼Œ å¹¶ä¸æ˜¯ä»¥å®ç°æ–¹å¼ä¸­æ˜¯å¦æœ‰ç”¨åˆ°ç±»ç»§æ‰¿è€ŒåŒºåˆ†çš„ã€‚\n\næˆ‘ä»¬çœŸæ­£å…³æ³¨çš„æ˜¯**è¡Œä¸ºçš„ç»§æ‰¿**ä¸**è¡Œä¸ºçš„ç»„åˆ** ï¼šéœ€è¦å˜åŒ–çš„è¡Œä¸ºæ˜¯é€šè¿‡ **ç»§æ‰¿åé‡å†™çš„æ–¹å¼** å®ç°ï¼Œ è¿˜æ˜¯é€šè¿‡ **èµ‹äºˆä¸åŒçš„è¡Œä¸ºå®ä¾‹** å®ç°ã€‚\n\n## ç»§æ‰¿ä¼˜ç¼ºç‚¹\n\n### ä¼˜ç‚¹\n\n- ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»æ—¶åœ¨ç¼–è¯‘æ—¶åˆ»é™æ€åœ°å®šä¹‰å¥½çš„ï¼Œ å› æ­¤ä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸ç›´è§‚ï¼Œ æ¯•ç«Ÿç»§æ‰¿æ˜¯è¢«ç¼–ç¨‹è¯­è¨€æœ¬èº«æ‰€æ”¯æŒçš„åŠŸèƒ½ã€‚\n- ç±»ç»§æ‰¿ä¹Ÿä½¿å¾—ä¿®æ”¹è¦é‡ç”¨çš„ä»£ç å˜å¾—ç›¸å¯¹å®¹æ˜“ï¼Œ å› ä¸ºå¯ä»¥ä»…ä»…é‡å†™è¦æ›´æ”¹çš„çˆ¶ç±»æ–¹æ³•ã€‚\n\n### ç¼ºç‚¹\n\n- ç¬¬ä¸€ä¸ªç¼ºç‚¹æ˜¯ä¼´éšç¬¬ä¸€ä¸ªä¼˜ç‚¹è€Œç”Ÿçš„ï¼š æ²¡æœ‰åŠæ³•åœ¨è¿è¡Œæ—¶åˆ»æ”¹å˜ç»§æ‰¿äº†çˆ¶ç±»çš„å­ç±»è¡Œä¸ºã€‚\n- ç¬¬äºŒä¸ªç¼ºç‚¹ä¸ç¬¬ä¸€ä¸ªç¼ºç‚¹ç›¸æ¯”å¾€å¾€æ›´ä¸¥é‡ï¼š é€šè¿‡ç»§æ‰¿å®ç°çš„ä»£ç å¤ç”¨ï¼Œæœ¬è´¨ä¸ŠæŠŠçˆ¶ç±»çš„å†…éƒ¨å®ç°ç»†èŠ‚æš´éœ²ç»™äº†å­ç±»ï¼Œ å­ç±»çš„å®ç°ä¼šå’Œçˆ¶ç±»çš„å®ç°ç´§å¯†çš„ç»‘å®šåœ¨ä¸€èµ·ï¼Œ ç»“æœæ˜¯çˆ¶ç±»å®ç°çš„æ”¹åŠ¨ï¼Œä¼šå¯¼è‡´å­ç±»ä¹Ÿå¿…é¡»å¾—æ”¹å˜ã€‚\n\n#### ç»§æ‰¿å¦‚ä½•ç ´åå°è£…æ€§\n\n```java\npublic class A {\n    //æ–¹æ³•åŠŸèƒ½æ˜¯è¯´è¯\n    public void say() {\n        //ä¸€å †è¯´è¯çš„å®ç°ç»†èŠ‚\n    }\n    //æ–¹æ³•åŠŸèƒ½æ˜¯å”±æ­Œ\n    public void song() {\n        //å…·ä½“çš„å®ç°ç»†èŠ‚\n        // æ³¨æ„è¿™é‡Œï¼Œå”±æ­Œçš„å‰æè¦å…ˆè¯´è¯ï¼Œæ‰€ä»¥è°ƒç”¨è‡ªèº«çš„say()æ–¹æ³•\n        say();\n        //ç„¶åä¸€å †å”±æ­Œçš„å®ç°ç»†èŠ‚\n    }\n}\n```\n\n```java\npublic class B extends A{\n    @Override\n    public void say() {\n        //æˆ‘å°±æƒ³å†è¯´è¯ä¹‹å‰å…ˆå‘Šè¯‰å¤§å®¶ä¸€å£°æˆ‘è¦è¯´è¯äº†\n        System.out.println(\"æˆ‘è¦å¼€å§‹è¯´è¯äº†\");\n        super.say();\n    }\n\n    @Override\n    public void song() {\n        //æˆ‘å°±æƒ³å†å”±æ­Œä¹‹å‰å…ˆå‘Šè¯‰å¤§å®¶ä¸€å£°æˆ‘è¦å”±æ­Œäº†\n        System.out.println(\"æˆ‘è¦å¼€å§‹å”±æ­Œäº†\");\n        super.song();\n    }\n\n    public static void main(String[] args) {\n        B b = new B();\n        //ç°åœ¨æˆ‘è¦é«˜æ­Œä¸€é¦–\n        b.song();\n    }\n}\n\n```\n\nç»“æœï¼š\n```\næˆ‘è¦å¼€å§‹å”±æ­Œäº†\næˆ‘è¦å¼€å§‹è¯´è¯äº†\n```\n\nå‡ºç°äº†åªæƒ³å”±æ­Œä½†æ˜¯è¯´è¯äº†çš„é—®é¢˜ã€‚æˆ‘æ˜æ˜å°±æ˜¯æƒ³å”±æ­Œå‘€ï¼Œä¸ºå•¥åˆè¯´æˆ‘å¼€å§‹è¯´è¯äº†ï¼Œ  \nå…¶å®æ˜¯å› ä¸ºç±»Bç»§æ‰¿äº†ç±»A ï¼Œåœ¨ç±»Aä¸­çš„songå®ç°ç»†èŠ‚ä¸­ç”¨äº†say()æ–¹æ³•ï¼Œå¯¼è‡´åœ¨ç±»Bä¸­å…ˆèµ°äº†song()æ–¹æ³•ï¼Œåˆèµ°äº†say()æ–¹æ³•ï¼Œä½†æ˜¯å¯¹äºç±»Bæ¥è¯´æˆ‘ä¸æƒ³çŸ¥é“ä½ èµ°äº†å•¥æ–¹æ³•ï¼Œæˆ‘å°±æ˜¯æƒ³è¦çš„åŠŸèƒ½è€Œå·²ï¼Œå”±æ­Œå°±æ˜¯å”±æ­Œï¼Œè¯´è¯å°±æ˜¯è¯´è¯ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç±»Aä¸­çš„song()æ–¹æ³•æ”¹æˆä¸è°ƒç”¨say()æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªä¸åº”è¯¥å’Œç±»Açš„å®ç°ç»†èŠ‚æœ‰å…³ç³»å•Šï¼Œæˆ‘åªæ˜¯æä¾›äº†æˆ‘çš„APIæ¥å£ï¼ŒåŠŸèƒ½ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæˆ‘çš„å†…éƒ¨å®ç°ç»†èŠ‚æ€ä¹ˆå˜éƒ½åº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„å•Šï¼Œæ‰€ä»¥è¿™å°±æ˜¯ç»§æ‰¿æš´æ¼äº†APIçš„å®ç°ç»†èŠ‚å‡ºç°çš„é—®é¢˜ã€‚\n\n## ç»„åˆçš„ç¼ºç‚¹\n\n- ä¸å…·å¤‡ä¹‹å‰æ‰€ç½—åˆ—çš„ç±»ç»§æ‰¿çš„ä¼˜ç‚¹ã€‚\n\n## ç”¨ç»„åˆæ›¿ä»£ç»§æ‰¿\n\nè€Œå¤åˆå°±ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜äº†,æŠŠç±»Aåšä¸ºä¸€ä¸ªç§æœ‰åŸŸæ”¾å…¥ç±»Bä¸­ã€‚å†è°ƒç”¨ç±»Açš„song()æ–¹æ³•ï¼š\n\n```java\npublic class B {\n    private A a;\n\n    public B(A a) {\n        this.a = a;\n    }\n    public void say() {\n        System.out.println(\"æˆ‘è¦å¼€å§‹è¯´è¯äº†\");\n        a.say();\n    }\n\n    public void song() {\n        System.out.println(\"æˆ‘è¦å¼€å§‹å”±æ­Œäº†\");\n        a.song();\n    }\n    \n    public static void main(String[] args) {\n        B b = new B(new A());\n        //ç°åœ¨æˆ‘è¦é«˜æ­Œä¸€é¦–\n        b.song();\n    }\n}\n\n```\n\n```\næˆ‘è¦å¼€å§‹å”±æ­Œäº†\n```\n\nå¯ä»¥çœ‹å‡ºå¤åˆå±è”½äº†ç±»çš„å®ç°ç»†èŠ‚ï¼Œä¸“æ³¨äºåŠŸèƒ½è€Œä¸å…³æ³¨ç»†èŠ‚ã€‚\n\n## æ€»ç»“\n\næ‰€ä»¥ç»§æ‰¿è¦ä¸¥æ ¼çš„éµå¾ªis-açš„å…³ç³»ï¼Œå¦åˆ™ä¸èƒ½çç”¨ç»§æ‰¿ï¼Œåœ¨ç”¨ç»§æ‰¿çš„æ—¶å€™æƒ³å¥½ç»§æ‰¿æ˜¯ä¸æ˜¯åªæ˜¯ä¸ºäº†æ‰©å±•åŠŸèƒ½ã€‚å¦åˆ™å°±ä¸å¾—ä¸ç”¨å¤åˆæ¥ä»£æ›¿ç»§æ‰¿äº†ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E8%BF%AD%E4%BB%A3%E5%99%A8":{"title":"è¿­ä»£å™¨","content":"# è¿­ä»£å™¨\n\n- è¿­ä»£å™¨æ˜¯ä¸€ä¸ªç”¨äºä¿å­˜çŠ¶æ€çš„ç±»ï¼ŒçŠ¶æ€æ˜¯æŒ‡ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡å½“å‰çš„éå†æƒ…å†µï¼Œä¾‹å¦‚å¯è¿­ä»£å¯¹è±¡å…ƒç´ é‡ï¼Œå½“å‰è¿­ä»£æŒ‡é’ˆç­‰ã€‚\n- è¿­ä»£å™¨ä¸»è¦æ˜¯é€šè¿‡å†…éƒ¨ç±»å®ç°ï¼Œæ¯”å¦‚ArrayListå†…éƒ¨æœ‰ä¸ªIteratorç±»ï¼Œè¿™æ ·iteratorå¯ä»¥é€šè¿‡ArrayList.thisè®¿é—®åˆ°å¤–éƒ¨ç±»çš„å†…å®¹ï¼Œæœ€é‡è¦çš„æ˜¯è®¿é—®åˆ°å¤–éƒ¨ç±»ä¸­å­˜å‚¨çš„å…·ä½“æ•°æ®ã€‚\n- è¿­ä»£å™¨è®¾è®¡ä¸Šé™ä½äº†ç©ºé—´å¼€é”€ï¼ˆç»´æŠ¤æŒ‡é’ˆä¿¡æ¯è€Œä¸ç”¨å¤åˆ¶åŸæ•°æ®ï¼‰ï¼Œä¿è¯äº†ä¸åŸæ•°æ®çš„ä¸€è‡´æ€§ï¼ˆå¦‚æœæ˜¯å¤åˆ¶åˆ™å¯èƒ½é€ æˆä¸åŸæ•°æ®ä¸ä¸€è‡´ï¼‰ã€‚\n- iterator()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡å†…éƒ¨çš„è¿­ä»£å™¨å®ä¾‹ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86":{"title":"é™æ€ä»£ç†","content":"# é™æ€ä»£ç†\n\n## æ¦‚è¿°\n\n1. ä»£ç†ç±»å®ç°ç›®æ ‡æ¥å£\n2. ä»£ç†ç±»åœ¨å†…éƒ¨å®ä¾‹åŒ–ä¸€ä¸ªè¢«ä»£ç†ç±»çš„å¯¹è±¡\n3. ä»£ç†ç±»é‡å†™ç›®æ ‡æ–¹æ³•ï¼ŒåŠ å…¥ä¿®æ”¹çš„é€»è¾‘ï¼Œå¹¶å¯ä»¥è°ƒç”¨è¢«ä»£ç†ç±»çš„å¯¹è±¡çš„æ–¹æ³•\n\n## æ¡ˆä¾‹\n\n```java\npublic class StaticProxySample {\n    interface Greet {\n        void sayHello(String name);\n    }\n\n    static class GreetImpl implements Greet {\n        @Override\n        public void sayHello(String name) {\n            System.out.println(\"Hello \" + name);\n        }\n    }\n\n    static class GreetProxyImpl implements Greet {\n\n        private Greet greet = new GreetImpl();\n\n        @Override\n        public void sayHello(String name) {\n            this.greet.sayHello(name);\n        }\n    }\n\n    public static void main(String[] args) {\n        Greet proxy = new GreetProxyImpl();\n        proxy.sayHello(\"creativeworkes\");\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°**Greetmpl**å®ç°äº†**Greet**æ¥å£ï¼ŒåŒæ—¶**GreetProxyImpl**ä¹Ÿå®ç°äº†**Greet**æ¥å£ï¼Œå¹¶ä¸”æŒæœ‰**GreetImpl**å¯¹è±¡çš„å®ä¾‹ï¼Œè¿™å°±æ˜¯é™æ€ä»£ç†çš„å…¸å‹å®ç°ã€‚**GreetProxyImpl**å®ä¾‹ä»£ç†äº†**GreetImpl**çš„åŠŸèƒ½ï¼Œè¿™é‡Œçš„ç¼ºç‚¹å°±å¾ˆæ˜æ˜¾ï¼Œåªè¦**Greet**æœ‰æ–°çš„åŠŸèƒ½æ·»åŠ ï¼Œ**GreetImpl**å’Œ**GreetProxyImpl**ç±»éƒ½è¦å®ç°ï¼Œä¸åŒçš„æ˜¯**GreetProxyImpl**ä½¿ç”¨äº†**GreetImpl**ç±»çš„å®ç°ï¼Œè¿™æ ·çš„å®ç°è€¦åˆåº¦éå¸¸é«˜ï¼Œå¯¹åæœŸæ‹“å±•æ¥è¯´æ˜¯éå¸¸ä¸å‹å¥½çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¯´è¯´åŠ¨æ€ä»£ç†æ˜¯æ€æ ·çš„ï¼Œä»¥åŠå¦‚ä½•è§£å†³åˆšæ‰é‡åˆ°çš„é—®é¢˜ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/HashMap":{"title":"HashMap","content":"\n# HashMap\n\n## å¹¶å‘é—®é¢˜\n\n### JDK7å¹¶å‘æ­»é“¾\n\n```java\npublic static void main(String[] args) {\n    // æµ‹è¯• java 7 ä¸­å“ªäº›æ•°å­—çš„ hash ç»“æœç›¸ç­‰\n    System.out.println(\"é•¿åº¦ä¸º16æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key\");\n    for (int i = 0; i \u003c 64; i++) {\n        if (hash(i) % 16 == 1) {\n            System.out.println(i);\n        }\n    }\n    System.out.println(\"é•¿åº¦ä¸º32æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key\");\n    for (int i = 0; i \u003c 64; i++) {\n        if (hash(i) % 32 == 1) {\n            System.out.println(i);\n        }\n    }\n    // 1, 35, 16, 50 å½“å¤§å°ä¸º16æ—¶ï¼Œå®ƒä»¬åœ¨ä¸€ä¸ªæ¡¶å†…\n    final HashMap\u003cInteger, Integer\u003e map = new HashMap\u003cInteger, Integer\u003e();\n    // æ”¾ 12 ä¸ªå…ƒç´ \n    map.put(2, null);\n    map.put(3, null);\n    map.put(4, null);\n    map.put(5, null);\n    map.put(6, null);\n    map.put(7, null);\n    map.put(8, null);\n    map.put(9, null);\n    map.put(10, null);\n    // ä¸‹é¢ä¸‰ä¸ªä¼šæ”¾åœ¨ä¸€ä¸ªæ¡¶ä¸­\n    map.put(16, null);\n    map.put(35, null);\n    map.put(1, null);\n \n    System.out.println(\"æ‰©å®¹å‰å¤§å°[main]:\"+map.size());\n    new Thread() {\n        @Override\n        public void run() {\n            // æ”¾ç¬¬ 13 ä¸ªå…ƒç´ , å‘ç”Ÿæ‰©å®¹\n            map.put(50, null);\n            System.out.println(\"æ‰©å®¹åå¤§å°[Thread-0]:\"+map.size());\n        }\n    }.start();\n    new Thread() {\n        @Override\n        public void run() {\n            // æ”¾ç¬¬ 13 ä¸ªå…ƒç´ , å‘ç”Ÿæ‰©å®¹\n            map.put(50, null);\n            System.out.println(\"æ‰©å®¹åå¤§å°[Thread-1]:\"+map.size());\n        }\n    }.start();\n}\n \nfinal static int hash(Object k) {\n    int h = 0;\n    if (0 != h \u0026\u0026 k instanceof String) {\n        return sun.misc.Hashing.stringHash32((String) k);\n    }\n    h ^= k.hashCode();\n    h ^= (h \u003e\u003e\u003e 20) ^ (h \u003e\u003e\u003e 12);\n    return h ^ (h \u003e\u003e\u003e 7) ^ (h \u003e\u003e\u003e 4);\n}\n```\n\n#### æ­»é“¾å¤ç°\n\nè°ƒè¯•å·¥å…·ä½¿ç”¨ idea\nåœ¨ HashMap æºç  590 è¡ŒåŠ æ–­ç‚¹\n```java\nint newCapacity = newTable.length;\n```\næ–­ç‚¹çš„æ¡ä»¶å¦‚ä¸‹ï¼Œç›®çš„æ˜¯è®© HashMap åœ¨æ‰©å®¹ä¸º 32 æ—¶ï¼Œå¹¶ä¸”çº¿ç¨‹ä¸º Thread-0 æˆ– Thread-1 æ—¶åœä¸‹æ¥ï¼š\n```java\nnewTable.length==32 \u0026\u0026 \n    (\n        Thread.currentThread().getName().equals(\"Thread-0\")||\n        Thread.currentThread().getName().equals(\"Thread-1\")\n    )\n```\næ–­ç‚¹æš‚åœæ–¹å¼é€‰æ‹© Threadï¼Œå¦åˆ™åœ¨è°ƒè¯• Thread-0 æ—¶ï¼ŒThread-1 æ— æ³•æ¢å¤è¿è¡Œ\nè¿è¡Œä»£ç ï¼Œç¨‹åºåœ¨é¢„æ–™çš„æ–­ç‚¹ä½ç½®åœäº†ä¸‹æ¥ï¼Œè¾“å‡ºï¼š\n```\né•¿åº¦ä¸º16æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key \n1 \n16 \n35 \n50 \né•¿åº¦ä¸º32æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key \n1 \n35 \næ‰©å®¹å‰å¤§å°[main]:12 \n```\næ¥ä¸‹æ¥è¿›å…¥æ‰©å®¹æµç¨‹è°ƒè¯•\nåœ¨ HashMap æºç  594 è¡ŒåŠ æ–­ç‚¹\n```java\nEntry\u003cK,V\u003e next = e.next; // 593\nif (rehash)              // 594\n// ...\n```\nè¿™æ˜¯ä¸ºäº†è§‚å¯Ÿ e èŠ‚ç‚¹å’Œ next èŠ‚ç‚¹çš„çŠ¶æ€ï¼ŒThread-0 å•æ­¥æ‰§è¡Œåˆ° 594 è¡Œï¼Œå† 594 å¤„å†æ·»åŠ ä¸€ä¸ªæ–­ç‚¹ï¼ˆæ¡ä»¶Thread.currentThread().getName().equals(\"Thread-0\")ï¼‰\nè¿™æ—¶å¯ä»¥åœ¨ Variables é¢æ¿è§‚å¯Ÿåˆ° e å’Œ next å˜é‡ï¼Œä½¿ç”¨ view as -\u003e Object æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€\n```\ne (1)-\u003e(35)-\u003e(16)-\u003enull \nnext (35)-\u003e(16)-\u003enull \n```\nåœ¨ Threads é¢æ¿é€‰ä¸­ Thread-1 æ¢å¤è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºæ–°çš„å†…å®¹å¦‚ä¸‹ï¼ŒThread-1 æ‰©å®¹å·²å®Œæˆ\n```\nnewTable[1]  (35)-\u003e(1)-\u003enull\næ‰©å®¹åå¤§å°:13\n```\nè¿™æ—¶ Thread-0 è¿˜åœåœ¨ 594 å¤„ï¼Œ Variables é¢æ¿å˜é‡çš„çŠ¶æ€å·²ç»å˜åŒ–ä¸º\n```\ne (1)-\u003enull \nnext (35)-\u003e(1)-\u003enull \n```\nä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸º Thread-1 æ‰©å®¹æ—¶é“¾è¡¨ä¹Ÿæ˜¯ååŠ å…¥çš„å…ƒç´ æ”¾å…¥é“¾è¡¨å¤´ï¼Œå› æ­¤é“¾è¡¨å°±å€’è¿‡æ¥äº†ï¼Œä½† Thread-1 è™½ç„¶ç»“æœæ­£ç¡®ï¼Œä½†å®ƒç»“æŸå Thread-0 è¿˜è¦ç»§ç»­è¿è¡Œ\næ¥ä¸‹æ¥å°±å¯ä»¥å•æ­¥è°ƒè¯•ï¼ˆF8ï¼‰è§‚å¯Ÿæ­»é“¾çš„äº§ç”Ÿäº†\nä¸‹ä¸€è½®å¾ªç¯åˆ° 594ï¼Œå°† e æ¬è¿åˆ° newTable é“¾è¡¨å¤´\n```\nnewTable[1]     (1)-\u003enull \ne (35)-\u003e(1)-\u003enull \nnext (1)-\u003enull \n```\nä¸‹ä¸€è½®å¾ªç¯åˆ° 594ï¼Œå°† e æ¬è¿åˆ° newTable é“¾è¡¨å¤´\n```\nnewTable[1] (35)-\u003e(1)-\u003enull \ne (1)-\u003enull \nnext null \n```\nå†çœ‹çœ‹æºç \n```java\ne.next = newTable[1];\n// è¿™æ—¶ e  (1,35)\n// è€Œ newTable[1] (35,1)-\u003e(1,35) å› ä¸ºæ˜¯åŒä¸€ä¸ªå¯¹è±¡\n \nnewTable[1] = e;  \n// å†å°è¯•å°† e ä½œä¸ºé“¾è¡¨å¤´, æ­»é“¾å·²æˆ\n \ne = next;\n// è™½ç„¶ next æ˜¯ null, ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªé“¾è¡¨çš„å¤åˆ¶, ä½†æ­»é“¾å·²ç»å½¢æˆäº†\n```\n\n#### æºç åˆ†æ\n\n```java\n// å°† table è¿ç§»è‡³ newTable\nvoid transfer(Entry[] newTable, boolean rehash) {    \n    int newCapacity = newTable.length;\n    for (Entry\u003cK,V\u003e e : table) {\n        while(null != e) {\n            Entry\u003cK,V\u003e next = e.next;\n            // 1 å¤„\n            if (rehash) {\n                e.hash = null == e.key ? 0 : hash(e.key);\n            }\n            int i = indexFor(e.hash, newCapacity);\n            // 2 å¤„\n            // å°†æ–°å…ƒç´ åŠ å…¥ newTable[i], åŸ newTable[i] ä½œä¸ºæ–°å…ƒç´ çš„ next\n            e.next = newTable[i];\n            newTable[i] = e;\n            e = next;\n        }\n    }\n}\n```\n\n```\nåŸå§‹é“¾è¡¨ï¼Œæ ¼å¼ï¼š[ä¸‹æ ‡] (key,next)\n[1] (1,35)-\u003e(35,16)-\u003e(16,null)\n \nçº¿ç¨‹ a æ‰§è¡Œåˆ° 1 å¤„ ï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ e ä¸º (1,35)ï¼Œè€Œå±€éƒ¨å˜é‡ next ä¸º (35,16) çº¿ç¨‹ a æŒ‚èµ·\n \nçº¿ç¨‹ b å¼€å§‹æ‰§è¡Œï¼ˆæ„å»ºæ‰©å®¹åçš„æ–°é“¾è¡¨ï¼‰\nç¬¬ä¸€æ¬¡å¾ªç¯\n[1] (1,null)\n \nç¬¬äºŒæ¬¡å¾ªç¯\n[1] (35,1)-\u003e(1,null)\n \nç¬¬ä¸‰æ¬¡å¾ªç¯\n[1] (35,1)-\u003e(1,null)\n[17] (16,null)\n \nåˆ‡æ¢å›çº¿ç¨‹ aï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ e å’Œ next è¢«æ¢å¤ï¼Œå¼•ç”¨æ²¡å˜ä½†å†…å®¹å˜äº†ï¼še çš„å†…å®¹è¢«æ”¹ä¸º (1,null)ï¼Œè€Œ next çš„å†…\nå®¹è¢«æ”¹ä¸º (35,1) å¹¶é“¾å‘ (1,null)\nç¬¬ä¸€æ¬¡å¾ªç¯\n[1] (1,null)\n \nç¬¬äºŒæ¬¡å¾ªç¯ï¼Œæ³¨æ„è¿™æ—¶ e æ˜¯  (35,1) å¹¶é“¾å‘ (1,null) æ‰€ä»¥ next åˆæ˜¯ (1,null)\n[1] (35,1)-\u003e(1,null)\n \nç¬¬ä¸‰æ¬¡å¾ªç¯ï¼Œe æ˜¯ (1,null)ï¼Œè€Œ next æ˜¯ nullï¼Œä½† e è¢«æ”¾å…¥é“¾è¡¨å¤´ï¼Œè¿™æ · e.next å˜æˆäº† 35 ï¼ˆ2 å¤„ï¼‰\n[1] (1,35)-\u003e(35,1)-\u003e(1,35)\né“¾è¡¨å‡ºç°å¾ªç¯\nå·²ç»æ˜¯æ­»é“¾äº†\n```\n\n### æ€»ç»“\n\n1. JDK7çš„HashMapæ¡¶é“¾è¡¨é‡‡ç”¨å¤´æ’æ³•ï¼Œæ–°èŠ‚ç‚¹ä¼šæˆä¸ºé“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚\n2. åœ¨æ‰©å®¹è¿‡ç¨‹ä¸­ï¼Œéå†æ—§é“¾è¡¨æ„é€ æ–°é“¾è¡¨çš„æ—¶å€™é‡‡ç”¨å¤´æ’æ³•ï¼Œä¼šå¯¼è‡´é“¾è¡¨å€’åºæ’åˆ—ï¼Œé¡ºåºä¸åŸé“¾è¡¨ä¸ä¸€è‡´ã€‚ï¼ˆå¤´æ’æ³•æœ‰é€†åºæ“ä½œï¼Œä¼šä¿®æ”¹èŠ‚ç‚¹çš„nextæŒ‡é’ˆï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰©å®¹å°±ä¼šè¯»å–åˆ°å¼‚å¸¸çš„nextå€¼é€ æˆç¯çš„å‡ºç°ï¼‰ã€‚\n3. ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è§¦å‘æ‰©å®¹ä¸”ä¸€ä¸ªçº¿ç¨‹å…ˆå®Œæˆæ‰©å®¹éå†ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åªè·å–åˆ°äº†å¤´èŠ‚ç‚¹å’Œå¤´èŠ‚ç‚¹.nextä¸¤ä¸ªèŠ‚ç‚¹ã€‚\n4. ç¬¬äºŒä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œæ—¶ï¼Œæ‰‹ä¸Šçš„ä¸¤ä¸ªèŠ‚ç‚¹å·²ç»è¢«ç¬¬ä¸€ä¸ªçº¿ç¨‹æ”¹æ‰ï¼Œå…ˆåå…³ç³»åäº†ï¼Œä½†ç¬¬äºŒä¸ªçº¿ç¨‹ä¸çŸ¥é“è¿˜ä»¥ä¸ºæ˜¯åŸæ¥çš„é¡ºåºã€‚\n5. ç¬¬äºŒä¸ªçº¿ç¨‹ç»§ç»­æŒ‰åŸé¡ºåºå¯¹é“¾è¡¨æ‰©å®¹ï¼Œéå†æ„é€ æ–°é“¾è¡¨æ—¶å‡ºç°äº†ç¯ã€‚\n\n- ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨äº†éçº¿ç¨‹å®‰å…¨çš„ map é›†åˆ\n- JDK 8 è™½ç„¶å°†æ‰©å®¹ç®—æ³•åšäº†è°ƒæ•´ï¼Œä¸å†å°†å…ƒç´ åŠ å…¥é“¾è¡¨å¤´ï¼ˆè€Œæ˜¯ä¿æŒä¸æ‰©å®¹å‰ä¸€æ ·çš„é¡ºåºï¼‰ï¼Œä½†ä»ä¸æ„å‘³ç€èƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½å¤Ÿå®‰å…¨æ‰©å®¹ï¼Œè¿˜ä¼šå‡ºç°å…¶å®ƒé—®é¢˜ï¼ˆå¦‚æ‰©å®¹ä¸¢æ•°æ®ï¼‰ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/JMM":{"title":"JMM","content":"# JMM\n\n## ç®€ä»‹\n\nJMM å³ Java Memory Modelï¼Œå®ƒå®šä¹‰äº†**ä¸»å­˜**ã€**å·¥ä½œå†…å­˜**æŠ½è±¡æ¦‚å¿µï¼Œåº•å±‚å¯¹åº”ç€ CPU å¯„å­˜å™¨ã€ç¼“å­˜ã€ç¡¬ä»¶å†…å­˜ã€CPU æŒ‡ä»¤ä¼˜åŒ–ç­‰ã€‚\nJMM ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n- åŸå­æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå—åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å¯è§æ€§|å¯è§æ€§]] - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu ç¼“å­˜çš„å½±å“\n- æœ‰åºæ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–çš„å½±å“\n\n## JMMçš„æŠ½è±¡ç¤ºæ„å›¾\n\n![[z-oblib/z2-attachments/JMMæŠ½è±¡ç¤ºæ„å›¾.jpg]]\n\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š\n1. æ‰€æœ‰çš„å…±äº«å˜é‡éƒ½å­˜åœ¨ä¸»å†…å­˜ä¸­ã€‚\n2. æ¯ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]éƒ½ä¿å­˜äº†ä¸€ä»½è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚\n3. å¦‚æœçº¿ç¨‹Aä¸çº¿ç¨‹Bä¹‹é—´è¦é€šä¿¡çš„è¯ï¼Œå¿…é¡»ç»å†ä¸‹é¢2ä¸ªæ­¥éª¤ï¼š\n    1. çº¿ç¨‹Aå°†æœ¬åœ°å†…å­˜Aä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å»ã€‚\n    2. çº¿ç¨‹Båˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹Aä¹‹å‰å·²ç»æ›´æ–°è¿‡çš„å…±äº«å˜é‡ã€‚\n\n- **çº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨è‡ªå·±çš„æœ¬åœ°å†…å­˜ä¸­è¿›è¡Œï¼Œä¸èƒ½ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–**ã€‚\n- **JMMé€šè¿‡æ§åˆ¶ä¸»å†…å­˜ä¸æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’ï¼Œæ¥æä¾›å†…å­˜å¯è§æ€§ä¿è¯**ã€‚\n\n\u003e Javaä¸­çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]]å…³é”®å­—å¯ä»¥ä¿è¯å¤šçº¿ç¨‹æ“ä½œå…±äº«å˜é‡çš„å¯è§æ€§ä»¥åŠç¦æ­¢æŒ‡ä»¤[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/æŒ‡ä»¤é‡æ’åº|é‡æ’åº]]ï¼Œsynchronizedå…³é”®å­—ä¸ä»…ä¿è¯å¯è§æ€§ï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†åŸå­æ€§ï¼ˆäº’æ–¥æ€§ï¼‰ã€‚åœ¨æ›´åº•å±‚ï¼ŒJMMé€šè¿‡å†…å­˜å±éšœæ¥å®ç°å†…å­˜çš„å¯è§æ€§ä»¥åŠç¦æ­¢é‡æ’åºã€‚ä¸ºäº†ç¨‹åºå‘˜çš„æ–¹ä¾¿ç†è§£ï¼Œæå‡ºäº†happens-beforeï¼Œå®ƒæ›´åŠ çš„ç®€å•æ˜“æ‡‚ï¼Œä»è€Œé¿å…äº†ç¨‹åºå‘˜ä¸ºäº†ç†è§£å†…å­˜å¯è§æ€§è€Œå»å­¦ä¹ å¤æ‚çš„é‡æ’åºè§„åˆ™ä»¥åŠè¿™äº›è§„åˆ™çš„å…·ä½“å®ç°æ–¹æ³•ã€‚\n\n### JMMä¸Javaå†…å­˜åŒºåŸŸåˆ’åˆ†çš„åŒºåˆ«ä¸è”ç³»\n\n#### åŒºåˆ«\n\nä¸¤è€…æ˜¯ä¸åŒçš„æ¦‚å¿µå±‚æ¬¡ã€‚JMMæ˜¯æŠ½è±¡çš„ï¼Œä»–æ˜¯ç”¨æ¥æè¿°ä¸€ç»„è§„åˆ™ï¼Œé€šè¿‡è¿™ä¸ªè§„åˆ™æ¥æ§åˆ¶å„ä¸ªå˜é‡çš„è®¿é—®æ–¹å¼ï¼Œå›´ç»•åŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§ç­‰å±•å¼€çš„ã€‚è€ŒJavaè¿è¡Œæ—¶å†…å­˜çš„åˆ’åˆ†æ˜¯å…·ä½“çš„ï¼Œæ˜¯JVMè¿è¡ŒJavaç¨‹åºæ—¶ï¼Œå¿…è¦çš„å†…å­˜åˆ’åˆ†ã€‚\n\n#### è”ç³»\n\néƒ½å­˜åœ¨ç§æœ‰æ•°æ®åŒºåŸŸå’Œå…±äº«æ•°æ®åŒºåŸŸã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJMMä¸­çš„ä¸»å†…å­˜å±äºå…±äº«æ•°æ®åŒºåŸŸï¼Œä»–æ˜¯åŒ…å«äº†å †å’Œæ–¹æ³•åŒºï¼›åŒæ ·ï¼ŒJMMä¸­çš„æœ¬åœ°å†…å­˜å±äºç§æœ‰æ•°æ®åŒºåŸŸï¼ŒåŒ…å«äº†ç¨‹åºè®¡æ•°å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆã€è™šæ‹Ÿæœºæ ˆã€‚\n\n### æ•°æ®ç«äº‰ä¸é¡ºåºä¸€è‡´æ€§\n\nå½“ç¨‹åºæœªæ­£ç¡®åŒæ­¥çš„æ—¶å€™ï¼Œå°±å¯èƒ½å­˜åœ¨æ•°æ®ç«äº‰ã€‚\n\n\u003e æ•°æ®ç«äº‰ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å†™ä¸€ä¸ªå˜é‡ï¼Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¯»åŒä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”å†™å’Œè¯»æ²¡æœ‰é€šè¿‡åŒæ­¥æ¥æ’åºã€‚\n\nå¦‚æœç¨‹åºä¸­åŒ…å«äº†æ•°æ®ç«äº‰ï¼Œé‚£ä¹ˆè¿è¡Œçš„ç»“æœå¾€å¾€å……æ»¡äº†**ä¸ç¡®å®šæ€§**ï¼Œæ¯”å¦‚è¯»å‘ç”Ÿåœ¨äº†å†™ä¹‹å‰ï¼Œå¯èƒ½å°±ä¼šè¯»åˆ°é”™è¯¯çš„å€¼ï¼›å¦‚æœä¸€ä¸ªçº¿ç¨‹ç¨‹åºèƒ½å¤Ÿæ­£ç¡®åŒæ­¥ï¼Œé‚£ä¹ˆå°±ä¸å­˜åœ¨æ•°æ®ç«äº‰ã€‚\n\nJavaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰å¯¹äºæ­£ç¡®åŒæ­¥å¤šçº¿ç¨‹ç¨‹åºçš„å†…å­˜ä¸€è‡´æ€§åšäº†ä»¥ä¸‹ä¿è¯ï¼š\n\n\u003e **å¦‚æœç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼Œç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§**ã€‚ å³ç¨‹åºçš„æ‰§è¡Œç»“æœå’Œè¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­æ‰§è¡Œçš„ç»“æœç›¸åŒã€‚\n\nè¿™é‡Œçš„åŒæ­¥åŒ…æ‹¬äº†ä½¿ç”¨`volatile`ã€`final`ã€`synchronized`ç­‰å…³é”®å­—æ¥å®ç°**å¤šçº¿ç¨‹ä¸‹çš„åŒæ­¥**ã€‚\n\nå¦‚æœç¨‹åºå‘˜æ²¡æœ‰æ­£ç¡®ä½¿ç”¨`volatile`ã€`final`ã€`synchronized`ï¼Œé‚£ä¹ˆå³ä¾¿æ˜¯ä½¿ç”¨äº†åŒæ­¥ï¼ˆå•çº¿ç¨‹ä¸‹çš„åŒæ­¥ï¼‰ï¼ŒJMMä¹Ÿä¸ä¼šæœ‰å†…å­˜å¯è§æ€§çš„ä¿è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ çš„ç¨‹åºå‡ºé”™ï¼Œå¹¶ä¸”å…·æœ‰ä¸å¯é‡ç°æ€§ï¼Œå¾ˆéš¾æ’æŸ¥ã€‚\n\næ‰€ä»¥å¦‚ä½•æ­£ç¡®ä½¿ç”¨`volatile`ã€`final`ã€`synchronized`ï¼Œæ˜¯ç¨‹åºå‘˜åº”è¯¥å»äº†è§£çš„ã€‚åé¢ä¼šæœ‰ä¸“é—¨çš„ç« èŠ‚ä»‹ç»è¿™å‡ ä¸ªå…³é”®å­—çš„å†…å­˜è¯­ä¹‰åŠä½¿ç”¨ã€‚\n\n## JMMä¸­åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§æ•ˆæœ\n\nåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰æ“ä½œå®Œå…¨æŒ‰ç…§ç¨‹åºçš„é¡ºåºä¸²è¡Œæ‰§è¡Œã€‚ä½†æ˜¯JMMä¸­ï¼Œ**ä¸´ç•ŒåŒºå†…**ï¼ˆåŒæ­¥å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ï¼‰çš„ä»£ç å¯ä»¥å‘ç”Ÿ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/æŒ‡ä»¤é‡æ’åº|é‡æ’åº]]ï¼ˆä½†**ä¸å…è®¸ä¸´ç•ŒåŒºå†…çš„ä»£ç â€œé€ƒé€¸â€åˆ°ä¸´ç•ŒåŒºä¹‹å¤–**ï¼Œå› ä¸ºä¼šç ´åé”çš„å†…å­˜è¯­ä¹‰ï¼‰ã€‚\n\nè™½ç„¶çº¿ç¨‹Aåœ¨ä¸´ç•ŒåŒºåšäº†é‡æ’åºï¼Œä½†æ˜¯å› ä¸ºé”çš„ç‰¹æ€§ï¼Œçº¿ç¨‹Bæ— æ³•è§‚å¯Ÿåˆ°çº¿ç¨‹Aåœ¨ä¸´ç•ŒåŒºçš„é‡æ’åºã€‚è¿™ç§é‡æ’åºæ—¢æé«˜äº†æ‰§è¡Œæ•ˆç‡ï¼Œåˆæ²¡æœ‰æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚\n\nåŒæ—¶ï¼ŒJMMä¼šåœ¨é€€å‡ºä¸´ç•ŒåŒºå’Œè¿›å…¥ä¸´ç•ŒåŒºåšç‰¹æ®Šçš„å¤„ç†ï¼Œä½¿å¾—åœ¨ä¸´ç•ŒåŒºå†…ç¨‹åºè·å¾—ä¸é¡ºåºä¸€è‡´æ€§æ¨¡å‹ç›¸åŒçš„å†…å­˜è§†å›¾ã€‚\n\n**ç”±æ­¤å¯è§ï¼ŒJMMçš„å…·ä½“å®ç°æ–¹é’ˆæ˜¯ï¼šåœ¨ä¸æ”¹å˜ï¼ˆæ­£ç¡®åŒæ­¥çš„ï¼‰ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½é‡ä¸ºç¼–è¯‘æœŸå’Œå¤„ç†å™¨çš„ä¼˜åŒ–æ‰“å¼€æ–¹ä¾¿ä¹‹é—¨**ã€‚\n\n## JMMä¸­æœªåŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§æ•ˆæœ\n\nå¯¹äºæœªåŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºï¼ŒJMMåªæä¾›**æœ€å°å®‰å…¨æ€§**ï¼šçº¿ç¨‹è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼Œä¸ä¼šæ— ä¸­ç”Ÿæœ‰ã€‚\n\nä¸ºäº†å®ç°è¿™ä¸ªå®‰å…¨æ€§ï¼Œ**JVMåœ¨å †ä¸Šåˆ†é…å¯¹è±¡æ—¶ï¼Œé¦–å…ˆä¼šå¯¹å†…å­˜ç©ºé—´æ¸…é›¶**ï¼Œç„¶åæ‰ä¼šåœ¨ä¸Šé¢åˆ†é…å¯¹è±¡ï¼ˆè¿™ä¸¤ä¸ªæ“ä½œæ˜¯åŒæ­¥çš„ï¼‰ã€‚\n\nJMMæ²¡æœ‰ä¿è¯æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§ä¸­æ‰§è¡Œç»“æœä¸€è‡´ã€‚å› ä¸ºå¦‚æœè¦ä¿è¯æ‰§è¡Œç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆJMMéœ€è¦ç¦æ­¢å¤§é‡çš„ä¼˜åŒ–ï¼Œå¯¹ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ä¼šäº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚\n\næœªåŒæ­¥ç¨‹åºåœ¨JMMå’Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç‰¹æ€§æœ‰å¦‚ä¸‹å·®å¼‚ï¼š\n1. é¡ºåºä¸€è‡´æ€§ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œï¼›JMMä¸ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œã€‚ï¼ˆå› ä¸ºé‡æ’åºï¼Œä½†æ˜¯JMMä¿è¯å•çº¿ç¨‹ä¸‹çš„é‡æ’åºä¸å½±å“æ‰§è¡Œç»“æœï¼‰\n2. é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯æ‰€æœ‰çº¿ç¨‹åªèƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºï¼Œè€ŒJMMä¸ä¿è¯æ‰€æœ‰çº¿ç¨‹èƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚ï¼ˆå› ä¸ºJMMä¸ä¿è¯æ‰€æœ‰æ“ä½œç«‹å³å¯è§ï¼‰\n3. é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯å¯¹æ‰€æœ‰çš„å†…å­˜è¯»å†™æ“ä½œéƒ½å…·æœ‰åŸå­æ€§ï¼Œè€Œ**JMMä¸ä¿è¯å¯¹64ä½çš„longå‹å’Œdoubleå‹å˜é‡çš„å†™æ“ä½œå…·æœ‰åŸå­æ€§**ã€‚\n\n## å¯è§æ€§vsåŸå­æ€§\n\nä¸¤ä¸ªçº¿ç¨‹ä¸€ä¸ª i++ ä¸€ä¸ª i-- ï¼Œåªèƒ½ä¿è¯çœ‹åˆ°æœ€æ–°å€¼ï¼Œä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™ï¼š\n```java\n// å‡è®¾içš„åˆå§‹å€¼ä¸º0 \ngetstatic     i  // çº¿ç¨‹2-è·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0 \n \ngetstatic     i  // çº¿ç¨‹1-è·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0 \niconst_1         // çº¿ç¨‹1-å‡†å¤‡å¸¸é‡1 \niadd             // çº¿ç¨‹1-è‡ªå¢ çº¿ç¨‹å†…i=1 \nputstatic     i  // çº¿ç¨‹1-å°†ä¿®æ”¹åçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=1 \n \niconst_1         // çº¿ç¨‹2-å‡†å¤‡å¸¸é‡1 \nisub             // çº¿ç¨‹2-è‡ªå‡ çº¿ç¨‹å†…i=-1 \nputstatic     i  // çº¿ç¨‹2-å°†ä¿®æ”¹åçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=-1 \n```\n\n\u003eæ³¨æ„ synchronized è¯­å¥å—æ—¢å¯ä»¥ä¿è¯ä»£ç å—çš„åŸå­æ€§ï¼Œä¹ŸåŒæ—¶ä¿è¯ä»£ç å—å†…å˜é‡çš„å¯è§æ€§ã€‚ä½†ç¼ºç‚¹æ˜¯synchronized æ˜¯å±äºé‡é‡çº§æ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹æ›´ä½\n\u003eå¦‚æœåœ¨å‰é¢ç¤ºä¾‹çš„æ­»å¾ªç¯ä¸­åŠ å…¥ System.out.println() ä¼šå‘ç°å³ä½¿ä¸åŠ  volatile ä¿®é¥°ç¬¦ï¼Œçº¿ç¨‹ t ä¹Ÿèƒ½æ­£ç¡®çœ‹åˆ°å¯¹ run å˜é‡çš„ä¿®æ”¹äº†ï¼Œæƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆï¼Ÿ","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/JVM%E7%9A%84%E6%A0%88%E5%B8%A7":{"title":"JVMçš„æ ˆå¸§","content":"\n# JVMçš„æ ˆå¸§\n\næ ˆå¸§ï¼ˆStack [Frame](https://so.csdn.net/so/search?q=Frame\u0026spm=1001.2101.3001.7020)ï¼‰æ˜¯ç”¨äºæ”¯æŒè™šæ‹Ÿæœºè¿›è¡Œæ–¹æ³•è°ƒç”¨å’Œæ–¹æ³•æ‰§è¡Œçš„æ•°æ®ç»“æ„ã€‚å®ƒæ˜¯è™šæ‹Ÿæœº**è¿è¡Œæ—¶**æ•°æ®åŒºä¸­çš„è™šæ‹Ÿæœºæ ˆçš„æ ˆå…ƒç´ ã€‚\n\næ ˆå¸§å­˜å‚¨äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥å’Œæ–¹æ³•è¿”å›åœ°å€ç­‰ä¿¡æ¯ã€‚\n\næ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨å¼€å§‹è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œéƒ½å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨[è™šæ‹Ÿæœº](https://so.csdn.net/so/search?q=%E8%99%9A%E6%8B%9F%E6%9C%BA\u0026spm=1001.2101.3001.7020)é‡Œé¢ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚\n\n\u003e åœ¨ç¼–è¯‘ç¨‹åºä»£ç çš„æ—¶å€™ï¼Œæ ˆå¸§ä¸­éœ€è¦å¤šå¤§çš„å±€éƒ¨å˜é‡è¡¨ï¼Œå¤šæ·±çš„æ“ä½œæ•°æ ˆéƒ½å·²ç»å®Œå…¨ç¡®å®šäº†ã€‚\n\u003e \n\u003e å› æ­¤ä¸€**ä¸ªæ ˆå¸§éœ€è¦åˆ†é…å¤šå°‘å†…å­˜ï¼Œä¸ä¼šå—åˆ°ç¨‹åºè¿è¡ŒæœŸå˜é‡æ•°æ®çš„å½±å“**ï¼Œè€Œä»…ä»…å–å†³äºå…·ä½“çš„è™šæ‹Ÿæœºå®ç°ã€‚\n\n## å±€éƒ¨å˜é‡è¡¨\n\nå±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variable Tableï¼‰æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜æ”¾**æ–¹æ³•å‚æ•°**å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„**å±€éƒ¨å˜é‡**ã€‚å¹¶ä¸”åœ¨Javaç¼–è¯‘ä¸ºClassæ–‡ä»¶æ—¶ï¼Œå°±å·²ç»ç¡®å®šäº†è¯¥æ–¹æ³•æ‰€éœ€è¦åˆ†é…çš„å±€éƒ¨å˜é‡è¡¨çš„æœ€å¤§å®¹é‡ã€‚\n\n## åŠ¨æ€è¿æ¥\n\næ¯ä¸ªæ ˆå¸§éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ï¼ŒæŒæœ‰è¿™ä¸ªå¼•ç”¨æ˜¯ä¸ºäº†æ”¯ä»˜æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„åŠ¨æ€è¿æ¥ï¼ˆDynamic Linkingï¼‰ã€‚\n\nåœ¨ç±»åŠ è½½é˜¶æ®µä¸­çš„è§£æé˜¶æ®µä¼šå°†ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ç§è½¬åŒ–ä¹Ÿç§°ä¸ºé™æ€è§£æã€‚å¦å¤–çš„ä¸€éƒ¨åˆ†å°†åœ¨æ¯ä¸€æ¬¡è¿è¡Œæ—¶æœŸè½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ã€‚è¿™éƒ¨åˆ†ç§°ä¸ºåŠ¨æ€è¿æ¥ã€‚\n\n## è¿”å›åœ°å€\n\nå½“ä¸€ä¸ªæ–¹æ³•å¼€å§‹æ‰§è¡Œåï¼Œåªæœ‰2ç§æ–¹å¼å¯ä»¥é€€å‡ºè¿™ä¸ªæ–¹æ³• ï¼š\n\n- æ–¹æ³•è¿”å›æŒ‡ä»¤ ï¼š æ‰§è¡Œå¼•æ“é‡åˆ°ä¸€ä¸ªæ–¹æ³•è¿”å›çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œè¿™æ—¶å€™æœ‰å¯èƒ½ä¼šæœ‰è¿”å›å€¼ä¼ é€’ç»™ä¸Šå±‚çš„æ–¹æ³•è°ƒç”¨è€…ï¼Œè¿™ç§é€€å‡ºæ–¹å¼ç§°ä¸ºæ­£å¸¸å®Œæˆå‡ºå£ã€‚\n- å¼‚å¸¸é€€å‡º ï¼š åœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸ï¼Œå¹¶ä¸”æ²¡æœ‰å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºã€‚\n\n\næ— è®ºé‡‡ç”¨ä»»ä½•é€€å‡ºæ–¹å¼ï¼Œåœ¨æ–¹æ³•é€€å‡ºä¹‹åï¼Œéƒ½éœ€è¦è¿”å›åˆ°æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ï¼Œç¨‹åºæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæ–¹æ³•è¿”å›æ—¶å¯èƒ½éœ€è¦åœ¨æ ˆå¸§ä¸­ä¿å­˜ä¸€äº›ä¿¡æ¯ã€‚\n\n\u003e ä¸€èˆ¬æ¥è¯´ï¼Œæ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œ**è°ƒç”¨è€…**çš„PCè®¡æ•°å™¨çš„å€¼å¯ä»¥ä½œä¸ºè¿”å›åœ°å€ï¼Œæ ˆå¸§ä¸­ä¼šä¿å­˜è¿™ä¸ªè®¡æ•°å™¨å€¼ã€‚\n\u003e è€Œæ–¹æ³•å¼‚å¸¸é€€å‡ºæ—¶ï¼Œè¿”å›åœ°å€æ˜¯è¦é€šè¿‡å¼‚å¸¸å¤„ç†å™¨è¡¨æ¥ç¡®å®šçš„ï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚\n\n## æ“ä½œæ•°æ ˆ\n\næ“ä½œæ•°æ ˆä¸»è¦ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€‚\n\næ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨ä¸€æ ·ï¼Œåœ¨ç¼–è¯‘æ—¶æœŸå°±å·²ç»ç¡®å®šäº†è¯¥æ–¹æ³•æ‰€éœ€è¦åˆ†é…çš„å±€éƒ¨å˜é‡è¡¨çš„æœ€å¤§å®¹é‡ã€‚\n\næ“ä½œæ•°æ ˆçš„æ¯ä¸€ä¸ªå…ƒç´ å¯ç”¨æ˜¯ä»»æ„çš„Javaæ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬longå’Œdoubleã€‚32ä½æ•°æ®ç±»å‹æ‰€å çš„æ ˆå®¹é‡ä¸º1ï¼Œ64ä½æ•°æ®ç±»å‹å ç”¨çš„æ ˆå®¹é‡ä¸º2ã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B":{"title":"Javaå†…å­˜æ¨¡å‹","content":"# Javaå†…å­˜æ¨¡å‹\n\n## è¿è¡Œæ—¶å†…å­˜çš„åˆ’åˆ†\n\n![[z-oblib/z2-attachments/Javaè¿è¡Œæ—¶æ•°æ®åŒº.png]]\nå¯¹äºæ¯ä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]æ¥è¯´ï¼Œ**æ ˆéƒ½æ˜¯ç§æœ‰çš„**ï¼Œè€Œ**å †æ˜¯å…¬æœ‰çš„**ã€‚\n\nä¹Ÿå°±æ˜¯è¯´åœ¨æ ˆä¸­çš„å˜é‡ï¼ˆå±€éƒ¨å˜é‡ã€æ–¹æ³•å®šä¹‰å‚æ•°ã€å¼‚å¸¸å¤„ç†å™¨å‚æ•°ï¼‰ä¸ä¼šåœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰å†…å­˜å¯è§æ€§ï¼ˆä¸‹æ–‡ä¼šè¯´åˆ°ï¼‰çš„é—®é¢˜ï¼Œä¹Ÿä¸å—å†…å­˜æ¨¡å‹çš„å½±å“ã€‚è€Œåœ¨å †ä¸­çš„å˜é‡æ˜¯å…±äº«çš„ï¼Œæœ¬æ–‡ç§°ä¸ºå…±äº«å˜é‡ï¼Œå†…å­˜çš„å¯è§æ€§é’ˆå¯¹çš„æ˜¯**å…±äº«å˜é‡**ã€‚\n\n### æ—¢ç„¶å †æ˜¯å…±äº«çš„ï¼Œä¸ºä»€ä¹ˆåœ¨å †ä¸­ä¼šæœ‰å†…å­˜ä¸å¯è§?\n\nè¿™æ˜¯å› ä¸ºç°ä»£è®¡ç®—æœºä¸ºäº†é«˜æ•ˆï¼Œå¾€å¾€ä¼šåœ¨é«˜é€Ÿç¼“å­˜åŒºä¸­ç¼“å­˜å…±äº«å˜é‡ï¼Œå› ä¸ºcpuè®¿é—®ç¼“å­˜åŒºæ¯”è®¿é—®å†…å­˜è¦å¿«å¾—å¤šã€‚\n\u003e çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œå­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»ã€å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯Javaå†…å­˜æ¨¡å‹çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ã€å†™ç¼“å†²åŒºã€å¯„å­˜å™¨ç­‰ã€‚\n\nJavaçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ç”±Javaå†…å­˜æ¨¡å‹ï¼ˆç®€ç§°JMMï¼‰æ§åˆ¶ï¼Œä»æŠ½è±¡çš„è§’åº¦æ¥è¯´ï¼ŒJMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ã€‚[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/JMM#JMMçš„æŠ½è±¡ç¤ºæ„å›¾|JMMçš„æŠ½è±¡ç¤ºæ„å›¾]]ã€‚\n## ä¸€ä¸ªä¾‹å­\n\n\u003e https://www.bilibili.com/video/BV16J411h7Rd?p=21\u0026t=575.8\n\n![[z-oblib/z2-attachments/Pasted image 20220526104910.png]]\n\n1. åˆå§‹åŒ–æ—¶ä¼šå°†ç±»åŠ è½½åˆ°æ–¹æ³•åŒºã€‚\n2. jvmå¯åŠ¨mainæ–¹æ³•ä½œä¸ºä¸»çº¿ç¨‹ã€‚\n3. mainçº¿ç¨‹æ ˆä¸­åŒ…å«ï¼š\n\t1. ç¨‹åºè®¡æ•°å™¨ï¼šæŒ‡å‘ä¸‹ä¸€å¥è¦æ‰§è¡Œçš„ä»£ç åœ°å€ã€‚\n\t2. [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/JVMçš„æ ˆå¸§|æ ˆå¸§]]ï¼šæ¯æ¬¡è°ƒç”¨å…¶å®ƒå‡½æ•°éƒ½ä¼šç”Ÿæˆä¸€ä¸ªè¿è¡Œæ—¶æ ˆå¸§ã€‚\n4. æ¯æ¬¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå°±ä¼šåœ¨mainçº¿ç¨‹æ ˆä¸­åˆ›å»ºä¸€ä¸ªç›®æ ‡æ–¹æ³•çš„æ ˆå¸§ã€‚\n5. å±€éƒ¨å˜é‡å¯ä»¥æŒ‡å‘å †ç©ºé—´çš„æ•°ç»„æˆ–è€…æ˜¯å¯¹è±¡ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/Mark-Word":{"title":"Mark Word","content":"# Mark Word\n\nç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ç­‰ç­‰ã€‚\n\nMark Wordåœ¨32ä½JVMä¸­çš„é•¿åº¦æ˜¯32bitï¼Œåœ¨64ä½JVMä¸­é•¿åº¦æ˜¯64bitã€‚æˆ‘ä»¬æ‰“å¼€[openjdkçš„æºç åŒ…](https://download.java.net/openjdk/jdk8/promoted/b132/openjdk-8-src-b132-03_mar_2014.zip)ï¼Œå¯¹åº”è·¯å¾„`/openjdk/hotspot/src/share/vm/oops`ï¼ŒMark Wordå¯¹åº”åˆ°C++çš„ä»£ç `markOop.hpp`ï¼Œå¯ä»¥ä»æ³¨é‡Šä¸­çœ‹åˆ°å®ƒä»¬çš„ç»„æˆï¼Œæœ¬æ–‡æ‰€æœ‰ä»£ç æ˜¯åŸºäºJdk1.8ã€‚\n\nMark Wordåœ¨ä¸åŒçš„é”çŠ¶æ€ä¸‹å­˜å‚¨çš„å†…å®¹ä¸åŒï¼Œåœ¨32ä½JVMä¸­æ˜¯è¿™ä¹ˆå­˜çš„ï¼š\n\n![[z-oblib/z2-attachments/1162587-20200918154115022-312986152.png]]\n\nåœ¨64ä½JVMä¸­æ˜¯è¿™ä¹ˆå­˜çš„ï¼š\n\n![[z-oblib/z2-attachments/1162587-20200918154125385-1537793659.png]]\n\nè™½ç„¶å®ƒä»¬åœ¨ä¸åŒä½æ•°çš„JVMä¸­é•¿åº¦ä¸ä¸€æ ·ï¼Œä½†æ˜¯åŸºæœ¬ç»„æˆå†…å®¹æ˜¯ä¸€è‡´çš„ã€‚\n\n\u003e æ³¨æ„ä¸Šè¿°ç»“æ„ä¸æ˜¯æ¯ä¸€è¡Œéƒ½åŒæ—¶å­˜åœ¨ï¼Œè€Œæ˜¯æ ¹æ®é”æ ‡å¿—ä½æ¥å†³å®šå½“å‰è¡Œçš„çŠ¶æ€ã€‚\n\u003e ä¾‹å¦‚åœ¨é‡é‡çº§é”çŠ¶æ€ä¸‹ï¼Œå½“å¯¹è±¡è·å–åˆ°Mointerçš„æ—¶ï¼Œä¼šå…ˆå¤åˆ¶å¹¶æš‚å­˜æ— é”æ€å¯¹åº”çš„ä¿¡æ¯ï¼Œå°†ä¿¡æ¯è¦†å†™ä¸ºMointeråœ°å€ã€‚å½“é‡Šæ”¾é”åï¼Œä¼šæ¢å¤æ— é”æ€å¯¹åº”æ•°æ®ã€‚\n\n- **é”æ ‡å¿—ä½ï¼ˆlockï¼‰**ï¼šåŒºåˆ†é”çŠ¶æ€ï¼Œ11æ—¶è¡¨ç¤ºå¯¹è±¡å¾…GCå›æ”¶çŠ¶æ€, åªæœ‰æœ€å2ä½é”æ ‡è¯†(11)æœ‰æ•ˆã€‚\n- **biased_lock**ï¼šæ˜¯å¦[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/åå‘é”|åå‘é”]]ï¼Œç”±äºæ— é”å’Œåå‘é”çš„é”æ ‡è¯†éƒ½æ˜¯ 01ï¼Œæ²¡åŠæ³•åŒºåˆ†ï¼Œè¿™é‡Œå¼•å…¥ä¸€ä½çš„åå‘é”æ ‡è¯†ä½ã€‚\n- **åˆ†ä»£å¹´é¾„ï¼ˆageï¼‰**ï¼šè¡¨ç¤ºå¯¹è±¡è¢«GCçš„æ¬¡æ•°ï¼Œå½“è¯¥æ¬¡æ•°åˆ°è¾¾é˜ˆå€¼çš„æ—¶å€™ï¼Œå¯¹è±¡å°±ä¼šè½¬ç§»åˆ°è€å¹´ä»£ã€‚\n- **å¯¹è±¡çš„hashcodeï¼ˆhashï¼‰**ï¼šè¿è¡ŒæœŸé—´è°ƒç”¨System.identityHashCode()æ¥è®¡ç®—ï¼Œå»¶è¿Ÿè®¡ç®—ï¼Œå¹¶æŠŠç»“æœèµ‹å€¼åˆ°è¿™é‡Œã€‚å½“å¯¹è±¡åŠ é”åï¼Œè®¡ç®—çš„ç»“æœ31ä½ä¸å¤Ÿè¡¨ç¤ºï¼Œåœ¨åå‘é”ï¼Œè½»é‡é”ï¼Œé‡é‡é”ï¼Œhashcodeä¼šè¢«è½¬ç§»åˆ°Monitorä¸­ã€‚\n- **åå‘é”çš„çº¿ç¨‹IDï¼ˆJavaThreadï¼‰**ï¼šåå‘æ¨¡å¼çš„æ—¶å€™ï¼Œå½“æŸä¸ªçº¿ç¨‹æŒæœ‰å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡è¿™é‡Œå°±ä¼šè¢«ç½®ä¸ºè¯¥çº¿ç¨‹çš„IDã€‚ åœ¨åé¢çš„æ“ä½œä¸­ï¼Œå°±æ— éœ€å†è¿›è¡Œå°è¯•è·å–é”çš„åŠ¨ä½œã€‚\n- **epoch**ï¼šåå‘é”åœ¨CASé”æ“ä½œè¿‡ç¨‹ä¸­ï¼Œåå‘æ€§æ ‡è¯†ï¼Œè¡¨ç¤ºå¯¹è±¡æ›´åå‘å“ªä¸ªé”ã€‚\n- **ptr_to_lock_record**ï¼š[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è½»é‡çº§é”|è½»é‡çº§é”]]çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆã€‚å½“é”è·å–æ˜¯æ— ç«äº‰çš„æ—¶ï¼ŒJVMä½¿ç”¨åŸå­æ“ä½œè€Œä¸æ˜¯OSäº’æ–¥ã€‚è¿™ç§æŠ€æœ¯ç§°ä¸ºè½»é‡çº§é”å®šã€‚åœ¨è½»é‡çº§é”å®šçš„æƒ…å†µä¸‹ï¼ŒJVMé€šè¿‡[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]æ“ä½œåœ¨å¯¹è±¡çš„æ ‡é¢˜å­—ä¸­è®¾ç½®æŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚\n- **ptr_to_heavyweight_monitor**ï¼š[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é‡é‡çº§é”|é‡é‡çº§é”]]çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘å¯¹è±¡ç›‘è§†å™¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/monitor|Monitor]]çš„æŒ‡é’ˆã€‚å¦‚æœä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹åŒæ—¶åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šç«äº‰ï¼Œåˆ™å¿…é¡»å°†è½»é‡çº§é”å®šå‡çº§åˆ°Monitorä»¥ç®¡ç†ç­‰å¾…çš„çº¿ç¨‹ã€‚åœ¨é‡é‡çº§é”å®šçš„æƒ…å†µä¸‹ï¼ŒJVMåœ¨å¯¹è±¡çš„ptr_to_heavyweight_monitorè®¾ç½®æŒ‡å‘Monitorçš„æŒ‡é’ˆã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/SPI":{"title":"SPI","content":"# SPI\n\nSPI å…¨ç§°ä¸ºService Provider Interfaceï¼Œæ˜¯ä¸€ç§**æœåŠ¡å‘ç°æœºåˆ¶**ã€‚SPI çš„æœ¬è´¨æ˜¯**å°†æ¥å£å®ç°ç±»çš„å…¨é™å®šåé…ç½®åœ¨æ–‡ä»¶ä¸­ï¼Œå¹¶ç”±æœåŠ¡åŠ è½½å™¨è¯»å–é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½å®ç°ç±»**ã€‚\n\nç®€å•ç‚¹è¯´SPIå°±æ˜¯ JDK å†…ç½®çš„ä¸€ä¸ªæœåŠ¡å‘ç°æœºåˆ¶ï¼Œå®ƒä½¿å¾—æ¥å£å’Œå…·ä½“å®ç°å®Œå…¨è§£è€¦ã€‚æˆ‘ä»¬åªå£°æ˜æ¥å£ï¼Œå…·ä½“çš„å®ç°ç±»åœ¨é…ç½®ä¸­é€‰æ‹©ã€‚\n\nå…·ä½“çš„å°±æ˜¯ä½ å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨`META-INF/services`ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªä¸æ¥å£åŒåçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹ä¸ºæ¥å£çš„å®ç°ç±»ï¼Œå¤šä¸ªå®ç°ç±»ç”¨æ¢è¡Œç¬¦åˆ†éš”ã€‚\n\nè¿™æ ·å°±é€šè¿‡é…ç½®æ¥å†³å®šå…·ä½“ç”¨å“ªä¸ªå®ç°ï¼","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/lambda":{"title":"lambda","content":"# lambda\n\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/safepoint":{"title":"safepoint","content":"# safepoint\n\n## ä»€ä¹ˆæ˜¯safepoint\n\nsafepointå¯ä»¥ç”¨åœ¨ä¸åŒåœ°æ–¹ï¼Œæ¯”å¦‚GCã€Deoptimizationï¼Œåœ¨Hotspot VMä¸­ï¼ŒGC safepointæ¯”è¾ƒå¸¸è§ï¼Œéœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„è®°å½•æ¯ä¸ªçº¿ç¨‹çš„è°ƒç”¨æ ˆã€å¯„å­˜å™¨ç­‰ä¸€äº›é‡è¦çš„æ•°æ®åŒºåŸŸé‡Œä»€ä¹ˆåœ°æ–¹åŒ…å«äº†GCç®¡ç†çš„æŒ‡é’ˆã€‚\n\nä»çº¿ç¨‹è§’åº¦çœ‹ï¼Œsafepointå¯ä»¥ç†è§£æˆæ˜¯åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›ç‰¹æ®Šä½ç½®ï¼Œå½“çº¿ç¨‹æ‰§è¡Œåˆ°è¿™äº›ä½ç½®çš„æ—¶å€™ï¼Œè¯´æ˜è™šæ‹Ÿæœºå½“å‰çš„çŠ¶æ€æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥åœ¨è¿™ä¸ªä½ç½®æš‚åœï¼Œæ¯”å¦‚å‘ç”ŸGCæ—¶ï¼Œéœ€è¦æš‚åœæš‚åœæ‰€ä»¥æ´»åŠ¨çº¿ç¨‹ï¼Œä½†æ˜¯çº¿ç¨‹åœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œåˆ°ä¸€ä¸ªå®‰å…¨ç‚¹ï¼Œæ‰€ä»¥è¯¥çº¿ç¨‹åº”è¯¥ç»§ç»­æ‰§è¡Œï¼Œåˆ°è¾¾ä¸‹ä¸€ä¸ªå®‰å…¨ç‚¹çš„æ—¶å€™æš‚åœï¼Œç­‰å¾…GCç»“æŸã€‚\n\n## ä»€ä¹ˆåœ°æ–¹å¯ä»¥æ”¾safepoint\n\nä¸‹é¢ä»¥Hotspotä¸ºä¾‹ï¼Œç®€å•çš„è¯´æ˜ä¸€ä¸‹ä»€ä¹ˆåœ°æ–¹ä¼šæ”¾ç½®safepoint  \n1. ç†è®ºä¸Šï¼Œåœ¨è§£é‡Šå™¨çš„æ¯æ¡å­—èŠ‚ç çš„è¾¹ç•Œéƒ½å¯ä»¥æ”¾ä¸€ä¸ªsafepointï¼Œä¸è¿‡æŒ‚åœ¨safepointçš„è°ƒè¯•ç¬¦å·ä¿¡æ¯è¦å ç”¨å†…å­˜ç©ºé—´ï¼Œå¦‚æœæ¯æ¡æœºå™¨ç åé¢éƒ½åŠ safepointçš„è¯ï¼Œéœ€è¦ä¿å­˜å¤§é‡çš„è¿è¡Œæ—¶æ•°æ®ï¼Œæ‰€ä»¥è¦å°½é‡å°‘æ”¾ç½®safepointï¼Œåœ¨safepointä¼šç”Ÿæˆpollingä»£ç è¯¢é—®VMæ˜¯å¦è¦â€œè¿›å…¥safepointâ€ï¼Œpollingæ“ä½œä¹Ÿæ˜¯æœ‰å¼€é”€çš„ï¼Œpollingæ“ä½œä¼šåœ¨åç»­è§£é‡Šã€‚\n\n2. é€šè¿‡JITç¼–è¯‘çš„ä»£ç é‡Œï¼Œä¼šåœ¨æ‰€æœ‰æ–¹æ³•çš„è¿”å›ä¹‹å‰ï¼Œä»¥åŠæ‰€æœ‰écounted loopçš„å¾ªç¯ï¼ˆæ— ç•Œå¾ªç¯ï¼‰å›è·³ä¹‹å‰æ”¾ç½®ä¸€ä¸ªsafepointï¼Œä¸ºäº†é˜²æ­¢å‘ç”ŸGCéœ€è¦STWæ—¶ï¼Œè¯¥çº¿ç¨‹ä¸€ç›´ä¸èƒ½æš‚åœã€‚å¦å¤–ï¼ŒJITç¼–è¯‘å™¨åœ¨ç”Ÿæˆæœºå™¨ç çš„åŒæ—¶ä¼šä¸ºæ¯ä¸ªsafepointç”Ÿæˆä¸€äº›â€œè°ƒè¯•ç¬¦å·ä¿¡æ¯â€ï¼Œä¸ºGCç”Ÿæˆçš„ç¬¦å·ä¿¡æ¯æ˜¯OopMapï¼ŒæŒ‡å‡ºæ ˆä¸Šå’Œå¯„å­˜å™¨é‡Œå“ªé‡Œæœ‰GCç®¡ç†çš„æŒ‡é’ˆã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/stream":{"title":"stream","content":"# stream\n\n## OJä¸­çš„åº”ç”¨\n\nå°†å†…å®¹è¯»å–æˆstringï¼Œå†æŒ‰ç…§ç©ºæ ¼åˆ†å‰²å‡ºå­—ç¬¦ä¸²æ•°ç»„ï¼Œå†é€šè¿‡streamå°†å­—ç¬¦ä¸²æ•°ç»„è½¬æˆintæ•°ç»„ã€‚\n\n```java\npublic class P5788 {  \n    public static void main(String[] args) throws IOException {  \n        BufferedReader buf = new BufferedReader(new InputStreamReader(System.in));  \n  \n        int n = Integer.parseInt(buf.readLine());  \n        int[] array;  \n  \n        String str = buf.readLine();  \n        array = Arrays.stream(str.split(\" \")).mapToInt(Integer::parseInt).toArray();  \n  \n        int[]res = new int[n];  \n  \n        Stack\u003cInteger\u003e stack = new Stack\u003c\u003e();  \n        for (int i=0; i\u003carray.length; i++) {  \n            while (!stack.isEmpty() \u0026\u0026 array[stack.peek()] \u003c array[i]) {  \n                int cur = stack.pop();  \n                res[cur] = i+1;  \n            }  \n            stack.push(i);  \n        }  \n  \n        for (int re : res) System.out.print(re + \" \");  \n    }  \n}\n```","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/1-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/volatile":{"title":"volatile","content":"# volatile\n\n\u003e https://ifeve.com/java-volatile%E5%85%B3%E9%94%AE%E5%AD%97/\n\n## å†…å­˜å¯è§æ€§é—®é¢˜\n\n```java\nA = 0;\nB = 0;\nT0 {\n\tA = 1;\n\tprint(B);\n}\n\nT1 {\n\tB = 1;\n\tprint(A);\n}\n\n```\nè¿™æ ·ä¸€æ®µä»£ç å¯èƒ½ä¼šå‡ºç°ä¸‹åˆ—å››ç§è¾“å‡ºï¼š\n\n| æƒ…å†µ1  | æƒ…å†µ2  | æƒ…å†µ3  | æƒ…å†µ4  |\n|------|------|------|------|\n| è¯»A   | è¯»A   | å†™A   | å†™A   |\n| è¯»B   | å†™B   | å†™B   | è¯»B   |\n| å†™A   | å†™A   | è¯»A   | è¯»A   |\n| å†™B   | è¯»B   | è¯»B   | å†™B   |\n| A0B0 | A0B1 | A1B1 | A1B0 |\n\nåœ¨è¯»ä¸ŠåŠ å…¥å†…å­˜å±éšœå³å¯ä¿è¯**åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­**å†™æ“ä½œå‘ç”Ÿåœ¨è¯»æ“ä½œä¹‹å‰ï¼Œä½†æ˜¯è‹¥çº¿ç¨‹1å…ˆæ‰§è¡Œå®Œæ¯•çº¿ç¨‹2æ‰æ‰§è¡Œï¼Œå°±ä¼šå¯¼è‡´çº¿ç¨‹1æ— æ³•è¯»å–åˆ°Bçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦è®©ä¸¤ä¸ªçº¿ç¨‹åŒæ­¥ï¼š\n\n1. ç”¨æ ‡å¿—ä½æ¥å‘ŠçŸ¥AÂ Bå˜é‡æœ‰æ²¡æœ‰è¢«å†™å…¥è¿‡\n2. å†™è¿‡åè®¾ç½®æ ‡å¿—ä½\n3. æ ‡å¿—ä½çš„å†™å‰æ’å…¥å±éšœÂ Â Â   \n4. è¯»ä¹‹å‰è‡ªæ—‹åˆ¤æ–­å¯¹åº”æ ‡å¿—ä½\n\n\n## ä½œç”¨\n\nä¿è¯ï¼š\n- å†…å­˜å¯è§æ€§\n\t- è¯»å†™ä¸€å®šæ˜¯ä»ä¸»å†…å­˜ä¸­è·å¾—ï¼Œè€Œä¸æ˜¯æœ¬åœ°å†…å­˜\n- å†…å­˜æœ‰åºæ€§\n\t- è¯»å†™æ“ä½œæŒ‰ä¸€å®šçš„é¡ºåºæ‰§è¡Œï¼Œä¸ä¼šå› ä¸ºæŒ‡ä»¤é‡æ’è€Œä¹±åº\n\n\u003eæ— æ³•ä¿è¯åŸå­æ€§ã€‚\n\n## JVMé™åˆ¶é‡æ’åºçš„æ–¹å¼\n\n\u003eç¦æ­¢é‡æ’åºå®é™…ä¸Šä¸æ˜¯ç¦æ­¢äº†cpuæŒ‡ä»¤çº§åˆ«çš„é‡æ’åºã€ä¹±åºæ‰§è¡Œã€åŒå°„ç­‰æ“ä½œï¼Œè€Œæ˜¯æ§åˆ¶å†…å­˜çš„è®¿é—®é¡ºåºã€‚ç¼–è¯‘å™¨æŒ‡ä»¤é˜²æ­¢åŠ è½½/å­˜å‚¨æ“ä½œåœ¨æºä»£ç ä¸­è·¨è¡Œé‡æ–°æ’åºï¼Œä½†æ˜¯å…è®¸ç¼–è¯‘å™¨å¯¹ä»»æ„ä¸€ä¾§çš„å†…å­˜è®¿é—®æˆ–åŒä¸€ä¾§çš„å…¶ä»–è®¿é—®è¿›è¡Œé‡æ–°æ’åºï¼Œè¿™å¯èƒ½æ„å‘³ç€ä½¿ç”¨ä¸“ç”¨æŒ‡ä»¤åœæ­¢å†…æ ¸çš„è¿è¡Œï¼Œç›´è‡³ç¡®ä¿æ‰€æœ‰å…ˆå‰çš„å†…å­˜è®¿é—®å¯¹ç³»ç»Ÿä¸­çš„å…¶ä»–ä»£ç†å¯è§ã€‚ä»£ç†æ˜¯ç³»ç»Ÿä¸­èƒ½å¤Ÿå¯åŠ¨æ€»çº¿äº‹åŠ¡çš„ä»»ä½•è®¾å¤‡â€”â€”ä¾‹å¦‚å¤„ç†å™¨æˆ–DMAæ§åˆ¶å™¨ã€‚å±éšœå½±å“åŠ è½½-å­˜å‚¨ï¼ˆ`load-store`ï¼‰æŒ‡ä»¤é¡ºåºçš„ä¾‹å­ï¼š\n\u003e![[z-oblib/z2-attachments/Pasted image 20220531012444.png]]\n\n1. volatileå˜é‡æ‰§è¡Œ**å†™**æ“ä½œï¼Œä¼šåœ¨å†™ä¹‹å‰æ’å…¥StoreStore Barriers**å†™å±éšœ**ï¼Œåœ¨æ‰§è¡Œvolatileå˜é‡å†™ä¹‹å‰çš„æ‰€æœ‰Storeæ“ä½œéƒ½å·²æ‰§è¡Œï¼Œæ•°æ®åŒæ­¥åˆ°äº†å†…å­˜ä¸­ï¼ˆå°†store bufferä¸­çš„storeæ“ä½œåˆ·æ–°åˆ°å†…å­˜ï¼‰ï¼›åœ¨å†™ä¹‹åæ’å…¥StoreLoad Barriersï¼Œä»£è¡¨è¯¥volatileå˜é‡çš„å†™æ“ä½œä¹Ÿä¼šç«‹å³åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼Œå…¶ä»–çº¿ç¨‹ä¼šçœ‹åˆ°æœ€æ–°å€¼ï¼›  \n2. volatileå˜é‡æ‰§è¡Œ**è¯»**æ“ä½œï¼Œä¼šåœ¨è¯»ä¹‹å‰æ’å…¥LoadLoad Barriers**è¯»å±éšœ**ï¼Œä»£è¡¨åœ¨æ‰§è¡Œvolatileå˜é‡è¯»ä¹‹å‰çš„æ‰€æœ‰Loadä»å†…å­˜ä¸­è·å–æœ€æ–°å€¼ï¼›åœ¨è¯»ä¹‹åæ’å…¥LoadStore Barriersï¼Œä»£è¡¨è¯¥è¯»å–volatileå˜é‡è·å¾—æ˜¯å†…å­˜ä¸­æœ€æ–°çš„å€¼ï¼›\n\n### å¦‚ä½•ä¿è¯å¯è§æ€§\n\n#### å†™å±éšœ\n\nå†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­\n```java\npublic void actor2(I_Result r) {\n    num = 2;\n    ready = true; // ready æ˜¯ volatile èµ‹å€¼å¸¦å†™å±éšœ\n    // å†™å±éšœ\n}\n```\n\n#### è¯»å±éšœ\n\nè€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹åï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ®\n```java\npublic void actor1(I_Result r) {\n    // è¯»å±éšœ\n    // ready æ˜¯ volatile è¯»å–å€¼å¸¦è¯»å±éšœ\n    if(ready) {\n        r.r1 = num + num;\n    } else {\n        r.r1 = 1;\n    }\n}f\n```\n![[z-oblib/z2-attachments/Pasted image 20220531142019.png]]\n\n\n### å¦‚ä½•ä¿è¯æœ‰åºæ€§\n\nå†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å\n```java\npublic void actor2(I_Result r) {\n    num = 2;\n    ready = true; // ready æ˜¯ volatile èµ‹å€¼å¸¦å†™å±éšœ\n    // å†™å±éšœ\n}\n```\nè¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰\n```java\npublic void actor1(I_Result r) {\n    // è¯»å±éšœ\n    // ready æ˜¯ volatile è¯»å–å€¼å¸¦è¯»å±éšœ\n    if(ready) {\n        r.r1 = num + num;\n    } else {\n        r.r1 = 1;\n    }\n}\n```\n![[z-oblib/z2-attachments/Pasted image 20220531143810.png]]\n\n## åŸç†\n\nç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å•ä¾‹æ¨¡å¼#åŒé‡æ ¡éªŒé”|å•ä¾‹æ¨¡å¼åŒé‡æ ¡éªŒé”]]çš„ä¾‹å­å±•å¼€ï¼š\n\n```java\n// -------------------------------------\u003e åŠ å…¥å¯¹ INSTANCE å˜é‡çš„è¯»å±éšœ\n0: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n3: ifnonnull     37\n6: ldc           #3                  // class cn/itcast/n5/Singleton\n8: dup\n9: astore_0\n10: monitorenter -----------------------\u003e ä¿è¯åŸå­æ€§ã€å¯è§æ€§\n11: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n14: ifnonnull     27\n17: new           #3                  // class cn/itcast/n5/Singleton\n20: dup\n21: invokespecial #4                  // Method \"\u003cinit\u003e\":()V\n24: putstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n// -------------------------------------\u003e åŠ å…¥å¯¹ INSTANCE å˜é‡çš„å†™å±éšœ\n27: aload_0\n28: monitorexit ------------------------\u003e ä¿è¯åŸå­æ€§ã€å¯è§æ€§\n29: goto          37\n32: astore_1\n33: aload_0\n34: monitorexit\n35: aload_1\n36: athrow\n37: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n40: areturn\n```\n\nå¦‚ä¸Šé¢çš„æ³¨é‡Šå†…å®¹æ‰€ç¤ºï¼Œè¯»å†™ volatile å˜é‡æ—¶ä¼šåŠ å…¥å†…å­˜å±éšœï¼ˆMemory Barrierï¼ˆMemory Fenceï¼‰ï¼‰ï¼Œä¿è¯ä¸‹é¢ä¸¤ç‚¹ï¼š\n- å¯è§æ€§\n\t- å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ t1 å¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­\n\t- è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å t2 å¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ®\n- æœ‰åºæ€§\n\t- å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å\n\t- è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰\n- æ›´åº•å±‚æ˜¯è¯»å†™å˜é‡æ—¶ä½¿ç”¨ lock æŒ‡ä»¤æ¥å¤šæ ¸ CPU ä¹‹é—´çš„å¯è§æ€§ä¸æœ‰åºæ€§\n![[z-oblib/z2-attachments/Pasted image 20220531154956.png]]\n\n## volatileå¹¶ä¸æ€»æ˜¯å¯è¡Œçš„\n\n**ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™**ï¼š\n- å†™å±éšœä»…ä»…æ˜¯ä¿è¯ä¹‹åçš„è¯»èƒ½å¤Ÿè¯»åˆ°æœ€æ–°çš„ç»“æœï¼Œä½†ä¸èƒ½ä¿è¯è¯»è·‘åˆ°å®ƒå‰é¢å»ã€‚\n- è€Œæœ‰åºæ€§çš„ä¿è¯ä¹Ÿåªæ˜¯ä¿è¯äº†æœ¬çº¿ç¨‹å†…ç›¸å…³ä»£ç ä¸è¢«é‡æ’åºSã€‚\n- \n## volatileçš„ç”¨é€”\n\nä»volatileçš„å†…å­˜è¯­ä¹‰ä¸Šæ¥çœ‹ï¼Œvolatileå¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ä¸”ç¦æ­¢é‡æ’åºã€‚\n\nåœ¨ä¿è¯å†…å­˜å¯è§æ€§è¿™ä¸€ç‚¹ä¸Šï¼Œvolatileæœ‰ç€ä¸é”ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºä¸€ä¸ªâ€œè½»é‡çº§â€çš„é”æ¥ä½¿ç”¨ã€‚ä½†ç”±äºvolatileä»…ä»…ä¿è¯å¯¹å•ä¸ªvolatileå˜é‡çš„è¯»/å†™å…·æœ‰åŸå­æ€§ï¼Œè€Œé”å¯ä»¥ä¿è¯æ•´ä¸ª**ä¸´ç•ŒåŒºä»£ç **çš„æ‰§è¡Œå…·æœ‰åŸå­æ€§ã€‚æ‰€ä»¥**åœ¨åŠŸèƒ½ä¸Šï¼Œé”æ¯”volatileæ›´å¼ºå¤§ï¼›åœ¨æ€§èƒ½ä¸Šï¼Œvolatileæ›´æœ‰ä¼˜åŠ¿**ã€‚\n\nåœ¨ç¦æ­¢é‡æ’åºè¿™ä¸€ç‚¹ä¸Šï¼Œvolatileä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ¯”å¦‚æˆ‘ä»¬ç†Ÿæ‚‰çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å•ä¾‹æ¨¡å¼|å•ä¾‹æ¨¡å¼]]ï¼Œå…¶ä¸­æœ‰ä¸€ç§å®ç°æ–¹å¼æ˜¯â€œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å•ä¾‹æ¨¡å¼#çº¿ç¨‹å®‰å…¨çš„å®ç°|åŒé‡é”]]æ£€æŸ¥â€ï¼Œæ¯”å¦‚è¿™æ ·çš„ä»£ç ï¼š\n\n```java\npublic class Singleton {\n\n    private static Singleton instance; // ä¸ä½¿ç”¨volatileå…³é”®å­—\n\n    // åŒé‡é”æ£€éªŒ\n    public static Singleton getInstance() {\n        if (instance == null) { // ç¬¬7è¡Œ\n            synchronized (Singleton.class) {\n                if (instance == null) {\n                    instance = new Singleton(); // ç¬¬10è¡Œ\n                }\n            }\n        }\n        return instance;\n    }\n}\n```\n\nå¦‚æœè¿™é‡Œçš„å˜é‡å£°æ˜ä¸ä½¿ç”¨volatileå…³é”®å­—ï¼Œæ˜¯å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯çš„ã€‚å®ƒå¯èƒ½ä¼šè¢«é‡æ’åºï¼š\n\n```java\ninstance = new Singleton(); // ç¬¬10è¡Œ\n\n// å¯ä»¥åˆ†è§£ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤\n1 memory=allocate();// åˆ†é…å†…å­˜ ç›¸å½“äºcçš„malloc\n2 ctorInstanc(memory) //åˆå§‹åŒ–å¯¹è±¡\n3 s=memory //è®¾ç½®sæŒ‡å‘åˆšåˆ†é…çš„åœ°å€\n\n// ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤å¯èƒ½ä¼šè¢«é‡æ’åºä¸º 1-3-2ï¼Œä¹Ÿå°±æ˜¯ï¼š\n1 memory=allocate();// åˆ†é…å†…å­˜ ç›¸å½“äºcçš„malloc\n3 s=memory //è®¾ç½®sæŒ‡å‘åˆšåˆ†é…çš„åœ°å€\n2 ctorInstanc(memory) //åˆå§‹åŒ–å¯¹è±¡\n```\n\nè€Œä¸€æ—¦å‡è®¾å‘ç”Ÿäº†è¿™æ ·çš„é‡æ’åºï¼Œæ¯”å¦‚çº¿ç¨‹Aåœ¨ç¬¬10è¡Œæ‰§è¡Œäº†æ­¥éª¤1å’Œæ­¥éª¤3ï¼Œä½†æ˜¯æ­¥éª¤2è¿˜æ²¡æœ‰æ‰§è¡Œå®Œã€‚è¿™ä¸ªæ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹Bæ‰§è¡Œåˆ°äº†ç¬¬7è¡Œï¼Œå®ƒä¼šåˆ¤å®šinstanceä¸ä¸ºç©ºï¼Œç„¶åç›´æ¥è¿”å›äº†ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæˆçš„instanceï¼\n\næ‰€ä»¥JSR-133å¯¹volatileåšäº†å¢å¼ºåï¼Œvolatileçš„ç¦æ­¢é‡æ’åºåŠŸèƒ½è¿˜æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚\n\n## ä½•æ—¶ä½¿ç”¨volatile\n\næ­£å¦‚æˆ‘å‰é¢æ‰€è¯´ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™ä¸€ä¸ªå…±äº«å˜é‡ï¼Œä»…ä»…ä½¿ç”¨volatileå…³é”®å­—æ˜¯ä¸å¤Ÿçš„ã€‚ä½ åº”è¯¥ä½¿ç”¨ [synchronized](http://tutorials.jenkov.com/java-concurrency/synchronized.html) æ¥ä¿è¯è¯»å†™å˜é‡æ˜¯åŸå­çš„ã€‚ï¼ˆä¸€ä¸ªçº¿ç¨‹ï¼‰è¯»å†™volatileå˜é‡æ—¶ï¼Œä¸ä¼šé˜»å¡ï¼ˆå…¶ä»–ï¼‰çº¿ç¨‹è¿›è¡Œè¯»å†™ã€‚ä½ å¿…é¡»åœ¨å…³é”®çš„åœ°æ–¹ä½¿ç”¨synchronizedå…³é”®å­—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\né™¤äº†synchronizedæ–¹æ³•ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨[java.util.concurrent](http://tutorials.jenkov.com/java-util-concurrent/index.html)åŒ…æä¾›çš„è®¸å¤šåŸå­æ•°æ®ç±»å‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ï¼Œ[AtomicLong](http://tutorials.jenkov.com/java-util-concurrent/atomiclong.html)æˆ–[AtomicReference](http://tutorials.jenkov.com/java-util-concurrent/atomicreference.html)ï¼Œæˆ–æ˜¯å…¶ä»–çš„ç±»ã€‚\n\nå¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹volatileè¿›è¡Œè¯»å†™ï¼Œè€Œå…¶ä»–çº¿ç¨‹åªæ˜¯è¯»å–å˜é‡ï¼Œè¿™æ—¶ï¼Œå¯¹äºåªæ˜¯è¯»å–å˜é‡çš„çº¿ç¨‹æ¥è¯´ï¼Œvolatileå°±å·²ç»å¯ä»¥ä¿è¯è¯»å–åˆ°çš„æ˜¯å˜é‡çš„æœ€æ–°å€¼ã€‚å¦‚æœæ²¡æœ‰æŠŠå˜é‡å£°æ˜ä¸ºvolatileï¼Œè¿™å°±æ— æ³•ä¿è¯ã€‚\n\nvolatileå…³é”®å­—å¯¹32ä½å’Œ64ä½çš„å˜é‡éƒ½æœ‰æ•ˆã€‚\n\n## volatileçš„æ€§èƒ½è€ƒé‡\n\nè¯»å†™volatileå˜é‡ä¼š**å¯¼è‡´å˜é‡ä»ä¸»å­˜è¯»å†™**ã€‚ä»ä¸»å­˜è¯»å†™æ¯”ä»CPUç¼“å­˜è¯»å†™æ›´åŠ â€œæ˜‚è´µâ€ã€‚è®¿é—®ä¸€ä¸ªvolatileå˜é‡åŒæ ·ä¼š**ç¦æ­¢æŒ‡ä»¤é‡æ’**ï¼Œè€ŒæŒ‡ä»¤é‡æ’æ˜¯ä¸€ç§æå‡æ€§èƒ½çš„æŠ€æœ¯ã€‚å› æ­¤ï¼Œä½ åº”å½“åªåœ¨éœ€è¦ä¿è¯å˜é‡å¯è§æ€§çš„æƒ…å†µä¸‹ï¼Œæ‰ä½¿ç”¨volatileå˜é‡ã€‚\n\n\n\nå‡è®¾ä¸¤ä¸ªå…¨å±€å˜é‡Aå’ŒBï¼Œåˆå§‹å€¼éƒ½æ˜¯0ï¼Œçº¿ç¨‹0å¯¹Aå†™å…¥äº†1ï¼Œçº¿ç¨‹1å¯¹Bå†™å…¥äº†1ï¼Œç„¶åçº¿ç¨‹0è¯»Bï¼Œçº¿ç¨‹1è¯»Bï¼Œä»–ä»¬åˆ†åˆ«è¯»åˆ°çš„Aå’ŒBåˆ†åˆ«å¯èƒ½æ˜¯å‡ ï¼Œåˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„æ’åˆ—ç»„åˆã€‚\n\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%80%E8%87%B4%E6%80%A7%E7%BC%93%E5%AD%98":{"title":"ä¸€è‡´æ€§ç¼“å­˜","content":"# ä¸€è‡´æ€§ç¼“å­˜\n\nä½¿ç”¨è¯»å†™é”å®ç°ä¸€ä¸ªç®€å•çš„æŒ‰éœ€åŠ è½½ç¼“å­˜ï¼š\n\n```java\nclass GenericCachedDao\u003cT\u003e {\n    // HashMap ä½œä¸ºç¼“å­˜éçº¿ç¨‹å®‰å…¨, éœ€è¦ä¿æŠ¤\n    // è¿™é‡Œå¯¹è¯»å†™éƒ½åŠ é”äº†ï¼Œæ‰€ä»¥å¯ä»¥ç»§ç»­ä½¿ç”¨HashMap\n    HashMap\u003cSqlPair, T\u003e map = new HashMap\u003c\u003e();\n    \n    ReentrantReadWriteLock lock = new ReentrantReadWriteLock();    \n    GenericDao genericDao = new GenericDao();\n \n    public int update(String sql, Object... params) {\n        SqlPair key = new SqlPair(sql, params);\n        // åŠ å†™é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜è¯»å–å’Œæ›´æ”¹\n        lock.writeLock().lock();\n        try {\n\t        // æ›´æ–°æ•°æ®\n            int rows = genericDao.update(sql, params);\n            // æ¸…ç©ºç¼“å­˜\n            map.clear();\n            return rows;\n        } finally {\n            lock.writeLock().unlock();\n        }\n    }\n \n    public T queryOne(Class\u003cT\u003e beanClass, String sql, Object... params) {\n        SqlPair key = new SqlPair(sql, params);\n        // åŠ è¯»é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜æ›´æ”¹\n        lock.readLock().lock();\n        try {\n\t        // ç¼“å­˜å‘½ä¸­åˆ™ç›´æ¥è¿”å›\n            T value = map.get(key);\n            if (value != null) {\n                return value;\n            }\n        } finally {\n            lock.readLock().unlock();\n        }\n        // æ³¨æ„ï¼ŒåŠ å†™é”å‰å¿…é¡»é‡Šæ”¾æ‰è¯»é”\n        // åŠ å†™é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜è¯»å–å’Œæ›´æ”¹\n        lock.writeLock().lock();\n        try {\n            // get æ–¹æ³•ä¸Šé¢éƒ¨åˆ†æ˜¯å¯èƒ½å¤šä¸ªçº¿ç¨‹è¿›æ¥çš„, å¯èƒ½å·²ç»å‘ç¼“å­˜å¡«å……äº†æ•°æ®\n            // ä¸ºé˜²æ­¢é‡å¤æŸ¥è¯¢æ•°æ®åº“, å†æ¬¡éªŒè¯ï¼ˆåŒé‡éªŒè¯ï¼‰\n            T value = map.get(key);\n            if (value == null) {\n                // å¦‚æœæ²¡æœ‰, æŸ¥è¯¢æ•°æ®åº“\n                value = genericDao.queryOne(beanClass, sql, params);\n                // æ›´æ–°ç¼“å­˜\n                map.put(key, value);\n            }\n            return value;\n        } finally {\n            lock.writeLock().unlock();\n        }\n    }\n \n    // ä½œä¸º key ä¿è¯å…¶æ˜¯ä¸å¯å˜çš„\n    // ç»„åˆsqlè¯­å¥å’ŒæŸ¥è¯¢å‚æ•°\n    class SqlPair {\n        private String sql;\n        private Object[] params;\n \n        public SqlPair(String sql, Object[] params) {\n            this.sql = sql;\n            this.params = params;\n        }\n \n        @Override\n        public boolean equals(Object o) {\n\n            if (this == o) {\n            return true;\n            }\n            if (o == null || getClass() != o.getClass()) {\n                return false;\n            }\n            SqlPair sqlPair = (SqlPair) o;\n            return sql.equals(sqlPair.sql) \u0026\u0026\n                    Arrays.equals(params, sqlPair.params);\n        }\n \n        @Override\n        public int hashCode() {\n            int result = Objects.hash(sql);\n            result = 31 * result + Arrays.hashCode(params);\n            return result;\n        }\n    }\n}\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8A%E4%B8%8B%E6%96%87":{"title":"ä¸Šä¸‹æ–‡","content":"# ä¸Šä¸‹æ–‡\n\nä¸Šä¸‹æ–‡æ˜¯æŒ‡æŸä¸€æ—¶é—´ç‚¹ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨çš„å†…å®¹ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2":{"title":"ä¸Šä¸‹æ–‡åˆ‡æ¢","content":"# ä¸Šä¸‹æ–‡åˆ‡æ¢\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¸Šä¸‹æ–‡|ä¸Šä¸‹æ–‡]]åˆ‡æ¢ï¼ˆæœ‰æ—¶ä¹Ÿç§°åšè¿›ç¨‹åˆ‡æ¢æˆ–ä»»åŠ¡åˆ‡æ¢ï¼‰æ˜¯æŒ‡ CPU ä»ä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]]ï¼ˆæˆ–[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ï¼‰åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%B0%8F%E7%BB%93":{"title":"ä¸å¯å˜å°ç»“","content":"# ä¸å¯å˜å°ç»“\n\n- ä¸å¯å˜ç±»ä½¿ç”¨\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¸å¯å˜è®¾è®¡|ä¸å¯å˜è®¾è®¡]]\n- åŸç†æ–¹é¢\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/0-è¯­æ³•åŸºç¡€/final|ï¬nal]]\n- æ¨¡å¼æ–¹é¢\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/äº«å…ƒæ¨¡å¼|äº«å…ƒæ¨¡å¼]]","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E5%8F%98%E8%AE%BE%E8%AE%A1":{"title":"ä¸å¯å˜è®¾è®¡","content":"# ä¸å¯å˜è®¾è®¡\n\nä»¥Stringç±»ä¸ºä¾‹ï¼š\n\n```java\npublic final class String\n    implements java.io.Serializable, Comparable\u003cString\u003e, CharSequence {\n    /** The value is used for character storage. */\n    private final char value[];\n \n    /** Cache the hash code for the string */\n    private int hash; // Default to 0\n    \n    // ...\n    \n}\n```\n\n## finalçš„ä½¿ç”¨\n\nå‘ç°è¯¥ç±»ã€ç±»ä¸­æ‰€æœ‰å±æ€§éƒ½æ˜¯ ï¬nal çš„\n- å±æ€§ç”¨ ï¬nal ä¿®é¥°ä¿è¯äº†è¯¥å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ä¿®æ”¹\n- ç±»ç”¨ ï¬nal ä¿®é¥°ä¿è¯äº†è¯¥ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ï¼Œ**é˜²æ­¢å­ç±»æ— æ„é—´ç ´åä¸å¯å˜æ€§**\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¿æŠ¤æ€§æ‹·è´|ä¿æŠ¤æ€§æ‹·è´]]","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%A4%E9%98%B6%E6%AE%B5%E7%BB%88%E6%AD%A2%E6%A8%A1%E5%BC%8F":{"title":"ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼","content":"# ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼\n\nTwo Phase Termination\n\n## è¦ä¼˜é›…\n\n[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]T1ä¼˜é›…çš„ç»ˆæ­¢çº¿ç¨‹T2ï¼ŒæŒ‡çš„æ˜¯ç»™T2ä¸€ä¸ªæ–™ç†åäº‹çš„æœºä¼šã€‚\n\n## é”™è¯¯æ€è·¯\n\n- ä½¿ç”¨çº¿ç¨‹å¯¹è±¡çš„stop()åœæ­¢çº¿ç¨‹ï¼š\n\t- stopæ–¹æ³•ä¼šçœŸæ­£æ€æ­»çº¿ç¨‹ä¼šå¼ºåˆ¶é‡Šæ”¾CPUèµ„æºå’Œé”ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ¸…ç†å·¥ä½œå®Œæ•´ï¼ˆå¦‚å…³é—­æ–‡ä»¶/è¿æ¥ç­‰ï¼‰ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸åŒæ­¥ç­‰é—®é¢˜ï¼Œä¸å®‰å…¨ã€‚å·²å¼ƒç”¨ã€‚\n- ä½¿ç”¨System.exit(int)æ–¹æ³•åœæ­¢çº¿ç¨‹ï¼š\n\t- ç›®çš„æ˜¯åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä¼šè®©æ•´ä¸ªç¨‹åºéƒ½åœæ­¢ã€‚\n\n## ä½¿ç”¨æ‰“æ–­æ ‡è®°å®ç°\n\n### ä¾‹-ç³»ç»ŸçŠ¶æ€å®šæ—¶ç›‘æ§\n\néœ€è¦æœ‰åœæ­¢ç›‘æ§çš„åŠŸèƒ½ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220526162938.png]]\n\n```java\npackage test;  \n  \nimport lombok.extern.slf4j.Slf4j;  \n  \n@Slf4j  \npublic class Test4TPT {  \n    public static void main(String[] args) throws InterruptedException {  \n        TwoPhaseTermination tpt = new TwoPhaseTermination();  \n        tpt.start();  \n  \n        Thread.sleep(3500);  \n        tpt.stop();  \n    }  \n}  \n  \n@Slf4j  \nclass TwoPhaseTermination {  \n    private Thread monitor;  \n  \n    public void start() {  \n        monitor = new Thread(()-\u003e{  \n            while (true) {  \n                Thread current = Thread.currentThread();  \n                if (current.isInterrupted()) {  \n                    log.debug(\"æ–™ç†åäº‹\");  \n                    break;                }  \n                try {  \n                    Thread.sleep(1000);  \n                    log.debug(\"æ­£åœ¨ç›‘æ§\");  \n                } catch (InterruptedException e) {  \n                    e.printStackTrace();  \n                    current.interrupt();  // é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°  \n                }  \n            }  \n        });  \n        monitor.start();  \n    }  \n  \n    public void stop() {  \n        monitor.interrupt();  \n    }  \n}\n```\n\n## ä½¿ç”¨volatileå®ç°","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%AD%E6%96%AD":{"title":"ä¸­æ–­","content":"# ä¸­æ–­\n\nçº¿ç¨‹ä¸­æ–­å³çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­è¢«å…¶ä»–çº¿ç¨‹ç»™æ‰“æ–­äº†ã€‚\n\n## åŸç†\n\n- ä¸­æ–­æ— æ³•ç›´æ¥ç»ˆæ­¢å¦ä¸€[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ï¼Œåªèƒ½å‘èµ·é€šçŸ¥ã€‚\n- ä¸­æ–­éœ€è¦è¢«ä¸­æ–­çº¿ç¨‹è‡ªå·±å¤„ç†ã€‚\n- æ¯ä¸ªå¯¹è±¡æœ‰ä¸€booleanæ ‡è¯†æ˜¯å¦æœ‰ä¸­æ–­è¯·æ±‚ï¼ˆæ¥è‡ªå…¶å®ƒçº¿ç¨‹/è‡ªèº«ï¼‰ã€‚\n\t- çº¿ç¨‹ t1 æƒ³ä¸­æ–­çº¿ç¨‹ t2ï¼Œåªéœ€è¦åœ¨çº¿ç¨‹ t1 ä¸­å°†çº¿ç¨‹ t2 å¯¹è±¡çš„ä¸­æ–­æ ‡è¯†ç½®ä¸º trueï¼Œç„¶åçº¿ç¨‹ t2 å¯ä»¥é€‰æ‹©åœ¨åˆé€‚çš„æ—¶å€™å¤„ç†è¯¥ä¸­æ–­è¯·æ±‚ï¼Œç”šè‡³å¯ä»¥ä¸ç†ä¼šè¯¥è¯·æ±‚ï¼Œå°±åƒè¿™ä¸ªçº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­ä¸€æ ·ã€‚\n\njava.lang.Thread ç±»æä¾›äº†å‡ ä¸ªæ–¹æ³•æ¥æ“ä½œè¿™ä¸ªä¸­æ–­çŠ¶æ€ï¼Œè¿™äº›æ–¹æ³•åŒ…æ‹¬ï¼š\n- `public static booleanÂ interrupted()`ï¼šæµ‹è¯•**å½“å‰**çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­ã€‚çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ç”±è¯¥æ–¹æ³•æ¸…é™¤ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ™ç¬¬äºŒæ¬¡è°ƒç”¨å°†è¿”å› falseï¼ˆåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å·²æ¸…é™¤äº†å…¶ä¸­æ–­çŠ¶æ€ä¹‹åï¼Œä¸”ç¬¬äºŒæ¬¡è°ƒç”¨æ£€éªŒå®Œä¸­æ–­çŠ¶æ€å‰ï¼Œå½“å‰çº¿ç¨‹å†æ¬¡ä¸­æ–­çš„æƒ…å†µé™¤å¤–ï¼‰ã€‚\n- `public booleanÂ isInterrupted()`ï¼šæµ‹è¯•**ç›®æ ‡**çº¿ç¨‹ï¼ˆç”±å…·ä½“Threadå®ä¾‹å†³å®šï¼‰æ˜¯å¦å·²ç»ä¸­æ–­ã€‚çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¸å—è¯¥æ–¹æ³•çš„å½±å“ã€‚\n- `public voidÂ interrupt()`ï¼šä¸­æ–­**ç›®æ ‡**çº¿ç¨‹ï¼Œç»™ç›®æ ‡çº¿ç¨‹å‘ä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼Œçº¿ç¨‹è¢«æ‰“ä¸Šä¸­æ–­æ ‡è®°å³å°†ä¸­æ–­çŠ¶æ€è®¾ç½®ä¸ºtrueã€‚\n\n### å“åº”ä¸­æ–­\n\nå‡è®¾æŸä¸ªçº¿ç¨‹è¦ä¸åœåœ°å¤„ç†æŸä»¶äº‹æƒ…(æ¯”å¦‚ i ä¸€ç›´è‡ªå¢)ï¼Œä½†æ˜¯è¿˜æœ‰ä¸ªè¦æ±‚ï¼šåœ¨å¤„ç†äº‹æƒ…å‰ï¼Œå…ˆè¦æ£€æŸ¥ä¸‹è¿™ä¸ªçº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¦‚æœå·²ç»è¢«ä¸­æ–­ï¼Œå¤„ç†å°±åº”è¯¥ç»“æŸã€‚\n\nä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n```java\npublic class Run {\n \n    public static void main(String[] args) {\n        try {\n            MyThread thread = new MyThread();\n            thread.start();\n            Thread.sleep(20);//modify 2000 to 20\n            thread.interrupt();//è¯·æ±‚ä¸­æ–­MyThreadçº¿ç¨‹\n        } catch (InterruptedException e) {\n            System.out.println(\"main catch\");\n            e.printStackTrace();\n        }\n        System.out.println(\"end!\");\n    }\n}\n```\nmainçº¿ç¨‹ç¡çœ 20msåï¼Œæ‰§è¡Œç¬¬8è¡Œä¸­æ–­MyThreadçº¿ç¨‹ï¼š\n```java\npublic class MyThread extends Thread {\n    @Override\n    public void run() {\n        super.run();\n        for (int i = 0; i \u003c 500000; i++) {\n            if (this.interrupted()) {\n                System.out.println(\"should be stopped and exit\");\n                break;\n            }\n            System.out.println(\"i=\" + (i + 1));\n        }\n        System.out.println(\"this line is also executed. thread does not stopped\");//å°½ç®¡çº¿ç¨‹è¢«ä¸­æ–­,ä½†å¹¶æ²¡æœ‰ç»“æŸè¿è¡Œã€‚è¿™è¡Œä»£ç è¿˜æ˜¯ä¼šè¢«æ‰§è¡Œ\n    }\n}\n```\nå½“MyThreadè·å¾—CPUæ‰§è¡Œæ—¶ï¼Œç¬¬6è¡Œçš„ if æµ‹è¯•ä¸­ï¼Œæ£€æµ‹åˆ°ä¸­æ–­æ ‡è¯†è¢«è®¾ç½®ã€‚å³MyThreadçº¿ç¨‹æ£€æµ‹åˆ°äº†mainçº¿ç¨‹æƒ³è¦ä¸­æ–­å®ƒçš„ è¯·æ±‚ã€‚\n\nå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒMyThreadæ£€æµ‹åˆ°äº†ä¸­æ–­è¯·æ±‚ï¼Œ**å¯¹è¯¥ä¸­æ–­çš„å“åº”æ˜¯ï¼šé€€å‡ºæ‰§è¡Œï¼ˆæˆ–è€…è¯´æ˜¯ç»“æŸæ‰§è¡Œï¼‰ã€‚**\n\nä½†æ˜¯ï¼Œä¸Šé¢ç¬¬5è‡³8è¡Œforå¾ªç¯ï¼Œæ˜¯æ‰§è¡Œbreakè¯­å¥è·³å‡ºforå¾ªç¯ã€‚ä½†æ˜¯ï¼Œçº¿ç¨‹å¹¶æ²¡æœ‰ç»“æŸï¼Œå®ƒåªæ˜¯è·³å‡ºäº†forå¾ªç¯è€Œå·²ï¼Œå®ƒè¿˜ä¼šç»§ç»­æ‰§è¡Œç¬¬12è¡Œçš„ä»£ç ....\n\n**å› æ­¤ï¼Œæˆ‘ä»¬çš„é—®é¢˜æ˜¯ï¼Œå½“æ”¶åˆ°äº†ä¸­æ–­è¯·æ±‚åï¼Œå¦‚ä½•ç»“æŸè¯¥çº¿ç¨‹å‘¢ï¼Ÿ**\n\nä¸€ç§å¯è¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨ return è¯­å¥ è€Œä¸æ˜¯ breakè¯­å¥ã€‚ã€‚ã€‚ã€‚ã€‚å“ˆå“ˆã€‚ã€‚ã€‚\n\n**å½“ç„¶ï¼Œä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼åˆ™æ˜¯ï¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚**\n\nçœ‹ä¸‹é¢MyThreadç±»çš„ä»£ç ï¼š\n```java\npublic class MyThread extends Thread {\n    @Override\n    public void run() {\n        super.run();\n        try{\n            for (int i = 0; i \u003c 500000; i++) {\n                if (this.interrupted()) {\n                    System.out.println(\"should be stopped and exit\");\n                    throw new InterruptedException();\n                }\n                System.out.println(\"i=\" + (i + 1));\n            }\n            System.out.println(\"this line cannot be executed. cause thread throws exception\"); //è¿™è¡Œè¯­å¥ä¸ä¼šè¢«æ‰§è¡Œ!!!\n        }catch(InterruptedException e){\n            System.out.println(\"catch interrupted exception\");\n            e.printStackTrace();\n        }\n    }\n}\n```\n\næ³¨æ„ï¼Œè¿™ä¸ªä¾‹å­ä¸­çš„è¾“å‡ºç»“æœçœ‹èµ·æ¥å¯èƒ½æœ‰é—®é¢˜ï¼Œæ¯”å¦‚æœ‰å‡ è¡Œåœ¨æ’å…¥ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œé˜Ÿåˆ—çš„å‰©ä½™ç©ºé—´ä¸å˜ã€‚è¿™æ˜¯ç”±äº**System.out.printlnè¯­å¥æ²¡æœ‰é”**ã€‚è€ƒè™‘åˆ°è¿™æ ·çš„æƒ…å†µï¼šçº¿ç¨‹1åœ¨æ‰§è¡Œå®Œput/takeæ“ä½œåç«‹å³å¤±å»CPUæ—¶é—´ç‰‡ï¼Œç„¶ååˆ‡æ¢åˆ°çº¿ç¨‹2æ‰§è¡Œput/takeæ“ä½œï¼Œæ‰§è¡Œå®Œæ¯•åå›åˆ°çº¿ç¨‹1çš„System.out.printlnè¯­å¥å¹¶è¾“å‡ºï¼Œå‘ç°è¿™ä¸ªæ—¶å€™é˜»å¡é˜Ÿåˆ—çš„sizeå·²ç»è¢«çº¿ç¨‹2æ”¹å˜äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™è¾“å‡ºçš„sizeå¹¶ä¸æ˜¯å½“æ—¶çº¿ç¨‹1æ‰§è¡Œå®Œput/takeæ“ä½œä¹‹åé˜»å¡é˜Ÿåˆ—çš„sizeï¼Œä½†å¯ä»¥ç¡®ä¿çš„æ˜¯sizeä¸ä¼šè¶…è¿‡10ä¸ªã€‚å®é™…ä¸Šä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚\n\n### çº¿ç¨‹æ± ä¸­ä½¿ç”¨é˜»å¡é˜Ÿåˆ—\n\n```java\npublic ThreadPoolExecutor(int corePoolSize,\n                           int maximumPoolSize,\n                           long keepAliveTime,\n                           TimeUnit unit,\n                           BlockingQueue\u003cRunnable\u003e workQueue) {\n        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,\n             Executors.defaultThreadFactory(), defaultHandler);\n}\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E7%BA%BF%E7%A8%8B%E6%B1%A0":{"title":"ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± ","content":"# ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± \n\nç”¨æ¥ä»£æ›¿[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/Timer|Timer]]ã€‚\n\n## ScheduledExecutorService\n\n```java\nScheduledExecutorService executor = Executors.newScheduledThreadPool(2);\n// æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ï¼Œå¸Œæœ›å®ƒä»¬éƒ½åœ¨ 1s åæ‰§è¡Œ\nexecutor.schedule(() -\u003e {\n    System.out.println(\"ä»»åŠ¡1ï¼Œæ‰§è¡Œæ—¶é—´ï¼š\" + new Date());\n    try { Thread.sleep(2000); } catch (InterruptedException e) { }\n}, 1000, TimeUnit.MILLISECONDS);\nexecutor.schedule(() -\u003e {\n    System.out.println(\"ä»»åŠ¡2ï¼Œæ‰§è¡Œæ—¶é—´ï¼š\" + new Date());\n}, 1000, TimeUnit.MILLISECONDS);\n```\n\n## scheduleAtFixedRate\n\n```java\nScheduledExecutorService executor = Executors.newScheduledThreadPool(2);\n// æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ï¼Œå¸Œæœ›å®ƒä»¬éƒ½åœ¨ 1s åæ‰§è¡Œ\nexecutor.schedule(() -\u003e {\n    System.out.println(\"ä»»åŠ¡1ï¼Œæ‰§è¡Œæ—¶é—´ï¼š\" + new Date());\n    try { Thread.sleep(2000); } catch (InterruptedException e) { }\n}, 1000, TimeUnit.MILLISECONDS);\nexecutor.schedule(() -\u003e {\n    System.out.println(\"ä»»åŠ¡2ï¼Œæ‰§è¡Œæ—¶é—´ï¼š\" + new Date());\n}, 1000, TimeUnit.MILLISECONDS);\n```\n\n## scheduleAtFixedRate\n\né—´éš”æ—¶é—´ä»å‰ä¸€æ¬¡ä»»åŠ¡å¯åŠ¨å¼€å§‹è®¡ç®—ã€‚\n\n```java\nScheduledExecutorService pool = Executors.newScheduledThreadPool(1);\nlog.debug(\"start...\");\npool.scheduleAtFixedRate(() -\u003e {\n    log.debug(\"running...\");\n}, 1, 1, TimeUnit.SECONDS);\n```\n\n```\n21:45:43.167 c.TestTimer [main] - start... \n21:45:44.215 c.TestTimer [pool-1-thread-1] - running... \n21:45:45.215 c.TestTimer [pool-1-thread-1] - running... \n21:45:46.215 c.TestTimer [pool-1-thread-1] - running... \n21:45:47.215 c.TestTimer [pool-1-thread-1] - running... \n```\n\nä»»åŠ¡è¶…è¿‡æ‰§è¡Œæ—¶é—´æ—¶ï¼Œä¼šæŒ¤å é—´éš”æ—¶é—´ï¼Œä½†ä¸ä¼šé‡å æ‰§è¡Œï¼š\n\n```java\nScheduledExecutorService pool = Executors.newScheduledThreadPool(1);\nlog.debug(\"start...\");\npool.scheduleAtFixedRate(() -\u003e {\n    log.debug(\"running...\");\n    sleep(2);\n}, 1, 1, TimeUnit.SECONDS);\n```\n\n```java\n21:44:30.311 c.TestTimer [main] - start... \n21:44:31.360 c.TestTimer [pool-1-thread-1] - running... \n21:44:33.361 c.TestTimer [pool-1-thread-1] - running... \n21:44:35.362 c.TestTimer [pool-1-thread-1] - running... \n21:44:37.362 c.TestTimer [pool-1-thread-1] - running... \n```\n\n## scheduleWithFixedDelay\n\né—´éš”æ—¶é—´æ˜¯ä»å‰ä¸€æ¬¡ä»»åŠ¡ç»“æŸå¼€å§‹è®¡ç®—ï¼Œè€Œä¸æ˜¯å‰ä¸€æ¬¡ä»»åŠ¡å¯åŠ¨å¼€å§‹è®¡ç®—ã€‚\n\n```java\nScheduledExecutorService pool = Executors.newScheduledThreadPool(1);\nlog.debug(\"start...\");\npool.scheduleWithFixedDelay(()-\u003e {\n    log.debug(\"running...\");\n    sleep(2);\n}, 1, 1, TimeUnit.SECONDS);\n```\n\nè¾“å‡ºåˆ†æï¼šä¸€å¼€å§‹ï¼Œå»¶æ—¶ 1sï¼ŒscheduleWithFixedDelay çš„é—´éš”æ˜¯ ä¸Šä¸€ä¸ªä»»åŠ¡ç»“æŸ \u003c-\u003e å»¶æ—¶ \u003c-\u003e ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹ æ‰€ ä»¥é—´éš”éƒ½æ˜¯ 3sï¼š\n\n```java\n21:40:55.078 c.TestTimer [main] - start... \n21:40:56.140 c.TestTimer [pool-1-thread-1] - running... \n21:40:59.143 c.TestTimer [pool-1-thread-1] - running... \n21:41:02.145 c.TestTimer [pool-1-thread-1] - running... \n21:41:05.147 c.TestTimer [pool-1-thread-1] - running... \n```\n\n\n## æ€»ç»“\n\næ•´ä¸ªçº¿ç¨‹æ± è¡¨ç°ä¸ºï¼šçº¿ç¨‹æ•°å›ºå®šï¼Œä»»åŠ¡æ•°å¤šäºçº¿ç¨‹æ•°æ—¶ï¼Œä¼šæ”¾å…¥æ— ç•Œé˜Ÿåˆ—æ’é˜Ÿã€‚ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™äº›çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ã€‚ç”¨æ¥æ‰§è¡Œå»¶è¿Ÿæˆ–åå¤æ‰§è¡Œçš„ä»»åŠ¡\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BC%AA%E5%85%B1%E4%BA%AB":{"title":"ä¼ªå…±äº«","content":"\n# ä¼ªå…±äº«\n\n\u003e ç»™æ•°æ®åŠ å¡«å……è®©æ•°ç»„çš„æ¯ä¸ªå…ƒç´ åœ¨ç¼“å­˜ä¸­å¼ºåˆ¶æ¢è¡Œï¼Œå°†cpuç¼“å­˜ä¸­çš„æ•°æ®æ‹†åˆ†æˆå¤šè¡Œï¼Œé˜²æ­¢æ•°æ®æŒ¨åœ¨ä¸€èµ·åè¢«è¿åå¯¼è‡´ç¼“å­˜é›†ä½“å¤±æ•ˆã€‚\n\nå› ä¸º CPU ä¸ å†…å­˜çš„é€Ÿåº¦å·®å¼‚å¾ˆå¤§ï¼Œéœ€è¦é é¢„è¯»æ•°æ®è‡³ç¼“å­˜æ¥æå‡æ•ˆç‡ã€‚\nè€Œç¼“å­˜ä»¥ç¼“å­˜è¡Œä¸ºå•ä½ï¼Œæ¯ä¸ªç¼“å­˜è¡Œå¯¹åº”ç€ä¸€å—å†…å­˜ï¼Œä¸€èˆ¬æ˜¯ 64 byteï¼ˆ8 ä¸ª longï¼‰ï¼Œç¼“å­˜çš„åŠ å…¥ä¼šé€ æˆæ•°æ®å‰¯æœ¬çš„äº§ç”Ÿï¼Œå³åŒä¸€ä»½æ•°æ®ä¼šç¼“å­˜åœ¨ä¸åŒæ ¸å¿ƒçš„ç¼“å­˜è¡Œä¸­ã€‚\nCPU è¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¦‚æœæŸä¸ª CPU æ ¸å¿ƒæ›´æ”¹äº†æ•°æ®ï¼Œå…¶å®ƒ CPU æ ¸å¿ƒå¯¹åº”çš„æ•´ä¸ªç¼“å­˜è¡Œå¿…é¡»å¤±æ•ˆï¼Œé™ä½æ•ˆç‡ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220602143831.png]]\n\nå› ä¸º Cell æ˜¯æ•°ç»„å½¢å¼ï¼Œåœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œä¸€ä¸ª Cell ä¸º 24 å­—èŠ‚ï¼ˆ16 å­—èŠ‚çš„å¯¹è±¡å¤´å’Œ 8 å­—èŠ‚çš„ valueï¼‰ï¼Œå›  æ­¤ç¼“å­˜è¡Œå¯ä»¥å­˜ä¸‹ 2 ä¸ªçš„ Cell å¯¹è±¡ã€‚è¿™æ ·é—®é¢˜æ¥äº†ï¼š\n- Core-0 è¦ä¿®æ”¹ Cell[0]\n- Core-1 è¦ä¿®æ”¹ Cell[1]\n\næ— è®ºè°ä¿®æ”¹æˆåŠŸï¼Œéƒ½ä¼šå¯¼è‡´å¯¹æ–¹ Core çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œæ¯”å¦‚ Core-0 ä¸­ Cell[0]=6000, Cell[1]=8000 è¦ç´¯åŠ  Cell[0]=6001, Cell[1]=8000 ï¼Œè¿™æ—¶ä¼šè®© Core-1 çš„ç¼“å­˜è¡Œå¤±æ•ˆã€‚\n\n## è§£å†³\n\n`@sun.misc.Contended` ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒçš„åŸç†æ˜¯åœ¨ä½¿ç”¨æ­¤æ³¨è§£çš„å¯¹è±¡æˆ–å­—æ®µçš„å‰åå„å¢åŠ  128 å­—èŠ‚å¤§å°çš„ paddingï¼Œä»è€Œè®© CPU å°†å¯¹è±¡é¢„è¯»è‡³ç¼“å­˜æ—¶å ç”¨ä¸åŒçš„ç¼“å­˜è¡Œï¼Œè¿™æ ·ï¼Œä¸ä¼šé€ æˆå¯¹æ–¹ç¼“å­˜è¡Œçš„å¤±æ•ˆã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220602143930.png]]\n\n#TODO ","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BF%9D%E6%8A%A4%E6%80%A7%E6%8B%B7%E8%B4%9D":{"title":"ä¿æŠ¤æ€§æ‹·è´","content":"# ä¿æŠ¤æ€§æ‹·è´\n\n\u003e å…ˆå¤åˆ¶åˆ°æœ¬åœ°ï¼Œå†åšä¿®æ”¹\n\nä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿæœ‰ä¸€äº›è·Ÿä¿®æ”¹ç›¸å…³çš„æ–¹æ³•å•Šï¼Œæ¯”å¦‚ substring ç­‰ï¼Œé‚£ä¹ˆä¸‹é¢å°±çœ‹ä¸€çœ‹è¿™äº›æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå°±ä»¥ substring ä¸ºä¾‹ï¼š\n\n```java\npublic String substring(int beginIndex) {\n\t// è¾¹ç•Œæ£€æŸ¥\n    if (beginIndex \u003c 0) {\n        throw new StringIndexOutOfBoundsException(beginIndex);\n    }\n    int subLen = value.length - beginIndex;\n    if (subLen \u003c 0) {\n        throw new StringIndexOutOfBoundsException(subLen);\n    }\n\n\t// newä¸€ä¸ªString\n    return (beginIndex == 0) ? this : new String(value, beginIndex, subLen);\n}\n```\n\nå‘ç°å…¶å†…éƒ¨æ˜¯è°ƒç”¨ String çš„æ„é€ æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œå†è¿›å…¥è¿™ä¸ªæ„é€ çœ‹çœ‹ï¼Œæ˜¯å¦å¯¹ ï¬nal char[] value åšå‡º äº†ä¿®æ”¹ï¼š\n\n```java\npublic String(char value[], int offset, int count) {\n    if (offset \u003c 0) {\n        throw new StringIndexOutOfBoundsException(offset);\n    }\n    if (count \u003c= 0) {\n        if (count \u003c 0) {\n            throw new StringIndexOutOfBoundsException(count);\n        }\n        if (offset \u003c= value.length) {\n            this.value = \"\".value;\n            return;\n        }\n    }\n    if (offset \u003e value.length - count) {\n        throw new StringIndexOutOfBoundsException(offset + count);\n    }\n    // å¤åˆ¶å€¼\n    this.value = Arrays.copyOfRange(value, offset, offset+count);\n}\n```\n\nç»“æœå‘ç°ä¹Ÿæ²¡æœ‰ï¼Œæ„é€ æ–°å­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„ char[] valueï¼Œå¯¹å†…å®¹è¿›è¡Œå¤åˆ¶ ã€‚è¿™ç§é€šè¿‡åˆ›å»ºå‰¯æœ¬å¯¹è±¡æ¥é¿å…å…±äº«çš„æ‰‹æ®µç§°ä¹‹ä¸ºã€ä¿æŠ¤æ€§æ‹·è´ï¼ˆdefensive copyï¼‰ã€‘","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%81%8F%E5%90%91%E9%94%81":{"title":"åå‘é”","content":"# åå‘é”\n\n## å­˜åœ¨ç¼˜ç”±\n\nè½»é‡çº§é”åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œæ¯æ¬¡[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è½»é‡çº§é”#è·å–é”|åœ¨5.2é‡å…¥é”æ—¶]]éƒ½è¦é‡å¤æ‰§è¡Œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]æ“ä½œï¼Œä¾‹å¦‚ï¼š\n```java\nstatic final Object obj = new Object();\npublic static void m1() {\n    synchronized( obj ) {\n        // åŒæ­¥å— A\n        m2();\n    }\n}\npublic static void m2() {\n    synchronized( obj ) {\n        // åŒæ­¥å— B\n        m3();\n    }\n}\npublic static void m3() {\n    synchronized( obj ) {\n\t    // åŒæ­¥å— C\n    }\n}\n```\n\nå¯¹åº”è½»é‡çº§é”ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220527220040.png]]\n\nå¯¹åº”åå‘é”ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220527220054.png]]\n\njava6ä¸­å¼•å…¥åå‘é”æ¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š\nåªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨ CAS å°†çº¿ç¨‹ ID è®¾ç½®åˆ°å¯¹è±¡çš„ Mark Word å¤´ï¼Œä¹‹åå‘ç°è¿™ä¸ªçº¿ç¨‹ ID æ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œä¸ç”¨é‡æ–° CASã€‚ä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰ã€‚\n\n## åå‘çŠ¶æ€\n\nä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶ï¼š\n- å¦‚æœå¼€å¯äº†åå‘é”ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œåœ¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/Mark Word|Mark Word]] ä¸­ï¼Œåå‘é”çš„é”æ ‡å¿—ä½ä»ç„¶æ˜¯01ï¼Œåå‘é”æ ‡å¿—ä½1 --\u003e Mark Wordåä¸‰ä½ä¸º101ã€‚\n- åˆå§‹çŠ¶æ€ threadã€epochã€ageéƒ½ä¸º0ã€‚\n- åå‘é”æ˜¯é»˜è®¤æ˜¯**å»¶è¿Ÿ**çš„ï¼ˆ4ç§’ï¼‰ï¼Œä¸ä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶ç«‹å³ç”Ÿæ•ˆï¼Œå¦‚æœæƒ³é¿å…å»¶è¿Ÿï¼Œå¯ä»¥åŠ  VM å‚æ•° -XX:BiasedLockingStartupDelay=0 æ¥ç¦ç”¨å»¶è¿Ÿã€‚\n\t\u003e å› ä¸ºJVMåœ¨å¯åŠ¨æœŸé—´ä¼šé‡‡å–å¤§é‡å®‰å…¨ç‚¹æ¥æ¶ˆé™¤åå·®ã€‚è¿™è·Ÿåå‘é”æœ‰å•¥å…³ç³»ï¼Ÿè¯´ä¸‹æˆ‘çš„ç†è§£å“ˆï¼Œä¸ä¸€å®šæ˜¯JVMå·¥ç¨‹å¸ˆè®¾è®¡æ­¤çš„åˆè¡·ã€‚å®‰å…¨ç‚¹å¤§å®¶åº”è¯¥æ˜¯å¾ˆç†Ÿæ‚‰äº†ï¼Œå¯ç”¨å®‰å…¨ç‚¹ä¼šå¸¦æ¥STWã€‚è€Œåå‘é”çš„æ’¤é”€ä¸é‡åå‘åˆ¤æ–­ï¼Œä¹Ÿæ˜¯éœ€è¦å¯ç”¨å®‰å…¨ç‚¹çš„ï¼Œå› ä¸ºéœ€è¦æ‰«ææ‰€æœ‰çº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆï¼Œéœ€è¦å†…å­˜é™æ­¢æ‰èƒ½ä¿è¯ç»“æœå‡†ç¡®ã€‚è€ŒJVMåœ¨å¯åŠ¨æœŸé—´ç”¨åˆ°çš„é”ï¼ŒåŒ…æ‹¬åˆå§‹åŒ–å¾ˆå¤šç±»çš„è¿‡ç¨‹ä¸­ç”¨çš„é”ï¼Œéƒ½ä¼šç»è¿‡åå‘é”é€»è¾‘ï¼Œå¦‚æœæ²¡æœ‰åå‘å»¶è¿Ÿï¼Œå°±ä¼šå¸¦æ¥æ›´å¤šçš„STWï¼Œå¯¼è‡´JVMå¯åŠ¨æ—¶é—´è¿‡é•¿ã€‚\n- å¦‚æœæ²¡æœ‰å¼€å¯åå‘é”ï¼Œé‚£ä¹ˆå¯¹è±¡åˆ›å»ºåï¼Œmarkword å€¼ä¸º 0x01 å³æœ€å 3 ä½ä¸º 001ï¼Œè¿™æ—¶å®ƒçš„ hashcodeã€age éƒ½ä¸º 0ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ° hashcode æ—¶æ‰ä¼šèµ‹å€¼ã€‚\n- æµ‹è¯•ä»£ç è¿è¡Œæ—¶åœ¨æ·»åŠ  VM å‚æ•° -XX:-UseBiasedLocking ç¦ç”¨åå‘é”ã€‚\n\n## åå‘é”è·å–è¿‡ç¨‹\n\n- è®¿é—®Mark Wordä¸­åå‘é”æ ‡å¿—ä½æ˜¯å¦è®¾ç½®æˆ1ï¼Œé”æ ‡å¿—ä½æ˜¯å¦ä¸º01â€”â€”ç¡®è®¤ä¸ºå¯åå‘çŠ¶æ€ã€‚\n- å¦‚æœä¸ºå¯åå‘çŠ¶æ€ï¼Œåˆ™æµ‹è¯•çº¿ç¨‹IDæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿›å…¥æ­¥éª¤ï¼ˆ5ï¼‰ï¼Œå¦åˆ™è¿›å…¥æ­¥éª¤ï¼ˆ3ï¼‰ã€‚\n- å¦‚æœçº¿ç¨‹IDå¹¶æœªæŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œåˆ™é€šè¿‡CASæ“ä½œç«äº‰é”ã€‚å¦‚æœç«äº‰æˆåŠŸï¼Œåˆ™å°†Mark Wordä¸­çº¿ç¨‹IDè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹IDï¼Œç„¶åæ‰§è¡Œï¼ˆ5ï¼‰ï¼›å¦‚æœç«äº‰å¤±è´¥ï¼Œæ‰§è¡Œï¼ˆ4ï¼‰ã€‚\n- å¦‚æœCASè·å–åå‘é”å¤±è´¥ï¼Œåˆ™è¡¨ç¤ºæœ‰ç«äº‰ã€‚å½“åˆ°è¾¾å…¨å±€å®‰å…¨ç‚¹ï¼ˆsafepointï¼‰æ—¶è·å¾—åå‘é”çš„çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œåå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œç„¶åè¢«é˜»å¡åœ¨å®‰å…¨ç‚¹çš„çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚\n- æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚\n\n![[z-oblib/z2-attachments/åå‘é”2.png]]\n\n## åå‘é”çš„é‡Šæ”¾\n\n![[z-oblib/z2-attachments/åå‘é”.png]]\n\nåå‘é”çš„æ’¤é”€åœ¨ä¸Šè¿°ç¬¬å››æ­¥éª¤ä¸­æœ‰æåˆ°ã€‚åå‘é”åªæœ‰**é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”**æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œ**çº¿ç¨‹ä¸ä¼šä¸»åŠ¨å»é‡Šæ”¾åå‘é”**ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹safepointï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹Aï¼Œç„¶ååˆ¤æ–­è¿™ä¸ªçº¿ç¨‹Aï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æƒ…å†µï¼š \n1. A çº¿ç¨‹å·²ç»é€€å‡ºäº†åŒæ­¥ä»£ç å—ï¼Œæˆ–è€…æ˜¯å·²ç»ä¸å†å­˜æ´»ï¼Œå¦‚æœæ˜¯ä¸Šé¢ä¸¤ç§æƒ…å†µä¹‹ä¸€ï¼Œæ­¤æ—¶å°±ä¼šç›´æ¥æ’¤é”€åå‘é”ï¼Œå˜æˆæ— é”çŠ¶æ€ã€‚\n2. çº¿ç¨‹è¿˜åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Œæ­¤æ—¶å°†Açº¿ç¨‹çš„**åå‘é”å‡çº§ä¸ºè½»é‡çº§é”**ã€‚\n\nåå‘é”å‡çº§æˆè½»é‡çº§é”æ—¶ï¼Œä¼šæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œé‡ç½®åå‘é”æ ‡è¯†ï¼Œè¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥å®¹æ˜“ï¼Œå®åˆ™å¼€é”€è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œå¤§æ¦‚çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n1. åœ¨ä¸€ä¸ªå®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰åœæ­¢æ‹¥æœ‰é”çš„çº¿ç¨‹ã€‚\n2. éå†çº¿ç¨‹æ ˆï¼Œå¦‚æœå­˜åœ¨é”è®°å½•çš„è¯ï¼Œéœ€è¦ä¿®å¤é”è®°å½•å’ŒMark Wordï¼Œä½¿å…¶å˜æˆæ— é”çŠ¶æ€ã€‚\n3. å”¤é†’è¢«åœæ­¢çš„çº¿ç¨‹ï¼Œå°†å½“å‰é”å‡çº§æˆè½»é‡çº§é”ã€‚\n\næ‰€ä»¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºé‡Œæ‰€æœ‰çš„é”é€šå¸¸å¤„äºç«äº‰çŠ¶æ€ï¼Œé‚£ä¹ˆåå‘é”å°±ä¼šæ˜¯ä¸€ç§ç´¯èµ˜ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä¸€å¼€å§‹å°±æŠŠåå‘é”è¿™ä¸ªé»˜è®¤åŠŸèƒ½ç»™å…³é—­ï¼š\n\n```bash\n-XX:UseBiasedLocking=falseã€‚\n```\n\n\n## æ‰¹é‡é‡åå‘\n\n### ä¸ºä»€ä¹ˆæœ‰æ‰¹é‡é‡åå‘\n\nå½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹åå¤è¿›å…¥åŒæ­¥å—æ—¶ï¼Œåå‘é”å¸¦æ¥çš„æ€§èƒ½å¼€é”€åŸºæœ¬å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å½“æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å¾—é”æ—¶ï¼Œå°±éœ€è¦ç­‰åˆ°safe pointæ—¶å°†åå‘é”æ’¤é”€ä¸ºæ— é”çŠ¶æ€æˆ–å‡çº§ä¸ºè½»é‡çº§/é‡é‡çº§é”ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯è¦æ¶ˆè€—ä¸€å®šçš„æˆæœ¬çš„ï¼Œæ‰€ä»¥å¦‚æœè¯´è¿è¡Œæ—¶çš„åœºæ™¯æœ¬èº«å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰çš„ï¼Œé‚£åå‘é”çš„å­˜åœ¨ä¸ä»…ä¸èƒ½æé«˜æ€§èƒ½ï¼Œè€Œä¸”ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å› æ­¤ï¼ŒJVMä¸­å¢åŠ äº†ä¸€ç§æ‰¹é‡é‡åå‘/æ’¤é”€çš„æœºåˆ¶ã€‚\n\n### æ‰¹é‡é‡åå‘çš„åŸç†\n\nç«äº‰å‘ç”Ÿå…ˆå‡çº§æˆè½»é‡çº§é”ï¼Œä½†æ˜¯å¦‚æœçº¿ç¨‹å¯¹é”æ˜¯äº¤é”™è®¿é—®çš„ï¼Œæ²¡æœ‰å®é™…ä¸Šçš„ç«äº‰å‘ç”Ÿï¼Œå¹¶ä¸”æ¬¡æ•°è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œåˆ™ä¼šè¿›è¡Œé‡åå‘ï¼ˆå› ä¸ºåå‘é”ä¸ä¼šé‡Šæ”¾ï¼Œæ‰€ä»¥çº¿ç¨‹ç”¨å®Œé”äº†åå‘çŠ¶æ€ä¸ä¼šæ”¹å˜ï¼Œåˆ«çš„çº¿ç¨‹ä¸€ä¸‹å­ä¸çŸ¥é“ï¼‰ã€‚\n\nepochï¼šä¸€ä¸ªæ—¶é—´æˆ³ï¼Œç”¨æ¥è®°å½•çº¿ç¨‹å¯¹æŸä¸ªç±»ç”Ÿæˆçš„å¯¹è±¡çš„æ§åˆ¶æƒã€‚\n\n\u003e æˆ‘ä»¬è¦å¯¹ä¸€ä¸ª**ç±»**çš„æ‰€æœ‰å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰è¿›è¡Œæ‰¹é‡é‡å®šå‘ï¼Œå°±ä¼šåœ¨ä¸€ä¸ªå…³é”®èŠ‚ç‚¹å¯¹æ‰€æœ‰å®ä¾‹è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰çº¿ç¨‹åœ¨é”å®šè¿™äº›å¯¹è±¡ï¼Œè¢«é”å®šçš„å¯¹è±¡ä¼šæ›´æ–°ä¸€ä¸ªæ ‡è®°ï¼Œè¿™ä¸ªæ ‡è®°å’Œç±»å…ƒæ•°æ®ä¸­çš„æœ€æ–°æ ‡è®°ä¸€è‡´ï¼Œæœªè¢«é”å®šçš„ä¸ä¼šè®°å½•æœ€æ–°å€¼ï¼Œè¿™æ ·å°±èƒ½çŸ¥é“å¯¹è±¡æœ‰æ²¡æœ‰çº¿ç¨‹åœ¨ç”¨ã€‚\n\n1. é¦–å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µepochï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ª**æ—¶é—´æˆ³**ï¼Œä»£è¡¨äº†**åå‘é”çš„æœ‰æ•ˆæ€§**ï¼Œepochå­˜å‚¨åœ¨å¯åå‘å¯¹è±¡çš„MarkWordä¸­ã€‚é™¤äº†**å¯¹è±¡**ä¸­çš„epochï¼Œå¯¹è±¡æ‰€å±çš„**ç±»**classä¿¡æ¯ä¸­ï¼Œä¹Ÿä¼šä¿å­˜ä¸€ä¸ªepochå€¼ã€‚\n    \n2. æ¯å½“é‡åˆ°ä¸€ä¸ªå…¨å±€å®‰å…¨ç‚¹æ—¶(è¿™é‡Œçš„æ„æ€æ˜¯è¯´æ‰¹é‡é‡åå‘æ²¡æœ‰å®Œå…¨æ›¿ä»£äº†å…¨å±€å®‰å…¨ç‚¹ï¼ˆæ¯”å¦‚è¦å¯¹class C è¿›è¡Œæ‰¹é‡é‡åå‘ï¼‰ï¼Œåˆ™é¦–å…ˆå¯¹ class Cä¸­ä¿å­˜çš„epochè¿›è¡Œå¢åŠ æ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„epoch_new\n\n3. ç„¶åæ‰«ææ‰€æœ‰æŒæœ‰ class C **å®ä¾‹**çš„çº¿ç¨‹æ ˆï¼Œæ ¹æ®çº¿ç¨‹æ ˆçš„ä¿¡æ¯**åˆ¤æ–­å‡ºè¯¥çº¿ç¨‹æ˜¯å¦é”å®šäº†è¯¥å¯¹è±¡**ï¼Œä»…å°†epoch_newçš„å€¼èµ‹ç»™**è¢«é”å®š**çš„å¯¹è±¡ä¸­ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨**åå‘é”è¿˜åœ¨è¢«ä½¿ç”¨**çš„å¯¹è±¡æ‰ä¼šè¢«èµ‹å€¼epoch_newã€‚\n\n4. é€€å‡ºå®‰å…¨ç‚¹åï¼Œå½“æœ‰çº¿ç¨‹éœ€è¦å°è¯•è·å–åå‘é”æ—¶ï¼Œç›´æ¥æ£€æŸ¥ class C ä¸­å­˜å‚¨çš„ epoch å€¼æ˜¯å¦ä¸ç›®æ ‡å¯¹è±¡ä¸­å­˜å‚¨çš„ epoch å€¼ç›¸ç­‰ï¼Œ å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¯´æ˜è¯¥å¯¹è±¡çš„åå‘é”å·²ç»æ— æ•ˆäº†ï¼ˆå› ä¸ºæ­¥éª¤3é‡Œé¢å·²ç»è¯´äº†åªæœ‰åå‘é”è¿˜åœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡æ‰ä¼šæœ‰epoch_newï¼Œè¿™é‡Œä¸ç›¸ç­‰çš„åŸå› æ˜¯class Cé‡Œé¢çš„epochå€¼æ˜¯epoch_new,è€Œå½“å‰å¯¹è±¡çš„epoché‡Œé¢çš„å€¼è¿˜æ˜¯epochï¼‰ï¼Œæ­¤æ—¶ç«äº‰çº¿ç¨‹å¯ä»¥å°è¯•å¯¹æ­¤å¯¹è±¡é‡æ–°è¿›è¡Œåå‘æ“ä½œï¼Œ**åå‘è‡ªå·±è€Œä¸æ˜¯å‡çº§æˆè½»é‡çº§é”**ã€‚\n\n## æ’¤é”€\n\n### è°ƒç”¨å¯¹è±¡hashCode\n\nhashCodeä¼šç¦ç”¨åå‘é”ï¼šå“ˆå¸Œç ç”¨çš„æ—¶å€™æ‰äº§ç”Ÿï¼Œé»˜è®¤æ˜¯0ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨å¯¹è±¡çš„hashcodeï¼Œå¯¹è±¡çš„å“ˆå¸Œç æ‰ä¼šäº§ç”Ÿï¼Œæ‰åœ¨å¯¹è±¡å¤´çš„markwordé‡Œé¢å¡«å……å“ˆå¸Œç ã€‚\n\n\u003e è½»é‡çº§é”ä¼šåœ¨é”è®°å½•ä¸­è®°å½• hashCode\né‡é‡çº§é”ä¼šåœ¨ Monitor ä¸­è®°å½• hashCode\n\n### å…¶å®ƒçº¿ç¨‹ä½¿ç”¨å¯¹è±¡\n\nå½“æœ‰å…¶å®ƒçº¿ç¨‹ä½¿ç”¨åå‘é”å¯¹è±¡æ—¶ï¼Œä¼šå°†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ã€‚\n\n### è°ƒç”¨ wait/notify\n\n### æ‰¹é‡æ’¤é”€\n\nå½“æ’¤é”€åå‘é”é˜ˆå€¼è¶…è¿‡ 40 æ¬¡åï¼Œjvm ä¼šå‘ç°è¿™ä¸ªç±»çš„å¯¹è±¡ç«äº‰æ¯”è¾ƒæ¿€çƒˆï¼Œä¸åº”è¯¥ç”¨åå‘é”ã€‚äºæ˜¯æ•´ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šå˜ä¸ºä¸å¯åå‘çš„ï¼Œæ–°å»ºçš„å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯åå‘çš„ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93":{"title":"å†…å­˜æ¨¡å‹æ€»ç»“","content":"# å†…å­˜æ¨¡å‹æ€»ç»“\n\né‡ç‚¹è®¾è®¡åˆ°[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/JMM|JMM]]ä¸­ï¼š\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å¯è§æ€§|å¯è§æ€§]] - ç”± JVM ç¼“å­˜ä¼˜åŒ–å¼•èµ·\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/æœ‰åºæ€§|æœ‰åºæ€§]] - ç”± JVM [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/æŒ‡ä»¤é‡æ’åº|æŒ‡ä»¤é‡æ’åº]]ä¼˜åŒ–å¼•èµ·\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/happens-before|happens-before]] è§„åˆ™\n- åŸç†æ–¹é¢\n\t- CPU æŒ‡ä»¤[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å¹¶è¡Œ|å¹¶è¡Œ]]\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]]\n- æ¨¡å¼æ–¹é¢\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ä¸¤é˜¶æ®µç»ˆæ­¢|ä¸¤é˜¶æ®µç»ˆæ­¢]]æ¨¡å¼çš„ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]] æ”¹è¿›\n\t- [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åŒæ­¥|åŒæ­¥]]æ¨¡å¼ä¹‹ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/Balking|balking]]","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%9B%E5%BB%BA%E5%92%8C%E8%BF%90%E8%A1%8C%E7%BA%BF%E7%A8%8B":{"title":"åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹","content":"# åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹\n\n- åˆ›å»ºæ—¶éƒ¨åˆ†ä½¿ç”¨äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/lambda|lambda]]ç®€åŒ–ä»£ç ï¼Œä¸ºäº†ä¾¿äºç†è§£æœªå…¨éƒ¨ä½¿ç”¨ã€‚\n\n## æ–¹æ³•1 ç›´æ¥ä½¿ç”¨Thread\n\n```java\nThread t1 = new Thread() {  \n    @Override  \n    public void run() {  \n        log.debug(\"running\");  \n    }  \n};  \nt1.start();\n```\n\n## æ–¹æ³•2 Threadé…åˆRunnable\n\n```java\nRunnable runnable = () -\u003e log.debug(\"runnable\");  // lambda  \nThread t2 = new Thread(runnable);  \nt2.start();\n```\n\n## æ–¹æ³•3 Threadé…åˆFutureTask\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/FutureTask|FutureTask]]éœ€è¦ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/Callable|Callable]]è¿›è¡Œå¯ä»¥å¤„ç†è¿”å›å€¼ã€‚\n\n```java\nFutureTask\u003cInteger\u003e task = new FutureTask\u003c\u003e(new Callable\u003cInteger\u003e() {  \n    @Override  \n    public Integer call() throws Exception {  \n        log.debug(\"futuretask\");  \n        return 123;  \n    }  \n});  \nThread t3 = new Thread(task);  \nt3.start();\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E5%BC%95%E7%94%A8":{"title":"åŸå­å¼•ç”¨","content":"# åŸå­å¼•ç”¨\n\n- AtomicReference\n- AtomicMarkableReference\n- AtomicStampedReference\n\n```java\nclass DecimalAccountSafeCas implements DecimalAccount {\n    AtomicReference\u003cBigDecimal\u003e ref;\n \n    public DecimalAccountSafeCas(BigDecimal balance) {\n        ref = new AtomicReference\u003c\u003e(balance);\n    }\n\n\t@Override\n\tpublic BigDecimal getBalance() {\n        return ref.get();\n    }\n \n    @Override\n    public void withdraw(BigDecimal amount) {\n        while (true) {\n            BigDecimal prev = ref.get();\n            BigDecimal next = prev.subtract(amount);\n            if (ref.compareAndSet(prev, next)) {\n                break;\n            }\n        }\n    }\n}\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E6%80%A7":{"title":"åŸå­æ€§","content":"# åŸå­æ€§\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E6%95%B0%E7%BB%84":{"title":"åŸå­æ•°ç»„","content":"# åŸå­æ•°ç»„\n\n- AtomicIntegerArray\n- AtomicLongArray\n- AtomicReferenceArray\n\n```java\n/**\n     å‚æ•°1ï¼Œæä¾›æ•°ç»„ã€å¯ä»¥æ˜¯çº¿ç¨‹ä¸å®‰å…¨æ•°ç»„æˆ–çº¿ç¨‹å®‰å…¨æ•°ç»„\n     å‚æ•°2ï¼Œè·å–æ•°ç»„é•¿åº¦çš„æ–¹æ³•\n     å‚æ•°3ï¼Œè‡ªå¢æ–¹æ³•ï¼Œå›ä¼  array, index\n     å‚æ•°4ï¼Œæ‰“å°æ•°ç»„çš„æ–¹æ³•\n*/\n// supplier æä¾›è€… æ— ä¸­ç”Ÿæœ‰  ()-\u003eç»“æœ\n// function å‡½æ•°   ä¸€ä¸ªå‚æ•°ä¸€ä¸ªç»“æœ   (å‚æ•°)-\u003eç»“æœ  ,  BiFunction (å‚æ•°1,å‚æ•°2)-\u003eç»“æœ\n// consumer æ¶ˆè´¹è€… ä¸€ä¸ªå‚æ•°æ²¡ç»“æœ  (å‚æ•°)-\u003evoid,      BiConsumer (å‚æ•°1,å‚æ•°2)-\u003e\nprivate static \u003cT\u003e void demo(\n    Supplier\u003cT\u003e arraySupplier,\n    Function\u003cT, Integer\u003e lengthFun,\n    BiConsumer\u003cT, Integer\u003e putConsumer,\n    Consumer\u003cT\u003e printConsumer ) {\n    List\u003cThread\u003e ts = new ArrayList\u003c\u003e();\n    T array = arraySupplier.get();\n    int length = lengthFun.apply(array);\n    for (int i = 0; i \u003c length; i++) {\n        // æ¯ä¸ªçº¿ç¨‹å¯¹æ•°ç»„ä½œ 10000 æ¬¡æ“ä½œ\n        ts.add(new Thread(() -\u003e {\n            for (int j = 0; j \u003c 10000; j++) {\n                putConsumer.accept(array, j%length);\n            }\n        }));\n    }\n \n    ts.forEach(t -\u003e t.start()); // å¯åŠ¨æ‰€æœ‰çº¿ç¨‹\n    ts.forEach(t -\u003e {\n        try {\n            t.join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    });     // ç­‰æ‰€æœ‰çº¿ç¨‹ç»“æŸ\n    printConsumer.accept(array);\n}\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E6%95%B4%E6%95%B0":{"title":"åŸå­æ•´æ•°","content":"# åŸå­æ•´æ•°\n\nJ.U.C å¹¶å‘åŒ…æä¾›äº†ï¼š\n- AtomicBoolean\n- AtomicInteger\n- AtomicLong\nä»¥ AtomicInteger ä¸ºä¾‹ï¼š\n\n```java\nAtomicInteger i = new AtomicInteger(0);\n \n// è·å–å¹¶è‡ªå¢ï¼ˆi = 0, ç»“æœ i = 1, è¿”å› 0ï¼‰ï¼Œç±»ä¼¼äº i++\nSystem.out.println(i.getAndIncrement());\n \n// è‡ªå¢å¹¶è·å–ï¼ˆi = 1, ç»“æœ i = 2, è¿”å› 2ï¼‰ï¼Œç±»ä¼¼äº ++i\nSystem.out.println(i.incrementAndGet());\n \n// è‡ªå‡å¹¶è·å–ï¼ˆi = 2, ç»“æœ i = 1, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº --i\nSystem.out.println(i.decrementAndGet());\n \n// è·å–å¹¶è‡ªå‡ï¼ˆi = 1, ç»“æœ i = 0, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº i--\nSystem.out.println(i.getAndDecrement());\n \n// è·å–å¹¶åŠ å€¼ï¼ˆi = 0, ç»“æœ i = 5, è¿”å› 0ï¼‰\nSystem.out.println(i.getAndAdd(5));\n \n// åŠ å€¼å¹¶è·å–ï¼ˆi = 5, ç»“æœ i = 0, è¿”å› 0ï¼‰\nSystem.out.println(i.addAndGet(-5));\n \n// è·å–å¹¶æ›´æ–°ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = -2, è¿”å› 0ï¼‰\n// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨\nSystem.out.println(i.getAndUpdate(p -\u003e p - 2));\n \n// æ›´æ–°å¹¶è·å–ï¼ˆi = -2, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = 0, è¿”å› 0ï¼‰\n// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨\nSystem.out.println(i.updateAndGet(p -\u003e p + 2));\n \n// è·å–å¹¶è®¡ç®—ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 10, è¿”å› 0ï¼‰\n// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨\n// getAndUpdate å¦‚æœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„\n// getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ final\nSystem.out.println(i.getAndAccumulate(10, (p, x) -\u003e p + x));\n \n// è®¡ç®—å¹¶è·å–ï¼ˆi = 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 0, è¿”å› 0ï¼‰\n// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨\nSystem.out.println(i.accumulateAndGet(-10, (p, x) -\u003e p + x));\n```\n\n#TODO","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E7%B4%AF%E5%8A%A0%E5%99%A8":{"title":"åŸå­ç´¯åŠ å™¨","content":"\n# åŸå­ç´¯åŠ å™¨\n\næ€§èƒ½æå‡çš„åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æœ‰ç«äº‰æ—¶ï¼Œè®¾ç½®å¤šä¸ªç´¯åŠ å•å…ƒï¼ŒTherad-0 ç´¯åŠ  Cell[0]ï¼Œè€Œ Thread-1 ç´¯åŠ Cell[1]... æœ€åå°†ç»“æœæ±‡æ€»ã€‚è¿™æ ·å®ƒä»¬åœ¨ç´¯åŠ æ—¶æ“ä½œçš„ä¸åŒçš„ Cell å˜é‡ï¼Œå› æ­¤å‡å°‘äº† CAS é‡è¯•å¤±è´¥ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚\n\nç´¯åŠ å•å…ƒä¸ä¼šè¶…è¿‡cpuçš„æ ¸å¿ƒæ•°ï¼Œæ ¸å¿ƒæ•°è¶Šå¤šæå‡è¶Šæ˜æ˜¾ã€‚\n\n## æºç åˆ†æ\n\n#TODO","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8F%98%E9%87%8F%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8":{"title":"å˜é‡çš„çº¿ç¨‹å®‰å…¨","content":"# å˜é‡çš„çº¿ç¨‹å®‰å…¨\n\n## æˆå‘˜å˜é‡\n\n- å¦‚æœå®ƒä»¬æ²¡æœ‰å…±äº«ï¼Œåˆ™[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]å®‰å…¨\n- å¦‚æœå®ƒä»¬è¢«å…±äº«äº†ï¼Œæ ¹æ®å®ƒä»¬çš„çŠ¶æ€æ˜¯å¦èƒ½å¤Ÿæ”¹å˜ï¼Œåˆåˆ†ä¸¤ç§æƒ…å†µ\n\t- å¦‚æœåªæœ‰**è¯»**æ“ä½œï¼Œåˆ™çº¿ç¨‹å®‰å…¨\n\t- å¦‚æœæœ‰è¯»**å†™**æ“ä½œï¼Œåˆ™è¿™æ®µä»£ç æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/ä¸´ç•ŒåŒº|ä¸´ç•ŒåŒº]]ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨\n\n## å±€éƒ¨å˜é‡\n\n- å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨\n- å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡ä¸ä¸€å®šçº¿ç¨‹å®‰å…¨\n\t- å¦‚æœè¯¥å¯¹è±¡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨è®¿é—®ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„\n\t- å¦‚æœè¯¥å¯¹è±¡é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨\n\n### åˆ†æ\n\n#### éå¼•ç”¨å±€éƒ¨å˜é‡\n\n```java\npublic static void test1() {\n    int i = 10;\n    i++;\n}\n```\n\næ¯ä¸ªçº¿ç¨‹è°ƒç”¨ test1() æ–¹æ³•æ—¶å±€éƒ¨å˜é‡ iï¼Œä¼šåœ¨æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§å†…å­˜ä¸­è¢«åˆ›å»ºå¤šä»½ï¼Œå› æ­¤ä¸å­˜åœ¨å…±äº«ã€‚\n\n```\npublic static void test1();\n    descriptor: ()V\n    flags: ACC_PUBLIC, ACC_STATIC\n    Code:\n      stack=1, locals=1, args_size=0\n         0: bipush        10\n         2: istore_0\n         3: iinc          0, 1\n         6: return\n      LineNumberTable:\n        line 10: 0\n        line 11: 3\n        line 12: 6\n      LocalVariableTable:\n        Start  Length  Slot  Name   Signature\n            3       4     0     i   I\n```\n\n![[z-oblib/z2-attachments/Pasted image 20220527140033.png]]\n\n#### å¼•ç”¨å±€éƒ¨å˜é‡\n\n```java\nclass ThreadUnsafe {\n    ArrayList\u003cString\u003e list = new ArrayList\u003c\u003e();\n    public void method1(int loopNumber) {\n        for (int i = 0; i \u003c loopNumber; i++) {\n            // { ä¸´ç•ŒåŒº, ä¼šäº§ç”Ÿç«æ€æ¡ä»¶\n            method2();\n            method3();\n            // } ä¸´ç•ŒåŒº\n        }\n    }\n \n    private void method2() {\n        list.add(\"1\");\n    }\n \n    private void method3() {\n        list.remove(0);\n    }\n}\n\nstatic final int THREAD_NUMBER = 2;\nstatic final int LOOP_NUMBER = 200;\npublic static void main(String[] args) {\n    ThreadUnsafe test = new ThreadUnsafe();\n    for (int i = 0; i \u003c THREAD_NUMBER; i++) {\n        new Thread(() -\u003e {\n            test.method1(LOOP_NUMBER);\n        }, \"Thread\" + i).start();\n    }\n}\n```\n\nä¸Šè¿°ä»£ç ä¸­ï¼Œåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹å¤šä¸ªæˆå‘˜å‡½æ•°å¯¹åŒä¸€ä¸ªæˆå‘˜å˜é‡è¿›è¡Œäº†æ“ä½œï¼Œäº§ç”Ÿäº†ä¸´ç•ŒåŒºã€‚\n\nå¦‚æœçº¿ç¨‹1addåˆ°ä¸€åŠæ—¶çº¿ç¨‹2removeä¼šæŠ¥é”™ã€‚\n\nå¤šä¸ª[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/JVMçš„æ ˆå¸§|æ ˆå¸§]]ä¸Šçš„å‡½æ•°æ ˆä¸­ï¼Œå˜é‡å¼•ç”¨äº†åŒä¸€ä¸ªå †ä¸Šèµ„æºï¼š\n![[z-oblib/z2-attachments/Pasted image 20220527140412.png]]\n\nå°†èµ„æºæ”¹ä¸ºæˆå‘˜å˜é‡å³å¯ï¼š\n\n```java\nclass ThreadSafe {\n    public final void method1(int loopNumber) {\n        ArrayList\u003cString\u003e list = new ArrayList\u003c\u003e();\n        for (int i = 0; i \u003c loopNumber; i++) {\n            method2(list);\n            method3(list);\n        }\n    }\n \n    private void method2(ArrayList\u003cString\u003e list) {\n        list.add(\"1\");\n    }\n \n    private void method3(ArrayList\u003cString\u003e list) {\n        list.remove(0);\n    }\n}\n```\n\n![[z-oblib/z2-attachments/Pasted image 20220527141920.png]]\n\n##### æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦å¸¦æ¥çš„æ€è€ƒ\n\nå¦‚æœæŠŠ method2 å’Œ method3 çš„æ–¹æ³•ä¿®æ”¹ä¸º public ä¼šä¸ä¼šä»£ç†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ\n- æƒ…å†µ1ï¼šæœ‰å…¶å®ƒçº¿ç¨‹è°ƒç”¨ method2 å’Œ method3\n- æƒ…å†µ2ï¼šåœ¨ æƒ…å†µ1 çš„åŸºç¡€ä¸Šï¼Œä¸º ThreadSafe ç±»æ·»åŠ å­ç±»ï¼Œå­ç±»è¦†ç›– method2 æˆ– method3 æ–¹æ³•ï¼Œå³ï¼š\n\n```java\nclass ThreadSafe {\n    public final void method1(int loopNumber) {\n        ArrayList\u003cString\u003e list = new ArrayList\u003c\u003e();\n        for (int i = 0; i \u003c loopNumber; i++) {\n            method2(list);\n            method3(list);\n        }\n    }\n \n    private void method2(ArrayList\u003cString\u003e list) {\n\n        list.add(\"1\");\n    }\n \n    private void method3(ArrayList\u003cString\u003e list) {\n        list.remove(0);\n    }\n}\n \nclass ThreadSafeSubClass extends ThreadSafe{\n    @Override\n    public void method3(ArrayList\u003cString\u003e list) {\n        new Thread(() -\u003e {\n            list.remove(0);\n        }).start();\n    }\n}\n```\n\n\u003e å­ç±»è¦†å†™äº†method3ï¼Œä¼šå¯¼è‡´åœ¨å­ç±»å¯¹è±¡ä¸­æ‰§è¡Œmethod1æ—¶ï¼Œè°ƒç”¨çš„method3æ˜¯å­ç±»è¦†å†™è¿‡çš„ã€‚å› ä¸ºpublicä¿®é¥°çš„æˆå‘˜æ–¹æ³•åœ¨jvmå¯¹åº”çš„å­—èŠ‚ç æ˜¯INVOKEVIRTUALï¼Œæ˜¯ä¼šæ ¹æ®å¯¹è±¡ç±»å‹æ¥é“¾æ¥æ–¹æ³•çš„ã€‚ #TODO : è¡¥å……çŸ¥è¯†ã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8F%AF%E8%A7%81%E6%80%A7":{"title":"å¯è§æ€§","content":"# å¯è§æ€§\n\n## ä¸¾ä¾‹\n\nmain çº¿ç¨‹å¯¹ run å˜é‡çš„ä¿®æ”¹å¯¹äº t çº¿ç¨‹ä¸å¯è§ï¼Œå¯¼è‡´äº† t çº¿ç¨‹æ— æ³•åœæ­¢ï¼š\n\n```java\nstatic boolean run = true;\n \npublic static void main(String[] args) throws InterruptedException {\n    Thread t = new Thread(()-\u003e{\n        while(run){\n            // ....\n        }\n    });\n    t.start();\n \n    sleep(1);\n    run = false; // çº¿ç¨‹tä¸ä¼šå¦‚é¢„æƒ³çš„åœä¸‹æ¥\n}\n```\n\n åˆå§‹çŠ¶æ€ï¼Œ t çº¿ç¨‹åˆšå¼€å§‹ä»ä¸»å†…å­˜è¯»å–äº† run çš„å€¼åˆ°å·¥ä½œå†…å­˜:\n ![[z-oblib/z2-attachments/Pasted image 20220530204318.png]]\n\nå› ä¸º t çº¿ç¨‹è¦é¢‘ç¹ä»ä¸»å†…å­˜ä¸­è¯»å– run çš„å€¼ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°† run çš„å€¼ç¼“å­˜è‡³è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œå‡å°‘å¯¹ä¸»å­˜ä¸­ run çš„è®¿é—®ï¼Œæé«˜æ•ˆç‡:\n![[z-oblib/z2-attachments/Pasted image 20220530204336.png]]\n\n1 ç§’ä¹‹åï¼Œmain çº¿ç¨‹ä¿®æ”¹äº† run çš„å€¼ï¼Œå¹¶åŒæ­¥è‡³ä¸»å­˜ï¼Œè€Œ t æ˜¯ä»è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ï¼Œç»“æœæ°¸è¿œæ˜¯æ—§å€¼ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220530204356.png]]\n\n## è§£å†³æ–¹æ¡ˆ\n\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]]","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%93%B2%E5%AD%A6%E5%AE%B6%E5%B0%B1%E9%A4%90%E9%97%AE%E9%A2%98":{"title":"å“²å­¦å®¶å°±é¤é—®é¢˜","content":"# å“²å­¦å®¶å°±é¤é—®é¢˜\n\n![[z-oblib/z2-attachments/Pasted image 20220529223523.png]]\n\næœ‰äº”ä½å“²å­¦å®¶ï¼Œå›´ååœ¨åœ†æ¡Œæ—ï¼š\n- ä»–ä»¬åªåšä¸¤ä»¶äº‹ï¼Œæ€è€ƒå’Œåƒé¥­ï¼Œæ€è€ƒä¸€ä¼šåƒå£é¥­ï¼Œåƒå®Œé¥­åæ¥ç€æ€è€ƒã€‚\n- åƒé¥­æ—¶è¦ç”¨ä¸¤æ ¹ç­·å­åƒï¼Œæ¡Œä¸Šå…±æœ‰ 5 æ ¹ç­·å­ï¼Œæ¯ä½å“²å­¦å®¶å·¦å³æ‰‹è¾¹å„æœ‰ä¸€æ ¹ç­·å­ã€‚\n- å¦‚æœç­·å­è¢«èº«è¾¹çš„äººæ‹¿ç€ï¼Œè‡ªå·±å°±å¾—ç­‰å¾…\n\n```java\npackage test;  \n  \nimport lombok.extern.slf4j.Slf4j;  \n  \npublic class Test14 {  \n    public static void main(String[] args) {  \n        Chopstick c1 = new Chopstick(\"1\");  \n        Chopstick c2 = new Chopstick(\"2\");  \n        Chopstick c3 = new Chopstick(\"3\");  \n        Chopstick c4 = new Chopstick(\"4\");  \n        Chopstick c5 = new Chopstick(\"5\");  \n        new Philosopher(\"è‹æ ¼æ‹‰åº•\", c1, c2).start();  \n        new Philosopher(\"æŸæ‹‰å›¾\", c2, c3).start();  \n        new Philosopher(\"äºšé‡Œå£«å¤šå¾·\", c3, c4).start();  \n        new Philosopher(\"èµ«æ‹‰å…‹åˆ©ç‰¹\", c4, c5).start();  \n        new Philosopher(\"é˜¿åŸºç±³å¾·\", c5, c1).start();  \n    }  \n}  \n  \nclass Chopstick {  \n    String name;  \n  \n    public Chopstick(String name) {  \n        this.name = name;  \n    }  \n  \n    @Override  \n    public String toString() {  \n        return \"ç­·å­{\" + name + '}';  \n    }  \n}  \n  \n@Slf4j  \nclass Philosopher extends Thread {  \n    Chopstick left;  \n    Chopstick right;  \n    public Philosopher(String name, Chopstick left, Chopstick right) {  \n        super(name);  \n        this.left = left;  \n        this.right = right;  \n    }  \n  \n    private void eat() {  \n        log.debug(\"eating...\");  \n        try {  \n            Thread.sleep(1000);  \n        } catch (InterruptedException e) {  \n            throw new RuntimeException(e);  \n        }  \n    }  \n  \n    @Override  \n    public void run() {  \n        while (true) {  \n            // è·å¾—å·¦æ‰‹ç­·å­  \n            synchronized (left) {  \n                // è·å¾—å³æ‰‹ç­·å­  \n                synchronized (right) {  \n                    // åƒé¥­  \n                    eat();  \n                }  \n                // æ”¾ä¸‹å³æ‰‹ç­·å­  \n            }  \n            // æ”¾ä¸‹å·¦æ‰‹ç­·å­  \n        }  \n    }  \n}\n```","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%A4%9A%E6%8A%8A%E9%94%81":{"title":"å¤šæŠŠé”","content":"# å¤šæŠŠé”\n\n## ä»£ç æ¼”ç¤º\n\n```java\nclass BigRoom {\n \n    public void sleep() {\n        synchronized (this) {\n            log.debug(\"sleeping 2 å°æ—¶\");\n            Sleeper.sleep(2);\n        }\n    }\n \n    public void study() {\n        synchronized (this) {\n            log.debug(\"study 1 å°æ—¶\");\n            Sleeper.sleep(1);\n        }\n    }\n \n}\n```\n\nç»†åˆ†é”çš„ç²’åº¦ï¼šä¸¤ä¸ªç‹¬ç«‹çš„åŠŸèƒ½ç”¨äº†åŒä¸€æŠŠé”ï¼Œå¯¼è‡´[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å¹¶å‘|å¹¶å‘]]åº¦ä¸‹é™ï¼Œæ”¹è¿›ï¼š\n\n```java\nclass BigRoom {\n \n    private final Object studyRoom = new Object();\n    private final Object bedRoom = new Object();\n \n    public void sleep() {\n    synchronized (bedRoom) {\n            log.debug(\"sleeping 2 å°æ—¶\");\n            Sleeper.sleep(2);\n        }\n    }\n \n    public void study() {\n        synchronized (studyRoom) {\n            log.debug(\"study 1 å°æ—¶\");\n            Sleeper.sleep(1);\n        }\n    }\n \n}\n```\n\nå¯¹ç‹¬ç«‹çš„åŠŸèƒ½ä½¿ç”¨ç‹¬ç«‹çš„å¤šæŠŠé”ï¼Œæé«˜å¹¶å‘åº¦ã€‚\n\n\u003e æ³¨æ„ï¼Œç»™æ–¹æ³•åŠ é”è¿˜æ˜¯é”åœ¨thisä¸Šã€‚\n\n## ä¼˜ç¼ºç‚¹\n\nå¥½å¤„ï¼Œæ˜¯å¯ä»¥å¢å¼ºå¹¶å‘åº¦\nåå¤„ï¼Œå¦‚æœä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]éœ€è¦åŒæ—¶è·å¾—å¤šæŠŠé”ï¼Œå°±å®¹æ˜“å‘ç”Ÿæ­»é”\n\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0%E5%99%A8":{"title":"å­—æ®µæ›´æ–°å™¨","content":"# å­—æ®µæ›´æ–°å™¨\n\n- AtomicReferenceFieldUpdater // åŸŸ  å­—æ®µ\n- AtomicIntegerFieldUpdater\n- AtomicLongFieldUpdater\n\nåˆ©ç”¨å­—æ®µæ›´æ–°å™¨ï¼Œå¯ä»¥é’ˆå¯¹å¯¹è±¡çš„æŸä¸ªåŸŸï¼ˆFieldï¼‰è¿›è¡ŒåŸå­æ“ä½œï¼Œåªèƒ½é…åˆ volatile ä¿®é¥°çš„å­—æ®µä½¿ç”¨ï¼Œå¦åˆ™ä¼šå‡ºç°å¼‚å¸¸\n\n#TODO","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8":{"title":"å¹¶å‘é›†åˆå®¹å™¨","content":"# å¹¶å‘é›†åˆå®¹å™¨\n\n\u003eå¹¶å‘å®¹å™¨æ˜¯Java 5 æä¾›çš„åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸‹ç”¨äºä»£æ›¿åŒæ­¥å®¹å™¨ï¼Œé’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯è¿›è¡Œè®¾è®¡ï¼Œæé«˜å®¹å™¨çš„å¹¶å‘è®¿é—®æ€§ï¼ŒåŒæ—¶å®šä¹‰äº†çº¿ç¨‹å®‰å…¨çš„å¤åˆæ“ä½œã€‚\n\næˆ‘ä»¬çŸ¥é“åœ¨java.utilåŒ…ä¸‹æä¾›äº†ä¸€äº›å®¹å™¨ç±»ï¼Œè€ŒVectorå’ŒHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ç±»ï¼Œä½†æ˜¯è¿™äº›å®¹å™¨å®ç°åŒæ­¥çš„æ–¹å¼æ˜¯é€šè¿‡å¯¹æ–¹æ³•åŠ é”(sychronized)æ–¹å¼å®ç°çš„ï¼Œè¿™æ ·è¯»å†™å‡éœ€è¦é”æ“ä½œï¼Œå¯¼è‡´æ€§èƒ½ä½ä¸‹ã€‚\n\nè€Œå³ä½¿æ˜¯Vectorè¿™æ ·çº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œåœ¨é¢å¯¹å¤šçº¿ç¨‹ä¸‹çš„å¤åˆæ“ä½œçš„æ—¶å€™ä¹Ÿæ˜¯éœ€è¦é€šè¿‡å®¢æˆ·ç«¯åŠ é”çš„æ–¹å¼ä¿è¯åŸå­æ€§ã€‚å¦‚ä¸‹é¢ä¾‹å­è¯´æ˜ï¼š\n```java\npublic class TestVector {\n    private Vector\u003cString\u003e vector;\n\n    //æ–¹æ³•ä¸€\n    public  Object getLast(Vector vector) {\n        int lastIndex = vector.size() - 1;\n        return vector.get(lastIndex);\n    }\n\n    //æ–¹æ³•äºŒ\n    public  void deleteLast(Vector vector) {\n        int lastIndex = vector.size() - 1;\n        vector.remove(lastIndex);\n    }\n\n    //æ–¹æ³•ä¸‰\n    public  Object getLastSysnchronized(Vector vector) {\n        synchronized(vector){\n            int lastIndex = vector.size() - 1;\n            return vector.get(lastIndex);\n        }\n    }\n\n    //æ–¹æ³•å››\n    public  void deleteLastSysnchronized(Vector vector) {\n        synchronized (vector){\n            int lastIndex = vector.size() - 1;\n            vector.remove(lastIndex);\n        }\n    }\n\n}\n```\n\nå¦‚æœæ–¹æ³•ä¸€å’Œæ–¹æ³•äºŒä¸ºä¸€ä¸ªç»„åˆçš„è¯ã€‚é‚£ä¹ˆå½“æ–¹æ³•ä¸€è·å–åˆ°äº†`vector`çš„sizeä¹‹åï¼Œæ–¹æ³•äºŒå·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œè¿™æ ·å°±å¯¼è‡´ç¨‹åºçš„é”™è¯¯ã€‚\n\nå¦‚æœæ–¹æ³•ä¸‰ä¸æ–¹æ³•å››ç»„åˆçš„è¯ã€‚é€šè¿‡é”æœºåˆ¶ä¿è¯äº†åœ¨`vector`ä¸Šçš„æ“ä½œçš„åŸå­æ€§ã€‚\n\n## å¹¶å‘å®¹å™¨ç±»\n\n![[z-oblib/z2-attachments/assets--L_5HvtIhTFW9TQlOF8e--L_5TIKcBFHWPtY3OwUo--L_5TIqiTZQ7Me5TObhp-å¹¶å‘å®¹å™¨ 1.png]]\n\n### å¹¶å‘Map\n\n#### ConcurrentMapæ¥å£\n\nConcurrentMapæ¥å£ç»§æ‰¿äº†Mapæ¥å£ï¼Œåœ¨Mapæ¥å£çš„åŸºç¡€ä¸Šåˆå®šä¹‰äº†å››ä¸ªæ–¹æ³•ï¼š\n\n```java\npublic interface ConcurrentMap\u003cK, V\u003e extends Map\u003cK, V\u003e {\n\n    //æ’å…¥å…ƒç´ \n    V putIfAbsent(K key, V value);\n\n    //ç§»é™¤å…ƒç´ \n    boolean remove(Object key, Object value);\n\n    //æ›¿æ¢å…ƒç´ \n    boolean replace(K key, V oldValue, V newValue);\n\n    //æ›¿æ¢å…ƒç´ \n    V replace(K key, V value);\n\n}\n```\n\nputIfAbsentï¼šä¸åŸæœ‰putæ–¹æ³•ä¸åŒçš„æ˜¯ï¼ŒputIfAbsentæ–¹æ³•ä¸­å¦‚æœæ’å…¥çš„keyç›¸åŒï¼Œåˆ™ä¸æ›¿æ¢åŸæœ‰çš„valueå€¼ï¼›\n\nremoveï¼šä¸åŸæœ‰removeæ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œæ–°removeæ–¹æ³•ä¸­å¢åŠ äº†å¯¹valueçš„åˆ¤æ–­ï¼Œå¦‚æœè¦åˆ é™¤çš„key-valueä¸èƒ½ä¸Mapä¸­åŸæœ‰çš„key-valueå¯¹åº”ä¸Šï¼Œåˆ™ä¸ä¼šåˆ é™¤è¯¥å…ƒç´ ;\n\nreplace(K,V,V)ï¼šå¢åŠ äº†å¯¹valueå€¼çš„åˆ¤æ–­ï¼Œå¦‚æœkey-oldValueèƒ½ä¸Mapä¸­åŸæœ‰çš„key-valueå¯¹åº”ä¸Šï¼Œæ‰è¿›è¡Œæ›¿æ¢æ“ä½œï¼›\n\nreplace(K,V)ï¼šä¸ä¸Šé¢çš„replaceä¸åŒçš„æ˜¯ï¼Œæ­¤replaceä¸ä¼šå¯¹Mapä¸­åŸæœ‰çš„key-valueè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœkeyå­˜åœ¨åˆ™ç›´æ¥æ›¿æ¢ï¼›\n\n#### ConcurrentHashMapç±»\n\nConcurrentHashMapåŒHashMapä¸€æ ·ä¹Ÿæ˜¯åŸºäºæ•£åˆ—è¡¨çš„mapï¼Œä½†æ˜¯å®ƒæä¾›äº†ä¸€ç§ä¸Hashtableå®Œå…¨ä¸åŒçš„åŠ é”ç­–ç•¥ï¼Œæä¾›æ›´é«˜æ•ˆçš„å¹¶å‘æ€§å’Œä¼¸ç¼©æ€§ã€‚\n\nConcurrentHashMapåœ¨JDK 1.7 å’ŒJDK 1.8ä¸­æœ‰ä¸€äº›åŒºåˆ«ã€‚è¿™é‡Œæˆ‘ä»¬åˆ†å¼€ä»‹ç»ä¸€ä¸‹ã€‚\n\n##### JDK 1.7\n\nConcurrentHashMapåœ¨JDK 1.7ä¸­ï¼Œæä¾›äº†ä¸€ç§ç²’åº¦æ›´ç»†çš„åŠ é”æœºåˆ¶æ¥å®ç°åœ¨å¤šçº¿ç¨‹ä¸‹æ›´é«˜çš„æ€§èƒ½ï¼Œè¿™ç§æœºåˆ¶å«åˆ†æ®µé”(Lock Striping)ã€‚\n\næä¾›çš„ä¼˜ç‚¹æ˜¯ï¼šåœ¨å¹¶å‘ç¯å¢ƒä¸‹å°†å®ç°æ›´é«˜çš„ååé‡ï¼Œè€Œåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹åªæŸå¤±éå¸¸å°çš„æ€§èƒ½ã€‚\n\nå¯ä»¥è¿™æ ·ç†è§£åˆ†æ®µé”ï¼Œå°±æ˜¯å°†æ•°æ®åˆ†æ®µï¼Œå¯¹æ¯ä¸€æ®µæ•°æ®åˆ†é…ä¸€æŠŠé”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®çš„æ—¶å€™ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚\n\næœ‰äº›æ–¹æ³•éœ€è¦è·¨æ®µï¼Œæ¯”å¦‚size()ã€isEmpty()ã€containsValue()ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦é”å®šæ•´ä¸ªè¡¨è€Œä¸ä»…ä»…æ˜¯æŸä¸ªæ®µï¼Œè¿™éœ€è¦æŒ‰é¡ºåºé”å®šæ‰€æœ‰æ®µï¼Œæ“ä½œå®Œæ¯•åï¼ŒåˆæŒ‰é¡ºåºé‡Šæ”¾æ‰€æœ‰æ®µçš„é”ã€‚å¦‚ä¸‹å›¾ï¼š\n![[z-oblib/z2-attachments/åˆ†æ®µé”æœºåˆ¶.png]]\n\nConcurrentHashMapæ˜¯ç”±Segmentæ•°ç»„ç»“æ„å’ŒHashEntryæ•°ç»„ç»“æ„ç»„æˆã€‚Segmentæ˜¯ä¸€ç§å¯é‡å…¥é”ReentrantLockï¼ŒHashEntryåˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚\n\nä¸€ä¸ªConcurrentHashMapé‡ŒåŒ…å«ä¸€ä¸ªSegmentæ•°ç»„ï¼ŒSegmentçš„ç»“æ„å’ŒHashMapç±»ä¼¼ï¼Œæ˜¯ä¸€ç§æ•°ç»„å’Œé“¾è¡¨ç»“æ„ï¼Œ ä¸€ä¸ªSegmenté‡ŒåŒ…å«ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œæ¯ä¸ªHashEntryæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ï¼Œ æ¯ä¸ªSegmentå®ˆæŠ¤ç€ä¸€ä¸ªHashEntryæ•°ç»„é‡Œçš„å…ƒç´ ï¼Œå½“å¯¹HashEntryæ•°ç»„çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—å®ƒå¯¹åº”çš„Segmenté”ã€‚\n\n##### JDK 1.8\n\nè€Œåœ¨JDK 1.8ä¸­ï¼ŒConcurrentHashMapä¸»è¦åšäº†ä¸¤ä¸ªä¼˜åŒ–ï¼š\n\n- åŒHashMapä¸€æ ·ï¼Œé“¾è¡¨ä¹Ÿä¼šåœ¨é•¿åº¦è¾¾åˆ°8çš„æ—¶å€™è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·å¯ä»¥æå‡å¤§é‡å†²çªæ—¶å€™çš„æŸ¥è¯¢æ•ˆç‡ï¼›\n- ä»¥æŸä¸ªä½ç½®çš„å¤´ç»“ç‚¹ï¼ˆé“¾è¡¨çš„å¤´ç»“ç‚¹æˆ–çº¢é»‘æ ‘çš„rootç»“ç‚¹ï¼‰ä¸ºé”ï¼Œé…åˆ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è‡ªæ—‹|è‡ªæ—‹]]+[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]é¿å…ä¸å¿…è¦çš„é”å¼€é”€ï¼Œè¿›ä¸€æ­¥æå‡å¹¶å‘æ€§èƒ½ã€‚\n\n#### ConcurrentNavigableMapæ¥å£ä¸ConcurrentSkipListMapç±»\n\nConcurrentNavigableMapæ¥å£ç»§æ‰¿äº†NavigableMapæ¥å£ï¼Œè¿™ä¸ªæ¥å£æä¾›äº†é’ˆå¯¹ç»™å®šæœç´¢ç›®æ ‡è¿”å›æœ€æ¥è¿‘åŒ¹é…é¡¹çš„å¯¼èˆªæ–¹æ³•ã€‚\n\nConcurrentNavigableMapæ¥å£çš„ä¸»è¦å®ç°ç±»æ˜¯ConcurrentSkipListMapç±»ã€‚ä»åå­—ä¸Šæ¥çœ‹ï¼Œå®ƒçš„åº•å±‚ä½¿ç”¨çš„æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/0-æ•°æ®ç»“æ„ä¸ç®—æ³•/è·³è¡¨|è·³è¡¨]]ï¼ˆSkipListï¼‰çš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ç§â€ç©ºé—´æ¢æ—¶é—´â€œçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨CASæ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚\n\n#### å¹¶å‘Queue\n\nJDKå¹¶æ²¡æœ‰æä¾›çº¿ç¨‹å®‰å…¨çš„Listç±»ï¼Œå› ä¸ºå¯¹Listæ¥è¯´ï¼Œ**å¾ˆéš¾å»å¼€å‘ä¸€ä¸ªé€šç”¨å¹¶ä¸”æ²¡æœ‰å¹¶å‘ç“¶é¢ˆçš„çº¿ç¨‹å®‰å…¨çš„List**ã€‚å› ä¸ºå³ä½¿ç®€å•çš„è¯»æ“ä½œï¼Œæ‹¿contains() è¿™æ ·ä¸€ä¸ªæ“ä½œæ¥è¯´ï¼Œå¾ˆéš¾æƒ³åˆ°æœç´¢çš„æ—¶å€™å¦‚ä½•é¿å…é”ä½æ•´ä¸ªlistã€‚\n\næ‰€ä»¥é€€ä¸€æ­¥ï¼ŒJDKæä¾›äº†å¯¹é˜Ÿåˆ—å’ŒåŒç«¯é˜Ÿåˆ—çš„çº¿ç¨‹å®‰å…¨çš„ç±»ï¼šConcurrentLinkedQueueå’ŒConcurrentLinkedDequeã€‚å› ä¸ºé˜Ÿåˆ—ç›¸å¯¹äºListæ¥è¯´ï¼Œæœ‰æ›´å¤šçš„é™åˆ¶ã€‚è¿™ä¸¤ä¸ªç±»æ˜¯ä½¿ç”¨CASæ¥å®ç°çº¿ç¨‹å®‰å…¨çš„ã€‚\n\n#### å¹¶å‘Set\n\nJDKæä¾›äº†ConcurrentSkipListSetï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åºçš„é›†åˆã€‚åº•å±‚æ˜¯ä½¿ç”¨ConcurrentSkipListMapå®ç°ã€‚\n\nè°·æ­Œçš„guavaæ¡†æ¶å®ç°äº†ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ConcurrentHashSetï¼š\n\n```java\nSet\u003cString\u003e s = Sets.newConcurrentHashSet();\n```","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E6%97%A0%E7%8A%B6%E6%80%81":{"title":"æ— çŠ¶æ€","content":"# æ— çŠ¶æ€\n\nåœ¨ web é˜¶æ®µå­¦ä¹ æ—¶ï¼Œè®¾è®¡ Servlet æ—¶ä¸ºäº†ä¿è¯å…¶çº¿ç¨‹å®‰å…¨ï¼Œéƒ½ä¼šæœ‰è¿™æ ·çš„å»ºè®®ï¼Œä¸è¦ä¸º Servlet è®¾ç½®æˆå‘˜å˜é‡ï¼Œè¿™ ç§æ²¡æœ‰ä»»ä½•æˆå‘˜å˜é‡çš„ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å› ä¸ºæˆå‘˜å˜é‡ä¿å­˜çš„æ•°æ®ä¹Ÿå¯ä»¥ç§°ä¸ºçŠ¶æ€ä¿¡æ¯ï¼Œå› æ­¤æ²¡æœ‰æˆå‘˜å˜é‡å°±ç§°ä¹‹ä¸ºã€æ— çŠ¶æ€ã€‘ã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E6%97%A0%E9%94%81%E5%B0%8F%E7%BB%93":{"title":"æ— é”å°ç»“","content":"\n# æ— é”å°ç»“\n\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CASä¸volatile|CASä¸volatile]]\n- API\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/åŸå­æ•´æ•°|åŸå­æ•´æ•°]]\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/åŸå­å¼•ç”¨|åŸå­å¼•ç”¨]]\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/åŸå­æ•°ç»„|åŸå­æ•°ç»„]]\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å­—æ®µæ›´æ–°å™¨|å­—æ®µæ›´æ–°å™¨]]\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/åŸå­ç´¯åŠ å™¨|åŸå­ç´¯åŠ å™¨]]\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/Unsafe|Unsafe]]\n- åŸç†æ–¹é¢\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/LongAdder|LongAdder]] æºç \n\t- ä¼ªå…±äº«\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E6%9C%89%E5%BA%8F%E6%80%A7":{"title":"æœ‰åºæ€§","content":"# æœ‰åºæ€§\n\nJVM ä¼šåœ¨ä¸å½±å“æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œå¯ä»¥è°ƒæ•´è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚\n\n## æœ‰åºæ€§è¢«ç ´åçš„ä¾‹å­\n\n```java\nboolean ready = false;\n \n// çº¿ç¨‹1 æ‰§è¡Œæ­¤æ–¹æ³•\npublic void actor1(I_Result r) {\n    if(ready) {\n        r.r1 = num + num;\n    } else {\n        r.r1 = 1;\n    }\n}\n \n// çº¿ç¨‹2 æ‰§è¡Œæ­¤æ–¹æ³•\npublic void actor2(I_Result r) {        \n    num = 2;\n    ready = true;    \n}\n```\n\n  \nreadyÂ =Â trueÂ å¯èƒ½ä¼šè·‘åˆ°numÂ =Â 2å‰é¢æ‰§è¡Œï¼Œè¿™ç§é‡æ’åºåœ¨å•çº¿ç¨‹ä¸‹æ— æ‰€è°“ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªçº¿ç¨‹å¯èƒ½å°±å¯¼è‡´Â `ready==ture`æ—¶çº¿ç¨‹1æ‰§è¡Œäº†`num+num`ï¼Œä½†æ˜¯numè¿˜æ²¡è¢«èµ‹å€¼ã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E6%AD%BB%E9%94%81":{"title":"æ­»é”","content":"# æ­»é”\n\n## åŸå› \n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å¤šæŠŠé”|å¤šæŠŠé”]]çš„æƒ…å†µå¯èƒ½ä¼šå‘ç”Ÿæ­»é”ï¼š\n\nä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å–å¤šæŠŠé”ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”\nt1 [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]] è·å¾— Aå¯¹è±¡ é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å– Bå¯¹è±¡ çš„é” t2 çº¿ç¨‹ è·å¾— Bå¯¹è±¡ é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å– Aå¯¹è±¡ çš„é” ä¾‹ï¼š\n\n```java\npackage test;  \n  \nimport lombok.extern.slf4j.Slf4j;  \n  \n@Slf4j  \npublic class Test13 {  \n    public static void main(String[] args) {  \n        Object A = new Object();  \n        Object B = new Object();  \n        Thread t1 = new Thread(() -\u003e {  \n            synchronized (A) {  \n                log.debug(\"lock A\");  \n                try {  \n                    Thread.sleep(1000);  \n                } catch (InterruptedException e) {  \n                    throw new RuntimeException(e);  \n                }  \n                synchronized (B) {  \n                    log.debug(\"lock B\");  \n                    log.debug(\"æ“ä½œ...\");  \n                }  \n            }  \n        }, \"t1\");  \n  \n        Thread t2 = new Thread(() -\u003e {  \n            synchronized (B) {  \n                log.debug(\"lock B\");  \n                try {  \n                    Thread.sleep(500);  \n                } catch (InterruptedException e) {  \n                    throw new RuntimeException(e);  \n                }  \n                synchronized (A) {  \n                    log.debug(\"lock A\");  \n                    log.debug(\"æ“ä½œ...\");  \n                }  \n            }  \n        }, \"t2\");  \n        t1.start();  \n        t2.start();  \n    }  \n}\n```\n\n## å®šä½\næ£€æµ‹æ­»é”ï¼š\n- ä½¿ç”¨ jconsoleå·¥å…·ã€‚\n- ä½¿ç”¨ jps å®šä½[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è¿›ç¨‹|è¿›ç¨‹]] idï¼Œå†ç”¨ jstack å®šä½æ­»é”ã€‚\n\n## è§£å†³æ–¹æ¡ˆ\n\n### é¡ºåºåŠ é”\n\n![[z-oblib/z2-attachments/Pasted image 20220529224443.png]]\n\n![[z-oblib/z2-attachments/Pasted image 20220529224458.png]]\n\n#### ç¼ºç‚¹\n\né¡ºåºåŠ é”å¯èƒ½å¼•å‘[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é¥¥é¥¿|é¥¥é¥¿]]é—®é¢˜ã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E6%B4%BB%E8%B7%83%E6%80%A7":{"title":"æ´»è·ƒæ€§","content":"# æ´»è·ƒæ€§\n\nåŒ…æ‹¬ï¼š\n\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/æ­»é”|æ­»é”]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/æ´»é”|æ´»é”]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é¥¥é¥¿|é¥¥é¥¿]]","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E6%B4%BB%E9%94%81":{"title":"æ´»é”","content":"\n# æ´»é”\n\næ´»é”å‡ºç°åœ¨ä¸¤ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]äº’ç›¸æ”¹å˜å¯¹æ–¹çš„ç»“æŸæ¡ä»¶ï¼Œæœ€åè°ä¹Ÿæ— æ³•ç»“æŸï¼Œä¾‹å¦‚ï¼š\n\n```java\npublic class TestLiveLock {\n    static volatile int count = 10;\n    static final Object lock = new Object();\n \n    public static void main(String[] args) {\n        new Thread(() -\u003e {\n            // æœŸæœ›å‡åˆ° 0 é€€å‡ºå¾ªç¯\n            while (count \u003e 0) {\n                sleep(0.2);\n                count--;\n                log.debug(\"count: {}\", count);\n            }\n        }, \"t1\").start();\n        new Thread(() -\u003e {\n            // æœŸæœ›è¶…è¿‡ 20 é€€å‡ºå¾ªç¯\n            while (count \u003c 20) {\n                sleep(0.2);\n                count++;\n                log.debug(\"count: {}\", count);\n            }\n        }, \"t2\").start();\n    }\n}\n```\n\n## è§£å†³æ–¹æ¡ˆ\n\né”™å¼€è¿è¡Œæ—¶æœºã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%AE%A1%E7%A8%8B%E6%80%BB%E7%BB%93":{"title":"ç®¡ç¨‹æ€»ç»“","content":"# ç®¡ç¨‹æ€»ç»“\n\n\u003eæ‚²è§‚é”\n\néœ€è¦é‡ç‚¹æŒæ¡çš„æ˜¯\n- åˆ†æå¤š[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå“ªäº›ä»£ç ç‰‡æ®µå±äº[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/ä¸´ç•ŒåŒº|ä¸´ç•ŒåŒº]]\n- ä½¿ç”¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]] äº’æ–¥è§£å†³ä¸´ç•ŒåŒºçš„çº¿ç¨‹å®‰å…¨é—®é¢˜\n\t- æŒæ¡ synchronized é”å¯¹è±¡è¯­æ³•\n\t- æŒæ¡ synchronzied åŠ è½½æˆå‘˜æ–¹æ³•å’Œé™æ€æ–¹æ³•è¯­æ³•\n\t- æŒæ¡ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/wait\u0026notify|wait\u0026notify]] [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åŒæ­¥|åŒæ­¥]]æ–¹æ³•\n- ä½¿ç”¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ReentrantLock|lock]] äº’æ–¥è§£å†³ä¸´ç•ŒåŒºçš„çº¿ç¨‹å®‰å…¨é—®é¢˜\n\t- æŒæ¡ lock çš„ä½¿ç”¨ç»†èŠ‚ï¼šå¯æ‰“æ–­ã€é”è¶…æ—¶ã€å…¬å¹³é”ã€æ¡ä»¶å˜é‡\n- å­¦ä¼šåˆ†æ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å˜é‡çš„çº¿ç¨‹å®‰å…¨|å˜é‡çš„çº¿ç¨‹å®‰å…¨]]æ€§ã€æŒæ¡å¸¸è§[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹å®‰å…¨ç±»|çº¿ç¨‹å®‰å…¨ç±»]]çš„ä½¿ç”¨\n- äº†è§£çº¿ç¨‹[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/æ´»è·ƒæ€§|æ´»è·ƒæ€§]]é—®é¢˜ï¼š[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/æ­»é”|æ­»é”]]ã€[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/æ´»é”|æ´»é”]]ã€[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é¥¥é¥¿|é¥¥é¥¿]]\n- åº”ç”¨æ–¹é¢\n\t- äº’æ–¥ï¼šä½¿ç”¨ synchronized æˆ– Lock è¾¾åˆ°å…±äº«èµ„æºäº’æ–¥æ•ˆæœ\n\t- åŒæ­¥ï¼šä½¿ç”¨ wait\u0026notify æˆ– Lock çš„æ¡ä»¶å˜é‡æ¥è¾¾åˆ°çº¿ç¨‹é—´é€šä¿¡æ•ˆæœ\n- åŸç†æ–¹é¢\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/monitor|monitor]]ã€synchronized ã€wait\u0026notify åŸç†\n\t- synchronized è¿›é˜¶åŸç†\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/park\u0026unpark|park\u0026unpark]] åŸç†\n- æ¨¡å¼æ–¹é¢\n\t- åŒæ­¥æ¨¡å¼ä¹‹[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ä¿æŠ¤æ€§æš‚åœ|ä¿æŠ¤æ€§æš‚åœ]]\n\t- [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å¼‚æ­¥|å¼‚æ­¥]]æ¨¡å¼ä¹‹[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ç”Ÿäº§è€…æ¶ˆè´¹è€…|ç”Ÿäº§è€…æ¶ˆè´¹è€…]]\n\t- åŒæ­¥æ¨¡å¼ä¹‹[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é¡ºåºæ§åˆ¶|é¡ºåºæ§åˆ¶]]","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%B1%BB":{"title":"çº¿ç¨‹å®‰å…¨ç±»","content":"# çº¿ç¨‹å®‰å…¨ç±»\n\nè‡ªå·±å®ç°ç±»çš„æ—¶å€™ç»´æŠ¤[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å˜é‡çš„çº¿ç¨‹å®‰å…¨|å˜é‡çš„çº¿ç¨‹å®‰å…¨]]æ¯”è¾ƒç¹çï¼Œjavaå°±ç»™æˆ‘ä»¬æä¾›äº†ä¸€äº›çº¿ç¨‹å®‰å…¨çš„ç±»ã€‚\n\n## å¸¸è§çº¿ç¨‹å®‰å…¨ç±»\n\n- String\n- Integer\n- StringBuï¬€er\n- Random\n- Vector\n- Hashtable\n- java.util.concurrent åŒ…ä¸‹çš„ç±»\n\nçº¿ç¨‹å®‰å…¨åœºæ™¯ä¸¾ä¾‹ï¼š\n```java\nHashtable table = new Hashtable();\n \nnew Thread(()-\u003e{\n    table.put(\"key\", \"value1\");\n}).start();\n \nnew Thread(()-\u003e{\n    table.put(\"key\", \"value2\");\n}).start();\n```\n\n## çº¿ç¨‹å®‰å…¨ç±»æ–¹æ³•çš„ç»„åˆ\n\nè¿™äº›ç±»çº¿ç¨‹å®‰å…¨çš„æ˜¯æŒ‡ï¼Œ**å¤šä¸ªçº¿ç¨‹**è°ƒç”¨å®ƒä»¬**åŒä¸€ä¸ªå®ä¾‹**çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼š\n- å®ƒä»¬çš„**æ¯ä¸ª**æ–¹æ³•æ˜¯åŸå­çš„\n- ä½†æ³¨æ„å®ƒä»¬å¤šä¸ªæ–¹æ³•çš„ç»„åˆä¸æ˜¯åŸå­çš„\n\n```java\nHashtable table = new Hashtable();\n// çº¿ç¨‹1ï¼Œçº¿ç¨‹2\nif( table.get(\"key\") == null) {  // ä¸­é—´ä¼šæ”¶åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“\n    table.put(\"key\", value);\n}\n```\n\n![[z-oblib/z2-attachments/Pasted image 20220527151142.png]]\n\n## ä¸å¯å˜ç±»çš„çº¿ç¨‹å®‰å…¨æ€§\n\nStringã€Integer ç­‰éƒ½æ˜¯ä¸å¯å˜ç±»ï¼Œå› ä¸ºå…¶å†…éƒ¨çš„çŠ¶æ€ä¸å¯ä»¥æ”¹å˜ï¼Œå› æ­¤å®ƒä»¬çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n\nsubString()ç­‰æ–¹æ³•å®é™…æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°Stringå¯¹è±¡ã€‚\n\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%9B%86%E5%90%88%E7%B1%BB%E6%A6%82%E8%BF%B0":{"title":"çº¿ç¨‹å®‰å…¨é›†åˆç±»æ¦‚è¿°","content":"# çº¿ç¨‹å®‰å…¨é›†åˆç±»æ¦‚è¿°\n\n![[z-oblib/z2-attachments/Pasted image 20220612211057.png]]\n\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%B1%A0":{"title":"çº¿ç¨‹æ± ","content":"# çº¿ç¨‹æ± \n\n## ä½¿ç”¨çº¿ç¨‹æ± çš„åŸå› \n\n-   åˆ›å»º/é”€æ¯[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œçº¿ç¨‹æ± å¯ä»¥å¤ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ã€‚\n-   æ§åˆ¶å¹¶å‘çš„æ•°é‡ã€‚å¹¶å‘æ•°é‡è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ¶ˆè€—è¿‡å¤šï¼Œä»è€Œé€ æˆæœåŠ¡å™¨å´©æºƒã€‚ï¼ˆä¸»è¦åŸå› ï¼‰\n-   å¯ä»¥å¯¹çº¿ç¨‹åšç»Ÿä¸€ç®¡ç†\n\n## åŸç†\n\nJavaä¸­çš„çº¿ç¨‹æ± é¡¶å±‚æ¥å£æ˜¯`Executor`æ¥å£ï¼Œ`ThreadPoolExecutor`æ˜¯è¿™ä¸ªæ¥å£çš„å®ç°ç±»ã€‚\n\n### ThreadPoolExecutor æ„é€ æ–¹æ³•\n\nå››ä¸ªæ„é€ æ–¹æ³•ï¼š\n\n```java\n// äº”ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue\u003cRunnable\u003e workQueue)\n\n// å…­ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°-1\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue\u003cRunnable\u003e workQueue,\n                          ThreadFactory threadFactory)\n\n// å…­ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°-2\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue\u003cRunnable\u003e workQueue,\n                          RejectedExecutionHandler handler)\n\n// ä¸ƒä¸ªå‚æ•°çš„æ„é€ å‡½æ•°\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue\u003cRunnable\u003e workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler)\n```\n\n5~7ä¸ªå‚æ•°ï¼Œå…¶ä¸­5ä¸ªä¸ºå¿…é¡»ï¼š ^22da28\n- int corePoolSizeï¼šçº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹æ•°æœ€å¤§å€¼\n- int maximumPoolSizeï¼šè¯¥çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ€»æ•°æœ€å¤§å€¼ \n- long keepAliveTimeï¼šéæ ¸å¿ƒçº¿ç¨‹é—²ç½®è¶…æ—¶æ—¶é•¿\n- TimeUnitï¼ˆæšä¸¾ç±»å‹ï¼‰ unitï¼škeepAliveTimeçš„å•ä½\n\t- NANOSECONDS å¾®æ¯«ç§’\n\t- MICROSECONDS å¾®ç§’\n\t- MILLISECONDS æ¯«ç§’\n\t- SECONDS ç§’\n\t- MINUTES åˆ†\n\t- HOURS æ—¶\n\t- DAYS å¤©\n\t\u003eNANOSECONDS ï¼š 1å¾®æ¯«ç§’ = 1å¾®ç§’ / 1000 MICROSECONDS ï¼š 1å¾®ç§’ = 1æ¯«ç§’ / 1000 MILLISECONDS ï¼š 1æ¯«ç§’ = 1ç§’ /1000 SECONDS ï¼š ç§’ MINUTES ï¼š åˆ† HOURS ï¼š å°æ—¶ DAYS ï¼š å¤©\n- BlockingQueue workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼Œç»´æŠ¤ç€ç­‰å¾…æ‰§è¡Œçš„Runnableä»»åŠ¡å¯¹è±¡\n\t- LinkedBlockingQueueï¼šé“¾å¼é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œé»˜è®¤å¤§å°æ˜¯`Integer.MAX_VALUE`ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤§å°ã€‚\n\t- ArrayBlockingQueueï¼šæ•°ç»„é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œéœ€è¦æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°ã€‚\n\t- SynchronousQueueï¼šåŒæ­¥é˜Ÿåˆ—ï¼Œå†…éƒ¨å®¹é‡ä¸º0ï¼Œæ¯ä¸ªputæ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚\n\t- DelayQueueï¼šå»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´  ã€‚ç”¨äºç¼“å­˜ç³»ç»Ÿã€å®šæ—¶ä»»åŠ¡è°ƒåº¦ç­‰\n2ä¸ªéå¿…è¦å‚æ•°ï¼š\n- ThreadFactory threadFactoryï¼šåˆ›å»ºçº¿ç¨‹çš„å·¥å‚ ï¼Œç”¨äºæ‰¹é‡åˆ›å»ºçº¿ç¨‹ï¼Œç»Ÿä¸€åœ¨åˆ›å»ºçº¿ç¨‹æ—¶è®¾ç½®ä¸€äº›å‚æ•°ï¼Œå¦‚æ˜¯å¦å®ˆæŠ¤çº¿ç¨‹ã€çº¿ç¨‹çš„ä¼˜å…ˆçº§ç­‰ã€‚å¦‚æœä¸æŒ‡å®šï¼Œä¼šæ–°å»ºä¸€ä¸ªé»˜è®¤çš„çº¿ç¨‹å·¥å‚ã€‚\n  ```java\nstatic class DefaultThreadFactory implements ThreadFactory {\n    // çœç•¥å±æ€§\n    // æ„é€ å‡½æ•°\n    DefaultThreadFactory() {\n        SecurityManager s = System.getSecurityManager();\n        group = (s != null) ? s.getThreadGroup() :\n        Thread.currentThread().getThreadGroup();\n        namePrefix = \"pool-\" +\n            poolNumber.getAndIncrement() +\n            \"-thread-\";\n    }\n\n    // çœç•¥\n}\n  ```\n- RejectedExecutionHandler handler æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œçº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°å°±ä¼šé‡‡ç”¨æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œå››ç§æ‹’ç»å¤„ç†çš„ç­–ç•¥ä¸º ï¼š\n\t- ThreadPoolExecutor.AbortPolicyï¼šé»˜è®¤æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ \n\t- hreadPoolExecutor.DiscardPolicyï¼šä¸¢å¼ƒæ–°æ¥çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ \n\t- ThreadPoolExecutor.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨ï¼ˆæœ€æ—§çš„ï¼‰çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚\n\t- ThreadPoolExecutor.CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚\n\n### ThreadPoolExecutor ç­–ç•¥\n\n**çº¿ç¨‹æ± ä¹Ÿæœ‰è‡ªå·±çš„çŠ¶æ€**ï¼šçº¿ç¨‹æ± æœ¬èº«æœ‰ä¸€ä¸ªè´Ÿè´£è°ƒåº¦çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯ç”¨äºç®¡ç†å¸ƒæ§æ•´ä¸ªçº¿ç¨‹æ± é‡Œçš„å„ç§ä»»åŠ¡å’Œäº‹åŠ¡ï¼Œä¾‹å¦‚åˆ›å»ºçº¿ç¨‹ã€é”€æ¯çº¿ç¨‹ã€ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†ã€çº¿ç¨‹é˜Ÿåˆ—ç®¡ç†ç­‰ç­‰ã€‚`ThreadPoolExecutor`ç±»ä¸­ä½¿ç”¨äº†ä¸€äº›`final int`å¸¸é‡å˜é‡æ¥è¡¨ç¤ºçº¿ç¨‹æ± çš„çŠ¶æ€ ï¼Œåˆ†åˆ«ä¸ºRUNNINGã€SHUTDOWNã€STOPã€TIDYING ã€TERMINATEDã€‚\n\n```java\n// runState is stored in the high-order bits\nprivate static final int RUNNING    = -1 \u003c\u003c COUNT_BITS;\nprivate static final int SHUTDOWN   =  0 \u003c\u003c COUNT_BITS;\nprivate static final int STOP       =  1 \u003c\u003c COUNT_BITS;\nprivate static final int TIDYING    =  2 \u003c\u003c COUNT_BITS;\nprivate static final int TERMINATED =  3 \u003c\u003c COUNT_BITS;\n```\n\nçº¿ç¨‹æ± å››ç§çŠ¶æ€çš„æµè½¬ï¼š\n-   çº¿ç¨‹æ± åˆ›å»ºåå¤„äº**RUNNING**çŠ¶æ€ã€‚\n-   è°ƒç”¨shutdown()æ–¹æ³•åå¤„äº**SHUTDOWN**çŠ¶æ€ï¼Œçº¿ç¨‹æ± ä¸èƒ½æ¥å—æ–°çš„ä»»åŠ¡ï¼Œæ¸…é™¤ä¸€äº›ç©ºé—²worker,ä¸ä¼šç­‰å¾…é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡å®Œæˆã€‚\n-   è°ƒç”¨shutdownNow()æ–¹æ³•åå¤„äº**STOP**çŠ¶æ€ï¼Œçº¿ç¨‹æ± ä¸èƒ½æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨ä¸¢å¼ƒã€‚æ­¤æ—¶ï¼Œpoolsize=0,é˜»å¡é˜Ÿåˆ—çš„sizeä¹Ÿä¸º0ã€‚\n-   å½“æ‰€æœ‰çš„ä»»åŠ¡å·²ç»ˆæ­¢ï¼Œctlè®°å½•çš„â€ä»»åŠ¡æ•°é‡â€ä¸º0ï¼Œçº¿ç¨‹æ± ä¼šå˜ä¸º**TIDYING**çŠ¶æ€ã€‚æ¥ç€ä¼šæ‰§è¡Œterminated()å‡½æ•°ã€‚\n\u003e`ctl`ï¼Œå®ƒæ˜¯ä¸€ä¸ªAtomicIntegerç±»å‹çš„å˜é‡ã€‚çº¿ç¨‹æ± çŠ¶æ€å°±æ˜¯é€šè¿‡AtomicIntegerç±»å‹çš„æˆå‘˜å˜é‡`ctl`æ¥è·å–çš„ã€‚\n\u003eè·å–çš„`ctl`å€¼ä¼ å…¥`runStateOf`æ–¹æ³•ï¼Œä¸`~CAPACITY`ä½ä¸è¿ç®—(`CAPACITY`æ˜¯ä½29ä½å…¨1çš„intå˜é‡)ã€‚\n\u003e`~CAPACITY`åœ¨è¿™é‡Œç›¸å½“äºæ©ç ï¼Œç”¨æ¥è·å–ctlçš„é«˜3ä½ï¼Œè¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼›è€Œå¦å¤–çš„ä½29ä½ç”¨äºè¡¨ç¤ºå·¥ä½œçº¿ç¨‹æ•°\n\n### ä»»åŠ¡å¤„ç†æµç¨‹\n\nå¤„ç†ä»»åŠ¡çš„æ ¸å¿ƒæ–¹æ³•æ˜¯`execute`ï¼ŒJDK 1.8 æºç ä¸­`ThreadPoolExecutor`æ˜¯å¤„ç†çº¿ç¨‹ä»»åŠ¡ï¼š\n```java\n// JDK 1.8\npublic void execute(Runnable command) {\n    if (command == null)\n        throw new NullPointerException();   \n    int c = ctl.get();\n    // 1.å½“å‰çº¿ç¨‹æ•°å°äºcorePoolSize,åˆ™è°ƒç”¨addWorkeråˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡\n    // æ£€æŸ¥æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦å·²æ»¡\n    if (workerCountOf(c) \u003c corePoolSize) {\n       if (addWorker(command, true))\n           return;\n       c = ctl.get();\n    }\n    // 2.å¦‚æœä¸å°äºcorePoolSizeï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°workQueueé˜Ÿåˆ—ã€‚\n    // è¦ä¿è¯çº¿ç¨‹æ± åœ¨è¿è¡ŒçŠ¶æ€\n    // åŒæ—¶ä»»åŠ¡é˜Ÿåˆ—æœªæ»¡\n    if (isRunning(c) \u0026\u0026 workQueue.offer(command)) {\n        int recheck = ctl.get();\n        // 2.1 å¦‚æœisRunningè¿”å›false(çŠ¶æ€æ£€æŸ¥)ï¼Œåˆ™removeè¿™ä¸ªä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\n        // åœ¨ä»»åŠ¡å…¥é˜Ÿååœ¨åˆ¤æ–­ä¸€æ¬¡çº¿ç¨‹æ± æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€ï¼ˆçŠ¶æ€ç¬æ¯ä¸‡å˜ï¼‰\n        if (! isRunning(recheck) \u0026\u0026 remove(command))\n            reject(command);\n            // 2.2 çº¿ç¨‹æ± å¤„äºrunningçŠ¶æ€ï¼Œä½†æ˜¯æ²¡æœ‰çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºçº¿ç¨‹\n        else if (workerCountOf(recheck) == 0)\n            addWorker(null, false);\n    }\n    // 3.å¦‚æœæ”¾å…¥workQueueå¤±è´¥ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œ\n    // å¦‚æœè¿™æ—¶åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤±è´¥(å½“å‰çº¿ç¨‹æ€»æ•°ä¸å°äºmaximumPoolSizeæ—¶)ï¼Œå°±ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\n    else if (!addWorker(command, false))\n         reject(command);\n}\n```\n\nçº¿ç¨‹æ± çŠ¶æ€ç¬æ¯ä¸‡å˜ï¼Œæ‰€ä»¥è¦åœ¨`workQueue.offer(command)`ä»»åŠ¡å…¥é˜Ÿçš„å‰åéƒ½æ£€æŸ¥ä¸€æ¬¡çº¿ç¨‹æ± çŠ¶æ€ï¼šçº¿ç¨‹æ± æ²¡åœ¨è¿è¡Œå°±æ²¡å¿…è¦å…¥é˜Ÿäº†ï¼Œå…¥äº†ä¹Ÿæ²¡æ³•æ‰§è¡Œã€‚å…¥é˜Ÿä¹Ÿæœ‰ä¸ªè¿‡ç¨‹ï¼Œè¿™æ—¶å€™çº¿ç¨‹æ± å¦‚æœå˜æˆæœªè¿è¡Œï¼Œåˆ™æœ‰å¯èƒ½è¿™ä¸ªæŒ‡ä»¤æ°¸è¿œä¸è¢«æ‰§è¡Œäº†ã€‚\n\næ€»ç»“ï¼š\n1.  çº¿ç¨‹æ€»æ•°é‡ \u003c corePoolSizeï¼Œæ— è®ºçº¿ç¨‹æ˜¯å¦ç©ºé—²ï¼Œéƒ½ä¼šæ–°å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼ˆè®©æ ¸å¿ƒçº¿ç¨‹æ•°é‡å¿«é€Ÿè¾¾åˆ°corePoolSizeï¼Œåœ¨æ ¸å¿ƒçº¿ç¨‹æ•°é‡ \u003c corePoolSizeæ—¶ï¼‰ã€‚**æ³¨æ„ï¼Œè¿™ä¸€æ­¥éœ€è¦è·å¾—å…¨å±€é”ã€‚**\n2.  çº¿ç¨‹æ€»æ•°é‡ \u003e= corePoolSizeæ—¶ï¼Œæ–°æ¥çš„çº¿ç¨‹ä»»åŠ¡ä¼šè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç„¶åç©ºé—²çš„æ ¸å¿ƒçº¿ç¨‹ä¼šä¾æ¬¡å»ç¼“å­˜é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ¥æ‰§è¡Œï¼ˆä½“ç°äº†**çº¿ç¨‹å¤ç”¨**ï¼‰ã€‚\n3.  å½“ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œè¯´æ˜è¿™ä¸ªæ—¶å€™ä»»åŠ¡å·²ç»å¤šåˆ°çˆ†æ£šï¼Œéœ€è¦ä¸€äº›â€œä¸´æ—¶å·¥â€æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡äº†ã€‚äºæ˜¯ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚**æ³¨æ„ï¼Œè¿™ä¸€æ­¥éœ€è¦è·å¾—å…¨å±€é”ã€‚**\n4.  ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œ ä¸”æ€»çº¿ç¨‹æ•°è¾¾åˆ°äº†maximumPoolSizeï¼Œåˆ™ä¼šé‡‡å–ä¸Šé¢æåˆ°çš„æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚\n![[z-oblib/z2-attachments/çº¿ç¨‹æ± ä¸»è¦çš„å¤„ç†æµç¨‹.png]]\n### çº¿ç¨‹å¤ç”¨åŸç†\n\næˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šæŒ‡å®šä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå½“æ‰§è¡Œå®Œè¿™ä¸ªçº¿ç¨‹ä»»åŠ¡ä¹‹åï¼Œçº¿ç¨‹è‡ªåŠ¨é”€æ¯ã€‚ä½†æ˜¯çº¿ç¨‹æ± å´å¯ä»¥å¤ç”¨çº¿ç¨‹ï¼Œå³ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œçº¿ç¨‹ä»»åŠ¡åä¸é”€æ¯ï¼Œç»§ç»­æ‰§è¡Œå¦å¤–çš„çº¿ç¨‹ä»»åŠ¡ã€‚**é‚£ä¹ˆï¼Œçº¿ç¨‹æ± å¦‚ä½•åšåˆ°çº¿ç¨‹å¤ç”¨å‘¢ï¼Ÿ**\n\nåŸæ¥ï¼ŒThreadPoolExecutoråœ¨åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¼šå°†çº¿ç¨‹å°è£…æˆ**å·¥ä½œçº¿ç¨‹worker**,å¹¶æ”¾å…¥**å·¥ä½œçº¿ç¨‹ç»„**ä¸­ï¼Œç„¶åè¿™ä¸ªworkeråå¤ä»é˜»å¡é˜Ÿåˆ—ä¸­æ‹¿ä»»åŠ¡å»æ‰§è¡Œã€‚è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹çœ‹æºç ï¼ˆä¸€å®šè¦ä»”ç»†çœ‹ï¼Œå‰åæœ‰è”ç³»ï¼‰\n\nè¿™é‡Œçš„`addWorker`æ–¹æ³•æ˜¯åœ¨ä¸Šé¢æåˆ°çš„`execute`æ–¹æ³•é‡Œé¢è°ƒç”¨çš„ï¼Œå…ˆçœ‹çœ‹ä¸ŠåŠéƒ¨åˆ†ï¼š\n\n```java\n// ThreadPoolExecutor.addWorkeræ–¹æ³•æºç ä¸ŠåŠéƒ¨åˆ†\nprivate boolean addWorker(Runnable firstTask, boolean core) {\n    retry:\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // Check if queue empty only if necessary.\n        if (rs \u003e= SHUTDOWN \u0026\u0026\n            ! (rs == SHUTDOWN \u0026\u0026\n               firstTask == null \u0026\u0026\n               ! workQueue.isEmpty()))\n            return false;\n\n        for (;;) {\n            int wc = workerCountOf(c);\n            if (wc \u003e= CAPACITY ||\n                // 1.å¦‚æœcoreæ˜¯ture,è¯æ˜éœ€è¦åˆ›å»ºçš„çº¿ç¨‹ä¸ºæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å¤§äºæ ¸å¿ƒçº¿ç¨‹\n                // å¦‚æœcoreæ˜¯false,è¯æ˜éœ€è¦åˆ›å»ºçš„æ˜¯éæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å¤§äºæ€»çº¿ç¨‹æ•°\n                // å¦‚æœä¸å°äºï¼Œåˆ™è¿”å›false\n                wc \u003e= (core ? corePoolSize : maximumPoolSize))\n                return false;\n            if (compareAndIncrementWorkerCount(c))\n                break retry;\n            c = ctl.get();  // Re-read ctl\n            if (runStateOf(c) != rs)\n                continue retry;\n            // else CAS failed due to workerCount change; retry inner loop\n        }\n    }\n```\nä¸ŠåŠéƒ¨åˆ†ä¸»è¦æ˜¯åˆ¤æ–­çº¿ç¨‹æ•°é‡æ˜¯å¦è¶…å‡ºé˜ˆå€¼ï¼Œè¶…è¿‡äº†å°±è¿”å›falseã€‚æˆ‘ä»¬ç»§ç»­çœ‹ä¸‹åŠéƒ¨åˆ†ï¼š\n```java\n    // ThreadPoolExecutor.addWorkeræ–¹æ³•æºç ä¸‹åŠéƒ¨åˆ†\n    boolean workerStarted = false;\n    boolean workerAdded = false;\n    Worker w = null;\n    try {\n        // 1.åˆ›å»ºä¸€ä¸ªworkerå¯¹è±¡\n        w = new Worker(firstTask);\n        // 2.å®ä¾‹åŒ–ä¸€ä¸ªThreadå¯¹è±¡\n        final Thread t = w.thread;\n        if (t != null) {\n            // 3.çº¿ç¨‹æ± å…¨å±€é”\n            final ReentrantLock mainLock = this.mainLock;\n            mainLock.lock();\n            try {\n                // Recheck while holding lock.\n                // Back out on ThreadFactory failure or if\n                // shut down before lock acquired.\n                int rs = runStateOf(ctl.get());\n\n                if (rs \u003c SHUTDOWN ||\n                    (rs == SHUTDOWN \u0026\u0026 firstTask == null)) {\n                    if (t.isAlive()) // precheck that t is startable\n                        throw new IllegalThreadStateException();\n                    workers.add(w);\n                    int s = workers.size();\n                    if (s \u003e largestPoolSize)\n                        largestPoolSize = s;\n                    workerAdded = true;\n                }\n            } finally {\n                mainLock.unlock();\n            }\n            if (workerAdded) {\n                // 4.å¯åŠ¨è¿™ä¸ªçº¿ç¨‹\n                t.start();\n                workerStarted = true;\n            }\n        }\n    } finally {\n        if (! workerStarted)\n            addWorkerFailed(w);\n    }\n    return workerStarted;\n}\n```\nåˆ›å»º`worker`å¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ª`Thread`å¯¹è±¡ï¼Œç„¶åå¯åŠ¨è¿™ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚\n\næˆ‘ä»¬æ¥ç€çœ‹çœ‹`Worker`ç±»ï¼Œä»…å±•ç¤ºéƒ¨åˆ†æºç ï¼š\n```java\n// Workerç±»éƒ¨åˆ†æºç \nprivate final class Worker extends AbstractQueuedSynchronizer implements Runnable{\n    final Thread thread;\n    Runnable firstTask;\n\n    Worker(Runnable firstTask) {\n        setState(-1); // inhibit interrupts until runWorker\n        this.firstTask = firstTask;\n        this.thread = getThreadFactory().newThread(this);\n    }\n\n    public void run() {\n            runWorker(this);\n    }\n    //å…¶ä½™ä»£ç ç•¥...\n}\n```\n\n`Worker`ç±»å®ç°äº†`Runnable`æ¥å£ï¼Œæ‰€ä»¥`Worker`ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹çš„ä»»åŠ¡å°±æ˜¯è‡ªå·±ã€‚æ•…`addWorker`æ–¹æ³•è°ƒç”¨addWorkeræ–¹æ³•æºç ä¸‹åŠéƒ¨åˆ†ä¸­çš„ç¬¬4æ­¥`t.start`ï¼Œä¼šè§¦å‘`Worker`ç±»çš„`run`æ–¹æ³•è¢«JVMè°ƒç”¨ã€‚\n\næˆ‘ä»¬å†çœ‹çœ‹`runWorker`çš„é€»è¾‘ï¼š\n\n```java\n// Worker.runWorkeræ–¹æ³•æºä»£ç \nfinal void runWorker(Worker w) {\n    Thread wt = Thread.currentThread();\n    Runnable task = w.firstTask;\n    w.firstTask = null;\n    // 1.çº¿ç¨‹å¯åŠ¨ä¹‹åï¼Œé€šè¿‡unlockæ–¹æ³•é‡Šæ”¾é”\n    w.unlock(); // allow interrupts\n    boolean completedAbruptly = true;\n    try {\n        // 2.Workeræ‰§è¡ŒfirstTaskæˆ–ä»workQueueä¸­è·å–ä»»åŠ¡ï¼Œå¦‚æœgetTaskæ–¹æ³•ä¸è¿”å›null,å¾ªç¯ä¸é€€å‡º\n        while (task != null || (task = getTask()) != null) {\n            // 2.1è¿›è¡ŒåŠ é”æ“ä½œï¼Œä¿è¯threadä¸è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ï¼ˆé™¤éçº¿ç¨‹æ± è¢«ä¸­æ–­ï¼‰\n            w.lock();\n            // If pool is stopping, ensure thread is interrupted;\n            // if not, ensure thread is not interrupted.  This\n            // requires a recheck in second case to deal with\n            // shutdownNow race while clearing interrupt\n            // 2.2æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ï¼Œå€˜è‹¥çº¿ç¨‹æ± å¤„äºä¸­æ–­çŠ¶æ€ï¼Œå½“å‰çº¿ç¨‹å°†ä¸­æ–­ã€‚ \n            if ((runStateAtLeast(ctl.get(), STOP) ||\n                 (Thread.interrupted() \u0026\u0026\n                  runStateAtLeast(ctl.get(), STOP))) \u0026\u0026\n                !wt.isInterrupted())\n                wt.interrupt();\n            try {\n                // 2.3æ‰§è¡ŒbeforeExecute \n                beforeExecute(wt, task);\n                Throwable thrown = null;\n                try {\n                    // 2.4æ‰§è¡Œä»»åŠ¡\n                    task.run();\n                } catch (RuntimeException x) {\n                    thrown = x; throw x;\n                } catch (Error x) {\n                    thrown = x; throw x;\n                } catch (Throwable x) {\n                    thrown = x; throw new Error(x);\n                } finally {\n                    // 2.5æ‰§è¡ŒafterExecuteæ–¹æ³• \n                    afterExecute(task, thrown);\n                }\n            } finally {\n                task = null;\n                w.completedTasks++;\n                // 2.6è§£é”æ“ä½œ\n                w.unlock();\n            }\n        }\n        completedAbruptly = false;\n    } finally {\n        processWorkerExit(w, completedAbruptly);\n    }\n}\n```\n\u003eæ˜¯çº¿ç¨‹å·¥ä½œè€…ä¸»åŠ¨æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€çš„ã€‚\n\né¦–å…ˆå»æ‰§è¡Œåˆ›å»ºè¿™ä¸ªworkeræ—¶å°±æœ‰çš„ä»»åŠ¡ï¼Œå½“æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åï¼Œworkerçš„ç”Ÿå‘½å‘¨æœŸå¹¶æ²¡æœ‰ç»“æŸï¼Œåœ¨`while`å¾ªç¯ä¸­ï¼Œworkerä¼šä¸æ–­åœ°è°ƒç”¨`getTask`æ–¹æ³•ä»**é˜»å¡é˜Ÿåˆ—**ä¸­è·å–ä»»åŠ¡ç„¶åè°ƒç”¨`task.run()`æ‰§è¡Œä»»åŠ¡,ä»è€Œè¾¾åˆ°**å¤ç”¨çº¿ç¨‹**çš„ç›®çš„ã€‚åªè¦`getTask`æ–¹æ³•ä¸è¿”å›`null`,æ­¤çº¿ç¨‹å°±ä¸ä¼šé€€å‡ºã€‚\n\nå½“ç„¶ï¼Œæ ¸å¿ƒçº¿ç¨‹æ± ä¸­åˆ›å»ºçš„çº¿ç¨‹æƒ³è¦æ‹¿åˆ°é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå…ˆè¦åˆ¤æ–­çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå¦‚æœ**STOP**æˆ–è€…**TERMINATED**ï¼Œè¿”å›`null`ã€‚\n\næœ€åçœ‹çœ‹`getTask`æ–¹æ³•çš„å®ç°ï¼š\n```java\n// Worker.getTaskæ–¹æ³•æºç \nprivate Runnable getTask() {\n    boolean timedOut = false; // Did the last poll() time out?\n\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // Check if queue empty only if necessary.\n        if (rs \u003e= SHUTDOWN \u0026\u0026 (rs \u003e= STOP || workQueue.isEmpty())) {\n            decrementWorkerCount();\n            return null;\n        }\n\n        int wc = workerCountOf(c);\n\n        // Are workers subject to culling?\n        // 1.allowCoreThreadTimeOutå˜é‡é»˜è®¤æ˜¯false,æ ¸å¿ƒçº¿ç¨‹å³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šè¢«é”€æ¯ æ°¸ä¸è¶…æ—¶\n        // å¦‚æœä¸ºtrue,æ ¸å¿ƒçº¿ç¨‹åœ¨keepAliveTimeå†…ä»ç©ºé—²åˆ™ä¼šè¢«é”€æ¯ã€‚ \n        boolean timed = allowCoreThreadTimeOut || wc \u003e corePoolSize;  // æ ¸å¿ƒçº¿ç¨‹é”€æ¯æ ‡å¿—\n        // 2.å¦‚æœè¿è¡Œçº¿ç¨‹æ•°è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œä½†æ˜¯ç¼“å­˜é˜Ÿåˆ—å·²ç»ç©ºäº†ï¼Œè¿™æ—¶é€’å‡workeræ•°é‡ã€‚ \nã€€ã€€ã€€ã€€ // å¦‚æœæœ‰è®¾ç½®å…è®¸çº¿ç¨‹è¶…æ—¶æˆ–è€…çº¿ç¨‹æ•°é‡è¶…è¿‡äº†æ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œ\n        // å¹¶ä¸”çº¿ç¨‹åœ¨è§„å®šæ—¶é—´å†…å‡æœªpollåˆ°ä»»åŠ¡ä¸”é˜Ÿåˆ—ä¸ºç©ºåˆ™é€’å‡workeræ•°é‡\n        if ((wc \u003e maximumPoolSize || (timed \u0026\u0026 timedOut))\n            \u0026\u0026 (wc \u003e 1 || workQueue.isEmpty())) {\n            if (compareAndDecrementWorkerCount(c))\n                return null;\n            continue;\n        }\n\n        try {\n            // 3.å¦‚æœtimedä¸ºtrue(æƒ³æƒ³å“ªäº›æƒ…å†µä¸‹timedä¸ºtrue),åˆ™ä¼šè°ƒç”¨workQueueçš„pollæ–¹æ³•è·å–ä»»åŠ¡.\n            // è¶…æ—¶æ—¶é—´æ˜¯keepAliveTimeã€‚å¦‚æœè¶…è¿‡keepAliveTimeæ—¶é•¿ï¼Œ\n            // pollè¿”å›äº†nullï¼Œä¸Šè¾¹æåˆ°çš„whileå¾ªåºå°±ä¼šé€€å‡ºï¼Œçº¿ç¨‹ä¹Ÿå°±æ‰§è¡Œå®Œäº†ã€‚\n            // å¦‚æœtimedä¸ºfalseï¼ˆallowCoreThreadTimeOutä¸ºfalsefalse\n            // ä¸”wc \u003e corePoolSizeä¸ºfalseï¼‰ï¼Œåˆ™ä¼šè°ƒç”¨workQueueçš„takeæ–¹æ³•é˜»å¡åœ¨å½“å‰ã€‚\n            // é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡åŠ å…¥æ—¶ï¼Œçº¿ç¨‹è¢«å”¤é†’ï¼Œtakeæ–¹æ³•è¿”å›ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œã€‚\n            Runnable r = timed ?\n                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :\n                workQueue.take();\n            if (r != null)\n                return r;\n            timedOut = true;\n        } catch (InterruptedException retry) {\n            timedOut = false;\n        }\n    }\n}\n```\n\næ ¸å¿ƒçº¿ç¨‹ï¼š\n- `workQueue.take`ä¼šé˜»å¡ç­‰å¾…ï¼Œä¸æ¶ˆè€—cpuï¼Œå—¯ç­‰ã€‚\n- `workQueue.poll`å«è¶…æ—¶æ¡ä»¶çš„ç­‰å¾…ï¼Œå¯èƒ½è¿”å›nullï¼Œæ ¸å¿ƒçº¿ç¨‹å¯èƒ½è¢«é”€æ¯ã€‚\n\næ ¸å¿ƒçº¿ç¨‹çš„ä¼šä¸€ç›´å¡åœ¨`workQueue.take`æ–¹æ³•ï¼Œè¢«é˜»å¡å¹¶æŒ‚èµ·ï¼Œä¸ä¼šå ç”¨CPUèµ„æºï¼Œç›´åˆ°æ‹¿åˆ°`Runnable` ç„¶åè¿”å›ï¼ˆå½“ç„¶å¦‚æœ**allowCoreThreadTimeOut**è®¾ç½®ä¸º`true`,é‚£ä¹ˆæ ¸å¿ƒçº¿ç¨‹å°±ä¼šå»è°ƒç”¨`poll`æ–¹æ³•ï¼Œå› ä¸º`poll`å¯èƒ½ä¼šè¿”å›`null`,æ‰€ä»¥è¿™æ—¶å€™æ ¸å¿ƒçº¿ç¨‹æ»¡è¶³è¶…æ—¶æ¡ä»¶ä¹Ÿä¼šè¢«é”€æ¯ï¼‰ã€‚\n\néæ ¸å¿ƒçº¿ç¨‹ï¼š\n- åªæœ‰è°ƒç”¨`workQueue.poll`\n\néæ ¸å¿ƒçº¿ç¨‹ä¼šworkQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡æœ‰æ‹¿åˆ°ï¼Œä¸‹ä¸€æ¬¡å¾ªç¯åˆ¤æ–­**compareAndDecrementWorkerCount**å°±ä¼šè¿”å›`null`,Workerå¯¹è±¡çš„`run()`æ–¹æ³•å¾ªç¯ä½“çš„åˆ¤æ–­ä¸º`null`,ä»»åŠ¡ç»“æŸï¼Œç„¶åçº¿ç¨‹è¢«ç³»ç»Ÿå›æ”¶ ã€‚\n\n## å››ç§å¸¸è§çº¿ç¨‹æ± \n\n### newCachedThreadPool\n\n- å•ä¸ªçŸ­ä»»åŠ¡å¤„ç†æ—¶é—´å¿«ï¼Œçº¿æ€§æ‰§è¡Œä¸¤ä¸ªçŸ­ä»»åŠ¡å’Œå¹¶è¡Œæ‰§è¡Œæ•ˆç‡å·®ç›¸å¯¹è¾ƒå°ã€‚\n- å¤§é‡çŸ­ä»»åŠ¡åˆ°æ¥éœ€è¦æ›´é«˜çš„çº¿ç¨‹å¤ç”¨ç‡ï¼Œé˜²æ­¢å¤§é‡åˆ›å»ºçº¿ç¨‹å¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± #^22da28|çº¿ç¨‹æ± æ„é€ æ–¹æ³•å‚æ•°]]\n```java\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue\u003cRunnable\u003e());\n}\n```\n\n- å…¨éƒ¨éƒ½æ˜¯éæ ¸å¿ƒçº¿ç¨‹\n- ç”¨åŒæ­¥é˜Ÿåˆ—ï¼Œå³é˜Ÿåˆ—å¤§å°ä¸º0ï¼Œå…¥é˜Ÿè¦ç­‰å¾…å‡ºé˜Ÿæ“ä½œå‘ç”Ÿ\n- çº¿ç¨‹æ± å¾ˆå¤§ï¼ŒåŸºæœ¬ä¸ä¼šå‘ç”Ÿæ‹’ç»\n\n`CacheThreadPool`çš„**è¿è¡Œæµç¨‹**å¦‚ä¸‹ï¼š\n\n1.  æäº¤ä»»åŠ¡è¿›çº¿ç¨‹æ± ã€‚\n2.  å› ä¸º**corePoolSize**ä¸º0çš„å…³ç³»ï¼Œä¸åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œçº¿ç¨‹æ± æœ€å¤§ä¸ºInteger.MAX_VALUEã€‚\n3.  å°è¯•å°†ä»»åŠ¡æ·»åŠ åˆ°**SynchronousQueue**é˜Ÿåˆ—ã€‚\n4.  å¦‚æœSynchronousQueueå…¥åˆ—æˆåŠŸï¼Œç­‰å¾…è¢«å½“å‰è¿è¡Œçš„çº¿ç¨‹ç©ºé—²åæ‹‰å–æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹ï¼Œç„¶åä»SynchronousQueueæ‹‰å–ä»»åŠ¡å¹¶åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚\n5.  å¦‚æœSynchronousQueueå·²æœ‰ä»»åŠ¡åœ¨ç­‰å¾…ï¼Œå…¥åˆ—æ“ä½œå°†ä¼šé˜»å¡ã€‚\n\nå½“éœ€è¦æ‰§è¡Œå¾ˆå¤š**çŸ­æ—¶é—´**çš„ä»»åŠ¡æ—¶ï¼ŒCacheThreadPoolçš„çº¿ç¨‹å¤ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œ ä¼šæ˜¾è‘—çš„**æé«˜æ€§èƒ½**ã€‚è€Œä¸”çº¿ç¨‹60såä¼šå›æ”¶ï¼Œæ„å‘³ç€å³ä½¿æ²¡æœ‰ä»»åŠ¡è¿›æ¥ï¼ŒCacheThreadPoolå¹¶ä¸ä¼šå ç”¨å¾ˆå¤šèµ„æºã€‚\n\n### newFixedThreadPool\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± #^22da28|çº¿ç¨‹æ± æ„é€ æ–¹æ³•å‚æ•°]]\n```java\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n        return new ThreadPoolExecutor(nThreads, nThreads,\n                                      0L, TimeUnit.MILLISECONDS,\n                                      new LinkedBlockingQueue\u003cRunnable\u003e());\n}\n```\n\n- å…¨éƒ¨éƒ½æ˜¯æ ¸å¿ƒçº¿ç¨‹\n- æ— æ³•åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹\n- é‡‡ç”¨æ•°ç»„é˜»å¡é˜Ÿåˆ—\n- é˜»å¡é˜Ÿåˆ—å¾ˆå¤§ï¼ŒåŸºæœ¬ä¸ä¼šå‘ç”Ÿæ‹’ç»\n\nä¸CachedThreadPoolçš„åŒºåˆ«ï¼š\n- å› ä¸º corePoolSize == maximumPoolSize ï¼Œæ‰€ä»¥FixedThreadPoolåªä¼šåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ã€‚ è€ŒCachedThreadPoolå› ä¸ºcorePoolSize=0ï¼Œæ‰€ä»¥åªä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚\n- åœ¨ getTask() æ–¹æ³•ï¼Œå¦‚æœé˜Ÿåˆ—é‡Œæ²¡æœ‰ä»»åŠ¡å¯å–ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨LinkedBlockingQueue.take() ï¼Œçº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ã€‚ CachedThreadPoolä¼šåœ¨60såæ”¶å›ã€‚\n- ç”±äºçº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ï¼Œä¼šä¸€ç›´å¡åœ¨é˜»å¡ï¼Œæ‰€ä»¥**æ²¡æœ‰ä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œ FixedThreadPoolå ç”¨èµ„æºæ›´å¤š**ã€‚\n- éƒ½å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ï¼Œä½†æ˜¯åŸç†ä¸åŒã€‚FixedThreadPoolæ˜¯å› ä¸ºé˜»å¡é˜Ÿåˆ—å¯ä»¥å¾ˆå¤§ï¼ˆæœ€å¤§ä¸ºIntegeræœ€å¤§å€¼ï¼‰ï¼Œæ•…å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ï¼›CachedThreadPoolæ˜¯å› ä¸ºçº¿ç¨‹æ± å¾ˆå¤§ï¼ˆæœ€å¤§ä¸ºIntegeræœ€å¤§å€¼ï¼‰ï¼Œå‡ ä¹ä¸ä¼šå¯¼è‡´çº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œæ•…å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚\n\n### newSingleThreadExecutor\n\n```java\npublic static ExecutorService newSingleThreadExecutor() {\n    return new FinalizableDelegatedExecutorService\n        (new ThreadPoolExecutor(1, 1,\n                                0L, TimeUnit.MILLISECONDS,\n                                new LinkedBlockingQueue\u003cRunnable\u003e()));\n}\n```\n\n- åªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹\n- æ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹\n- é‡‡ç”¨é“¾è¡¨é˜»å¡é˜Ÿåˆ—\n- ä¿è¯ä»»åŠ¡å…ˆæ¥å…ˆæ‰§è¡Œ\n\n### newScheduledThreadPool\n\n```java\npublic static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) {\n    return new ScheduledThreadPoolExecutor(corePoolSize);\n}\n\n//ScheduledThreadPoolExecutor():\npublic ScheduledThreadPoolExecutor(int corePoolSize) {\n    super(corePoolSize, Integer.MAX_VALUE,\n          DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,\n          new DelayedWorkQueue());\n}\n```\n\n- ç¡®å®šé‡çš„æ ¸å¿ƒçº¿ç¨‹\n- å¤§é‡éæ ¸å¿ƒçº¿ç¨‹\n- é»˜è®¤çš„è¶…æ—¶æ—¶é—´\n- å»¶è¿Ÿé˜Ÿåˆ—","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E9%80%9A%E8%AE%AF":{"title":"çº¿ç¨‹é€šè®¯","content":"# çº¿ç¨‹é€šè®¯\n\n## æ–¹æ³•\n\n1. ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—\n\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5":{"title":"ç¼“å­˜æ›´æ–°ç­–ç•¥","content":"\n# ç¼“å­˜æ›´æ–°ç­–ç•¥\n\n## å…ˆæ¸…ç¼“å­˜\n\næ¸…ç¼“å­˜--æ›´æ–°æ•°æ®åº“ä¹‹é—´ï¼Œå…¶å®ƒçº¿ç¨‹è¯»å–äº†æ•°æ®åº“ä¸­çš„æ—§æ•°æ®ï¼Œå¹¶å†™å…¥ç¼“å­˜ï¼Œå¯¼è‡´5ä¸­ç¼“å­˜é•¿æ—¶é—´è¢«æ±¡æŸ“ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220610172505.png]]\n\n## å…ˆæ›´æ–°æ•°æ®åº“\n\næ›´æ–°æ•°æ®åº“--æ¸…ç©ºç¼“å­˜ä¹‹é—´ï¼Œå…¶å®ƒçº¿ç¨‹å¯èƒ½è¯»å–åˆ°ç¼“å­˜ä¸­çš„æ—§æ•°æ®ï¼Œ2ä¸­å­˜åœ¨ä¸€å®šçš„çª—å£æœŸã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220610172620.png]]\n\n## ç‰¹æ®Šæƒ…å†µ\n\nå‡è®¾æŸ¥è¯¢çº¿ç¨‹ A æŸ¥è¯¢æ•°æ®æ—¶æ°å¥½ç¼“å­˜æ•°æ®ç”±äºæ—¶é—´åˆ°æœŸå¤±æ•ˆï¼Œæˆ–æ˜¯ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œè¿™ç§æƒ…å†µçš„å‡ºç°å‡ ç‡éå¸¸å°ï¼Œè§ facebook è®ºæ–‡ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220610173806.png]]\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0":{"title":"è‡ªå®šä¹‰çº¿ç¨‹æ± ","content":"# è‡ªå®šä¹‰çº¿ç¨‹æ± \n\n![[z-oblib/z2-attachments/Pasted image 20220607213829.png]]\n\n## æ‹’ç»ç­–ç•¥æ¥å£\n\nç­–ç•¥æ¨¡å¼ï¼š\nå…·ä½“æ“ä½œæŠ½è±¡æˆæ¥å£ï¼Œå…·ä½“å®ç°ç”±è°ƒç”¨è€…ä¼ é€’è¿›æ¥ã€‚\n\n```java\n// æ‹’ç»ç­–ç•¥\n@FunctionalInterface\ninterface RejectPolicy\u003cT\u003e {\n    void reject(BlockingQueue\u003cT\u003e queue, T task);\n}\n```\n\nå‚æ•°è¦åŒ…å«queueï¼Œæ¥å†³å®šæ˜¯å¦è¦åœ¨queueä¸Šç­‰å¾…ï¼Œä¾‹å¦‚queue.put(task)\n\n## ä»»åŠ¡é˜Ÿåˆ—\n\n```java\nclass BlockingQueue\u003cT\u003e {\n    // 1. ä»»åŠ¡é˜Ÿåˆ—\n    private Deque\u003cT\u003e queue = new ArrayDeque\u003c\u003e();\n \n    // 2. é”\n    private ReentrantLock lock = new ReentrantLock();\n \n    // 3. ç”Ÿäº§è€…æ¡ä»¶å˜é‡\n    private Condition fullWaitSet = lock.newCondition();\n \n    // 4. æ¶ˆè´¹è€…æ¡ä»¶å˜é‡\n    private Condition emptyWaitSet = lock.newCondition();\n \n    // 5. å®¹é‡\n    private int capcity;\n \n    public BlockingQueue(int capcity) {\n        this.capcity = capcity;\n    }\n \n    // å¸¦è¶…æ—¶é˜»å¡è·å–\n    public T poll(long timeout, TimeUnit unit) {\n        lock.lock();\n        try {\n            // å°† timeout ç»Ÿä¸€è½¬æ¢ä¸º çº³ç§’\n            long nanos = unit.toNanos(timeout);\n            while (queue.isEmpty()) {\n                try {\n                    // è¿”å›å€¼æ˜¯å‰©ä½™æ—¶é—´\n                    if (nanos \u003c= 0) {\n                        return null;\n                    }\n                    nanos = emptyWaitSet.awaitNanos(nanos);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            T t = queue.removeFirst();\n            fullWaitSet.signal();\n            return t;\n        } finally {\n            lock.unlock();\n        }\n        }\n \n    // é˜»å¡è·å–\n    public T take() {\n        lock.lock();\n        try {\n            while (queue.isEmpty()) {\n                try {\n                    emptyWaitSet.await();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            T t = queue.removeFirst();\n            fullWaitSet.signal();\n            return t;\n        } finally {\n            lock.unlock();\n        }\n    }\n \n    // é˜»å¡æ·»åŠ \n    public void put(T task) {\n        lock.lock();\n        try {\n            while (queue.size() == capcity) {\n                try {\n                    log.debug(\"ç­‰å¾…åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {} ...\", task);\n                    fullWaitSet.await();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            log.debug(\"åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {}\", task);\n            queue.addLast(task);\n            emptyWaitSet.signal();\n        } finally {\n            lock.unlock();\n        }\n    }\n \n    // å¸¦è¶…æ—¶æ—¶é—´é˜»å¡æ·»åŠ \n    public boolean offer(T task, long timeout, TimeUnit timeUnit) {\n        lock.lock();\n        try {\n            long nanos = timeUnit.toNanos(timeout);\n            while (queue.size() == capcity) {\n                try {\n                    if(nanos \u003c= 0) {\n                        return false;\n                    }\n                    log.debug(\"ç­‰å¾…åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {} ...\", task);\n\n                    nanos = fullWaitSet.awaitNanos(nanos);\n                    } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            log.debug(\"åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {}\", task);\n            queue.addLast(task);\n            emptyWaitSet.signal();\n            return true;\n        } finally {\n            lock.unlock();\n        }\n    }\n \n    public int size() {\n        lock.lock();\n        try {\n            return queue.size();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n\t// è¶…æ—¶ç­–ç•¥ç”±çº¿ç¨‹è°ƒç”¨è€…æä¾›\n    public void tryPut(RejectPolicy\u003cT\u003e rejectPolicy, T task) {\n        lock.lock();\n        try {\n            // åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡\n            if(queue.size() == capcity) {\n                rejectPolicy.reject(this, task);  // æ‰§è¡Œå…·ä½“çš„è¶…æ—¶ç­–ç•¥\n            } else {  // æœ‰ç©ºé—²\n                log.debug(\"åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {}\", task);\n                queue.addLast(task);\n                emptyWaitSet.signal();\n            }\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n```\n\n## çº¿ç¨‹æ± \n\n```java\nclass ThreadPool {\n    // ä»»åŠ¡é˜Ÿåˆ—\n    private BlockingQueue\u003cRunnable\u003e taskQueue;\n \n    // çº¿ç¨‹é›†åˆ\n    private HashSet\u003cWorker\u003e workers = new HashSet\u003c\u003e();\n \n    // æ ¸å¿ƒçº¿ç¨‹æ•°\n    private int coreSize;\n \n    // è·å–ä»»åŠ¡æ—¶çš„è¶…æ—¶æ—¶é—´\n    private long timeout;\n \n    private TimeUnit timeUnit;\n \n    private RejectPolicy\u003cRunnable\u003e rejectPolicy;  // ä»»åŠ¡æ‰§è¡Œè¶…æ—¶ç­–ç•¥\n \n    // æ‰§è¡Œä»»åŠ¡\n    // å¯¹æ¥workerså’Œworkerï¼Œæ–°å»ºworkeræˆ–ä»é˜Ÿåˆ—æ‹¿\n    public void execute(Runnable task) {\n        // å½“ä»»åŠ¡æ•°æ²¡æœ‰è¶…è¿‡ coreSize æ—¶ï¼Œç›´æ¥äº¤ç»™ worker å¯¹è±¡æ‰§è¡Œ\n        // å¦‚æœä»»åŠ¡æ•°è¶…è¿‡ coreSize æ—¶ï¼ŒåŠ å…¥ä»»åŠ¡é˜Ÿåˆ—æš‚å­˜\n        synchronized (workers) {\n            if(workers.size() \u003c coreSize) {\n                Worker worker = new Worker(task);\n                log.debug(\"æ–°å¢ worker{}, {}\", worker, task);\n                workers.add(worker);\n                worker.start();\n            } else {\n//                taskQueue.put(task);\n\t\t\t\t// é˜Ÿåˆ—æ»¡äº†åçš„é€‰æ‹©ï¼š\n                // 1) æ­»ç­‰\n                // 2) å¸¦è¶…æ—¶ç­‰å¾…\n                // 3) è®©è°ƒç”¨è€…æ”¾å¼ƒä»»åŠ¡æ‰§è¡Œ\n                // 4) è®©è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸\n                // 5) è®©è°ƒç”¨è€…è‡ªå·±æ‰§è¡Œä»»åŠ¡\n\n\t\t\t\t// ä¸è¦å†™æ­»ï¼ŒæƒåŠ›ä¸‹æ”¾ç»™çº¿ç¨‹æ± ä½¿ç”¨è€…\n\t\t\t\t// ç­–ç•¥æ¨¡å¼\n                taskQueue.tryPut(rejectPolicy, task);\n            }\n        }\n    }\n \n    public ThreadPool(int coreSize, long timeout, TimeUnit timeUnit, int queueCapcity, \nRejectPolicy\u003cRunnable\u003e rejectPolicy) {\n        this.coreSize = coreSize;\n        this.timeout = timeout;\n        this.timeUnit = timeUnit;\n        this.taskQueue = new BlockingQueue\u003c\u003e(queueCapcity);\n        this.rejectPolicy = rejectPolicy;\n    }\n \n    class Worker extends Thread{\n        private Runnable task;\n \n        public Worker(Runnable task) {\n            this.task = task;\n        }\n \n        @Override\n        public void run() {\n            // æ‰§è¡Œä»»åŠ¡\n            // 1) å½“ task ä¸ä¸ºç©ºï¼Œæ‰§è¡Œä»»åŠ¡\n            // 2) å½“ task æ‰§è¡Œå®Œæ¯•ï¼Œå†æ¥ç€ä»ä»»åŠ¡é˜Ÿåˆ—è·å–ä»»åŠ¡å¹¶æ‰§è¡Œ\n//            while(task != null || (task = taskQueue.take()) != null) {\n\t\t\t// æœ‰è¶…æ—¶çš„ä»é˜Ÿåˆ—è·å–ä»»åŠ¡ï¼Œä¸€æ®µæ—¶é—´æ²¡ä»»åŠ¡å°±é”€æ¯worker\n            while(task != null || (task = taskQueue.poll(timeout, timeUnit)) != null) {\n                try {\n                    log.debug(\"æ­£åœ¨æ‰§è¡Œ...{}\", task);\n                    task.run();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                } finally {\n                    task = null;\n                }\n            }\n            synchronized (workers) {\n                log.debug(\"worker è¢«ç§»é™¤{}\", this);\n                workers.remove(this);\n            }\n        }\n    }\n}\n```\n\n## æµ‹è¯•\n\n```java\npublic static void main(String[] args) {\n        ThreadPool threadPool = new ThreadPool(1,\n                1000, TimeUnit.MILLISECONDS, 1, (queue, task)-\u003e{\n            // 1. æ­»ç­‰\n//            queue.put(task);\n            // 2) å¸¦è¶…æ—¶ç­‰å¾…\n//            queue.offer(task, 1500, TimeUnit.MILLISECONDS);\n            // 3) è®©è°ƒç”¨è€…æ”¾å¼ƒä»»åŠ¡æ‰§è¡Œ\n//            log.debug(\"æ”¾å¼ƒ{}\", task);\n            // 4) è®©è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸\n            // ä¼šåœ¨ä¸»çº¿ç¨‹foré‡Œé¢æŠ›å‡ºå¼‚å¸¸ï¼Œä½¿å¾—å‰©ä¸‹çš„ä»»åŠ¡éƒ½ä¸ä¼šè¢«æ‰§è¡Œ\n//            throw new RuntimeException(\"ä»»åŠ¡æ‰§è¡Œå¤±è´¥ \" + task);\n            // 5) è®©è°ƒç”¨è€…è‡ªå·±æ‰§è¡Œä»»åŠ¡\n            // task.run()æ˜¯ç”±ä¸»çº¿ç¨‹æ‰§è¡Œçš„\n            task.run();\n        });\n        for (int i = 0; i \u003c 4; i++) {\n            int j = i;\n            threadPool.execute(() -\u003e {\n                try {\n                    Thread.sleep(1000L);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                log.debug(\"{}\", j);\n            });\n        }\n    }\n```\n\næ³¨æ„ï¼š\n- ç­–ç•¥5æ˜¯ç”±mainçº¿ç¨‹æ‰§è¡Œçš„ã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%87%AA%E6%97%8B%E4%BC%98%E5%8C%96":{"title":"è‡ªæ—‹ä¼˜åŒ–","content":"# è‡ªæ—‹ä¼˜åŒ–\n\n- è‡ªæ—‹ä¼˜åŒ–ä¼šå› ä¸ºå¾ªç¯æ¶ˆè€—CPUèµ„æºã€‚\n- java6åè‡ªæ—‹é”æ˜¯è‡ªé€‚åº”çš„ï¼ŒæˆåŠŸçš„å¤šå°è¯•æ¬¡æ•°å°±å¤šã€‚\n- java7åä¸èƒ½æ§åˆ¶æ˜¯å¦å¼€å¯è‡ªæ—‹ã€‚\n\n## è‡ªæ—‹æˆåŠŸ\n\n![[z-oblib/z2-attachments/Pasted image 20220527214938.png]]\n\n## è‡ªæ—‹å¤±è´¥\n\n![[z-oblib/z2-attachments/Pasted image 20220527214953.png]]","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81":{"title":"è½»é‡çº§é”","content":"\n# è½»é‡çº§é”\n\n## ä½¿ç”¨æ–¹å¼\n\nè½»é‡çº§é”ä»»ç„¶ä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]]è¯­æ³•ï¼Œå®ç°å¯¹ä½¿ç”¨è€…é€æ˜ã€‚\n\n## ä½¿ç”¨åœºæ™¯\n\nå¦‚æœä¸€ä¸ªå¯¹è±¡è™½ç„¶æœ‰å¤šçº¿ç¨‹è¦åŠ é”ï¼Œä½†åŠ é”çš„æ—¶é—´æ˜¯é”™å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ç«äº‰ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥\nä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚\n\n## æµç¨‹\n\nç¤ºä¾‹ä»£ç ï¼š\n\n```java\nstatic final Object obj = new Object();\npublic static void method1() {\n    synchronized( obj ) {\n        // åŒæ­¥å— A\n        method2();\n    }\n}\npublic static void method2() {\n    synchronized( obj ) {\n        // åŒæ­¥å— B\n    }\n}\n```\n\n### è·å–é”\n\n1. æ¯ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]éƒ½çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç»“æ„ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/Mark Word|Mark Word]]ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ã€‚\n2. æ‹·è´[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/å¯¹è±¡å¤´|å¯¹è±¡å¤´]]ä¸­çš„Mark Wordå¤åˆ¶åˆ°åˆ›å»ºçš„é”è®°å½•ä¸­ã€‚\n![[z-oblib/z2-attachments/Pasted image 20220527211853.png]]\n3. æ‹·è´æˆåŠŸåï¼ŒJVMå°è¯•ä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]æ“ä½œå°†å¯¹è±¡å¤´çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡å¤´çš„mark wordã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™æ‰§è¡Œæ­¥éª¤4ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤5ã€‚\n![[z-oblib/z2-attachments/Pasted image 20220527212007.png]]\n4. å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”é”å¯¹è±¡å¤´ä¸­å­˜å‚¨äº†é”è®°å½•åœ°å€å’ŒçŠ¶æ€ 00 ã€‚\n5. å¦‚æœ cas å¤±è´¥ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š\n\t1. å¦‚æœæ˜¯å…¶å®ƒ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]å·²ç»æŒæœ‰äº†è¯¥ Object çš„è½»é‡çº§é”ï¼Œä¸€å®šæ¬¡æ•°åä»æœªè·å¾—é”å¯¹è±¡ï¼Œè¯´æ˜å‘ç”Ÿäº†ç«äº‰ï¼Œéœ€è¦è¿›è¡Œé”è†¨èƒ€ï¼Œè†¨èƒ€ä¸º[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é‡é‡çº§é”|é‡é‡çº§é”]]ã€‚\n    \u003e å°è¯•çš„æ–¹å¼æ˜¯é€šè¿‡[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è‡ªæ—‹ä¼˜åŒ–|è‡ªæ—‹ä¼˜åŒ–]]è¿›è¡Œçš„ï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è‡ªæ—‹|è‡ªæ—‹]]ä¼šæ¶ˆè€—CPUèµ„æºã€‚\n\n\t2. å¦‚æœæ˜¯è‡ªå·±æ‰§è¡Œäº† synchronized é”é‡å…¥ï¼Œé‚£ä¹ˆå†æ·»åŠ ä¸€æ¡ Lock Record ä½œä¸ºé‡å…¥çš„è®¡æ•°ã€‚\n\t![[z-oblib/z2-attachments/Pasted image 20220527212157.png]]\n\n### é‡Šæ”¾é”\n\n1. å½“é€€å‡º synchronized ä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰å¦‚æœæœ‰å–å€¼ä¸º null çš„é”è®°å½•ï¼Œè¡¨ç¤ºæœ‰é‡å…¥ï¼Œè¿™æ—¶é‡ç½®é”è®°å½•ï¼Œè¡¨ç¤ºé‡å…¥è®¡æ•°å‡ä¸€ã€‚\n\t![[z-oblib/z2-attachments/Pasted image 20220527212610.png]]\n2. å½“é€€å‡º synchronized ä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰é”è®°å½•çš„å€¼ä¸ä¸º nullï¼Œè¿™æ—¶ä½¿ç”¨ cas å°† Mark Word çš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´ï¼š\n\t1. æˆåŠŸï¼Œåˆ™è§£é”æˆåŠŸã€‚\n\t2. å¤±è´¥ï¼Œè¯´æ˜è½»é‡çº§é”è¿›è¡Œäº†é”è†¨èƒ€æˆ–å·²ç»å‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥é‡é‡çº§é”è§£é”æµç¨‹ã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81":{"title":"é‡é‡çº§é”","content":"# é‡é‡çº§é”\n\n## ä»‹ç»\n\né‡é‡çº§é”ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ï¼ˆmutexï¼‰ å®ç°çš„ï¼Œè€Œæ“ä½œç³»ç»Ÿä¸­çº¿ç¨‹é—´çŠ¶æ€çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥é‡é‡çº§é”æ•ˆç‡å¾ˆä½ï¼Œä½†è¢«é˜»å¡çš„çº¿ç¨‹ä¸ä¼šæ¶ˆè€—CPUã€‚\n\nå‰é¢è¯´åˆ°ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥å½“åšä¸€ä¸ªé”ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚æŸä¸ªå¯¹è±¡é”æ—¶ï¼Œå¯¹è±¡é”ä¼šè®¾ç½®å‡ ç§çŠ¶æ€ç”¨æ¥åŒºåˆ†è¯·æ±‚çš„çº¿ç¨‹ï¼š\n\n```\nContention Listï¼šæ‰€æœ‰è¯·æ±‚é”çš„çº¿ç¨‹å°†è¢«é¦–å…ˆæ”¾ç½®åˆ°è¯¥ç«äº‰é˜Ÿåˆ—\nEntry Listï¼šContention Listä¸­é‚£äº›æœ‰èµ„æ ¼æˆä¸ºå€™é€‰äººçš„çº¿ç¨‹è¢«ç§»åˆ°Entry List\nWait Setï¼šé‚£äº›è°ƒç”¨waitæ–¹æ³•è¢«é˜»å¡çš„çº¿ç¨‹è¢«æ”¾ç½®åˆ°Wait Set\nOnDeckï¼šä»»ä½•æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç«äº‰é”ï¼Œè¯¥çº¿ç¨‹ç§°ä¸ºOnDeck\nOwnerï¼šè·å¾—é”çš„çº¿ç¨‹ç§°ä¸ºOwner\n!Ownerï¼šé‡Šæ”¾é”çš„çº¿ç¨‹\n```\n\nå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å¾—é”æ—¶ï¼Œå¦‚æœè¯¥é”å·²ç»è¢«å ç”¨ï¼Œåˆ™ä¼šå°†è¯¥çº¿ç¨‹å°è£…æˆä¸€ä¸ª`ObjectWaiter`å¯¹è±¡æ’å…¥åˆ°Contention Listçš„é˜Ÿåˆ—çš„é˜Ÿé¦–ï¼Œç„¶åè°ƒç”¨`park`å‡½æ•°æŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚\n\nå½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šä»Contention Listæˆ–EntryListä¸­æŒ‘é€‰ä¸€ä¸ªçº¿ç¨‹å”¤é†’ï¼Œè¢«é€‰ä¸­çš„çº¿ç¨‹å«åš`Heir presumptive`å³å‡å®šç»§æ‰¿äººï¼Œå‡å®šç»§æ‰¿äººè¢«å”¤é†’åä¼šå°è¯•è·å¾—é”ï¼Œä½†`synchronized`æ˜¯éå…¬å¹³çš„ï¼Œæ‰€ä»¥å‡å®šç»§æ‰¿äººä¸ä¸€å®šèƒ½è·å¾—é”ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºé‡é‡çº§é”ï¼Œçº¿ç¨‹å…ˆè‡ªæ—‹å°è¯•è·å¾—é”ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘æ‰§è¡Œæ“ä½œç³»ç»ŸåŒæ­¥æ“ä½œå¸¦æ¥çš„å¼€é”€ã€‚å¦‚æœè‡ªæ—‹ä¸æˆåŠŸå†è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚è¿™å¯¹é‚£äº›å·²ç»åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ¥è¯´ï¼Œç¨å¾®æ˜¾å¾—ä¸å…¬å¹³ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å…¬å¹³çš„åœ°æ–¹æ˜¯è‡ªæ—‹çº¿ç¨‹å¯èƒ½ä¼šæŠ¢å äº†Readyçº¿ç¨‹çš„é”ã€‚\n\nå¦‚æœçº¿ç¨‹è·å¾—é”åè°ƒç”¨`Object.wait`æ–¹æ³•ï¼Œåˆ™ä¼šå°†çº¿ç¨‹åŠ å…¥åˆ°WaitSetä¸­ï¼Œå½“è¢«`Object.notify`å”¤é†’åï¼Œä¼šå°†çº¿ç¨‹ä»WaitSetç§»åŠ¨åˆ°Contention Listæˆ–EntryListä¸­å»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“è°ƒç”¨ä¸€ä¸ªé”å¯¹è±¡çš„`wait`æˆ–`notify`æ–¹æ³•æ—¶ï¼Œ**å¦‚å½“å‰é”çš„çŠ¶æ€æ˜¯åå‘é”æˆ–è½»é‡çº§é”åˆ™ä¼šå…ˆè†¨èƒ€æˆé‡é‡çº§é”**ã€‚\n\n## é‡é‡çº§é”åŠ é”å’Œé‡Šæ”¾é”æœºåˆ¶\n\né‡é‡çº§é”ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ï¼ˆmutexï¼‰ å®ç°çš„ï¼Œè€Œæ“ä½œç³»ç»Ÿä¸­çº¿ç¨‹é—´çŠ¶æ€çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥é‡é‡çº§é”æ•ˆç‡å¾ˆä½ï¼Œä½†è¢«é˜»å¡çš„çº¿ç¨‹ä¸ä¼šæ¶ˆè€—CPUã€‚\n\nå‰é¢è¯´åˆ°ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥å½“åšä¸€ä¸ªé”ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚æŸä¸ªå¯¹è±¡é”æ—¶ï¼Œå¯¹è±¡é”ä¼šè®¾ç½®å‡ ç§çŠ¶æ€ç”¨æ¥åŒºåˆ†è¯·æ±‚çš„çº¿ç¨‹ï¼š\n\n```\nContention Listï¼šæ‰€æœ‰è¯·æ±‚é”çš„çº¿ç¨‹å°†è¢«é¦–å…ˆæ”¾ç½®åˆ°è¯¥ç«äº‰é˜Ÿåˆ—\nEntry Listï¼šContention Listä¸­é‚£äº›æœ‰èµ„æ ¼æˆä¸ºå€™é€‰äººçš„çº¿ç¨‹è¢«ç§»åˆ°Entry List\nWait Setï¼šé‚£äº›è°ƒç”¨waitæ–¹æ³•è¢«é˜»å¡çš„çº¿ç¨‹è¢«æ”¾ç½®åˆ°Wait Set\nOnDeckï¼šä»»ä½•æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç«äº‰é”ï¼Œè¯¥çº¿ç¨‹ç§°ä¸ºOnDeck\nOwnerï¼šè·å¾—é”çš„çº¿ç¨‹ç§°ä¸ºOwner\n!Ownerï¼šé‡Šæ”¾é”çš„çº¿ç¨‹\n```\n\nå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å¾—é”æ—¶ï¼Œå¦‚æœè¯¥é”å·²ç»è¢«å ç”¨ï¼Œåˆ™ä¼šå°†è¯¥çº¿ç¨‹å°è£…æˆä¸€ä¸ª`ObjectWaiter`å¯¹è±¡æ’å…¥åˆ°Contention Listçš„é˜Ÿåˆ—çš„é˜Ÿé¦–ï¼Œç„¶åè°ƒç”¨`park`å‡½æ•°æŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚\n\nå½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šä»Contention Listæˆ–EntryListä¸­æŒ‘é€‰ä¸€ä¸ªçº¿ç¨‹å”¤é†’ï¼Œè¢«é€‰ä¸­çš„çº¿ç¨‹å«åš`Heir presumptive`å³å‡å®šç»§æ‰¿äººï¼Œå‡å®šç»§æ‰¿äººè¢«å”¤é†’åä¼šå°è¯•è·å¾—é”ï¼Œä½†`synchronized`æ˜¯éå…¬å¹³çš„ï¼Œæ‰€ä»¥å‡å®šç»§æ‰¿äººä¸ä¸€å®šèƒ½è·å¾—é”ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºé‡é‡çº§é”ï¼Œçº¿ç¨‹å…ˆè‡ªæ—‹å°è¯•è·å¾—é”ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘æ‰§è¡Œæ“ä½œç³»ç»ŸåŒæ­¥æ“ä½œå¸¦æ¥çš„å¼€é”€ã€‚å¦‚æœè‡ªæ—‹ä¸æˆåŠŸå†è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚è¿™å¯¹é‚£äº›å·²ç»åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ¥è¯´ï¼Œç¨å¾®æ˜¾å¾—ä¸å…¬å¹³ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å…¬å¹³çš„åœ°æ–¹æ˜¯è‡ªæ—‹çº¿ç¨‹å¯èƒ½ä¼šæŠ¢å äº†Readyçº¿ç¨‹çš„é”ã€‚\n\nå¦‚æœçº¿ç¨‹è·å¾—é”åè°ƒç”¨`Object.wait`æ–¹æ³•ï¼Œåˆ™ä¼šå°†çº¿ç¨‹åŠ å…¥åˆ°WaitSetä¸­ï¼Œå½“è¢«`Object.notify`å”¤é†’åï¼Œä¼šå°†çº¿ç¨‹ä»WaitSetç§»åŠ¨åˆ°Contention Listæˆ–EntryListä¸­å»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“è°ƒç”¨ä¸€ä¸ªé”å¯¹è±¡çš„`wait`æˆ–`notify`æ–¹æ³•æ—¶ï¼Œ**å¦‚å½“å‰é”çš„çŠ¶æ€æ˜¯åå‘é”æˆ–è½»é‡çº§é”åˆ™ä¼šå…ˆè†¨èƒ€æˆé‡é‡çº§é”**ã€‚\n\n    ![[z-oblib/z2-attachments/20200411162031746.png]]\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%B1%BB":{"title":"é”æ¥å£å’Œç±»","content":"# é”æ¥å£å’Œç±»\n\n## åˆ†ç±»\n\n### å¯é‡å…¥é”å’Œéå¯é‡å…¥é”\n\nå¯é‡å…¥ï¼š[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]èƒ½å¯¹èµ„æºé‡å¤åŠ é”ã€‚\n\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]]å…³é”®å­—å°±æ˜¯ä½¿ç”¨çš„é‡å…¥é”ã€‚\n- åœ¨ä¸€ä¸ªsynchronizedå®ä¾‹æ–¹æ³•é‡Œé¢è°ƒç”¨å¦ä¸€ä¸ªæœ¬å®ä¾‹çš„synchronizedå®ä¾‹æ–¹æ³•ï¼Œå®ƒå¯ä»¥é‡æ–°è¿›å…¥è¿™ä¸ªé”ï¼Œä¸ä¼šå‡ºç°ä»»ä½•å¼‚å¸¸ã€‚\n- å¦‚æœæˆ‘ä»¬è‡ªå·±åœ¨ç»§æ‰¿[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/AQS|AQS]]å®ç°åŒæ­¥å™¨çš„æ—¶å€™ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°å æœ‰é”çš„çº¿ç¨‹å†æ¬¡è·å–é”çš„åœºæ™¯ï¼Œå¯èƒ½å°±ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œé‚£è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªâ€œéå¯é‡å…¥é”â€ã€‚\n- ReentrantLockå°±æ˜¯å¯é‡å…¥é”ã€‚\n\n### å…¬å¹³é”å’Œéå…¬å¹³é”\n\nå…¬å¹³ï¼šç°æ¥ååˆ°ï¼ŒFIFOï¼Œå…ˆå¯¹é”è·å–è¯·æ±‚çš„çº¿ç¨‹ä¸€å®šä¼šå…ˆè¢«æ»¡è¶³ï¼Œåå¯¹é”è·å–è¯·æ±‚çš„çº¿ç¨‹åè¢«æ»¡è¶³ã€‚\n\n- éå…¬å¹³é”èƒ½æå‡ä¸€å®šçš„æ•ˆç‡ã€‚ä½†æ˜¯éå…¬å¹³é”å¯èƒ½ä¼šå‘ç”Ÿçº¿ç¨‹é¥¥é¥¿ï¼ˆæœ‰ä¸€äº›çº¿ç¨‹é•¿æ—¶é—´å¾—ä¸åˆ°é”ï¼‰çš„æƒ…å†µã€‚\n- ReentrantLockæ”¯æŒéå…¬å¹³é”å’Œå…¬å¹³é”ä¸¤ç§ã€‚\n\n### è¯»å†™é”å’Œæ’å®ƒé”\n\næ’å®ƒï¼šåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚\nè¯»å†™ï¼šåŒä¸€æ—¶åˆ»å…è®¸å¤šä¸ª**è¯»**çº¿ç¨‹è®¿é—®ã€‚\n\n- Javaæä¾›äº†ReentrantReadWriteLockç±»ä½œä¸ºè¯»å†™é”çš„é»˜è®¤å®ç°ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸¤ä¸ªé”ï¼šä¸€ä¸ªè¯»é”ï¼Œä¸€ä¸ªå†™é”ã€‚é€šè¿‡åˆ†ç¦»è¯»é”å’Œå†™é”ï¼Œä½¿å¾—åœ¨â€œè¯»å¤šå†™å°‘â€çš„ç¯å¢ƒä¸‹ï¼Œå¤§å¤§åœ°æé«˜äº†æ€§èƒ½ã€‚\n- å³ä½¿ç”¨è¯»å†™é”ï¼Œåœ¨å†™çº¿ç¨‹è®¿é—®æ—¶ï¼Œæ‰€æœ‰çš„è¯»çº¿ç¨‹å’Œå…¶å®ƒå†™çº¿ç¨‹å‡è¢«é˜»å¡ã€‚\n\n## JDKä¸­æœ‰å…³é”çš„ä¸€äº›æ¥å£å’Œç±»\n\n### æŠ½è±¡ç±»AQS/AQLS/AOS\n\nAQSï¼ˆAbstractQueuedSynchronizerï¼‰èµ„æºä¸Šé™æ˜¯Integer.MAX_VALUEï¼ŒAQLSï¼ˆAbstractQueuedLongSynchronizerï¼‰èµ„æºä¸Šé™æ˜¯Long.MAX_VALUEã€‚\nä¸¤è€…éƒ½ç»§æ‰¿è‡ªAOSï¼ˆAbstractOwnableSynchronizerï¼‰å®ƒæ˜¯ç”¨äºè¡¨ç¤ºé”ä¸æŒæœ‰è€…ä¹‹é—´çš„å…³ç³»ï¼ˆç‹¬å æ¨¡å¼ï¼‰ã€‚å¯ä»¥çœ‹ä¸€ä¸‹å®ƒçš„ä¸»è¦æ–¹æ³•ï¼š\n```java\n// ç‹¬å æ¨¡å¼ï¼Œé”çš„æŒæœ‰è€…  \nprivate transient Thread exclusiveOwnerThread;  \n\n// è®¾ç½®é”æŒæœ‰è€…  \nprotected final void setExclusiveOwnerThread(Thread t) {  \n    exclusiveOwnerThread = t;  \n}  \n\n// è·å–é”çš„æŒæœ‰çº¿ç¨‹  \nprotected final Thread getExclusiveOwnerThread() {  \n    return exclusiveOwnerThread;  \n}\n```\n\n### æ¥å£Condition/Lock/ReadWriteLock\n\njuc.locksåŒ…ä¸‹å…±æœ‰ä¸‰ä¸ªæ¥å£ï¼š`Condition`ã€`Lock`ã€`ReadWriteLock`ã€‚å…¶ä¸­ï¼ŒLockå’ŒReadWriteLockä»åå­—å°±å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œåˆ†åˆ«æ˜¯é”å’Œè¯»å†™é”çš„æ„æ€ã€‚Lockæ¥å£é‡Œé¢æœ‰ä¸€äº›è·å–é”å’Œé‡Šæ”¾é”çš„æ–¹æ³•å£°æ˜ï¼Œè€ŒReadWriteLocké‡Œé¢åªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«è¿”å›â€œè¯»é”â€å’Œâ€œå†™é”â€ï¼š\n\n```java\npublic interface ReadWriteLock {\n    Lock readLock();\n    Lock writeLock();\n}\n```\n\nLockæ¥å£ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯å¯ä»¥è·å¾—ä¸€ä¸ª`Condition`:\n\n```java\nCondition newCondition();\n```\n\n#TODO\n\n\n\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81%E6%B6%88%E9%99%A4":{"title":"é”æ¶ˆé™¤","content":"# é”æ¶ˆé™¤\n\nJITä¼šå¯¹javaå­—èŠ‚ç è¿›è¡Œä¼˜åŒ–ï¼Œé€ƒé€¸åˆ†ææ—¶å‘ç°å¯¹è±¡ä¸å¯èƒ½è¢«å…±äº«ï¼Œå°±ä¼šå–æ¶ˆæ— æ„ä¹‰çš„åŠ é”æ“ä½œã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9%E5%AF%B9%E6%AF%94":{"title":"é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”","content":"# é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/åå‘é”|åå‘é”]] [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è½»é‡çº§é”|è½»é‡çº§é”]] [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é‡é‡çº§é”|é‡é‡çº§é”]]\n\n| é”     | ä¼˜ç‚¹                                 | ç¼ºç‚¹                        | é€‚ç”¨åœºæ™¯               |\n|-------|------------------------------------|---------------------------|--------------------|\n| åå‘é”   | åŠ é”å’Œè§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—ï¼Œå’Œæ‰§è¡ŒéåŒæ­¥æ–¹æ³•æ¯”ä»…å­˜åœ¨çº³ç§’çº§çš„å·®è·ã€‚  | å¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—ã€‚  | é€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—åœºæ™¯ã€‚  |\n| è½»é‡çº§é”  | ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚              | å¦‚æœå§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹ä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPUã€‚  | è¿½æ±‚å“åº”æ—¶é—´ã€‚åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ã€‚ |\n| é‡é‡çº§é”  | çº¿ç¨‹ç«äº‰ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€—CPUã€‚                 | çº¿ç¨‹é˜»å¡ï¼Œå“åº”æ—¶é—´ç¼“æ…¢ã€‚              | è¿½æ±‚ååé‡ã€‚åŒæ­¥å—æ‰§è¡Œæ—¶é—´è¾ƒé•¿ã€‚   |\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81%E7%9A%84%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96":{"title":"é”çš„å…¶ä»–ä¼˜åŒ–","content":"# é”çš„å…¶ä»–ä¼˜åŒ–\n\n-   é€‚åº”æ€§è‡ªæ—‹ï¼ˆAdaptive Spinningï¼‰ï¼šä»[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è½»é‡çº§é”|è½»é‡çº§é”]]è·å–çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è½»é‡çº§é”#^8418aa|è¿‡ç¨‹]]ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œå½“[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]åœ¨è·å–è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­æ‰§è¡Œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]æ“ä½œå¤±è´¥æ—¶ï¼Œæ˜¯è¦é€šè¿‡è‡ªæ—‹æ¥è·å–[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é‡é‡çº§é”|é‡é‡çº§é”]]çš„ã€‚é—®é¢˜åœ¨äºï¼Œè‡ªæ—‹æ˜¯éœ€è¦æ¶ˆè€—CPUçš„ï¼Œå¦‚æœä¸€ç›´è·å–ä¸åˆ°é”çš„è¯ï¼Œé‚£è¯¥çº¿ç¨‹å°±ä¸€ç›´å¤„åœ¨è‡ªæ—‹çŠ¶æ€ï¼Œç™½ç™½æµªè´¹CPUèµ„æºã€‚è§£å†³è¿™ä¸ªé—®é¢˜æœ€ç®€å•çš„åŠæ³•å°±æ˜¯æŒ‡å®šè‡ªæ—‹çš„æ¬¡æ•°ï¼Œä¾‹å¦‚è®©å…¶å¾ªç¯10æ¬¡ï¼Œå¦‚æœè¿˜æ²¡è·å–åˆ°é”å°±è¿›å…¥é˜»å¡çŠ¶æ€ã€‚ä½†æ˜¯JDKé‡‡ç”¨äº†æ›´èªæ˜çš„æ–¹å¼â€”â€”é€‚åº”æ€§è‡ªæ—‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯çº¿ç¨‹å¦‚æœè‡ªæ—‹æˆåŠŸäº†ï¼Œåˆ™ä¸‹æ¬¡è‡ªæ—‹çš„æ¬¡æ•°ä¼šæ›´å¤šï¼Œå¦‚æœè‡ªæ—‹å¤±è´¥äº†ï¼Œåˆ™è‡ªæ—‹çš„æ¬¡æ•°å°±ä¼šå‡å°‘ã€‚\n-   é”ç²—åŒ–ï¼ˆLock Coarseningï¼‰ï¼šé”ç²—åŒ–çš„æ¦‚å¿µåº”è¯¥æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯å°†å¤šæ¬¡è¿æ¥åœ¨ä¸€èµ·çš„åŠ é”ã€è§£é”æ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡ï¼Œå°†å¤šä¸ªè¿ç»­çš„é”æ‰©å±•æˆä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”ã€‚ä¸¾ä¸ªä¾‹å­ï¼š\n\n```java\npublic  void lockCoarsening() {\n    int i=0;\n    synchronized (this){\n        i=i+1;\n    }\n    synchronized (this){\n        i=i+2;\n    }\n}\n```\n\nä¸Šé¢çš„ä¸¤ä¸ªåŒæ­¥ä»£ç å—å¯ä»¥å˜æˆä¸€ä¸ª\n\n```java\npublic  void lockCoarsening() {\n    int i=0;\n    synchronized (this){\n        i=i+1;\n        i=i+2;\n    }\n}\n```\n\n-   é”æ¶ˆé™¤ï¼ˆLock Eliminationï¼‰ï¼šé”æ¶ˆé™¤å³åˆ é™¤ä¸å¿…è¦çš„åŠ é”æ“ä½œçš„ä»£ç ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ,ä¸‹é¢çš„forå¾ªç¯å®Œå…¨å¯ä»¥ç§»å‡ºæ¥ï¼Œè¿™æ ·å¯ä»¥å‡å°‘åŠ é”ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹\n\n```java\npublic  void lockElimination() {\n    int i=0;\n    synchronized (this){\n        for(int c=0; c\u003c1000; c++){\n            System.out.println(c);\n        }\n        i=i+1;\n    }\n}\n```","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81%E8%86%A8%E8%83%80":{"title":"é”è†¨èƒ€","content":"# é”è†¨èƒ€\n\né”ç”±[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è½»é‡çº§é”|è½»é‡çº§é”]]å‘[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é‡é‡çº§é”|é‡é‡çº§é”]]å‡çº§çš„è¿‡ç¨‹ã€‚\n\n## ç«äº‰è€…å‡çº§é”\n\næ¥ç€[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è½»é‡çº§é”#è·å–é”|è½»é‡çº§é”ä¸­å‡çº§çš„5.1åˆ†æ”¯]]ç»§ç»­è¯´ï¼š\n\nå¦‚æœåœ¨å°è¯•åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­ï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]] æ“ä½œæ— æ³•æˆåŠŸï¼Œè¿™æ—¶ä¸€ç§æƒ…å†µå°±æ˜¯æœ‰å…¶å®ƒ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ä¸ºæ­¤å¯¹è±¡åŠ ä¸Šäº†è½»é‡çº§é”ï¼ˆæœ‰ç«äº‰ï¼‰ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œé”è†¨èƒ€ï¼Œå°†è½»é‡çº§é”å˜ä¸ºé‡é‡çº§é”ã€‚\n\n1. å½“ Thread-1 è¿›è¡Œè½»é‡çº§åŠ é”æ—¶ï¼ŒThread-0 å·²ç»å¯¹è¯¥å¯¹è±¡åŠ äº†è½»é‡çº§é”ã€‚\n![[z-oblib/z2-attachments/Pasted image 20220527214017.png]]\n2. Thread-1 åŠ è½»é‡çº§é”å¤±è´¥ï¼Œè¿›å…¥é”è†¨èƒ€æµç¨‹ï¼š\n\t1. ä¸º Object å¯¹è±¡ç”³è¯· [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/monitor|Monitor]] é”ï¼Œè®© Object æŒ‡å‘é‡é‡çº§é”åœ°å€ã€‚\n\t2. è‡ªå·±è¿›å…¥ Monitor çš„ EntryList BLOCKEDã€‚\n\t![[z-oblib/z2-attachments/Pasted image 20220527214113.png]]\n\n\n## åŸè½»é‡çº§é”æŒæœ‰è€…è§£é”\n\n1. å½“ Thread-0 é€€å‡ºåŒæ­¥å—è§£é”æ—¶ï¼Œä½¿ç”¨ cas å°† [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/Mark Word|Mark Word]] çš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´ï¼Œå¤±è´¥ã€‚è¿™æ—¶ä¼šè¿›å…¥é‡é‡çº§è§£é”æµç¨‹ï¼š\n\t1. å³æŒ‰ç…§ Monitor åœ°å€æ‰¾åˆ° Monitor å¯¹è±¡ã€‚\n\t2. è®¾ç½® Owner ä¸º nullã€‚\n\t3. å”¤é†’ EntryList ä¸­ BLOCKED çº¿ç¨‹ã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97":{"title":"é˜»å¡é˜Ÿåˆ—","content":"# é˜»å¡é˜Ÿåˆ—\n\n## ç®€ä»‹\n\njdkä¸­é˜»å¡é˜Ÿåˆ—BlockingQueueè§£å†³çš„é—®é¢˜å’Œå®ç°çš„åŠŸèƒ½ï¼š\n- å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«å˜é‡ï¼ˆèµ„æºï¼‰å®¹æ˜“äº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼šé‡å¤æ¶ˆè´¹ã€æ­»é”ã€‚\n- èµ„æºæ± ç©ºäº†ï¼Œéœ€è¦é˜»å¡æ¶ˆè´¹è€…ï¼Œå”¤é†’ç”Ÿäº§è€…ã€‚\n- èµ„æºæ± æ»¡äº†ï¼Œéœ€è¦é˜»å¡ç”Ÿäº§è€…ï¼Œå”¤é†’æ¶ˆè´¹è€…ã€‚\n\nBlockingQueueæ˜¯Java util.concurrentåŒ…ä¸‹é‡è¦çš„æ•°æ®ç»“æ„ï¼ŒåŒºåˆ«äºæ™®é€šçš„é˜Ÿåˆ—ï¼ŒBlockingQueueæä¾›äº†**çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—è®¿é—®æ–¹å¼**ï¼Œå¹¶å‘åŒ…ä¸‹å¾ˆå¤šé«˜çº§åŒæ­¥ç±»çš„å®ç°éƒ½æ˜¯åŸºäºBlockingQueueå®ç°çš„ã€‚å¼€å‘è€…åªç®¡å¾€é‡Œé¢å­˜å–å³å¯ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\nBlockingQueueä¸€èˆ¬ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚**BlockingQueueå°±æ˜¯å­˜æ”¾å…ƒç´ çš„å®¹å™¨**ã€‚\n\n## æ“ä½œæ–¹æ³•\n\né˜»å¡é˜Ÿåˆ—æä¾›äº†å››ç»„ä¸åŒçš„æ–¹æ³•ç”¨äºæ’å…¥ã€ç§»é™¤ã€æ£€æŸ¥å…ƒç´ ï¼š\n| æ–¹æ³•\\å¤„ç†æ–¹å¼  | æŠ›å‡ºå¼‚å¸¸       | è¿”å›ç‰¹æ®Šå€¼     | ä¸€ç›´é˜»å¡    | è¶…æ—¶é€€å‡º               |\n|----------|------------|-----------|---------|--------------------|\n| æ’å…¥æ–¹æ³•     | add(e)     | offer(e)  | put(e)  | offer(e,time,unit) |\n| ç§»é™¤æ–¹æ³•     | remove()   | poll()    | take()  | poll(time,unit)    |\n| æ£€æŸ¥æ–¹æ³•     | element()  | peek()    | -       | -                  |\n-   æŠ›å‡ºå¼‚å¸¸ï¼šå¦‚æœè¯•å›¾çš„æ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼ŒæŠ›å¼‚å¸¸ã€‚å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶å€™ï¼Œå†å¾€é˜Ÿåˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œä¼šæŠ›å‡ºIllegalStateException(â€œQueue fullâ€)å¼‚å¸¸ã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ æ—¶ä¼šæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸ ã€‚\n-   è¿”å›ç‰¹æ®Šå€¼ï¼šå¦‚æœè¯•å›¾çš„æ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼Œé€šå¸¸æ˜¯true / falseã€‚\n-   ä¸€ç›´é˜»å¡ï¼šå¦‚æœè¯•å›¾çš„æ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œåˆ™ä¸€ç›´é˜»å¡æˆ–è€…å“åº”ä¸­æ–­ã€‚\n-   è¶…æ—¶é€€å‡ºï¼šå¦‚æœè¯•å›¾çš„æ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œè¯¥æ–¹æ³•è°ƒç”¨å°†ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°èƒ½å¤Ÿæ‰§è¡Œï¼Œä½†ç­‰å¾…æ—¶é—´ä¸ä¼šè¶…è¿‡ç»™å®šå€¼ã€‚è¿”å›ä¸€ä¸ªç‰¹å®šå€¼ä»¥å‘ŠçŸ¥è¯¥æ“ä½œæ˜¯å¦æˆåŠŸï¼Œé€šå¸¸æ˜¯ true / falseã€‚\n\n**æ³¨æ„ï¼š**\n-   ä¸èƒ½å¾€é˜»å¡é˜Ÿåˆ—ä¸­æ’å…¥null,ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚\n-   å¯ä»¥è®¿é—®é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»æ„å…ƒç´ ï¼Œè°ƒç”¨remove(o)å¯ä»¥å°†é˜Ÿåˆ—ä¹‹ä¸­çš„ç‰¹å®šå¯¹è±¡ç§»é™¤ï¼Œä½†å¹¶ä¸é«˜æ•ˆï¼Œå°½é‡é¿å…ä½¿ç”¨ã€‚\n\n## å®ç°ç±»\n\n### ArrayBlockingQueue\n\nç”±**æ•°ç»„**ç»“æ„ç»„æˆçš„**æœ‰ç•Œ**é˜»å¡é˜Ÿåˆ—ã€‚å†…éƒ¨ç»“æ„æ˜¯æ•°ç»„ï¼Œæ•…å…·æœ‰æ•°ç»„çš„ç‰¹æ€§ã€‚\n\n```java\npublic ArrayBlockingQueue(int capacity, boolean fair){\n    //..çœç•¥ä»£ç \n}\n```\n\nå¯ä»¥åˆå§‹åŒ–é˜Ÿåˆ—å¤§å°ï¼Œ ä¸”ä¸€æ—¦åˆå§‹åŒ–ä¸èƒ½æ”¹å˜ã€‚æ„é€ æ–¹æ³•ä¸­çš„fairè¡¨ç¤ºæ§åˆ¶å¯¹è±¡çš„å†…éƒ¨é”æ˜¯å¦é‡‡ç”¨å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ã€‚\n\n### LinkedBlockingQueue\n\nç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚å†…éƒ¨ç»“æ„æ˜¯é“¾è¡¨ï¼Œå…·æœ‰é“¾è¡¨çš„ç‰¹æ€§ã€‚é»˜è®¤é˜Ÿåˆ—çš„å¤§å°æ˜¯`Integer.MAX_VALUE`ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤§å°ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§**å…ˆè¿›å…ˆå‡º**çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚\n\n### DelayQueue\n\nè¯¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´  ã€‚æ³¨å…¥å…¶ä¸­çš„å…ƒç´ å¿…é¡»å®ç° java.util.concurrent.Delayed æ¥å£ã€‚ \nDelayQueueæ˜¯ä¸€ä¸ª**æ— ç•Œ**çš„é˜Ÿåˆ—ï¼Œå› æ­¤å¾€é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®çš„æ“ä½œï¼ˆç”Ÿäº§è€…ï¼‰æ°¸è¿œä¸ä¼šè¢«é˜»å¡ï¼Œè€Œåªæœ‰è·å–æ•°æ®çš„æ“ä½œï¼ˆæ¶ˆè´¹è€…ï¼‰æ‰ä¼šè¢«é˜»å¡ã€‚ \n\n### PriorityBlockingQueue\n\nåŸºäºä¼˜å…ˆçº§çš„**æ— ç•Œ**é˜»å¡é˜Ÿåˆ—ï¼ˆä¼˜å…ˆçº§çš„åˆ¤æ–­é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥çš„Compatorå¯¹è±¡æ¥å†³å®šï¼‰ï¼Œå†…éƒ¨æ§åˆ¶çº¿ç¨‹åŒæ­¥çš„é”é‡‡ç”¨çš„æ˜¯éå…¬å¹³é”ã€‚\n\n\u003eç½‘ä¸Šå¤§éƒ¨åˆ†åšå®¢ä¸Š**PriorityBlockingQueue**ä¸ºå…¬å¹³é”ï¼Œå…¶å®æ˜¯ä¸å¯¹çš„ã€‚\n\n```java\npublic PriorityBlockingQueue(int initialCapacity,\n                                  Comparator\u003c? super E\u003e comparator) {\n         this.lock = new ReentrantLock(); //é»˜è®¤æ„é€ æ–¹æ³•-éå…¬å¹³é”\n         ...//å…¶ä½™ä»£ç ç•¥\n     }\n```\n\n### SynchronousQueue\n\nè¿™ä¸ªé˜Ÿåˆ—æ¯”è¾ƒç‰¹æ®Šï¼Œ**æ²¡æœ‰ä»»ä½•å†…éƒ¨å®¹é‡**ï¼Œç”šè‡³è¿ä¸€ä¸ªé˜Ÿåˆ—çš„å®¹é‡éƒ½æ²¡æœ‰ã€‚å¹¶ä¸”æ¯ä¸ª put å¿…é¡»ç­‰å¾…ä¸€ä¸ª takeï¼Œåä¹‹äº¦ç„¶ã€‚\n\néœ€è¦åŒºåˆ«å®¹é‡ä¸º1çš„ArrayBlockingQueueã€LinkedBlockingQueueã€‚\n\nä»¥ä¸‹æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¯ä»¥å¸®åŠ©ç†è§£è¿™ä¸ªé˜Ÿåˆ—ï¼š\n\n-   iterator() æ°¸è¿œè¿”å›ç©ºï¼Œå› ä¸ºé‡Œé¢æ²¡æœ‰ä¸œè¥¿\n-   peek() æ°¸è¿œè¿”å›null\n-   put() å¾€queueæ”¾è¿›å»ä¸€ä¸ªelementä»¥åå°±ä¸€ç›´waitç›´åˆ°æœ‰å…¶ä»–threadè¿›æ¥æŠŠè¿™ä¸ªelementå–èµ°ã€‚\n-   offer() å¾€queueé‡Œæ”¾ä¸€ä¸ªelementåç«‹å³è¿”å›ï¼Œå¦‚æœç¢°å·§è¿™ä¸ªelementè¢«å¦ä¸€ä¸ªthreadå–èµ°äº†ï¼Œofferæ–¹æ³•è¿”å›trueï¼Œè®¤ä¸ºofferæˆåŠŸï¼›å¦åˆ™è¿”å›falseã€‚\n-   take() å–å‡ºå¹¶ä¸”removeæ‰queueé‡Œçš„elementï¼Œå–ä¸åˆ°ä¸œè¥¿ä»–ä¼šä¸€ç›´ç­‰ã€‚\n-   poll() å–å‡ºå¹¶ä¸”removeæ‰queueé‡Œçš„elementï¼Œåªæœ‰åˆ°ç¢°å·§å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨å¾€queueé‡Œofferæ•°æ®æˆ–è€…putæ•°æ®çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•æ‰ä¼šå–åˆ°ä¸œè¥¿ã€‚å¦åˆ™ç«‹å³è¿”å›nullã€‚\n-   isEmpty() æ°¸è¿œè¿”å›true\n-   remove()\u0026removeAll() æ°¸è¿œè¿”å›false\n\n**æ€»æ³¨æ„ï¼š**\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é˜»å¡é˜Ÿåˆ—#PriorityBlockingQueue|PriorityBlockingQueue]]ä¸ä¼šé˜»å¡æ•°æ®ç”Ÿäº§è€…ï¼ˆå› ä¸ºé˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼‰ï¼Œè€Œåªä¼šåœ¨æ²¡æœ‰å¯æ¶ˆè´¹çš„æ•°æ®æ—¶ï¼Œé˜»å¡æ•°æ®çš„æ¶ˆè´¹è€…ã€‚å› æ­¤ä½¿ç”¨çš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ï¼Œ**ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®çš„é€Ÿåº¦ç»å¯¹ä¸èƒ½å¿«äºæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„é€Ÿåº¦**ï¼Œå¦åˆ™æ—¶é—´ä¸€é•¿ï¼Œä¼šæœ€ç»ˆè€—å°½æ‰€æœ‰çš„å¯ç”¨å †å†…å­˜ç©ºé—´ã€‚å¯¹äºä½¿ç”¨é»˜è®¤å¤§å°çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é˜»å¡é˜Ÿåˆ—#LinkedBlockingQueue|LinkedBlockingQueue]]ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ˆé»˜è®¤å¤§å°ç‰¹åˆ«å¤§ï¼‰ã€‚\n\n## åŸç†\n\né˜»å¡é˜Ÿåˆ—çš„åŸç†å¾ˆç®€å•ï¼Œåˆ©ç”¨äº†Locké”çš„å¤šæ¡ä»¶ï¼ˆConditionï¼‰é˜»å¡æ§åˆ¶ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æArrayBlockingQueue JDK 1.8 çš„æºç ã€‚\n\né¦–å…ˆæ˜¯æ„é€ å™¨ï¼Œé™¤äº†åˆå§‹åŒ–é˜Ÿåˆ—çš„å¤§å°å’Œæ˜¯å¦æ˜¯å…¬å¹³é”ä¹‹å¤–ï¼Œè¿˜å¯¹åŒä¸€ä¸ªé”ï¼ˆlockï¼‰åˆå§‹åŒ–äº†ä¸¤ä¸ªç›‘è§†å™¨ï¼Œåˆ†åˆ«æ˜¯notEmptyå’ŒnotFullã€‚è¿™ä¸¤ä¸ªç›‘è§†å™¨çš„ä½œç”¨ç›®å‰å¯ä»¥ç®€å•ç†è§£ä¸ºæ ‡è®°åˆ†ç»„ï¼Œå½“è¯¥çº¿ç¨‹æ˜¯putæ“ä½œæ—¶ï¼Œç»™ä»–åŠ ä¸Šç›‘è§†å™¨notFull,æ ‡è®°è¿™ä¸ªçº¿ç¨‹æ˜¯ä¸€ä¸ªç”Ÿäº§è€…ï¼›å½“çº¿ç¨‹æ˜¯takeæ“ä½œæ—¶ï¼Œç»™ä»–åŠ ä¸Šç›‘è§†å™¨notEmptyï¼Œæ ‡è®°è¿™ä¸ªçº¿ç¨‹æ˜¯æ¶ˆè´¹è€…ã€‚\n\n```java\n//æ•°æ®å…ƒç´ æ•°ç»„\nfinal Object[] items;\n//ä¸‹ä¸€ä¸ªå¾…å–å‡ºå…ƒç´ ç´¢å¼•\nint takeIndex;\n//ä¸‹ä¸€ä¸ªå¾…æ·»åŠ å…ƒç´ ç´¢å¼•\nint putIndex;\n//å…ƒç´ ä¸ªæ•°\nint count;\n//å†…éƒ¨é”\nfinal ReentrantLock lock;\n//æ¶ˆè´¹è€…ç›‘è§†å™¨\nprivate final Condition notEmpty;\n//ç”Ÿäº§è€…ç›‘è§†å™¨\nprivate final Condition notFull;  \n\npublic ArrayBlockingQueue(int capacity, boolean fair) {\n    //..çœç•¥å…¶ä»–ä»£ç \n    lock = new ReentrantLock(fair);\n    notEmpty = lock.newCondition();\n    notFull =  lock.newCondition();\n}\n```\n\nç”Ÿäº§è€… put()ï¼š\n```java\npublic void put(E e) throws InterruptedException {\n    checkNotNull(e);\n    final ReentrantLock lock = this.lock;\n    // 1.è‡ªæ—‹æ‹¿æ“ä½œèµ„æºé˜Ÿåˆ—çš„é”\n    // å¦‚æœå½“å‰çº¿ç¨‹æœªä¸­æ–­åˆ™è·å–é”å®šï¼Œå¦‚æœå·²ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸\n    // lockä¼˜å…ˆè€ƒè™‘è·å–é”ï¼ŒæˆåŠŸåæ‰å“åº”ä¸­æ–­ã€‚\n    // lockInterruptiblyä¼˜å…ˆè€ƒè™‘å“åº”ä¸­æ–­ï¼Œè€Œä¸æ˜¯å“åº”é”çš„æ™®é€šè·å–æˆ–é‡å…¥è·å–\n    // lockInterruptiblyå¯ä»¥ç”¨æ¥æ‰¹é‡ä¸­æ–­çº¿ç¨‹æ± ä¸­æ­£åœ¨è·å–é”çš„çº¿ç¨‹\n    lock.lockInterruptibly();\n    try {\n        // 2.åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡äº†\n        while (count == items.length)\n            // 2.1å¦‚æœæ»¡äº†ï¼Œé˜»å¡è¯¥çº¿ç¨‹ï¼Œå¹¶æ ‡è®°ä¸ºnotFullçº¿ç¨‹ï¼Œ\n            // ç­‰å¾…notFullçš„å”¤é†’ï¼Œå”¤é†’ä¹‹åç»§ç»­æ‰§è¡Œwhileå¾ªç¯ã€‚\n            notFull.await();\n        // 3.å¦‚æœæ²¡æœ‰æ»¡ï¼Œåˆ™è¿›å…¥é˜Ÿåˆ—\n        enqueue(e);\n    } finally {\n        lock.unlock();\n    }\n}\nprivate void enqueue(E x) {\n    // assert lock.getHoldCount() == 1;\n    // assert items[putIndex] == null;\n    final Object[] items = this.items;\n    items[putIndex] = x;\n    if (++putIndex == items.length)\n        putIndex = 0;\n    count++;\n    // 4 å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹\n    notEmpty.signal();\n}\n```\n\nputæµç¨‹ï¼š\n1.  æ‰€æœ‰æ‰§è¡Œputæ“ä½œçš„çº¿ç¨‹ç«äº‰locké”ï¼Œæ‹¿åˆ°äº†locké”çš„çº¿ç¨‹è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œæ²¡æœ‰æ‹¿åˆ°locké”çš„çº¿ç¨‹è‡ªæ—‹ç«äº‰é”ã€‚\n2.  åˆ¤æ–­é˜»å¡é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ï¼Œå¦‚æœæ»¡äº†ï¼Œåˆ™è°ƒç”¨awaitæ–¹æ³•é˜»å¡è¿™ä¸ªçº¿ç¨‹ï¼Œå¹¶æ ‡è®°ä¸ºnotFullï¼ˆç”Ÿäº§è€…ï¼‰çº¿ç¨‹ï¼ŒåŒæ—¶é‡Šæ”¾locké”,ç­‰å¾…è¢«æ¶ˆè´¹è€…çº¿ç¨‹å”¤é†’ã€‚\n3.  å¦‚æœæ²¡æœ‰æ»¡ï¼Œåˆ™è°ƒç”¨enqueueæ–¹æ³•å°†å…ƒç´ putè¿›é˜»å¡é˜Ÿåˆ—ã€‚æ³¨æ„è¿™ä¸€æ­¥çš„çº¿ç¨‹è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ç¬¬äºŒæ­¥ä¸­é˜»å¡çš„çº¿ç¨‹è¢«å”¤é†’ä¸”åˆæ‹¿åˆ°äº†locké”çš„çº¿ç¨‹ã€‚\n4.  å”¤é†’ä¸€ä¸ªæ ‡è®°ä¸ºnotEmptyï¼ˆæ¶ˆè´¹è€…ï¼‰çš„çº¿ç¨‹ã€‚\n\næ¶ˆè´¹è€…take()ï¼š\n```java\npublic E take() throws InterruptedException {\n    final ReentrantLock lock = this.lock;\n    lock.lockInterruptibly();\n    try {\n\t    // æ²¡æœ‰èµ„æºåˆ™é˜»å¡\n        while (count == 0)\n            notEmpty.await();\n        // æ¶ˆè´¹èµ„æº\n        return dequeue();\n    } finally {\n        lock.unlock();\n    }\n}\nprivate E dequeue() {\n    // assert lock.getHoldCount() == 1;\n    // assert items[takeIndex] != null;\n    final Object[] items = this.items;\n    @SuppressWarnings(\"unchecked\")\n    E x = (E) items[takeIndex];\n    items[takeIndex] = null;\n    if (++takeIndex == items.length)\n        takeIndex = 0;\n    count--;\n    if (itrs != null)\n        itrs.elementDequeued();\n    notFull.signal();\n    return x;\n}\n```\ntakeæµç¨‹ï¼š\n1.  æ‰€æœ‰æ‰§è¡Œtakeæ“ä½œçš„çº¿ç¨‹ç«äº‰locké”ï¼Œæ‹¿åˆ°äº†locké”çš„çº¿ç¨‹è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œæ²¡æœ‰æ‹¿åˆ°locké”çš„çº¿ç¨‹è‡ªæ—‹ç«äº‰é”ã€‚\n2.  åˆ¤æ–­é˜»å¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ç©ºï¼Œåˆ™è°ƒç”¨awaitæ–¹æ³•é˜»å¡è¿™ä¸ªçº¿ç¨‹ï¼Œå¹¶æ ‡è®°ä¸ºnotEmptyï¼ˆæ¶ˆè´¹è€…ï¼‰çº¿ç¨‹ï¼ŒåŒæ—¶é‡Šæ”¾locké”,ç­‰å¾…è¢«ç”Ÿäº§è€…çº¿ç¨‹å”¤é†’ã€‚\n3.  å¦‚æœæ²¡æœ‰ç©ºï¼Œåˆ™è°ƒç”¨dequeueæ–¹æ³•ã€‚æ³¨æ„è¿™ä¸€æ­¥çš„çº¿ç¨‹è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ç¬¬äºŒæ­¥ä¸­é˜»å¡çš„çº¿ç¨‹è¢«å”¤é†’ä¸”åˆæ‹¿åˆ°äº†locké”çš„çº¿ç¨‹ã€‚\n4.  å”¤é†’ä¸€ä¸ªæ ‡è®°ä¸ºnotFullï¼ˆç”Ÿäº§è€…ï¼‰çš„çº¿ç¨‹ã€‚\n\n**æ³¨æ„ï¼š**\n1.  putå’Œtakeæ“ä½œéƒ½éœ€è¦**å…ˆè·å–é”**ï¼Œæ²¡æœ‰è·å–åˆ°é”çš„çº¿ç¨‹ä¼šè¢«æŒ¡åœ¨ç¬¬ä¸€é“å¤§é—¨ä¹‹å¤–è‡ªæ—‹æ‹¿é”ï¼Œç›´åˆ°è·å–åˆ°é”ã€‚\n2.  å°±ç®—æ‹¿åˆ°é”äº†ä¹‹åï¼Œä¹Ÿ**ä¸ä¸€å®š**ä¼šé¡ºåˆ©è¿›è¡Œput/takeæ“ä½œï¼Œéœ€è¦åˆ¤æ–­**é˜Ÿåˆ—æ˜¯å¦å¯ç”¨**ï¼ˆæ˜¯å¦æ»¡/ç©ºï¼‰ï¼Œå¦‚æœä¸å¯ç”¨ï¼Œåˆ™ä¼šè¢«é˜»å¡ï¼Œ**å¹¶é‡Šæ”¾é”**ã€‚\n3.  åœ¨ç¬¬2ç‚¹è¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œä½†æ˜¯åœ¨å”¤é†’ä¹‹åï¼Œ**ä¾ç„¶éœ€è¦æ‹¿åˆ°é”**æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦åˆ™ï¼Œè‡ªæ—‹æ‹¿é”ï¼Œæ‹¿åˆ°é”äº†å†whileåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å¯ç”¨ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸ç”¨ifåˆ¤æ–­ï¼Œè€Œä½¿ç”¨whileåˆ¤æ–­çš„åŸå› ï¼‰ã€‚\n\n## ç¤ºä¾‹å’Œä½¿ç”¨åœºæ™¯\n\n### ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹\n\n```java\npublic class Test {\n    private int queueSize = 10;\n    private ArrayBlockingQueue\u003cInteger\u003e queue = new ArrayBlockingQueue\u003cInteger\u003e(queueSize);\n\n    public static void main(String[] args)  {\n        Test test = new Test();\n        Producer producer = test.new Producer();\n        Consumer consumer = test.new Consumer();\n\n        producer.start();\n        consumer.start();\n    }\n\n    class Consumer extends Thread{\n\n        @Override\n        public void run() {\n            consume();\n        }\n\n        private void consume() {\n            while(true){\n                try {\n                    queue.take();\n                    System.out.println(\"ä»é˜Ÿåˆ—å–èµ°ä¸€ä¸ªå…ƒç´ ï¼Œé˜Ÿåˆ—å‰©ä½™\"+queue.size()+\"ä¸ªå…ƒç´ \");\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    class Producer extends Thread{\n\n        @Override\n        public void run() {\n            produce();\n        }\n\n        private void produce() {\n            while(true){\n                try {\n                    queue.put(1);\n                    System.out.println(\"å‘é˜Ÿåˆ—å–ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé˜Ÿåˆ—å‰©ä½™ç©ºé—´ï¼š\"+(queueSize-queue.size()));\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n```","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%A1%BA%E5%BA%8F%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B":{"title":"é¡ºåºä¸€è‡´æ€§æ¨¡å‹","content":"# é¡ºåºä¸€è‡´æ€§æ¨¡å‹\n\né¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ª**ç†æƒ³åŒ–çš„ç†è®ºå‚è€ƒæ¨¡å‹**ï¼Œå®ƒä¸ºç¨‹åºå‘˜æä¾›äº†æå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚\n\né¡ºåºä¸€è‡´æ€§æ¨¡å‹æœ‰ä¸¤å¤§ç‰¹æ€§ï¼š\n\n-   ä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ä¸­çš„æ‰€æœ‰æ“ä½œå¿…é¡»æŒ‰ç…§ç¨‹åºçš„é¡ºåºï¼ˆå³Javaä»£ç çš„é¡ºåºï¼‰æ¥æ‰§è¡Œã€‚\n    \n-   ä¸ç®¡ç¨‹åºæ˜¯å¦[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åŒæ­¥|åŒæ­¥]]ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚å³åœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªæ“ä½œå¿…é¡»æ˜¯**åŸå­æ€§çš„ï¼Œä¸”ç«‹åˆ»å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§**ã€‚\n    \n\nä¸ºäº†ç†è§£è¿™ä¸¤ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’ŒBå¹¶å‘æ‰§è¡Œï¼Œçº¿ç¨‹Aæœ‰3ä¸ªæ“ä½œï¼Œä»–ä»¬åœ¨ç¨‹åºä¸­çš„é¡ºåºæ˜¯A1-\u003eA2-\u003eA3ï¼Œçº¿ç¨‹Bä¹Ÿæœ‰3ä¸ªæ“ä½œï¼ŒB1-\u003eB2-\u003eB3ã€‚\n\nå‡è®¾**æ­£ç¡®ä½¿ç”¨äº†åŒæ­¥**ï¼ŒAçº¿ç¨‹çš„3ä¸ªæ“ä½œæ‰§è¡Œåé‡Šæ”¾é”ï¼ŒBçº¿ç¨‹è·å–åŒä¸€ä¸ªé”ã€‚é‚£ä¹ˆåœ¨**é¡ºåºä¸€è‡´æ€§æ¨¡å‹**ä¸­çš„æ‰§è¡Œæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n![[z-oblib/z2-attachments/æ­£ç¡®åŒæ­¥.png]]\n\næ“ä½œçš„æ‰§è¡Œæ•´ä½“ä¸Šæœ‰åºï¼Œå¹¶ä¸”ä¸¤ä¸ªçº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°è¿™ä¸ªæ‰§è¡Œé¡ºåºã€‚\n\nå‡è®¾**æ²¡æœ‰ä½¿ç”¨åŒæ­¥**ï¼Œé‚£ä¹ˆåœ¨**é¡ºåºä¸€è‡´æ€§æ¨¡å‹**ä¸­çš„æ‰§è¡Œæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n![[z-oblib/z2-attachments/æ²¡æœ‰æ­£ç¡®åŒæ­¥.png]]\n\næ“ä½œçš„æ‰§è¡Œæ•´ä½“ä¸Šæ— åºï¼Œä½†æ˜¯ä¸¤ä¸ªçº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°è¿™ä¸ªæ‰§è¡Œé¡ºåºã€‚ä¹‹æ‰€ä»¥å¯ä»¥å¾—åˆ°è¿™ä¸ªä¿è¯ï¼Œæ˜¯å› ä¸ºé¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„**æ¯ä¸ªæ“ä½œå¿…é¡»ç«‹å³å¯¹ä»»æ„çº¿ç¨‹å¯è§**ã€‚\n\n**ä½†æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/JMM|JMM]]æ²¡æœ‰è¿™æ ·çš„ä¿è¯ï¼š**\næ¯”å¦‚ï¼Œåœ¨å½“å‰çº¿ç¨‹æŠŠå†™è¿‡çš„æ•°æ®ç¼“å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œ**åœ¨æ²¡æœ‰åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹å‰ï¼Œè¿™ä¸ªå†™æ“ä½œä»…å¯¹å½“å‰çº¿ç¨‹å¯è§**ï¼›ä»å…¶ä»–çº¿ç¨‹çš„è§’åº¦æ¥è§‚å¯Ÿï¼Œè¿™ä¸ªå†™æ“ä½œæ ¹æœ¬æ²¡æœ‰è¢«å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œã€‚åªæœ‰å½“å‰çº¿ç¨‹æŠŠæœ¬åœ°å†…å­˜ä¸­å†™è¿‡çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹åï¼Œè¿™ä¸ªå†™æ“ä½œæ‰å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰çº¿ç¨‹å’Œå…¶ä»–çº¿ç¨‹çœ‹åˆ°çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ä¸€æ ·çš„ã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%A1%BA%E5%BA%8F%E6%8E%A7%E5%88%B6":{"title":"é¡ºåºæ§åˆ¶","content":"# é¡ºåºæ§åˆ¶\n\nçº¿ç¨‹ä¹‹é—´æŒ‰è§„å®šçš„å…ˆåé¡ºåºæ‰§è¡Œã€‚\n\n## äº¤æ›¿è¾“å‡º\n\nçº¿ç¨‹ 1 è¾“å‡º a 5 æ¬¡ï¼Œçº¿ç¨‹ 2 è¾“å‡º b 5 æ¬¡ï¼Œçº¿ç¨‹ 3 è¾“å‡º c 5 æ¬¡ã€‚ç°åœ¨è¦æ±‚è¾“å‡º abcabcabcabcabc æ€ä¹ˆå®ç°ï¼š\n\n### wait\u0026notify\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/wait\u0026notify|wait\u0026notify]]\n\n```java\nclass SyncWaitNotify {\n    private int flag;\n    private int loopNumber;\n \n    public SyncWaitNotify(int flag, int loopNumber) {\n        this.flag = flag;\n        this.loopNumber = loopNumber;\n    }\n \n    public void print(int waitFlag, int nextFlag, String str) {\n        for (int i = 0; i \u003c loopNumber; i++) {\n            synchronized (this) {\n\t            // é˜²æ­¢è™šå‡å”¤é†’ï¼Œç”¨å¾ªç¯\n                while (this.flag != waitFlag) {\n                    try {\n                        this.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                System.out.print(str);\n                flag = nextFlag;\n                // å”¤é†’æ‰€æœ‰å…¶å®ƒçº¿ç¨‹\n                this.notifyAll();\n            }\n        }\n    }\n}\n```\n\n```java\nSyncWaitNotify syncWaitNotify = new SyncWaitNotify(1, 5);\nnew Thread(() -\u003e {\n    syncWaitNotify.print(1, 2, \"a\");\n}).start();\nnew Thread(() -\u003e {\n    syncWaitNotify.print(2, 3, \"b\");\n}).start();\nnew Thread(() -\u003e {\n    syncWaitNotify.print(3, 1, \"c\");\n}).start();\n```\n\n### ReentrantLockæ¡ä»¶å˜é‡\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ReentrantLock|ReentrantLock]]\n\n```java\nclass AwaitSignal extends ReentrantLock {\n    public void start(Condition first) {\n        this.lock();\n        try {\n            log.debug(\"start\");\n            first.signal();\n        } finally {\n            this.unlock();\n        }\n    }\n    public void print(String str, Condition current, Condition next) {\n        for (int i = 0; i \u003c loopNumber; i++) {\n            this.lock();\n            // å›ºå®šçš„try finally unlock\n            try {\n\t            // é»˜è®¤éƒ½è¿›å…¥æ¡ä»¶å˜é‡ä¼‘çœ ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹ç”±mainçº¿ç¨‹å”¤é†’\n                current.await();\n                log.debug(str);\n                // å”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹\n                next.signal();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                this.unlock();\n            }\n        }\n    }\n \n    // å¾ªç¯æ¬¡æ•°\n    private int loopNumber;\n \n    public AwaitSignal(int loopNumber) {\n        this.loopNumber = loopNumber;\n    }\n}\n```\n\n```java\nAwaitSignal as = new AwaitSignal(5);\nCondition aWaitSet = as.newCondition();\nCondition bWaitSet = as.newCondition();\nCondition cWaitSet = as.newCondition();\n \n \nnew Thread(() -\u003e {\n    as.print(\"a\", aWaitSet, bWaitSet);\n}).start();\nnew Thread(() -\u003e {\n    as.print(\"b\", bWaitSet, cWaitSet);\n}).start();\nnew Thread(() -\u003e {\n    as.print(\"c\", cWaitSet, aWaitSet);\n}).start();\n \nas.start(aWaitSet);\n```\n\n### Park\u0026Unpark\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/park\u0026unpark|Park\u0026Unpark]]\n\n```java\nclass SyncPark {\n\n    private int loopNumber;\n    private Thread[] threads;\n \n    public SyncPark(int loopNumber) {\n        this.loopNumber = loopNumber;\n    }\n \n    public void setThreads(Thread... threads) {\n        this.threads = threads;\n    }\n \n    public void print(String str) {\n        for (int i = 0; i \u003c loopNumber; i++) {\n\t        // çº¿ç¨‹é»˜è®¤parkï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹ç”±mainçº¿ç¨‹å”¤é†’\n            LockSupport.park();\n            System.out.print(str);\n            // å”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹\n            LockSupport.unpark(nextThread());\n        }\n    }\n \n    private Thread nextThread() {\n        Thread current = Thread.currentThread();\n        int index = 0;\n        for (int i = 0; i \u003c threads.length; i++) {\n            if(threads[i] == current) {\n                index = i;\n                break;\n            }\n        }\n        if(index \u003c threads.length - 1) {\n            return threads[index+1];\n        } else {\n            return threads[0];\n        }\n    }\n \n    public void start() {\n        for (Thread thread : threads) {\n            thread.start();\n        }\n        LockSupport.unpark(threads[0]);\n    }\n}\n```\n\n```java\nSyncPark syncPark = new SyncPark(5);\nThread t1 = new Thread(() -\u003e {\n    syncPark.print(\"a\");\n});\nThread t2 = new Thread(() -\u003e {\n    syncPark.print(\"b\");\n});\nThread t3 = new Thread(() -\u003e {\n    syncPark.print(\"c\\n\");\n});\nsyncPark.setThreads(t1, t2, t3);\nsyncPark.start();\n```","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%A5%A5%E9%A5%BF":{"title":"é¥¥é¥¿","content":"# é¥¥é¥¿\n\nä¸€ä¸ªçº¿ç¨‹ç”±äºä¼˜å…ˆçº§å¤ªä½ï¼Œå§‹ç»ˆå¾—ä¸åˆ° CPU è°ƒåº¦æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½å¤Ÿç»“æŸã€‚","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/AQS":{"title":"AQS","content":"# AQS\n\n\nå…¨ç§°æ˜¯ AbstractQueuedSynchronizerï¼Œæ˜¯**é˜»å¡**å¼é”ï¼ˆç±»ä¼¼[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]]ï¼‰å’Œç›¸å…³çš„åŒæ­¥å™¨å·¥å…·çš„æ¡†æ¶ã€‚\n\n## ç‰¹ç‚¹\n\n- ç”¨ **state** å±æ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ï¼ˆåˆ†ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ï¼‰ï¼Œå­ç±»éœ€è¦å®šä¹‰å¦‚ä½•ç»´æŠ¤è¿™ä¸ªçŠ¶æ€ï¼Œæ§åˆ¶å¦‚ä½•è·å–é”å’Œé‡Šæ”¾é”\n\t- getState - è·å– state çŠ¶æ€\n\t- setState - è®¾ç½® state çŠ¶æ€\n\t- compareAndSetState - cas æœºåˆ¶è®¾ç½® state çŠ¶æ€\n\t- ç‹¬å æ¨¡å¼æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®èµ„æºï¼Œè€Œå…±äº«æ¨¡å¼å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®èµ„æº\n- æä¾›äº†åŸºäº FIFO çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç±»ä¼¼äº Monitor çš„ EntryList\n- æ¡ä»¶å˜é‡æ¥å®ç°ç­‰å¾…ã€å”¤é†’æœºåˆ¶ï¼Œæ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œç±»ä¼¼äº Monitor çš„ WaitSet\n\nå­ç±»ä¸»è¦å®ç°è¿™æ ·ä¸€äº›æ–¹æ³•ï¼ˆé»˜è®¤æŠ›å‡º UnsupportedOperationExceptionï¼‰\n- tryAcquire\n- tryRelease\n- tryAcquireShared\n- tryReleaseShared\n- isHeldExclusively\n\n\u003e è¿™é‡Œä¸ä½¿ç”¨æŠ½è±¡æ–¹æ³•çš„ç›®çš„æ˜¯ï¼šé¿å…å¼ºè¿«å­ç±»ä¸­æŠŠæ‰€æœ‰çš„æŠ½è±¡æ–¹æ³•éƒ½å®ç°ä¸€éï¼Œå‡å°‘æ— ç”¨åŠŸï¼Œè¿™æ ·å­ç±»åªéœ€è¦å®ç°è‡ªå·±å…³å¿ƒçš„æŠ½è±¡æ–¹æ³•å³å¯ï¼Œæ¯”å¦‚ Semaphore åªéœ€è¦å®ç° tryAcquire æ–¹æ³•è€Œä¸ç”¨å®ç°å…¶ä½™ä¸éœ€è¦ç”¨åˆ°çš„æ¨¡ç‰ˆæ–¹æ³•ã€‚\n\n\n### è·å–é”\n\n```java\n// å¦‚æœè·å–é”å¤±è´¥\nif (!tryAcquire(arg)) {\n    // å…¥é˜Ÿ, å¯ä»¥é€‰æ‹©é˜»å¡å½“å‰çº¿ç¨‹  park unpark\n}\n```\n\n\u003e AQSä½¿ç”¨park\u0026unparkæ¥é˜»å¡å’Œæ¢å¤çº¿ç¨‹\n\n### é‡Šæ”¾é”\n\n```java\n// å¦‚æœé‡Šæ”¾é”æˆåŠŸ\nif (tryRelease(arg)) {\n    // è®©é˜»å¡çº¿ç¨‹æ¢å¤è¿è¡Œ\n}\n```\n\n\n## è‡ªå·±å®ç°ä¸å¯é‡å…¥é”\n\nå®ç°Lock+AQSï¼š\n\n```java\npackage test;  \n  \nimport lombok.extern.slf4j.Slf4j;  \n  \nimport java.util.concurrent.TimeUnit;  \nimport java.util.concurrent.locks.AbstractQueuedSynchronizer;  \nimport java.util.concurrent.locks.Condition;  \nimport java.util.concurrent.locks.Lock;  \n  \n@Slf4j  \npublic class Test23Aqs {  \n    public static void main(String[] args) {  \n        MyLock lock = new MyLock();  \n        new Thread(()-\u003e{  \n            log.debug(\"å°è¯•åŠ é”\");  \n            lock.lock();  \n            log.debug(\"åŠ é”æˆåŠŸ\");  \n            try {  \n                log.debug(\"åŠ é”\");  \n                try {  \n                    Thread.sleep(3000);  \n                } catch (InterruptedException e) {  \n                    e.printStackTrace();  \n                }  \n            } finally {  \n                log.debug(\"è§£é”\");  \n                lock.unlock();  \n            }  \n        }).start();  \n  \n        new Thread(()-\u003e{  \n            log.debug(\"å°è¯•åŠ é”\");  \n            lock.lock();  \n            log.debug(\"åŠ é”æˆåŠŸ\");  \n            try {  \n                log.debug(\"åŠ é”\");  \n            } finally {  \n                log.debug(\"è§£é”\");  \n                lock.unlock();  \n            }  \n        }).start();  \n    }  \n}  \n  \n  \n// ä¸å¯é‡å…¥é”ï¼š  \n// ä»¿ReentrantLockå®ç°  \n// 1. å®ç°Lockæ¥å£  \n// 2. ä½¿ç”¨AQSåŒæ­¥å™¨ç±»  \nclass MyLock implements Lock {  \n  \n    // åŒæ­¥å™¨ç±»  \n    // é”çš„å¤§éƒ¨åˆ†åŠŸèƒ½æ˜¯ç”±è¯¥åŒæ­¥å™¨ç±»å®Œæˆçš„  \n    // å®ç°ä¸€ä¸ªç‹¬å é”ï¼š  \n    class MySync extends AbstractQueuedSynchronizer {  \n        // å°è¯•è·å–é”  \n        @Override  \n        protected boolean tryAcquire(int arg) {  \n            // å¯èƒ½æœ‰å…¶å®ƒçº¿ç¨‹åŒæ—¶å°è¯•åŠ é”ï¼Œæ‰€ä»¥è¦ç”¨cas  \n            if (compareAndSetState(0, 1)) {  \n                // åŠ ä¸Šé”äº†ï¼Œè®¾ç½®ownerä¸ºå½“å‰çº¿ç¨‹  \n                setExclusiveOwnerThread(Thread.currentThread());  \n                return true;            }  \n            return false;  \n        }  \n  \n        // å°è¯•é‡Šæ”¾é”  \n        @Override  \n        protected boolean tryRelease(int arg) {  \n            // è·å–äº†é”ï¼Œä¸ç”¨å†å’Œå…¶å®ƒçº¿ç¨‹ç«äº‰  \n            setExclusiveOwnerThread(null);  \n            // stateæ˜¯volatileçš„ï¼Œæ‰€ä»¥è¿™é‡Œæ”¾åœ¨æœ€åï¼Œè®©å†™å±éšœèƒ½å½±å“å‰é¢æ‰€æœ‰æ“ä½œï¼Œä¿è¯ä¹‹å‰çš„è®¾ç½®å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§  \n            setState(0);  \n            return true;        }  \n  \n        // æ˜¯å¦æŒæœ‰ç‹¬å é”  \n        @Override  \n        protected boolean isHeldExclusively() {  \n            return getState() == 1;  \n        }  \n  \n        // è¿”å›ä¸€ä¸ªæ¡ä»¶å˜é‡  \n        public Condition newCondition() {  \n            // AQSæä¾›çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨  \n            return new ConditionObject();  \n        }  \n    }  \n  \n    private MySync sync = new MySync();  \n  \n    // ä¸‹é¢çš„æŠ½è±¡æ–¹æ³•è‡ªå·±å®ç°æ¯”è¾ƒç¹ç  \n    // å°±å¯ä»¥åˆ©ç”¨åŒæ­¥å™¨ç±»ï¼ŒAQSå®ç°äº†å¤§éƒ¨åˆ†æ–¹æ³•  \n  \n    // åŠ é”ï¼ˆå°è¯•åŠ é”ï¼Œå¤±è´¥ä¼šè¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼‰  \n    @Override  \n    public void lock() {  \n        sync.acquire(1);  \n    }  \n  \n    // å¯æ‰“æ–­åŠ é”ï¼ˆåŠ é”è¿‡ç¨‹å¯æ‰“æ–­ï¼‰  \n    @Override  \n    public void lockInterruptibly() throws InterruptedException {  \n        sync.acquireInterruptibly(1);  \n    }  \n  \n    // å°è¯•åŠ é”ï¼ˆå°è¯•ä¸€æ¬¡ï¼Œå¤±è´¥ç›´æ¥è¿”å›falseï¼‰  \n    @Override  \n    public boolean tryLock() {  \n        return sync.tryAcquire(1);  \n    }  \n  \n    // å¸¦è¶…æ—¶åŠ é”  \n    @Override  \n    public boolean tryLock(long time, TimeUnit unit) throws InterruptedException {  \n        return sync.tryAcquireNanos(1, unit.toNanos(time));  \n    }  \n  \n    // è§£é”  \n    @Override  \n    public void unlock() {  \n        // è°ƒç”¨äº†tryReleaseå¹¶å”¤é†’æ­£åœ¨é˜»å¡çš„çº¿ç¨‹  \n        sync.release(1);  \n    }  \n  \n    // åˆ›å»ºæ¡ä»¶å˜é‡  \n    @Override  \n    public Condition newCondition() {  \n        return sync.newCondition();  \n    }  \n}\n```\n\n\n\n\n\n\n\n\n\n\n\n## ç®€ä»‹\n\nAQSå°±æ˜¯ä¸€ä¸ªæ”¯æŒå¤šä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]è¿›æ¥æ’é˜Ÿçš„å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŒç«¯é˜Ÿåˆ—ï¼Œé€šè¿‡è‡ªèº«è®¾è®¡æ¥å®ç°å¤šä¸ªçº¿ç¨‹åˆ°è¾¾æ€»èƒ½æŒ‰ä¸€å®šé¡ºåºè¿›å…¥é˜Ÿåˆ—ï¼Œä¸ä¼šå› ä¸ºåŒæ—¶å…¥é˜ŸæŠ¢å å‘ç”Ÿé—®é¢˜ã€‚åŒæ—¶åœ¨å¤´éƒ¨ä¿è¯æœ‰åºçš„å‘ç›®æ ‡èµ„æºè¿›è¡Œè®¿é—®ï¼ˆçº¿ç¨‹è·å–èµ„æºæƒé™ï¼‰ã€‚                    \n\n**AQS**æ˜¯`AbstractQueuedSynchronizer`çš„ç®€ç§°ï¼Œå³`æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨`ï¼Œä»å­—é¢æ„æ€ä¸Šç†è§£:\n\n- æŠ½è±¡ï¼šæŠ½è±¡ç±»ï¼Œåªå®ç°ä¸€äº›ä¸»è¦é€»è¾‘ï¼Œæœ‰äº›æ–¹æ³•ç”±å­ç±»å®ç°ï¼›\n- é˜Ÿåˆ—ï¼šä½¿ç”¨å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰é˜Ÿåˆ—å­˜å‚¨æ•°æ®ï¼›\n- åŒæ­¥ï¼šå®ç°äº†åŒæ­¥çš„åŠŸèƒ½ã€‚\n\nAQSæ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼Œä½¿ç”¨AQSèƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºåº”ç”¨å¹¿æ³›çš„åŒæ­¥å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬æåˆ°çš„ReentrantLockï¼ŒSemaphoreï¼ŒReentrantReadWriteLockï¼ŒSynchronousQueueï¼ŒFutureTaskç­‰ç­‰çš†æ˜¯åŸºäºAQSçš„ã€‚\n\nå½“ç„¶ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿèƒ½åˆ©ç”¨AQSéå¸¸è½»æ¾å®¹æ˜“åœ°æ„é€ å‡ºç¬¦åˆæˆ‘ä»¬è‡ªå·±éœ€æ±‚çš„åŒæ­¥å™¨ï¼Œåªè¦å­ç±»å®ç°å®ƒçš„å‡ ä¸ª`protected`æ–¹æ³•å°±å¯ä»¥ã€‚\n\n## AQSçš„æ•°æ®ç»“æ„\n\nAQSå†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]]çš„å˜é‡stateæ¥ä½œä¸ºèµ„æºçš„æ ‡è¯†ã€‚åŒæ—¶å®šä¹‰äº†å‡ ä¸ªè·å–å’Œæ”¹å˜stateçš„protectedæ–¹æ³•ï¼Œå­ç±»å¯ä»¥è¦†ç›–è¿™äº›æ–¹æ³•æ¥å®ç°è‡ªå·±çš„é€»è¾‘ï¼š\n\n```java\ngetState()\nsetState()\ncompareAndSetState()\n```\n\nè¿™ä¸‰ç§æ“ä½œå‡æ˜¯åŸå­æ“ä½œï¼Œå…¶ä¸­compareAndSetStateçš„å®ç°ä¾èµ–äºUnsafeçš„compareAndSwapInt()æ–¹æ³•ã€‚\n\nè€ŒAQSç±»æœ¬èº«å®ç°çš„æ˜¯**ä¸€äº›æ’é˜Ÿå’Œé˜»å¡çš„æœºåˆ¶**ï¼Œæ¯”å¦‚å…·ä½“çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—çš„ç»´æŠ¤ï¼ˆå¦‚è·å–èµ„æºå¤±è´¥å…¥é˜Ÿ/å”¤é†’å‡ºé˜Ÿç­‰ï¼‰ã€‚\n\n1. å†…éƒ¨å¯ä»¥æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŒç«¯é˜Ÿåˆ—ï¼ˆCLHé˜Ÿåˆ—ï¼Œï¼ˆCraig, Landin, and Hagersten é˜Ÿåˆ—ï¼‰ï¼‰ï¼Œå¹¶ä½¿ç”¨äº†ä¸¤ä¸ªæŒ‡é’ˆheadå’Œtailç”¨äºæ ‡è¯†é˜Ÿåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨ã€‚å…¶æ•°æ®ç»“æ„å¦‚å›¾ï¼š\n![[z-oblib/z2-attachments/AQSæ•°æ®ç»“æ„.png]]\nä½†å®ƒå¹¶ä¸æ˜¯ç›´æ¥å‚¨å­˜çº¿ç¨‹ï¼Œè€Œæ˜¯**å‚¨å­˜æ‹¥æœ‰çº¿ç¨‹çš„NodeèŠ‚ç‚¹**ï¼Œå› ä¸ºæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨çš„ç»“æ„ï¼Œæ‰€ä»¥æœ€å°å•å…ƒæ˜¯Nodeï¼ŒNodeä¼šåŒ…å«å‰åèŠ‚ç‚¹çš„åœ°å€ï¼Œè¿˜åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ã€‚\n\n2. ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå€ŸåŠ©nextWaiterï¼ˆè§åç»­ç« èŠ‚ï¼‰å®ç°çš„å•å‘é˜Ÿåˆ—ã€‚\n\n### èµ„æºå…±äº«æ¨¡å¼\n\n\u003e ä¸€å †çº¿ç¨‹åœ¨æ’é˜Ÿç­‰å¾…èµ„æºï¼Œä½†èµ„æºå¯ä»¥åŒæ—¶åªç»™ä¸€ä¸ªçº¿ç¨‹ç”¨ï¼Œæˆ–è€…æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶ç”¨ã€‚\n\nèµ„æºæœ‰ä¸¤ç§å…±äº«æ¨¡å¼ï¼Œæˆ–è€…è¯´ä¸¤ç§åŒæ­¥æ–¹å¼ï¼š\n\n- ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰ï¼šèµ„æºæ˜¯ç‹¬å çš„ï¼Œä¸€æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è·å–ã€‚å¦‚ReentrantLockã€‚\n- å…±äº«æ¨¡å¼ï¼ˆShareï¼‰ï¼šåŒæ—¶å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹è·å–ï¼Œå…·ä½“çš„èµ„æºä¸ªæ•°å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šã€‚å¦‚Semaphore/CountDownLatchã€‚\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå­ç±»åªéœ€è¦æ ¹æ®éœ€æ±‚å®ç°å…¶ä¸­ä¸€ç§æ¨¡å¼ï¼Œå½“ç„¶ä¹Ÿæœ‰åŒæ—¶å®ç°ä¸¤ç§æ¨¡å¼çš„åŒæ­¥ç±»ï¼Œå¦‚`ReadWriteLock`ã€‚\n\n### Nodeç»“æ„\n\nAQSä¸­å…³äºè¿™ä¸¤ç§èµ„æºå…±äº«æ¨¡å¼çš„å®šä¹‰æºç ï¼ˆå‡åœ¨å†…éƒ¨ç±»Nodeä¸­ï¼‰ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹**Nodeçš„ç»“æ„**ï¼š\n\n```java\nstatic final class Node {\n    // æ ‡è®°ä¸€ä¸ªç»“ç‚¹ï¼ˆå¯¹åº”çš„çº¿ç¨‹ï¼‰åœ¨å…±äº«æ¨¡å¼ä¸‹ç­‰å¾…\n    static final Node SHARED = new Node();\n    // æ ‡è®°ä¸€ä¸ªç»“ç‚¹ï¼ˆå¯¹åº”çš„çº¿ç¨‹ï¼‰åœ¨ç‹¬å æ¨¡å¼ä¸‹ç­‰å¾…\n    static final Node EXCLUSIVE = null; \n\n    // waitStatusçš„å€¼ï¼Œè¡¨ç¤ºè¯¥ç»“ç‚¹ï¼ˆå¯¹åº”çš„çº¿ç¨‹ï¼‰å·²è¢«å–æ¶ˆ\n    static final int CANCELLED = 1; \n    // waitStatusçš„å€¼ï¼Œè¡¨ç¤ºåç»§ç»“ç‚¹ï¼ˆå¯¹åº”çš„çº¿ç¨‹ï¼‰éœ€è¦è¢«å”¤é†’\n    static final int SIGNAL = -1;\n    // waitStatusçš„å€¼ï¼Œè¡¨ç¤ºè¯¥ç»“ç‚¹ï¼ˆå¯¹åº”çš„çº¿ç¨‹ï¼‰åœ¨ç­‰å¾…æŸä¸€æ¡ä»¶\n    static final int CONDITION = -2;\n    /*waitStatusçš„å€¼ï¼Œè¡¨ç¤ºæœ‰èµ„æºå¯ç”¨ï¼Œæ–°headç»“ç‚¹éœ€è¦ç»§ç»­å”¤é†’åç»§ç»“ç‚¹ï¼ˆå…±äº«æ¨¡å¼ä¸‹ï¼Œå¤šçº¿ç¨‹å¹¶å‘é‡Šæ”¾èµ„æºï¼Œè€Œheadå”¤é†’å…¶åç»§ç»“ç‚¹åï¼Œéœ€è¦æŠŠå¤šå‡ºæ¥çš„èµ„æºç•™ç»™åé¢çš„ç»“ç‚¹ï¼›è®¾ç½®æ–°çš„headç»“ç‚¹æ—¶ï¼Œä¼šç»§ç»­å”¤é†’å…¶åç»§ç»“ç‚¹ï¼‰*/\n    static final int PROPAGATE = -3;\n\n    // ç­‰å¾…çŠ¶æ€ï¼Œå–å€¼èŒƒå›´ï¼Œ-3ï¼Œ-2ï¼Œ-1ï¼Œ0ï¼Œ1\n    volatile int waitStatus;\n    volatile Node prev; // å‰é©±ç»“ç‚¹\n    volatile Node next; // åç»§ç»“ç‚¹\n    volatile Thread thread; // ç»“ç‚¹å¯¹åº”çš„çº¿ç¨‹\n    Node nextWaiter; // åœ¨CLHé˜Ÿåˆ—æ—¶ï¼Œè¡¨ç¤ºå…±äº«å¼æˆ–ç‹¬å å¼æ ‡è®°ï¼Œåœ¨æ¡ä»¶é˜Ÿåˆ—æ—¶ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªNodeèŠ‚ç‚¹\n\n\n    // åˆ¤æ–­å…±äº«æ¨¡å¼çš„æ–¹æ³•\n    final boolean isShared() {\n        return nextWaiter == SHARED;\n    }\n\n    Node(Thread thread, Node mode) {     // Used by addWaiter\n        this.nextWaiter = mode;\n        this.thread = thread;\n    }\n\n    // å…¶å®ƒæ–¹æ³•å¿½ç•¥ï¼Œå¯ä»¥å‚è€ƒå…·ä½“çš„æºç \n}\n\n// AQSé‡Œé¢çš„addWaiterç§æœ‰æ–¹æ³•\nprivate Node addWaiter(Node mode) {\n    // ä½¿ç”¨äº†Nodeçš„è¿™ä¸ªæ„é€ å‡½æ•°\n    Node node = new Node(Thread.currentThread(), mode);\n    // å…¶å®ƒä»£ç çœç•¥\n}\n```\n\næ³¨æ„ï¼šé€šè¿‡Nodeæˆ‘ä»¬å¯ä»¥å®ç°ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€æ˜¯é€šè¿‡prevå’Œnextå®ç°CLHé˜Ÿåˆ—(çº¿ç¨‹åŒæ­¥é˜Ÿåˆ—,åŒå‘é˜Ÿåˆ—)ï¼ŒäºŒæ˜¯nextWaiterå®ç°Conditionæ¡ä»¶ä¸Šçš„ç­‰å¾…çº¿ç¨‹é˜Ÿåˆ—(å•å‘é˜Ÿåˆ—)ï¼Œè¿™ä¸ªConditionä¸»è¦ç”¨åœ¨ReentrantLockç±»ä¸­ã€‚\n\nwaitStatusç­‰å¾…çŠ¶æ€å¦‚ä¸‹ï¼š\n![[z-oblib/z2-attachments/103e67d0d59543c4acfd4d0345dabfec.png]]\n\nÂ **nextWaiterç‰¹æ®Šæ ‡è®°**ï¼š\n- Nodeåœ¨CLHé˜Ÿåˆ—æ—¶ï¼ŒnextWaiterè¡¨ç¤ºå…±äº«å¼æˆ–ç‹¬å å¼æ ‡è®°ï¼›\n- Nodeåœ¨æ¡ä»¶é˜Ÿåˆ—æ—¶ï¼ŒnextWaiterè¡¨ç¤ºä¸‹ä¸ªNodeèŠ‚ç‚¹æŒ‡é’ˆï¼›\n\n## AQSçš„ä¸»è¦æ–¹æ³•æºç è§£æ\n\nAQSçš„è®¾è®¡æ˜¯åŸºäº[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/æ¨¡æ¿æ¨¡å¼|æ¨¡æ¿æ¨¡å¼]]çš„ï¼Œå®ƒæœ‰ä¸€äº›æ–¹æ³•å¿…é¡»è¦å­ç±»å»å®ç°çš„ï¼Œå®ƒä»¬ä¸»è¦æœ‰ï¼š\n\n- isHeldExclusively()ï¼šè¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚\n- tryAcquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚\n- tryRelease(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚\n- tryAcquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚\n- tryReleaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚\n\n\u003e å­ç±»éœ€è¦å®ç°åœ¨ç‹¬å /å…±äº«æ¨¡å¼ä¸‹å¯¹èµ„æºçš„è·å–å’Œé‡Šæ”¾çš„æœ‰é’ˆå¯¹æ€§åœ°é€»è¾‘éƒ¨åˆ†ã€‚\n\nè¿™äº›æ–¹æ³•è™½ç„¶éƒ½æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/0-è¯­æ³•åŸºç¡€/è®¿é—®æ§åˆ¶ç¬¦#protected|protected]]æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰åœ¨AQSå…·ä½“å®ç°ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼ˆè¿™é‡Œä¸ä½¿ç”¨æŠ½è±¡æ–¹æ³•çš„ç›®çš„æ˜¯ï¼šé¿å…å¼ºè¿«å­ç±»ä¸­æŠŠæ‰€æœ‰çš„æŠ½è±¡æ–¹æ³•éƒ½å®ç°ä¸€éï¼Œå‡å°‘æ— ç”¨åŠŸï¼Œè¿™æ ·å­ç±»åªéœ€è¦å®ç°è‡ªå·±å…³å¿ƒçš„æŠ½è±¡æ–¹æ³•å³å¯ï¼Œæ¯”å¦‚ Semaphore åªéœ€è¦å®ç° tryAcquire æ–¹æ³•è€Œä¸ç”¨å®ç°å…¶ä½™ä¸éœ€è¦ç”¨åˆ°çš„æ¨¡ç‰ˆæ–¹æ³•ï¼‰ï¼š\n\n\u003e è€ŒAQSå®ç°äº†ä¸€ç³»åˆ—ï¼ˆåŒ…æ‹¬èµ„æº/é‡Šæ”¾ï¼‰ä¸»è¦çš„é€»è¾‘ã€‚\n\n### çº¿ç¨‹æ’é˜Ÿ\n\nè·å–èµ„æºçš„å…¥å£æ˜¯acquire(int arg)æ–¹æ³•ã€‚argæ˜¯è¦è·å–çš„èµ„æºçš„ä¸ªæ•°ï¼Œåœ¨ç‹¬å æ¨¡å¼ä¸‹å§‹ç»ˆä¸º1ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„é€»è¾‘ï¼š\n\n```java\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) \u0026\u0026\n        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n```\n\né¦–å…ˆè°ƒç”¨tryAcquire(arg)å°è¯•å»è·å–èµ„æºã€‚å‰é¢æåˆ°äº†è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å­ç±»å…·ä½“å®ç°çš„ã€‚\n\nå¦‚æœè·å–èµ„æºå¤±è´¥ï¼Œå°±é€šè¿‡addWaiter(Node.EXCLUSIVE)æ–¹æ³•æŠŠè¿™ä¸ªçº¿ç¨‹æ’å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚å…¶ä¸­ä¼ å…¥çš„å‚æ•°ä»£è¡¨è¦æ’å…¥çš„Nodeæ˜¯ç‹¬å å¼çš„ã€‚è¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š\n\n```java\nprivate Node addWaiter(Node mode) {\n    // ç”Ÿæˆè¯¥çº¿ç¨‹å¯¹åº”çš„NodeèŠ‚ç‚¹\n    Node node = new Node(Thread.currentThread(), mode);\n    // è·å–å°¾èŠ‚ç‚¹\n    Node pred = tail;\n    // å¦‚æœå‰é¢è¿˜æœ‰å…¶å®ƒèŠ‚ç‚¹\n    if (pred != null) {\n\t    // å°†å½“å‰èŠ‚ç‚¹åœ°å‰é©±èŠ‚ç‚¹è®¾ç½®ä¸ºé˜Ÿå°¾èŠ‚ç‚¹\n        node.prev = pred;\n        // ä½¿ç”¨CASå°è¯•å°†åç»§èŠ‚ç‚¹ä¿¡æ¯å†™å…¥é˜Ÿå°¾èŠ‚ç‚¹ï¼Œå¦‚æœæˆåŠŸå°±è¿”å›\n        // ä½¿ç”¨CASæ˜¯ä¸ºäº†å¤„ç†å¤šä¸ªçº¿ç¨‹åŒæ—¶æƒ³æ’é˜Ÿçš„æƒ…å†µ\n        if (compareAndSetTail(pred, node)) {\n            pred.next = node;\n            return node;\n        }\n    }\n    // å¦‚æœç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…ä¸Šè¿°CASå¤±è´¥ï¼Œå†è‡ªæ—‹CASæ’å…¥\n    enq(node);\n    return node;\n}\n\n// è‡ªæ—‹CASæ’å…¥ç­‰å¾…é˜Ÿåˆ—\nprivate Node enq(final Node node) {\n    for (;;) {\n        Node t = tail;\n        // å¦‚æœç­‰å¾…é˜Ÿåˆ—ä¸ºç©º\n        if (t == null) { // Must initialize\n\t        // åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ä½œä¸ºå¤´èŠ‚ç‚¹ï¼ˆå“¨å…µèŠ‚ç‚¹ï¼‰\n            if (compareAndSetHead(new Node()))\n\t            // å¹¶æŠŠé˜Ÿå°¾æŒ‡å‘é˜Ÿé¦–ï¼ŒåŠé˜Ÿä¼ä¸­ç°åœ¨åªæœ‰ä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œé˜Ÿé¦–é˜Ÿå°¾éƒ½æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹\n                tail = head;\n        // ç­‰å¾…é˜Ÿåˆ—ä¸ä¸ºç©º\n        } else {\n\t        // ä½¿ç”¨CASå°è¯•å°†åç»§èŠ‚ç‚¹ä¿¡æ¯å†™å…¥é˜Ÿå°¾èŠ‚ç‚¹ï¼Œå’Œä¹‹å‰å‡½æ•°ä¸€æ ·ï¼Œä¸è¿‡è¿™é‡Œæ˜¯åœ¨å¾ªç¯é‡Œä¸€ç›´å»å°è¯•\n            node.prev = t;\n            if (compareAndSetTail(t, node)) {\n                t.next = node;\n                return t;\n            }\n        }\n    }\n}\n```\n\n\u003eä¸Šé¢çš„ä¸¤ä¸ªå‡½æ•°æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯åœ¨é˜Ÿåˆ—çš„å°¾éƒ¨æ’å…¥æ–°çš„NodeèŠ‚ç‚¹ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ç”±äºAQSä¸­ä¼šå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶äº‰å¤ºèµ„æºçš„æƒ…å†µï¼Œå› æ­¤è‚¯å®šä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶æ’å…¥èŠ‚ç‚¹çš„æ“ä½œï¼Œåœ¨è¿™é‡Œæ˜¯é€šè¿‡CASè‡ªæ—‹çš„æ–¹å¼ä¿è¯äº†æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ã€‚\n\n### è·å–èµ„æº\n\nOKï¼Œç°åœ¨å›åˆ°æœ€å¼€å§‹çš„aquire(int arg)æ–¹æ³•ã€‚ç°åœ¨é€šè¿‡addWaiteræ–¹æ³•ï¼Œå·²ç»æŠŠä¸€ä¸ªNodeæ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—å°¾éƒ¨äº†ã€‚è€Œç­‰å¾…é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹è·å–èµ„æºï¼Œè€Œé˜Ÿåˆ—ä¸­èŠ‚ç‚¹ä¼šä¾æ¬¡æˆä¸ºå¤´èŠ‚ç‚¹ã€‚å…·ä½“çš„å®ç°æˆ‘ä»¬æ¥çœ‹çœ‹acquireQueuedæ–¹æ³•ï¼š\n\n```java\nfinal boolean acquireQueued(final Node node, int arg) {\n    boolean failed = true;\n    try {\n\t    // è®¾ç½®ä¸­æ–­çŠ¶æ€ä¸ºéä¸­æ–­\n        boolean interrupted = false;\n        // è‡ªæ—‹\n        for (;;) {\n            final Node p = node.predecessor();\n            // é˜Ÿé¦–èŠ‚ç‚¹æ˜¯å½“å‰å·²ç»è·å–åˆ°èµ„æºçš„ç»“ç‚¹æˆ–nullï¼Œé‚£ä¹ˆæ’åœ¨ç¬¬äºŒä¸ªä½ç½®çš„èŠ‚ç‚¹ä¼šå¾ªç¯å°è¯•è·å–èµ„æº\n            // å¦‚æœnodeçš„å‰é©±ç»“ç‚¹pæ˜¯headï¼Œè¡¨ç¤ºnodeæ˜¯ç¬¬äºŒä¸ªç»“ç‚¹ï¼Œå°±å¯ä»¥å°è¯•å»è·å–èµ„æºäº†\n            if (p == head \u0026\u0026 tryAcquire(arg)) {\n                // æ‹¿åˆ°èµ„æºåï¼Œè¯´æ˜ä¹‹å‰çš„å¤´èŠ‚ç‚¹é‡Šæ”¾èµ„æºäº†ï¼Œå°†headæŒ‡å‘å½“å‰èŠ‚ç‚¹ï¼ŒæŠŠå‰ä»»é˜Ÿé¦–è¸¢å‡ºé˜Ÿä¼ã€‚\n                setHead(node); \n                p.next = null; // æ¸…ç©ºä¸Šä¸€ä»»å¤´èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¸®åŠ©JVMå›æ”¶åƒåœ¾\n                failed = false;\n                return interrupted;\n            }\n            // å¤šæ¬¡æ²¡è·å–åˆ°é”ï¼Œå¯ä»¥ä¼‘æ¯äº†ï¼Œå°±è¿›å…¥waitingçŠ¶æ€ï¼Œç›´åˆ°è¢«unpark()\n            if (shouldParkAfterFailedAcquire(p, node) \u0026\u0026\n                parkAndCheckInterrupt())\n                interrupted = true;\n        }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n```\n\n\u003e è¿™é‡ŒparkAndCheckInterruptæ–¹æ³•å†…éƒ¨ä½¿ç”¨åˆ°äº†LockSupport.park(this)ï¼Œé¡ºä¾¿ç®€å•ä»‹ç»ä¸€ä¸‹parkã€‚\n\u003e \n\u003e LockSupportç±»æ˜¯Java 6 å¼•å…¥çš„ä¸€ä¸ªç±»ï¼Œæä¾›äº†åŸºæœ¬çš„çº¿ç¨‹åŒæ­¥åŸè¯­ã€‚LockSupportå®é™…ä¸Šæ˜¯è°ƒç”¨äº†Unsafeç±»é‡Œçš„å‡½æ•°ï¼Œå½’ç»“åˆ°Unsafeé‡Œï¼Œåªæœ‰ä¸¤ä¸ªå‡½æ•°ï¼š\n\u003e \n\u003e -   park(boolean isAbsolute, long time)ï¼šé˜»å¡å½“å‰çº¿ç¨‹\n\u003e -   unpark(Thread jthread)ï¼šä½¿ç»™å®šçš„çº¿ç¨‹åœæ­¢é˜»å¡\n\næ‰€ä»¥**ç»“ç‚¹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—åï¼Œæ˜¯è°ƒç”¨parkä½¿å®ƒè¿›å…¥é˜»å¡çŠ¶æ€çš„ã€‚åªæœ‰å¤´ç»“ç‚¹çš„çº¿ç¨‹æ˜¯å¤„äºæ´»è·ƒçŠ¶æ€çš„**ã€‚\n\nå½“ç„¶ï¼Œè·å–èµ„æºçš„æ–¹æ³•é™¤äº†acquireå¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š\n- acquireInterruptiblyï¼šç”³è¯·å¯ä¸­æ–­çš„èµ„æºï¼ˆç‹¬å æ¨¡å¼ï¼‰\n- acquireSharedï¼šç”³è¯·å…±äº«æ¨¡å¼çš„èµ„æº\n- acquireSharedInterruptiblyï¼šç”³è¯·å¯ä¸­æ–­çš„èµ„æºï¼ˆå…±äº«æ¨¡å¼ï¼‰\n\n\u003e å¯ä¸­æ–­çš„æ„æ€æ˜¯ï¼Œåœ¨çº¿ç¨‹ä¸­æ–­æ—¶å¯èƒ½ä¼šæŠ›å‡º`InterruptedException`ã€‚\n\n![[z-oblib/z2-attachments/acquireæµç¨‹.png]]\n\n###  é‡Šæ”¾èµ„æº\n\n```java\npublic final boolean release(int arg) {\n    if (tryRelease(arg)) {\n        Node h = head;\n        if (h != null \u0026\u0026 h.waitStatus != 0)\n            unparkSuccessor(h);\n        return true;\n    }\n    return false;\n}\n\n// ä¼ å…¥çš„å‚æ•°æ˜¯å¤´èŠ‚ç‚¹\nprivate void unparkSuccessor(Node node) {\n    // å¦‚æœçŠ¶æ€æ˜¯è´Ÿæ•°ï¼Œå°è¯•æŠŠå®ƒè®¾ç½®ä¸º0\n    int ws = node.waitStatus;\n    if (ws \u003c 0)\n        compareAndSetWaitStatus(node, ws, 0);\n    // å¾—åˆ°å¤´ç»“ç‚¹çš„åç»§ç»“ç‚¹head.next\n    Node s = node.next;\n    // å¦‚æœè¿™ä¸ªåç»§ç»“ç‚¹ä¸ºç©ºæˆ–è€…çŠ¶æ€å¤§äº0\n    // é€šè¿‡å‰é¢çš„å®šä¹‰æˆ‘ä»¬çŸ¥é“ï¼Œå¤§äº0åªæœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯è¿™ä¸ªç»“ç‚¹å·²è¢«å–æ¶ˆ\n    if (s == null || s.waitStatus \u003e 0) {\n        s = null;  // èŠ‚ç‚¹è¢«å–æ¶ˆåˆ™æŠŠèŠ‚ç‚¹åˆ æ‰\n        // ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰è¿˜æœ‰ç”¨çš„ç»“ç‚¹ï¼Œéƒ½å‘å‰ç§»åŠ¨\n        // ä»é˜Ÿå°¾å‘å‰éå†ï¼Œå–æœ€é è¿‘é˜Ÿé¦–çš„æœªå–æ¶ˆèŠ‚ç‚¹\n        for (Node t = tail; t != null \u0026\u0026 t != node; t = t.prev)\n            if (t.waitStatus \u003c= 0)\n                s = t;\n    }\n    // å¦‚æœåç»§ç»“ç‚¹ä¸ä¸ºç©ºï¼Œ\n    if (s != null)\n        LockSupport.unpark(s.thread);\n}\n```\n\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CAS":{"title":"CAS","content":"# CAS\n\n\n## åŸç†\n\nCAS çš„åº•å±‚æ˜¯ lock cmpxchg æŒ‡ä»¤ï¼ˆX86 æ¶æ„ï¼‰ï¼Œåœ¨å•æ ¸ CPU å’Œå¤šæ ¸ CPU ä¸‹éƒ½èƒ½å¤Ÿä¿è¯ã€æ¯”è¾ƒ-äº¤æ¢ã€‘çš„åŸå­æ€§ã€‚\n\nåœ¨å¤šæ ¸çŠ¶æ€ä¸‹ï¼ŒæŸä¸ªæ ¸æ‰§è¡Œåˆ°å¸¦ lock çš„æŒ‡ä»¤æ—¶ï¼ŒCPU ä¼šè®©**æ€»çº¿é”ä½**ï¼Œå½“è¿™ä¸ªæ ¸æŠŠæ­¤æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå†å¼€å¯æ€»çº¿ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šè¢«çº¿ç¨‹çš„è°ƒåº¦æœºåˆ¶æ‰€æ‰“æ–­ï¼Œä¿è¯äº†å¤šä¸ªçº¿ç¨‹å¯¹å†…å­˜æ“ä½œçš„å‡†ç¡®æ€§ï¼Œæ˜¯åŸå­çš„ã€‚\n\n## CASåº”ç”¨\n\njavaä¸­ï¼šä¸volatileé…åˆå®ç°ä¹è§‚é”ã€‚\n\n## CASä¸ºä»€ä¹ˆèƒ½ä¿è¯åŸå­æ“ä½œå‘ï¼Ÿ\n\nè¿™ä¸ªå°±å…³ç³»åˆ°äº†CASåº•å±‚æ‰€ç”¨åˆ°çš„Unsafeç±»ï¼ŒUnsafeæ˜¯CASçš„æ ¸å¿ƒç±»ï¼Œç”±äºJavaæ–¹æ³•æ— æ³•ç›´æ¥è®¿é—®åº•å±‚ç³»ç»Ÿï¼Œéœ€è¦é€šè¿‡æœ¬åœ°(native)æ–¹æ³•æ¥è®¿é—®ï¼ŒUnsafeç›¸å½“äºä¸€ä¸ªåé—¨ï¼ŒåŸºäºè¯¥ç±»å¯ä»¥ç›´æ¥æ“ä½œç‰¹å®šå†…å­˜çš„æ•°æ®ã€‚Unsafeç±»å­˜åœ¨äºsun.miscåŒ…ä¸­ï¼Œå…¶å†…éƒ¨æ–¹æ³•æ“ä½œå¯ä»¥åƒCçš„æŒ‡é’ˆä¸€æ ·ç›´æ¥æ“ä½œå†…å­˜ï¼Œå› ä¸ºJavaä¸­CASæ“ä½œçš„æ‰§è¡Œä¾èµ–äºUnsafeç±»çš„æ–¹æ³•ã€‚\n\n## ç‰¹ç‚¹\n\n- ç»“åˆ CAS å’Œ volatile å¯ä»¥å®ç°æ— é”å¹¶å‘ï¼Œé€‚ç”¨äº**çº¿ç¨‹æ•°å°‘**ã€**å¤šæ ¸ CPU** çš„åœºæ™¯ä¸‹ã€‚\n\t- CAS æ˜¯åŸºäºä¹è§‚é”çš„æ€æƒ³ï¼šæœ€ä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œå°±ç®—æ”¹äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘åƒäºç‚¹å†é‡è¯•å‘—ã€‚\n\t- synchronized æ˜¯åŸºäºæ‚²è§‚é”çš„æ€æƒ³ï¼šæœ€æ‚²è§‚çš„ä¼°è®¡ï¼Œå¾—é˜²ç€å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œæˆ‘ä¸Šäº†é”ä½ ä»¬éƒ½åˆ«æƒ³æ”¹ï¼Œæˆ‘æ”¹å®Œäº†è§£å¼€é”ï¼Œä½ ä»¬æ‰æœ‰æœºä¼šã€‚\n\t- CAS ä½“ç°çš„æ˜¯æ— é”å¹¶å‘ã€æ— é˜»å¡å¹¶å‘ï¼Œè¯·ä»”ç»†ä½“ä¼šè¿™ä¸¤å¥è¯çš„æ„æ€\n\t\t- å› ä¸ºæ²¡æœ‰ä½¿ç”¨ synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡ï¼Œè¿™æ˜¯æ•ˆç‡æå‡çš„å› ç´ ä¹‹ä¸€\n\t\t- ä½†å¦‚æœç«äº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆç‡ä¼šå—å½±å“","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CAS%E4%B8%8Evolatile":{"title":"CASä¸volatile","content":"# CASä¸volatile\n\n\n## ç”¨ä¾‹\n\nAtomicInteger çš„è§£å†³æ–¹æ³•ï¼Œå†…éƒ¨å¹¶æ²¡æœ‰ç”¨é”æ¥ä¿æŠ¤å…±äº«[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å˜é‡çš„çº¿ç¨‹å®‰å…¨|å˜é‡çš„çº¿ç¨‹å®‰å…¨]]ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ\n\n```java\npublic void withdraw(Integer amount) {\n    while(true) {\n        // éœ€è¦ä¸æ–­å°è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢\n        while (true) {\n            // æ¯”å¦‚æ‹¿åˆ°äº†æ—§å€¼ 1000\n            int prev = balance.get();\n            // åœ¨è¿™ä¸ªåŸºç¡€ä¸Š 1000-10 = 990\n            int next = prev - amount;\n            /*\n        compareAndSet æ­£æ˜¯åšè¿™ä¸ªæ£€æŸ¥ï¼Œåœ¨ set å‰ï¼Œå…ˆæ¯”è¾ƒ prev ä¸å½“å‰å€¼\n        - ä¸ä¸€è‡´äº†ï¼Œnext ä½œåºŸï¼Œè¿”å› false è¡¨ç¤ºå¤±è´¥\n           æ¯”å¦‚ï¼Œåˆ«çš„çº¿ç¨‹å·²ç»åšäº†å‡æ³•ï¼Œå½“å‰å€¼å·²ç»è¢«å‡æˆäº† 990\n           é‚£ä¹ˆæœ¬[[2_0_2-è®¡ç®—æœºç§‘å­¦/2_0_2_1_2_3-è½¯ä»¶ç³»ç»Ÿ/2_0_2_1_2_3_1-æ“ä½œç³»ç»Ÿ/çº¿ç¨‹|çº¿ç¨‹]]çš„è¿™æ¬¡ 990 å°±ä½œåºŸäº†ï¼Œè¿›å…¥ while ä¸‹æ¬¡å¾ªç¯é‡è¯•\n        - ä¸€è‡´ï¼Œä»¥ next è®¾ç½®ä¸ºæ–°å€¼ï¼Œè¿”å› true è¡¨ç¤ºæˆåŠŸ\n\n        */\n        if (balance.compareAndSet(prev, next)) {\n                break;\n            }\n        }\n    }\n}\n```\n\nå…¶ä¸­çš„å…³é”®æ˜¯ compareAndSetï¼Œå®ƒçš„ç®€ç§°å°±æ˜¯ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]] ï¼ˆä¹Ÿæœ‰ Compare And Swap çš„è¯´æ³•ï¼‰ï¼Œå®ƒå¿…é¡»æ˜¯åŸå­æ“ä½œã€‚\n![[z-oblib/z2-attachments/Pasted image 20220531231303.png]]\n\n\n### æ…¢åŠ¨ä½œåˆ†æ\n\n```java\n@Slf4j\npublic class SlowMotion {\n \n    public static void main(String[] args) {\n        AtomicInteger balance = new AtomicInteger(10000);\n        int mainPrev = balance.get();\n        log.debug(\"try get {}\", mainPrev);\n \n        new Thread(() -\u003e {\n            sleep(1000);\n            int prev = balance.get();\n            balance.compareAndSet(prev, 9000);\n            log.debug(balance.toString());\n        }, \"t1\").start();\n \n \n        sleep(2000);\n        log.debug(\"try set 8000...\");\n        boolean isSuccess = balance.compareAndSet(mainPrev, 8000);\n        log.debug(\"is success ? {}\", isSuccess);\n        if(!isSuccess){\n            mainPrev = balance.get();\n            log.debug(\"try set 8000...\");\n            isSuccess = balance.compareAndSet(mainPrev, 8000);\n            log.debug(\"is success ? {}\", isSuccess);\n        }\n \n    }\n \n \n    private static void sleep(int millis) {\n        try {\n            Thread.sleep(millis);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n## volatile\n\nè·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å¯è§æ€§|å¯è§æ€§]]ï¼Œéœ€è¦ä½¿ç”¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]] ä¿®é¥°ã€‚\nå®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­è·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æ¥æ“ä½œä¸»å­˜ã€‚å³ä¸€ä¸ªçº¿ç¨‹å¯¹ volatile å˜é‡çš„ä¿®æ”¹ï¼Œå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚\n\u003eæ³¨æ„ï¼š\n\u003evolatile ä»…ä»…ä¿è¯äº†å…±äº«å˜é‡çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å¯è§æ€§|å¯è§æ€§]]ï¼Œè®©å…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°æœ€æ–°å€¼ï¼Œä½†ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼ˆä¸èƒ½ä¿è¯åŸå­æ€§ï¼‰ã€‚\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]] å¿…é¡»å€ŸåŠ© volatile æ‰èƒ½è¯»å–åˆ°å…±äº«å˜é‡çš„æœ€æ–°å€¼æ¥å®ç°ã€æ¯”è¾ƒå¹¶äº¤æ¢ã€‘çš„æ•ˆæœã€‚\n\n## ä¸ºä»€ä¹ˆæ— é”æ•ˆç‡æ›´é«˜\n\n- æ— é”æƒ…å†µä¸‹ï¼Œå³ä½¿é‡è¯•å¤±è´¥ï¼Œçº¿ç¨‹å§‹ç»ˆåœ¨é«˜é€Ÿè¿è¡Œï¼Œæ²¡æœ‰åœæ­‡ï¼Œè€Œ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]] ä¼šè®©çº¿ç¨‹åœ¨æ²¡æœ‰è·å¾—é”çš„æ—¶å€™ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥é˜»å¡ã€‚æ‰“ä¸ªæ¯”å–»\n- çº¿ç¨‹å°±å¥½åƒé«˜é€Ÿè·‘é“ä¸Šçš„èµ›è½¦ï¼Œé«˜é€Ÿè¿è¡Œæ—¶ï¼Œé€Ÿåº¦è¶…å¿«ï¼Œä¸€æ—¦å‘ç”Ÿ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¸Šä¸‹æ–‡åˆ‡æ¢|ä¸Šä¸‹æ–‡åˆ‡æ¢]]ï¼Œå°±å¥½æ¯”èµ›è½¦è¦å‡é€Ÿã€ç†„ç«ï¼Œç­‰è¢«å”¤é†’åˆå¾—é‡æ–°æ‰“ç«ã€å¯åŠ¨ã€åŠ é€Ÿ... æ¢å¤åˆ°é«˜é€Ÿè¿è¡Œï¼Œä»£ä»·æ¯”è¾ƒå¤§\n- ä½†æ— é”æƒ…å†µä¸‹ï¼Œå› ä¸ºçº¿ç¨‹è¦ä¿æŒè¿è¡Œï¼Œéœ€è¦é¢å¤– CPU çš„æ”¯æŒï¼ŒCPU åœ¨è¿™é‡Œå°±å¥½æ¯”é«˜é€Ÿè·‘é“ï¼Œæ²¡æœ‰é¢å¤–çš„è·‘é“ï¼Œçº¿ç¨‹æƒ³é«˜é€Ÿè¿è¡Œä¹Ÿæ— ä»è°ˆèµ·ï¼Œè™½ç„¶ä¸ä¼šè¿›å…¥é˜»å¡ï¼Œä½†ç”±äºæ²¡æœ‰åˆ†åˆ°æ—¶é—´ç‰‡ï¼Œä»ç„¶ä¼šè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ï¼Œè¿˜æ˜¯ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CAS%E5%AE%9E%E7%8E%B0%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%9A%84%E4%B8%89%E5%A4%A7%E9%97%AE%E9%A2%98":{"title":"CASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜","content":"\n# CASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜\n\n## ABAé—®é¢˜\n\næ‰€è°“ABAé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œåˆå˜å›äº†Aã€‚è¿™ä¸ªæ—¶å€™ä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]æ˜¯æ£€æŸ¥ä¸å‡ºå˜åŒ–çš„ï¼Œä½†å®é™…ä¸Šå´è¢«æ›´æ–°äº†ä¸¤æ¬¡ã€‚\n\nABAé—®é¢˜çš„è§£å†³æ€è·¯æ˜¯åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Š**ç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³**ã€‚ä»JDK 1.5å¼€å§‹ï¼ŒJDKçš„atomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±»`AtomicStampedReference`ç±»æ¥è§£å†³ABAé—®é¢˜ã€‚\n\nè¿™ä¸ªç±»çš„`compareAndSet`æ–¹æ³•çš„ä½œç”¨æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœäºŒè€…éƒ½ç›¸ç­‰ï¼Œæ‰ä½¿ç”¨CASè®¾ç½®ä¸ºæ–°çš„å€¼å’Œæ ‡å¿—ã€‚\n\n```java\npublic boolean compareAndSet(V   expectedReference,\n                             V   newReference,\n                             int expectedStamp,\n                             int newStamp) {\n    Pair\u003cV\u003e current = pair;\n    return\n        expectedReference == current.reference \u0026\u0026\n        expectedStamp == current.stamp \u0026\u0026\n        ((newReference == current.reference \u0026\u0026\n          newStamp == current.stamp) ||\n         casPair(current, Pair.of(newReference, newStamp)));\n}\n```\n\n## å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§\n\nCASå¤šä¸è‡ªæ—‹ç»“åˆã€‚å¦‚æœ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/è‡ªæ—‹|è‡ªæ—‹]]CASé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå ç”¨å¤§é‡çš„CPUèµ„æºã€‚\n\nè§£å†³æ€è·¯æ˜¯è®©JVMæ”¯æŒå¤„ç†å™¨æä¾›çš„**pauseæŒ‡ä»¤**ã€‚\n\npauseæŒ‡ä»¤èƒ½è®©è‡ªæ—‹å¤±è´¥æ—¶cpuç¡çœ ä¸€å°æ®µæ—¶é—´å†ç»§ç»­è‡ªæ—‹ï¼Œä»è€Œä½¿å¾—è¯»æ“ä½œçš„é¢‘ç‡ä½å¾ˆå¤š,ä¸ºè§£å†³å†…å­˜é¡ºåºå†²çªè€Œå¯¼è‡´çš„CPUæµæ°´çº¿é‡æ’çš„ä»£ä»·ä¹Ÿä¼šå°å¾ˆå¤šã€‚\n\n## åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ\n\næœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š\n\n1. ä½¿ç”¨JDK 1.5å¼€å§‹å°±æä¾›çš„`AtomicReference`ç±»ä¿è¯å¯¹è±¡ä¹‹é—´çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/åŸå­æ€§|åŸå­æ€§]]ï¼ŒæŠŠå¤šä¸ªå˜é‡æ”¾åˆ°ä¸€ä¸ªå¯¹è±¡é‡Œé¢è¿›è¡ŒCASæ“ä½œï¼›\n2. ä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/é”|é”]]ã€‚é”å†…çš„[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/ä¸´ç•ŒåŒº|ä¸´ç•ŒåŒº]]ä»£ç å¯ä»¥ä¿è¯åªæœ‰å½“å‰[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]èƒ½æ“ä½œã€‚\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CAS%E9%94%81":{"title":"CASé”","content":"# CASé”\n\nåˆ©ç”¨åŸå­ç±»é…åˆcasæ“ä½œç»„æˆæ ‡å¿—ä½ï¼Œæ¥æ¨¡æ‹Ÿé”ï¼š\n\n```java\n// ä¸è¦ç”¨äºå®è·µï¼ï¼ï¼\npublic class LockCas {\n    private AtomicInteger state = new AtomicInteger(0);\n \n    public void lock() {\n        while (true) {\n            if (state.compareAndSet(0, 1)) {\n                break;\n            }\n        }\n    }\n \n    public void unlock() {\n        log.debug(\"unlock...\");\n        state.set(0);\n    }\n}\n```","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Callable":{"title":"Callable","content":"# Callable\n\nå¸¦è¿”å›å€¼çš„callï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚\n\n```java\npublic interface Callable\u003cV\u003e {  \n    V call() throws Exception;\n```\n\n","lastmodified":"2023-01-23T15:37:51.746680481Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ConcurrentHashMap":{"title":"ConcurrentHashMap","content":"# ConcurrentHashMap\n\n## ç”¨ä¾‹\n\nåˆ†å¸ƒå¼è®¡ç®—å­—ç¬¦ä¸²æ•°é‡ï¼š\n\n### ç”Ÿæˆæµ‹è¯•æ•°æ®\n\n```java\nstatic final String ALPHA = \"abcedfghijklmnopqrstuvwxyz\";\n \npublic static void main(String[] args) {\n    int length = ALPHA.length();\n    int count = 200;\n    List\u003cString\u003e list = new ArrayList\u003c\u003e(length * count);\n    for (int i = 0; i \u003c length; i++) {\n        char ch = ALPHA.charAt(i);\n        for (int j = 0; j \u003c count; j++) {\n            list.add(String.valueOf(ch));\n        }\n    }\n    Collections.shuffle(list);\n    for (int i = 0; i \u003c 26; i++) {\n        try (PrintWriter out = new PrintWriter(\n            new OutputStreamWriter(\n                new FileOutputStream(\"tmp/\" + (i+1) + \".txt\")))) {\n            String collect = list.subList(i * count, (i + 1) * count).stream()\n                .collect(Collectors.joining(\"\\n\"));\n            out.print(collect);\n        } catch (IOException e) {\n        }\n    }\n}\n```\n\n### æ¨¡æ¿ä»£ç \n\næ¨¡ç‰ˆä»£ç ä¸­å°è£…äº†å¤šçº¿ç¨‹è¯»å–æ–‡ä»¶çš„ä»£ç ï¼š\n\n```java\nprivate static \u003cV\u003e void demo(Supplier\u003cMap\u003cString,V\u003e\u003e supplier, \nBiConsumer\u003cMap\u003cString,V\u003e,List\u003cString\u003e\u003e consumer) {\n    Map\u003cString, V\u003e counterMap = supplier.get();\n    List\u003cThread\u003e ts = new ArrayList\u003c\u003e();\n    for (int i = 1; i \u003c= 26; i++) {\n        int idx = i;\n        Thread thread = new Thread(() -\u003e {\n            List\u003cString\u003e words = readFromFile(idx);\n            consumer.accept(counterMap, words);\n        });\n        ts.add(thread);\n    }\n \n    ts.forEach(t-\u003et.start());\n    ts.forEach(t-\u003e {\n        try {\n            t.join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n            }\n    });\n \n    System.out.println(counterMap);\n}\n \npublic static List\u003cString\u003e readFromFile(int i) {\n    ArrayList\u003cString\u003e words = new ArrayList\u003c\u003e();\n    try (BufferedReader in = new BufferedReader(new InputStreamReader(new FileInputStream(\"tmp/\" \n+ i +\".txt\")))) {\n        while(true) {\n            String word = in.readLine();\n            if(word == null) {\n                break;\n            }\n            words.add(word);\n        }\n        return words;\n    } catch (IOException e) {\n        throw new RuntimeException(e);\n    }\n}\n```\n\n### å®ç°\n\n1. æä¾›ä¸€ä¸ª map é›†åˆï¼Œç”¨æ¥å­˜æ”¾æ¯ä¸ªå•è¯çš„è®¡æ•°ç»“æœï¼Œkey ä¸ºå•è¯ï¼Œvalue ä¸ºè®¡æ•°\n2. æä¾›ä¸€ç»„æ“ä½œï¼Œä¿è¯è®¡æ•°çš„å®‰å…¨æ€§ï¼Œä¼šä¼ é€’ map é›†åˆä»¥åŠ å•è¯ List\n\n#### LongAdderå®ç°\n\nå€ŸåŠ©LongAdderå®ç°åŸå­çš„è‡ªå¢ã€‚\n\n```java\ndemo(\n    () -\u003e new ConcurrentHashMap\u003cString, LongAdder\u003e(),\n    (map, words) -\u003e {\n        for (String word : words) {\n            // æ³¨æ„ä¸èƒ½ä½¿ç”¨ putIfAbsentï¼Œæ­¤æ–¹æ³•è¿”å›çš„æ˜¯ä¸Šä¸€æ¬¡çš„ valueï¼Œé¦–æ¬¡è°ƒç”¨è¿”å› null\n            map.computeIfAbsent(word, (key) -\u003e new LongAdder()).increment();\n        }\n    }\n);\n```\n\n#### å‡½æ•°å¼ç¼–ç¨‹\n\n```java\ndemo(\n    () -\u003e new ConcurrentHashMap\u003cString, Integer\u003e(),\n    (map, words) -\u003e {\n        for (String word : words) {\n            // å‡½æ•°å¼ç¼–ç¨‹ï¼Œæ— éœ€åŸå­å˜é‡\n            map.merge(word, 1, Integer::sum);\n        }\n    }\n);\n```\n\n## æºç åˆ†æ\n\u003e JDK8æºç ã€‚\n\u003e è§£å†³HashMapçš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/HashMap#JDK7å¹¶å‘æ­»é“¾|å¹¶å‘é—®é¢˜]]ã€‚\n\n### é‡è¦å±æ€§å’Œå†…éƒ¨ç±»\n\n```java\n// é»˜è®¤ä¸º 0\n// å½“åˆå§‹åŒ–æ—¶, ä¸º -1\n// å½“æ‰©å®¹æ—¶, ä¸º -(1 + æ‰©å®¹çº¿ç¨‹æ•°)\n// å½“åˆå§‹åŒ–æˆ–æ‰©å®¹å®Œæˆåï¼Œä¸º ä¸‹ä¸€æ¬¡çš„æ‰©å®¹çš„é˜ˆå€¼å¤§å°\nprivate transient volatile int sizeCtl;\n \n// æ•´ä¸ª ConcurrentHashMap å°±æ˜¯ä¸€ä¸ª Node[]\nstatic class Node\u003cK,V\u003e implements Map.Entry\u003cK,V\u003e {}\n \n// hash è¡¨\ntransient volatile Node\u003cK,V\u003e[] table;\n \n// æ‰©å®¹æ—¶çš„ æ–° hash è¡¨\nprivate transient volatile Node\u003cK,V\u003e[] nextTable;\n \n// æ‰©å®¹æ—¶å¦‚æœæŸä¸ª bin è¿ç§»å®Œæ¯•, ç”¨ ForwardingNode ä½œä¸ºæ—§ table bin çš„å¤´ç»“ç‚¹\nstatic final class ForwardingNode\u003cK,V\u003e extends Node\u003cK,V\u003e {}\n \n// ç”¨åœ¨ compute ä»¥åŠ computeIfAbsent æ—¶, ç”¨æ¥å ä½, è®¡ç®—å®Œæˆåæ›¿æ¢ä¸ºæ™®é€š Node\nstatic final class ReservationNode\u003cK,V\u003e extends Node\u003cK,V\u003e {}\n \n// ä½œä¸º treebin çš„å¤´èŠ‚ç‚¹, å­˜å‚¨ root å’Œ first\nstatic final class TreeBin\u003cK,V\u003e extends Node\u003cK,V\u003e {}\n \n// ä½œä¸º treebin çš„èŠ‚ç‚¹, å­˜å‚¨ parent, left, right\nstatic final class TreeNode\u003cK,V\u003e extends Node\u003cK,V\u003e {}\n```\n\n### é‡è¦æ–¹æ³•\n\n```java\n// è·å– Node[] ä¸­ç¬¬ i ä¸ª Node\nstatic final \u003cK,V\u003e Node\u003cK,V\u003e tabAt(Node\u003cK,V\u003e[] tab, int i)\n    \n// cas ä¿®æ”¹ Node[] ä¸­ç¬¬ i ä¸ª Node çš„å€¼, c ä¸ºæ—§å€¼, v ä¸ºæ–°å€¼\nstatic final \u003cK,V\u003e boolean casTabAt(Node\u003cK,V\u003e[] tab, int i, Node\u003cK,V\u003e c, Node\u003cK,V\u003e v)\n    \n// ç›´æ¥ä¿®æ”¹ Node[] ä¸­ç¬¬ i ä¸ª Node çš„å€¼, v ä¸ºæ–°å€¼\nstatic final \u003cK,V\u003e void setTabAt(Node\u003cK,V\u003e[] tab, int i, Node\u003cK,V\u003e v)\n```\n\n### æ„é€ æ–¹æ³•\n\n```java\npublic ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) {\n    if (!(loadFactor \u003e 0.0f) || initialCapacity \u003c 0 || concurrencyLevel \u003c= 0)\n        throw new IllegalArgumentException();\n    if (initialCapacity \u003c concurrencyLevel)   // Use at least as many bins\n        initialCapacity = concurrencyLevel;   // as estimated threads\n    long size = (long)(1.0 + (long)initialCapacity / loadFactor);\n    // tableSizeFor ä»ç„¶æ˜¯ä¿è¯è®¡ç®—çš„å¤§å°æ˜¯ 2^n, å³ 16,32,64 ... \n    int cap = (size \u003e= (long)MAXIMUM_CAPACITY) ?\n\t    // tableSizeFor()ä¼šå°†å®é™…å¤§å°è®¾ç½®ä¸º2^n\n        MAXIMUM_CAPACITY : tableSizeFor((int)size);\n    this.sizeCtl = cap;\n}\n```\n\n### getæ–¹æ³•\n\nå…¨ç¨‹æœªåŠ é”ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜\n\u003e HashTableçš„getå…¨ç¨‹æœ‰synchronizedé”ã€‚\n\næ¡¶ä¸‹æ ‡è®¡ç®—ï¼š(n - 1) \u0026 h)ï¼Œå…¶ä¸­næ˜¯æ•°ç»„é•¿åº¦ï¼Œhæ˜¯hashå€¼ï¼Œç›¸å½“äºæ˜¯å–æ¨¡è¿ç®—ï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/0-æ•°æ®ç»“æ„ä¸ç®—æ³•/å¿«é€Ÿå–æ¨¡|å¿«é€Ÿå–æ¨¡]]ã€‚\n\n```java\npublic V get(Object key) {\n    Node\u003cK,V\u003e[] tab; Node\u003cK,V\u003e e, p; int n, eh; K ek;\n    // spread æ–¹æ³•èƒ½ç¡®ä¿è¿”å›ç»“æœæ˜¯æ­£æ•°\n    // è´Ÿæ•°åœ¨æ¥ä¸‹æ¥çš„æµç¨‹ä¸­æœ‰é¢å¤–ç”¨é€”\n    int h = spread(key.hashCode());\n    // å¦‚æœtableä¸ä¸ºç©ºå¹¶ä¸”å«æœ‰å…ƒç´ \n    if ((tab = table) != null \u0026\u0026 (n = tab.length) \u003e 0 \u0026\u0026\n\t    // æ ¹æ®æ¡¶ä¸‹æ ‡æ‰¾é“¾è¡¨\n        (e = tabAt(tab, (n - 1) \u0026 h)) != null) {\n        // å¦‚æœå¤´ç»“ç‚¹å·²ç»æ˜¯è¦æŸ¥æ‰¾çš„ key\n        if ((eh = e.hash) == h) {\n            if ((ek = e.key) == key || (ek != null \u0026\u0026 key.equals(ek)))\n                return e.val;\n        }\n        // hash ä¸ºè´Ÿæ•°è¡¨ç¤ºè¯¥ bin åœ¨æ‰©å®¹ä¸­æˆ–æ˜¯ treebin, è¿™æ—¶è°ƒç”¨ find æ–¹æ³•æ¥æŸ¥æ‰¾\n        else if (eh \u003c 0)\n            return (p = e.find(h, key)) != null ? p.val : null;\n        // æ­£å¸¸éå†é“¾è¡¨, ç”¨ equals æ¯”è¾ƒ\n        while ((e = e.next) != null) {\n            if (e.hash == h \u0026\u0026\n                ((ek = e.key) == key || (ek != null \u0026\u0026 key.equals(ek))))\n                return e.val;\n        }\n    }\n    return null;\n}\n```\n\n### putæ–¹æ³•\n\nå’Œæ™®é€šHashMapä¸åŒï¼Œè¿™é‡Œä¸å…è®¸ç©ºçš„kayå’Œvalueã€‚\næ ‘åŒ–é˜ˆå€¼æ˜¯8ã€‚\n\n```java\npublic V put(K key, V value) {\n\t// ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºé‡å¤çš„keyè¾“å…¥ï¼Œæ˜¯å¦ç”¨æ–°å€¼è¦†ç›–æ—§å€¼ï¼Œé»˜è®¤falseè¦†ç›–\n    return putVal(key, value, false);\n}\n \nfinal V putVal(K key, V value, boolean onlyIfAbsent) {\n\tæ™®é€šhashMapå…è®¸æœ‰ç©ºkeyå’Œvalueï¼Œè¿™é‡Œä¸å…è®¸\n    if (key == null || value == null) throw new NullPointerException();\n    // å…¶ä¸­ spread æ–¹æ³•ä¼šç»¼åˆé«˜ä½ä½ä½, å…·æœ‰æ›´å¥½çš„ hash æ€§\n    int hash = spread(key.hashCode());\n    int binCount = 0;\n    for (Node\u003cK,V\u003e[] tab = table;;) {\n        // f æ˜¯é“¾è¡¨å¤´èŠ‚ç‚¹\n        // fh æ˜¯é“¾è¡¨å¤´ç»“ç‚¹çš„ hash\n        // i æ˜¯é“¾è¡¨åœ¨ table ä¸­çš„ä¸‹æ ‡\n        Node\u003cK,V\u003e f; int n, i, fh;\n        // hashè¡¨ä¸ºç©ºæˆ–é•¿åº¦ä¸º0ï¼šè¦åˆ›å»º table ï¼ˆå’Œæ‡’åŠ è½½æœ‰å…³ï¼‰\n        if (tab == null || (n = tab.length) == 0)\n            // åˆå§‹åŒ– table ä½¿ç”¨äº† cas, æ— éœ€ synchronized åˆ›å»ºæˆåŠŸ, è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯\n            tab = initTable();\n        // è¦åˆ›å»ºé“¾è¡¨å¤´èŠ‚ç‚¹\n        else if ((f = tabAt(tab, i = (n - 1) \u0026 hash)) == null) {\n            // æ·»åŠ é“¾è¡¨å¤´ä½¿ç”¨äº† cas, æ— éœ€ synchronized\n            if (casTabAt(tab, i, null,\n                         new Node\u003cK,V\u003e(hash, key, value, null)))\n                break;\n        }\n        // å¸®å¿™æ‰©å®¹\n        // åˆ¤æ–­å¤´èŠ‚ç‚¹æ˜¯å¦æ˜¯forwardingNode\n        else if ((fh = f.hash) == MOVED)\n\t        // é”ä½æŸä¸ªå¾…æ‰©å®¹çš„æ¡¶ä¸­é“¾è¡¨ï¼Œå¸®å¿™æ‰©å®¹\n            // å¸®å¿™ä¹‹å, è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯\n            tab = helpTransfer(tab, f);\n        // hashTable å³æœªæ­£åœ¨æ‰©å®¹ï¼Œåˆå·²åˆå§‹åŒ–å®Œæ¯•ï¼Œå¹¶äº§ç”Ÿäº†å†²çª\n        else {\n            V oldVal = null;\n            // é”ä½é“¾è¡¨å¤´èŠ‚ç‚¹\n            // æ¡¶ä¸‹æ ‡å†²çªæ—¶æ‰ä¼šåŠ é”\n            // åªå¯¹è¯¥æ¡¶é“¾è¡¨å¤´èŠ‚ç‚¹åŠ é”\n            synchronized (f) {\n                // å†æ¬¡ç¡®è®¤é“¾è¡¨å¤´èŠ‚ç‚¹æ²¡æœ‰è¢«ç§»åŠ¨\n                if (tabAt(tab, i) == f) {\n                    // é“¾è¡¨\n                    if (fh \u003e= 0) {\n                        binCount = 1;  // é“¾è¡¨é•¿åº¦\n                        // keyæ²¡æœ‰è¦è¿½åŠ ï¼Œkeyæœ‰äº†è¦æ›´æ–°\n                        // éå†é“¾è¡¨\n                        for (Node\u003cK,V\u003e e = f;; ++binCount) {\n                            K ek;\n                            // æ‰¾åˆ°ç›¸åŒçš„ key\n                            // hashç ç›¸ç­‰ã€åŒä¸€å¯¹è±¡ã€keyå€¼ç›¸ç­‰\n                            if (e.hash == hash \u0026\u0026\n                                ((ek = e.key) == key ||\n                                 (ek != null \u0026\u0026 key.equals(ek)))) {\n                                oldVal = e.val;\n                                // æ›´æ–°value\n                                if (!onlyIfAbsent)\n                                    e.val = value;\n                                break;\n                            }\n                            Node\u003cK,V\u003e pred = e;\n                            // å·²ç»æ˜¯æœ€åçš„èŠ‚ç‚¹äº†, æ–°å¢ Node, è¿½åŠ è‡³é“¾è¡¨å°¾ \n\n                            if ((e = e.next) == null) {\n                            pred.next = new Node\u003cK,V\u003e(hash, key,\n                                                          value, null);\n                                break;\n                            }\n                        }\n                    }\n                    // çº¢é»‘æ ‘\n                    else if (f instanceof TreeBin) {\n                        Node\u003cK,V\u003e p;\n                        binCount = 2;\n                        // putTreeVal ä¼šçœ‹ key æ˜¯å¦å·²ç»åœ¨æ ‘ä¸­, æ˜¯, åˆ™è¿”å›å¯¹åº”çš„ TreeNode\n                        if ((p = ((TreeBin\u003cK,V\u003e)f).putTreeVal(hash, key,\n                                                              value)) != null) {\n                            oldVal = p.val;\n                            if (!onlyIfAbsent)\n                                p.val = value;\n                        }\n                    }\n                }\n            // é‡Šæ”¾é“¾è¡¨å¤´èŠ‚ç‚¹çš„é”\n            }\n\t        //æ ¹æ®é“¾è¡¨é•¿åº¦å†³å®šä¼˜åŒ–ç­–ç•¥ è½¬çº¢é»‘æ ‘/æ‰©å®¹\n            if (binCount != 0) {                \n                if (binCount \u003e= TREEIFY_THRESHOLD)\n                    // å¦‚æœé“¾è¡¨é•¿åº¦ \u003e= æ ‘åŒ–é˜ˆå€¼(8), è¿›è¡Œé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘\n                    treeifyBin(tab, i);\n                if (oldVal != null)\n                    return oldVal;\n                break;\n            }\n        }\n    }\n    // å¢åŠ  size è®¡æ•°\n    // ä½¿ç”¨äº†ç±»ä¼¼LongAdderçš„æ–¹å¼\n    // è¯¥æ–¹æ³•åŒ…å«äº†æ‰©å®¹çš„é€»è¾‘\n    addCount(1L, binCount);\n    return null;\n}\n\n// ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸåˆ›å»ºhashè¡¨\nprivate final Node\u003cK,V\u003e[] initTable() {\n    Node\u003cK,V\u003e[] tab; int sc;\n    // è‹¥hashè¡¨è¿˜æœªè¢«åˆ›å»º\n    while ((tab = table) == null || tab.length == 0) {\n\t    // æœ‰å…¶å®ƒçº¿ç¨‹æ­£åœ¨åˆ›å»ºhashè¡¨äº†\n        if ((sc = sizeCtl) \u003c 0)\n            Thread.yield();  // è®©å‡ºcpuä½¿ç”¨æƒï¼ˆå¼±è®©å‡ºï¼‰\n        // å°è¯•å°† sizeCtl è®¾ç½®ä¸º -1ï¼ˆ-1è¡¨ç¤ºåˆå§‹åŒ– tableï¼‰\n        else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) {\n            // è·å¾—é”, åˆ›å»º table, è¿™æ—¶å…¶å®ƒçº¿ç¨‹ä¼šåœ¨ while() å¾ªç¯ä¸­ yield ç›´è‡³ table åˆ›å»º \n            try {\n                if ((tab = table) == null || tab.length == 0) {\n\t                // ä½¿ç”¨é¢„è®¾å®¹é‡scè¿›è¡Œhashè¡¨åˆ›å»º\n\t                // é»˜è®¤å®¹é‡16\n                    int n = (sc \u003e 0) ? sc : DEFAULT_CAPACITY;\n                    Node\u003cK,V\u003e[] nt = (Node\u003cK,V\u003e[])new Node\u003c?,?\u003e[n];\n                    table = tab = nt;\n                    // scè½¬æˆä¸‹æ¬¡è¦æ‰©å®¹æ—¶çš„é˜ˆå€¼\n                    sc = n - (n \u003e\u003e\u003e 2);\n                }\n\n            } finally {\n            sizeCtl = sc;\n            }\n            break;\n        }\n    }\n    return tab;\n}\n \n// check æ˜¯ä¹‹å‰ binCount çš„ä¸ªæ•°\nprivate final void addCount(long x, int check) {\n    CounterCell[] as; long b, s;\n    if (\n        // å·²ç»æœ‰äº† counterCells, å‘ cell ç´¯åŠ \n        (as = counterCells) != null ||\n        // è¿˜æ²¡æœ‰, å‘ baseCount ç´¯åŠ \n        !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x)\n    ) {\n        CounterCell a; long v; int m;\n        boolean uncontended = true;\n        if (\n            // è¿˜æ²¡æœ‰ counterCells\n            as == null || (m = as.length - 1) \u003c 0 ||\n            // è¿˜æ²¡æœ‰ cell\n            (a = as[ThreadLocalRandom.getProbe() \u0026 m]) == null ||\n            // cell cas å¢åŠ è®¡æ•°å¤±è´¥\n            !(uncontended = U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))\n           ) {\n            // åˆ›å»ºç´¯åŠ å•å…ƒæ•°ç»„å’Œcell, ç´¯åŠ é‡è¯•\n            fullAddCount(x, uncontended);\n            return;\n        }\n        if (check \u003c= 1)\n            return;\n        // è·å–å…ƒç´ ä¸ªæ•°\n        s = sumCount();\n    }\n    if (check \u003e= 0) {\n        Node\u003cK,V\u003e[] tab, nt; int n, sc;\n        while (s \u003e= (long)(sc = sizeCtl) \u0026\u0026 (tab = table) != null \u0026\u0026\n               (n = tab.length) \u003c MAXIMUM_CAPACITY) {\n            int rs = resizeStamp(n);\n            if (sc \u003c 0) {\n                if ((sc \u003e\u003e\u003e RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 ||\n                    sc == rs + MAX_RESIZERS || (nt = nextTable) == null ||\n                    transferIndex \u003c= 0)\n                    break;\n                // newtable å·²ç»åˆ›å»ºäº†ï¼Œå¸®å¿™æ‰©å®¹\n                if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1))\n                    transfer(tab, nt);\n            }\n            // éœ€è¦æ‰©å®¹ï¼Œè¿™æ—¶ newtable æœªåˆ›å»º\n            else if (U.compareAndSwapInt(this, SIZECTL, sc,\n\n                                         (rs \u003c\u003c RESIZE_STAMP_SHIFT) + 2))\n                                         transfer(tab, null);\n            s = sumCount();\n        }\n    }\n}\n```\n\n### sizeæ–¹æ³•\n\nsize è®¡ç®—å®é™…å‘ç”Ÿåœ¨ putï¼Œremove æ”¹å˜é›†åˆå…ƒç´ çš„æ“ä½œä¹‹ä¸­\n- æ²¡æœ‰ç«äº‰å‘ç”Ÿï¼Œå‘ baseCount ç´¯åŠ è®¡æ•°\n- æœ‰ç«äº‰å‘ç”Ÿï¼Œæ–°å»º counterCellsï¼Œå‘å…¶ä¸­çš„ä¸€ä¸ª cell ç´¯åŠ è®¡æ•°\n\t- counterCells åˆå§‹æœ‰ä¸¤ä¸ª cell\n\t- å¦‚æœè®¡æ•°ç«äº‰æ¯”è¾ƒæ¿€çƒˆï¼Œä¼šåˆ›å»ºæ–°çš„ cell æ¥ç´¯åŠ è®¡æ•°\n\n```java\npublic int size() {\n    long n = sumCount();\n    return ((n \u003c 0L) ? 0 :\n            (n \u003e (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE :\n            (int)n);\n}\n \nfinal long sumCount() {\n    CounterCell[] as = counterCells; CounterCell a;\n    // å°† baseCount è®¡æ•°ä¸æ‰€æœ‰ cell è®¡æ•°ç´¯åŠ \n    long sum = baseCount;\n    if (as != null) {\n        for (int i = 0; i \u003c as.length; ++i) {\n            if ((a = as[i]) != null)\n                sum += a.value;\n        }\n    }\n    return sum;\n}\n```\n\n## æ€»ç»“\n\nJava 8 æ•°ç»„ï¼ˆNodeï¼‰ +ï¼ˆ é“¾è¡¨ Node | çº¢é»‘æ ‘ TreeNode ï¼‰ ä»¥ä¸‹æ•°ç»„ç®€ç§°ï¼ˆtableï¼‰ï¼Œé“¾è¡¨ç®€ç§°ï¼ˆbinï¼‰\n\n- åˆå§‹åŒ–ï¼Œä½¿ç”¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|cas]] æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œ**æ‡’æƒ°**åˆå§‹åŒ– table\n- æ ‘åŒ–ï¼Œå½“ table.length \u003c **64** æ—¶ï¼Œå…ˆå°è¯•**æ‰©å®¹**ï¼Œè¶…è¿‡ 64 æ—¶ï¼Œå¹¶ä¸” bin.length \u003e **8** æ—¶ï¼Œä¼šå°†é“¾è¡¨æ ‘åŒ–ï¼Œæ ‘åŒ–è¿‡ç¨‹ä¼šç”¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]] é”ä½é“¾è¡¨å¤´\n- putï¼Œå¦‚æœè¯¥ bin å°šæœªåˆ›å»ºï¼Œåªéœ€è¦ä½¿ç”¨ cas åˆ›å»º binï¼›å¦‚æœå·²ç»æœ‰äº†ï¼Œé”ä½é“¾è¡¨å¤´è¿›è¡Œåç»­ put æ“ä½œï¼Œå…ƒç´ æ·»åŠ è‡³ bin çš„**å°¾éƒ¨**\n- getï¼Œ**æ— é”**æ“ä½œä»…éœ€è¦ä¿è¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å¯è§æ€§|å¯è§æ€§]]ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­ get æ“ä½œåœ¨æ—§tableæ‹¿åˆ°çš„æ˜¯ ForwardingNode åˆ™è¯´æ˜æ­£åœ¨æ‰©å®¹å¹¶ä¸”å½“å‰æ¡¶å·²è¢«æ¬è¿ï¼Œå®ƒä¼šè®© get æ“ä½œåœ¨æ–° table è¿›è¡Œæœç´¢\n- æ‰©å®¹ï¼Œæ‰©å®¹æ—¶ä»¥ bin ä¸ºå•ä½è¿›è¡Œï¼Œéœ€è¦å¯¹ bin è¿›è¡Œ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]]ï¼Œä½†è¿™æ—¶å¦™çš„æ˜¯å…¶å®ƒç«äº‰[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ä¹Ÿä¸æ˜¯æ— äº‹å¯åšï¼Œå®ƒä»¬ä¼šå¸®åŠ©æŠŠå…¶å®ƒ bin è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹æ—¶å¹³å‡åªæœ‰ **1/6** çš„èŠ‚ç‚¹ä¼šè¢«å¤åˆ¶åˆ°æ–° table ä¸­\n- sizeï¼Œå…ƒç´ ä¸ªæ•°ä¿å­˜åœ¨ baseCount ä¸­ï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å¹¶å‘|å¹¶å‘]]æ—¶çš„ä¸ªæ•°å˜åŠ¨ä¿å­˜åœ¨ CounterCell[] å½“ä¸­ï¼ˆç±»ä¼¼[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/LongAdder|LongAdder]]ï¼‰ã€‚æœ€åç»Ÿè®¡æ•°é‡æ—¶ç´¯åŠ å³å¯","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ConcurrentLinkedQueue":{"title":"ConcurrentLinkedQueue","content":"# ConcurrentLinkedQueue\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CountdownLatch":{"title":"CountdownLatch","content":"# CountdownLatch\n\nç”¨æ¥è¿›è¡Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]][[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åŒæ­¥|åŒæ­¥]]åä½œï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆå€’è®¡æ—¶ã€‚\nå…¶ä¸­æ„é€ å‚æ•°ç”¨æ¥åˆå§‹åŒ–ç­‰å¾…è®¡æ•°å€¼ï¼Œawait() ç”¨æ¥ç­‰å¾…è®¡æ•°å½’é›¶ï¼ŒcountDown() ç”¨æ¥è®©è®¡æ•°å‡ä¸€\n\n## ä½¿ç”¨\n\n### åŸºæœ¬æµç¨‹\n\n```java\npublic static void main(String[] args) throws InterruptedException {\n    CountDownLatch latch = new CountDownLatch(3);\n \n    new Thread(() -\u003e {\n        log.debug(\"begin...\");\n        sleep(1);\n        latch.countDown();\n        log.debug(\"end...{}\", latch.getCount());\n    }).start();\n \n    new Thread(() -\u003e {\n        log.debug(\"begin...\");\n        sleep(2);\n        latch.countDown();\n        log.debug(\"end...{}\", latch.getCount());\n    }).start();\n \n    new Thread(() -\u003e {\n        log.debug(\"begin...\");\n        sleep(1.5);\n        latch.countDown();\n        log.debug(\"end...{}\", latch.getCount());\n    }).start();\n \n    log.debug(\"waiting...\");\n    latch.await();\n    log.debug(\"wait end...\");\n}\n```\n\n\u003eå½“ç„¶å¯ä»¥ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/join|join]]å®ç°ç±»ä¼¼åŠŸèƒ½ï¼Œä½†joinæ˜¯æ›´åº•å±‚çš„æ¥å£ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒç¹çã€‚\n\n### é…åˆçº¿ç¨‹æ± \n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± |çº¿ç¨‹æ± ]]\n\n```java\npublic static void main(String[] args) throws InterruptedException {\n    CountDownLatch latch = new CountDownLatch(3);\n    ExecutorService service = Executors.newFixedThreadPool(4);\n    service.submit(() -\u003e {\n        log.debug(\"begin...\");\n        sleep(1);\n        latch.countDown();\n        log.debug(\"end...{}\", latch.getCount());\n    });\n    service.submit(() -\u003e {\n        log.debug(\"begin...\");\n        sleep(1.5);\n        latch.countDown();\n        log.debug(\"end...{}\", latch.getCount());\n    });\n    service.submit(() -\u003e {\n        log.debug(\"begin...\");\n        sleep(2);\n        latch.countDown();\n        log.debug(\"end...{}\", latch.getCount());\n    });\n    service.submit(()-\u003e{\n        try {\n            log.debug(\"waiting...\");\n            latch.await();\n            log.debug(\"wait end...\");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    });\n}\n```\n\n## åŸç†\n\n**CountDownLatch**æ˜¯ä¸€ç§åŒæ­¥è¾…åŠ©ï¼Œè®©æˆ‘ä»¬å¤šä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œéœ€è¦ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼Œæ‰èƒ½æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¹‹å‰çº¿ç¨‹æ“ä½œæ—¶æ˜¯ä½¿ç”¨`Thread.join`æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œ**CountDownLatch**å†…éƒ¨ä½¿ç”¨äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/AQS|AQS]]é”ï¼Œå…¶å®å†…éƒ¨æœ‰ä¸€ä¸ª**state**å­—æ®µï¼Œé€šè¿‡è¯¥å­—æ®µæ¥æ§åˆ¶é”çš„æ“ä½œã€‚\n\n**CountDownLatch**å†…éƒ¨æ˜¯å°†**state**ä½œä¸ºè®¡æ•°å™¨æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆå§‹åŒ–æ—¶ï¼Œ**state**è®¡æ•°å™¨ä¸º3ï¼ŒåŒæ—¶å¼€å¯ä¸‰ä¸ªçº¿ç¨‹å½“æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæˆåŠŸï¼Œæ¯å½“æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆåå°±å°†**state**å€¼å‡å°‘1ï¼Œç›´åˆ°å‡å°‘åˆ°ä¸º0æ—¶ï¼Œè¯´æ˜æ‰€æœ‰çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CyclicBarrier":{"title":"CyclicBarrier","content":"# CyclicBarrier\n\n[ËˆsaÉªklÉªk ËˆbÃ¦riÉš] å¾ªç¯æ …æ ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹åä½œï¼Œç­‰å¾…çº¿ç¨‹æ»¡è¶³æŸä¸ªè®¡æ•°ã€‚æ„é€ æ—¶è®¾ç½®ã€è®¡æ•°ä¸ªæ•°ã€ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§ è¡Œåˆ°æŸä¸ªéœ€è¦â€œåŒæ­¥â€çš„æ—¶åˆ»è°ƒç”¨ await() æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå½“ç­‰å¾…çš„çº¿ç¨‹æ•°æ»¡è¶³ã€è®¡æ•°ä¸ªæ•°ã€æ—¶ï¼Œç»§ç»­æ‰§è¡Œã€‚\n\n\u003e ä¸CountdownLatchä¸åŒï¼ŒCyclicBarrierå¯ä»¥é‡å¤ä½¿ç”¨ã€‚\n\n```java\nCyclicBarrier cb = new CyclicBarrier(2); // ä¸ªæ•°ä¸º2æ—¶æ‰ä¼šç»§ç»­æ‰§è¡Œ\n \nnew Thread(()-\u003e{\n    System.out.println(\"çº¿ç¨‹1å¼€å§‹..\"+new Date());\n    try {\n        cb.await(); // å½“ä¸ªæ•°ä¸è¶³æ—¶ï¼Œç­‰å¾…\n    } catch (InterruptedException | BrokenBarrierException e) {\n        e.printStackTrace();\n    }\n    System.out.println(\"çº¿ç¨‹1ç»§ç»­å‘ä¸‹è¿è¡Œ...\"+new Date());\n}).start();\n \nnew Thread(()-\u003e{\n    System.out.println(\"çº¿ç¨‹2å¼€å§‹..\"+new Date());\n    try { Thread.sleep(2000); } catch (InterruptedException e) { }\n    try {\n        cb.await(); // 2 ç§’åï¼Œçº¿ç¨‹ä¸ªæ•°å¤Ÿ2ï¼Œç»§ç»­è¿è¡Œ\n    } catch (InterruptedException | BrokenBarrierException e) {\n        e.printStackTrace();\n    }\n    System.out.println(\"çº¿ç¨‹2ç»§ç»­å‘ä¸‹è¿è¡Œ...\"+new Date());\n}).start();\n```\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/FutureTask":{"title":"FutureTask","content":"# FutureTask\n\nFutureTask èƒ½å¤Ÿæ¥æ”¶ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/Callable|Callable]] ç±»å‹çš„å‚æ•°ï¼Œç”¨æ¥å¤„ç†æœ‰è¿”å›ç»“æœçš„æƒ…å†µã€‚\n\n```java\nFutureTask\u003cV\u003e implements RunnableFuture\u003cV\u003e\ninterface RunnableFuture\u003cV\u003e extends Runnable, Future\u003cV\u003e  // Future.get()ç”¨æ¥è¿”å›ä»»åŠ¡çš„è¿”å›å€¼\n\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C":{"title":"åŸå­æ“ä½œ","content":"# åŸå­æ“ä½œ\n\nJDKæä¾›äº†ä¸€äº›ç”¨äºåŸå­æ“ä½œçš„ç±»ï¼Œåœ¨`java.util.concurrent.atomic`åŒ…ä¸‹é¢ã€‚åœ¨JDK 11ä¸­ï¼Œæœ‰å¦‚ä¸‹17ä¸ªç±»ï¼š\n![[z-oblib/z2-attachments/åŸå­ç±» 1.jpg]]\nä»åå­—å°±å¯ä»¥çœ‹å¾—å‡ºæ¥è¿™äº›ç±»å¤§æ¦‚çš„ç”¨é€”ï¼š\n\n- åŸå­æ›´æ–°åŸºæœ¬ç±»å‹\n- åŸå­æ›´æ–°æ•°ç»„\n- åŸå­æ›´æ–°å¼•ç”¨\n- åŸå­æ›´æ–°å­—æ®µï¼ˆå±æ€§ï¼‰\n\n## ä»¥`AtomicInteger`çš„`getAndAdd(int delta)`æ–¹æ³•ä¸ºä¾‹\n\n\u003eå®é™…å°±æ˜¯è°ƒç”¨nativeæ–¹æ³•ï¼Œè·å–æŸä¸ªå¯¹è±¡å†…å­˜ç©ºé—´åç§»offsetå¤„çš„å˜é‡ï¼Œå¾ªç¯å°è¯•è·å–è¯¥å˜é‡çš„å€¼æ˜¯å¦ä¸çº¿ç¨‹æŒæœ‰å€¼ä¸€è‡´ï¼Œä¸€è‡´åˆ™æ›¿æ¢æˆç›®æ ‡å€¼ï¼Œä¸ä¸€è‡´è¡¨ç¤ºæœ‰å…¶å®ƒçº¿ç¨‹ä¿®æ”¹è¿‡äº†ã€‚\n\nå…ˆçœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„æºç ï¼š\n\n```java\npublic final int getAndAdd(int delta) {\n    return U.getAndAddInt(this, VALUE, delta);\n}\n```\n\nè¿™é‡Œçš„Uå…¶å®å°±æ˜¯ä¸€ä¸ª`Unsafe`å¯¹è±¡ï¼š\n\n```java\nprivate static final jdk.internal.misc.Unsafe U = jdk.internal.misc.Unsafe.getUnsafe();\n```\n\næ‰€ä»¥å…¶å®`AtomicInteger`ç±»çš„`getAndAdd(int delta)`æ–¹æ³•æ˜¯è°ƒç”¨`Unsafe`ç±»çš„æ–¹æ³•æ¥å®ç°çš„ï¼š\n\n```java\n@HotSpotIntrinsicCandidate\npublic final int getAndAddInt(Object o, long offset, int delta) {\n    int v;\n    do {\n        v = getIntVolatile(o, offset);\n    } while (!weakCompareAndSetInt(o, offset, v, v + delta));\n    return v;\n}\n```\n\n\u003e æ³¨ï¼šè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨JDK 1.8æ‰æ–°å¢çš„ã€‚åœ¨JDK1.8ä¹‹å‰ï¼Œ`AtomicInteger`æºç å®ç°æœ‰æ‰€ä¸åŒï¼Œæ˜¯åŸºäºforæ­»å¾ªç¯çš„ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œäº†è§£ä¸€ä¸‹ã€‚\n\næˆ‘ä»¬æ¥ä¸€æ­¥æ­¥è§£æè¿™æ®µæºç ã€‚é¦–å…ˆï¼Œå¯¹è±¡`o`æ˜¯`this`ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª`AtomicInteger`å¯¹è±¡ã€‚ç„¶å`offset`æ˜¯ä¸€ä¸ªå¸¸é‡`VALUE`ã€‚è¿™ä¸ªå¸¸é‡æ˜¯åœ¨`AtomicInteger`ç±»ä¸­å£°æ˜çš„ï¼š\n\n```java\nprivate static final long VALUE = U.objectFieldOffset(AtomicInteger.class, \"value\");\n```\n\nåŒæ ·æ˜¯è°ƒç”¨çš„`Unsafe`çš„æ–¹æ³•ã€‚ä»æ–¹æ³•åå­—ä¸Šæ¥çœ‹ï¼Œæ˜¯å¾—åˆ°äº†ä¸€ä¸ªå¯¹è±¡å­—æ®µåç§»é‡ã€‚\n\n\u003e ç”¨äºè·å–æŸä¸ªå­—æ®µç›¸å¯¹Javaå¯¹è±¡çš„â€œèµ·å§‹åœ°å€â€çš„åç§»é‡ã€‚\n\u003e \n\u003e ä¸€ä¸ªjavaå¯¹è±¡å¯ä»¥çœ‹æˆæ˜¯ä¸€æ®µå†…å­˜ï¼Œå„ä¸ªå­—æ®µéƒ½å¾—æŒ‰ç…§ä¸€å®šçš„é¡ºåºæ”¾åœ¨è¿™æ®µå†…å­˜é‡Œï¼ŒåŒæ—¶è€ƒè™‘åˆ°å¯¹é½è¦æ±‚ï¼Œå¯èƒ½è¿™äº›å­—æ®µä¸æ˜¯è¿ç»­æ”¾ç½®çš„ï¼Œ\n\u003e \n\u003e ç”¨è¿™ä¸ªæ–¹æ³•èƒ½å‡†ç¡®åœ°å‘Šè¯‰ä½ æŸä¸ªå­—æ®µç›¸å¯¹äºå¯¹è±¡çš„èµ·å§‹å†…å­˜åœ°å€çš„å­—èŠ‚åç§»é‡ï¼Œå› ä¸ºæ˜¯ç›¸å¯¹åç§»é‡ï¼Œæ‰€ä»¥å®ƒå…¶å®è·ŸæŸä¸ªå…·ä½“å¯¹è±¡åˆæ²¡ä»€ä¹ˆå¤ªå¤§å…³ç³»ï¼Œè·Ÿclassçš„å®šä¹‰å’Œè™šæ‹Ÿæœºçš„å†…å­˜æ¨¡å‹çš„å®ç°ç»†èŠ‚æ›´ç›¸å…³ã€‚\n\nç»§ç»­çœ‹æºç ã€‚å‰é¢æˆ‘ä»¬è®²åˆ°ï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|CAS]]æ˜¯â€œæ— é”â€çš„åŸºç¡€ï¼Œå®ƒå…è®¸æ›´æ–°å¤±è´¥ã€‚æ‰€ä»¥ç»å¸¸ä¼šä¸whileå¾ªç¯æ­é…ï¼Œåœ¨å¤±è´¥åä¸æ–­å»é‡è¯•ã€‚\n\nè¿™é‡Œå£°æ˜äº†ä¸€ä¸ªvï¼Œä¹Ÿå°±æ˜¯è¦è¿”å›çš„å€¼ã€‚ä»`getAndAddInt`æ¥çœ‹ï¼Œå®ƒè¿”å›çš„åº”è¯¥æ˜¯åŸæ¥çš„å€¼ï¼Œè€Œæ–°çš„å€¼çš„`v + delta`ã€‚\n\nè¿™é‡Œä½¿ç”¨çš„æ˜¯**do-whileå¾ªç¯**ã€‚è¿™ç§å¾ªç¯ä¸å¤šè§ï¼Œå®ƒçš„ç›®çš„æ˜¯**ä¿è¯å¾ªç¯ä½“å†…çš„è¯­å¥è‡³å°‘ä¼šè¢«æ‰§è¡Œä¸€é**ã€‚è¿™æ ·æ‰èƒ½ä¿è¯return çš„å€¼`v`æ˜¯æˆ‘ä»¬æœŸæœ›çš„å€¼ã€‚\n\nå¾ªç¯ä½“çš„æ¡ä»¶æ˜¯ä¸€ä¸ªCASæ–¹æ³•ï¼š\n\n```java\npublic final boolean weakCompareAndSetInt(Object o, long offset,\n                                          int expected,\n                                          int x) {\n    return compareAndSetInt(o, offset, expected, x);\n}\n\npublic final native boolean compareAndSetInt(Object o, long offset,\n                                             int expected,\n                                             int x);\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆå…¶å®æ˜¯è°ƒç”¨çš„æˆ‘ä»¬ä¹‹å‰è¯´åˆ°äº†CAS [[native|native]]æ–¹æ³•ã€‚é‚£ä¸ºä»€ä¹ˆè¦ç»è¿‡ä¸€å±‚`weakCompareAndSetInt`å‘¢ï¼Ÿä»JDKæºç ä¸Šçœ‹ä¸å‡ºæ¥ä»€ä¹ˆã€‚åœ¨JDK 8åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚\n\n\u003e è€Œåœ¨JDK 9å¼€å§‹ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸Šé¢å¢åŠ äº†@HotSpotIntrinsicCandidateæ³¨è§£ã€‚è¿™ä¸ªæ³¨è§£å…è®¸HotSpot VMè‡ªå·±æ¥å†™æ±‡ç¼–æˆ–IRç¼–è¯‘å™¨æ¥å®ç°è¯¥æ–¹æ³•ä»¥æä¾›æ€§èƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´è™½ç„¶å¤–é¢çœ‹åˆ°çš„åœ¨JDK9ä¸­weakCompareAndSetå’ŒcompareAndSetåº•å±‚ä¾æ—§æ˜¯è°ƒç”¨äº†ä¸€æ ·çš„ä»£ç ï¼Œä½†æ˜¯ä¸æ’é™¤HotSpot VMä¼šæ‰‹åŠ¨æ¥å®ç°weakCompareAndSetçœŸæ­£å«ä¹‰çš„åŠŸèƒ½çš„å¯èƒ½æ€§ã€‚\n\næ ¹æ®æœ¬æ–‡ç¬¬ä¸€ç¯‡å‚è€ƒæ–‡ç« ï¼ˆæ–‡æœ«é“¾æ¥ï¼‰ï¼Œå®ƒè·Ÿ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]]æœ‰å…³ã€‚\n\nç®€å•æ¥è¯´ï¼Œ`weakCompareAndSet`æ“ä½œä»…ä¿ç•™äº†`volatile`è‡ªèº«å˜é‡çš„ç‰¹æ€§ï¼Œè€Œé™¤å»äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/happens-before|happens-before]]è§„åˆ™å¸¦æ¥çš„å†…å­˜è¯­ä¹‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`weakCompareAndSet`**æ— æ³•ä¿è¯å¤„ç†æ“ä½œç›®æ ‡çš„volatileå˜é‡å¤–çš„å…¶ä»–å˜é‡çš„æ‰§è¡Œé¡ºåº( ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œå¯¹æŒ‡ä»¤åºåˆ—è¿›è¡Œé‡æ–°æ’åº )ï¼ŒåŒæ—¶ä¹Ÿæ— æ³•ä¿è¯è¿™äº›å˜é‡çš„å¯è§æ€§ã€‚**è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æé«˜æ€§èƒ½ã€‚\n\nå†å›åˆ°å¾ªç¯æ¡ä»¶ä¸Šæ¥ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯åœ¨ä¸æ–­å°è¯•å»ç”¨CASæ›´æ–°ã€‚å¦‚æœæ›´æ–°å¤±è´¥ï¼Œå°±ç»§ç»­é‡è¯•ã€‚é‚£ä¸ºä»€ä¹ˆè¦æŠŠè·å–â€œæ—§å€¼â€vçš„æ“ä½œæ”¾åˆ°å¾ªç¯ä½“å†…å‘¢ï¼Ÿå…¶å®è¿™ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å‰é¢æˆ‘ä»¬è¯´äº†ï¼ŒCASå¦‚æœæ—§å€¼Vä¸ç­‰äºé¢„æœŸå€¼Eï¼Œå®ƒå°±ä¼šæ›´æ–°å¤±è´¥ã€‚è¯´æ˜æ—§çš„å€¼å‘ç”Ÿäº†å˜åŒ–ã€‚é‚£æˆ‘ä»¬å½“ç„¶éœ€è¦è¿”å›çš„æ˜¯è¢«å…¶ä»–[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]æ”¹å˜ä¹‹åçš„æ—§å€¼äº†ï¼Œå› æ­¤æ”¾åœ¨äº†doå¾ªç¯ä½“å†…ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%AE%9E%E7%8E%B0%E7%9A%84CAS":{"title":"Javaå®ç°çš„CAS","content":"# Javaå®ç°çš„CAS\n\nå‰é¢æåˆ°ï¼ŒCASæ˜¯ä¸€ç§åŸå­æ“ä½œã€‚é‚£ä¹ˆJavaæ˜¯æ€æ ·æ¥ä½¿ç”¨CASçš„å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Javaä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æ˜¯nativeçš„ï¼Œé‚£Javaå°±ä¸è´Ÿè´£å…·ä½“å®ç°å®ƒï¼Œè€Œæ˜¯äº¤ç»™åº•å±‚çš„JVMä½¿ç”¨cæˆ–è€…c++å»å®ç°ã€‚\n\nåœ¨Javaä¸­ï¼Œæœ‰ä¸€ä¸ª`Unsafe`ç±»ï¼Œå®ƒåœ¨`sun.misc`åŒ…ä¸­ã€‚å®ƒé‡Œé¢æ˜¯ä¸€äº›`native`æ–¹æ³•ï¼Œå…¶ä¸­å°±æœ‰å‡ ä¸ªå…³äºCASçš„ï¼š\n\n```java\nboolean compareAndSwapObject(Object o, long offset,Object expected, Object x);\nboolean compareAndSwapInt(Object o, long offset,int expected,int x);\nboolean compareAndSwapLong(Object o, long offset,long expected,long x);\n```\n\nå½“ç„¶ï¼Œä»–ä»¬éƒ½æ˜¯`public native`çš„ã€‚\n\nUnsafeä¸­å¯¹CASçš„å®ç°æ˜¯C++å†™çš„ï¼Œå®ƒçš„å…·ä½“å®ç°å’Œæ“ä½œç³»ç»Ÿã€CPUéƒ½æœ‰å…³ç³»ã€‚\n\nLinuxçš„X86ä¸‹ä¸»è¦æ˜¯é€šè¿‡`cmpxchgl`è¿™ä¸ªæŒ‡ä»¤åœ¨CPUçº§å®ŒæˆCASæ“ä½œçš„ï¼Œä½†åœ¨å¤šå¤„ç†å™¨æƒ…å†µä¸‹å¿…é¡»ä½¿ç”¨`lock`æŒ‡ä»¤åŠ é”æ¥å®Œæˆã€‚å½“ç„¶ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œå¤„ç†å™¨çš„å®ç°ä¼šæœ‰æ‰€ä¸åŒï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œäº†è§£ã€‚\n\nå½“ç„¶ï¼ŒUnsafeç±»é‡Œé¢è¿˜æœ‰å…¶å®ƒæ–¹æ³•ç”¨äºä¸åŒçš„ç”¨é€”ã€‚æ¯”å¦‚æ”¯æŒçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤çš„`park`å’Œ`unpark`ï¼Œ LockSupportç±»åº•å±‚å°±æ˜¯è°ƒç”¨äº†è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚è¿˜æœ‰æ”¯æŒåå°„æ“ä½œçš„`allocateInstance()`æ–¹æ³•ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/LinkedBlockingQueue":{"title":"LinkedBlockingQueue","content":"# LinkedBlockingQueue\n\n## å…¥é˜Ÿå‡ºé˜Ÿ\n\nç±»ä¼¼[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/AQS|AQS]]ä¸­çš„ç­‰å¾…é˜Ÿåˆ—:\n\n```java\npublic class LinkedBlockingQueue\u003cE\u003e extends AbstractQueue\u003cE\u003e\n        implements BlockingQueue\u003cE\u003e, java.io.Serializable {\n    static class Node\u003cE\u003e {\n    E item;\n \n        /**\n         * ä¸‹åˆ—ä¸‰ç§æƒ…å†µä¹‹ä¸€\n         * - çœŸæ­£çš„åç»§èŠ‚ç‚¹\n         * - è‡ªå·±, å‘ç”Ÿåœ¨å‡ºé˜Ÿæ—¶\n         * - null, è¡¨ç¤ºæ˜¯æ²¡æœ‰åç»§èŠ‚ç‚¹, æ˜¯æœ€åäº†\n         */\n        Node\u003cE\u003e next;\n \n        Node(E x) { item = x; }\n    }\n}\n```\n\n1. åˆå§‹åŒ–é“¾è¡¨ `last = head = new Node\u003cE\u003e(null);` Dummy èŠ‚ç‚¹ç”¨æ¥å ä½ï¼Œitem ä¸º null\n![[z-oblib/z2-attachments/Pasted image 20220613205635.png]]\n2. å½“ä¸€ä¸ªèŠ‚ç‚¹å…¥é˜Ÿ last = last.next = node;\n![[z-oblib/z2-attachments/Pasted image 20220613205651.png]]\n3. å†æ¥ä¸€ä¸ªèŠ‚ç‚¹å…¥é˜Ÿ last = last.next = node;\n![[z-oblib/z2-attachments/Pasted image 20220613205701.png]]\n4. å‡ºé˜Ÿ\n```java\nNode\u003cE\u003e h = head;\nNode\u003cE\u003e first = h.next;\nh.next = h; // help GC\nhead = first;\nE x = first.item;\nfirst.item = null;\nreturn x;\n```\nh = head\n![[z-oblib/z2-attachments/Pasted image 20220613205729.png]]\nfirst = h.next\n![[z-oblib/z2-attachments/Pasted image 20220613205737.png]]\nh.next = h\n![[z-oblib/z2-attachments/Pasted image 20220613205741.png]]\nhead = first\n```java\nE x = first.item;\nfirst.item = null;\nreturn x;\n```\n![[z-oblib/z2-attachments/Pasted image 20220613205753.png]]\n\n## åŠ é”\n\n==é«˜æ˜ä¹‹å¤„==åœ¨äºç”¨äº†ä¸¤æŠŠé”å’Œ dummy èŠ‚ç‚¹ï¼š\n- ç”¨ä¸€æŠŠé”ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œæœ€å¤šåªå…è®¸æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼ŒäºŒé€‰ä¸€ï¼‰æ‰§è¡Œ\n- ç”¨ä¸¤æŠŠé”ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œå¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ï¼ˆä¸€ä¸ªç”Ÿäº§è€…ä¸ä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰æ‰§è¡Œ\n\t- æ¶ˆè´¹è€…ä¸æ¶ˆè´¹è€…çº¿ç¨‹ä»ç„¶ä¸²è¡Œ\n\t- ç”Ÿäº§è€…ä¸ç”Ÿäº§è€…çº¿ç¨‹ä»ç„¶ä¸²è¡Œ\n\nçº¿ç¨‹å®‰å…¨åˆ†æï¼š\n- å½“èŠ‚ç‚¹æ€»æ•°å¤§äº 2 æ—¶ï¼ˆåŒ…æ‹¬ dummy èŠ‚ç‚¹ï¼‰ï¼ŒputLock ä¿è¯çš„æ˜¯ last èŠ‚ç‚¹çš„çº¿ç¨‹å®‰å…¨ï¼ŒtakeLock ä¿è¯çš„æ˜¯ head èŠ‚ç‚¹çš„çº¿ç¨‹å®‰å…¨ã€‚ä¸¤æŠŠé”ä¿è¯äº†å…¥é˜Ÿå’Œå‡ºé˜Ÿæ²¡æœ‰ç«äº‰\n- å½“èŠ‚ç‚¹æ€»æ•°ç­‰äº 2 æ—¶ï¼ˆå³ä¸€ä¸ª dummy èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ­£å¸¸èŠ‚ç‚¹ï¼‰è¿™æ—¶å€™ï¼Œä»ç„¶æ˜¯ä¸¤æŠŠé”é”ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸ä¼šç«äº‰\n- å½“èŠ‚ç‚¹æ€»æ•°ç­‰äº 1 æ—¶ï¼ˆå°±ä¸€ä¸ª dummy èŠ‚ç‚¹ï¼‰è¿™æ—¶ take çº¿ç¨‹ä¼šè¢« notEmpty æ¡ä»¶é˜»å¡ï¼Œæœ‰ç«äº‰ï¼Œä¼šé˜»å¡\n\n```java\n// ç”¨äº put(é˜»å¡) offer(éé˜»å¡)\nprivate final ReentrantLock putLock = new ReentrantLock();\n \n// ç”¨æˆ· take(é˜»å¡) poll(éé˜»å¡)\nprivate final ReentrantLock takeLock = new ReentrantLock();\n```\n\n### putæ–¹æ³•\n\nç‰¹ç‚¹ï¼šç”±ç”Ÿäº§è€…å«é†’å…¶å®ƒç”Ÿäº§è€…ï¼Œä½¿ç”¨signalè€Œä¸æ˜¯signalAllï¼Œé˜²æ­¢ä¸å¿…è¦çš„ç«äº‰ã€‚\n\n```java\npublic void put(E e) throws InterruptedException {\nif (e == null) throw new NullPointerException();\n    int c = -1;\n    Node\u003cE\u003e node = new Node\u003cE\u003e(e);\n    final ReentrantLock putLock = this.putLock;\n    // count ç”¨æ¥ç»´æŠ¤å…ƒç´ è®¡æ•°\n    final AtomicInteger count = this.count;\n    putLock.lockInterruptibly();\n    try {\n        // æ»¡äº†ç­‰å¾…\n        while (count.get() == capacity) {\n            // å€’è¿‡æ¥è¯»å°±å¥½: ç­‰å¾… notFull\n            notFull.await();\n        }\n        // æœ‰ç©ºä½, å…¥é˜Ÿä¸”è®¡æ•°åŠ ä¸€\n        enqueue(node);\n        // cå–å¾—æ—¶count+1å‰çš„å€¼\n        c = count.getAndIncrement();  \n        // é™¤äº†è‡ªå·± put ä»¥å¤–, é˜Ÿåˆ—è¿˜æœ‰ç©ºä½, ç”±è‡ªå·±å«é†’å…¶ä»– put çº¿ç¨‹\n        if (c + 1 \u003c capacity)\n            notFull.signal();\n    } finally {\n        putLock.unlock();\n    }\n    // å¦‚æœé˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªå…ƒç´ , å«é†’ take çº¿ç¨‹\n    if (c == 0)\n        // è¿™é‡Œè°ƒç”¨çš„æ˜¯ notEmpty.signal() è€Œä¸æ˜¯ notEmpty.signalAll() æ˜¯ä¸ºäº†å‡å°‘ç«äº‰\n        signalNotEmpty();\n}\n```\n\n### takeæ–¹æ³•\n\n```java\npublic E take() throws InterruptedException {\n    E x;\n    int c = -1;\n    final AtomicInteger count = this.count;\n    final ReentrantLock takeLock = this.takeLock;\n    takeLock.lockInterruptibly();\n    try {\n        while (count.get() == 0) {\n            notEmpty.await();\n        }\n        x = dequeue();\n        c = count.getAndDecrement();\n        if (c \u003e 1)\n            notEmpty.signal();\n    } finally {\n        takeLock.unlock();\n    }\n    // å¦‚æœé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªç©ºä½æ—¶, å«é†’ put çº¿ç¨‹\n    // å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œå‡ºé˜Ÿ, ç¬¬ä¸€ä¸ªçº¿ç¨‹æ»¡è¶³ c == capacity, ä½†åç»­çº¿ç¨‹ c \u003c capacity\n    if (c == capacity)\n        // è¿™é‡Œè°ƒç”¨çš„æ˜¯ notFull.signal() è€Œä¸æ˜¯ notFull.signalAll() æ˜¯ä¸ºäº†å‡å°‘ç«äº‰\n        signalNotFull()\n        return x;\n}\n```\n\n## æ€§èƒ½åˆ†æ\n\nä¸»è¦åˆ—ä¸¾ LinkedBlockingQueue ä¸ ArrayBlockingQueue çš„æ€§èƒ½æ¯”è¾ƒ\n- Linked æ”¯æŒæœ‰ç•Œï¼ŒArray å¼ºåˆ¶æœ‰ç•Œ\n- Linked å®ç°æ˜¯é“¾è¡¨ï¼ŒArray å®ç°æ˜¯æ•°ç»„\n- Linked æ˜¯æ‡’æƒ°çš„ï¼Œè€Œ Array éœ€è¦æå‰åˆå§‹åŒ– Node æ•°ç»„\n- Linked æ¯æ¬¡å…¥é˜Ÿä¼šç”Ÿæˆæ–° Nodeï¼Œè€Œ Array çš„ Node æ˜¯æå‰åˆ›å»ºå¥½çš„ï¼Œå‡å°‘åƒåœ¾å›æ”¶å¼€é”€\n- Linked ä¸¤æŠŠé”ï¼ŒArray ä¸€æŠŠé”ï¼ŒLinkedæ€§èƒ½æ›´å¥½","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/LongAdder":{"title":"LongAdder","content":"# LongAdder\n\n## åŸç†\n\nLongAdder ç±»æœ‰å‡ ä¸ªå…³é”®åŸŸï¼š\n```java\n// ç´¯åŠ å•å…ƒæ•°ç»„, æ‡’æƒ°åˆå§‹åŒ–\ntransient volatile Cell[] cells;\n \n// åŸºç¡€å€¼, å¦‚æœæ²¡æœ‰ç«äº‰, åˆ™ç”¨ cas ç´¯åŠ è¿™ä¸ªåŸŸ\ntransient volatile long base;\n \n// åœ¨ cells åˆ›å»ºæˆ–æ‰©å®¹æ—¶, ç½®ä¸º 1, è¡¨ç¤ºåŠ é”\ntransient volatile int cellsBusy;\n```\n\ncellsBusyç”¨åˆ°äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CASé”|CASé”]]çš„æ–¹æ³•ã€‚\n\n### Cell\n\nCellä¸ºç´¯åŠ å•å…ƒï¼š\n\n```java\n// é˜²æ­¢ç¼“å­˜è¡Œä¼ªå…±äº«\n@sun.misc.Contended \nstatic final class Cell {\n    volatile long value;\n    Cell(long x) { value = x; }\n    \n    // æœ€é‡è¦çš„æ–¹æ³•, ç”¨æ¥ cas æ–¹å¼è¿›è¡Œç´¯åŠ , prev è¡¨ç¤ºæ—§å€¼, next è¡¨ç¤ºæ–°å€¼\n    final boolean cas(long prev, long next) {\n        return UNSAFE.compareAndSwapLong(this, valueOffset, prev, next);\n    }\n    // çœç•¥ä¸é‡è¦ä»£ç \n}\n```\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¼ªå…±äº«|ä¼ªå…±äº«]]","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ReentrantLock":{"title":"ReentrantLock","content":"# ReentrantLock\n\n\u003e ç›¸å½“äºæ˜¯ä¸€ä¸ªjavaå±‚é¢å®ç°çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/monitor|monitor]]ã€‚\n\n## ç‰¹ç‚¹\n\nç›¸å¯¹äº [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]] å®ƒå…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n- å¯ä¸­æ–­ï¼ˆæ”¾å¼ƒäº‰æŠ¢é”ï¼‰\n- å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´\n- å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”\n\t- å…ˆåˆ°å…ˆå¾—ï¼Œè€Œä¸æ˜¯éšæœºäº‰æŠ¢\n\t- è§£å†³çº¿ç¨‹[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é¥¥é¥¿|é¥¥é¥¿]]é—®é¢˜\n- æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡\n\t- æ¡ä»¶å˜é‡ç›¸å½“äºsynchronizedä¸­çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/wait\u0026notify|waitSet]]ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„å¯ä»¥åœ¨wait_setç­‰å¾…\n\t- æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡æ„å‘³ç€æœ‰å¤šä¸ªwaitSetï¼Œå¯ä»¥æ ¹æ®ä¸åŒæ¡ä»¶è¿›å…¥ä¸åŒsetç­‰å¾…\n- ä¸ synchronized ä¸€æ ·ï¼Œéƒ½æ”¯æŒå¯é‡å…¥\n\n\u003e stateæ ‡è¯†èµ„æºæ˜¯å¦ä¸ºé”å®šçŠ¶æ€ã€‚\n\n## è¯­æ³•\n\n```java\n// è·å–é”\nreentrantLock.lock();\ntry {\n    // ä¸´ç•ŒåŒº\n} finally {\n    // é‡Šæ”¾é”\n    reentrantLock.unlock();\n}\n```\n\n\u003e é˜¿é‡Œæ‰‹å†Œï¼šreentrantLock.lock()æ”¾åœ¨tryå¤–ã€‚\n\nè¦ä¿è¯ï¼š\n- lock/unlockæˆå¯¹å‡ºç°\n- unlockåœ¨finallyä¸­æ‰§è¡Œ\n\n## ç‰¹æ€§\n\n### å¯é‡å…¥\n\nsynchronized(å¯¹è±¡)ä¸­å¯¹è±¡çš„ä½œç”¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå…³è¿ï¼ˆæŒ‡å‘ï¼‰äº†åº•å±‚çš„monitorå¯¹è±¡ï¼Œè€ŒreentrantLockçš„å¯¹è±¡æœ¬èº«å°±æ˜¯ç±»ä¼¼ä¸€ä¸ªMonitorçš„å­˜åœ¨ã€‚\n\n```java\nstatic ReentrantLock lock = new ReentrantLock();\n \npublic static void main(String[] args) {\n    method1();\n}\n \npublic static void method1() {\n    lock.lock();\n    try {\n        log.debug(\"execute method1\");\n        method2();\n    } finally {\n        lock.unlock();\n    }\n}\n \npublic static void method2() {\n    lock.lock();\n    try {\n        log.debug(\"execute method2\");\n        method3();\n    } finally {\n        lock.unlock();\n    }\n}\n \npublic static void method3() {\n    lock.lock();\n    try {\n        log.debug(\"execute method3\");\n    } finally {\n        lock.unlock();\n    }\n}\n```\n\n- å½“lock.lock()æˆåŠŸï¼Œåˆ™å½“å‰çº¿ç¨‹æˆä¸ºlockçš„owner\n- å½“lock.lock()å¤±è´¥ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«åŠ å…¥åˆ°lockçš„ç­‰å¾…é˜Ÿåˆ—ä¸­\n\n### å¯æ‰“æ–­\n\n\u003e è¢«åŠ¨é¿å…æ­»ç­‰\n\nç­‰å¾…é”çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]å¯ä»¥ç”¨interrupt()ç»ˆæ­¢æˆ‘çš„ç­‰å¾…ã€‚\n\n```java\nReentrantLock lock = new ReentrantLock();\n \nThread t1 = new Thread(() -\u003e {\nlog.debug(\"å¯åŠ¨...\");\n    try {\n        lock.lockInterruptibly();\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n        log.debug(\"ç­‰é”çš„è¿‡ç¨‹ä¸­è¢«æ‰“æ–­\");\n        return;\n    }\n    try {\n        log.debug(\"è·å¾—äº†é”\");\n    } finally {\n        lock.unlock();\n    }\n}, \"t1\");\n \n \nlock.lock();\nlog.debug(\"Mainè·å¾—äº†é”\");\nt1.start();\ntry {\n    sleep(1);\n    t1.interrupt();\n    log.debug(\"æ‰§è¡Œæ‰“æ–­\");\n} finally {\n    lock.unlock();\n}\n```\n\n### é”è¶…æ—¶\n\n\u003eä¸»åŠ¨é¿å…æ­»ç­‰\n\n```java\nReentrantLock lock = new ReentrantLock();\nThread t1 = new Thread(() -\u003e {\n    log.debug(\"å¯åŠ¨...\");\n    if (!lock.tryLock()) {\n        log.debug(\"è·å–ç«‹åˆ»å¤±è´¥ï¼Œè¿”å›\");\n        return;\n    }\n    try {\n        log.debug(\"è·å¾—äº†é”\");\n    } finally {\n        lock.unlock();\n    }\n}, \"t1\");\n \nlock.lock();\nlog.debug(\"è·å¾—äº†é”\");\nt1.start();\ntry {\n    sleep(2);\n} finally {\n    lock.unlock();\n}\n```\n\n### å…¬å¹³é”\n\n\u003eä¸å…¬å¹³ï¼šæ–°çº¿ç¨‹ä¼šæ— è§†é˜Ÿåˆ—å°è¯•è·å–ä¸€æ¬¡é”ï¼Œå¤±è´¥åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹è¿˜æ˜¯æœ‰åºå”¤é†’çš„ã€‚\n\u003eå…¬å¹³é”ä¸€èˆ¬æ²¡æœ‰å¿…è¦ï¼Œä¼šé™ä½[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å¹¶å‘|å¹¶å‘]]æ€§èƒ½ã€‚\n\n### æ¡ä»¶å˜é‡\n\n- synchronized ä¸­ä¹Ÿæœ‰æ¡ä»¶å˜é‡ï¼Œå°±æ˜¯æˆ‘ä»¬è®²åŸç†æ—¶é‚£ä¸ª waitSet ä¼‘æ¯å®¤ï¼Œå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶è¿›å…¥ waitSet ç­‰å¾…\n- ReentrantLock çš„æ¡ä»¶å˜é‡æ¯” synchronized å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œå®ƒæ˜¯æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡çš„ï¼Œè¿™å°±å¥½æ¯”\n\t- synchronized æ˜¯é‚£äº›ä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹éƒ½åœ¨ä¸€é—´ä¼‘æ¯å®¤ç­‰æ¶ˆæ¯\n\t- è€Œ ReentrantLock æ”¯æŒå¤šé—´ä¼‘æ¯å®¤ï¼Œæœ‰ä¸“é—¨ç­‰çƒŸçš„ä¼‘æ¯å®¤ã€ä¸“é—¨ç­‰æ—©é¤çš„ä¼‘æ¯å®¤ã€å”¤é†’æ—¶ä¹Ÿæ˜¯æŒ‰ä¼‘æ¯å®¤æ¥å”¤é†’\n\nä½¿ç”¨è¦ç‚¹ï¼š\n- await å‰éœ€è¦è·å¾—é”\n- await æ‰§è¡Œåï¼Œä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ conditionObject ç­‰å¾…\n- await çš„çº¿ç¨‹è¢«å”¤é†’ï¼ˆæˆ–æ‰“æ–­ã€æˆ–è¶…æ—¶ï¼‰å–é‡æ–°ç«äº‰ lock é”\n- ç«äº‰ lock é”æˆåŠŸåï¼Œä» await åç»§ç»­æ‰§è¡Œ\n\n```java\nstatic ReentrantLock lock = new ReentrantLock();\nstatic Condition waitCigaretteQueue = lock.newCondition();\nstatic Condition waitbreakfastQueue = lock.newCondition();\nstatic volatile boolean hasCigrette = false;\nstatic volatile boolean hasBreakfast = false;\n \npublic static void main(String[] args) {\n    new Thread(() -\u003e {\n        try {\n            lock.lock();\n            while (!hasCigrette) {\n            try {\n                    waitCigaretteQueue.await();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            log.debug(\"ç­‰åˆ°äº†å®ƒçš„çƒŸ\");\n        } finally {\n            lock.unlock();\n        }\n    }).start();\n \n    new Thread(() -\u003e {\n        try {\n            lock.lock();\n            while (!hasBreakfast) {\n                try {\n                    waitbreakfastQueue.await();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            log.debug(\"ç­‰åˆ°äº†å®ƒçš„æ—©é¤\");\n        } finally {\n            lock.unlock();\n        }\n    }).start();\n \n    sleep(1);\n    sendBreakfast();\n    sleep(1);\n    sendCigarette();\n}\n \nprivate static void sendCigarette() {\n    lock.lock();\n    try {\n        log.debug(\"é€çƒŸæ¥äº†\");\n        hasCigrette = true;\n        waitCigaretteQueue.signal();\n    } finally {\n        lock.unlock();\n    }\n}\n \nprivate static void sendBreakfast() {\n    lock.lock();\n    try {\n        log.debug(\"é€æ—©é¤æ¥äº†\");\n        hasBreakfast = true;\n        waitbreakfastQueue.signal();\n    } finally {\n\n        lock.unlock();\n        }\n}\n```\n\n## åŸç†\n\n\u003e å¤´èŠ‚ç‚¹å¿…å®šæ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸ºnullçš„å“¨å…µèŠ‚ç‚¹ï¼Œé˜²æ­¢ç­‰å¾…é˜Ÿåˆ—è¢«åˆ åˆ°ç©ºã€‚\n\n### éå…¬å¹³\n\n![[z-oblib/z2-attachments/Pasted image 20220609203458.png]]\n\n#### åŠ è§£é”æµç¨‹\n\nä»æ„é€ å™¨å¼€å§‹çœ‹ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é”å®ç°ï¼š\n\n```java\npublic ReentrantLock() {\n    sync = new NonfairSync();\n}\n```\n\n\u003e NonfairSync ç»§æ‰¿è‡ª AQSã€‚\n\næ— ç«äº‰æ—¶ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220609210612.png]]\n\nå‡ºç°ç¬¬ä¸€ä¸ªç«äº‰ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220609210641.png]]\n\nThread-1 æ‰§è¡Œäº†ï¼š\n1. CAS å°è¯•å°† state ç”± 0 æ”¹ä¸º 1ï¼Œç»“æœå¤±è´¥\n2. è¿›å…¥ tryAcquire é€»è¾‘ï¼Œè¿™æ—¶ state å·²ç»æ˜¯1ï¼Œç»“æœä»ç„¶å¤±è´¥\n3. æ¥ä¸‹æ¥è¿›å…¥ addWaiter é€»è¾‘ï¼Œæ„é€  Node é˜Ÿåˆ—\n\t- å›¾ä¸­é»„è‰²ä¸‰è§’è¡¨ç¤ºè¯¥ Node çš„ waitStatus çŠ¶æ€ï¼Œå…¶ä¸­ 0 ä¸ºé»˜è®¤æ­£å¸¸çŠ¶æ€\n\t- Node çš„åˆ›å»ºæ˜¯æ‡’æƒ°çš„\n\t- å…¶ä¸­ç¬¬**ä¸€**ä¸ª Node ç§°ä¸º Dummyï¼ˆå“‘å…ƒï¼‰æˆ–å“¨å…µï¼Œç”¨æ¥å ä½ï¼Œå¹¶ä¸å…³è”çº¿ç¨‹\n\n\u003e å“¨å…µèŠ‚ç‚¹å½“ä½œæ˜¯ä¸€ä¸ªä¸€ç›´å­˜åœ¨çš„ç­‰å¾…é˜Ÿåˆ—å¤´èŠ‚ç‚¹ã€‚ä½œç”¨æ˜¯é˜²æ­¢ç­‰å¾…é˜Ÿåˆ—è¢«åˆ åˆ°ç©ºã€‚\n\u003e å› ä¸ºå‡ºé˜Ÿå’Œå…¥é˜Ÿå¯èƒ½åŒæ—¶å‘ç”Ÿï¼Œå¦‚æœé˜Ÿåˆ—é•¿åº¦æ˜¯1ï¼Œæ­¤æ—¶æŠŠå¤´èŠ‚ç‚¹ç›´æ¥åˆ æ‰ï¼Œå¯èƒ½å¯¼è‡´æ–°åŠ åˆ°é˜Ÿå°¾çš„èŠ‚ç‚¹é“¾åˆ°äº†é”™è¯¯çš„å‰é©±èŠ‚ç‚¹ï¼Œé€ æˆç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚\n\u003e æ‰€ä»¥å°†åºŸå¼ƒçš„èŠ‚ç‚¹å€¼ç½®ä¸ºnullï¼Œå½“ä½œæ–°çš„å¤´èŠ‚ç‚¹ï¼ˆå“¨å…µèŠ‚ç‚¹ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ é™¤ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220609211231.png]]\n\nå½“å‰çº¿ç¨‹è¿›å…¥ **acquireQueued** é€»è¾‘ï¼š\n1. acquireQueued ä¼šåœ¨ä¸€ä¸ªæ­»å¾ªç¯ä¸­ä¸æ–­å°è¯•è·å¾—é”ï¼Œå¤±è´¥åè¿›å…¥ park é˜»å¡\n2. å¦‚æœè‡ªå·±æ˜¯ç´§é‚»ç€ headï¼ˆæ’ç¬¬**äºŒ**ä½ï¼‰ï¼Œé‚£ä¹ˆå†æ¬¡ tryAcquire å°è¯•è·å–é”ï¼Œå½“ç„¶è¿™æ—¶ state ä»ä¸º 1ï¼Œå¤±è´¥\n3. è¿›å…¥ shouldParkAfterFailedAcquire é€»è¾‘ï¼Œå°†å‰é©± nodeï¼Œå³ head çš„ waitStatus æ”¹ä¸º -1ï¼Œè¿™æ¬¡è¿”å› false\n![[z-oblib/z2-attachments/Pasted image 20220609211430.png]]\n4. shouldParkAfterFailedAcquire æ‰§è¡Œå®Œæ¯•å›åˆ° acquireQueued ï¼Œå†æ¬¡ tryAcquire å°è¯•è·å–é”ï¼Œå½“ç„¶è¿™æ—¶ state ä»ä¸º 1ï¼Œå¤±è´¥\n5. å½“å†æ¬¡è¿›å…¥ shouldParkAfterFailedAcquire æ—¶ï¼Œè¿™æ—¶å› ä¸ºå…¶å‰é©± node çš„ waitStatus å·²ç»æ˜¯ -1ï¼Œè¿™æ¬¡è¿”å› true\n6. è¿›å…¥ parkAndCheckInterruptï¼Œ Thread-1 parkï¼ˆç°è‰²è¡¨ç¤ºï¼‰\n\n![[z-oblib/z2-attachments/Pasted image 20220609211502.png]]\nå†æ¬¡æœ‰å¤šä¸ªçº¿ç¨‹ç»å†ä¸Šè¿°è¿‡ç¨‹ç«äº‰å¤±è´¥ï¼Œå˜æˆè¿™ä¸ªæ ·å­\n![[z-oblib/z2-attachments/Pasted image 20220609211515.png]]\nThread-0 é‡Šæ”¾é”ï¼Œè¿›å…¥ tryRelease æµç¨‹ï¼Œå¦‚æœæˆåŠŸ\n- è®¾ç½® exclusiveOwnerThread ä¸º null\n- state = 0\n\n![[z-oblib/z2-attachments/Pasted image 20220609211528.png]]\nå½“å‰é˜Ÿåˆ—ä¸ä¸º nullï¼Œå¹¶ä¸” head çš„ waitStatus = -1ï¼Œè¿›å…¥ unparkSuccessor æµç¨‹\næ‰¾åˆ°é˜Ÿåˆ—ä¸­ç¦» head æœ€è¿‘çš„ä¸€ä¸ª Nodeï¼ˆæ²¡å–æ¶ˆçš„ï¼‰ï¼Œunpark æ¢å¤å…¶è¿è¡Œï¼Œæœ¬ä¾‹ä¸­å³ä¸º Thread-1\nå›åˆ° Thread-1 çš„ acquireQueued æµç¨‹\n\n![[z-oblib/z2-attachments/Pasted image 20220609211542.png]]\nå¦‚æœåŠ é”æˆåŠŸï¼ˆæ²¡æœ‰ç«äº‰ï¼‰ï¼Œä¼šè®¾ç½®\n- exclusiveOwnerThread ä¸º Thread-1ï¼Œstate = 1\n- head æŒ‡å‘åˆšåˆš Thread-1 æ‰€åœ¨çš„ Nodeï¼Œè¯¥ Node æ¸…ç©º Thread\n\u003e æ¸…ç©ºåï¼ŒThread-1èŠ‚ç‚¹è¢«å½“ä½œæ–°çš„å“¨å…µèŠ‚ç‚¹\n- åŸæœ¬çš„ head å› ä¸ºä»é“¾è¡¨æ–­å¼€ï¼Œè€Œå¯è¢«åƒåœ¾å›æ”¶\nå¦‚æœè¿™æ—¶å€™æœ‰å…¶å®ƒçº¿ç¨‹æ¥ç«äº‰ï¼ˆéå…¬å¹³çš„ä½“ç°ï¼‰ï¼Œä¾‹å¦‚è¿™æ—¶æœ‰ Thread-4 æ¥äº†\n\n![[z-oblib/z2-attachments/Pasted image 20220609211557.png]]\nå¦‚æœä¸å·§åˆè¢« Thread-4 å äº†å…ˆ\n- Thread-4 è¢«è®¾ç½®ä¸º exclusiveOwnerThreadï¼Œstate = 1\n- Thread-1 å†æ¬¡è¿›å…¥ acquireQueued æµç¨‹ï¼Œè·å–é”å¤±è´¥ï¼Œé‡æ–°è¿›å…¥ park é˜»å¡\n\n#### åŠ é”æºç \n\n```java\n// Sync ç»§æ‰¿è‡ª AQS\nstatic final class NonfairSync extends Sync {\n    private static final long serialVersionUID = 7316153563782823691L;\n    \n    // åŠ é”å®ç°\n    final void lock() {\n        // é¦–å…ˆç”¨ cas å°è¯•ï¼ˆä»…å°è¯•ä¸€æ¬¡ï¼‰å°† state ä» 0 æ”¹ä¸º 1, å¦‚æœæˆåŠŸè¡¨ç¤ºè·å¾—äº†ç‹¬å é”\n        if (compareAndSetState(0, 1))\n            setExclusiveOwnerThread(Thread.currentThread());\n        else\n            // å¦‚æœå°è¯•å¤±è´¥ï¼Œè¿›å…¥ ãˆ \n            acquire(1);\n    }\n    \n    // ãˆ  AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public final void acquire(int arg) {\n        // ãˆ¡ tryAcquire        \n        if (\n            !tryAcquire(arg) \u0026\u0026 \n            // å½“ tryAcquire è¿”å›ä¸º false æ—¶, å…ˆè°ƒç”¨ addWaiter ãˆ£, æ¥ç€ acquireQueued ãˆ¤\n            acquireQueued(addWaiter(Node.EXCLUSIVE), arg)\n        ) {\n            selfInterrupt();\n        }\n    }\n    \n    // ãˆ¡ è¿›å…¥ ãˆ¢\n    protected final boolean tryAcquire(int acquires) {\n        return nonfairTryAcquire(acquires);\n    }\n    \n    // ãˆ¢ Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    final boolean nonfairTryAcquire(int acquires) {\n        final Thread current = Thread.currentThread();\n        int c = getState();\n        // å¦‚æœè¿˜æ²¡æœ‰è·å¾—é”\n        if (c == 0) {\n            // å°è¯•ç”¨ cas è·å¾—, è¿™é‡Œä½“ç°äº†éå…¬å¹³æ€§: ä¸å»æ£€æŸ¥ AQS é˜Ÿåˆ—\n            if (compareAndSetState(0, acquires)) {\n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        // å¦‚æœå·²ç»è·å¾—äº†é”, çº¿ç¨‹è¿˜æ˜¯å½“å‰çº¿ç¨‹, è¡¨ç¤ºå‘ç”Ÿäº†é”é‡å…¥\n        else if (current == getExclusiveOwnerThread()) {\n            // state++\n            int nextc = c + acquires;\n            if (nextc \u003c 0) // overflow\n                throw new Error(\"Maximum lock count exceeded\");\n            setState(nextc);\n            return true;\n        }\n        // è·å–å¤±è´¥, å›åˆ°è°ƒç”¨å¤„\n        return false;\n    }\n    \n    // ãˆ£ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n\n    private Node addWaiter(Node mode) {\n    // å°†å½“å‰çº¿ç¨‹å…³è”åˆ°ä¸€ä¸ª Node å¯¹è±¡ä¸Š, æ¨¡å¼ä¸ºç‹¬å æ¨¡å¼\n        Node node = new Node(Thread.currentThread(), mode);\n        // å¦‚æœ tail ä¸ä¸º null, cas å°è¯•å°† Node å¯¹è±¡åŠ å…¥ AQS é˜Ÿåˆ—å°¾éƒ¨\n        Node pred = tail;\n        if (pred != null) {\n            node.prev = pred;\n            if (compareAndSetTail(pred, node)) {\n                // åŒå‘é“¾è¡¨\n                pred.next = node;\n                return node;\n            }\n        }\n        // å°è¯•å°† Node åŠ å…¥ AQS, è¿›å…¥ ãˆ¥\n        enq(node);\n        return node;\n    }\n    \n    // ãˆ¥ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    private Node enq(final Node node) {\n        for (;;) {\n            Node t = tail;\n            if (t == null) {\n                // è¿˜æ²¡æœ‰, è®¾ç½® head ä¸ºå“¨å…µèŠ‚ç‚¹ï¼ˆä¸å¯¹åº”çº¿ç¨‹ï¼ŒçŠ¶æ€ä¸º 0ï¼‰\n                if (compareAndSetHead(new Node())) {\n                    tail = head;\n                }\n            } else {\n                // cas å°è¯•å°† Node å¯¹è±¡åŠ å…¥ AQS é˜Ÿåˆ—å°¾éƒ¨\n                node.prev = t;\n                if (compareAndSetTail(t, node)) {\n                    t.next = node;\n                    return t;\n                }\n            }\n        }\n    }\n    \n    // ãˆ¤ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    final boolean acquireQueued(final Node node, int arg) {\n        boolean failed = true;\n        try {\n            boolean interrupted = false;\n            for (;;) {\n                final Node p = node.predecessor();\n                // ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯ head, è¡¨ç¤ºè½®åˆ°è‡ªå·±ï¼ˆå½“å‰çº¿ç¨‹å¯¹åº”çš„ nodeï¼‰äº†, å°è¯•è·å–\n                if (p == head \u0026\u0026 tryAcquire(arg)) {\n                    // è·å–æˆåŠŸ, è®¾ç½®è‡ªå·±ï¼ˆå½“å‰çº¿ç¨‹å¯¹åº”çš„ nodeï¼‰ä¸º head\n                    setHead(node);\n                    // ä¸Šä¸€ä¸ªèŠ‚ç‚¹ help GC\n                    p.next = null;\n                    failed = false;\n                    // è¿”å›ä¸­æ–­æ ‡è®° false\n\n                    return interrupted;\n                    }\n                if (\n                    // åˆ¤æ–­æ˜¯å¦åº”å½“ park, è¿›å…¥ ãˆ¦\n                    shouldParkAfterFailedAcquire(p, node) \u0026\u0026\n                    // park ç­‰å¾…, æ­¤æ—¶ Node çš„çŠ¶æ€è¢«ç½®ä¸º Node.SIGNAL ãˆ§\n                    parkAndCheckInterrupt()\n                ) {\n                    interrupted = true;\n                }\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n    }\n    \n    // ãˆ¦ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n        // è·å–ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€\n        int ws = pred.waitStatus;\n        if (ws == Node.SIGNAL) {\n            // ä¸Šä¸€ä¸ªèŠ‚ç‚¹éƒ½åœ¨é˜»å¡, é‚£ä¹ˆè‡ªå·±ä¹Ÿé˜»å¡å¥½äº†\n            return true;\n        }\n        // \u003e 0 è¡¨ç¤ºå–æ¶ˆçŠ¶æ€\n        if (ws \u003e 0) {\n            // ä¸Šä¸€ä¸ªèŠ‚ç‚¹å–æ¶ˆ, é‚£ä¹ˆé‡æ„åˆ é™¤å‰é¢æ‰€æœ‰å–æ¶ˆçš„èŠ‚ç‚¹, è¿”å›åˆ°å¤–å±‚å¾ªç¯é‡è¯•\n            do {\n                node.prev = pred = pred.prev;\n            } while (pred.waitStatus \u003e 0);\n            pred.next = node;\n        } else {\n            // è¿™æ¬¡è¿˜æ²¡æœ‰é˜»å¡\n            // ä½†ä¸‹æ¬¡å¦‚æœé‡è¯•ä¸æˆåŠŸ, åˆ™éœ€è¦é˜»å¡ï¼Œè¿™æ—¶éœ€è¦è®¾ç½®ä¸Šä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€ä¸º Node.SIGNAL\n            compareAndSetWaitStatus(pred, ws, Node.SIGNAL);\n        }\n        return false;\n    }\n    \n    // ãˆ§ é˜»å¡å½“å‰çº¿ç¨‹\n    private final boolean parkAndCheckInterrupt() {\n        LockSupport.park(this);\n        return Thread.interrupted();\n    }\n}\n```\n\n\u003eæ˜¯å¦éœ€è¦ unpark æ˜¯ç”±å½“å‰èŠ‚ç‚¹çš„**å‰é©±**èŠ‚ç‚¹çš„ waitStatus == Node.SIGNAL æ¥å†³å®šï¼Œè€Œä¸æ˜¯æœ¬èŠ‚ç‚¹çš„  waitStatus å†³å®š\n\n#### è§£é”æºç \n\n```java\n// Sync ç»§æ‰¿è‡ª AQS\nstatic final class NonfairSync extends Sync {\n    // è§£é”å®ç°\n    public void unlock() {\n        sync.release(1);\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public final boolean release(int arg) {\n        // å°è¯•é‡Šæ”¾é”, è¿›å…¥ ãˆ \n        if (tryRelease(arg)) {\n            // é˜Ÿåˆ—å¤´èŠ‚ç‚¹ unpark\n            Node h = head;            \n            if (\n                // é˜Ÿåˆ—ä¸ä¸º null\n                h != null \u0026\u0026 \n                // waitStatus == Node.SIGNAL æ‰éœ€è¦ unpark\n                h.waitStatus != 0\n            ) {\n                // unpark AQS ä¸­ç­‰å¾…çš„çº¿ç¨‹, è¿›å…¥ ãˆ¡\n                unparkSuccessor(h);\n            }\n            return true;\n        }\n        return false;\n    }\n    \n    // ãˆ  Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    protected final boolean tryRelease(int releases) {\n        // state--\n        int c = getState() - releases;\n        if (Thread.currentThread() != getExclusiveOwnerThread())\n            throw new IllegalMonitorStateException();\n        boolean free = false;\n        // æ”¯æŒé”é‡å…¥, åªæœ‰ state å‡ä¸º 0, æ‰é‡Šæ”¾æˆåŠŸ\n        if (c == 0) {\n            free = true;\n            setExclusiveOwnerThread(null);\n        }\n        setState(c);\n        return free;\n    }\n    \n    // ãˆ¡ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    private void unparkSuccessor(Node node) {\n        // å¦‚æœçŠ¶æ€ä¸º Node.SIGNAL å°è¯•é‡ç½®çŠ¶æ€ä¸º 0\n        // ä¸æˆåŠŸä¹Ÿå¯ä»¥\n        int ws = node.waitStatus;\n        if (ws \u003c 0) {\n            compareAndSetWaitStatus(node, ws, 0);\n        }\n \n        // æ‰¾åˆ°éœ€è¦ unpark çš„èŠ‚ç‚¹, ä½†æœ¬èŠ‚ç‚¹ä» AQS é˜Ÿåˆ—ä¸­è„±ç¦», æ˜¯ç”±å”¤é†’èŠ‚ç‚¹å®Œæˆçš„\n        Node s = node.next;\n        // ä¸è€ƒè™‘å·²å–æ¶ˆçš„èŠ‚ç‚¹, ä» AQS é˜Ÿåˆ—ä»åè‡³å‰æ‰¾åˆ°é˜Ÿåˆ—æœ€å‰é¢éœ€è¦ unpark çš„èŠ‚ç‚¹\n        if (s == null || s.waitStatus \u003e 0) {\n            s = null;\n            for (Node t = tail; t != null \u0026\u0026 t != node; t = t.prev)\n                if (t.waitStatus \u003c= 0)\n                    s = t;\n        }\n        if (s != null)\n            LockSupport.unpark(s.thread);\n    }\n}\n```\n\n### å¯é‡å…¥\n\n```java\nstatic final class NonfairSync extends Sync {\n    // ...\n    \n    // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    final boolean nonfairTryAcquire(int acquires) {\n        final Thread current = Thread.currentThread();\n        int c = getState();\n        if (c == 0) {\n            if (compareAndSetState(0, acquires)) {\n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        // å¦‚æœå·²ç»è·å¾—äº†é”, çº¿ç¨‹è¿˜æ˜¯å½“å‰çº¿ç¨‹, è¡¨ç¤ºå‘ç”Ÿäº†é”é‡å…¥\n        else if (current == getExclusiveOwnerThread()) {\n            // state++\n            int nextc = c + acquires;\n            if (nextc \u003c 0) // overflow\n                throw new Error(\"Maximum lock count exceeded\");\n            setState(nextc);\n            return true;\n        }\n        return false;\n    }\n    \n    // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    protected final boolean tryRelease(int releases) {\n        // state--(releases==1) \n        int c = getState() - releases;\n        if (Thread.currentThread() != getExclusiveOwnerThread())\n            throw new IllegalMonitorStateException();\n        boolean free = false;  // åªå‡è®¡æ•°ï¼Œæœªé‡Šæ”¾é”\n        // æ”¯æŒé”é‡å…¥, åªæœ‰ state å‡ä¸º 0, æ‰é‡Šæ”¾æˆåŠŸ\n        if (c == 0) {\n            free = true;\n            setExclusiveOwnerThread(null);\n        }\n        setState(c);\n        return free;\n    }\n}\n```\n\n### ä¸å¯æ‰“æ–­\n\n\u003e é»˜è®¤çš„æ¨¡å¼ã€‚\n\nåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå³ä½¿å®ƒè¢«æ‰“æ–­ï¼Œä»ä¼šé©»ç•™åœ¨ AQS é˜Ÿåˆ—ä¸­ï¼Œä¸€ç›´è¦ç­‰åˆ°è·å¾—é”åæ–¹èƒ½å¾—çŸ¥è‡ªå·±è¢«æ‰“æ–­äº†ï¼š\n\n```java\n// Sync ç»§æ‰¿è‡ª AQS\nstatic final class NonfairSync extends Sync {\n    // ...\n    \n    private final boolean parkAndCheckInterrupt() {\n        // å¦‚æœæ‰“æ–­æ ‡è®°å·²ç»æ˜¯ true, åˆ™ park ä¼šå¤±æ•ˆ\n        LockSupport.park(this);\n        // è¿”å›æ˜¯å¦è¢«æ‰“æ–­è¿‡ï¼Œinterrupted ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®°ï¼ˆä¸ºäº†äºŒæ¬¡parkä¸å—æ ‡è®°å½±å“ï¼‰\n        return Thread.interrupted();\n    }\n\t// çº¿ç¨‹æ²¡æ³•ç«‹åˆ»è·å¾—é”æ—¶ï¼Œä¼šè¿›å…¥è¯¥æ–¹æ³•\n    final boolean acquireQueued(final Node node, int arg) {\n        boolean failed = true;\n        try {\n            boolean interrupted = false;\n            for (;;) {\n                final Node p = node.predecessor();\n                if (p == head \u0026\u0026 tryAcquire(arg)) {\n                    setHead(node);\n                    p.next = null;\n                    failed = false;\n                    // è¿˜æ˜¯éœ€è¦è·å¾—é”å, æ‰èƒ½è¿”å›æ‰“æ–­çŠ¶æ€ï¼ˆè¿”å›åˆ°acquireé‡Œï¼‰\n                    return interrupted;\n                }\n                if (\n                    shouldParkAfterFailedAcquire(p, node) \u0026\u0026\n                    parkAndCheckInterrupt()\n                ) {\n                    // å¦‚æœæ˜¯å› ä¸º interrupt è¢«å”¤é†’, è¿”å›æ‰“æ–­çŠ¶æ€ä¸º true\n                    interrupted = true;\n                    // ä½†æ˜¯æ²¡æœ‰åšå…¶å®ƒå¤„ç†ï¼Œè¿˜æ˜¯ä¼šè¿›å…¥å¾ªç¯\n                    // å¾ªç¯ä¸­è¿˜æ˜¯ä¼šå»å°è¯•è·å–é”ï¼Œè¿›å…¥parké˜»å¡\n                }\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n    }\n    \n\n    public final void acquire(int arg) {\n    if (\n            !tryAcquire(arg) \u0026\u0026 \n            // å‰é¢å‡½æ•°è¢«æ‰“æ–­åè¿”å›åˆ°è¿™é‡Œ\n            acquireQueued(addWaiter(Node.EXCLUSIVE), arg)\n        ) {\n            // å¦‚æœæ‰“æ–­çŠ¶æ€ä¸º trueï¼Œä¼šæ‰§è¡Œä¸‹å±æ–¹æ³•\n            // é‡æ–°äº§ç”Ÿä¸€æ¬¡ä¸­æ–­\n            selfInterrupt();\n        }\n    }\n    \n    static void selfInterrupt() {\n        // é‡æ–°äº§ç”Ÿä¸€æ¬¡ä¸­æ–­\n        Thread.currentThread().interrupt();\n    }\n}\n```\n\n### å¯æ‰“æ–­\n\n```java\nstatic final class NonfairSync extends Sync {\n    public final void acquireInterruptibly(int arg) throws InterruptedException {\n        if (Thread.interrupted())\n            throw new InterruptedException();\n        // å¦‚æœæ²¡æœ‰è·å¾—åˆ°é”, è¿›å…¥ ãˆ \n        if (!tryAcquire(arg))\n            doAcquireInterruptibly(arg);\n    }\n    \n    // ãˆ  å¯æ‰“æ–­çš„è·å–é”æµç¨‹\n    private void doAcquireInterruptibly(int arg) throws InterruptedException {\n        final Node node = addWaiter(Node.EXCLUSIVE);\n        boolean failed = true;\n        try {\n            for (;;) {\n                final Node p = node.predecessor();\n                if (p == head \u0026\u0026 tryAcquire(arg)) {\n                    setHead(node);\n                    p.next = null; // help GC\n                    failed = false;\n                    return;\n                }\n                if (shouldParkAfterFailedAcquire(p, node) \u0026\u0026\n                    parkAndCheckInterrupt()) {\n                    // åœ¨ park è¿‡ç¨‹ä¸­å¦‚æœè¢« interrupt ä¼šè¿›å…¥æ­¤\n                    // è¿™æ—¶å€™æŠ›å‡ºå¼‚å¸¸, è€Œä¸ä¼šå†æ¬¡è¿›å…¥ for (;;)\n                    throw new InterruptedException();\n                    // ä¸ä¼šå†è¿›å…¥forå¾ªç¯ç­‰å¾…\n                }\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n    }\n}\n```\n\n### éå…¬å¹³é”\n\n\n\n### å…¬å¹³é”\n\n\u003e å…ˆæ£€æŸ¥ç­‰å¾…é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œè€Œä¸æ˜¯ä¸Šæ¥å°±CASæŠ¢å é”ã€‚\n\n```java\nstatic final class FairSync extends Sync {\n    private static final long serialVersionUID = -3000897897090466540L;\n \n    final void lock() {\n        acquire(1);\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public final void acquire(int arg) {\n        if (\n            !tryAcquire(arg) \u0026\u0026 \n            acquireQueued(addWaiter(Node.EXCLUSIVE), arg)\n        ) {\n            selfInterrupt();\n        }\n    }\n \n    // ä¸éå…¬å¹³é”ä¸»è¦åŒºåˆ«åœ¨äº tryAcquire æ–¹æ³•çš„å®ç°\n    protected final boolean tryAcquire(int acquires) {\n        final Thread current = Thread.currentThread();\n        int c = getState();\n        if (c == 0) {\n            // å…ˆæ£€æŸ¥ AQS é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹, æ²¡æœ‰æ‰å»ç«äº‰\n            // è€Œä¸æ˜¯ä¸Šæ¥å°±å°è¯•CAS\n            if (!hasQueuedPredecessors() \u0026\u0026\n                compareAndSetState(0, acquires)) {\n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        else if (current == getExclusiveOwnerThread()) {\n            int nextc = c + acquires;\n            if (nextc \u003c 0)\n                throw new Error(\"Maximum lock count exceeded\");\n            setState(nextc);\n            return true;\n        }\n        return false;\n    }\n    \n    // ãˆ  AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public final boolean hasQueuedPredecessors() {\n        Node t = tail;\n        Node h = head;\n        Node s;\n        // h != t æ—¶è¡¨ç¤ºé˜Ÿåˆ—ä¸­æœ‰ Node\n        return h != t \u0026\u0026\n            (\n\t            // è€å¤§æ˜¯å ä½ç”¨çš„èŠ‚ç‚¹\n                // (s = h.next) == null è¡¨ç¤ºé˜Ÿåˆ—ä¸­è¿˜æœ‰æ²¡æœ‰è€äºŒ\n                (s = h.next) == null || \n                // æˆ–è€…é˜Ÿåˆ—ä¸­è€äºŒçº¿ç¨‹ä¸æ˜¯æ­¤çº¿ç¨‹\n                s.thread != Thread.currentThread()\n            );\n    }\n}\n```\n\n### æ¡ä»¶å˜é‡\n\næ¯ä¸ªæ¡ä»¶å˜é‡å…¶å®å°±å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå…¶å®ç°ç±»æ˜¯ ConditionObject:\n\n#### awaitæµç¨‹\n\nå¼€å§‹ Thread-0 æŒæœ‰é”ï¼Œè°ƒç”¨ awaitï¼Œè¿›å…¥ ConditionObject çš„ addConditionWaiter æµç¨‹ã€‚\nåˆ›å»ºæ–°çš„ Node çŠ¶æ€ä¸º -2ï¼ˆNode.CONDITIONï¼‰ï¼Œå…³è” Thread-0ï¼ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—å°¾éƒ¨ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220609233958.png]]\n\næ¥ä¸‹æ¥è¿›å…¥ AQS çš„ fullyRelease æµç¨‹ï¼Œé‡Šæ”¾åŒæ­¥å™¨ä¸Šçš„é”ï¼š\n\u003efullyReleaseæ˜¯é‡Šæ”¾æ‰é‡å…¥çš„é”ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220609234005.png]]\n\nå½“å‰çº¿ç¨‹é‡Šæ”¾é”ï¼Œunpark AQS é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç«äº‰é”ï¼Œå‡è®¾æ²¡æœ‰å…¶ä»–ç«äº‰çº¿ç¨‹ï¼Œé‚£ä¹ˆ Thread-1 ç«äº‰æˆåŠŸï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220609234027.png]]\n\npark é˜»å¡ Thread-0ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220609234041.png]]\n\n```java\npublic final void await() throws InterruptedException {  \n    if (Thread.interrupted())  \n        throw new InterruptedException();  \n    Node node = addConditionWaiter();  \n    // fullyReleaseä½œç”¨æ˜¯å¯ä»¥é‡Šæ”¾æ‰é‡å…¥çš„é”\n    int savedState = fullyRelease(node);  \n    int interruptMode = 0;  \n    while (!isOnSyncQueue(node)) {  \n\t    // é˜»å¡è‡ªå·±ï¼Œ ç­‰å¾…è¢«å”¤é†’\n        LockSupport.park(this);  \n        if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)  \n            break;  \n    }  \n    if (acquireQueued(node, savedState) \u0026\u0026 interruptMode != THROW_IE)  \n        interruptMode = REINTERRUPT;  \n    if (node.nextWaiter != null) // clean up if cancelled  \n        unlinkCancelledWaiters();  \n    if (interruptMode != 0)  \n        reportInterruptAfterWait(interruptMode);  \n}\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ReentrantReadWriteLock":{"title":"ReentrantReadWriteLock","content":"# ReentrantReadWriteLock\n\nå½“è¯»æ“ä½œè¿œè¿œé«˜äºå†™æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™ä½¿ç”¨ è¯»å†™é” è®© è¯»-è¯» å¯ä»¥å¹¶å‘ï¼Œæé«˜æ€§èƒ½ã€‚ ç±»ä¼¼äºæ•°æ®åº“ä¸­çš„ select ...from ... lock in share mode\næä¾›ä¸€ä¸ª æ•°æ®å®¹å™¨ç±» å†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„ read() æ–¹æ³•ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„ write() æ–¹æ³•ï¼š\n\n## ä½¿ç”¨\n\n```java\nclass DataContainer {\n    private Object data;\n    private ReentrantReadWriteLock rw = new ReentrantReadWriteLock();\n    private ReentrantReadWriteLock.ReadLock r = rw.readLock();\n    private ReentrantReadWriteLock.WriteLock w = rw.writeLock();\n \n    public Object read() {\n        log.debug(\"è·å–è¯»é”...\");\n        r.lock();\n        try {\n            log.debug(\"è¯»å–\");\n            sleep(1);\n            return data;\n        } finally {\n            log.debug(\"é‡Šæ”¾è¯»é”...\");\n            r.unlock();\n        }\n    }\n \n    public void write() {\n        log.debug(\"è·å–å†™é”...\");\n        w.lock();\n        try {\n            log.debug(\"å†™å…¥\");\n            sleep(1);\n        } finally {\n            log.debug(\"é‡Šæ”¾å†™é”...\");\n            w.unlock();\n        }\n    }\n}\n```\n\n### æ³¨æ„\n\nè¯»é”ä¸æ”¯æŒæ¡ä»¶å˜é‡\né‡å…¥æ—¶å‡çº§ä¸æ”¯æŒï¼šå³æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹å»è·å–å†™é”ï¼Œä¼šå¯¼è‡´è·å–å†™é”æ°¸ä¹…ç­‰å¾…\n```java\nr.lock();\ntry {\n    // ...\n    w.lock();\n    try {\n        // ...\n    } finally{\n        w.unlock();\n    }\n} finally{\n  r.unlock();\n}\n \n```\n- é‡å…¥æ—¶é™çº§æ”¯æŒï¼šå³æŒæœ‰å†™é”çš„æƒ…å†µä¸‹å»è·å–è¯»é”\n```java\n// ç¼“å­˜æ•°æ®æ“ä½œç¤ºä¾‹\nclass CachedData {\n   Object data;\n    // æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœå¤±æ•ˆï¼Œéœ€è¦é‡æ–°è®¡ç®— data\n   volatile boolean cacheValid;\n   final ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();\n   void processCachedData() {\n\t// å…ˆè·å–è¯»é”\n     rwl.readLock().lock();\n     // åˆ¤æ–­ç¼“å­˜æ•°æ®æ²¡æœ‰å¤±æ•ˆ\n     if (!cacheValid) {\n       // è·å–å†™é”å‰å¿…é¡»é‡Šæ”¾è¯»é”\n       // è¯»é”ä¸æ”¯æŒå‡çº§æˆå†™é”\n       rwl.readLock().unlock();\n       rwl.writeLock().lock();\n       try {\n\t      // åŒé‡æ£€æŸ¥\n         // åˆ¤æ–­æ˜¯å¦æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»è·å–äº†å†™é”ã€æ›´æ–°äº†ç¼“å­˜, é¿å…é‡å¤æ›´æ–°\n         if (!cacheValid) {\n           data = ...\n           cacheValid = true;\n         }\n         // é™çº§ä¸ºè¯»é”, é‡Šæ”¾å†™é”, è¿™æ ·èƒ½å¤Ÿè®©å…¶å®ƒçº¿ç¨‹è¯»å–ç¼“å­˜\n         rwl.readLock().lock();\n       } finally {\n       // é‡Šæ”¾å†™é”çš„ä¸€ç¬é—´ä¼šåˆ‡æ¢ä¸ºè¯»é”\n       rwl.writeLock().unlock();\n       }\n     }\n     // è‡ªå·±ç”¨å®Œæ•°æ®, é‡Šæ”¾è¯»é”  \n     try {\n       use(data);\n     } finally {\n       rwl.readLock().unlock();\n     }\n   }\n}\n```\n\u003e ç”¨åˆ°äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å•ä¾‹æ¨¡å¼#åŒé‡æ ¡éªŒé”|åŒé‡æ ¡éªŒ]]çš„æ€è·¯ã€‚\n\n## åº”ç”¨\n\n\u003e ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚\n\næ¶‰åŠåˆ°[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ç¼“å­˜æ›´æ–°ç­–ç•¥|ç¼“å­˜æ›´æ–°ç­–ç•¥]]çš„é—®é¢˜ã€‚\n\nä½¿ç”¨è¯»å†™é”å®ç°ä¸€ä¸ªç®€å•çš„æŒ‰éœ€åŠ è½½ç¼“å­˜ï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¸€è‡´æ€§ç¼“å­˜|ä¸€è‡´æ€§ç¼“å­˜]]ã€‚\n\n## æµç¨‹\n\n\u003e stateæ ‡è¯†æ˜¯å¦ä¸ºé”å®šçŠ¶æ€ï¼Œå¹¶ä¸”é€šè¿‡æŠŠ32ä½æ‹†åˆ†æˆé«˜ä½16ä½ï¼ŒåŒºåˆ†æ˜¯è¯»/å†™é”ã€‚\n\n### t1 w.lockï¼Œt2 r.lock\n\n1. t1 æˆåŠŸä¸Šé”ï¼Œæµç¨‹ä¸ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ReentrantLock|ReentrantLock]] åŠ é”ç›¸æ¯”æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„ï¼Œä¸åŒæ˜¯**å†™**é”çŠ¶æ€å äº† state çš„**ä½** 16 ä½ï¼Œè€Œ**è¯»**é”ä½¿ç”¨çš„æ˜¯ state çš„**é«˜** 16 ä½ã€‚\n![[z-oblib/z2-attachments/Pasted image 20220610202746.png]]\n2. t2 æ‰§è¡Œ r.lockï¼Œè¿™æ—¶è¿›å…¥è¯»é”çš„ sync.acquireShared(1) æµç¨‹ï¼Œé¦–å…ˆä¼šè¿›å…¥ tryAcquireShared æµç¨‹ã€‚å¦‚æœæœ‰å†™ é”å æ®ï¼Œé‚£ä¹ˆ tryAcquireShared è¿”å› -1 è¡¨ç¤ºå¤±è´¥\n\t- tryAcquireShared è¿”å›å€¼è¡¨ç¤ºï¼š\n\t\t- -1 è¡¨ç¤ºå¤±è´¥\n\t\t- 0 è¡¨ç¤ºæˆåŠŸï¼Œä½†åç»§èŠ‚ç‚¹ä¸ä¼šç»§ç»­å”¤é†’\n\t\t- æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œè€Œä¸”æ•°å€¼æ˜¯è¿˜æœ‰å‡ ä¸ªåç»§èŠ‚ç‚¹éœ€è¦å”¤é†’ï¼Œè¯»å†™é”è¿”å› 1\n![[z-oblib/z2-attachments/Pasted image 20220610202901.png]]\n3. è¿™æ—¶ä¼šè¿›å…¥ sync.doAcquireShared(1) æµç¨‹ï¼Œé¦–å…ˆä¹Ÿæ˜¯è°ƒç”¨ addWaiter æ·»åŠ èŠ‚ç‚¹ï¼Œä¸åŒä¹‹å¤„åœ¨äºèŠ‚ç‚¹è¢«è®¾ç½®ä¸º Node.SHARED æ¨¡å¼è€Œé Node.EXCLUSIVE æ¨¡å¼ï¼Œæ³¨æ„æ­¤æ—¶ t2 ä»å¤„äºæ´»è·ƒçŠ¶æ€\n![[z-oblib/z2-attachments/Pasted image 20220610202935.png]]\n4. t2 ä¼šçœ‹çœ‹è‡ªå·±çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯è€äºŒï¼Œå¦‚æœæ˜¯ï¼Œè¿˜ä¼šå†æ¬¡è°ƒç”¨ tryAcquireShared(1) æ¥å°è¯•è·å–é”\n5. å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œåœ¨ doAcquireShared å†… for (;;) å¾ªç¯ä¸€æ¬¡ï¼ŒæŠŠå‰é©±èŠ‚ç‚¹çš„ waitStatus æ”¹ä¸º -1ï¼Œå† for (;;) å¾ªç¯ä¸€ æ¬¡å°è¯• tryAcquireShared(1) å¦‚æœè¿˜ä¸æˆåŠŸï¼Œé‚£ä¹ˆåœ¨ parkAndCheckInterrupt() å¤„ park\n![[z-oblib/z2-attachments/Pasted image 20220610203007.png]]\n\n ### t3 r.lockï¼Œt4 w.lock \n\nè¿™ç§çŠ¶æ€ä¸‹ï¼Œå‡è®¾åˆæœ‰ t3 åŠ è¯»é”å’Œ t4 åŠ å†™é”ï¼Œè¿™æœŸé—´ t1 ä»ç„¶æŒæœ‰é”ï¼Œå°±å˜æˆäº†ä¸‹é¢çš„æ ·å­ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220610203154.png]]\n\n### t1 w.unlock\n\n![[z-oblib/z2-attachments/Pasted image 20220610204847.png]]\n1. æ¥ä¸‹æ¥æ‰§è¡Œå”¤é†’æµç¨‹ sync.unparkSuccessorï¼Œå³è®©è€äºŒæ¢å¤è¿è¡Œï¼Œè¿™æ—¶ t2 åœ¨ doAcquireShared å†… parkAndCheckInterrupt() å¤„æ¢å¤è¿è¡Œ\n2. è¿™å›å†æ¥ä¸€æ¬¡ for (;;) æ‰§è¡Œ tryAcquireShared æˆåŠŸåˆ™è®©è¯»é”è®¡æ•°åŠ ä¸€\n3. è¿™æ—¶ t2 å·²ç»æ¢å¤è¿è¡Œï¼Œæ¥ä¸‹æ¥ t2 è°ƒç”¨ setHeadAndPropagate(node, 1)ï¼Œå®ƒåŸæœ¬æ‰€åœ¨èŠ‚ç‚¹è¢«ç½®ä¸ºå¤´èŠ‚ç‚¹\n![[z-oblib/z2-attachments/Pasted image 20220610204940.png]]\n4. **ä¸€æ¬¡æ€§è§£é”å¤šä¸ªè¿ç»­çš„shareèŠ‚ç‚¹**ï¼šäº‹æƒ…è¿˜æ²¡å®Œï¼Œåœ¨ setHeadAndPropagate æ–¹æ³•å†…è¿˜ä¼šæ£€æŸ¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ sharedï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨ doReleaseShared() å°† head çš„çŠ¶æ€ä» -1 æ”¹ä¸º 0 å¹¶å”¤é†’è€äºŒï¼Œè¿™æ—¶ t3 åœ¨ doAcquireShared å†… parkAndCheckInterrupt() å¤„æ¢å¤è¿è¡Œ\n5. è¿™å›å†æ¥ä¸€æ¬¡ for (;;) æ‰§è¡Œ tryAcquireShared æˆåŠŸåˆ™è®©è¯»é”è®¡æ•°åŠ ä¸€\n![[z-oblib/z2-attachments/Pasted image 20220610205244.png]]\n6. è¿™æ—¶ t3 å·²ç»æ¢å¤è¿è¡Œï¼Œæ¥ä¸‹æ¥ t3 è°ƒç”¨ setHeadAndPropagate(node, 1)ï¼Œå®ƒåŸæœ¬æ‰€åœ¨èŠ‚ç‚¹è¢«ç½®ä¸ºå¤´èŠ‚ç‚¹\n![[z-oblib/z2-attachments/Pasted image 20220610205306.png]]\n7. ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸æ˜¯ shared äº†ï¼Œå› æ­¤ä¸ä¼šç»§ç»­å”¤é†’ t4 æ‰€åœ¨èŠ‚ç‚¹\n\n### t2 r.unlockï¼Œt3 r.unlock\n\n\u003e åŒä¸€æ‰¹è¯»é”éƒ½é‡Šæ”¾äº†ï¼ˆä¾é è®¡æ•°å™¨ï¼‰ï¼Œæ‰èƒ½çœŸæ­£å»å”¤é†’åç»­çš„ç‹¬å èŠ‚ç‚¹ã€‚\n\n1. t2 è¿›å…¥ sync.releaseShared(1) ä¸­ï¼Œè°ƒç”¨ tryReleaseShared(1) è®©è®¡æ•°å‡ä¸€ï¼Œä½†ç”±äºè®¡æ•°è¿˜ä¸ä¸ºé›¶\n![[z-oblib/z2-attachments/Pasted image 20220610211041.png]]\n2. t3 è¿›å…¥ sync.releaseShared(1) ä¸­ï¼Œè°ƒç”¨ tryReleaseShared(1) è®©è®¡æ•°å‡ä¸€ï¼Œè¿™å›è®¡æ•°ä¸ºé›¶äº†ï¼Œè¿›å…¥ doReleaseShared() å°†å¤´èŠ‚ç‚¹ä» -1 æ”¹ä¸º 0 å¹¶å”¤é†’è€äºŒï¼Œå³\n![[z-oblib/z2-attachments/Pasted image 20220610211104.png]]\n3. ä¹‹å t4 åœ¨ acquireQueued ä¸­ parkAndCheckInterrupt å¤„æ¢å¤è¿è¡Œï¼Œå†æ¬¡ for (;;) è¿™æ¬¡è‡ªå·±æ˜¯è€äºŒï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–ç«äº‰ï¼ŒtryAcquire(1) æˆåŠŸï¼Œä¿®æ”¹å¤´ç»“ç‚¹ï¼Œæµç¨‹ç»“æŸ\n![[z-oblib/z2-attachments/Pasted image 20220610211128.png]]\n\n## æºç \n\n### å†™ä¸Šé”\n\n```java\nstatic final class NonfairSync extends Sync {\n    // ... çœç•¥æ— å…³ä»£ç \n    \n    // å¤–éƒ¨ç±» WriteLock æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public void lock() {\n        sync.acquire(1);\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public final void acquire(int arg) {\n        if (\n            // å°è¯•è·å¾—å†™é”å¤±è´¥\n            !tryAcquire(arg) \u0026\u0026\n            // å°†å½“å‰çº¿ç¨‹å…³è”åˆ°ä¸€ä¸ª Node å¯¹è±¡ä¸Š, æ¨¡å¼ä¸ºç‹¬å æ¨¡å¼\n            // è¿›å…¥ AQS é˜Ÿåˆ—é˜»å¡\n            acquireQueued(addWaiter(Node.EXCLUSIVE), arg)\n        ) {\n            selfInterrupt();\n        }\n    }\n    \n    // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    // è¿”å›æ˜¯å¦è·å–é”æˆåŠŸ\n    protected final boolean tryAcquire(int acquires) {\n        // è·å¾—ä½ 16 ä½, ä»£è¡¨å†™é”çš„ state è®¡æ•°\n        Thread current = Thread.currentThread();\n\n        int c = getState();\n        int w = exclusiveCount(c);\n\n\t\t// æœ‰é”\n        if (c != 0) {\n            if (\n                // c != 0 and w == 0 è¡¨ç¤ºæœ‰è¯»é”, æˆ–è€…\n                w == 0 || \n                // å¦‚æœ exclusiveOwnerThread ä¸æ˜¯è‡ªå·±\n                current != getExclusiveOwnerThread()\n            ) {\n                // è·å¾—é”å¤±è´¥\n                return false;\n            }\n            // å†™é”è®¡æ•°è¶…è¿‡ä½ 16 ä½, æŠ¥å¼‚å¸¸\n            if (w + exclusiveCount(acquires) \u003e MAX_COUNT)\n                throw new Error(\"Maximum lock count exceeded\");\n            // å†™é”é‡å…¥, è·å¾—é”æˆåŠŸ\n            setState(c + acquires);\n            return true;\n        }        \n        if (\n            // åˆ¤æ–­å†™é”æ˜¯å¦åº”è¯¥é˜»å¡, æˆ–è€…\n            writerShouldBlock() ||\n            // å°è¯•æ›´æ”¹è®¡æ•°å¤±è´¥\n            !compareAndSetState(c, c + acquires)\n        ) {\n            // è·å¾—é”å¤±è´¥\n            return false;\n        }\n        // è·å¾—é”æˆåŠŸ\n        setExclusiveOwnerThread(current);\n        return true;\n    }\n    \n    // éå…¬å¹³é” writerShouldBlock æ€»æ˜¯è¿”å› false, æ— éœ€é˜»å¡\n    final boolean writerShouldBlock() {\n        return false;\n    }\n}\n```\n\n### å†™é‡Šæ”¾\n\n```java\nstatic final class NonfairSync extends Sync {\n    // ... çœç•¥æ— å…³ä»£ç \n    \n    // WriteLock æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public void unlock() {\n        sync.release(1);\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public final boolean release(int arg) {\n        // å°è¯•é‡Šæ”¾å†™é”æˆåŠŸ\n        if (tryRelease(arg)) {\n            // unpark AQS ä¸­ç­‰å¾…çš„çº¿ç¨‹\n            Node h = head;\n            // å¦‚æœæœ‰ï¼Œå”¤é†’åç»§èŠ‚ç‚¹\n            if (h != null \u0026\u0026 h.waitStatus != 0)\n                unparkSuccessor(h);\n            return true;\n        }\n        return false;\n    }\n    \n    // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    protected final boolean tryRelease(int releases) {\n        if (!isHeldExclusively())\n            throw new IllegalMonitorStateException();\n        int nextc = getState() - releases;\n        // å› ä¸ºå¯é‡å…¥çš„åŸå› , å†™é”è®¡æ•°ä¸º 0, æ‰ç®—é‡Šæ”¾æˆåŠŸ\n        boolean free = exclusiveCount(nextc) == 0;\n        if (free) {\n            setExclusiveOwnerThread(null);\n        }\n        setState(nextc);\n        return free;\n    }\n}\n```\n\n### è¯»ä¸Šé”\n\n```java\nstatic final class NonfairSync extends Sync {\n    \n    // ReadLock æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public void lock() {\n        sync.acquireShared(1);\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public final void acquireShared(int arg) {\n        // tryAcquireShared è¿”å›è´Ÿæ•°, è¡¨ç¤ºè·å–è¯»é”å¤±è´¥\n        if (tryAcquireShared(arg) \u003c 0) {\n            doAcquireShared(arg);\n        }\n    }\n    \n    // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    protected final int tryAcquireShared(int unused) {\n        Thread current = Thread.currentThread();\n        int c = getState();\n        // å¦‚æœæ˜¯å…¶å®ƒçº¿ç¨‹æŒæœ‰å†™é”, è·å–è¯»é”å¤±è´¥\n        if (            \n            exclusiveCount(c) != 0 \u0026\u0026\n            getExclusiveOwnerThread() != current\n        ) {\n            return -1;\n            }\n        int r = sharedCount(c);\n        if (\n            // è¯»é”ä¸è¯¥é˜»å¡(å¦‚æœè€äºŒæ˜¯å†™é”ï¼Œè¯»é”è¯¥é˜»å¡), å¹¶ä¸”\n            !readerShouldBlock() \u0026\u0026\n            // å°äºè¯»é”è®¡æ•°, å¹¶ä¸”\n            r \u003c MAX_COUNT \u0026\u0026\n            // å°è¯•å¢åŠ è®¡æ•°æˆåŠŸ\n            compareAndSetState(c, c + SHARED_UNIT)\n        ) {\n            // ... çœç•¥ä¸é‡è¦çš„ä»£ç \n            return 1;\n        }\n        return fullTryAcquireShared(current);\n    }\n    \n    // éå…¬å¹³é” readerShouldBlock çœ‹ AQS é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯å†™é”\n    // true åˆ™è¯¥é˜»å¡, false åˆ™ä¸é˜»å¡\n    final boolean readerShouldBlock() {\n        return apparentlyFirstQueuedIsExclusive();\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    // ä¸ tryAcquireShared åŠŸèƒ½ç±»ä¼¼, ä½†ä¼šä¸æ–­å°è¯• for (;;) è·å–è¯»é”, æ‰§è¡Œè¿‡ç¨‹ä¸­æ— é˜»å¡\n    final int fullTryAcquireShared(Thread current) {\n        HoldCounter rh = null;\n        for (;;) {\n            int c = getState();\n            if (exclusiveCount(c) != 0) {\n                if (getExclusiveOwnerThread() != current)\n                    return -1;\n            } else if (readerShouldBlock()) {\n                // ... çœç•¥ä¸é‡è¦çš„ä»£ç \n            }\n            if (sharedCount(c) == MAX_COUNT)\n                throw new Error(\"Maximum lock count exceeded\");\n            if (compareAndSetState(c, c + SHARED_UNIT)) {\n                // ... çœç•¥ä¸é‡è¦çš„ä»£ç \n                return 1;\n            }\n        }\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    private void doAcquireShared(int arg) {\n        // å°†å½“å‰çº¿ç¨‹å…³è”åˆ°ä¸€ä¸ª Node å¯¹è±¡ä¸Š, æ¨¡å¼ä¸ºå…±äº«æ¨¡å¼\n        final Node node = addWaiter(Node.SHARED);\n        boolean failed = true;\n        try {\n            boolean interrupted = false;\n            for (;;) {\n                final Node p = node.predecessor();\n\n                if (p == head) {\n                // å†ä¸€æ¬¡å°è¯•è·å–è¯»é”\n                    int r = tryAcquireShared(arg);\n                    // æˆåŠŸ\n                    if (r \u003e= 0) {\n                        // ãˆ \n                        // r è¡¨ç¤ºå¯ç”¨èµ„æºæ•°, åœ¨è¿™é‡Œæ€»æ˜¯ 1 å…è®¸ä¼ æ’­\n                        //ï¼ˆå”¤é†’ AQS ä¸­ä¸‹ä¸€ä¸ª Share èŠ‚ç‚¹ï¼‰\n                        setHeadAndPropagate(node, r);\n                        p.next = null; // help GC\n                        if (interrupted)\n                            selfInterrupt();\n                        failed = false;\n                        return;\n                    }\n                }\n                if (\n                    // æ˜¯å¦åœ¨è·å–è¯»é”å¤±è´¥æ—¶é˜»å¡ï¼ˆå‰ä¸€ä¸ªé˜¶æ®µ waitStatus == Node.SIGNALï¼‰\n                    shouldParkAfterFailedAcquire(p, node) \u0026\u0026\n                    // park å½“å‰çº¿ç¨‹\n                    parkAndCheckInterrupt()\n                ) {\n                    interrupted = true;\n                }\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n    }\n    \n    // ãˆ  AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    private void setHeadAndPropagate(Node node, int propagate) {\n        Node h = head; // Record old head for check below\n        // è®¾ç½®è‡ªå·±ä¸º head\n        setHead(node);\n        \n        // propagate è¡¨ç¤ºæœ‰å…±äº«èµ„æºï¼ˆä¾‹å¦‚å…±äº«è¯»é”æˆ–ä¿¡å·é‡ï¼‰\n        // åŸ head waitStatus == Node.SIGNAL æˆ– Node.PROPAGATE\n        // ç°åœ¨ head waitStatus == Node.SIGNAL æˆ– Node.PROPAGATE\n        if (propagate \u003e 0 || h == null || h.waitStatus \u003c 0 ||\n            (h = head) == null || h.waitStatus \u003c 0) {\n            Node s = node.next;\n            // å¦‚æœæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…æ˜¯ç­‰å¾…å…±äº«è¯»é”çš„èŠ‚ç‚¹\n            if (s == null || s.isShared()) {\n                // è¿›å…¥ ãˆ¡\n                doReleaseShared();\n            }\n        }\n    }\n    \n    // ãˆ¡ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    private void doReleaseShared() {\n        // å¦‚æœ head.waitStatus == Node.SIGNAL ==\u003e 0 æˆåŠŸ, ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unpark\n        // å¦‚æœ head.waitStatus == 0 ==\u003e Node.PROPAGATE, ä¸ºäº†è§£å†³ bug, è§åé¢åˆ†æ\n        for (;;) {\n            Node h = head;\n            // é˜Ÿåˆ—è¿˜æœ‰èŠ‚ç‚¹\n            if (h != null \u0026\u0026 h != tail) {\n                int ws = h.waitStatus;\n                if (ws == Node.SIGNAL) {\n                    if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0))\n                        continue;            // loop to recheck cases\n                    // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unpark å¦‚æœæˆåŠŸè·å–è¯»é”\n                    // å¹¶ä¸”ä¸‹ä¸‹ä¸ªèŠ‚ç‚¹è¿˜æ˜¯ shared, ç»§ç»­ doReleaseShared\n                    unparkSuccessor(h);\n                }\n                else if (ws == 0 \u0026\u0026\n                         !compareAndSetWaitStatus(h, 0, Node.PROPAGATE))\n                    continue;                // loop on failed CAS\n            }\n            if (h == head)                   // loop if head changed\n                break;\n        }\n    }\n}\n```\n\n- tryAcquireShared è¿”å›å€¼è¡¨ç¤ºï¼š\n\t- -1 è¡¨ç¤ºå¤±è´¥\n\t- 0 è¡¨ç¤ºæˆåŠŸï¼Œä½†åç»§èŠ‚ç‚¹ä¸ä¼šç»§ç»­å”¤é†’ï¼ˆè¿™é‡Œç”¨ä¸åˆ°0ï¼‰\n\t- æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œè€Œä¸”æ•°å€¼æ˜¯è¿˜æœ‰å‡ ä¸ªåç»§èŠ‚ç‚¹éœ€è¦å”¤é†’ï¼Œè¯»å†™é”è¿”å› 1\n\n### è¯»é‡Šæ”¾\n\n```java\nstatic final class NonfairSync extends Sync {\n    \n    // ReadLock æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public void unlock() {\n        sync.releaseShared(1);\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    public final boolean releaseShared(int arg) {\n        if (tryReleaseShared(arg)) {\n            doReleaseShared();\n            return true;\n        }\n        return false;\n    }\n    \n    // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    // åˆ¤æ–­è®¡æ•°å™¨æ˜¯å¦æ»¡è¶³å¯ä»¥é‡Šæ”¾é”\n    protected final boolean tryReleaseShared(int unused) {\n        // ... çœç•¥ä¸é‡è¦çš„ä»£ç \n        for (;;) {\n            int c = getState();\n            int nextc = c - SHARED_UNIT;\n            if (compareAndSetState(c, nextc)) {\n                // è¯»é”çš„è®¡æ•°ä¸ä¼šå½±å“å…¶å®ƒè·å–è¯»é”çº¿ç¨‹, ä½†ä¼šå½±å“å…¶å®ƒè·å–å†™é”çº¿ç¨‹\n                // è®¡æ•°ä¸º 0 æ‰æ˜¯çœŸæ­£é‡Šæ”¾\n                return nextc == 0;\n            }\n        }\n    }\n    \n    // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„\n    private void doReleaseShared() {\n        // å¦‚æœ head.waitStatus == Node.SIGNAL ==\u003e 0 æˆåŠŸ, ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unpark\n        // å¦‚æœ head.waitStatus == 0 ==\u003e Node.PROPAGATE \n        for (;;) {\n            Node h = head;\n            if (h != null \u0026\u0026 h != tail) {\n                int ws = h.waitStatus;\n                // å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿåœ¨é‡Šæ”¾è¯»é”ï¼Œé‚£ä¹ˆéœ€è¦å°† waitStatus å…ˆæ”¹ä¸º 0\n                // é˜²æ­¢ unparkSuccessor è¢«å¤šæ¬¡æ‰§è¡Œ\n                if (ws == Node.SIGNAL) {\n                    if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0))\n                        continue;            // loop to recheck cases\n                    unparkSuccessor(h);\n                }\n                // å¦‚æœå·²ç»æ˜¯ 0 äº†ï¼Œæ”¹ä¸º -3ï¼Œç”¨æ¥è§£å†³ä¼ æ’­æ€§ï¼Œè§åæ–‡ä¿¡å·é‡ bug åˆ†æ\n                else if (ws == 0 \u0026\u0026\n                         !compareAndSetWaitStatus(h, 0, Node.PROPAGATE))\n                    continue;                // loop on failed CAS\n            }\n            if (h == head)                   // loop if head changed\n                break;\n        }\n    }    \n}\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Runnable":{"title":"Runnable","content":"# Runnable\n\nç”¨æ¥æ‰¿è½½ä¾›Threadå¯¹è±¡æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå°†ä»»åŠ¡ä»Threadä¸­æŠ½å‡ºæ¥å¯ä»¥æ›´åŠ çµæ´»ã€‚\n\n```java\nRunnable runnable = () -\u003e log.debug(\"runnable\");  // lambda\nThread t2 = new Thread(runnable);\n```\n\nå› ä¸ºRunnableæ˜¯ä¸€ä¸ª@FunctionalInterfaceæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/lambda|lambda]]çš„å½¢å¼å®ç°ã€‚\né€šè¿‡æŠŠæ–¹æ³•åŒ…è£…æˆRunnableæ›´åŠ çµæ´»ï¼Œå¹¶ä¸”Runnableå¯¹[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± |çº¿ç¨‹æ± ]]ç­‰é«˜çº§APIæ›´åŠ å‹å¥½ã€‚è¿™ç§æ€æƒ³ä¹Ÿå°±æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/ç»„åˆä¼˜äºç»§æ‰¿|ç»„åˆä¼˜äºç»§æ‰¿]]ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Semaphore":{"title":"Semaphore","content":"# Semaphore\n\n[ËˆsÉ›mÉ™ËŒfÉ”r] ä¿¡å·é‡ï¼Œç”¨æ¥é™åˆ¶èƒ½åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ä¸Šé™ã€‚\n\n## åº”ç”¨\n\n- ä½¿ç”¨ Semaphore é™æµï¼Œåœ¨è®¿é—®é«˜å³°æœŸæ—¶ï¼Œè®©è¯·æ±‚çº¿ç¨‹é˜»å¡ï¼Œé«˜å³°æœŸè¿‡å»å†é‡Šæ”¾è®¸å¯ï¼Œå½“ç„¶å®ƒåªé€‚åˆé™åˆ¶å•æœºçº¿ç¨‹æ•°é‡ï¼Œå¹¶ä¸”ä»…æ˜¯é™åˆ¶çº¿ç¨‹æ•°ï¼Œè€Œä¸æ˜¯é™åˆ¶èµ„æºæ•°ï¼ˆä¾‹å¦‚è¿æ¥æ•°ï¼Œè¯·å¯¹æ¯” Tomcat LimitLatch çš„å®ç°ï¼‰\n- ç”¨  Semaphore å®ç°ç®€å•è¿æ¥æ± ï¼Œå¯¹æ¯”ã€[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/äº«å…ƒæ¨¡å¼|äº«å…ƒæ¨¡å¼]]ã€ä¸‹çš„å®ç°ï¼ˆç”¨wait notifyï¼‰ï¼Œæ€§èƒ½å’Œå¯è¯»æ€§æ˜¾ç„¶æ›´å¥½ï¼Œæ³¨æ„ä¸‹é¢çš„å®ç°ä¸­çº¿ç¨‹æ•°å’Œæ•°æ®åº“è¿æ¥æ•°æ˜¯ç›¸ç­‰çš„\n\n### ç®€åŒ–è¿æ¥æ± \n\nä¸€ç§äº«å…ƒæ¨¡å¼åº”ç”¨ã€‚\n\n```java\nclass Pool {\n    // 1. è¿æ¥æ± å¤§å°\n    private final int poolSize;\n \n    // 2. è¿æ¥å¯¹è±¡æ•°ç»„\n    private Connection[] connections;\n \n    // 3. è¿æ¥çŠ¶æ€æ•°ç»„ 0 è¡¨ç¤ºç©ºé—²ï¼Œ 1 è¡¨ç¤ºç¹å¿™\n    private AtomicIntegerArray states;\n \n    private Semaphore semaphore;\n    // 4. æ„é€ æ–¹æ³•åˆå§‹åŒ–\n    public Pool(int poolSize) {\n        this.poolSize = poolSize;\n        // è®©è®¸å¯æ•°ä¸èµ„æºæ•°ä¸€è‡´\n        this.semaphore = new Semaphore(poolSize);\n        this.connections = new Connection[poolSize];\n        this.states = new AtomicIntegerArray(new int[poolSize]);\n        for (int i = 0; i \u003c poolSize; i++) {\n            connections[i] = new MockConnection(\"è¿æ¥\" + (i+1));\n        }\n    }\n \n    // 5. å€Ÿè¿æ¥\n    public Connection borrow() {// t1, t2, t3\n        // è·å–è®¸å¯\n        try {\n            semaphore.acquire(); // æ²¡æœ‰è®¸å¯çš„çº¿ç¨‹ï¼Œåœ¨æ­¤ç­‰å¾…\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        for (int i = 0; i \u003c poolSize; i++) {\n            // è·å–ç©ºé—²è¿æ¥\n            if(states.get(i) == 0) {\n                if (states.compareAndSet(i, 0, 1)) {\n                    log.debug(\"borrow {}\", connections[i]);\n                    return connections[i];\n                }\n            }\n        }\n        // ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ\n        return null;\n    }\n    // 6. å½’è¿˜è¿æ¥\n    public void free(Connection conn) {\n        for (int i = 0; i \u003c poolSize; i++) {\n            if (connections[i] == conn) {\n                states.set(i, 0);\n                log.debug(\"free {}\", conn);\n                semaphore.release();\n                break;\n            }\n        }\n    }\n}\n```\n\n## åŸç†\n\n### åŠ è§£é”æµç¨‹\n\nSemaphore æœ‰ç‚¹åƒä¸€ä¸ªåœè½¦åœºï¼Œpermits å°±å¥½åƒåœè½¦ä½æ•°é‡ï¼Œå½“çº¿ç¨‹è·å¾—äº† permits å°±åƒæ˜¯è·å¾—äº†åœè½¦ä½ï¼Œç„¶ååœè½¦åœºæ˜¾ç¤ºç©ºä½™è½¦ä½å‡ä¸€ã€‚\n\n1. åˆšå¼€å§‹ï¼Œpermitsï¼ˆstateï¼‰ä¸º 3ï¼Œè¿™æ—¶ 5 ä¸ªçº¿ç¨‹æ¥è·å–èµ„æº\n![[z-oblib/z2-attachments/Pasted image 20220610231154.png]]\n2. å‡è®¾å…¶ä¸­ Thread-1ï¼ŒThread-2ï¼ŒThread-4 cas ç«äº‰æˆåŠŸï¼Œè€Œ Thread-0 å’Œ Thread-3 ç«äº‰å¤±è´¥ï¼Œè¿›å…¥ AQS é˜Ÿåˆ— park é˜»å¡\n![[z-oblib/z2-attachments/Pasted image 20220610231219.png]]\n3. è¿™æ—¶ Thread-4 é‡Šæ”¾äº† permitsï¼ŒçŠ¶æ€å¦‚ä¸‹\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/StampedLock":{"title":"StampedLock","content":"# StampedLock\n\nè¯¥ç±»è‡ª JDK 8 åŠ å…¥ï¼Œæ˜¯ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–è¯»æ€§èƒ½ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨ä½¿ç”¨è¯»é”ã€å†™é”æ—¶éƒ½å¿…é¡»é…åˆã€æˆ³ã€‘ä½¿ç”¨ã€‚\n\n\u003e ä¸€ä¸ªç‰¹æ®Šçš„è¯»å†™é”ã€‚\n\n## ä½¿ç”¨\n\n### è¯»é”\n\n```java\nlong stamp = lock.readLock();\nlock.unlockRead(stamp);\n```\n\n### å†™é”\n\n```java\nlong stamp = lock.writeLock();\nlock.unlockWrite(stamp);\n```\n\n### ä¹è§‚è¯»\n\nStampedLock æ”¯æŒ tryOptimisticRead() æ–¹æ³•ï¼ˆä¹è§‚è¯»ï¼‰ï¼Œè¯»å–å®Œæ¯•åéœ€è¦åšä¸€æ¬¡ æˆ³æ ¡éªŒ å¦‚æœæ ¡éªŒé€šè¿‡ï¼Œè¡¨ç¤ºè¿™æœŸé—´ç¡®å®æ²¡æœ‰å†™æ“ä½œï¼Œæ•°æ®å¯ä»¥å®‰å…¨ä½¿ç”¨ï¼Œå¦‚æœæ ¡éªŒæ²¡é€šè¿‡ï¼Œéœ€è¦é‡æ–°è·å–è¯»é”ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚\n\n```java\nlong stamp = lock.tryOptimisticRead();\n// éªŒæˆ³\nif(!lock.validate(stamp)){\n    // é”å‡çº§\n}\n```\n\n### ç”¨ä¾‹\n\næä¾›ä¸€ä¸ª æ•°æ®å®¹å™¨ç±» å†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„ read() æ–¹æ³•ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„ write() æ–¹æ³•ï¼š\n```java\nclass DataContainerStamped {\n    private int data;\n    private final StampedLock lock = new StampedLock();\n \n    public DataContainerStamped(int data) {\n        this.data = data;\n    }\n \n    public int read(int readTime) {\n        long stamp = lock.tryOptimisticRead();\n        log.debug(\"optimistic read locking...{}\", stamp);\n        sleep(readTime);\n        if (lock.validate(stamp)) {\n            log.debug(\"read finish...{}, data:{}\", stamp, data);\n            return data;\n        }\n        // é”å‡çº§ - è¯»é”\n        log.debug(\"updating to read lock... {}\", stamp);\n        try {\n            stamp = lock.readLock();\n            log.debug(\"read lock {}\", stamp);\n            sleep(readTime);\n            log.debug(\"read finish...{}, data:{}\", stamp, data);\n            return data;\n        } finally {\n            log.debug(\"read unlock {}\", stamp);\n            lock.unlockRead(stamp);\n        }\n    }\n \n    public void write(int newData) {\n        long stamp = lock.writeLock();\n        log.debug(\"write lock {}\", stamp);\n        try {\n            sleep(2);\n            this.data = newData;\n        } finally {\n            log.debug(\"write unlock {}\", stamp);\n            lock.unlockWrite(stamp);\n        }\n    }\n}\n```\n\n\n## ç¼ºç‚¹\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Thread":{"title":"Thread","content":"# Thread\n\nThreadæ˜¯ä¸€ä¸ªå®ç°äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/Runnable|Runnable]]æ¥å£çš„ç±»ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«è‡ªå®šä¹‰ä»»åŠ¡çš„Threadå¯¹è±¡æœ‰ä¸¤ç§æ–¹å¼ï¼š\n1. é€šè¿‡ç»§æ‰¿Threadç±»å¹¶é‡å†™run()æ–¹æ³•æ¥å®ç°ã€‚\n2. é€šè¿‡å®ä¾‹åŒ–Threadç±»æ—¶ä¼ å…¥Runnableå¯¹è±¡æ¥å®ç°ã€‚\n\nå¯ä»¥ç”¨ä¸¤ç§æ–¹å¼æ¥å®ç°å› ä¸ºThreadä¸­é»˜è®¤çš„run()æ–¹æ³•é‡‡ç”¨äº†ä»£ç†çš„æ€æƒ³ï¼š\n\n```java\n@Override  \npublic void run() {  \n    if (target != null) {  \n        target.run();  \n    }  \n}\n```\n\nä¸Šè¿°ä»£ç targetå°±æ˜¯ä¼ å…¥çš„Runnableå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥ï¼Œåˆ™éœ€è¦ç»§æ‰¿Threadå¹¶é‡å†™è¯¥æ–¹æ³•ã€‚è¿™æ ·çš„æ–¹å¼å°±èƒ½å®ç°æœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›å»ºè‡ªå·±çš„Threadç±»ã€‚è€Œé€šè¿‡æŠŠæ–¹æ³•åŒ…è£…æˆRunnableå¯¹è±¡å†ä¼ é€’ç»™Threadæ›´åŠ çµæ´»ï¼Œå¹¶ä¸”Runnableå¯¹[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± |çº¿ç¨‹æ± ]]ç­‰é«˜çº§APIæ›´åŠ å‹å¥½ã€‚è¿™ç§æ€æƒ³ä¹Ÿå°±æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/ç»„åˆä¼˜äºç»§æ‰¿|ç»„åˆä¼˜äºç»§æ‰¿]]ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadPoolExecutor":{"title":"ThreadPoolExecutor","content":"# ThreadPoolExecutor\n\n![[z-oblib/z2-attachments/Pasted image 20220607225611.png]]\n\n## çº¿ç¨‹æ± çŠ¶æ€\n\nThreadPoolExecutor ä½¿ç”¨ int çš„é«˜ 3 ä½æ¥è¡¨ç¤º[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± |çº¿ç¨‹æ± ]]çŠ¶æ€ï¼Œä½ 29 ä½è¡¨ç¤º[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]æ•°é‡ï¼š\n\n| çŠ¶æ€å     | é«˜3ä½ | æ¥æ”¶æ–°ä»»åŠ¡ | å¤„ç†é˜»å¡é˜Ÿåˆ—ä»»åŠ¡ | è¯´æ˜                                       |\n| ---------- | ----- | ---------- | ---------------- | ------------------------------------------ |\n| RUNNING    | 111   | Y          | Y                |                                            |\n| SHUTDOWN   | 000   | N          | Y                | ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—å‰©ä½™ä»»åŠ¡   |\n| STOP       | 001   | N          | N                | ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—ä»»åŠ¡   |\n| TIDYING    | 010   |            |                  | ä»»åŠ¡å…¨æ‰§è¡Œå®Œæ¯•ï¼Œæ´»åŠ¨çº¿ç¨‹ä¸º 0 å³å°†è¿›å…¥ ç»ˆç»“ |\n| TERMINATED | 011   |            |                  | ç»ˆç»“çŠ¶æ€                                           |\n\nä»æ•°å­—ä¸Šæ¯”è¾ƒï¼ŒTERMINATED \u003e TIDYING \u003e STOP \u003e SHUTDOWN \u003e RUNNINGã€‚\n\u003e æœ‰ç¬¦å·ä½ï¼Œ111ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥RUNNINGæœ€å°ã€‚\n\nç›®çš„ä¸ä¸»è¦æ˜¯èŠ‚çº¦ç©ºé—´ï¼šè¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªåŸå­å˜é‡ ctl ä¸­ï¼Œç›®çš„æ˜¯å°†çº¿ç¨‹æ± çŠ¶æ€ä¸çº¿ç¨‹ä¸ªæ•°åˆäºŒä¸ºä¸€ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨ä¸€æ¬¡ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/CAS|cas]] åŸå­æ“ä½œè¿›è¡Œèµ‹å€¼ã€‚\n\n```java\n// c ä¸ºæ—§å€¼ï¼Œ ctlOf è¿”å›ç»“æœä¸ºæ–°å€¼\nctl.compareAndSet(c, ctlOf(targetState, workerCountOf(c))));\n \n// rs ä¸ºé«˜ 3 ä½ä»£è¡¨çº¿ç¨‹æ± çŠ¶æ€ï¼Œ wc ä¸ºä½ 29 ä½ä»£è¡¨çº¿ç¨‹ä¸ªæ•°ï¼Œctl æ˜¯åˆå¹¶å®ƒä»¬\nprivate static int ctlOf(int rs, int wc) { return rs | wc; }\n```\n\n## æ„é€ æ–¹æ³•\n\n\u003e æ„é€ æ–¹æ³•çš„å‚æ•°å†³å®šäº†çº¿ç¨‹æ± çš„å¤§å¤šæ•°è¡Œä¸ºã€‚\n\n```java\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue\u003cRunnable\u003e workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler)\n```\n\n- corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ç›® (æœ€å¤šä¿ç•™çš„çº¿ç¨‹æ•°)\n- maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ç›®\n- keepAliveTime ç”Ÿå­˜æ—¶é—´ - é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹\n- unit æ—¶é—´å•ä½ - é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹\n- workQueue [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é˜»å¡é˜Ÿåˆ—|é˜»å¡é˜Ÿåˆ—]]\n- threadFactory çº¿ç¨‹å·¥å‚ - å¯ä»¥ä¸ºçº¿ç¨‹åˆ›å»ºæ—¶èµ·ä¸ªå¥½åå­—\n- handler æ‹’ç»ç­–ç•¥\n\u003e å¯ä»¥ç±»æ¯”[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è‡ªå®šä¹‰çº¿ç¨‹æ± |è‡ªå®šä¹‰çº¿ç¨‹æ± ]]ä¸­çš„ç›¸å…³è®¾è®¡æ€è·¯ã€‚\n\n### çº¿ç¨‹å·¥ä½œæ–¹å¼\n\nåœ¨æ ¸å¿ƒçº¿ç¨‹éƒ½è¢«å ç”¨çš„æƒ…å†µä¸‹ï¼Œæ•‘æ€¥çº¿ç¨‹ä¼šå‡ºæ¥æ‰§è¡Œä»»åŠ¡ï¼Œä»»åŠ¡æ‰§è¡Œå®Œåä¼šé”€æ¯ã€‚\nè€Œæ ¸å¿ƒçº¿ç¨‹åœ¨æ— ä»»åŠ¡çš„æƒ…å†µä¸‹ä¸ä¼šé”€æ¯ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220607231221.png]]\n![[z-oblib/z2-attachments/Pasted image 20220607231227.png]]\n\n- çº¿ç¨‹æ± ä¸­åˆšå¼€å§‹æ²¡æœ‰çº¿ç¨‹ï¼Œå½“ä¸€ä¸ªä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚\n- å½“çº¿ç¨‹æ•°è¾¾åˆ° corePoolSize å¹¶æ²¡æœ‰çº¿ç¨‹ç©ºé—²ï¼Œè¿™æ—¶å†åŠ å…¥ä»»åŠ¡ï¼Œæ–°åŠ çš„ä»»åŠ¡ä¼šè¢«åŠ å…¥workQueue é˜Ÿåˆ—æ’é˜Ÿï¼Œç›´åˆ°æœ‰ç©ºé—²çš„çº¿ç¨‹ã€‚\n- å¦‚æœé˜Ÿåˆ—é€‰æ‹©äº†**æœ‰ç•Œé˜Ÿåˆ—**ï¼Œé‚£ä¹ˆä»»åŠ¡è¶…è¿‡äº†é˜Ÿåˆ—å¤§å°æ—¶ï¼Œä¼šåˆ›å»º `maximumPoolSize - corePoolSize`æ•°ç›®çš„çº¿ç¨‹æ¥**æ•‘æ€¥**ã€‚\n\t\u003e æ•‘æ€¥çº¿ç¨‹é…åˆæœ‰ç•Œé˜Ÿåˆ—ä½¿ç”¨ã€‚\n- å¦‚æœçº¿ç¨‹åˆ°è¾¾ `maximumPoolSize` ä»ç„¶æœ‰æ–°ä»»åŠ¡è¿™æ—¶ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\n- JDKæä¾›äº†4ç§æ‹’ç»ç­–ç•¥ï¼š\n\t1. AbortPolicy è®©è°ƒç”¨è€…æŠ›å‡ºRejectedExecutionException å¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥\n\t2. CallerRunsPolicy è®©è°ƒç”¨è€…è¿è¡Œä»»åŠ¡\n\t3. DiscardPolicy æ”¾å¼ƒæœ¬æ¬¡ä»»åŠ¡\n\t4. DiscardOldestPolicy æ”¾å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—©çš„ä»»åŠ¡ï¼Œæœ¬ä»»åŠ¡å–è€Œä»£ä¹‹\n- å…¶å®ƒè‘—åæ¡†æ¶ä¹Ÿæä¾›äº†æ‹’ç»ç­–ç•¥å®ç°ï¼š\n\t- Dubbo çš„å®ç°ï¼Œåœ¨æŠ›å‡º RejectedExecutionException å¼‚å¸¸ä¹‹å‰ä¼šè®°å½•æ—¥å¿—ï¼Œå¹¶ dump çº¿ç¨‹æ ˆä¿¡æ¯ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜\n\t- Netty çš„å®ç°ï¼Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡\n\t- ActiveMQ çš„å®ç°ï¼Œå¸¦è¶…æ—¶ç­‰å¾…ï¼ˆ60sï¼‰å°è¯•æ”¾å…¥é˜Ÿåˆ—ï¼Œç±»ä¼¼æˆ‘ä»¬ä¹‹å‰è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥\n\t- PinPoint çš„å®ç°ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªæ‹’ç»ç­–ç•¥é“¾ï¼Œä¼šé€ä¸€å°è¯•ç­–ç•¥é“¾ä¸­æ¯ç§æ‹’ç»ç­–ç•¥\n- å½“é«˜å³°è¿‡å»åï¼Œè¶…è¿‡corePoolSize çš„æ•‘æ€¥çº¿ç¨‹å¦‚æœä¸€æ®µæ—¶é—´æ²¡æœ‰ä»»åŠ¡åšï¼Œéœ€è¦ç»“æŸèŠ‚çœèµ„æºï¼Œè¿™ä¸ªæ—¶é—´ç”±keepAliveTime å’Œ unit æ¥æ§åˆ¶ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220607231450.png]]\n\n## å·¥å‚æ–¹æ³•\n\n\u003e æ„é€ æ–¹æ³•çš„å‚æ•°å¤ªå¤šï¼Œç”¨èµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼ŒJDKåˆæä¾›äº†å·¥å…·ç±»æä¾›å¾ˆå¤šå·¥å‚æ–¹æ³•ï¼Œåˆ›å»ºä¸åŒçº¿ç¨‹æ± ï¼Œå†…éƒ¨å°±æ˜¯è°ƒç”¨ä¸Šè¿°æ„é€ æ–¹æ³•å¹¶ä¼ é€’ä¸åŒå‚æ•°ã€‚\n\næ ¹æ®è¿™ä¸ªæ„é€ æ–¹æ³•ï¼ŒJDK Executors ç±»ä¸­æä¾›äº†ä¼—å¤šå·¥å‚æ–¹æ³•æ¥åˆ›å»ºå„ç§ç”¨é€”çš„çº¿ç¨‹æ± ã€‚\n\n### newFixedThreadPool\n\n```java\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n    return new ThreadPoolExecutor(nThreads, nThreads,\n                                  0L, TimeUnit.MILLISECONDS,\n                                  new LinkedBlockingQueue\u003cRunnable\u003e());\n}\n```\n\n#### ç‰¹ç‚¹\n\n- æ ¸å¿ƒçº¿ç¨‹æ•° == æœ€å¤§çº¿ç¨‹æ•°ï¼ˆæ²¡æœ‰æ•‘æ€¥çº¿ç¨‹è¢«åˆ›å»ºï¼‰ï¼Œå› æ­¤ä¹Ÿæ— éœ€è¶…æ—¶æ—¶é—´\n- é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼Œå¯ä»¥æ”¾ä»»æ„æ•°é‡çš„ä»»åŠ¡\n\n#### ä½¿ç”¨åœºæ™¯\n\né€‚ç”¨äºä»»åŠ¡é‡å·²çŸ¥ï¼Œç›¸å¯¹è€—æ—¶çš„ä»»åŠ¡ã€‚\n\n### newCachedThreadPool\n\n\u003e å…¨å‘˜éƒ½æ˜¯å¤–åŒ…@åä¸º\n\n```java\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue\u003cRunnable\u003e());\n}\n```\n\n#### ç‰¹ç‚¹\n\n- æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯ 0ï¼Œ æœ€å¤§çº¿ç¨‹æ•°æ˜¯ Integer.MAX_VALUEï¼Œæ•‘æ€¥çº¿ç¨‹çš„ç©ºé—²ç”Ÿå­˜æ—¶é—´æ˜¯ 60sï¼Œæ„å‘³ç€ï¼š\n\t- å…¨éƒ¨éƒ½æ˜¯æ•‘æ€¥çº¿ç¨‹ï¼ˆ60s åå¯ä»¥å›æ”¶ï¼‰\n\t- æ•‘æ€¥çº¿ç¨‹å¯ä»¥æ— é™åˆ›å»º\n- é˜Ÿåˆ—é‡‡ç”¨äº† SynchronousQueue å®ç°ç‰¹ç‚¹æ˜¯ï¼Œå®ƒ**æ²¡æœ‰å®¹é‡**ï¼Œæ²¡æœ‰çº¿ç¨‹æ¥å–æ˜¯æ”¾ä¸è¿›å»çš„ï¼ˆä¸€æ‰‹äº¤é’±ã€ä¸€æ‰‹äº¤è´§ï¼‰\n- æ•´ä¸ªçº¿ç¨‹æ± è¡¨ç°ä¸ºçº¿ç¨‹æ•°ä¼šæ ¹æ®ä»»åŠ¡é‡ä¸æ–­å¢é•¿ï¼Œæ²¡æœ‰ä¸Šé™ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç©ºé—² 1åˆ†é’Ÿåé‡Šæ”¾çº¿ç¨‹ã€‚ \n\n#### ä½¿ç”¨åœºæ™¯\n\né€‚åˆä»»åŠ¡æ•°æ¯”è¾ƒ**å¯†é›†**ï¼Œä½†æ¯ä¸ªä»»åŠ¡**æ‰§è¡Œæ—¶é—´**è¾ƒ**çŸ­**çš„æƒ…å†µã€‚\n\n### newSingleThreadExecutor\n\n```java\npublic static ExecutorService newSingleThreadExecutor() {\n\t// æ²¡æœ‰ç›´æ¥è¿”å›çº¿ç¨‹æ± å¯¹è±¡\n\t// ç”¨è£…é¥°å™¨æ¨¡å¼è¿›è¡Œäº†åŒ…è£…\n\t// é™åˆ¶äº†è¿”å›å¯¹è±¡èƒ½è°ƒç”¨çš„æ–¹æ³•\n    return new FinalizableDelegatedExecutorService\n        (new ThreadPoolExecutor(1, 1,\n                                0L, TimeUnit.MILLISECONDS,\n                                new LinkedBlockingQueue\u003cRunnable\u003e()));\n}\n```\n\n#### ç‰¹ç‚¹\n\n- å¥å£®æ€§ï¼š\n\t- è‡ªå·±åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥è€Œç»ˆæ­¢é‚£ä¹ˆæ²¡æœ‰ä»»ä½•è¡¥æ•‘æªæ–½ï¼Œåç»­è¦åˆ›å»ºçš„çº¿ç¨‹ä¹Ÿæ— æ³•æ‰§è¡Œã€‚\n\t- è€Œçº¿ç¨‹æ± è¿˜ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¿è¯æ± çš„æ­£å¸¸å·¥ä½œï¼Œä¸€ä¸ªçº¿ç¨‹å¤±è´¥ä¸å½±å“åç»­çº¿ç¨‹æ‰§è¡Œã€‚\n- Executors.newSingleThreadExecutor() çº¿ç¨‹ä¸ªæ•°å§‹ç»ˆä¸º1\n\t- çº¿ç¨‹æ•°ä¸èƒ½ä¿®æ”¹ã€‚\n\t- FinalizableDelegatedExecutorService åº”ç”¨çš„æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/è£…é¥°å™¨æ¨¡å¼]]ï¼Œåªå¯¹å¤–æš´éœ²äº†ExecutorService æ¥å£ï¼Œå› æ­¤ä¸èƒ½è°ƒç”¨ ThreadPoolExecutor ä¸­ç‰¹æœ‰çš„æ–¹æ³•ï¼Œé˜²æ­¢è®¾ç½®è¢«ä¿®æ”¹ã€‚\n- Executors.newFixedThreadPool(1) åˆå§‹æ—¶ä¸º1æ—¶å’ŒSingleThreadExecutorä¸€æ ·ï¼š\n\t- çº¿ç¨‹æ•°åç»­è¿˜å¯ä»¥ä¿®æ”¹ã€‚\n\t- å¯¹å¤–æš´éœ²çš„æ˜¯ ThreadPoolExecutor å¯¹è±¡ï¼Œå¯ä»¥å¼ºè½¬åè°ƒç”¨ setCorePoolSize ç­‰æ–¹æ³•è¿›è¡Œä¿®æ”¹æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚\n\n#### ä½¿ç”¨åœºæ™¯\n\nå¸Œæœ›å¤šä¸ªä»»åŠ¡æ’é˜Ÿæ‰§è¡Œï¼šçº¿ç¨‹æ•°å›ºå®šä¸º **1**ï¼Œä»»åŠ¡æ•°å¤šäº 1 æ—¶ï¼Œä¼šæ”¾å…¥**æ— ç•Œ**é˜Ÿåˆ—æ’é˜Ÿã€‚ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™å”¯ä¸€çš„çº¿ç¨‹ä¹Ÿ**ä¸ä¼š**è¢«é‡Šæ”¾ã€‚\n\n## æäº¤ä»»åŠ¡\n\n```java\n// æ‰§è¡Œä»»åŠ¡\nvoid execute(Runnable command);\n \n// æäº¤ä»»åŠ¡ taskï¼Œç”¨è¿”å›å€¼ Future è·å¾—ä»»åŠ¡æ‰§è¡Œç»“æœ\n// ä¿æŠ¤æ€§æš‚åœæ¨¡å¼\n// ç”¨æ¥åœ¨ä¸»çº¿ç¨‹ç§æ¥æ”¶çº¿ç¨‹æ± ç§çº¿ç¨‹è¿”å›çš„ç»“æœ\n\u003cT\u003e Future\u003cT\u003e submit(Callable\u003cT\u003e task);\n \n// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡\n\u003cT\u003e List\u003cFuture\u003cT\u003e\u003e invokeAll(Collection\u003c? extends Callable\u003cT\u003e\u003e tasks)\n        throws InterruptedException;\n \n// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå¸¦è¶…æ—¶æ—¶é—´\n\u003cT\u003e List\u003cFuture\u003cT\u003e\u003e invokeAll(Collection\u003c? extends Callable\u003cT\u003e\u003e tasks,\n                                  long timeout, TimeUnit unit)\n        throws InterruptedException;\n \n// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå“ªä¸ªä»»åŠ¡å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›æ­¤ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå…¶å®ƒä»»åŠ¡å–æ¶ˆ\n\u003cT\u003e T invokeAny(Collection\u003c? extends Callable\u003cT\u003e\u003e tasks)\n\n        throws InterruptedException, ExecutionException;\n        // æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå“ªä¸ªä»»åŠ¡å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›æ­¤ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå…¶å®ƒä»»åŠ¡å–æ¶ˆï¼Œå¸¦è¶…æ—¶æ—¶é—´\n\u003cT\u003e T invokeAny(Collection\u003c? extends Callable\u003cT\u003e\u003e tasks,\n                    long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n```\n\n- submitçš„è¿”å›å€¼é [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ä¿æŠ¤æ€§æš‚åœ|ä¿æŠ¤æ€§æš‚åœ]]å®ç°ï¼ŒFutureç±»ä¼¼GuardedObjectã€‚\n\n## å…³é—­çº¿ç¨‹æ± \n\n### shutdown\n\n```java\n/*\nçº¿ç¨‹æ± çŠ¶æ€å˜ä¸º SHUTDOWN\n - ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡\n - ä½†å·²æäº¤ä»»åŠ¡ä¼šæ‰§è¡Œå®Œ\n - æ­¤æ–¹æ³•ä¸ä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹çš„æ‰§è¡Œ\n*/\nvoid shutdown();\n```\n\n```java\npublic void shutdown() {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        // ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€\n        advanceRunState(SHUTDOWN);\n        // ä»…ä¼šæ‰“æ–­ç©ºé—²çº¿ç¨‹\n        interruptIdleWorkers();\n        onShutdown(); // æ‰©å±•ç‚¹ ScheduledThreadPoolExecutor\n    } finally {\n        mainLock.unlock();\n    }\n    // å°è¯•ç»ˆç»“(æ²¡æœ‰è¿è¡Œçš„çº¿ç¨‹å¯ä»¥ç«‹åˆ»ç»ˆç»“ï¼Œå¦‚æœè¿˜æœ‰è¿è¡Œçš„çº¿ç¨‹ä¹Ÿä¸ä¼šç­‰)\n    // è®©é‚£äº›è¿˜æœªç»“æŸçš„çº¿ç¨‹è‡ªç­ï¼Œæˆ‘ä¸ç®¡äº†\n    tryTerminate();\n}\n```\n\n### shutdownNow\n\n```java\n/*\nçº¿ç¨‹æ± çŠ¶æ€å˜ä¸º STOP\n - ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡\n - ä¼šå°†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿”å›\n - å¹¶ç”¨ interrupt çš„æ–¹å¼ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡\n*/\nList\u003cRunnable\u003e shutdownNow();\n```\n\n```java\npublic List\u003cRunnable\u003e shutdownNow() {\nList\u003cRunnable\u003e tasks;\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        // ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€\n        advanceRunState(STOP);\n        // æ‰“æ–­æ‰€æœ‰çº¿ç¨‹\n        interruptWorkers();\n        // è·å–é˜Ÿåˆ—ä¸­å‰©ä½™ä»»åŠ¡\n        tasks = drainQueue();\n    } finally {\n        mainLock.unlock();\n    }\n    // å°è¯•ç»ˆç»“\n    tryTerminate();\n    return tasks;\n}\n```\n\n## å…¶å®ƒæ–¹æ³•\n\n```java\n// ä¸åœ¨ RUNNING çŠ¶æ€çš„çº¿ç¨‹æ± ï¼Œæ­¤æ–¹æ³•å°±è¿”å› true\nboolean isShutdown();\n \n// çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦æ˜¯ TERMINATED\nboolean isTerminated();\n \n// è°ƒç”¨ shutdown åï¼Œç”±äºè°ƒç”¨çº¿ç¨‹å¹¶ä¸ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡è¿è¡Œç»“æŸï¼Œå› æ­¤å¦‚æœå®ƒæƒ³åœ¨çº¿ç¨‹æ±  TERMINATED ååšäº›äº‹æƒ…ï¼Œå¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•ç­‰å¾…\n// ç­‰å¾…çº¿ç¨‹å…¨éƒ¨ç»“æŸæˆ–ç­‰å¾…è¶…æ—¶\nboolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException;\n```\n\n## ä»»åŠ¡å¼‚å¸¸å¤„ç†\n\n ### ä¸»åŠ¨æ•æ‰\n\n```java\nExecutorService pool = Executors.newFixedThreadPool(1);\npool.submit(() -\u003e {\n    try {\n        log.debug(\"task1\");\n        int i = 1 / 0;\n    } catch (Exception e) {\n        log.error(\"error:\", e);\n    }\n});\n```\n\n### ä½¿ç”¨Future\n\n```java\nExecutorService pool = Executors.newFixedThreadPool(1);\nFuture\u003cBoolean\u003e f = pool.submit(() -\u003e {\n    log.debug(\"task1\");\n    int i = 1 / 0;\n    return true;\n});\nlog.debug(\"result:{}\", f.get());\n```\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Timer":{"title":"Timer","content":"# Timer\n\nåœ¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± |ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± ]]åŠŸèƒ½åŠ å…¥ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ java.util.Timer æ¥å®ç°å®šæ—¶åŠŸèƒ½ï¼ŒTimer çš„ä¼˜ç‚¹åœ¨äºç®€å•æ˜“ç”¨ï¼Œä½† ç”±äºæ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ç”±**åŒä¸€ä¸ª**çº¿ç¨‹æ¥è°ƒåº¦ï¼Œå› æ­¤æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯**ä¸²è¡Œ**æ‰§è¡Œçš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå‰ä¸€ä¸ª ä»»åŠ¡çš„å»¶è¿Ÿæˆ–å¼‚å¸¸éƒ½å°†ä¼šå½±å“åˆ°ä¹‹åçš„ä»»åŠ¡ã€‚\n\n```java\npublic static void main(String[] args) {\n    Timer timer = new Timer();\n    TimerTask task1 = new TimerTask() {\n        @Override\n        public void run() {\n            log.debug(\"task 1\");\n\n            sleep(2);\n            }\n    };\n    TimerTask task2 = new TimerTask() {\n        @Override\n        public void run() {\n            log.debug(\"task 2\");\n        }\n    };\n    // ä½¿ç”¨ timer æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ï¼Œå¸Œæœ›å®ƒä»¬éƒ½åœ¨ 1s åæ‰§è¡Œ\n    // ä½†ç”±äº timer å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥é¡ºåºæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå› æ­¤ã€ä»»åŠ¡1ã€çš„å»¶æ—¶ï¼Œå½±å“äº†ã€ä»»åŠ¡2ã€çš„æ‰§è¡Œ\n    timer.schedule(task1, 1000);\n    timer.schedule(task2, 1000);\n}\n```\n\n## ç¼ºç‚¹\n\nåä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œä¼šå—åˆ°å‰ä¸€ä¸ªçº¿ç¨‹çš„å½±å“ï¼š\n- å¼€å§‹æ—¶é—´ä¼šå—åˆ¶äºå‰ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ã€‚\n- å‰ä¸€ä¸ªçº¿ç¨‹å¼‚å¸¸ä¼šå½±å“åé¢çš„çº¿ç¨‹ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Unsafe":{"title":"Unsafe","content":"# Unsafe\n\nUnsafe å¯¹è±¡æä¾›äº†éå¸¸åº•å±‚çš„ï¼Œæ“ä½œå†…å­˜ã€çº¿ç¨‹çš„æ–¹æ³•ï¼ŒUnsafe å¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡åå°„è·å¾—ã€‚\n\n```java\npublic class UnsafeAccessor {\n    static Unsafe unsafe;\n \n    static {\n        try {            \n            Field theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");\n            theUnsafe.setAccessible(true);\n            unsafe = (Unsafe) theUnsafe.get(null);\n        } catch (NoSuchFieldException | IllegalAccessException e) {\n            throw new Error(e);\n        }\n    }\n \n    static Unsafe getUnsafe() {\n        return unsafe;\n    }\n}\n```\n\né€šè¿‡åå°„è·å–ï¼š\n\n```java\nimport sun.misc.Unsafe;  \n  \nimport java.lang.reflect.Field;  \n  \npublic class Test18Unsafe {  \n    public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException {  \n        Field theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");  \n        theUnsafe.setAccessible(true);  // è®¿é—®ç§æœ‰æˆå‘˜  \n        Unsafe unsafe = (Unsafe) theUnsafe.get(null);  \n        System.out.println(unsafe);  \n    }  \n}\n```\n\n## CASæ“ä½œ\n\n#TODO","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/forkjoin":{"title":"fork\u0026join","content":"# fork\u0026join\n\n## æ¦‚å¿µ\n\n- Fork/Join æ˜¯ JDK 1.7 åŠ å…¥çš„æ–°çš„çº¿ç¨‹æ± å®ç°ï¼Œå®ƒä½“ç°çš„æ˜¯ä¸€ç§åˆ†æ²»æ€æƒ³ï¼Œé€‚ç”¨äºèƒ½å¤Ÿè¿›è¡Œä»»åŠ¡æ‹†åˆ†çš„ **cpu** å¯†é›†å‹è¿ç®—\n- æ‰€è°“çš„ä»»åŠ¡æ‹†åˆ†ï¼Œæ˜¯å°†ä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºç®—æ³•ä¸Šç›¸åŒçš„å°ä»»åŠ¡ï¼Œç›´è‡³ä¸èƒ½æ‹†åˆ†å¯ä»¥ç›´æ¥æ±‚è§£ã€‚è·Ÿé€’å½’ç›¸å…³çš„ä¸€äº›è®¡ç®—ï¼Œå¦‚å½’å¹¶æ’åºã€æ–æ³¢é‚£å¥‘æ•°åˆ—ã€éƒ½å¯ä»¥ç”¨åˆ†æ²»æ€æƒ³è¿›è¡Œæ±‚è§£\n- Fork/Join åœ¨åˆ†æ²»çš„åŸºç¡€ä¸ŠåŠ å…¥äº†å¤šçº¿ç¨‹ï¼Œå¯ä»¥æŠŠæ¯ä¸ªä»»åŠ¡çš„åˆ†è§£å’Œåˆå¹¶äº¤ç»™ä¸åŒçš„çº¿ç¨‹æ¥å®Œæˆï¼Œè¿›ä¸€æ­¥æå‡äº†è¿ç®—æ•ˆç‡\n- Fork/Join é»˜è®¤ä¼šåˆ›å»ºä¸ cpu æ ¸å¿ƒæ•°å¤§å°**ç›¸åŒ**çš„çº¿ç¨‹æ± \n\n## ä½¿ç”¨\n\næäº¤ç»™ Fork/Join çº¿ç¨‹æ± çš„ä»»åŠ¡éœ€è¦ç»§æ‰¿ RecursiveTaskï¼ˆæœ‰è¿”å›å€¼ï¼‰æˆ– RecursiveActionï¼ˆæ²¡æœ‰è¿”å›å€¼ï¼‰ï¼Œä¾‹å¦‚ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªå¯¹ 1~n ä¹‹é—´çš„æ•´æ•°æ±‚å’Œçš„ä»»åŠ¡ï¼š\n\n```java\nclass AddTask1 extends RecursiveTask\u003cInteger\u003e {\n \n    int n;\n \n    public AddTask1(int n) {\n        this.n = n;\n    }\n \n    @Override\n    public String toString() {\n        return \"{\" + n + '}';\n    }\n \n    @Override\n    protected Integer compute() {\n        // å¦‚æœ n å·²ç»ä¸º 1ï¼Œå¯ä»¥æ±‚å¾—ç»“æœäº†\n        if (n == 1) {\n            log.debug(\"join() {}\", n);\n            return n;\n        }\n        \n        // å°†ä»»åŠ¡è¿›è¡Œæ‹†åˆ†(fork)\n        AddTask1 t1 = new AddTask1(n - 1);\n        t1.fork();\n        log.debug(\"fork() {} + {}\", n, t1);\n        \n        // åˆå¹¶(join)ç»“æœ\n        int result = n + t1.join();\n        log.debug(\"join() {} + {} = {}\", n, t1, result);\n        return result;\n    }\n}\n```\n\næäº¤ç»™ForkJoinPoolæ‰§è¡Œï¼š\n\n```java\npublic static void main(String[] args) {\n    ForkJoinPool pool = new ForkJoinPool(4);\n    System.out.println(pool.invoke(new AddTask1(5)));\n}\n```\n\n![[z-oblib/z2-attachments/Pasted image 20220608214020.png]]\n\n## æ”¹è¿›\n\n```java\nclass AddTask3 extends RecursiveTask\u003cInteger\u003e {\n    \n    int begin;\n    int end;\n \n    public AddTask3(int begin, int end) {\n        this.begin = begin;\n        this.end = end;\n    }\n \n    @Override\n    public String toString() {\n        return \"{\" + begin + \",\" + end + '}';\n    }\n \n    @Override\n    protected Integer compute() {\n        // 5, 5\n        if (begin == end) {\n            log.debug(\"join() {}\", begin);\n            return begin;\n        }\n\n        // 4, 5\n        if (end - begin == 1) {\n            log.debug(\"join() {} + {} = {}\", begin, end, end + begin);\n            return end + begin;\n        }\n        \n        // 1 5\n        int mid = (end + begin) / 2; // 3\n \n        AddTask3 t1 = new AddTask3(begin, mid); // 1,3\n        t1.fork();\n        AddTask3 t2 = new AddTask3(mid + 1, end); // 4,5\n        t2.fork();\n        log.debug(\"fork() {} + {} = ?\", t1, t2);\n \n        int result = t1.join() + t2.join();\n        log.debug(\"join() {} + {} = {}\", t1, t2, result);\n        return result;\n    }\n}\n```\n\næäº¤ç»™ ForkJoinPool æ¥æ‰§è¡Œï¼š\n\n```java\npublic static void main(String[] args) {\n    ForkJoinPool pool = new ForkJoinPool(4);\n    System.out.println(pool.invoke(new AddTask3(1, 10)));\n}\n```\n\n![[z-oblib/z2-attachments/Pasted image 20220608214123.png]]\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/happens-before":{"title":"happens-before","content":"# happens-before\n\n## ä»€ä¹ˆæ˜¯happens-before\n\n**å¦‚æœæ“ä½œA happens-beforeæ“ä½œBï¼Œé‚£ä¹ˆæ“ä½œAåœ¨å†…å­˜ä¸Šæ‰€åšçš„æ“ä½œå¯¹æ“ä½œBéƒ½æ˜¯å¯è§çš„ï¼Œä¸ç®¡å®ƒä»¬åœ¨ä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ã€‚**\n\nä¸€æ–¹é¢ï¼Œç¨‹åºå‘˜éœ€è¦JMMæä¾›ä¸€ä¸ªå¼ºçš„å†…å­˜æ¨¡å‹æ¥ç¼–å†™ä»£ç ï¼›å¦ä¸€æ–¹é¢ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸Œæœ›JMMå¯¹å®ƒä»¬çš„æŸç¼šè¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥æœ€å¯èƒ½å¤šçš„åšä¼˜åŒ–æ¥æé«˜æ€§èƒ½ï¼Œå¸Œæœ›çš„æ˜¯ä¸€ä¸ªå¼±çš„å†…å­˜æ¨¡å‹ã€‚\n\nJMMè€ƒè™‘äº†è¿™ä¸¤ç§éœ€æ±‚ï¼Œå¹¶ä¸”æ‰¾åˆ°äº†å¹³è¡¡ç‚¹ï¼Œå¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ¥è¯´ï¼Œåªè¦ä¸æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœï¼ˆå•çº¿ç¨‹ç¨‹åºå’Œæ­£ç¡®åŒæ­¥äº†çš„å¤šçº¿ç¨‹ç¨‹åºï¼‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ€ä¹ˆä¼˜åŒ–éƒ½è¡Œã€‚\n\nè€Œå¯¹äºç¨‹åºå‘˜ï¼ŒJMMæä¾›äº†**happens-beforeè§„åˆ™**ï¼ˆJSR-133è§„èŒƒï¼‰ï¼Œæ»¡è¶³äº†ç¨‹åºå‘˜çš„éœ€æ±‚â€”â€”ç®€å•æ˜“æ‡‚ï¼Œå¹¶ä¸”æä¾›äº†è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚æ¢è¨€ä¹‹ï¼Œç¨‹åºå‘˜åªè¦éµå¾ªhappens-beforeè§„åˆ™ï¼Œé‚£ä»–å†™çš„ç¨‹åºå°±èƒ½ä¿è¯åœ¨JMMä¸­å…·æœ‰å¼ºçš„å†…å­˜å¯è§æ€§ã€‚\n\nJMMä½¿ç”¨happens-beforeçš„æ¦‚å¿µæ¥å®šåˆ¶ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚è¿™ä¸¤ä¸ªæ“ä½œå¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä»¥å†…ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ã€‚å› æ­¤ï¼ŒJMMå¯ä»¥é€šè¿‡happens-beforeå…³ç³»å‘ç¨‹åºå‘˜æä¾›è·¨çº¿ç¨‹çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚\n\nhappens-beforeå…³ç³»çš„å®šä¹‰å¦‚ä¸‹ï¼š\n1. æ¦‚å¿µï¼šå¦‚æœä¸€ä¸ªæ“ä½œhappens-beforeå¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§ï¼Œè€Œä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚\n2. å®é™…æ˜¯ç»“æœä¸ºå¯¼å‘ï¼šä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€Javaå¹³å°çš„å…·ä½“å®ç°å¿…é¡»è¦æŒ‰ç…§happens-beforeå…³ç³»æŒ‡å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚**å¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœï¼Œä¸æŒ‰happens-beforeå…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆJMMä¹Ÿå…è®¸è¿™æ ·çš„é‡æ’åº**ã€‚\n\n\u003ehappens-beforeå…³ç³»æœ¬è´¨ä¸Šå’Œas-if-serialè¯­ä¹‰æ˜¯ä¸€å›äº‹ã€‚\nas-if-serialè¯­ä¹‰ä¿è¯å•çº¿ç¨‹å†…é‡æ’åºåçš„æ‰§è¡Œç»“æœå’Œç¨‹åºä»£ç æœ¬èº«åº”æœ‰çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œhappens-beforeå…³ç³»ä¿è¯æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¢«é‡æ’åºæ”¹å˜ã€‚\n\n## æ»¡è¶³çš„å‡ ç§æƒ…å†µ\n\n### synchronized\n\nçº¿ç¨‹è§£é” m ä¹‹å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºæ¥ä¸‹æ¥å¯¹ m åŠ é”çš„å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§ï¼š\n```java\nstatic int x;\nstatic Object m = new Object();\n \nnew Thread(()-\u003e{\n    synchronized(m) {\n        x = 10;\n        }\n},\"t1\").start();\n \nnew Thread(()-\u003e{\n    synchronized(m) {\n        System.out.println(x);\n    }\n},\"t2\").start();\n```\n\n### volatile\n\nçº¿ç¨‹å¯¹ volatile å˜é‡çš„å†™ï¼Œå¯¹**æ¥ä¸‹æ¥**å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§\n```java\nvolatile static int x;\n \nnew Thread(()-\u003e{\n    x = 10;\n},\"t1\").start();\n \nnew Thread(()-\u003e{\n    System.out.println(x);\n},\"t2\").start();\n```\n\n### çº¿ç¨‹å¯åŠ¨å‰\n\nçº¿ç¨‹ start å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹è¯¥çº¿ç¨‹å¼€å§‹åå¯¹è¯¥å˜é‡çš„è¯»å¯è§\n```java\nstatic int x;\n \nx = 10;\n \nnew Thread(()-\u003e{\n    System.out.println(x);\n},\"t2\").start();\n```\n\n### çº¿ç¨‹ç»“æŸå‰\nçº¿ç¨‹ç»“æŸå‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¾—çŸ¥å®ƒç»“æŸåçš„è¯»å¯è§ï¼ˆæ¯”å¦‚å…¶å®ƒçº¿ç¨‹è°ƒç”¨ t1.isAlive() æˆ– t1.join()ç­‰å¾… å®ƒç»“æŸï¼‰\n```java\nstatic int x;\n \nThread t1 = new Thread(()-\u003e{\n    x = 10;\n},\"t1\");\nt1.start();\n \nt1.join();\nSystem.out.println(x);\n```\n\n### çº¿ç¨‹æ‰“æ–­\n\nçº¿ç¨‹ t1 æ‰“æ–­ t2ï¼ˆinterruptï¼‰å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºå…¶ä»–çº¿ç¨‹å¾—çŸ¥ t2 è¢«æ‰“æ–­åå¯¹å˜é‡çš„è¯»å¯è§ï¼ˆé€šè¿‡ t2.interrupted æˆ– t2.isInterruptedï¼‰\n```java\nstatic int x;\n \npublic static void main(String[] args) {\n    Thread t2 = new Thread(()-\u003e{\n        while(true) {\n            if(Thread.currentThread().isInterrupted()) {\n                System.out.println(x);\n                break;\n            }\n        }\n    },\"t2\");\n    t2.start();\n \n    new Thread(()-\u003e{\n        sleep(1);\n        x = 10;\n        t2.interrupt();\n    },\"t1\").start();\n \n    while(!t2.isInterrupted()) {\n        Thread.yield();\n    }\n    System.out.println(x);\n}\n```\n\n### é»˜è®¤å€¼\n\nå¯¹å˜é‡é»˜è®¤å€¼ï¼ˆ0ï¼Œfalseï¼Œnullï¼‰çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§\n\n### ä¼ é€’æ€§\n\nvolatileçš„ç‰¹æ€§ï¼š\n```java\nvolatile static int x;\nstatic int y;\n \nnew Thread(()-\u003e{    \n    y = 10;\n    x = 20;\n},\"t1\").start();\n \nnew Thread(()-\u003e{\n    // x=20 å¯¹ t2 å¯è§, åŒæ—¶ y=10 ä¹Ÿå¯¹ t2 å¯è§\n    System.out.println(x); \n},\"t2\").start();\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/interrupt":{"title":"interrupt","content":"# interrupt\n\n## æ‰“æ–­ sleep, wait, join çš„çº¿ç¨‹\n\ninterruptå¼ºè¡Œæ‰“æ–­çº¿ç¨‹ï¼š\n\nçº¿ç¨‹ä¼šè®°å½•æœ¬èº«æ˜¯å¦è¢«æ‰“æ–­è¿‡ï¼Œä½†æ˜¯sleep, wait, join ä»¥å¼‚å¸¸çš„æ–¹å¼å“åº”interruptåä¼šæ¸…é™¤å¼‚å¸¸æ ‡è®°ï¼ŒisInterrupted() == falseã€‚\n\n```java\npublic static void main(String[] args) throws InterruptedException {  \n    Thread t1 = new Thread(()-\u003e{  \n        log.debug(\"sleep...\");  \n        try {  \n            Thread.sleep(5000);  \n        } catch (InterruptedException e) {  \n            throw new RuntimeException(e);  \n        }  \n    });  \n    t1.start();  \n    Thread.sleep(500);  // ä¸»çº¿ç¨‹ç­‰t1å…ˆç¡ç€  \n    t1.interrupt();  \n    log.debug(\"æ‰“æ–­æ ‡è®°ï¼š{}\", t1.isInterrupted());  \n}\n```\n\n## æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹\n\ninterruptè®©ä½ è‡ªè¡Œäº†æ–­ï¼š\n\nå¯¹äºæ­£å¸¸è¿è¡Œçš„çº¿ç¨‹ï¼Œinterruptä¸»è¦æ˜¯è®¾ç½®æ‰“æ–­æ ‡è®°ï¼Œç”±çº¿ç¨‹ä»£ç æ ¹æ®æ‰“æ–­æ ‡è®°æ¥æŠ‰æ‹©å½“å‰çº¿ç¨‹æ˜¯è¦ç»§ç»­è¿è¡Œè¿˜æ˜¯å°±æ­¤ç»ˆæ­¢ã€‚\n\n```java\npublic static void main(String[] args) throws InterruptedException {  \n    Thread t1 = new Thread(()-\u003e{  \n        while (true){  \n            boolean interrupted = Thread.currentThread().isInterrupted();  \n            if(interrupted) {  \n                log.debug(\"æˆ‘è¢«æ‰“æ–­äº†\");  \n                break;            }\n        }  \n    });  \n    t1.start();  \n    Thread.sleep(500);  \n    log.debug(\"interrupt\");  \n    t1.interrupt();  \n}\n```\n\n### ä¸ºä»€ä¹ˆä¼šä¸ä¸€æ ·\n\nå› ä¸ºçº¿ç¨‹ç¡ç€çš„æ—¶å€™æ²¡æ³•ä¹Ÿä¸çŸ¥é“åˆ«äººæœ‰æ²¡æœ‰æ‰“æ–­ä»–ï¼Œçº¿ç¨‹æ²¡æœ‰åœ¨æ‰§è¡Œï¼Œæ‰€ä»¥ç”±å…¶ä»–äººå¼ºè¡ŒæŠŠä»–æ€äº†ã€‚\n\nè€Œçº¿ç¨‹æ²¡æœ‰ç¡ç€çš„æ—¶å€™ï¼Œèƒ½æ„ŸçŸ¥åˆ°æ˜¯å¦æœ‰åˆ«çš„çº¿ç¨‹åœ¨æ‰“æ–­ä»–ï¼Œè¿™æ ·å°±èƒ½è®©çº¿ç¨‹è‡ªå·±è‡ªè¡Œäº†æ–­ï¼Œæ–¹ä¾¿åšä¸€äº›å–„åå¤„ç†ã€‚\n\n## æ‰“æ–­parkçš„çº¿ç¨‹\n\n```java\nprivate static void test3() throws InterruptedException {\n    Thread t1 = new Thread(() -\u003e {\n        log.debug(\"park...\");\n        LockSupport.park();\n        log.debug(\"unpark...\");\n        log.debug(\"æ‰“æ–­çŠ¶æ€ï¼š{}\", Thread.currentThread().isInterrupted());\n        LockSupport.park();  // è¿™é‡Œparkä¸èµ·æ•ˆ\n    }, \"t1\");\n    t1.start();\n\n \n    sleep(0.5);\n    t1.interrupt();\n}\n```\n\nparkåªèƒ½åœ¨æ‰“æ–­æ ‡è®°æ˜¯falseçš„æ—¶å€™èµ·æ•ˆæœï¼ŒisInterruptedä¸ä¼šé‡ç½®æ‰“æ–­æ ‡è®°ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªparkä¸èµ·æ•ˆã€‚å¯ä»¥ç”¨interruptedé‡ç½®æ‰“æ–­æ ‡è®°ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/java%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B":{"title":"javaå®ˆæŠ¤çº¿ç¨‹","content":"# javaå®ˆæŠ¤çº¿ç¨‹\n\nä¸»çº¿ç¨‹ç»“æŸæ—¶ä¸ç®¡å®ˆæŠ¤çº¿ç¨‹è¿˜æœ‰æ²¡æœ‰å…¶å®ƒä»»åŠ¡ï¼Œéƒ½ä¼šå¼ºåˆ¶ç»“æŸå®ˆæŠ¤çº¿ç¨‹ã€‚\n\nä¸»è¦ç”¨åœ¨ï¼š\n- åƒåœ¾å›æ”¶å™¨çº¿ç¨‹ã€‚\n- Tomcatä¸­çš„Accetorå’ŒPollerçº¿ç¨‹ã€‚ï¼ˆç»“æŸtomcatåä¸ä¼šç­‰å¾…å½“å‰è¯·æ±‚å¤„ç†å®Œæˆè€Œæ˜¯ä¼šç›´æ¥ç»“æŸè¿è¡Œï¼‰ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/java%E7%BA%BF%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2":{"title":"javaçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰","content":"# javaçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰\n\nå› ä¸ºä»¥ä¸‹ä¸€äº›åŸå› å¯¼è‡´ cpu ä¸å†æ‰§è¡Œå½“å‰çš„çº¿ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„ä»£ç ï¼š\n- çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ\n- åƒåœ¾å›æ”¶\n- æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ\n- çº¿ç¨‹è‡ªå·±è°ƒç”¨äº† sleepã€yieldã€waitã€joinã€parkã€synchronizedã€lock ç­‰æ–¹æ³•\n\n- å½“ Context Switch å‘ç”Ÿæ—¶ï¼Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿ**ä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€**ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ã€‚\n- Java ä¸­å¯¹åº”çš„æ¦‚å¿µå°±æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®°ä½ä¸‹ä¸€æ¡ jvm æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œæ˜¯**çº¿ç¨‹ç§æœ‰**çš„ã€‚\n- çŠ¶æ€åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªæ ˆå¸§çš„ä¿¡æ¯ï¼Œå¦‚å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰ã€‚\n- Context Switch é¢‘ç¹å‘ç”Ÿä¼šå½±å“æ€§èƒ½ã€‚\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/java%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81":{"title":"javaçº¿ç¨‹çŠ¶æ€","content":"# javaçº¿ç¨‹çŠ¶æ€\n\n\u003e [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹çŠ¶æ€|çº¿ç¨‹çŠ¶æ€]]\n\næ ¹æ®Java API Thread.Stateæšä¸¾ï¼Œæœ‰6ç§çŠ¶æ€ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220526174139.png]]\n\n\u003e BLOCKEDæ˜¯æŒ‡çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é”ï¼›WAITINGæ˜¯æŒ‡çº¿ç¨‹æ­£åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹å‘æ¥çš„é€šçŸ¥ï¼ˆnotifyï¼‰ï¼Œæ”¶åˆ°é€šçŸ¥åï¼Œå¯èƒ½ä¼šé¡ºåºå‘åæ‰§è¡Œï¼ˆRUNNABLEï¼‰ï¼Œä¹Ÿå¯èƒ½ä¼šå†æ¬¡è·å–é”ï¼Œè¿›è€Œè¢«é˜»å¡ä½ï¼ˆBLOCKEDï¼‰ã€‚\n\n## çŠ¶æ€è½¬æ¢\n\n### 1. NEW --\u003e RUNNABLE\n- NEW [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ start() æ–¹æ³•ï¼Œ**è¿˜æœªä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹ç›¸å…³è”**ã€‚\n- å½“è°ƒç”¨ t.start() æ–¹æ³•æ—¶ï¼Œç”± NEW --\u003e RUNNABLEã€‚\n\n\u003e æ³¨æ„ï¼ŒJava API å±‚é¢çš„ RUNNABLE çŠ¶æ€æ¶µç›–äº† æ“ä½œç³»ç»Ÿ å±‚é¢çš„ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ã€ã€è¿è¡ŒçŠ¶æ€ã€‘å’Œã€é˜»å¡çŠ¶æ€ã€‘ï¼ˆç”±äº BIO å¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œåœ¨ Java é‡Œæ— æ³•åŒºåˆ†ï¼Œä»ç„¶è®¤ä¸ºæ˜¯å¯è¿è¡Œï¼‰ã€‚\n\n### 2. RUNNABLE \u003c--\u003e WAITING\n1. è°ƒç”¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/wait\u0026notify|wait\u0026notify]] åœ¨RUNNABLE å’Œ AWITINGé—´è½¬æ¢ï¼Œt çº¿ç¨‹ç”¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]](obj) è·å–äº†å¯¹è±¡é”åï¼š\n\t- è°ƒç”¨ obj.wait() æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» RUNNABLE --\u003e WAITING\n\t- è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶\n\t\t- ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» WAITING --\u003e RUNNABLE \n\t\t- ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» WAITING --\u003e BLOCKED \n- BLOCKED ï¼Œ WAITING ï¼Œ TIMED_WAITING éƒ½æ˜¯ Java API å±‚é¢å¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„ç»†åˆ†ã€‚\n- TERMINATED å½“çº¿ç¨‹ä»£ç è¿è¡Œç»“æŸã€‚\n\n### 3. RUNNABLE \u003c--\u003e WAITING\n\n- å½“å‰çº¿ç¨‹è°ƒç”¨ t.[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/join|join]]() æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE --\u003e WAITING\n\t- æ³¨æ„æ˜¯**å½“å‰çº¿ç¨‹**åœ¨**t çº¿ç¨‹å¯¹è±¡**çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/monitor|Monitor]]ä¸Šç­‰å¾…\n- t çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/interrupt|interrupt]]() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» WAITING --\u003e RUNNABLE\n\n### 4. RUNNABLE \u003c--\u003e WAITING\n\n- å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/park\u0026unpark|park]]() æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹ä» RUNNABLE --\u003e WAITING\n- è°ƒç”¨ LockSupport.[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/park\u0026unpark|unpark]](ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä»WAITING --\u003e RUNNABLE\n\n### 5. RUNNABLE \u003c--\u003e TIMED_WAITING\n\nt çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”åï¼š\n\t- è°ƒç”¨ obj.wait(long n) æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» RUNNABLE --\u003e TIMED_WAITING\n\t- t çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/interrupt|interrupt]]() æ—¶\n\t\t- ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» TIMED_WAITING --\u003e RUNNABLE \n\t\t- ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» TIMED_WAITING --\u003e BLOCKED \n\n### 6. RUNNABLE \u003c--\u003e TIMED_WAITING\n\n- å½“å‰çº¿ç¨‹è°ƒç”¨ t.join(long n) æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE --\u003e TIMED_WAITING\n\t- æ³¨æ„æ˜¯å½“å‰çº¿ç¨‹åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…\n- å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–t çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä»TIMED_WAITING --\u003e RUNNABLE\n\n### 7. RUNNABLE \u003c--\u003e TIMED_WAITING\n\n- å½“å‰çº¿ç¨‹è°ƒç”¨ Thread.sleep(long n) ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE --\u003e TIMED_WAITING \n- å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œå½“å‰çº¿ç¨‹ä» TIMED_WAITING --\u003e RUNNABLE \n\n### 8. RUNNABLE \u003c--\u003e TIMED_WAITING\n\n- å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.parkNanos(long nanos) æˆ– LockSupport.parkUntil(long millis) æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE --\u003e TIMED_WAITING\n- è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œæˆ–æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» TIMED_WAITING--\u003e RUNNABLE\n\n### 9. RUNNABLE \u003c--\u003e BLOCKED\n\n- t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”æ—¶å¦‚æœç«äº‰å¤±è´¥ï¼Œä» RUNNABLE --\u003e BLOCKED \n- æŒ obj é”çº¿ç¨‹çš„åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œä¼šå”¤é†’è¯¥å¯¹è±¡ä¸Šæ‰€æœ‰ BLOCKED çš„çº¿ç¨‹é‡æ–°ç«äº‰ï¼Œå¦‚æœå…¶ä¸­ t çº¿ç¨‹ç«äº‰æˆåŠŸï¼Œä» BLOCKED --\u003e RUNNABLE ï¼Œå…¶å®ƒå¤±è´¥çš„çº¿ç¨‹ä»ç„¶ BLOCKED \n\n### 10. RUNNABLE --\u003e TERMINATED\n\n- å½“å‰çº¿ç¨‹æ‰€æœ‰ä»£ç è¿è¡Œå®Œæ¯•ï¼Œè¿›å…¥ TERMINATED\n\n\n## blockedå’ŒwaitingåŒºåˆ«\n\nçº¿ç¨‹å¯ä»¥é€šè¿‡wait,join,LockSupport.parkæ–¹å¼è¿›å…¥watingçŠ¶æ€ï¼Œè¿›å…¥watingçŠ¶æ€çš„çº¿ç¨‹ç­‰å¾…å”¤é†’(notifyæˆ–notifyAll)æ‰æœ‰æœºä¼šè·å–cpuçš„æ—¶é—´ç‰‡æ®µæ¥ç»§ç»­æ‰§è¡Œã€‚\nçº¿ç¨‹çš„ blockedçŠ¶æ€å¾€å¾€æ˜¯æ— æ³•è¿›å…¥åŒæ­¥æ–¹æ³•/ä»£ç å—æ¥å®Œæˆçš„ã€‚è¿™æ˜¯å› ä¸ºæ— æ³•è·å–åˆ°ä¸åŒæ­¥æ–¹æ³•/ä»£ç å—ç›¸å…³è”çš„é”ã€‚\n\nä¸watingçŠ¶æ€ç›¸å…³è”çš„æ˜¯ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸blockedçŠ¶æ€ç›¸å…³çš„æ˜¯åŒæ­¥é˜Ÿåˆ—ï¼Œä¸€ä¸ªçº¿ç¨‹ç”±ç­‰å¾…é˜Ÿåˆ—è¿ç§»åˆ°åŒæ­¥é˜Ÿåˆ—æ—¶ï¼Œçº¿ç¨‹çŠ¶æ€å°†ä¼šç”±watingè½¬åŒ–ä¸ºblockedã€‚å¯ä»¥è¿™æ ·è¯´ï¼ŒblockedçŠ¶æ€æ˜¯å¤„äºwatingçŠ¶æ€çš„çº¿ç¨‹é‡æ–°ç„•å‘ç”Ÿå‘½åŠ›çš„å¿…ç”±ä¹‹è·¯ã€‚\n\n ## æ€»ç»“\n\njavaæŠŠçº¿ç¨‹äº¤ç»™æ“ä½œç³»ç»Ÿåå°±ä»»ç”±æ“ä½œç³»ç»Ÿå»è°ƒåº¦äº†ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿå±‚é¢çš„å¯è¿è¡Œ/è¿è¡Œ/é˜»å¡å¯¹äºjavaç¨‹åºæ¥è¯´æ˜¯ä¸€æ ·çš„ï¼Œjvmä¸ä¼šå»ç»†åˆ†è¿™å‡ ç§çŠ¶æ€ï¼ŒåŒä¸€å°±æ˜¯RUNNABLEã€‚\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/java%E9%81%BF%E5%85%8D%E4%B8%B4%E7%95%8C%E5%8C%BA%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6":{"title":"javaé¿å…ä¸´ç•ŒåŒºç«æ€æ¡ä»¶","content":"# javaé¿å…ä¸´ç•ŒåŒºç«æ€æ¡ä»¶\n\n[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/ä¸´ç•ŒåŒº|ä¸´ç•ŒåŒº]] [[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/ç«æ€æ¡ä»¶|ç«æ€æ¡ä»¶]]\n\n- é˜»å¡å¼è§£å†³æ–¹æ¡ˆ\n\t- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]]\n\t- Lock\n- éé˜»å¡å¼è§£å†³æ–¹æ¡ˆ\n\t- åŸå­å˜é‡","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/join":{"title":"join","content":"# join\n\njoin()æ–¹æ³•æ˜¯Threadç±»çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ã€‚è®©**å½“å‰**çº¿ç¨‹é™·å…¥ç­‰å¾…ï¼Œç­‰å¾…æŸä¸ªå…¶å®ƒ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]è¿è¡Œç»“æŸï¼Œ**è°è°ƒç”¨å°±ç­‰å¾…è°**ï¼Œjoinèµ·åˆ°äº†[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åŒæ­¥|åŒæ­¥]]çš„ä½œç”¨ã€‚\n\njoin()åº•å±‚å°±æ˜¯wait()ã€‚\n\næœ‰æ—¶å€™ï¼Œä¸»çº¿ç¨‹åˆ›å»ºå¹¶å¯åŠ¨äº†å­çº¿ç¨‹ï¼Œå¦‚æœå­çº¿ç¨‹ä¸­éœ€è¦è¿›è¡Œå¤§é‡çš„è€—æ—¶è¿ç®—ï¼Œä¸»çº¿ç¨‹å¾€å¾€å°†æ—©äºå­çº¿ç¨‹ç»“æŸä¹‹å‰ç»“æŸã€‚\n\nå¦‚æœä¸»çº¿ç¨‹æƒ³ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œè·å¾—å­çº¿ç¨‹ä¸­çš„å¤„ç†å®Œçš„æŸä¸ªæ•°æ®ï¼Œå°±è¦ç”¨åˆ°joinæ–¹æ³•äº†ã€‚\n\nç¤ºä¾‹ä»£ç ï¼š\n\n```java\npublic class Join {\n    static class ThreadA implements Runnable {\n\n        @Override\n        public void run() {\n            try {\n                System.out.println(\"æˆ‘æ˜¯å­çº¿ç¨‹ï¼Œæˆ‘å…ˆç¡ä¸€ç§’\");\n                Thread.sleep(1000);\n                System.out.println(\"æˆ‘æ˜¯å­çº¿ç¨‹ï¼Œæˆ‘ç¡å®Œäº†ä¸€ç§’\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        Thread thread = new Thread(new ThreadA());\n        thread.start();\n        thread.join();\n        System.out.println(\"å¦‚æœä¸åŠ joinæ–¹æ³•ï¼Œæˆ‘ä¼šå…ˆè¢«æ‰“å‡ºæ¥ï¼ŒåŠ äº†å°±ä¸ä¸€æ ·äº†\");\n    }\n}\n```\n\n\u003e æ³¨æ„join()æ–¹æ³•æœ‰ä¸¤ä¸ªé‡è½½æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯join(long)ï¼Œ ä¸€ä¸ªæ˜¯join(long, int)ã€‚\n\u003e \n\u003e å®é™…ä¸Šï¼Œé€šè¿‡æºç ä½ ä¼šå‘ç°ï¼Œjoin()æ–¹æ³•åŠå…¶é‡è½½æ–¹æ³•åº•å±‚éƒ½æ˜¯åˆ©ç”¨äº†wait(long)è¿™ä¸ªæ–¹æ³•ã€‚\n\u003e \n\u003e å¯¹äºjoin(long, int)ï¼Œé€šè¿‡æŸ¥çœ‹æºç (JDK 1.8)å‘ç°ï¼Œåº•å±‚å¹¶æ²¡æœ‰ç²¾ç¡®åˆ°çº³ç§’ï¼Œè€Œæ˜¯å¯¹ç¬¬äºŒä¸ªå‚æ•°åšäº†ç®€å•çš„åˆ¤æ–­å’Œå¤„ç†ã€‚\n\n## åŸç†\n\nåº•å±‚è®¾è®¡æ¨¡å¼æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ä¿æŠ¤æ€§æš‚åœ|ä¿æŠ¤æ€§æš‚åœ]]ã€‚\n\nä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ç»“æŸã€‚\n\n```java\npublic final synchronized void join(long millis)  \nthrows InterruptedException {  \n    long base = System.currentTimeMillis();  // è·å–å½“å‰æ—¶é—´\n    long now = 0;  \n\t// å‚æ•°åˆæ³•æ€§åˆ¤æ–­\n    if (millis \u003c 0) {  \n        throw new IllegalArgumentException(\"timeout value is negative\");  \n    }  \n    \n    if (millis == 0) {  \n        while (isAlive()) {  \n            wait(0);  \n        }  \n    } else {  \n\t    // åˆ¤æ–­è™šå‡å”¤é†’\n        while (isAlive()) {  \n            long delay = millis - now;  // æ›´æ–°è¿˜è¦ç­‰å¤šä¹…\n            // è¶…æ—¶äº†å°±ä¸å†ç­‰äº†\n            if (delay \u003c= 0) {  \n                break;  \n            }  \n            wait(delay);  // å¦‚æœè¢«è™šå‡å”¤é†’ï¼Œå°±é‡æ–°è¿›å…¥waitå¹¶ç­‰å¾…å‰©ä½™æ—¶é—´\n            now = System.currentTimeMillis() - base;  // æ›´æ–°å·²ç»è¿‡äº†å¤šä¹…\n        }  \n    }  \n}\n```\n\nisAlive()æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œç”±å­çº¿ç¨‹ï¼ˆè¢«ç­‰å¾…çš„çº¿ç¨‹ï¼‰è°ƒç”¨ï¼Œåˆ¤æ–­å­çº¿ç¨‹æ˜¯å¦è¿˜æ´»ç€ã€‚\n\nåœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨t1.join()[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized#æˆå‘˜æ–¹æ³•|åŒæ­¥æ–¹æ³•]]ï¼Œä¼š**æŠŠt1å½“ä½œé”å¯¹è±¡**ï¼Œè€ŒæˆåŠŸè°ƒç”¨t1.join()ä»£è¡¨ä¸»çº¿ç¨‹è·å–åˆ°äº†å½“å‰çš„t1é”å¯¹è±¡ï¼Œå› æ­¤waitæ˜¯é’ˆå¯¹ä¸»çº¿ç¨‹ç”Ÿæ•ˆçš„ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/monitor":{"title":"monitor","content":"# monitor\n\nç›‘è§†å™¨/ç®¡ç¨‹ã€‚\n\næ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥å…³è”ä¸€ä¸ª Monitor å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]] ç»™å¯¹è±¡ä¸Šé”ï¼ˆé‡é‡çº§ï¼‰ä¹‹åï¼Œè¯¥[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/å¯¹è±¡å¤´|å¯¹è±¡å¤´]]çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/Mark Word|Mark Word]] ä¸­å°±è¢«è®¾ç½®æŒ‡å‘ Monitor å¯¹è±¡çš„æŒ‡é’ˆã€‚\n\nMonitor ç»“æ„ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220527172014.png]]\n\n1. Monitor ä¸­ Owner åˆå§‹ä¸º nullã€‚\n2. å½“ Thread-2 æ‰§è¡Œ synchronized(obj) å°±ä¼šå°† Monitor çš„æ‰€æœ‰è€… Owner ç½®ä¸º Thread-2ï¼ŒMonitorä¸­åªèƒ½æœ‰ä¸€ä¸ª Ownerã€‚\n3. åœ¨ Thread-2 ä¸Šé”çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ Thread-3ï¼ŒThread-4ï¼ŒThread-5 ä¹Ÿæ¥æ‰§è¡Œsynchronized(obj)ï¼Œå°±ä¼šè¿›å…¥ EntryList BLOCKEDã€‚\n4. Thread-2 æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—çš„å†…å®¹ï¼Œç„¶åå”¤é†’ EntryList ä¸­ç­‰å¾…çš„çº¿ç¨‹æ¥ç«äº‰é”ï¼Œç«äº‰çš„æ—¶æ˜¯éå…¬å¹³çš„ã€‚\n5. å›¾ä¸­ WaitSet ä¸­çš„ Thread-0ï¼ŒThread-1 æ˜¯ä¹‹å‰è·å¾—è¿‡é”ï¼Œä½†æ¡ä»¶ä¸æ»¡è¶³è¿›å…¥ WAITING çŠ¶æ€çš„çº¿ç¨‹ï¼Œåé¢è®² wait-notify æ—¶ä¼šåˆ†æã€‚\n\n\u003e æ³¨æ„ï¼š\nsynchronized å¿…é¡»æ˜¯è¿›å…¥åŒä¸€ä¸ªå¯¹è±¡çš„ monitor æ‰æœ‰ä¸Šè¿°çš„æ•ˆæœï¼Œ\nä¸åŠ  synchronized çš„å¯¹è±¡ä¸ä¼šå…³è”ç›‘è§†å™¨ï¼Œä¸éµä»ä»¥ä¸Šè§„åˆ™ã€‚\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/parkunpark":{"title":"park\u0026unpark","content":"# park\u0026unpark\n\n## ç‰¹ç‚¹\n\n### ä¸ wait\u0026notifyç›¸æ¯”\n\n- waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ Object Monitor ä¸€èµ·ä½¿ç”¨ï¼Œè€Œ parkï¼Œunpark ä¸å¿…\n- park \u0026 unpark æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½æ¥é˜»å¡/å”¤é†’çº¿ç¨‹ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAll æ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆç²¾å‡†ã€‚\n- park \u0026 unpark å¯ä»¥å…ˆ unparkï¼Œè€Œ wait \u0026 notify ä¸èƒ½å…ˆ notifyã€‚\n\n## åŸç†\n\n**æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ª Parker å¯¹è±¡**ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆ _counter ï¼Œ _cond å’Œ _mutex æ‰“ä¸ªæ¯”å–»ï¼š\n- çº¿ç¨‹å°±åƒä¸€ä¸ªæ—…äººï¼ŒParker å°±åƒä»–éšèº«æºå¸¦çš„èƒŒåŒ…ï¼š\n\t- æ¡ä»¶å˜é‡å°±å¥½æ¯”èƒŒåŒ…ä¸­çš„å¸ç¯·\n\t- `_counter` å°±å¥½æ¯”èƒŒåŒ…ä¸­çš„å¤‡ç”¨å¹²ç²®ï¼ˆ0 ä¸ºè€—å°½ï¼Œ1 ä¸ºå……è¶³ï¼‰\n- è°ƒç”¨ park å°±æ˜¯è¦çœ‹éœ€ä¸éœ€è¦åœä¸‹æ¥æ­‡æ¯\n\t- å¦‚æœå¤‡ç”¨å¹²ç²®è€—å°½ï¼Œé‚£ä¹ˆé’»è¿›å¸ç¯·æ­‡æ¯\n\t- å¦‚æœå¤‡ç”¨å¹²ç²®å……è¶³ï¼Œé‚£ä¹ˆä¸éœ€åœç•™ï¼Œç»§ç»­å‰è¿›\n- è°ƒç”¨ unparkï¼Œå°±å¥½æ¯”ä»¤å¹²ç²®å……è¶³\n\t- å¦‚æœè¿™æ—¶çº¿ç¨‹è¿˜åœ¨å¸ç¯·ï¼Œå°±å”¤é†’è®©ä»–ç»§ç»­å‰è¿›\n\t- å¦‚æœè¿™æ—¶çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆä¸‹æ¬¡ä»–è°ƒç”¨ park æ—¶ï¼Œä»…æ˜¯æ¶ˆè€—æ‰å¤‡ç”¨å¹²ç²®ï¼Œä¸éœ€åœç•™ç»§ç»­å‰è¿›\n\t\t- å› ä¸ºèƒŒåŒ…ç©ºé—´æœ‰é™ï¼Œå¤šæ¬¡è°ƒç”¨ unpark ä»…ä¼šè¡¥å……ä¸€ä»½å¤‡ç”¨å¹²ç²®\n\n1. å½“å‰çº¿ç¨‹è°ƒç”¨ Unsafe.park() æ–¹æ³•\n2. æ£€æŸ¥ `_counter` ï¼Œæœ¬æƒ…å†µä¸º 0ï¼Œè¿™æ—¶ï¼Œè·å¾— `_mutex` äº’æ–¥é”\n3. çº¿ç¨‹è¿›å…¥ `_cond` æ¡ä»¶å˜é‡é˜»å¡\n4. è®¾ç½® `_counter` = 0\n![[z-oblib/z2-attachments/Pasted image 20220529205721.png]]\n5. è°ƒç”¨ Unsafe.unpark(Thread_0) æ–¹æ³•ï¼Œè®¾ç½® `_counter` ä¸º 1\n6. å”¤é†’ `_cond` æ¡ä»¶å˜é‡ä¸­çš„ Thread_0\n7. Thread_0 æ¢å¤è¿è¡Œ\n8. è®¾ç½® `_counter` ä¸º 0\n![[z-oblib/z2-attachments/Pasted image 20220529205853.png]]\n9. è°ƒç”¨ Unsafe.unpark(Thread_0) æ–¹æ³•ï¼Œè®¾ç½® `_counter` ä¸º 1\n10. å”¤é†’ `_cond` æ¡ä»¶å˜é‡ä¸­çš„ Thread_0\n11. Thread_0 æ¢å¤è¿è¡Œ\n12. è®¾ç½® `_counter` ä¸º 0","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/sleep":{"title":"sleep","content":"# sleep\n\nsleepæ–¹æ³•æ˜¯Threadç±»çš„ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚å®ƒçš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´ï¼Œç¡çœ æ˜¯æŒ‡è®©çº¿ç¨‹æ”¾å¼ƒå½“å‰CPUçš„æ—¶é—´ç‰‡ï¼Œä½†æ˜¯å¹¶ä¸ä¼šé‡Šæ”¾é”ï¼ŒæŠ±ç€é”ç¡è§‰ã€‚å®ƒæœ‰è¿™æ ·ä¸¤ä¸ªæ–¹æ³•ï¼š\n\n- Thread.sleep(long)\n- Thread.sleep(long, int)\n\n\u003e åŒæ ·ï¼ŒæŸ¥çœ‹æºç (JDK 1.8)å‘ç°ï¼Œç¬¬äºŒä¸ªæ–¹æ³•è²Œä¼¼åªå¯¹ç¬¬äºŒä¸ªå‚æ•°åšäº†ç®€å•çš„å¤„ç†ï¼Œæ²¡æœ‰ç²¾ç¡®åˆ°çº³ç§’ã€‚å®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ã€‚\n\n\n## ä½œç”¨\n\n1. è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» Running  è¿›å…¥ Timed Waiting çŠ¶æ€ï¼ˆé˜»å¡ï¼‰ã€‚\n2. å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ interrupt æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡ºInterruptedExceptionã€‚\n3. ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œã€‚\n4. å»ºè®®ç”¨ TimeUnit çš„ sleep ä»£æ›¿ Thread çš„ sleep æ¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§ã€‚\n\n## æ‰“æ–­ç¡çœ ï¼ˆéå”¤é†’ï¼‰\n\nsleep()æ˜¯å¯ä»¥æ‰“æ–­çš„ï¼Œè€Œæ‰“æ–­çš„æ–¹å¼æ˜¯é€šè¿‡InterruptedExceptionå¼‚å¸¸ï¼Œæ‰€ä»¥sleep()éœ€è¦æ‰èµ·æ¥ã€‚\n\næ³¨æ„æ‰“æ–­ç¡çœ ä¸æ˜¯å”¤é†’ï¼Œä¸ä¼šç»§ç»­åšç¡é†’åè¦åšçš„å·¥ä½œï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡å¼‚å¸¸å¤„ç†è·³å‡ºäº†ã€‚æ‰€ä»¥sleep()åçš„å†…å®¹ï¼ˆtryèŒƒå›´å†…ï¼‰ä¸ä¼šè¢«æ‰§è¡Œã€‚\n\nç›¸å½“äºæ‹”æ‰ä¸€ä¸ªæ˜è¿·çš„äººçš„æ°§æ°”ç®¡ï¼Œè€Œä¸æ˜¯å«é†’ä»–ã€‚\n\n```java\nThread t4 = new Thread(){  \n    @Override  \n    public void run() {  \n        log.debug(\"enter sleep...\");  \n        try {  \n            Thread.sleep(2000);  \n            log.debug(\"i'm awake\");  // è¿™é‡Œä¸ä¼šæ‰§è¡Œ  \n        } catch (InterruptedException e) {  \n            log.debug(\"fvck, who interrupting me\");  // è¿™é‡Œä¼šæ‰§è¡Œ\n            throw new RuntimeException(e);  \n        }  \n    }  \n};\n```","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/sleep%E5%92%8Cwait%E7%9A%84%E5%8C%BA%E5%88%AB":{"title":"sleepå’Œwaitçš„åŒºåˆ«","content":"# sleepå’Œwaitçš„åŒºåˆ«\n\n- **[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/sleep|sleep]]æ–¹æ³•æ˜¯ä¸ä¼šé‡Šæ”¾å½“å‰çš„é”çš„ï¼Œè€Œwaitæ–¹æ³•ä¼šã€‚** è¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„ä¸€ä¸ªå¤šçº¿ç¨‹é¢è¯•é¢˜ã€‚\n-   waitå¯ä»¥æŒ‡å®šæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼›è€Œsleepå¿…é¡»æŒ‡å®šæ—¶é—´ã€‚\n-   waité‡Šæ”¾cpuèµ„æºï¼ŒåŒæ—¶é‡Šæ”¾é”ï¼›sleepé‡Šæ”¾cpuèµ„æºï¼Œä½†æ˜¯ä¸é‡Šæ”¾é”ï¼Œæ‰€ä»¥æ˜“æ­»é”ã€‚\n-   waitå¿…é¡»æ”¾åœ¨åŒæ­¥å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ï¼Œè€Œsleepå¯ä»¥åœ¨ä»»æ„ä½ç½®ã€‚","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/synchronized":{"title":"synchronized","content":"# synchronized\n\n## ç®€ä»‹\n\nä¿—ç§°**å¯¹è±¡é”**ï¼Œé‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]èƒ½æŒæœ‰å¯¹è±¡é”ã€‚å…¶å®ƒçº¿ç¨‹å†æƒ³è·å–è¿™ä¸ªå¯¹è±¡é”æ—¶å°±ä¼š**é˜»å¡**ä½ã€‚è¿™æ ·å°±èƒ½ä¿è¯æ‹¥æœ‰é”çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/ä¸´ç•ŒåŒº|ä¸´ç•ŒåŒº]]å†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¸Šä¸‹æ–‡åˆ‡æ¢|ä¸Šä¸‹æ–‡åˆ‡æ¢]]ã€‚\n\n## ç‰¹ç‚¹\n- synchronized**ä¸å¯ä¸­æ–­**ï¼ˆä¸å¯æ”¾å¼ƒäº‰æŠ¢é”ï¼‰ï¼š\n\t- ä¸å¯ä¸­æ–­çš„æ„æ€æ˜¯ç­‰å¾…è·å–é”çš„æ—¶å€™ä¸å¯ä¸­æ–­ï¼Œæ‹¿åˆ°é”ä¹‹åå¯ä¸­æ–­ï¼Œæ²¡è·å–åˆ°é”çš„æƒ…å†µä¸‹ï¼Œä¸­æ–­æ“ä½œä¸€ç›´ä¸ä¼šç”Ÿæ•ˆã€‚\n- synchronizedè§„å®šï¼šçº¿ç¨‹åœ¨åŠ é”æ—¶ï¼Œ å…ˆæ¸…ç©ºå·¥ä½œå†…å­˜â†’åœ¨ä¸»å†…å­˜ä¸­æ‹·è´æœ€æ–°å˜é‡çš„å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜ â†’æ‰§è¡Œå®Œä»£ç â†’å°†æ›´æ”¹åçš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­â†’é‡Šæ”¾äº’æ–¥é”ã€‚ä¿è¯äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å¯è§æ€§|å†…å­˜å¯è§æ€§]]ã€‚\n- synchronizedä»£ç å—ä¸­çš„ä»£ç è¶Šå¤šï¼Œä¸Šé”æ—¶é—´è¶Šé•¿ï¼Œå°½é‡å‡å°‘é”çš„ç²’åº¦ã€‚\n- synchronizedå¯ä»¥ä¿è¯åŸå­æ€§ã€å¯è§æ€§ï¼Œå¹¶ä¸”å¯¹å¤–éƒ¨å±•ç°æœ‰åºæ€§ï¼Œå³å†…éƒ¨çš„é‡æ’åºä¸ä¼šå½±å“å¤–éƒ¨ï¼ˆè€Œä¸æ˜¯ä¸ä¼šå‘ç”Ÿé‡æ’åºï¼‰ï¼ˆå› ä¸ºåŒä¸€æ—¶åˆ»è¿›å…¥synchronizedä»£ç å—çš„åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå•çº¿ç¨‹ä¸‹é‡æ’åºæ— å½±å“ï¼‰ã€‚\n\t- è¦æƒ³ä¿è¯æœ‰åºæ€§ï¼Œå°±è¦æŠŠä¸œè¥¿å…¨éƒ¨äº¤ç»™synchronizedç®¡ç†ï¼Œè€Œä¸èƒ½æš´éœ²ä¸€éƒ¨åˆ†åœ¨å¤–é¢ï¼Œè¿™ä¹Ÿæ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å•ä¾‹æ¨¡å¼#åŒé‡æ ¡éªŒé”|åŒé‡æ£€æŸ¥é”]]å®ç°æ—¶è¦åŠ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]]ã€‚\n\n## è¯­æ³•\n\n```java\nsynchronized(å¯¹è±¡)\n{\n\t// ä¸´ç•ŒåŒº\n}\n```\n\n## æµç¨‹\n\n### æ¯”å–»\n\n![[z-oblib/z2-attachments/Pasted image 20220526224204.png]]\n\n1. `synchronized(å¯¹è±¡)`ä¸­çš„å¯¹è±¡ï¼Œå¯ä»¥æƒ³è±¡ä¸ºä¸€ä¸ªæˆ¿é—´ï¼ˆroomï¼‰ï¼Œæœ‰å”¯ä¸€å…¥å£ï¼ˆé—¨ï¼‰æˆ¿é—´åªèƒ½ä¸€æ¬¡è¿›å…¥ä¸€äººè¿›è¡Œè®¡ç®—ï¼Œçº¿ç¨‹ t1ï¼Œt2 æƒ³è±¡æˆä¸¤ä¸ªäººã€‚\n2. å½“çº¿ç¨‹ t1 æ‰§è¡Œåˆ° `synchronized(room)`æ—¶å°±å¥½æ¯” t1 è¿›å…¥äº†è¿™ä¸ªæˆ¿é—´ï¼Œå¹¶é”ä½äº†é—¨æ‹¿èµ°äº†é’¥åŒ™ï¼Œåœ¨é—¨å†…æ‰§è¡Œ `count++` ä»£ç ã€‚\n3. è¿™æ—¶å€™å¦‚æœ t2 ä¹Ÿè¿è¡Œåˆ°äº† `synchronized(room)` æ—¶ï¼Œå®ƒå‘ç°é—¨è¢«é”ä½äº†ï¼Œåªèƒ½åœ¨é—¨å¤–ç­‰å¾…ï¼Œå‘ç”Ÿäº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé˜»å¡ä½äº†ã€‚\n4. è¿™ä¸­é—´å³ä½¿ t1 çš„ cpu æ—¶é—´ç‰‡ä¸å¹¸ç”¨å®Œï¼Œè¢«è¸¢å‡ºäº†é—¨å¤–ï¼ˆä¸è¦é”™è¯¯ç†è§£ä¸ºé”ä½äº†å¯¹è±¡å°±èƒ½ä¸€ç›´æ‰§è¡Œä¸‹å»å“¦ï¼‰ï¼Œè¿™æ—¶é—¨è¿˜æ˜¯é”ä½çš„ï¼Œ**t1 ä»æ‹¿ç€é’¥åŒ™**ï¼Œt2 çº¿ç¨‹è¿˜åœ¨é˜»å¡çŠ¶æ€è¿›ä¸æ¥ï¼Œåªæœ‰ä¸‹æ¬¡è½®åˆ° t1 è‡ªå·±å†æ¬¡è·å¾—æ—¶é—´ç‰‡æ—¶æ‰èƒ½å¼€é—¨è¿›å…¥ã€‚\n5. å½“ t1 æ‰§è¡Œå®Œ `synchronized{}` å—å†…çš„ä»£ç ï¼Œè¿™æ—¶å€™æ‰ä¼šä» obj æˆ¿é—´å‡ºæ¥å¹¶è§£å¼€é—¨ä¸Šçš„é”ï¼Œå”¤é†’ t2 çº¿ç¨‹æŠŠé’¥åŒ™ç»™ä»–ã€‚t2 çº¿ç¨‹è¿™æ—¶æ‰å¯ä»¥è¿›å…¥ obj æˆ¿é—´ï¼Œé”ä½äº†é—¨æ‹¿ä¸Šé’¥åŒ™ï¼Œæ‰§è¡Œå®ƒçš„ `count--` ä»£ç ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220527095647.png]]\n\n### æ€»ç»“\n\nsynchronized å®é™…æ˜¯ç”¨å¯¹è±¡é”ä¿è¯äº†ä¸´ç•ŒåŒºå†…ä»£ç çš„åŸå­æ€§ï¼Œä¸´ç•ŒåŒºå†…çš„ä»£ç å¯¹å¤–æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œä¸ä¼šè¢«çº¿ç¨‹åˆ‡æ¢æ‰€æ‰“æ–­ã€‚\n\n## ä½¿ç”¨åœºæ™¯\n\n`synchronized`å…³é”®å­—å¯ä»¥ç”¨åˆ°4ä¸ªç§åœºæ™¯:\n1. Instance methods\n2. Static methods\n3. Code blocks inside instance methods\n4. Code blocks inside static methods\n\n### æˆå‘˜æ–¹æ³•\n\n```java\npublic synchronized void add(int value){\n      this.count += value;\n}\n```\n\nç­‰ä»·äºé”åœ¨æ‰€å±å¯¹è±¡ä¸Šï¼š\n\n```java\nclass Test{\n    public void test() {\n        synchronized(this) {\n        \n        }\n    }\n}\n```\n\n### é™æ€æ–¹æ³•\n\n- åŒæ­¥é™æ€æ–¹æ³•å±äºç±»å¯¹è±¡ã€‚åœ¨VMä¸­åªæœ‰ä¸€ä¸ªç±»å¯¹è±¡ï¼Œå› æ­¤ä¸ç®¡æœ‰å‡ ä¸ªå¯¹è±¡ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œé™æ€åŒæ­¥æ–¹æ³•ã€‚\n\n```java\npublic static synchronized void add(int value){\n      count += value;\n}\n```\n\nç­‰ä»·äºé”åœ¨ç±»å¯¹è±¡ä¸Šï¼š\n\n```java\nclass Test{\n    public static void test() {\n        synchronized(Test.class) {\n            \n        }\n    }\n}\n```\n\n### å®ä¾‹æ–¹æ³•ä»£ç å—\n\n- ä¸éœ€è¦åŒæ­¥æ•´ä¸ªæ–¹æ³•ï¼Œåªéœ€è¦åŒæ­¥æ–¹æ³•é‡Œé¢çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥å€ŸåŠ©åŒæ­¥å—æ¥å®Œæˆå·¥ä½œã€‚\n- æ‹¬å·ä¸­çš„å¯¹è±¡æ˜¯åŒæ­¥ä»£ç è°ƒç”¨çš„å®ä¾‹ï¼Œæœ¬ä¾‹ä¸­æ˜¯`this`ã€‚è¿™ä¸ªå¯¹è±¡ç§°ä¸ºç›‘è§†å¯¹è±¡ã€‚\n- åœ¨è¯¥å¯¹è±¡ä¸Šæœ¬æ–¹æ³•è¢«å£°æ˜ä¸ºåŒæ­¥çš„ã€‚\n\n**ä»£ç å—å¿…é¡»è¦ä¼ é€’ä¸€ä¸ªå¯¹è±¡ä½œä¸ºé”çš„è½½ä½“ï¼Œå¯ä»¥æ˜¯ç‹¬ç«‹åˆ›å»ºçš„å¯¹è±¡æˆ–è€…æ˜¯ä»£ç å—æ‰€åœ¨å®ä¾‹æœ¬èº«ï¼ˆthisæŒ‡é’ˆï¼‰ã€‚**\n\n```java\npublic void add(int value){\n\tsynchronized(this){\n\t   this.count += value;   \n\t}\n}\n```\n\nä¸‹é¢ä¸¤ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š\n- åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ(é’ˆå¯¹åŒä¸€ä¸ªå¯¹è±¡) \n- ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ä¸åŒçš„çº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™ä¼šåœ¨åŒæ­¥å—é‡Œé¢å‘ç”Ÿç­‰å¾…(é’ˆå¯¹åŒä¸€å¯¹è±¡)\n\n```java\npublic class MyClass {\n    public synchronized void log1(String msg1, String msg2){\n        log.writeln(msg1);\n        log.writeln(msg2);\n    }\n    \n    public void log2(String msg1, String msg2){\n        synchronized(this){\n            log.writeln(msg1);\n            log.writeln(msg2);\n        }\n    }\n}\n```\n\n### é™æ€æ–¹æ³•ä»£ç å—\n\nä¸‹é¢ä¸¤ä¸ªé™æ€æ–¹æ³•æ˜¯åœ¨ç±»å¯¹è±¡ä¸Šçš„:\n- ä¸€ä¸ªçº¿ç¨‹åªèƒ½åœ¨åŒä¸€æ—¶é—´æ‰§è¡Œä¸Šé¢çš„ä»»ä½•ä¸€ä¸ªæ–¹æ³•ã€‚\n- å¯¹äºç¬¬äºŒä¸ªæ–¹æ³•ï¼šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä»£ç å—é‡Œé¢æ‰§è¡Œã€‚\n\n```java\n  public class MyClass {\n\n    public static synchronized void log1(String msg1, String msg2){\n       log.writeln(msg1);\n       log.writeln(msg2);\n    }\n\n  \n    public static void log2(String msg1, String msg2){\n       synchronized(MyClass.class){\n          log.writeln(msg1);\n          log.writeln(msg2);  \n       }\n    }\n  }\n```\n\n## åº•å±‚å®ç°\n\n\u003e https://github.com/farmerjohngit/myblog/issues/12\n\n### ä»£ç å—çº§\n\nåŒæ­¥ä»£ç å—çš„åŠ é”ã€è§£é”æ˜¯é€šè¿‡ Javac ç¼–è¯‘å™¨å®ç°çš„ï¼Œåº•å±‚æ˜¯å€ŸåŠ©`monitorenter`å’Œ`monitorerexit`ã€‚\n\n```java\nstatic final Object lock = new Object();\nstatic int counter = 0;\n \npublic static void main(String[] args) {\n    synchronized (lock) {\n        counter++;\n    }\n}\n```\n\n```java\npublic static void main(java.lang.String[]);\n    descriptor: ([Ljava/lang/String;)V\n    flags: ACC_PUBLIC, ACC_STATIC\n\tCode:\n      stack=2, locals=3, args_size=1\n         0: getstatic     #2                  // \u003c- lockå¼•ç”¨ ï¼ˆsynchronizedå¼€å§‹ï¼‰\n         3: dup\n         4: astore_1                          // lockå¼•ç”¨ -\u003e slot 1\n         5: monitorenter                      // å°† lockå¯¹è±¡ MarkWord ç½®ä¸º Monitor æŒ‡é’ˆ\n         6: getstatic     #3                  // \u003c- i\n         9: iconst_1                          // å‡†å¤‡å¸¸æ•° 1\n        10: iadd                              // +1\n        11: putstatic     #3                  // -\u003e i\n        14: aload_1                           // \u003c- lockå¼•ç”¨\n        15: monitorexit                       // å°† lockå¯¹è±¡ MarkWord é‡ç½®, å”¤é†’ EntryList\n        16: goto          24\n        19: astore_2                          // e -\u003e slot 2 \n        20: aload_1                           // \u003c- lockå¼•ç”¨\n        21: monitorexit                       // å°† lockå¯¹è±¡ MarkWord é‡ç½®, å”¤é†’ EntryList\n        22: aload_2                           // \u003c- slot 2 (e)\n        23: athrow                            // throw e\n        24: return\n      Exception table:\n         from    to  target type\n             6    16    19   any\n            19    22    19   any\n      LineNumberTable:\n        line 8: 0\n        line 9: 6\n        line 10: 14\n        line 11: 24\n      LocalVariableTable:\n        Start  Length  Slot  Name   Signature\n            0      25     0  args   [Ljava/lang/String;\n      StackMapTable: number_of_entries = 2\n        frame_type = 255 /* full_frame */\n          offset_delta = 19\n          locals = [ class \"[Ljava/lang/String;\", class java/lang/Object ]\n          stack = [ class java/lang/Throwable ]\n        frame_type = 250 /* chop */\n          offset_delta = 4\n```\n\nä»å­—èŠ‚ç ä¸­å¯çŸ¥åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯`monitorenter`å’Œ`monitorexit`æŒ‡ä»¤ï¼Œå…¶ä¸­`monitorenter`æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œ`monitorexit`æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ï¼Œå½“æ‰§è¡Œ`monitorenter`æŒ‡ä»¤æ—¶ï¼Œå½“å‰çº¿ç¨‹å°†è¯•å›¾è·å–[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/Mark Word|mark word]]é‡Œé¢å­˜å‚¨çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/monitor|monitor]]ï¼Œå½“ `monitor`çš„è¿›å…¥è®¡æ•°å™¨ä¸º 0ï¼Œé‚£çº¿ç¨‹å¯ä»¥æˆåŠŸå–å¾—`monitor`ï¼Œå¹¶å°†è®¡æ•°å™¨å€¼è®¾ç½®ä¸º1ï¼Œå–é”æˆåŠŸã€‚\n\n`monitorenter`æŒ‡ä»¤ä¼šå°†Mark Wordç½®ä¸ºMonitoræŒ‡é’ˆï¼Œå†ä¹‹å‰ä¼šä¿å­˜å¯¹è±¡çš„hash codeç­‰ä¿¡æ¯ã€‚\n\nå¦‚æœå½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰ `monitor` çš„æŒæœ‰æƒï¼Œé‚£å®ƒå¯ä»¥é‡å…¥è¿™ä¸ª `monitor` ï¼Œé‡å…¥æ—¶è®¡æ•°å™¨çš„å€¼ä¹Ÿä¼šåŠ  1ã€‚å€˜è‹¥å…¶ä»–çº¿ç¨‹å·²ç»æ‹¥æœ‰`monitor`çš„æ‰€æœ‰æƒï¼Œé‚£å½“å‰çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°æ­£åœ¨æ‰§è¡Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå³`monitorexit`æŒ‡ä»¤è¢«æ‰§è¡Œï¼Œæ‰§è¡Œçº¿ç¨‹å°†é‡Šæ”¾ `monitor`å¹¶è®¾ç½®è®¡æ•°å™¨å€¼ä¸º0 ï¼Œå…¶ä»–çº¿ç¨‹å°†æœ‰æœºä¼šæŒæœ‰ `monitor` ã€‚\n\n`monitorexit`æŒ‡ä»¤ä¼šä»å¤åˆ¶çš„å¤‡ä»½ä¸­æ¢å¤å¯¹è±¡çš„hash codeç­‰ä¿¡æ¯ã€‚\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ç¼–è¯‘å™¨å°†ä¼šç¡®ä¿æ— è®ºæ–¹æ³•é€šè¿‡ä½•ç§æ–¹å¼å®Œæˆï¼Œæ–¹æ³•ä¸­è°ƒç”¨è¿‡çš„æ¯æ¡ `monitorenter` æŒ‡ä»¤éƒ½æœ‰æ‰§è¡Œå…¶å¯¹åº” `monitorexit` æŒ‡ä»¤ï¼Œè€Œæ— è®ºè¿™ä¸ªæ–¹æ³•æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸ç»“æŸã€‚ä¸ºäº†ä¿è¯åœ¨æ–¹æ³•å¼‚å¸¸å®Œæˆæ—¶ `monitorenter` å’Œ `monitorexit` æŒ‡ä»¤ä¾ç„¶å¯ä»¥æ­£ç¡®é…å¯¹æ‰§è¡Œï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼Œè¿™ä¸ªå¼‚å¸¸å¤„ç†å™¨å£°æ˜å¯å¤„ç†æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯ç”¨æ¥æ‰§è¡Œ `monitorexit` æŒ‡ä»¤ã€‚ä»ä¸Šé¢çš„å­—èŠ‚ç ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºæœ‰ä¸¤ä¸ª`monitorexit`æŒ‡ä»¤ï¼Œå®ƒå°±æ˜¯å¼‚å¸¸ç»“æŸæ—¶è¢«æ‰§è¡Œçš„é‡Šæ”¾`monitor` çš„æŒ‡ä»¤ã€‚\n\nå¼‚å¸¸å¤„ç†ä¼šæ ¹æ®Exception tableï¼š\nåœ¨6-16è¡Œ/19-22è¡Œå‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šè·³è½¬åˆ°19è¡Œï¼Œ19è¡Œå°±æ˜¯é‡Šæ”¾é”çš„åœ°æ–¹ã€‚\n```java\nException table:\n from    to  target type\n\t 6    16    19   any\n\t19    22    19   any\n```\n\n### æ–¹æ³•çº§\n\nåŒæ­¥æ–¹æ³•çš„åŠ é”ã€è§£é”æ˜¯é€šè¿‡ Javac ç¼–è¯‘å™¨å®ç°çš„ï¼Œåº•å±‚æ˜¯å€ŸåŠ©`ACC_SYNCHRONIZED`è®¿é—®æ ‡è¯†ç¬¦æ¥å®ç°çš„ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class Hello {\n    public synchronized void test() {\n        System.out.println(\"test\");\n    }\n}\n```\n\n**æ–¹æ³•çº§çš„åŒæ­¥æ˜¯éšå¼**ï¼Œå³æ— éœ€é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶çš„ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›æ“ä½œä¹‹ä¸­ã€‚JVMå¯ä»¥ä»æ–¹æ³•å¸¸é‡æ± ä¸­çš„æ–¹æ³•è¡¨ç»“æ„(method_info Structure) ä¸­çš„ `ACC_SYNCHRONIZED` è®¿é—®æ ‡å¿—åŒºåˆ†ä¸€ä¸ªæ–¹æ³•æ˜¯å¦åŒæ­¥æ–¹æ³•ã€‚å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„ `ACC_SYNCHRONIZED`è®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆæŒæœ‰`monitor`ï¼Œç„¶åå†æ‰§è¡Œæ–¹æ³•ï¼Œæœ€ååœ¨æ–¹æ³•å®Œæˆ(æ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯éæ­£å¸¸å®Œæˆ)æ—¶é‡Šæ”¾`monitor`ã€‚åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œçº¿ç¨‹æŒæœ‰äº†`monitor`ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•å†è·å¾—åŒä¸€ä¸ª`monitor`ã€‚å¦‚æœä¸€ä¸ªåŒæ­¥æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…éƒ¨æ— æ³•å¤„ç†æ­¤å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªåŒæ­¥æ–¹æ³•æ‰€æŒæœ‰çš„`monitor`å°†åœ¨å¼‚å¸¸æŠ›åˆ°åŒæ­¥æ–¹æ³•ä¹‹å¤–æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚\n\nä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å­—èŠ‚ç å±‚é¢å¦‚ä½•å®ç°ï¼š\n\n```java\npublic class Hello {\n  public Hello();\n    Code:\n       0: aload_0\n       1: invokespecial #1                  // Method java/lang/Object.\"\u003cinit\u003e\":()V\n       4: return\n  public synchronized void test();\n    Code:\n       0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;\n       3: ldc           #3                  // String test\n       5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n       8: return\n}\n```\n\n## synchronizedçš„ä¸è¶³ä¹‹å¤„\n\nsynchronizedæ˜¯ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„monitorå®ç°çš„ï¼Œæ‰€ä»¥å¼€é”€æ¯”è¾ƒå¤§ï¼Œä¹Ÿä¸æ˜¯å¾ˆçµæ´»ï¼š\n- å¦‚æœä¸´ç•ŒåŒºæ˜¯åªè¯»æ“ä½œï¼Œå…¶å®å¯ä»¥å¤šçº¿ç¨‹ä¸€èµ·æ‰§è¡Œï¼Œä½†ä½¿ç”¨synchronizedçš„è¯ï¼Œ**åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ**ã€‚\n- synchronizedæ— æ³•çŸ¥é“çº¿ç¨‹æœ‰æ²¡æœ‰æˆåŠŸè·å–åˆ°é”ã€‚\n- ä½¿ç”¨synchronizedï¼Œå¦‚æœä¸´ç•ŒåŒºå› ä¸ºIOæˆ–è€…[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/sleep|sleep]]æ–¹æ³•ç­‰åŸå› é˜»å¡äº†ï¼Œè€Œå½“å‰çº¿ç¨‹åˆæ²¡æœ‰é‡Šæ”¾é”ï¼Œå°±ä¼šå¯¼è‡´**æ‰€æœ‰çº¿ç¨‹ç­‰å¾…**ã€‚\n\n\u003e é’ˆå¯¹æ€§èƒ½é—®é¢˜ï¼Œjava6å¼€å§‹æœ‰äº†[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/è½»é‡çº§é”|è½»é‡çº§é”]]å’Œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/åå‘é”|åå‘é”]]ã€‚\n\u003e é’ˆå¯¹åŠŸèƒ½æ€§é—®é¢˜ï¼Œåœ¨locksåŒ…ä¸‹çš„é”è§£å†³äº†ã€‚\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/waitnotify":{"title":"wait\u0026notify","content":"# wait\u0026notify\n\n## wait\n\n### ä¸ºä»€ä¹ˆéœ€è¦wait\n\n- ç”±äºæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°å—ä¸èƒ½ç»§ç»­è¿›è¡Œè®¡ç®—\n- ä½†å°å—å¦‚æœä¸€ç›´å ç”¨ç€é”ï¼Œå…¶å®ƒäººå°±å¾—ä¸€ç›´é˜»å¡ï¼Œæ•ˆç‡å¤ªä½\n![[z-oblib/z2-attachments/Pasted image 20220528165543.png]]\n- äºæ˜¯è€ç‹å•å¼€äº†ä¸€é—´ä¼‘æ¯å®¤ï¼ˆè°ƒç”¨ wait æ–¹æ³•ï¼‰ï¼Œè®©å°å—åˆ°ä¼‘æ¯å®¤ï¼ˆWaitSetï¼‰ç­‰ç€å»äº†ï¼Œä½†è¿™æ—¶é”é‡Šæ”¾å¼€ï¼Œ\n- å…¶å®ƒäººå¯ä»¥ç”±è€ç‹éšæœºå®‰æ’è¿›å±‹\n- ç›´åˆ°å°Må°†çƒŸé€æ¥ï¼Œå¤§å«ä¸€å£° [ ä½ çš„çƒŸåˆ°äº† ] ï¼ˆè°ƒç”¨ notify æ–¹æ³•ï¼‰\n![[z-oblib/z2-attachments/Pasted image 20220528165605.png]]\n- å°å—äºæ˜¯å¯ä»¥ç¦»å¼€ä¼‘æ¯å®¤ï¼Œé‡æ–°è¿›å…¥ç«äº‰é”çš„é˜Ÿåˆ—\n![[z-oblib/z2-attachments/Pasted image 20220528165629.png]]\n\n### åŸç†\n\n![[z-oblib/z2-attachments/Pasted image 20220528170242.png]]\n\n1. Owner çº¿ç¨‹å‘ç°æ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨ wait æ–¹æ³•ï¼Œå³å¯è¿›å…¥ WaitSet å˜ä¸º WAITING çŠ¶æ€\n\u003e ä¸ç®¡æ˜¯ç­‰å¤–å–çš„è¿˜æ˜¯ç­‰çƒŸçš„éƒ½ä¼šåœ¨ä¸€ä¸ªæˆ¿é—´é‡Œç­‰å¾…ï¼Œå”¤é†’çš„æ—¶å€™ä¸èƒ½åŒºåˆ†ã€‚[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ReentrantLock|ReentrantLock]]æ”¹è¿›äº†è¿™ä¸€ç‚¹ã€‚\n3. BLOCKED å’Œ WAITING çš„çº¿ç¨‹éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸å ç”¨ CPU æ—¶é—´ç‰‡\n4. BLOCKED çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹é‡Šæ”¾é”æ—¶å”¤é†’\n5. WAITING çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹è°ƒç”¨ notify æˆ– notifyAll æ—¶å”¤é†’ï¼Œä½†å”¤é†’åå¹¶ä¸æ„å‘³è€…ç«‹åˆ»è·å¾—é”ï¼Œä»éœ€è¿›å…¥ EntryList é‡æ–°ç«äº‰\n\n\u003e waitingå’ŒblockedçŠ¶æ€ä¸‹çš„çº¿ç¨‹åœ¨æœ¬è´¨ä¸Šéƒ½æ˜¯blockedçŠ¶æ€ï¼Œä½†waitingçº¿ç¨‹æ˜¯åœ¨ç­‰å¾…å«å·ï¼ˆæ‰€ä»¥ç”¨Setï¼‰ï¼Œè€Œblockedæ˜¯åœ¨æ’é˜Ÿï¼ˆæ‰€ä»¥ç”¨Listï¼‰ã€‚\n\n### ä½¿ç”¨\n\n- waitå’Œnotifyæ˜¯é’ˆå¯¹é‡é‡çº§é”çš„ã€‚\n- obj.wait() è®©è¿›å…¥ object ç›‘è§†å™¨çš„çº¿ç¨‹åˆ° waitSet ç­‰å¾…ã€‚\n- obj.notify() åœ¨ object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹ä¸­æŒ‘ä¸€ä¸ªå”¤é†’ ã€‚\n- obj.notifyAll() è®© object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’ã€‚\nå®ƒä»¬éƒ½æ˜¯çº¿ç¨‹ä¹‹é—´è¿›è¡Œåä½œçš„æ‰‹æ®µï¼Œéƒ½å±äº Object å¯¹è±¡çš„æ–¹æ³•ã€‚å¿…é¡»è·å¾—æ­¤å¯¹è±¡çš„é”ï¼Œæ‰èƒ½è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•ã€‚\n\n## notify\n\nnotifyè‹¥é‡åˆ°å¤šä¸ªwaitçº¿ç¨‹ï¼Œä¸èƒ½æŒ‡å®šå«é†’è°ï¼Œåªèƒ½éšæœºå«é†’æˆ–è€…éƒ½å«é†’ã€‚è¿™ç§æƒ…å†µå«åš**è™šå‡å”¤é†’**ã€‚\n\né€šè¿‡notifyAllå”¤é†’æ‰€æœ‰waitçº¿ç¨‹ï¼Œå¹¶åœ¨è¢«å”¤é†’ä¸­æ”¹ç”¨whileå¾ªç¯åˆ¤æ–­æ¡ä»¶ï¼Œè¿™æ ·èƒ½é˜²æ­¢è™šå‡å”¤é†’ã€‚\n\n## æ­£ç¡®ä½¿ç”¨æ–¹å¼\n\n```java\nsynchronized(lock) {\n    while(æ¡ä»¶ä¸æˆç«‹) {\n        lock.wait();\n    }\n    // å¹²æ´»\n}\n \n//å¦ä¸€ä¸ªçº¿ç¨‹\nsynchronized(lock) {\n    lock.notifyAll();\n}\n```\n\næ³¨æ„waitçº¿ç¨‹ä½¿ç”¨while(æ¡ä»¶)ï¼Œå”¤é†’è€…ä½¿ç”¨notifyAll()ã€‚\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/2-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/yield":{"title":"yield","content":"# yield\n\n## ä½œç”¨\n\n1. è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ Runnable  å°±ç»ªçŠ¶æ€ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹ã€‚\n2. å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨ã€‚\n\n","lastmodified":"2023-01-23T15:37:51.750680517Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Java/NIO/NIO%E5%9F%BA%E7%A1%80":{"title":"ä¸€. NIO åŸºç¡€","content":"\n# ä¸€. NIO åŸºç¡€\n\nnon-blocking io éé˜»å¡ IO\n\n## 1. ä¸‰å¤§ç»„ä»¶\n\n### 1.1 Channel \u0026 Buffer\n\nchannel æœ‰ä¸€ç‚¹ç±»ä¼¼äº streamï¼Œå®ƒå°±æ˜¯è¯»å†™æ•°æ®çš„**åŒå‘é€šé“**ï¼Œå¯ä»¥ä» channel å°†æ•°æ®è¯»å…¥ bufferï¼Œä¹Ÿå¯ä»¥å°† buffer çš„æ•°æ®å†™å…¥ channelï¼Œè€Œä¹‹å‰çš„ stream è¦ä¹ˆæ˜¯è¾“å…¥ï¼Œè¦ä¹ˆæ˜¯è¾“å‡ºï¼Œchannel æ¯” stream æ›´ä¸ºåº•å±‚\n\n```mermaid\ngraph LR\nchannel --\u003e buffer\nbuffer --\u003e channel\n```\n\nå¸¸è§çš„ Channel æœ‰\n\n- FileChannel\n- DatagramChannel\n- SocketChannel\n- ServerSocketChannel\n\nbuffer åˆ™ç”¨æ¥ç¼“å†²è¯»å†™æ•°æ®ï¼Œå¸¸è§çš„ buffer æœ‰\n\n- ByteBuffer\n    - MappedByteBuffer\n    - DirectByteBuffer\n    - HeapByteBuffer\n- ShortBuffer\n- IntBuffer\n- LongBuffer\n- FloatBuffer\n- DoubleBuffer\n- CharBuffer\n\n### 1.2 Selector\n\nselector å•ä»å­—é¢æ„æ€ä¸å¥½ç†è§£ï¼Œéœ€è¦ç»“åˆæœåŠ¡å™¨çš„è®¾è®¡æ¼”åŒ–æ¥ç†è§£å®ƒçš„ç”¨é€”\n\n#### å¤šçº¿ç¨‹ç‰ˆè®¾è®¡\n\n```mermaid\ngraph TD\nsubgraph å¤šçº¿ç¨‹ç‰ˆ\nt1(thread) --\u003e s1(socket1)\nt2(thread) --\u003e s2(socket2)\nt3(thread) --\u003e s3(socket3)\nend\n```\n\n#### âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹\n\n- å†…å­˜å ç”¨é«˜\n- çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜\n- åªé€‚åˆè¿æ¥æ•°å°‘çš„åœºæ™¯\n\n#### çº¿ç¨‹æ± ç‰ˆè®¾è®¡\n\n```mermaid\ngraph TD\nsubgraph çº¿ç¨‹æ± ç‰ˆ\nt4(thread) --\u003e s4(socket1)\nt5(thread) --\u003e s5(socket2)\nt4(thread) -.-\u003e s6(socket3)\nt5(thread) -.-\u003e s7(socket4)\nend\n```\n\n#### âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹\n\n- é˜»å¡æ¨¡å¼ä¸‹ï¼Œçº¿ç¨‹ä»…èƒ½å¤„ç†ä¸€ä¸ª socket è¿æ¥\n- ä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯\n\n\u003e Socket API å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹ï¼šä¸€ä¸ªçº¿ç¨‹åŒæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªsocketè¿æ¥ï¼Œç›´åˆ°socketæ–­å¼€ã€‚\n\u003e æ—©æœŸTomcatç”¨æ­¤è®¾è®¡æ€è·¯æ¥å¤„ç†HTTPç­‰çŸ­è¿æ¥è¾ƒå¤šçš„åœºæ™¯ï¼Œé€‚åˆHTTP1.0çŸ­é“¾æ¥ï¼Œä¸é€‚åˆHTTP1.1é•¿è¿æ¥ã€‚\n\n#### selector ç‰ˆè®¾è®¡\n\n\u003e åº•å±‚æ˜¯è°ƒç”¨äº†æ“ä½œç³»ç»Ÿçš„ select\u0026poll\u0026epoll æ¥å£ã€‚\n\nselector çš„ä½œç”¨å°±æ˜¯é…åˆä¸€ä¸ªçº¿ç¨‹æ¥ç®¡ç†å¤šä¸ª channelï¼Œè·å–è¿™äº› channel ä¸Šå‘ç”Ÿçš„äº‹ä»¶ï¼Œè¿™äº› channel å·¥ä½œåœ¨**éé˜»å¡**æ¨¡å¼ä¸‹ï¼Œä¸ä¼šè®©çº¿ç¨‹åŠæ­»åœ¨ä¸€ä¸ª channel ä¸Šã€‚é€‚åˆè¿æ¥æ•°ç‰¹åˆ«å¤šï¼Œä½†æµé‡ä½çš„åœºæ™¯ï¼ˆlow trafficï¼‰ã€‚\n\n```mermaid\ngraph TD\nsubgraph selector ç‰ˆ\nthread --\u003e selector\nselector --\u003e c1(channel)\nselector --\u003e c2(channel)\nselector --\u003e c3(channel)\nend\n```\n\nè°ƒç”¨ selector çš„ select() ä¼šé˜»å¡ç›´åˆ° channel å‘ç”Ÿäº†è¯»å†™å°±ç»ªäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å‘ç”Ÿï¼Œselect æ–¹æ³•å°±ä¼šè¿”å›è¿™äº›äº‹ä»¶äº¤ç»™ thread æ¥å¤„ç†\n\n## 2. ByteBuffer\n\næœ‰ä¸€æ™®é€šæ–‡æœ¬æ–‡ä»¶ data.txtï¼Œå†…å®¹ä¸º\n\n```\n1234567890abcd\n```\n\nä½¿ç”¨ FileChannel æ¥è¯»å–æ–‡ä»¶å†…å®¹\n\n```java\n@Slf4j\npublic class ChannelDemo1 {\n    public static void main(String[] args) {\n        try (RandomAccessFile file = new RandomAccessFile(\"helloword/data.txt\", \"rw\")) {\n            FileChannel channel = file.getChannel();\n            ByteBuffer buffer = ByteBuffer.allocate(10);\n            do {\n                // å‘ buffer å†™å…¥\n                int len = channel.read(buffer);\n                log.debug(\"è¯»åˆ°å­—èŠ‚æ•°ï¼š{}\", len);\n                if (len == -1) {\n                    break;\n                }\n                // åˆ‡æ¢ buffer è¯»æ¨¡å¼\n                buffer.flip();\n                while(buffer.hasRemaining()) {\n                    log.debug(\"{}\", (char)buffer.get());\n                }\n                // åˆ‡æ¢ buffer å†™æ¨¡å¼\n                buffer.clear();\n            } while (true);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\nè¾“å‡º\n\n```\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š10\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 1\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 2\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 3\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 4\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 5\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 6\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 7\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 8\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 9\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 0\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š4\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - a\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - b\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - c\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - d\n10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š-1\n```\n\n### 2.1 ByteBuffer æ­£ç¡®ä½¿ç”¨å§¿åŠ¿\n\n1. å‘ buffer å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ channel.read(buffer) (ä»channelè¯»ï¼Œå¹¶å†™å…¥åˆ°buffer)\n2. è°ƒç”¨ `flip()` åˆ‡æ¢è‡³**è¯»æ¨¡å¼**\n3. ä» buffer è¯»å–æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ buffer.get()\n4. è°ƒç”¨ `clear()` æˆ– `compact()` åˆ‡æ¢è‡³**å†™æ¨¡å¼**\n5. é‡å¤ 1~4 æ­¥éª¤\n\n### 2.2 ByteBuffer ç»“æ„\n\nByteBuffer æœ‰ä»¥ä¸‹é‡è¦å±æ€§\n\n- capacity å®¹é‡\n- position è¯»å†™æŒ‡é’ˆä¸‹æ ‡\n- limit è¯»å†™é‡é™åˆ¶\n\nä¸€å¼€å§‹\n\n![[z-oblib/z2-attachments/c8a78053293105a1ce22334ebe26853f.png]]\n\nå†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€\n\n![[z-oblib/z2-attachments/86a06b91acb74a9c2ff00a10004bdc3d.png]]\n\nflip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶\n\n![[z-oblib/z2-attachments/c3197ff6217affbbcc20ab865ae58ee1.png]]\n\nè¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€\n\n![[z-oblib/z2-attachments/8202e9da57d2a913d86d057dc5140226.png]]\n\nclear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€\n\n![[z-oblib/z2-attachments/c8a78053293105a1ce22334ebe26853f.png]]\n\ncompact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼\n\n![[z-oblib/z2-attachments/a46df9c4e66a8e545792dbedfc4650fd.png]]\n\n#### ğŸ’¡ è°ƒè¯•å·¥å…·ç±»\n\n```java\npublic class ByteBufferUtil {\n    private static final char[] BYTE2CHAR = new char[256];\n    private static final char[] HEXDUMP_TABLE = new char[256 * 4];\n    private static final String[] HEXPADDING = new String[16];\n    private static final String[] HEXDUMP_ROWPREFIXES = new String[65536 \u003e\u003e\u003e 4];\n    private static final String[] BYTE2HEX = new String[256];\n    private static final String[] BYTEPADDING = new String[16];\n\n    static {\n        final char[] DIGITS = \"0123456789abcdef\".toCharArray();\n        for (int i = 0; i \u003c 256; i++) {\n            HEXDUMP_TABLE[i \u003c\u003c 1] = DIGITS[i \u003e\u003e\u003e 4 \u0026 0x0F];\n            HEXDUMP_TABLE[(i \u003c\u003c 1) + 1] = DIGITS[i \u0026 0x0F];\n        }\n\n        int i;\n\n        // Generate the lookup table for hex dump paddings\n        for (i = 0; i \u003c HEXPADDING.length; i++) {\n            int padding = HEXPADDING.length - i;\n            StringBuilder buf = new StringBuilder(padding * 3);\n            for (int j = 0; j \u003c padding; j++) {\n                buf.append(\"   \");\n            }\n            HEXPADDING[i] = buf.toString();\n        }\n\n        // Generate the lookup table for the start-offset header in each row (up to 64KiB).\n        for (i = 0; i \u003c HEXDUMP_ROWPREFIXES.length; i++) {\n            StringBuilder buf = new StringBuilder(12);\n            buf.append(NEWLINE);\n            buf.append(Long.toHexString(i \u003c\u003c 4 \u0026 0xFFFFFFFFL | 0x100000000L));\n            buf.setCharAt(buf.length() - 9, '|');\n            buf.append('|');\n            HEXDUMP_ROWPREFIXES[i] = buf.toString();\n        }\n\n        // Generate the lookup table for byte-to-hex-dump conversion\n        for (i = 0; i \u003c BYTE2HEX.length; i++) {\n            BYTE2HEX[i] = ' ' + StringUtil.byteToHexStringPadded(i);\n        }\n\n        // Generate the lookup table for byte dump paddings\n        for (i = 0; i \u003c BYTEPADDING.length; i++) {\n            int padding = BYTEPADDING.length - i;\n            StringBuilder buf = new StringBuilder(padding);\n            for (int j = 0; j \u003c padding; j++) {\n                buf.append(' ');\n            }\n            BYTEPADDING[i] = buf.toString();\n        }\n\n        // Generate the lookup table for byte-to-char conversion\n        for (i = 0; i \u003c BYTE2CHAR.length; i++) {\n            if (i \u003c= 0x1f || i \u003e= 0x7f) {\n                BYTE2CHAR[i] = '.';\n            } else {\n                BYTE2CHAR[i] = (char) i;\n            }\n        }\n    }\n\n    /**\n     * æ‰“å°æ‰€æœ‰å†…å®¹\n     * @param buffer\n     */\n    public static void debugAll(ByteBuffer buffer) {\n        int oldlimit = buffer.limit();\n        buffer.limit(buffer.capacity());\n        StringBuilder origin = new StringBuilder(256);\n        appendPrettyHexDump(origin, buffer, 0, buffer.capacity());\n        System.out.println(\"+--------+-------------------- all ------------------------+----------------+\");\n        System.out.printf(\"position: [%d], limit: [%d]\\n\", buffer.position(), oldlimit);\n        System.out.println(origin);\n        buffer.limit(oldlimit);\n    }\n\n    /**\n     * æ‰“å°å¯è¯»å–å†…å®¹\n     * @param buffer\n     */\n    public static void debugRead(ByteBuffer buffer) {\n        StringBuilder builder = new StringBuilder(256);\n        appendPrettyHexDump(builder, buffer, buffer.position(), buffer.limit() - buffer.position());\n        System.out.println(\"+--------+-------------------- read -----------------------+----------------+\");\n        System.out.printf(\"position: [%d], limit: [%d]\\n\", buffer.position(), buffer.limit());\n        System.out.println(builder);\n    }\n\n    private static void appendPrettyHexDump(StringBuilder dump, ByteBuffer buf, int offset, int length) {\n        if (isOutOfBounds(offset, length, buf.capacity())) {\n            throw new IndexOutOfBoundsException(\n                    \"expected: \" + \"0 \u003c= offset(\" + offset + \") \u003c= offset + length(\" + length\n                            + \") \u003c= \" + \"buf.capacity(\" + buf.capacity() + ')');\n        }\n        if (length == 0) {\n            return;\n        }\n        dump.append(\n                \"         +-------------------------------------------------+\" +\n                        NEWLINE + \"         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\" +\n                        NEWLINE + \"+--------+-------------------------------------------------+----------------+\");\n\n        final int startIndex = offset;\n        final int fullRows = length \u003e\u003e\u003e 4;\n        final int remainder = length \u0026 0xF;\n\n        // Dump the rows which have 16 bytes.\n        for (int row = 0; row \u003c fullRows; row++) {\n            int rowStartIndex = (row \u003c\u003c 4) + startIndex;\n\n            // Per-row prefix.\n            appendHexDumpRowPrefix(dump, row, rowStartIndex);\n\n            // Hex dump\n            int rowEndIndex = rowStartIndex + 16;\n            for (int j = rowStartIndex; j \u003c rowEndIndex; j++) {\n                dump.append(BYTE2HEX[getUnsignedByte(buf, j)]);\n            }\n            dump.append(\" |\");\n\n            // ASCII dump\n            for (int j = rowStartIndex; j \u003c rowEndIndex; j++) {\n                dump.append(BYTE2CHAR[getUnsignedByte(buf, j)]);\n            }\n            dump.append('|');\n        }\n\n        // Dump the last row which has less than 16 bytes.\n        if (remainder != 0) {\n            int rowStartIndex = (fullRows \u003c\u003c 4) + startIndex;\n            appendHexDumpRowPrefix(dump, fullRows, rowStartIndex);\n\n            // Hex dump\n            int rowEndIndex = rowStartIndex + remainder;\n            for (int j = rowStartIndex; j \u003c rowEndIndex; j++) {\n                dump.append(BYTE2HEX[getUnsignedByte(buf, j)]);\n            }\n            dump.append(HEXPADDING[remainder]);\n            dump.append(\" |\");\n\n            // Ascii dump\n            for (int j = rowStartIndex; j \u003c rowEndIndex; j++) {\n                dump.append(BYTE2CHAR[getUnsignedByte(buf, j)]);\n            }\n            dump.append(BYTEPADDING[remainder]);\n            dump.append('|');\n        }\n\n        dump.append(NEWLINE +\n                \"+--------+-------------------------------------------------+----------------+\");\n    }\n\n    private static void appendHexDumpRowPrefix(StringBuilder dump, int row, int rowStartIndex) {\n        if (row \u003c HEXDUMP_ROWPREFIXES.length) {\n            dump.append(HEXDUMP_ROWPREFIXES[row]);\n        } else {\n            dump.append(NEWLINE);\n            dump.append(Long.toHexString(rowStartIndex \u0026 0xFFFFFFFFL | 0x100000000L));\n            dump.setCharAt(dump.length() - 9, '|');\n            dump.append('|');\n        }\n    }\n\n    public static short getUnsignedByte(ByteBuffer buffer, int index) {\n        return (short) (buffer.get(index) \u0026 0xFF);\n    }\n}\n```\n\n### 2.3 ByteBuffer å¸¸è§æ–¹æ³•\n\n#### åˆ†é…ç©ºé—´\n\nå¯ä»¥ä½¿ç”¨ allocate æ–¹æ³•ä¸º ByteBuffer åˆ†é…ç©ºé—´ï¼Œå…¶å®ƒ buffer ç±»ä¹Ÿæœ‰è¯¥æ–¹æ³•\n\n```java\nBytebuffer buf = ByteBuffer.allocate(16);\n```\n\n#### å‘ buffer å†™å…¥æ•°æ®\n\næœ‰ä¸¤ç§åŠæ³•\n\n- è°ƒç”¨ channel çš„ read æ–¹æ³• (ä»channelè¯»ï¼Œå‘bufferå†™)\n- è°ƒç”¨ buffer è‡ªå·±çš„ put æ–¹æ³•\n\n```java\nint readBytes = channel.read(buf);\n```\n\nå’Œ\n\n```java\nbuf.put((byte)127);\n```\n\n#### ä» buffer è¯»å–æ•°æ®\n\nåŒæ ·æœ‰ä¸¤ç§åŠæ³•\n\n- è°ƒç”¨ channel çš„ write æ–¹æ³•ï¼ˆä»bufferè¯»ï¼Œå‘channelå†™ï¼‰\n- è°ƒç”¨ buffer è‡ªå·±çš„ get æ–¹æ³•\n\n```java\nint writeBytes = channel.write(buf);\n```\n\nå’Œ\n\n```java\nbyte b = buf.get();\n```\n\nget æ–¹æ³•ä¼šè®© position è¯»æŒ‡é’ˆå‘åèµ°ï¼Œå¦‚æœæƒ³é‡å¤è¯»å–æ•°æ®\n\n- å¯ä»¥è°ƒç”¨ rewind æ–¹æ³•å°† position é‡æ–°ç½®ä¸º 0ï¼ˆä»å¤´é‡æ–°è¯»ï¼‰\n- æˆ–è€…è°ƒç”¨ get(int i) æ–¹æ³•è·å–ç´¢å¼• i çš„å†…å®¹ï¼Œå®ƒ**ä¸ä¼š**ç§»åŠ¨è¯»æŒ‡é’ˆ\n\n#### mark å’Œ reset\n\n\u003e å¯¹rewindçš„å¢å¼ºï¼Œå¯ä»¥å›æº¯åˆ°æŒ‡å®šä½ç½®è€Œä¸åªæ˜¯èµ·ç‚¹ã€‚\n\nmark æ˜¯åœ¨è¯»å–æ—¶ï¼Œåšä¸€ä¸ªæ ‡è®°ï¼Œå³ä½¿ position æ”¹å˜ï¼Œåªè¦è°ƒç”¨ reset å°±èƒ½å›åˆ° mark çš„ä½ç½®\n\n\u003e **æ³¨æ„**\n\u003e rewind å’Œ flip éƒ½ä¼šæ¸…é™¤ mark ä½ç½®ã€‚\n\n#### å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬\n\n```java\nByteBuffer buffer1 = StandardCharsets.UTF_8.encode(\"ä½ å¥½\");\nByteBuffer buffer2 = Charset.forName(\"utf-8\").encode(\"ä½ å¥½\");\n\ndebug(buffer1);\ndebug(buffer2);\n\nCharBuffer buffer3 = StandardCharsets.UTF_8.decode(buffer1);\nSystem.out.println(buffer3.getClass());\nSystem.out.println(buffer3.toString());\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| e4 bd a0 e5 a5 bd                               |......          |\n+--------+-------------------------------------------------+----------------+\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| e4 bd a0 e5 a5 bd                               |......          |\n+--------+-------------------------------------------------+----------------+\nclass java.nio.HeapCharBuffer\nä½ å¥½\n```\n\n#### âš ï¸ Buffer çš„çº¿ç¨‹å®‰å…¨\n\n\u003e Buffer æ˜¯**éçº¿ç¨‹å®‰å…¨çš„**\n\n### 2.4 Scattering Reads\n\nåˆ†æ•£è¯»å–ï¼Œæœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ 3parts.txt\n\n```\nonetwothree\n```\n\nä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¯»å–ï¼Œå¯ä»¥å°†æ•°æ®å¡«å……è‡³å¤šä¸ª buffer\n\n```java\ntry (RandomAccessFile file = new RandomAccessFile(\"helloword/3parts.txt\", \"rw\")) {\n    FileChannel channel = file.getChannel();\n    ByteBuffer a = ByteBuffer.allocate(3);\n    ByteBuffer b = ByteBuffer.allocate(3);\n    ByteBuffer c = ByteBuffer.allocate(5);\n    channel.read(new ByteBuffer[]{a, b, c});\n    a.flip();\n    b.flip();\n    c.flip();\n    debug(a);\n    debug(b);\n    debug(c);\n} catch (IOException e) {\n    e.printStackTrace();\n}\n```\n\nç»“æœ\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6f 6e 65                                        |one             |\n+--------+-------------------------------------------------+----------------+\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 74 77 6f                                        |two             |\n+--------+-------------------------------------------------+----------------+\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 74 68 72 65 65                                  |three           |\n+--------+-------------------------------------------------+----------------+\n```\n\n### 2.5 Gathering Writes\n\nä½¿ç”¨å¦‚ä¸‹æ–¹å¼å†™å…¥ï¼Œå¯ä»¥å°†å¤šä¸ª buffer çš„æ•°æ®å¡«å……è‡³ channel\n\n```java\ntry (RandomAccessFile file = new RandomAccessFile(\"helloword/3parts.txt\", \"rw\")) {\n    FileChannel channel = file.getChannel();\n    ByteBuffer d = ByteBuffer.allocate(4);\n    ByteBuffer e = ByteBuffer.allocate(4);\n    channel.position(11);\n\n    d.put(new byte[]{'f', 'o', 'u', 'r'});\n    e.put(new byte[]{'f', 'i', 'v', 'e'});\n    d.flip();\n    e.flip();\n    debug(d);\n    debug(e);\n    channel.write(new ByteBuffer[]{d, e});\n} catch (IOException e) {\n    e.printStackTrace();\n}\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 66 6f 75 72                                     |four            |\n+--------+-------------------------------------------------+----------------+\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 66 69 76 65                                     |five            |\n+--------+-------------------------------------------------+----------------+\n```\n\næ–‡ä»¶å†…å®¹\n\n```\nonetwothreefourfive\n```\n\n### 2.6 ç»ƒä¹ \n\nç½‘ç»œä¸Šæœ‰å¤šæ¡æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œæ•°æ®ä¹‹é—´ä½¿ç”¨ \\n è¿›è¡Œåˆ†éš” ä½†ç”±äºæŸç§åŸå› è¿™äº›æ•°æ®åœ¨æ¥æ”¶æ—¶ï¼Œè¢«è¿›è¡Œäº†é‡æ–°ç»„åˆï¼Œä¾‹å¦‚åŸå§‹æ•°æ®æœ‰3æ¡ä¸º\n\n- Hello,world\\n\n- I'm zhangsan\\n\n- How are you?\\n\n\nå˜æˆäº†ä¸‹é¢çš„ä¸¤ä¸ª byteBuffer (é»åŒ…ï¼ŒåŠåŒ…)\n\n- Hello,world\\nI'm zhangsan\\nHo\n- w are you?\\n\n\nç°åœ¨è¦æ±‚ä½ ç¼–å†™ç¨‹åºï¼Œå°†é”™ä¹±çš„æ•°æ®æ¢å¤æˆåŸå§‹çš„æŒ‰ \\n åˆ†éš”çš„æ•°æ®\n\n```java\npublic static void main(String[] args) {\n    ByteBuffer source = ByteBuffer.allocate(32);\n    //                     11            24\n    source.put(\"Hello,world\\nI'm zhangsan\\nHo\".getBytes());\n    split(source);\n\n    source.put(\"w are you?\\nhaha!\\n\".getBytes());\n    split(source);\n}\n\nprivate static void split(ByteBuffer source) {\n    source.flip();\n    int oldLimit = source.limit();\n    for (int i = 0; i \u003c oldLimit; i++) {\n        if (source.get(i) == '\\n') {\n            System.out.println(i);\n            ByteBuffer target = ByteBuffer.allocate(i + 1 - source.position());\n            // 0 ~ limit\n            source.limit(i + 1);\n            target.put(source); // ä»source è¯»ï¼Œå‘ target å†™\n            debugAll(target);\n            source.limit(oldLimit);\n        }\n    }\n    source.compact();\n}\n```\n\n## 3. æ–‡ä»¶ç¼–ç¨‹\n\n### 3.1 FileChannel\n\n#### âš ï¸ FileChannel å·¥ä½œæ¨¡å¼\n\n\u003e FileChannel åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹\n\n#### è·å–\n\nä¸èƒ½ç›´æ¥æ‰“å¼€ FileChannelï¼Œå¿…é¡»é€šè¿‡ FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile æ¥è·å– FileChannelï¼Œå®ƒä»¬éƒ½æœ‰ getChannel æ–¹æ³•\n\n- é€šè¿‡ FileInputStream è·å–çš„ channel åªèƒ½è¯»\n- é€šè¿‡ FileOutputStream è·å–çš„ channel åªèƒ½å†™\n- é€šè¿‡ RandomAccessFile æ˜¯å¦èƒ½è¯»å†™æ ¹æ®æ„é€  RandomAccessFile æ—¶çš„è¯»å†™æ¨¡å¼å†³å®š\n\n#### è¯»å–\n\nä¼šä» channel è¯»å–æ•°æ®å¡«å…… ByteBufferï¼Œè¿”å›å€¼è¡¨ç¤ºè¯»åˆ°äº†å¤šå°‘å­—èŠ‚ï¼Œ-1 è¡¨ç¤ºåˆ°è¾¾äº†æ–‡ä»¶çš„æœ«å°¾\n\n```java\nint readBytes = channel.read(buffer);\n```\n\n#### å†™å…¥\n\nå†™å…¥çš„æ­£ç¡®å§¿åŠ¿å¦‚ä¸‹ï¼Œ SocketChannel\n\n```java\nByteBuffer buffer = ...;\nbuffer.put(...); // å­˜å…¥æ•°æ®\nbuffer.flip();   // åˆ‡æ¢è¯»æ¨¡å¼\n\nwhile(buffer.hasRemaining()) {\n    channel.write(buffer);\n}\n```\n\nåœ¨ while ä¸­è°ƒç”¨ channel.write æ˜¯å› ä¸º write æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯ä¸€æ¬¡å°† buffer ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥ channel\n\n#### å…³é—­\n\nchannel å¿…é¡»å…³é—­ï¼Œä¸è¿‡è°ƒç”¨äº† FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile çš„ close æ–¹æ³•ä¼šé—´æ¥åœ°è°ƒç”¨ channel çš„ close æ–¹æ³•\n\n#### ä½ç½®\n\nè·å–å½“å‰ä½ç½®\n\n```java\nlong pos = channel.position();\n```\n\nè®¾ç½®å½“å‰ä½ç½®\n\n```java\nlong newPos = ...;\nchannel.position(newPos);\n```\n\nè®¾ç½®å½“å‰ä½ç½®æ—¶ï¼Œå¦‚æœè®¾ç½®ä¸ºæ–‡ä»¶çš„æœ«å°¾\n\n- è¿™æ—¶è¯»å–ä¼šè¿”å› -1\n- è¿™æ—¶å†™å…¥ï¼Œä¼šè¿½åŠ å†…å®¹ï¼Œä½†è¦æ³¨æ„å¦‚æœ position è¶…è¿‡äº†æ–‡ä»¶æœ«å°¾ï¼Œå†å†™å…¥æ—¶åœ¨æ–°å†…å®¹å’ŒåŸæœ«å°¾ä¹‹é—´ä¼šæœ‰ç©ºæ´ï¼ˆ00ï¼‰\n\n#### å¤§å°\n\nä½¿ç”¨ size æ–¹æ³•è·å–æ–‡ä»¶çš„å¤§å°\n\n#### å¼ºåˆ¶å†™å…¥\n\næ“ä½œç³»ç»Ÿå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä¼šå°†æ•°æ®ç¼“å­˜ï¼Œä¸æ˜¯ç«‹åˆ»å†™å…¥ç£ç›˜ã€‚å¯ä»¥è°ƒç”¨ force(true) æ–¹æ³•å°†æ–‡ä»¶å†…å®¹å’Œå…ƒæ•°æ®ï¼ˆæ–‡ä»¶çš„æƒé™ç­‰ä¿¡æ¯ï¼‰ç«‹åˆ»å†™å…¥ç£ç›˜\n\n### 3.2 ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®\n\n```java\nString FROM = \"helloword/data.txt\";\nString TO = \"helloword/to.txt\";\nlong start = System.nanoTime();\ntry (FileChannel from = new FileInputStream(FROM).getChannel();\n     FileChannel to = new FileOutputStream(TO).getChannel();\n    ) {\n    from.transferTo(0, from.size(), to);\n} catch (IOException e) {\n    e.printStackTrace();\n}\nlong end = System.nanoTime();\nSystem.out.println(\"transferTo ç”¨æ—¶ï¼š\" + (end - start) / 1000_000.0);\n```\n\nè¾“å‡º\n\n```\ntransferTo ç”¨æ—¶ï¼š8.2011\n```\n\nè¶…è¿‡ 2g å¤§å°çš„æ–‡ä»¶ä¼ è¾“\n\n```java\npublic class TestFileChannelTransferTo {\n    public static void main(String[] args) {\n        try (\n                FileChannel from = new FileInputStream(\"data.txt\").getChannel();\n                FileChannel to = new FileOutputStream(\"to.txt\").getChannel();\n        ) {\n            // æ•ˆç‡é«˜ï¼Œåº•å±‚ä¼šåˆ©ç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ–\n            long size = from.size();\n            // left å˜é‡ä»£è¡¨è¿˜å‰©ä½™å¤šå°‘å­—èŠ‚\n            for (long left = size; left \u003e 0; ) {\n                System.out.println(\"position:\" + (size - left) + \" left:\" + left);\n                left -= from.transferTo((size - left), left, to);\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\nå®é™…ä¼ è¾“ä¸€ä¸ªè¶…å¤§æ–‡ä»¶\n\n```\nposition:0 left:7769948160\nposition:2147483647 left:5622464513\nposition:4294967294 left:3474980866\nposition:6442450941 left:1327497219\n```\n\n### 3.3 Path\n\njdk7 å¼•å…¥äº† Path å’Œ Paths ç±»\n\n- Path ç”¨æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„\n- Paths æ˜¯å·¥å…·ç±»ï¼Œç”¨æ¥è·å– Path å®ä¾‹\n\n```java\nPath source = Paths.get(\"1.txt\"); // ç›¸å¯¹è·¯å¾„ ä½¿ç”¨ user.dir ç¯å¢ƒå˜é‡æ¥å®šä½ 1.txt\n\nPath source = Paths.get(\"d:\\\\1.txt\"); // ç»å¯¹è·¯å¾„ ä»£è¡¨äº†  d:\\1.txt\n\nPath source = Paths.get(\"d:/1.txt\"); // ç»å¯¹è·¯å¾„ åŒæ ·ä»£è¡¨äº†  d:\\1.txt\n\nPath projects = Paths.get(\"d:\\\\data\", \"projects\"); // ä»£è¡¨äº†  d:\\data\\projects\n```\n\n- `.` ä»£è¡¨äº†å½“å‰è·¯å¾„\n- `..` ä»£è¡¨äº†ä¸Šä¸€çº§è·¯å¾„\n\nä¾‹å¦‚ç›®å½•ç»“æ„å¦‚ä¸‹\n\n```\nd:\n    |- data\n        |- projects\n            |- a\n            |- b\n```\n\nä»£ç \n\n```java\nPath path = Paths.get(\"d:\\\\data\\\\projects\\\\a\\\\..\\\\b\");\nSystem.out.println(path);\nSystem.out.println(path.normalize()); // æ­£å¸¸åŒ–è·¯å¾„\n```\n\nä¼šè¾“å‡º\n\n```\nd:\\data\\projects\\a\\..\\b\nd:\\data\\projects\\b\n```\n\n### 3.4 Files\n\næ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨\n\n```java\nPath path = Paths.get(\"helloword/data.txt\");\nSystem.out.println(Files.exists(path));\n```\n\nåˆ›å»ºä¸€çº§ç›®å½•\n\n```java\nPath path = Paths.get(\"helloword/d1\");\nFiles.createDirectory(path);\n```\n\n- å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException\n- ä¸èƒ½ä¸€æ¬¡åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ NoSuchFileException\n\nåˆ›å»ºå¤šçº§ç›®å½•ç”¨\n\n```java\nPath path = Paths.get(\"helloword/d1/d2\");\nFiles.createDirectories(path);\n```\n\næ‹·è´æ–‡ä»¶\n\n```java\nPath source = Paths.get(\"helloword/data.txt\");\nPath target = Paths.get(\"helloword/target.txt\");\n\nFiles.copy(source, target);\n```\n\n- å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException\n\nå¦‚æœå¸Œæœ›ç”¨ source è¦†ç›–æ‰ targetï¼Œéœ€è¦ç”¨ StandardCopyOption æ¥æ§åˆ¶\n\n```java\nFiles.copy(source, target, StandardCopyOption.REPLACE_EXISTING);\n```\n\nç§»åŠ¨æ–‡ä»¶\n\n```java\nPath source = Paths.get(\"helloword/data.txt\");\nPath target = Paths.get(\"helloword/data.txt\");\n\nFiles.move(source, target, StandardCopyOption.ATOMIC_MOVE);\n```\n\n- StandardCopyOption.ATOMIC_MOVE ä¿è¯æ–‡ä»¶ç§»åŠ¨çš„åŸå­æ€§\n\nåˆ é™¤æ–‡ä»¶\n\n```java\nPath target = Paths.get(\"helloword/target.txt\");\n\nFiles.delete(target);\n```\n\n- å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ NoSuchFileException\n\nåˆ é™¤ç›®å½•\n\n```java\nPath target = Paths.get(\"helloword/d1\");\n\nFiles.delete(target);\n```\n\n- å¦‚æœç›®å½•è¿˜æœ‰å†…å®¹ï¼Œä¼šæŠ›å¼‚å¸¸ DirectoryNotEmptyException\n\néå†ç›®å½•æ–‡ä»¶\n\n```java\npublic static void main(String[] args) throws IOException {\n    Path path = Paths.get(\"C:\\\\Program Files\\\\Java\\\\jdk1.8.0_91\");\n    AtomicInteger dirCount = new AtomicInteger();\n    AtomicInteger fileCount = new AtomicInteger();\n    Files.walkFileTree(path, new SimpleFileVisitor\u003cPath\u003e(){\n        @Override\n        public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) \n            throws IOException {\n            System.out.println(dir);\n            dirCount.incrementAndGet();\n            return super.preVisitDirectory(dir, attrs);\n        }\n\n        @Override\n        public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) \n            throws IOException {\n            System.out.println(file);\n            fileCount.incrementAndGet();\n            return super.visitFile(file, attrs);\n        }\n    });\n    System.out.println(dirCount); // 133\n    System.out.println(fileCount); // 1479\n}\n```\n\nç»Ÿè®¡ jar çš„æ•°ç›®\n\n```java\nPath path = Paths.get(\"C:\\\\Program Files\\\\Java\\\\jdk1.8.0_91\");\nAtomicInteger fileCount = new AtomicInteger();\nFiles.walkFileTree(path, new SimpleFileVisitor\u003cPath\u003e(){\n    @Override\n    public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) \n        throws IOException {\n        if (file.toFile().getName().endsWith(\".jar\")) {\n            fileCount.incrementAndGet();\n        }\n        return super.visitFile(file, attrs);\n    }\n});\nSystem.out.println(fileCount); // 724\n```\n\nåˆ é™¤å¤šçº§ç›®å½•\n\n```java\nPath path = Paths.get(\"d:\\\\a\");\nFiles.walkFileTree(path, new SimpleFileVisitor\u003cPath\u003e(){\n    @Override\n    public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) \n        throws IOException {\n        Files.delete(file);\n        return super.visitFile(file, attrs);\n    }\n\n    @Override\n    public FileVisitResult postVisitDirectory(Path dir, IOException exc) \n        throws IOException {\n        Files.delete(dir);\n        return super.postVisitDirectory(dir, exc);\n    }\n});\n```\n\n#### âš ï¸ åˆ é™¤å¾ˆå±é™©\n\n\u003e åˆ é™¤æ˜¯å±é™©æ“ä½œï¼Œç¡®ä¿è¦é€’å½’åˆ é™¤çš„æ–‡ä»¶å¤¹æ²¡æœ‰é‡è¦å†…å®¹\n\næ‹·è´å¤šçº§ç›®å½•\n\n```java\nlong start = System.currentTimeMillis();\nString source = \"D:\\\\Snipaste-1.16.2-x64\";\nString target = \"D:\\\\Snipaste-1.16.2-x64aaa\";\n\nFiles.walk(Paths.get(source)).forEach(path -\u003e {\n    try {\n        String targetName = path.toString().replace(source, target);\n        // æ˜¯ç›®å½•\n        if (Files.isDirectory(path)) {\n            Files.createDirectory(Paths.get(targetName));\n        }\n        // æ˜¯æ™®é€šæ–‡ä»¶\n        else if (Files.isRegularFile(path)) {\n            Files.copy(path, Paths.get(targetName));\n        }\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n});\nlong end = System.currentTimeMillis();\nSystem.out.println(end - start);\n```\n\n## 4. ç½‘ç»œç¼–ç¨‹\n\n### 4.1 éé˜»å¡ vs é˜»å¡\n\n#### é˜»å¡\n\n- é˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šå¯¼è‡´çº¿ç¨‹æš‚åœ\n    - ServerSocketChannel.accept ä¼šåœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶è®©çº¿ç¨‹æš‚åœ\n    - SocketChannel.read ä¼šåœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶è®©çº¿ç¨‹æš‚åœ\n    - é˜»å¡çš„è¡¨ç°å…¶å®å°±æ˜¯çº¿ç¨‹æš‚åœäº†ï¼Œæš‚åœæœŸé—´ä¸ä¼šå ç”¨ cpuï¼Œä½†çº¿ç¨‹ç›¸å½“äºé—²ç½®\n- å•çº¿ç¨‹ä¸‹ï¼Œé˜»å¡æ–¹æ³•ä¹‹é—´ç›¸äº’å½±å“ï¼Œå‡ ä¹ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å¤šçº¿ç¨‹æ”¯æŒ\n- ä½†å¤šçº¿ç¨‹ä¸‹ï¼Œæœ‰æ–°çš„é—®é¢˜ï¼Œä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢\n    - 32 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 320kï¼Œ64 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 1024kï¼Œå¦‚æœè¿æ¥æ•°è¿‡å¤šï¼Œå¿…ç„¶å¯¼è‡´ OOMï¼Œå¹¶ä¸”çº¿ç¨‹å¤ªå¤šï¼Œåè€Œä¼šå› ä¸ºé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´æ€§èƒ½é™ä½\n    - å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± æŠ€æœ¯æ¥å‡å°‘çº¿ç¨‹æ•°å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¿æ¥å»ºç«‹ï¼Œä½†é•¿æ—¶é—´ inactiveï¼Œä¼šé˜»å¡çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹ï¼Œå› æ­¤ä¸é€‚åˆé•¿è¿æ¥ï¼Œåªé€‚åˆçŸ­è¿æ¥\n\næœåŠ¡å™¨ç«¯\n\n```java\n// ä½¿ç”¨ nio æ¥ç†è§£é˜»å¡æ¨¡å¼, å•çº¿ç¨‹\n// 0. ByteBuffer\nByteBuffer buffer = ByteBuffer.allocate(16);\n// 1. åˆ›å»ºäº†æœåŠ¡å™¨\nServerSocketChannel ssc = ServerSocketChannel.open();\n\n// 2. ç»‘å®šç›‘å¬ç«¯å£\nssc.bind(new InetSocketAddress(8080));\n\n// 3. è¿æ¥é›†åˆ\nList\u003cSocketChannel\u003e channels = new ArrayList\u003c\u003e();\nwhile (true) {\n    // 4. accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡\n    log.debug(\"connecting...\");\n    \n    // \n    SocketChannel sc = ssc.accept();  // é˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œ\n    log.debug(\"connected... {}\", sc);\n    channels.add(sc);\n    for (SocketChannel channel : channels) {\n        // 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®\n        log.debug(\"before read... {}\", channel);\n        channel.read(buffer); // é˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œ\n        buffer.flip();\n        debugRead(buffer);\n        buffer.clear();\n        log.debug(\"after read...{}\", channel);\n    }\n}\n```\n\nå®¢æˆ·ç«¯\n\n```java\nSocketChannel sc = SocketChannel.open();\nsc.connect(new InetSocketAddress(\"localhost\", 8080));\nSystem.out.println(\"waiting...\");\n```\n\n#### éé˜»å¡\n\n- éé˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šä¸ä¼šè®©çº¿ç¨‹æš‚åœ\n    - åœ¨ ServerSocketChannel.accept åœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶ï¼Œä¼šè¿”å› nullï¼Œç»§ç»­è¿è¡Œ\n    - SocketChannel.read åœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä¼šè¿”å› 0ï¼Œä½†çº¿ç¨‹ä¸å¿…é˜»å¡ï¼Œå¯ä»¥å»æ‰§è¡Œå…¶å®ƒ SocketChannel çš„ read æˆ–æ˜¯å»æ‰§è¡Œ ServerSocketChannel.accept\n    - å†™æ•°æ®æ—¶ï¼Œçº¿ç¨‹åªæ˜¯ç­‰å¾…æ•°æ®å†™å…¥ Channel å³å¯ï¼Œæ— éœ€ç­‰ Channel é€šè¿‡ç½‘ç»œæŠŠæ•°æ®å‘é€å‡ºå»\n- ä½†éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œå’Œå¯è¯»æ•°æ®ï¼Œçº¿ç¨‹ä»ç„¶åœ¨ä¸æ–­**è‡ªæ—‹**è¿è¡Œï¼Œç™½ç™½æµªè´¹äº† cpu\n- æ•°æ®å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹å®é™…è¿˜æ˜¯é˜»å¡çš„ï¼ˆAIO æ”¹è¿›çš„åœ°æ–¹ï¼‰\n\næœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜\n\n```java\n// ä½¿ç”¨ nio æ¥ç†è§£éé˜»å¡æ¨¡å¼, å•çº¿ç¨‹\n// 0. ByteBuffer\nByteBuffer buffer = ByteBuffer.allocate(16);\n// 1. åˆ›å»ºäº†æœåŠ¡å™¨\nServerSocketChannel ssc = ServerSocketChannel.open();\nssc.configureBlocking(false); // éé˜»å¡æ¨¡å¼\n// 2. ç»‘å®šç›‘å¬ç«¯å£\nssc.bind(new InetSocketAddress(8080));\n// 3. è¿æ¥é›†åˆ\nList\u003cSocketChannel\u003e channels = new ArrayList\u003c\u003e();\nwhile (true) {\n    // 4. accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡\n    SocketChannel sc = ssc.accept(); // éé˜»å¡ï¼Œçº¿ç¨‹è¿˜ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œä½†scæ˜¯ null\n    if (sc != null) {\n        log.debug(\"connected... {}\", sc);\n        sc.configureBlocking(false); // éé˜»å¡æ¨¡å¼\n        channels.add(sc);\n    }\n    for (SocketChannel channel : channels) {\n        // 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®\n        int read = channel.read(buffer);// éé˜»å¡ï¼Œçº¿ç¨‹ä»ç„¶ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œread è¿”å› 0\n        if (read \u003e 0) {\n            buffer.flip();\n            debugRead(buffer);\n            buffer.clear();\n            log.debug(\"after read...{}\", channel);\n        }\n    }\n}\n```\n\n\u003e scéé˜»å¡æ¨¡å¼ä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯è¿ç»­å‘é€å¤šä¸ªåŒ…å°±ä¼šè§‚æµ‹åˆ°ç²˜åŒ…ç°è±¡ã€‚\n\n#### å¤šè·¯å¤ç”¨\n\n**å•çº¿ç¨‹å¯ä»¥é…åˆ Selector å®Œæˆå¯¹å¤šä¸ª Channel å¯è¯»å†™äº‹ä»¶çš„ç›‘æ§ï¼Œè¿™ç§°ä¹‹ä¸ºå¤šè·¯å¤ç”¨**\n\n- å¤šè·¯å¤ç”¨**ä»…**é’ˆå¯¹ç½‘ç»œ IOã€æ™®é€šæ–‡ä»¶ IO æ²¡æ³•åˆ©ç”¨å¤šè·¯å¤ç”¨\n- å¦‚æœä¸ç”¨ Selector çš„éé˜»å¡æ¨¡å¼ï¼Œçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åšæ— ç”¨åŠŸï¼Œè€Œ Selector èƒ½å¤Ÿä¿è¯\n    - æœ‰å¯è¿æ¥äº‹ä»¶æ—¶æ‰å»è¿æ¥\n    - æœ‰å¯è¯»äº‹ä»¶æ‰å»è¯»å–\n    - æœ‰å¯å†™äº‹ä»¶æ‰å»å†™å…¥\n        - é™äºç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼ŒChannel æœªå¿…æ—¶æ—¶å¯å†™ï¼Œä¸€æ—¦ Channel å¯å†™ï¼Œä¼šè§¦å‘ Selector çš„å¯å†™äº‹ä»¶\n\n### 4.2 Selector\n\n```mermaid\ngraph TD\nsubgraph selector ç‰ˆ\nthread --\u003e selector\nselector --\u003e c1(channel)\nselector --\u003e c2(channel)\nselector --\u003e c3(channel)\nend\n```\n\nå¥½å¤„\n\n- ä¸€ä¸ªçº¿ç¨‹é…åˆ selector å°±å¯ä»¥ç›‘æ§å¤šä¸ª channel çš„äº‹ä»¶ï¼Œäº‹ä»¶å‘ç”Ÿçº¿ç¨‹æ‰å»å¤„ç†ã€‚é¿å…éé˜»å¡æ¨¡å¼ä¸‹æ‰€åšæ— ç”¨åŠŸ\n- è®©è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨\n- èŠ‚çº¦äº†çº¿ç¨‹çš„æ•°é‡\n- å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢\n\n#### åˆ›å»º\n\n```java\nSelector selector = Selector.open();\n```\n\n#### ç»‘å®š Channel äº‹ä»¶\n\nä¹Ÿç§°ä¹‹ä¸ºæ³¨å†Œäº‹ä»¶ï¼Œç»‘å®šçš„äº‹ä»¶ selector æ‰ä¼šå…³å¿ƒ\n\n```java\nchannel.configureBlocking(false);\nSelectionKey key = channel.register(selector, ç»‘å®šäº‹ä»¶);\n```\n\n- channel å¿…é¡»å·¥ä½œåœ¨**é**é˜»å¡æ¨¡å¼\n- FileChannel **æ²¡æœ‰**éé˜»å¡æ¨¡å¼ï¼Œå› æ­¤ä¸èƒ½é…åˆ selector ä¸€èµ·ä½¿ç”¨\n- ç»‘å®šçš„äº‹ä»¶ç±»å‹å¯ä»¥æœ‰\n    - connect - å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶è§¦å‘\n    - accept - æœåŠ¡å™¨ç«¯æˆåŠŸæ¥å—è¿æ¥æ—¶è§¦å‘\n    - read - æ•°æ®å¯è¯»å…¥æ—¶è§¦å‘ï¼Œæœ‰å› ä¸ºæ¥æ”¶èƒ½åŠ›å¼±ï¼Œæ•°æ®æš‚ä¸èƒ½è¯»å…¥çš„æƒ…å†µ\n    - write - æ•°æ®å¯å†™å‡ºæ—¶è§¦å‘ï¼Œæœ‰å› ä¸ºå‘é€èƒ½åŠ›å¼±ï¼Œæ•°æ®æš‚ä¸èƒ½å†™å‡ºçš„æƒ…å†µ\n\n#### ç›‘å¬ Channel äº‹ä»¶\n\nå¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•æ¥ç›‘å¬æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæ–¹æ³•çš„è¿”å›å€¼ä»£è¡¨æœ‰å¤šå°‘ channel å‘ç”Ÿäº†äº‹ä»¶\n\næ–¹æ³•1ï¼Œé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ\n\n```java\nint count = selector.select();\n```\n\n\u003e selectæ–¹æ³•åº•å±‚è°ƒç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿçš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/epoll|epoll]] ä¸­epoll_waitæ¥å£ï¼Œè¯»å–æœ‰çŠ¶æ€çš„IOçš„é˜»å¡æ–¹æ³•ï¼Œå¯è®¾ç½®è¶…æ—¶ã€‚\n\næ–¹æ³•2ï¼Œé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿï¼Œæˆ–æ˜¯è¶…æ—¶ï¼ˆæ—¶é—´å•ä½ä¸º msï¼‰\n\n```java\nint count = selector.select(long timeout);\n```\n\næ–¹æ³•3ï¼Œä¸ä¼šé˜»å¡ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶ï¼Œç«‹åˆ»è¿”å›ï¼Œè‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶\n\n```java\nint count = selector.selectNow();\n```\n\n#### ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡\n\n\u003e -   äº‹ä»¶å‘ç”Ÿæ—¶\n\u003e     -   å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼Œä¼šè§¦å‘ accept äº‹ä»¶\n\u003e     -   å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥ï¼Œå®¢æˆ·ç«¯æ­£å¸¸ã€å¼‚å¸¸å…³é—­æ—¶ï¼Œéƒ½ä¼šè§¦å‘ read äº‹ä»¶ï¼Œå¦å¤–å¦‚æœå‘é€çš„æ•°æ®å¤§äº buffer ç¼“å†²åŒºï¼Œä¼šè§¦å‘å¤šæ¬¡è¯»å–äº‹ä»¶\n\u003e     -   channel å¯å†™ï¼Œä¼šè§¦å‘ write äº‹ä»¶\n\u003e     -   åœ¨ linux ä¸‹ nio bug å‘ç”Ÿæ—¶\n\u003e -   è°ƒç”¨ selector.wakeup()\n\u003e -   è°ƒç”¨ selector.close()\n\u003e -   selector æ‰€åœ¨çº¿ç¨‹ interrupt\n\n### 4.3 å¤„ç† accept äº‹ä»¶\n\nå®¢æˆ·ç«¯ä»£ç ä¸º\n\n```java\npublic class Client {\n    public static void main(String[] args) {\n        try (Socket socket = new Socket(\"localhost\", 8080)) {\n            System.out.println(socket);\n            socket.getOutputStream().write(\"world\".getBytes());\n            System.in.read();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\næœåŠ¡å™¨ç«¯ä»£ç ä¸º\n\n```java\n@Slf4j\npublic class ChannelDemo6 {\n    public static void main(String[] args) {\n        try (ServerSocketChannel channel = ServerSocketChannel.open()) {\n            channel.bind(new InetSocketAddress(8080));\n            System.out.println(channel);\n            Selector selector = Selector.open();\n            channel.configureBlocking(false);\n            channel.register(selector, SelectionKey.OP_ACCEPT);\n\n            while (true) {\n                int count = selector.select();\n//                int count = selector.selectNow();\n                log.debug(\"select count: {}\", count);\n//                if(count \u003c= 0) {\n//                    continue;\n//                }\n\n                // è·å–æ‰€æœ‰äº‹ä»¶\n                // æ‹¿åˆ°æ‰€æœ‰å¯è¯»å¯å†™å¯è¿æ¥çš„äº‹ä»¶é›†åˆ\n                Set\u003cSelectionKey\u003e keys = selector.selectedKeys();\n\n                // éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†\n                Iterator\u003cSelectionKey\u003e iter = keys.iterator();\n                while (iter.hasNext()) {\n                    SelectionKey key = iter.next();\n                    // åˆ¤æ–­äº‹ä»¶ç±»å‹\n                    if (key.isAcceptable()) {\n                        ServerSocketChannel c = (ServerSocketChannel) key.channel();\n                        // å¿…é¡»å¤„ç†\n                        SocketChannel sc = c.accept();\n                        log.debug(\"{}\", sc);\n                    }\n                    // å¤„ç†å®Œæ¯•ï¼Œå¿…é¡»å°†äº‹ä»¶ç§»é™¤\n                    iter.remove();\n                }\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n#### ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†\n\n\u003e äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼ˆcancelï¼‰ï¼Œä¸èƒ½ä»€ä¹ˆéƒ½ä¸åšï¼Œå¦åˆ™ä¸‹æ¬¡è¯¥äº‹ä»¶ä»ä¼šè§¦å‘ï¼Œè¿™æ˜¯å› ä¸º nio åº•å±‚ä½¿ç”¨çš„æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/epoll#æ°´å¹³è§¦å‘|æ°´å¹³è§¦å‘]]\n\n### 4.4 å¤„ç† read äº‹ä»¶\n\n\u003eä¸‹é¢çš„ä»£ç `int count = selector.select();`å¤„çš„é˜»å¡ä¼šåŒæ—¶è¢«è¿æ¥å»ºç«‹å’Œå®¢æˆ·ç«¯å†™å…¥ç»™å”¤é†’ã€‚å› ä¸ºæ­¤æ—¶selectoræ³¨å†Œäº†ä¸¤ä¸ªäº‹ä»¶ç±»å‹ã€‚\n\n```java\n@Slf4j\npublic class ChannelDemo6 {\n    public static void main(String[] args) {\n        try (ServerSocketChannel channel = ServerSocketChannel.open()) {\n            channel.bind(new InetSocketAddress(8080));\n            System.out.println(channel);\n            Selector sele ctor = Selector.open();\n            channel.configureBlocking(false);\n            channel.register(selector, SelectionKey.OP_ACCEPT);\n\n            while (true) {\n                int count = selector.select();\n//                int count = selector.selectNow();\n                log.debug(\"select count: {}\", count);\n//                if(count \u003c= 0) {\n//                    continue;\n//                }\n\n                // è·å–æ‰€æœ‰äº‹ä»¶\n                // è¿™é‡Œè¯»å†™scå’Œè¿æ¥å»ºç«‹çš„sscå…¬ç”¨äº†åŒä¸€ä¸ªselectedKeysé›†åˆ\n                Set\u003cSelectionKey\u003e keys = selector.selectedKeys();\n\n                // éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†\n                Iterator\u003cSelectionKey\u003e iter = keys.iterator();\n                while (iter.hasNext()) {\n                    SelectionKey key = iter.next();\n                    // åˆ¤æ–­äº‹ä»¶ç±»å‹\n                    if (key.isAcceptable()) {\n                        ServerSocketChannel c = (ServerSocketChannel) key.channel();\n                        // å¿…é¡»å¤„ç†\n                        SocketChannel sc = c.accept();\n                        sc.configureBlocking(false);\n                        // å’Œè¿æ¥å»ºç«‹éƒ¨åˆ†å…±ç”¨åŒä¸€ä¸ªselector\n                        // ç°åœ¨selectorä¼šåŒæ—¶è¢« OP_ACCEPTå’ŒOP_READè§¦å‘\n                        sc.register(selector, SelectionKey.OP_READ);\n                        log.debug(\"è¿æ¥å·²å»ºç«‹: {}\", sc);\n                    } else if (key.isReadable()) {\n                        SocketChannel sc = (SocketChannel) key.channel();\n                        ByteBuffer buffer = ByteBuffer.allocate(128);\n                        int read = sc.read(buffer);\n                        if(read == -1) {\n                            key.cancel();\n                            sc.close();\n                        } else {\n                            buffer.flip();\n                            debug(buffer);\n                        }\n                    }\n                    // å¤„ç†å®Œæ¯•ï¼Œå¿…é¡»å°†äº‹ä»¶ç§»é™¤\n                    iter.remove();\n                }\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\nå¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œä¿®æ”¹ä¸€ä¸‹å‘é€æ–‡å­—ï¼Œè¾“å‡º\n\n```\nsun.nio.ch.ServerSocketChannelImpl[/0:0:0:0:0:0:0:0:8080]\n21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1\n21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - è¿æ¥å·²å»ºç«‹: java.nio.channels.SocketChannel[connected local=/127.0.0.1:8080 remote=/127.0.0.1:60367]\n21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 68 65 6c 6c 6f                                  |hello           |\n+--------+-------------------------------------------------+----------------+\n21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1\n21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - è¿æ¥å·²å»ºç«‹: java.nio.channels.SocketChannel[connected local=/127.0.0.1:8080 remote=/127.0.0.1:60378]\n21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 77 6f 72 6c 64                                  |world           |\n+--------+-------------------------------------------------+----------------+\n```\n\n#### ğŸ’¡ ä¸ºä½•è¦ iter.remove()\n\n\u003e å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ä¼šè§¦å‘ä¸€æ¬¡readäº‹ä»¶ã€‚\n\n\u003e å› ä¸º select åœ¨äº‹ä»¶å‘ç”Ÿåï¼Œå°±ä¼šå°†ç›¸å…³çš„ key æ”¾å…¥ selectedKeys é›†åˆï¼Œä½†ä¸ä¼šåœ¨å¤„ç†å®Œåä» selectedKeys é›†åˆä¸­ç§»é™¤ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–ç åˆ é™¤ã€‚ä¾‹å¦‚\n\u003e \n\u003e -   ç¬¬ä¸€æ¬¡è§¦å‘äº† ssckey ä¸Šçš„ accept äº‹ä»¶ï¼Œæ²¡æœ‰ç§»é™¤ ssckey\n\u003e -   ç¬¬äºŒæ¬¡è§¦å‘äº† sckey ä¸Šçš„ read äº‹ä»¶ï¼Œä½†è¿™æ—¶ selectedKeys ä¸­è¿˜æœ‰ä¸Šæ¬¡çš„ ssckey ï¼Œåœ¨å¤„ç†æ—¶å› ä¸ºæ²¡æœ‰çœŸæ­£çš„ serverSocket è¿ä¸Šäº†ï¼Œå°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸\n\n![[z-oblib/z2-attachments/59d24a4ab1f1de94f7fb23f9530238a1.png]]\n\nselectedKeys é›†åˆå°±æ˜¯ç»¿æ¡†ï¼Œæœ‰æ–°äº‹ä»¶å‘ç”Ÿå°±ä¼šæŠŠå¯¹åº”çš„keyæ”¾è¿›å»ï¼Œäº‹ä»¶å¤„ç†äº†åªä¼šæ›´æ–°keyçŠ¶æ€ï¼Œä¸ä¼šè‡ªåŠ¨ä»é›†åˆä¸­åˆ é™¤keyã€‚\n\n#### ğŸ’¡ cancel çš„ä½œç”¨\n\n\u003e cancel ä¼šå–æ¶ˆæ³¨å†Œåœ¨ selector ä¸Šçš„ channelï¼Œå¹¶ä» **keys é›†åˆ**ä¸­åˆ é™¤ key åç»­ä¸ä¼šå†ç›‘å¬äº‹ä»¶\n\n#### âš ï¸ ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜\n\nä»¥å‰æœ‰åŒå­¦å†™è¿‡è¿™æ ·çš„ä»£ç ï¼Œæ€è€ƒæ³¨é‡Šä¸­ä¸¤ä¸ªé—®é¢˜ï¼Œä»¥ bio ä¸ºä¾‹ï¼Œå…¶å® nio é“ç†æ˜¯ä¸€æ ·çš„\n\n```java\npublic class Server {\n    public static void main(String[] args) throws IOException {\n        ServerSocket ss=new ServerSocket(9000);\n        while (true) {\n            Socket s = ss.accept();\n            InputStream in = s.getInputStream();\n            // è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜\n            byte[] arr = new byte[4];\n            while(true) {\n                int read = in.read(arr);\n                // è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜\n                if(read == -1) {\n                    break;\n                }\n                System.out.println(new String(arr, 0, read));\n            }\n        }\n    }\n}\n```\n\nå®¢æˆ·ç«¯\n\n```java\npublic class Client {\n    public static void main(String[] args) throws IOException {\n        Socket max = new Socket(\"localhost\", 9000);\n        OutputStream out = max.getOutputStream();\n        out.write(\"hello\".getBytes());\n        out.write(\"world\".getBytes());\n        out.write(\"ä½ å¥½\".getBytes());\n        max.close();\n    }\n}\n```\n\nè¾“å‡º\n\n```\nhell\nowor\nldï¿½\nï¿½å¥½\n```\n\nä¸ºä»€ä¹ˆï¼Ÿ\n\n\u003e ä¸€ä¸ªå­—ç¬¦ä¼šæœ‰å¤šä¸ªå­—èŠ‚ï¼Œè¾¹ç•Œçš„å­—ç¬¦å¯èƒ½ä¸å®Œæ•´ã€‚\n\n#### å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ\n\n![[z-oblib/z2-attachments/3b9638a1e23e235165906d2db3fdc238.png]]\n\n- ä¸€ç§æ€è·¯æ˜¯å›ºå®šæ¶ˆæ¯é•¿åº¦ï¼Œæ•°æ®åŒ…å¤§å°ä¸€æ ·ï¼ŒæœåŠ¡å™¨æŒ‰é¢„å®šé•¿åº¦è¯»å–ï¼Œç¼ºç‚¹æ˜¯æµªè´¹å¸¦å®½\n- å¦ä¸€ç§æ€è·¯æ˜¯æŒ‰åˆ†éš”ç¬¦æ‹†åˆ†ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡ä½\n- TLV æ ¼å¼ï¼Œå³ Type ç±»å‹ã€Length é•¿åº¦ã€Value æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥æ–¹ä¾¿è·å–æ¶ˆæ¯å¤§å°ï¼Œåˆ†é…åˆé€‚çš„ bufferï¼Œç¼ºç‚¹æ˜¯ buffer éœ€è¦æå‰åˆ†é…ï¼Œå¦‚æœå†…å®¹è¿‡å¤§ï¼Œåˆ™å½±å“ server ååé‡\n    - Http 1.1 æ˜¯ TLV æ ¼å¼\n    - Http 2.0 æ˜¯ LTV æ ¼å¼\n\n```mermaid\nsequenceDiagram \nparticipant c1 as å®¢æˆ·ç«¯1\nparticipant s as æœåŠ¡å™¨\nparticipant b1 as ByteBuffer1\nparticipant b2 as ByteBuffer2\nc1 -\u003e\u003e s: å‘é€ 01234567890abcdef3333\\r\ns -\u003e\u003e b1: ç¬¬ä¸€æ¬¡ read å­˜å…¥ 01234567890abcdef\ns -\u003e\u003e b2: æ‰©å®¹\nb1 -\u003e\u003e b2: æ‹·è´ 01234567890abcdef\ns -\u003e\u003e b2: ç¬¬äºŒæ¬¡ read å­˜å…¥ 3333\\r\nb2 -\u003e\u003e b2: 01234567890abcdef3333\\r\n```\n\n##### æœåŠ¡å™¨ç«¯\n\nä¹‹å‰å­˜åœ¨çš„é—®é¢˜ï¼š\nåŸæ¥çš„bufferæ˜¯tryå—ä¸­çš„æœ¬åœ°å˜é‡ï¼Œè™½ç„¶bufferä¸å¤Ÿå¤§ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç¬¬ä¸€æ¬¡æ²¡æœ‰è¯»åˆ°ç»ˆæ­¢ç¬¦å°±ä¸ä¼šè¾“å‡ºå†…å®¹ï¼Œå¹¶ä¸”æœ¬åœ°å˜é‡çš„åŸå› ç¬¬ä¸€æ¬¡è¯»å–çš„å†…å®¹ä¹Ÿä¸¢å¤±äº†ã€‚\n\næ°´å¹³è§¦å‘ä¿è¯äº†bufferä¸è¯»å®Œä¸ä¼šç»“æŸï¼Œæ‰€ä»¥ä¼šè¾“å‡ºæœ€åçš„`3333\\r`ï¼Œä½†æ˜¯å‰é¢çš„å­—ç¬¦ä¸¢å¤±äº†ã€‚\n\nä½†æ˜¯ä¹Ÿä¸èƒ½æŠŠbufferæåˆ°æœ€å¤–é¢ï¼Œè¿™æ ·ä¼šå­˜åœ¨å¤šä¸ªchannelçš„å¹¶å‘è®¿é—®åŒä¸€ä¸ªbufferçš„é—®é¢˜äº†ã€‚\n\nå¯ä»¥å°†bufferä½œä¸ºé™„ä»¶å…³è”åˆ°selectorä¸Šã€‚\n\n\nåˆ¤æ–­æ˜¯å¦è¦æ‰©å®¹çš„æ–¹æ³•ï¼š\ncompactä¼šå°†æœªè¯»å–æ•°æ®ç§»åˆ°bufferå¼€å¤´ï¼Œå°†çŠ¶æ€è½¬å›å†™æ¨¡å¼ï¼Œå¹¶ä¸”positionä¼šæ”¾åœ¨å‰©ä½™æ•°æ®ç»“å°¾ã€‚\nå¦‚æœposition 1== limit è¯´æ˜compactä¹‹å‰çš„è¯»æœªæ¶ˆè€—æ‰ä»»ä½•æ•°æ®ã€‚\n\n```java\nprivate static void split(ByteBuffer source) {\n    source.flip();\n    for (int i = 0; i \u003c source.limit(); i++) {\n        // æ‰¾åˆ°ä¸€æ¡å®Œæ•´æ¶ˆæ¯\n        if (source.get(i) == '\\n') {\n            int length = i + 1 - source.position();\n            // æŠŠè¿™æ¡å®Œæ•´æ¶ˆæ¯å­˜å…¥æ–°çš„ ByteBuffer\n            ByteBuffer target = ByteBuffer.allocate(length);\n            // ä» source è¯»ï¼Œå‘ target å†™\n            for (int j = 0; j \u003c length; j++) {\n                target.put(source.get());\n            }\n            debugAll(target);\n        }\n    }\n    source.compact(); // 0123456789abcdef  position 16 limit 16\n}\n\npublic static void main(String[] args) throws IOException {\n    // 1. åˆ›å»º selector, ç®¡ç†å¤šä¸ª channel\n    Selector selector = Selector.open();\n    ServerSocketChannel ssc = ServerSocketChannel.open();\n    ssc.configureBlocking(false);\n    // 2. å»ºç«‹ selector å’Œ channel çš„è”ç³»ï¼ˆæ³¨å†Œï¼‰\n    // SelectionKey å°±æ˜¯å°†æ¥äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¯ä»¥çŸ¥é“äº‹ä»¶å’Œå“ªä¸ªchannelçš„äº‹ä»¶\n    SelectionKey sscKey = ssc.register(selector, 0, null);\n    // key åªå…³æ³¨ accept äº‹ä»¶\n    sscKey.interestOps(SelectionKey.OP_ACCEPT);\n    log.debug(\"sscKey:{}\", sscKey);\n    ssc.bind(new InetSocketAddress(8080));\n    while (true) {\n        // 3. select æ–¹æ³•, æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼Œæœ‰äº‹ä»¶ï¼Œçº¿ç¨‹æ‰ä¼šæ¢å¤è¿è¡Œ\n        // select åœ¨äº‹ä»¶æœªå¤„ç†æ—¶ï¼Œå®ƒä¸ä¼šé˜»å¡, äº‹ä»¶å‘ç”Ÿåè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç†\n        selector.select();\n        // 4. å¤„ç†äº‹ä»¶, selectedKeys å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶\n        Iterator\u003cSelectionKey\u003e iter = selector.selectedKeys().iterator(); // accept, read\n        while (iter.hasNext()) {\n            SelectionKey key = iter.next();\n            // å¤„ç†key æ—¶ï¼Œè¦ä» selectedKeys é›†åˆä¸­åˆ é™¤ï¼Œå¦åˆ™ä¸‹æ¬¡å¤„ç†å°±ä¼šæœ‰é—®é¢˜\n            iter.remove();\n            log.debug(\"key: {}\", key);\n            // 5. åŒºåˆ†äº‹ä»¶ç±»å‹\n            if (key.isAcceptable()) { // å¦‚æœæ˜¯ accept\n                ServerSocketChannel channel = (ServerSocketChannel) key.channel();\n                SocketChannel sc = channel.accept();\n                sc.configureBlocking(false);\n                // ä¸€ä¸ªæœåŠ¡ç«¯--å®¢æˆ·ç«¯è¿æ¥å¯¹åº”ä¸€ä¸ªbuffer\n                // ç”¨æˆ·è¿™ä¸ªè¿æ¥æ¥ä¸‹æ¥å‘ç”Ÿçš„è‹¥å¹²æ¬¡è¯»å†™\n                ByteBuffer buffer = ByteBuffer.allocate(16); // attachment\n                // å°†ä¸€ä¸ª byteBuffer ä½œä¸ºé™„ä»¶å…³è”åˆ° selectionKey ä¸Š\n                SelectionKey scKey = sc.register(selector, 0, buffer);\n                scKey.interestOps(SelectionKey.OP_READ);\n                log.debug(\"{}\", sc);\n                log.debug(\"scKey:{}\", scKey);\n            } else if (key.isReadable()) { // å¦‚æœæ˜¯ read\n                try {\n                    SocketChannel channel = (SocketChannel) key.channel(); // æ‹¿åˆ°è§¦å‘äº‹ä»¶çš„channel\n                    // è·å– selectionKey ä¸Šå…³è”çš„é™„ä»¶\n                    // æ³¨æ„ç±»å‹è½¬æ¢\n                    ByteBuffer buffer = (ByteBuffer) key.attachment();\n                    int read = channel.read(buffer); // å¦‚æœæ˜¯æ­£å¸¸æ–­å¼€ï¼Œread çš„æ–¹æ³•çš„è¿”å›å€¼æ˜¯ -1\n                    if(read == -1) {\n                        key.cancel();\n                    } else {\n                        split(buffer);\n                        // éœ€è¦æ‰©å®¹\n                        if (buffer.position() == buffer.limit()) {\n                            ByteBuffer newBuffer = ByteBuffer.allocate(buffer.capacity() * 2);\n                            buffer.flip();\n                            newBuffer.put(buffer); // 0123456789abcdef3333\\n\n                            key.attach(newBuffer);\n                        }\n                    }\n\n                } catch (IOException e) {\n                    e.printStackTrace();\n                    key.cancel();  // å› ä¸ºå®¢æˆ·ç«¯æ–­å¼€äº†,å› æ­¤éœ€è¦å°† key å–æ¶ˆï¼ˆä» selector çš„ keys é›†åˆä¸­çœŸæ­£åˆ é™¤ keyï¼‰\n                }\n            }\n        }\n    }\n}\n```\n\n##### å®¢æˆ·ç«¯\n\n```java\nSocketChannel sc = SocketChannel.open();\nsc.connect(new InetSocketAddress(\"localhost\", 8080));\nSocketAddress address = sc.getLocalAddress();\n// sc.write(Charset.defaultCharset().encode(\"hello\\nworld\\n\"));\nsc.write(Charset.defaultCharset().encode(\"0123\\n456789abcdef\"));\nsc.write(Charset.defaultCharset().encode(\"0123456789abcdef3333\\n\"));\nSystem.in.read();\n```\n\n#### ByteBuffer å¤§å°åˆ†é…\n\n- æ¯ä¸ª channel éƒ½éœ€è¦è®°å½•å¯èƒ½è¢«åˆ‡åˆ†çš„æ¶ˆæ¯ï¼Œå› ä¸º ByteBuffer **ä¸èƒ½**è¢«å¤šä¸ª channel å…±åŒä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä¸ºæ¯ä¸ª channel ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„ ByteBuffer\n- ByteBuffer **ä¸èƒ½**å¤ªå¤§ï¼Œæ¯”å¦‚ä¸€ä¸ª ByteBuffer 1Mb çš„è¯ï¼Œè¦æ”¯æŒç™¾ä¸‡è¿æ¥å°±è¦ 1Tb å†…å­˜ï¼Œå› æ­¤éœ€è¦è®¾è®¡å¤§å°å¯å˜çš„ ByteBuffer\n    - ä¸€ç§æ€è·¯æ˜¯é¦–å…ˆåˆ†é…ä¸€ä¸ªè¾ƒå°çš„ bufferï¼Œä¾‹å¦‚ 4kï¼Œå¦‚æœå‘ç°æ•°æ®ä¸å¤Ÿï¼Œå†åˆ†é… 8k çš„ bufferï¼Œå°† 4k buffer å†…å®¹æ‹·è´è‡³ 8k bufferï¼Œä¼˜ç‚¹æ˜¯æ¶ˆæ¯è¿ç»­å®¹æ˜“å¤„ç†ï¼Œç¼ºç‚¹æ˜¯**æ•°æ®æ‹·è´**è€—è´¹æ€§èƒ½ï¼Œå‚è€ƒå®ç° [http://tutorials.jenkov.com/java-performance/resizable-array.html](http://tutorials.jenkov.com/java-performance/resizable-array.html)\n    - å¦ä¸€ç§æ€è·¯æ˜¯ç”¨å¤šä¸ªæ•°ç»„ç»„æˆ bufferï¼Œä¸€ä¸ªæ•°ç»„ä¸å¤Ÿï¼ŒæŠŠå¤šå‡ºæ¥çš„å†…å®¹å†™å…¥æ–°çš„æ•°ç»„ï¼Œä¸å‰é¢çš„åŒºåˆ«æ˜¯æ¶ˆæ¯å­˜å‚¨ä¸è¿ç»­**è§£æå¤æ‚**ï¼Œä¼˜ç‚¹æ˜¯é¿å…äº†æ‹·è´å¼•èµ·çš„æ€§èƒ½æŸè€—\n\n### 4.5 å¤„ç† write äº‹ä»¶\n\n#### ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­\n\n- éé˜»å¡æ¨¡å¼ä¸‹ï¼Œæ— æ³•ä¿è¯æŠŠ buffer ä¸­æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ channelï¼Œå› æ­¤éœ€è¦è¿½è¸ª write æ–¹æ³•çš„è¿”å›å€¼ï¼ˆä»£è¡¨å®é™…å†™å…¥å­—èŠ‚æ•°ï¼‰\n- ç”¨ selector ç›‘å¬æ‰€æœ‰ channel çš„å¯å†™äº‹ä»¶ï¼Œæ¯ä¸ª channel éƒ½éœ€è¦ä¸€ä¸ª key æ¥è·Ÿè¸ª bufferï¼Œä½†è¿™æ ·åˆä¼šå¯¼è‡´å ç”¨å†…å­˜è¿‡å¤šï¼Œå°±æœ‰ä¸¤é˜¶æ®µç­–ç•¥\n    - å½“æ¶ˆæ¯å¤„ç†å™¨ç¬¬ä¸€æ¬¡å†™å…¥æ¶ˆæ¯æ—¶ï¼Œæ‰å°† channel æ³¨å†Œåˆ° selector ä¸Š\n    - selector æ£€æŸ¥ channel ä¸Šçš„å¯å†™äº‹ä»¶ï¼Œå¦‚æœæ‰€æœ‰çš„æ•°æ®å†™å®Œäº†ï¼Œå°±å–æ¶ˆ channel çš„æ³¨å†Œ\n    - å¦‚æœä¸å–æ¶ˆï¼Œä¼šæ¯æ¬¡å¯å†™å‡ä¼šè§¦å‘ write äº‹ä»¶\n\n```java\npublic class WriteServer {\n\n    public static void main(String[] args) throws IOException {\n        ServerSocketChannel ssc = ServerSocketChannel.open();\n        ssc.configureBlocking(false);\n        ssc.bind(new InetSocketAddress(8080));\n\n        Selector selector = Selector.open();\n        ssc.register(selector, SelectionKey.OP_ACCEPT);\n\n        while(true) {\n            selector.select();\n\n            Iterator\u003cSelectionKey\u003e iter = selector.selectedKeys().iterator();\n            while (iter.hasNext()) {\n                SelectionKey key = iter.next();\n                iter.remove();\n                if (key.isAcceptable()) {\n                    SocketChannel sc = ssc.accept();\n                    sc.configureBlocking(false);\n                    SelectionKey sckey = sc.register(selector, SelectionKey.OP_READ);\n                    // 1. å‘å®¢æˆ·ç«¯å‘é€å†…å®¹\n                    StringBuilder sb = new StringBuilder();\n                    for (int i = 0; i \u003c 3000000; i++) {\n                        sb.append(\"a\");\n                    }\n                    ByteBuffer buffer = Charset.defaultCharset().encode(sb.toString());\n                    int write = sc.write(buffer);\n                    // 3. write è¡¨ç¤ºå®é™…å†™äº†å¤šå°‘å­—èŠ‚\n                    System.out.println(\"å®é™…å†™å…¥å­—èŠ‚:\" + write);\n                    // 4. å¦‚æœæœ‰å‰©ä½™æœªè¯»å­—èŠ‚ï¼Œæ‰éœ€è¦å…³æ³¨å†™äº‹ä»¶\n                    if (buffer.hasRemaining()) {\n                        // read 1  write 4\n                        // åœ¨åŸæœ‰å…³æ³¨äº‹ä»¶çš„åŸºç¡€ä¸Šï¼Œå¤šå…³æ³¨ å†™äº‹ä»¶\n                        sckey.interestOps(sckey.interestOps() + SelectionKey.OP_WRITE);\n                        // æŠŠ buffer ä½œä¸ºé™„ä»¶åŠ å…¥ sckey\n                        sckey.attach(buffer);\n                    }\n                } else if (key.isWritable()) {\n                    ByteBuffer buffer = (ByteBuffer) key.attachment();\n                    SocketChannel sc = (SocketChannel) key.channel();\n                    int write = sc.write(buffer);\n                    System.out.println(\"å®é™…å†™å…¥å­—èŠ‚:\" + write);\n                    if (!buffer.hasRemaining()) { // å†™å®Œäº†\n                        key.interestOps(key.interestOps() - SelectionKey.OP_WRITE);\n                        key.attach(null);\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\nå®¢æˆ·ç«¯\n\n```java\npublic class WriteClient {\n    public static void main(String[] args) throws IOException {\n        Selector selector = Selector.open();\n        SocketChannel sc = SocketChannel.open();\n        sc.configureBlocking(false);\n        sc.register(selector, SelectionKey.OP_CONNECT | SelectionKey.OP_READ);\n        sc.connect(new InetSocketAddress(\"localhost\", 8080));\n        int count = 0;\n        while (true) {\n            selector.select();\n            Iterator\u003cSelectionKey\u003e iter = selector.selectedKeys().iterator();\n            while (iter.hasNext()) {\n                SelectionKey key = iter.next();\n                iter.remove();\n                if (key.isConnectable()) {\n                    System.out.println(sc.finishConnect());\n                } else if (key.isReadable()) {\n                    ByteBuffer buffer = ByteBuffer.allocate(1024 * 1024);\n                    count += sc.read(buffer);\n                    buffer.clear();\n                    System.out.println(count);\n                }\n            }\n        }\n    }\n}\n```\n\n\u003e ç³»ç»Ÿæœ‰ä¸€å—ç½‘ç»œæ•°æ®çš„ç¼“å†²åŒºï¼Œå¦‚æœç¼“å†²åŒºæ»¡äº†ï¼Œå°±ä¸èƒ½ç»§ç»­å†™å…¥ã€‚å¦‚æœç¼“å†²åŒºå¯ä»¥ç»§ç»­æ¥å…¥ï¼Œå°±ä¼šå‘é€ä¸€ä¸ªå¯å†™ä¿¡å·ã€‚\n\n#### ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ\n\nåªè¦å‘ channel å‘é€æ•°æ®æ—¶ï¼Œsocket ç¼“å†²å¯å†™ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šé¢‘ç¹è§¦å‘ï¼Œå› æ­¤åº”å½“åªåœ¨ socket ç¼“å†²åŒºå†™ä¸ä¸‹æ—¶å†å…³æ³¨å¯å†™äº‹ä»¶ï¼Œæ•°æ®å†™å®Œä¹‹åå†å–æ¶ˆå…³æ³¨\n\n\u003e å¯å†™äº‹ä»¶æ˜¯ç”±æœ¬æœºç½‘ç»œç¼“å†²åŒºè§¦å‘çš„ï¼Œæ‰€ä»¥è¦ç¡®ä¿è‡ªå·±ç¡®å®æœ‰ä¸œè¥¿è¦å†™å…¥æ—¶æ‰å“åº”è§¦å‘ã€‚\n\n### 4.6 æ›´è¿›ä¸€æ­¥\n\n#### ğŸ’¡ åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–\n\n\u003e ç°åœ¨éƒ½æ˜¯å¤šæ ¸ cpuï¼Œè®¾è®¡æ—¶è¦å……åˆ†è€ƒè™‘åˆ«è®© cpu çš„åŠ›é‡è¢«ç™½ç™½æµªè´¹\n\nå‰é¢çš„ä»£ç åªæœ‰ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸ cpuï¼Œå¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿ\n\nåˆ†ä¸¤ç»„é€‰æ‹©å™¨\n\n- å•çº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œä¸“é—¨å¤„ç† accept äº‹ä»¶\n- åˆ›å»º cpu æ ¸å¿ƒæ•°çš„çº¿ç¨‹ï¼Œ**æ¯ä¸ªçº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨**ï¼Œè½®æµå¤„ç† read äº‹ä»¶\n\n![[z-oblib/z2-attachments/707034e47cc2c8f588567de17b7b86a3.png]]\n\n```java\npublic class ChannelDemo7 {\n    public static void main(String[] args) throws IOException {\n        new BossEventLoop().register();\n    }\n\n\n    @Slf4j\n    static class BossEventLoop implements Runnable {\n        private Selector boss;\n        private WorkerEventLoop[] workers;\n        private volatile boolean start = false;\n        AtomicInteger index = new AtomicInteger();\n\n        public void register() throws IOException {\n            if (!start) {\n                ServerSocketChannel ssc = ServerSocketChannel.open();\n                ssc.bind(new InetSocketAddress(8080));\n                ssc.configureBlocking(false);\n                boss = Selector.open();\n                SelectionKey ssckey = ssc.register(boss, 0, null);\n                ssckey.interestOps(SelectionKey.OP_ACCEPT);\n                workers = initEventLoops();\n                new Thread(this, \"boss\").start();\n                log.debug(\"boss start...\");\n                start = true;\n            }\n        }\n\n        public WorkerEventLoop[] initEventLoops() {\n//        EventLoop[] eventLoops = new EventLoop[Runtime.getRuntime().availableProcessors()];\n            WorkerEventLoop[] workerEventLoops = new WorkerEventLoop[2];\n            for (int i = 0; i \u003c workerEventLoops.length; i++) {\n                workerEventLoops[i] = new WorkerEventLoop(i);\n            }\n            return workerEventLoops;\n        }\n\n        @Override\n        public void run() {\n            while (true) {\n                try {\n                    boss.select();\n                    Iterator\u003cSelectionKey\u003e iter = boss.selectedKeys().iterator();\n                    while (iter.hasNext()) {\n                        SelectionKey key = iter.next();\n                        iter.remove();\n                        if (key.isAcceptable()) {\n                            ServerSocketChannel c = (ServerSocketChannel) key.channel();\n                            SocketChannel sc = c.accept();\n                            sc.configureBlocking(false);\n                            log.debug(\"{} connected\", sc.getRemoteAddress());\n                            workers[index.getAndIncrement() % workers.length].register(sc);\n                        }\n                    }\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    @Slf4j\n    static class WorkerEventLoop implements Runnable {\n        private Selector worker;\n        private volatile boolean start = false;\n        private int index;\n\n        private final ConcurrentLinkedQueue\u003cRunnable\u003e tasks = new ConcurrentLinkedQueue\u003c\u003e();\n\n        public WorkerEventLoop(int index) {\n            this.index = index;\n        }\n\n        public void register(SocketChannel sc) throws IOException {\n            if (!start) {\n                worker = Selector.open();\n                new Thread(this, \"worker-\" + index).start();\n                start = true;\n            }\n            tasks.add(() -\u003e {\n                try {\n                    SelectionKey sckey = sc.register(worker, 0, null);\n                    sckey.interestOps(SelectionKey.OP_READ);\n                    worker.selectNow();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            });\n            worker.wakeup();\n        }\n\n        @Override\n        public void run() {\n            while (true) {\n                try {\n                    worker.select();\n                    Runnable task = tasks.poll();\n                    if (task != null) {\n                        task.run();\n                    }\n                    Set\u003cSelectionKey\u003e keys = worker.selectedKeys();\n                    Iterator\u003cSelectionKey\u003e iter = keys.iterator();\n                    while (iter.hasNext()) {\n                        SelectionKey key = iter.next();\n                        if (key.isReadable()) {\n                            SocketChannel sc = (SocketChannel) key.channel();\n                            ByteBuffer buffer = ByteBuffer.allocate(128);\n                            try {\n                                int read = sc.read(buffer);\n                                if (read == -1) {\n                                    key.cancel();\n                                    sc.close();\n                                } else {\n                                    buffer.flip();\n                                    log.debug(\"{} message:\", sc.getRemoteAddress());\n                                    debugAll(buffer);\n                                }\n                            } catch (IOException e) {\n                                e.printStackTrace();\n                                key.cancel();\n                                sc.close();\n                            }\n                        }\n                        iter.remove();\n                    }\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n```\n\n#### æ”¹é€ æˆå¤šçº¿ç¨‹æ—¶é‡åˆ°çš„é—®é¢˜\n\nworkerçš„é€‰æ‹©å™¨æ³¨å†Œæ—¶æœºéœ€è¦æ³¨æ„ï¼š\nåœ¨workerçš„registerä»£ç æ˜¯è¿™æ ·çš„ï¼š\n\n```java\nif (!start) {  \n    selector = Selector.open();  \n    thread = new Thread(this, name);  \n    thread.start();  \n    start = true;  \n}\n```\n\nè€Œçˆ¶çº¿ç¨‹æ¥æ”¶åˆ°æ–°çš„è¿æ¥å»ºç«‹äº‹ä»¶åï¼Œå‘workeræ³¨å†Œä¸€ä¸ªé€‰æ‹©å™¨ï¼Œé€‰æ‹©å™¨çš„æ³¨å†Œåº”è¯¥å‘ç”Ÿåœ¨`selector = Selector.open();`ä¹‹å`thread.start();`ä¹‹å‰ã€‚\nå¦åˆ™ä¼šå‘ç”Ÿç©ºæŒ‡é’ˆå¼‚å¸¸æˆ–è€…å­çº¿ç¨‹å…ˆè¡Œå¯åŠ¨é˜»å¡æ­»åœ¨run()ä¸­çš„`worker.select();`ä¸Šå¯¼è‡´é€‰æ‹©å™¨æ°¸è¿œæ— æ³•æ³¨å†ŒæˆåŠŸã€‚\n\nworkerä¸€æ—¦è°ƒç”¨äº†registerå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œrunæ–¹æ³•ï¼Œè¿™æ—¶çº¿ç¨‹ä¼šé˜»å¡åœ¨runä¸­çš„selector.selectæ–¹æ³•ä¸­ï¼Œå¹¶ä¸”æ­¤å¤„è¿˜åœ¨è¿æ¥å»ºç«‹é˜¶æ®µï¼Œæ²¡æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿã€‚\nè¿™ä¼šå¯¼è‡´æ–°çš„è¿æ¥å»ºç«‹æ—¶ï¼Œåœ¨ç®¡ç†è¿æ¥å»ºç«‹çš„çº¿ç¨‹ä¸­æ— æ³•æ­£å¸¸è°ƒç”¨`sc.register(selector, SelectionKey.OP_READ);`ç»‘å®šscçš„é€‰æ‹©å™¨ï¼Œå› ä¸ºæ­¤æ—¶workerä¸­çš„é€‰æ‹©å™¨å·²ç»æ˜¯é˜»å¡çŠ¶æ€ã€‚\n\nè§£å†³æ–¹æ³•ï¼š\nè®©registerå’Œselectåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ–¹ä¾¿æ§åˆ¶å…ˆåé¡ºåº --\u003e å°†é€‰æ‹©å™¨æ³¨å†ŒåŠ¨ä½œäº¤ç»™å­çº¿ç¨‹æ‰§è¡Œ --\u003e éœ€è¦å°†åŠ¨ä½œä¼ é€’ç»™å­çº¿ç¨‹ --\u003e ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹é€šè®¯|çº¿ç¨‹é€šè®¯]]ï¼š\nå°†scçš„é€‰æ‹©å™¨æ³¨å†ŒåŠ¨ä½œåŒ…è£…æˆä»»åŠ¡ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ä¼ é€’ç»™workerçº¿ç¨‹å»æ‰§è¡Œã€‚\n\n```java\npublic void register (SocketChannel sc) throws IOException {  \n    if (!start) {  \n        selector = Selector.open();  \n        thread = new Thread(this, name);  \n        thread.start();  \n        start = true;  \n    }  \n    queue.add(()-\u003e{  \n        try {  \n            sc.register(selector, SelectionKey.OP_READ);  \n        } catch (ClosedChannelException e) {  \n            throw new RuntimeException(e);  \n        }  \n    });  \n    selector.wakeup();  \n}\n```\n\nä¸Šè¿°ä»£ç è™½ç„¶threadå®é™…å¯èƒ½ä¼šåäº`selector.wakeup();`å¯åŠ¨ï¼Œä½†æ˜¯wakeupæœ‰ç±»ä¼¼park\u0026unparkçš„æå‰é‡Šæ”¾çš„ç‰¹æ€§ï¼š\n\n\u003ewakeupä½¿å°šæœªè¿”å›çš„ç¬¬ä¸€ä¸ªé€‰æ‹©æ“ä½œç«‹å³è¿”å›ã€‚ å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹å½“å‰åœ¨è°ƒç”¨selectæ—¶è¢«é˜»å¡ï¼Œé‚£ä¹ˆè°ƒç”¨å°†ç«‹å³è¿”å›ã€‚å¦‚æœå½“å‰æ²¡æœ‰è¿›è¡Œé€‰æ‹©æ“ä½œï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•ä¸­çš„ä¸€ä¸ªçš„**ä¸‹ä¸€æ¬¡**è°ƒç”¨å°†ç«‹å³è¿”å›\n\n#### ğŸ’¡ å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•°\n\n\u003e -   Runtime.getRuntime().availableProcessors() å¦‚æœå·¥ä½œåœ¨ docker å®¹å™¨ä¸‹ï¼Œå› ä¸ºå®¹å™¨ä¸æ˜¯ç‰©ç†éš”ç¦»çš„ï¼Œä¼šæ‹¿åˆ°ç‰©ç† cpu ä¸ªæ•°ï¼Œè€Œä¸æ˜¯å®¹å™¨ç”³è¯·æ—¶çš„ä¸ªæ•°\n\u003e -   è¿™ä¸ªé—®é¢˜ç›´åˆ° jdk 10 æ‰ä¿®å¤ï¼Œä½¿ç”¨ jvm å‚æ•° UseContainerSupport é…ç½®ï¼Œ é»˜è®¤å¼€å¯\n\n### 4.7 UDP\n\n- UDP æ˜¯æ— è¿æ¥çš„ï¼Œclient å‘é€æ•°æ®ä¸ä¼šç®¡ server æ˜¯å¦å¼€å¯\n- server è¿™è¾¹çš„ receive æ–¹æ³•ä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å…¥ byte bufferï¼Œä½†å¦‚æœæ•°æ®æŠ¥æ–‡è¶…è¿‡ buffer å¤§å°ï¼Œå¤šå‡ºæ¥çš„æ•°æ®ä¼šè¢«é»˜é»˜**æŠ›å¼ƒ**\n\né¦–å…ˆå¯åŠ¨æœåŠ¡å™¨ç«¯\n\n```java\npublic class UdpServer {\n    public static void main(String[] args) {\n        try (DatagramChannel channel = DatagramChannel.open()) {\n            channel.socket().bind(new InetSocketAddress(9999));\n            System.out.println(\"waiting...\");\n            ByteBuffer buffer = ByteBuffer.allocate(32);\n            channel.receive(buffer);\n            buffer.flip();\n            debug(buffer);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\nè¾“å‡º\n\n```\nwaiting...\n```\n\nè¿è¡Œå®¢æˆ·ç«¯\n\n```java\npublic class UdpClient {\n    public static void main(String[] args) {\n        try (DatagramChannel channel = DatagramChannel.open()) {\n            ByteBuffer buffer = StandardCharsets.UTF_8.encode(\"hello\");\n            InetSocketAddress address = new InetSocketAddress(\"localhost\", 9999);\n            channel.send(buffer, address);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\næ¥ä¸‹æ¥æœåŠ¡å™¨ç«¯è¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 68 65 6c 6c 6f                                  |hello           |\n+--------+-------------------------------------------------+----------------+\n```\n\n## 5. NIO vs BIO\n\n### 5.1 stream vs channel\n\n\u003estreamæ˜¯æ›´é«˜å±‚æŠ½è±¡çš„æ¥å£ï¼Œä¸ä¼šå»å…³å¿ƒç³»ç»Ÿå¯¹IOæ“ä½œæä¾›çš„ä¸€äº›ç¼“å†²åŒºã€‚\n\n- stream ä¸ä¼šè‡ªåŠ¨ç¼“å†²æ•°æ®ï¼Œchannel ä¼šåˆ©ç”¨ç³»ç»Ÿæä¾›çš„å‘é€ç¼“å†²åŒºã€æ¥æ”¶ç¼“å†²åŒºï¼ˆæ›´ä¸ºåº•å±‚ï¼‰\n- stream ä»…æ”¯æŒé˜»å¡ APIï¼Œchannel åŒæ—¶æ”¯æŒé˜»å¡ã€éé˜»å¡ APIï¼Œç½‘ç»œ channel å¯é…åˆ selector å®ç°å¤šè·¯å¤ç”¨\n- äºŒè€…å‡ä¸º**å…¨åŒå·¥**ï¼Œå³è¯»å†™å¯ä»¥åŒæ—¶è¿›è¡Œ\n\n### ğŸ’¡ 5.2 IO æ¨¡å‹\n\nåŒæ­¥é˜»å¡ã€åŒæ­¥éé˜»å¡ã€åŒæ­¥å¤šè·¯å¤ç”¨ã€å¼‚æ­¥é˜»å¡ï¼ˆé”™çš„æ²¡æœ‰æ­¤æƒ…å†µï¼‰ã€å¼‚æ­¥éé˜»å¡\n\u003e å¼‚æ­¥ä¸€å®šæ˜¯éé˜»å¡çš„ã€‚\n\n\n- åŒæ­¥ï¼šçº¿ç¨‹**è‡ªå·±**å»è·å–ç»“æœï¼ˆä¸€ä¸ªçº¿ç¨‹ï¼‰\n- å¼‚æ­¥ï¼šçº¿ç¨‹è‡ªå·±ä¸å»è·å–ç»“æœï¼Œè€Œæ˜¯ç”±**å…¶å®ƒçº¿ç¨‹**é€ç»“æœï¼ˆè‡³å°‘ä¸¤ä¸ªçº¿ç¨‹ï¼‰\n\nå½“è°ƒç”¨ä¸€æ¬¡ channel.read æˆ– stream.read åï¼Œä¼šåˆ‡æ¢è‡³æ“ä½œç³»ç»Ÿå†…æ ¸æ€æ¥å®ŒæˆçœŸæ­£æ•°æ®è¯»å–ï¼Œè€Œè¯»å–åˆåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼š\n\n- ç­‰å¾…æ•°æ®é˜¶æ®µ\n- å¤åˆ¶æ•°æ®é˜¶æ®µ\n\n![[z-oblib/z2-attachments/9beda40e996875e42ae18f1a4010cb0e.png]]\n\n#### é˜»å¡ IO\n\n    \n![[z-oblib/z2-attachments/d6140fbe21ad3029c901c39fc656c80f.png]]\n    \n\n#### éé˜»å¡ IO\n\n\u003e åªæœ‰ç­‰å¾…æ•°æ®é˜¶æ®µæ˜¯éé˜»å¡çš„ï¼Œå¤åˆ¶æ•°æ®é˜¶æ®µè¿˜æ˜¯é˜»å¡çš„ã€‚\n\u003e ç­‰å¾…æ•°æ®æ—¶é¢‘ç¹çš„ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢å¼€é”€è¾ƒå¤§ã€‚\n \n![[z-oblib/z2-attachments/bee47ff0353597736841cb77f39de290.png]]\n    \n\n#### å¤šè·¯å¤ç”¨\n\n![[z-oblib/z2-attachments/92295a6cadbef7f318b447c195cfdaaf.png]]\n\n#### ä¿¡å·é©±åŠ¨\n\nä¸å¸¸ç”¨ã€‚\n\n#### å¼‚æ­¥ IO\n\n![[z-oblib/z2-attachments/d24fd0f79f08ba57c427e8105d1b723b.png]]\n\n#### é˜»å¡ IO vs å¤šè·¯å¤ç”¨\n\n    \n![[z-oblib/z2-attachments/b14515879b743602954685e6403970ad.png]]\n    \n![[z-oblib/z2-attachments/fe68785fc885d9bbfa4e9fa6a973dbe3.png]]\n\n\u003e å¤šè·¯å¤ç”¨å¯ä»¥ä¸€æ¬¡è¿”å›å¤šä¸ªäº‹ä»¶ï¼šç›¸å½“äºç»™äº‹ä»¶æœ¬èº«åŠ äº†ä¸ªç¼“å†²åŒºã€‚\n\u003e ä½†æ“ä½œçš„æ—¶å€™åªèƒ½çº¿æ€§ä¸€ä¸ªä¸ªå¤„ç†ã€‚\n\n#### ğŸ”– å‚è€ƒ\n\nUNIX ç½‘ç»œç¼–ç¨‹ - å· I\n\n### 5.3 é›¶æ‹·è´\n\n\u003e 0æ‹·è´æ˜¯æŒ‡ä¸ç”¨æ‹·è´åˆ°ç”¨æˆ·æ€çš„javaå†…å­˜ï¼Œè€Œç›´æ¥åœ¨å†…æ ¸æ€çš„æ“ä½œç³»ç»Ÿå†…å­˜ä¹‹é—´æ‹·è´ã€‚\n\n#### ä¼ ç»Ÿ IO é—®é¢˜\n\nä¼ ç»Ÿçš„ IO å°†ä¸€ä¸ªæ–‡ä»¶ é€šè¿‡ socket å†™å‡º\n\n```java\nFile f = new File(\"helloword/data.txt\");\nRandomAccessFile file = new RandomAccessFile(file, \"r\");\n\nbyte[] buf = new byte[(int)f.length()];\nfile.read(buf);\n\nSocket socket = ...;\nsocket.getOutputStream().write(buf);\n```\n\nå†…éƒ¨å·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š\n\n![[z-oblib/z2-attachments/f89991c08c85fc0760ce56280440b6b6.png]]\n\n1. java æœ¬èº«å¹¶ä¸å…·å¤‡ IO è¯»å†™èƒ½åŠ›ï¼Œå› æ­¤ read æ–¹æ³•è°ƒç”¨åï¼Œè¦ä» java ç¨‹åºçš„**ç”¨æˆ·æ€**åˆ‡æ¢è‡³**å†…æ ¸æ€**ï¼Œå»è°ƒç”¨æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰çš„è¯»èƒ½åŠ›ï¼Œå°†æ•°æ®è¯»å…¥**å†…æ ¸ç¼“å†²åŒº**ã€‚è¿™æœŸé—´ç”¨æˆ·çº¿ç¨‹é˜»å¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨ DMAï¼ˆDirect Memory Accessï¼‰æ¥å®ç°æ–‡ä»¶è¯»ï¼Œå…¶é—´ä¹Ÿä¸ä¼šä½¿ç”¨ cpu\n    \n    \u003e DMA ä¹Ÿå¯ä»¥ç†è§£ä¸ºç¡¬ä»¶å•å…ƒï¼Œç”¨æ¥è§£æ”¾ cpu å®Œæˆæ–‡ä»¶ IO\n    \n2. ä»**å†…æ ¸æ€**åˆ‡æ¢å›**ç”¨æˆ·æ€**ï¼Œå°†æ•°æ®ä»**å†…æ ¸ç¼“å†²åŒº**è¯»å…¥**ç”¨æˆ·ç¼“å†²åŒº**ï¼ˆå³ byte[] bufï¼‰ï¼Œè¿™æœŸé—´ cpu ä¼šå‚ä¸æ‹·è´ï¼Œæ— æ³•åˆ©ç”¨ DMA\n    \n3. è°ƒç”¨ write æ–¹æ³•ï¼Œè¿™æ—¶å°†æ•°æ®ä»**ç”¨æˆ·ç¼“å†²åŒº**ï¼ˆbyte[] bufï¼‰å†™å…¥ **socket ç¼“å†²åŒº**ï¼Œcpu ä¼šå‚ä¸æ‹·è´\n    \n4. æ¥ä¸‹æ¥è¦å‘ç½‘å¡å†™æ•°æ®ï¼Œè¿™é¡¹èƒ½åŠ› java åˆä¸å…·å¤‡ï¼Œå› æ­¤åˆå¾—ä»**ç”¨æˆ·æ€**åˆ‡æ¢è‡³**å†…æ ¸æ€**ï¼Œè°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†™èƒ½åŠ›ï¼Œä½¿ç”¨ DMA å°† **socket ç¼“å†²åŒº**çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu\n    \n\nå¯ä»¥çœ‹åˆ°ä¸­é—´ç¯èŠ‚è¾ƒå¤šï¼Œjava çš„ IO å®é™…ä¸æ˜¯ç‰©ç†è®¾å¤‡çº§åˆ«çš„è¯»å†™ï¼Œè€Œæ˜¯ç¼“å­˜çš„å¤åˆ¶ï¼Œåº•å±‚çš„çœŸæ­£è¯»å†™æ˜¯æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„\n\n- ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢å‘ç”Ÿäº† **3** æ¬¡ï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒé‡é‡çº§\n- æ•°æ®æ‹·è´äº†å…± **4** æ¬¡\n\n#### NIO ä¼˜åŒ–\n\né€šè¿‡ DirectByteBuf\n\n- ByteBuffer.allocate(10) HeapByteBuffer ä½¿ç”¨çš„è¿˜æ˜¯ java å†…å­˜\n- ByteBuffer.allocateDirect(10) DirectByteBuffer ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿå†…å­˜\n\n![[z-oblib/z2-attachments/c3dd38c405a8e36fc37c50dde0478ed8.png]]\n\nå¤§éƒ¨åˆ†æ­¥éª¤ä¸ä¼˜åŒ–å‰ç›¸åŒï¼Œä¸å†èµ˜è¿°ã€‚å”¯æœ‰ä¸€ç‚¹ï¼šjava å¯ä»¥**ä½¿ç”¨ DirectByteBuf å°†å †å¤–å†…å­˜æ˜ å°„åˆ° jvm å†…å­˜ä¸­æ¥ç›´æ¥è®¿é—®ä½¿ç”¨**\n\n- è¿™å—å†…å­˜ä¸å— jvm åƒåœ¾å›æ”¶çš„å½±å“ï¼Œå› æ­¤å†…å­˜åœ°å€å›ºå®šï¼Œæœ‰åŠ©äº IO è¯»å†™\n- java ä¸­çš„ DirectByteBuf å¯¹è±¡ä»…ç»´æŠ¤äº†æ­¤å†…å­˜çš„è™šå¼•ç”¨ï¼Œå†…å­˜å›æ”¶åˆ†æˆä¸¤æ­¥\n    - DirectByteBuf å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œå°†è™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—\n    - é€šè¿‡ä¸“é—¨çº¿ç¨‹è®¿é—®å¼•ç”¨é˜Ÿåˆ—ï¼Œæ ¹æ®è™šå¼•ç”¨é‡Šæ”¾å †å¤–å†…å­˜\n- å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢æ¬¡æ•°æ²¡æœ‰å‡å°‘\n\nè¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆåº•å±‚é‡‡ç”¨äº† linux 2.1 åæä¾›çš„ sendFile æ–¹æ³•ï¼‰ï¼Œjava ä¸­å¯¹åº”ç€ä¸¤ä¸ª channel è°ƒç”¨ transferTo/transferFrom æ–¹æ³•æ‹·è´æ•°æ®\n\n![[z-oblib/z2-attachments/ded2b7613a6a8c4981724457f2157b22.png]]\n\n1. java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„**ç”¨æˆ·æ€**åˆ‡æ¢è‡³**å†…æ ¸æ€**ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥**å†…æ ¸ç¼“å†²åŒº**ï¼Œä¸ä¼šä½¿ç”¨ cpu\n2. æ•°æ®ä»**å†…æ ¸ç¼“å†²åŒº**ä¼ è¾“åˆ° **socket ç¼“å†²åŒº**ï¼Œcpu ä¼šå‚ä¸æ‹·è´\n3. æœ€åä½¿ç”¨ DMA å°† **socket ç¼“å†²åŒº**çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu\n\nå¯ä»¥çœ‹åˆ°\n\n- åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢\n- æ•°æ®æ‹·è´äº† 3 æ¬¡\n\nè¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆlinux 2.4ï¼‰\n\n![[z-oblib/z2-attachments/f6c24eee6470e9511e439a78cbf37a99.png]]\n\n1. java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„**ç”¨æˆ·æ€**åˆ‡æ¢è‡³**å†…æ ¸æ€**ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥**å†…æ ¸ç¼“å†²åŒº**ï¼Œä¸ä¼šä½¿ç”¨ cpu\n2. åªä¼šå°†ä¸€äº› offset å’Œ length ä¿¡æ¯æ‹·å…¥ **socket ç¼“å†²åŒº**ï¼Œå‡ ä¹æ— æ¶ˆè€—\n3. ä½¿ç”¨ DMA å°† **å†…æ ¸ç¼“å†²åŒº**çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu\n\næ•´ä¸ªè¿‡ç¨‹ä»…åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ•°æ®æ‹·è´äº† 2 æ¬¡ã€‚æ‰€è°“çš„ã€é›¶æ‹·è´ã€‘ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ— æ‹·è´ï¼Œè€Œæ˜¯åœ¨ä¸ä¼šæ‹·è´é‡å¤æ•°æ®åˆ° jvm å†…å­˜ä¸­ï¼Œé›¶æ‹·è´çš„ä¼˜ç‚¹æœ‰\n\n##### ä¼˜ç‚¹\n\n- æ›´å°‘çš„ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢\n- ä¸åˆ©ç”¨ cpu è®¡ç®—ï¼Œå‡å°‘ cpu ç¼“å­˜ä¼ªå…±äº« ï¼ˆä½¿ç”¨DMAç¡¬ä»¶è¿›è¡Œæ•°æ®ä¼ è¾“ï¼‰\n- é›¶æ‹·è´é€‚åˆ**å°**æ–‡ä»¶ä¼ è¾“\n\t- å…¸å‹çš„ä¼ è¾“ä¾‹å¦‚ç½‘å¡ï¼Œå‘é€çš„æ•°æ®å¯èƒ½åªè¢«è¯»å–ä¸€æ¬¡ï¼Œä½†æ˜¯å ç”¨äº†ç¼“å†²åŒºçš„ç©ºé—´ã€‚\n\n### 5.3 AIO\n\nAIOï¼ˆå¼‚æ­¥IOï¼‰ ç”¨æ¥è§£å†³æ•°æ®å¤åˆ¶é˜¶æ®µçš„é˜»å¡é—®é¢˜\n\n- åŒæ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ç»“æœï¼Œè¿˜æ˜¯ç›¸å½“äºé—²ç½®\n- å¼‚æ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸å¿…ç­‰å¾…ç»“æœï¼Œè€Œæ˜¯å°†æ¥ç”±æ“ä½œç³»ç»Ÿæ¥é€šè¿‡å›è°ƒæ–¹å¼ç”±å¦å¤–çš„çº¿ç¨‹æ¥è·å¾—ç»“æœ\n\n\u003e å¼‚æ­¥æ¨¡å‹éœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰æä¾›æ”¯æŒ\n\u003e \n\u003e -   Windows ç³»ç»Ÿé€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ IO\n\u003e -   Linux ç³»ç»Ÿå¼‚æ­¥ IO åœ¨ 2.6 ç‰ˆæœ¬å¼•å…¥ï¼Œä½†å…¶åº•å±‚å®ç°è¿˜æ˜¯ç”¨å¤šè·¯å¤ç”¨æ¨¡æ‹Ÿäº†å¼‚æ­¥ IOï¼Œæ€§èƒ½æ²¡æœ‰ä¼˜åŠ¿\n\n#### æ–‡ä»¶ AIO\n\nå…ˆæ¥çœ‹çœ‹ AsynchronousFileChannel\n\n```java\n@Slf4j\npublic class AioDemo1 {\n    public static void main(String[] args) throws IOException {\n        try{\n            AsynchronousFileChannel s = \n                AsynchronousFileChannel.open(\n                    Paths.get(\"1.txt\"), StandardOpenOption.READ);\n            ByteBuffer buffer = ByteBuffer.allocate(2);\n            log.debug(\"begin...\");\n            s.read(buffer, 0, null, new CompletionHandler\u003cInteger, ByteBuffer\u003e() {\n                @Override\n                public void completed(Integer result, ByteBuffer attachment) {\n                    log.debug(\"read completed...{}\", result);\n                    buffer.flip();\n                    debug(buffer);\n                }\n\n                @Override\n                public void failed(Throwable exc, ByteBuffer attachment) {\n                    log.debug(\"read failed...\");\n                }\n            });\n\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        log.debug(\"do other things...\");\n        System.in.read();\n    }\n}\n```\n\nè¾“å‡º\n\n```\n13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - begin...\n13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - do other things...\n13:44:56 [DEBUG] [Thread-5] c.i.aio.AioDemo1 - read completed...2\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 61 0d                                           |a.              |\n+--------+-------------------------------------------------+----------------+\n```\n\nå¯ä»¥çœ‹åˆ°\n\n- å“åº”æ–‡ä»¶è¯»å–æˆåŠŸçš„æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹ Thread-5\n- ä¸»çº¿ç¨‹å¹¶æ²¡æœ‰ IO æ“ä½œé˜»å¡\n\n#### ğŸ’¡ å®ˆæŠ¤çº¿ç¨‹\n\né»˜è®¤æ–‡ä»¶ AIO ä½¿ç”¨çš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥æœ€åè¦æ‰§è¡Œ `System.in.read()` ä»¥é¿å…å®ˆæŠ¤çº¿ç¨‹æ„å¤–ç»“æŸ\n\n#### ç½‘ç»œ AIO\n\n```java\npublic class AioServer {\n    public static void main(String[] args) throws IOException {\n        AsynchronousServerSocketChannel ssc = AsynchronousServerSocketChannel.open();\n        ssc.bind(new InetSocketAddress(8080));\n        ssc.accept(null, new AcceptHandler(ssc));\n        System.in.read();\n    }\n\n    private static void closeChannel(AsynchronousSocketChannel sc) {\n        try {\n            System.out.printf(\"[%s] %s close\\n\", Thread.currentThread().getName(), sc.getRemoteAddress());\n            sc.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    private static class ReadHandler implements CompletionHandler\u003cInteger, ByteBuffer\u003e {\n        private final AsynchronousSocketChannel sc;\n\n        public ReadHandler(AsynchronousSocketChannel sc) {\n            this.sc = sc;\n        }\n\n        @Override\n        public void completed(Integer result, ByteBuffer attachment) {\n            try {\n                if (result == -1) {\n                    closeChannel(sc);\n                    return;\n                }\n                System.out.printf(\"[%s] %s read\\n\", Thread.currentThread().getName(), sc.getRemoteAddress());\n                attachment.flip();\n                System.out.println(Charset.defaultCharset().decode(attachment));\n                attachment.clear();\n                // å¤„ç†å®Œç¬¬ä¸€ä¸ª read æ—¶ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ read æ–¹æ³•æ¥å¤„ç†ä¸‹ä¸€ä¸ª read äº‹ä»¶\n                sc.read(attachment, attachment, this);\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n\n        @Override\n        public void failed(Throwable exc, ByteBuffer attachment) {\n            closeChannel(sc);\n            exc.printStackTrace();\n        }\n    }\n\n    private static class WriteHandler implements CompletionHandler\u003cInteger, ByteBuffer\u003e {\n        private final AsynchronousSocketChannel sc;\n\n        private WriteHandler(AsynchronousSocketChannel sc) {\n            this.sc = sc;\n        }\n\n        @Override\n        public void completed(Integer result, ByteBuffer attachment) {\n            // å¦‚æœä½œä¸ºé™„ä»¶çš„ buffer è¿˜æœ‰å†…å®¹ï¼Œéœ€è¦å†æ¬¡ write å†™å‡ºå‰©ä½™å†…å®¹\n            if (attachment.hasRemaining()) {\n                sc.write(attachment);\n            }\n        }\n\n        @Override\n        public void failed(Throwable exc, ByteBuffer attachment) {\n            exc.printStackTrace();\n            closeChannel(sc);\n        }\n    }\n\n    private static class AcceptHandler implements CompletionHandler\u003cAsynchronousSocketChannel, Object\u003e {\n        private final AsynchronousServerSocketChannel ssc;\n\n        public AcceptHandler(AsynchronousServerSocketChannel ssc) {\n            this.ssc = ssc;\n        }\n\n        @Override\n        public void completed(AsynchronousSocketChannel sc, Object attachment) {\n            try {\n                System.out.printf(\"[%s] %s connected\\n\", Thread.currentThread().getName(), sc.getRemoteAddress());\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            ByteBuffer buffer = ByteBuffer.allocate(16);\n            // è¯»äº‹ä»¶ç”± ReadHandler å¤„ç†\n            sc.read(buffer, buffer, new ReadHandler(sc));\n            // å†™äº‹ä»¶ç”± WriteHandler å¤„ç†\n            sc.write(Charset.defaultCharset().encode(\"server hello!\"), ByteBuffer.allocate(16), new WriteHandler(sc));\n            // å¤„ç†å®Œç¬¬ä¸€ä¸ª accpet æ—¶ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ accept æ–¹æ³•æ¥å¤„ç†ä¸‹ä¸€ä¸ª accept äº‹ä»¶\n            ssc.accept(null, this);\n        }\n\n        @Override\n        public void failed(Throwable exc, Object attachment) {\n            exc.printStackTrace();\n        }\n    }\n}\n```\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Python/%E6%9F%AF%E9%87%8C%E5%8C%96":{"title":"æŸ¯é‡ŒåŒ–","content":"\n# æŸ¯é‡ŒåŒ–\n\næŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å‡½æ•°çš„è½¬æ¢ï¼Œå®ƒæ˜¯æŒ‡å°†ä¸€ä¸ªå‡½æ•°ä»å¯è°ƒç”¨çš„ f(a, b, c) è½¬æ¢ä¸ºå¯è°ƒç”¨çš„ f(a)(b)(c) ã€‚ æŸ¯é‡ŒåŒ–ä¸ä¼šè°ƒç”¨å‡½æ•°ã€‚\n\n\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Python/%E9%97%AD%E5%8C%85":{"title":"é—­åŒ…","content":"\n# é—­åŒ…\n\né—­åŒ…å­˜å‚¨äº†ä¸€ä¸ªå‡½æ•°ï¼ˆé€šå¸¸æ˜¯å…¶å…¥å£åœ°å€ï¼‰å’Œä¸€ä¸ªå…³è”çš„ç¯å¢ƒï¼ˆç›¸å½“äºä¸€ä¸ªç¬¦å·æŸ¥æ‰¾è¡¨ï¼‰ã€‚\nç¯å¢ƒé‡Œæ˜¯è‹¥å¹²å¯¹ç¬¦å·å’Œå€¼çš„å¯¹åº”å…³ç³»ï¼Œå®ƒæ—¢è¦åŒ…æ‹¬[çº¦æŸå˜é‡](https://zh.m.wikipedia.org/wiki/%E7%BA%A6%E6%9D%9F%E5%8F%98%E9%87%8F \"çº¦æŸå˜é‡\")ï¼ˆè¯¥å‡½æ•°å†…éƒ¨ç»‘å®šçš„ç¬¦å·ï¼‰ï¼Œä¹Ÿè¦åŒ…æ‹¬[è‡ªç”±å˜é‡](https://zh.m.wikipedia.org/wiki/%E8%87%AA%E7%94%B1%E5%8F%98%E9%87%8F \"è‡ªç”±å˜é‡\")ï¼ˆåœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰ä½†åœ¨å‡½æ•°å†…è¢«å¼•ç”¨ï¼‰ï¼Œæœ‰äº›å‡½æ•°ä¹Ÿå¯èƒ½æ²¡æœ‰è‡ªç”±å˜é‡ã€‚é—­åŒ…è·Ÿå‡½æ•°æœ€å¤§çš„ä¸åŒåœ¨äºï¼Œå½“æ•æ‰é—­åŒ…çš„æ—¶å€™ï¼Œå®ƒçš„è‡ªç”±å˜é‡ä¼šåœ¨æ•æ‰æ—¶è¢«ç¡®å®šï¼Œè¿™æ ·å³ä¾¿è„±ç¦»äº†æ•æ‰æ—¶çš„ä¸Šä¸‹æ–‡ï¼Œå®ƒä¹Ÿèƒ½ç…§å¸¸è¿è¡Œã€‚\n\n## å‚è€ƒ\n\n[é—­åŒ… (è®¡ç®—æœºç§‘å­¦) - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ (wikipedia.org)](https://zh.m.wikipedia.org/zh/%E9%97%AD%E5%8C%85_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6))\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Python/GIL":{"title":"GIL","content":"\n# GIL\n\nåœ¨ä»»æ„æ—¶é—´åªæœ‰ä¸€ä¸ªPythonè§£é‡Šå™¨åœ¨è§£é‡ŠPythonÂ bytecodeã€‚\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Python/Python%E4%B8%AD16%E8%BF%9B%E5%88%B6%E4%B8%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2":{"title":"Pythonä¸­16è¿›åˆ¶ä¸å­—ç¬¦ä¸²è½¬æ¢","content":"# Pythonä¸­16è¿›åˆ¶ä¸å­—ç¬¦ä¸²è½¬æ¢\n\n## python3 ä¸­çš„å­—ç¬¦ä¸²å’Œç¼–ç \n\n- åœ¨æœ€æ–°çš„ Python 3 ç‰ˆæœ¬ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯ä»¥ Unicode ç¼–ç çš„\n- Python çš„å­—ç¬¦ä¸²ç±»å‹æ˜¯str\n- åœ¨å†…å­˜ä¸­ä»¥Unicodeè¡¨ç¤ºï¼Œä¸€ä¸ªå­—ç¬¦å¯¹åº”è‹¥å¹²ä¸ªå­—èŠ‚\n- å¦‚æœè¦åœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œæˆ–è€…ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå°±éœ€è¦æŠŠstrå˜ä¸ºä»¥å­—èŠ‚ä¸ºå•ä½çš„ bytes\n\n```\næ³¨æ„åŒºåˆ† `'ABC'` å’Œ` b'ABC'` ï¼Œå‰è€…æ˜¯`str`ï¼Œåè€…è™½ç„¶å†…å®¹æ˜¾ç¤ºå¾—å’Œå‰è€…ä¸€æ ·ï¼Œä½†`bytes`çš„æ¯ä¸ªå­—ç¬¦éƒ½åªå ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚\n```\n\n## hex()\n\n- hex() å‡½æ•°ç”¨äºå°†10è¿›åˆ¶æ•´æ•°è½¬æ¢æˆ16è¿›åˆ¶ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤º\n\n```\næ³¨æ„! hex() è¿”å›çš„ç»“æœä¸æ˜¯æ•´æ•°, è€Œæ˜¯ 16 è¿›åˆ¶çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼!\n```\n\n## 0x è¡¨ç¤ºçš„ 16 è¿›åˆ¶æ•°\n\n```py\na = 0xA\nb = 0x5\nc = a * b\nprint(a)\nprint(c)\n```\n\nè¾“å‡ºçš„ç»“æœ:\n\n```\n10\n50\n```\n\n```\nä¸¤ä¸ª 16 è¿›åˆ¶æ•°ç›¸ä¹˜, ç»“æœæ˜¯ä»¥ 10 è¿›åˆ¶ä¿å­˜çš„!\n```\n\n## str.encode()\n\nä»¥ Unicode è¡¨ç¤ºçš„ str é€šè¿‡ encode() æ–¹æ³•å¯ä»¥ç¼–ç ä¸ºæŒ‡å®šçš„ bytes\n\n```py\nstr.encode(encoding='UTF-8',errors='strict')\n```\n\n```py\n\u003e\u003e\u003e 'ABC'.encode('ascii')\nb'ABC'\n\u003e\u003e\u003e 'ä¸­æ–‡'.encode('utf-8')\nb'\\xe4\\xb8\\xad\\xe6\\x96\\x87'\n\u003e\u003e\u003e 'ä¸­æ–‡'.encode('ascii')\nTraceback (most recent call last):\n  File \"\u003cstdin\u003e\", line 1, in \u003cmodule\u003e\nUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)\n```\n\n- çº¯è‹±æ–‡çš„strå¯ä»¥ç”¨ ASCII , UTF-8, ç¼–ç ä¸º bytesï¼Œå†…å®¹æ˜¯ä¸€æ ·çš„\n- å«æœ‰ä¸­æ–‡çš„strå¯ä»¥ç”¨ UTF-8 ç¼–ç ä¸ºbytesã€‚\n- å«æœ‰ä¸­æ–‡çš„stræ— æ³•ç”¨ASCIIç¼–ç \n    - å› ä¸ºä¸­æ–‡ç¼–ç çš„èŒƒå›´è¶…è¿‡äº†ASCIIç¼–ç çš„èŒƒå›´\n\n```\nè¯¥æ–¹æ³•è¿”å›ç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œå®ƒæ˜¯ä¸€ä¸ª bytes å¯¹è±¡ã€‚\n```\n\n## bytes.decode()\n\n- å¦‚æœæˆ‘ä»¬ä»ç½‘ç»œæˆ–ç£ç›˜ä¸Šè¯»å–äº†å­—èŠ‚æµï¼Œé‚£ä¹ˆè¯»åˆ°çš„æ•°æ®å°±æ˜¯ bytes\n- è¦æŠŠbyteså˜ä¸ºstrï¼Œå°±éœ€è¦ç”¨decode()æ–¹æ³•\n\n```py\nbytes.decode(encoding=\"utf-8\", errors=\"strict\")\n```\n\n```py\n\u003e\u003e\u003e b'ABC'.decode('ascii')\n'ABC'\n\u003e\u003e\u003e b'\\xe4\\xb8\\xad\\xe6\\x96\\x87'.decode('utf-8')\n'ä¸­æ–‡'\n```\n\n```\nè¯¥æ–¹æ³•è¿”å›è§£ç åçš„å­—ç¬¦ä¸²!\n```\n\nå¦‚æœbytesä¸­åªæœ‰ä¸€å°éƒ¨åˆ†æ— æ•ˆçš„å­—èŠ‚ï¼Œå¯ä»¥ä¼ å…¥errors='ignore'å¿½ç•¥é”™è¯¯çš„å­—èŠ‚:\n\n```py\n\u003e\u003e\u003e b'\\xe4\\xb8\\xad\\xff'.decode('utf-8', errors='ignore')\n'ä¸­'\n\n```\n\n```\nåœ¨æ“ä½œå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°strå’Œbytesçš„äº’ç›¸è½¬æ¢ã€‚ä¸ºäº†é¿å…ä¹±ç é—®é¢˜ï¼Œåº”å½“å§‹ç»ˆåšæŒä½¿ç”¨UTF-8ç¼–ç å¯¹strå’Œbytesè¿›è¡Œè½¬æ¢.\n```\n\n```\nå­—ç¬¦ä¸²åœ¨Pythonå†…éƒ¨çš„è¡¨ç¤ºæ˜¯unicodeç¼–ç ï¼Œå› æ­¤ï¼Œåœ¨åšç¼–ç è½¬æ¢æ—¶ï¼Œé€šå¸¸éœ€è¦ä»¥unicodeä½œä¸ºä¸­é—´ç¼–ç ï¼Œ\nå³å…ˆå°†å…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²è§£ç ï¼ˆdecodeï¼‰æˆunicodeï¼Œå†ä»unicodeç¼–ç ï¼ˆencodeï¼‰æˆå¦ä¸€ç§ç¼–ç ã€‚\n```\n\n## bytes ä¸ str çš„é•¿åº¦æ¯”è¾ƒ\n\n```py\ntext1 = 'abc'\ntext2 = b'abc'\ntext3 = 'å¥½'\ntext4 = text3.encode('utf-8')\nprint(len(text1))\nprint(len(text2))\nprint(len(text3))\nprint(len(text4))\nprint('text3:', text3)\nprint('text4:', text4)\n```\n\nè¾“å‡º:\n\n```\n3\n3\n1\n3\n```\n\n- len() å‡½æ•°å¯¹ str å¯¹è±¡æ—¶è®¡ç®—çš„æ˜¯å­—ç¬¦æ•°\n- len() å‡½æ•°å¯¹ bytes å¯¹è±¡æ—¶è®¡ç®—çš„æ˜¯å­—èŠ‚æ•°\n\n## binascii\n\n```\n`a2b_ *` å‡½æ•°æ¥å—ä»…åŒ…å« ASCII å­—ç¬¦çš„ Unicode å­—ç¬¦ä¸²ã€‚  \nå…¶ä»–å‡½æ•°åªæ¥å—ç±»ä¼¼å­—èŠ‚çš„å¯¹è±¡ï¼ˆå¦‚å­—èŠ‚ï¼Œå­—èŠ‚æ•°ç»„å’Œå…¶ä»–æ”¯æŒç¼“å†²åŒºåè®®çš„å¯¹è±¡ï¼‰ã€‚\n```\n\n### binascii.b2a_hex(data)\n\n- binascii.b2a_hex(data)\n- binascii.hexlify(data)\n\n\n- æ¥æ”¶ bytes å¯¹è±¡\n- è¿”å›è¾“å…¥ bytes å¯¹è±¡çš„åå…­è¿›åˆ¶è¡¨ç¤ºå½¢å¼\n    - è¿”å›çš„æ˜¯ bytes å¯¹è±¡\n- è¾“å…¥æ•°æ®çš„æ¯ä¸ªå­—èŠ‚éƒ½è½¬æ¢ä¸ºç›¸åº”çš„2ä½åå…­è¿›åˆ¶è¡¨ç¤º\n    - è¿”å›çš„ bytes å¯¹è±¡é•¿åº¦æ˜¯æ•°æ®é•¿åº¦çš„ä¸¤å€\n\n```\nstring(byteså¯¹è±¡) --\u003e å­—ç¬¦å¯¹åº”çš„ hex --\u003e hex å­—é¢è½¬åŒ–ä¸º string(byteså¯¹è±¡)\n```\n\n### binascii.a2b_hex(hexstr)\n\n- binascii.a2b_hex(hexstr)\n- binascii.unhexlify(hexstr)\n\n- æ¥æ”¶ä»…åŒ…å« ASCII å­—ç¬¦çš„ Unicode å­—ç¬¦ä¸²\n- ä¹Ÿå¯ä»¥æ¥æ”¶ bytes å¯¹è±¡\n- è¿”å›åå…­è¿›åˆ¶å­—ç¬¦ä¸² hexstr æ‰€è¡¨ç¤ºçš„äºŒè¿›åˆ¶æ•°æ®\n    - è¿”å›çš„æ˜¯ bytes å¯¹è±¡\n- è¯¥å‡½æ•°ä¸b2a_hexï¼ˆï¼‰çš„åå‡½æ•°\n- hexstr å¿…é¡»åŒ…å«å¶æ•°ä¸ªåå…­è¿›åˆ¶æ•°å­—\n    - å¯ä»¥æ˜¯å¤§å†™æˆ–å°å†™\n\n```\nstring --\u003e hex --\u003e bytes å¯¹è±¡\n```\n\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Python/Python%E5%81%8F%E5%87%BD%E6%95%B0":{"title":"Pythonåå‡½æ•°","content":"\n# Pythonåå‡½æ•°\n\n## ä½¿ç”¨\n\n`functools`æ¨¡å—æä¾›çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œ\n\nint('123', base=2) å¯ä»¥æ ¹æ®baseå°†å­—ç¬¦ä¸²è§£ææˆå¯¹åº”çš„è¿›åˆ¶ï¼Œåå‡½æ•°å¯ä»¥ç”¨æ¥å›ºå®šå‡½æ•°çš„å‚æ•°ï¼š\n\n```python\ndef int2(x, base=2):\n    return int(x, base)\n```\n\n`functools.partial`å°±æ˜¯å¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåå‡½æ•°çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å®šä¹‰`int2()`ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°`int2`ï¼š\n\n```python\n\u003e\u003e\u003e import functools\n\u003e\u003e\u003e int2 = functools.partial(int, base=2)\n\u003e\u003e\u003e int2('1000000')\n64\n\u003e\u003e\u003e int2('1010101')\n85\n```\n\n## åŸç†\n\nåå‡½æ•°è¿ç”¨äº†é—­åŒ…çš„ç‰¹æ€§ï¼Œå¤§ä½“ä¸Špartialçš„åŠŸèƒ½å¯ä»¥è¡¨ç¤ºæˆä¸‹è¾¹çš„å½¢å¼ï¼š\n\n```python\ndef partial(func, *part_args):\n    def wrapper(*extra_args):\n        args = list(part_args)\n        args.extend(extra_args)\n        return func(*args)\nreturn wrapper\n```\n\nåˆ©ç”¨é—­åŒ…çš„ç‰¹æ€§è®°å¿†äº†éƒ¨åˆ†å‚æ•°çš„å€¼ã€‚\n\n## å‚è€ƒ\n\n- [åå‡½æ•° - å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™ (liaoxuefeng.com)](https://www.liaoxuefeng.com/wiki/1016959663602400/1017454145929440)\n- [(1æ¡æ¶ˆæ¯) Pythonä¸­partialå‡½æ•°çš„å·¥ä½œåŸç†_sigma65535çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/u010301542/article/details/78376279)\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Python/Python%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%E5%92%8C%E5%80%BC%E4%BC%A0%E9%80%92":{"title":"Pythonå¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’","content":"\n# Pythonå¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’\n\nè§£é‡Šå™¨ä¼šæŸ¥çœ‹å¯¹è±¡å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰æŒ‡ç¤ºçš„é‚£ä¸ªå€¼çš„ç±»å‹ï¼Œ**å¦‚æœå˜é‡æŒ‡ç¤ºä¸€ä¸ªå¯å˜çš„å€¼ï¼Œå°±ä¼šæŒ‰å¼•ç”¨è°ƒç”¨è¯­ä¹‰ã€‚å¦‚æœæ‰€æŒ‡ç¤ºçš„æ•°æ®çš„ç±»å‹æ˜¯ä¸å¯å˜çš„ï¼Œåˆ™ä¼šåº”ç”¨æŒ‰å€¼è°ƒç”¨è¯­ä¹‰**ã€‚\n\n`åˆ—è¡¨ å­—å…¸ é›†åˆ`  \næ€»æ˜¯ä¼šæŒ‰å¼•ç”¨ä¼ å…¥å‡½æ•°ï¼Œå‡½æ•°ä»£ç ç»„ä¸­å¯¹å˜é‡æ•°æ®ç»“æ„çš„ä»»ä½•æ”¹å˜éƒ½ä¼š**åæ˜ åˆ°è°ƒç”¨ä»£ç ä¸­**ã€‚\n\n`å­—ç¬¦ä¸² æ•´æ•° å…ƒç»„`  \næ€»æ˜¯ä¼šæŒ‰å€¼ä¼ å…¥å‡½æ•°ï¼Œå‡½æ•°ä¸­å¯¹å˜é‡çš„ä»»ä½•ä¿®æ”¹æ˜¯è¿™ä¸ªå‡½æ•°ç§æœ‰çš„ï¼Œ**ä¸ä¼šåæ˜ åˆ°è°ƒç”¨ä»£ç ä¸­**ã€‚\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Python/Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8":{"title":"Pythonç½‘ç»œçˆ¬è™«å…¥é—¨","content":"# Pythonç½‘ç»œçˆ¬è™«å…¥é—¨\n\n## çˆ¬è™«ç®€ä»‹\n\n### åˆæ³•æ€§\n\n- æŠ“å–æ•°æ®æ—¶ç°å®ç”Ÿæ´»ä¸­çœŸå®æ•°æ®åˆ™åˆæ³•\n- æŠ“å–æ•°æ®ä¸ºåŸåˆ›æ•°æ®åˆ™å—ç‰ˆæƒä¿æŠ¤\n\n### èƒŒæ™¯è°ƒç ”\n\n#### æ£€æŸ¥ robots.txt\n\n- æ£€æŸ¥ robots.txt å¯ä»¥æœ€å°åŒ–çˆ¬è™«è¢«å°ç¦çš„å¯èƒ½\n- å‘ç°å’Œç½‘ç»œç»“æ„ç›¸å…³çš„çº¿ç´¢\n\n##### æŸ¥çœ‹æ–¹æ³•\n\né€šè¿‡è®¿é—® http://example.webscraping.com/**robots.txt**, å¾—åˆ°å†…å®¹:  \n\n```http\n## section 1\nUser-agent: BadCrawler  // ç¦æ­¢ç”¨æˆ·ä»£ç†ä¸º BadCrawler çš„çˆ¬è™«çˆ¬å–ç½‘ç«™\nDisallow: /\n\n## section 2\nUser-agent: *\nDisallow: /trap       // å°ç¦çˆ¬å–ä¸å…è®¸é“¾æ¥çš„çˆ¬è™«\nCrawl-delay: 5        // ä¸¤æ¬¡è¯·æ±‚åº”é—´éš” 5 ç§’\n\n## section 3\nSitemap: http://example.webscraping.com/sitemap.xml\n```\n\n#### æ£€æŸ¥ç½‘ç«™åœ°å›¾\n\n- Sitemap æ–‡ä»¶å¸®åŠ©çˆ¬è™«å®šä½æœ€æ–°çš„æ–‡ä»¶, è€Œæ— éœ€çˆ¬å–æ¯ä¸€ä¸ªç½‘é¡µ\n- ç½‘ç«™åœ°å›¾æä¾›äº†æ‰€ä»¥ç½‘é¡µçš„é“¾æ¥\n- è¯¥æ–‡ä»¶ç»å¸¸å­˜åœ¨ç¼ºå¤±, è¿‡æœŸæˆ–ä¸å®Œæ•´çš„é—®é¢˜\n\n##### æŸ¥çœ‹æ–¹æ³•\n\né€šè¿‡è®¿é—® robots.txt ä¸­å®šä¹‰çš„åœ°å›¾é“¾æ¥åœ°å€ http://example.webscraping.com/sitemap.xml\n\n```sh\nhttp://example.webscraping.com/places/default/view/Afghanistan-1\nhttp://example.webscraping.com/places/default/view/Aland-Islands-2\nhttp://example.webscraping.com/places/default/view/Albania-3\nhttp://example.webscraping.com/places/default/view/Algeria-4\nhttp://example.webscraping.com/places/default/view/American-Samoa-5\nhttp://example.webscraping.com/places/default/view/Andorra-6\nhttp://example.webscraping.com/places/default/view/Angola-7\nhttp://example.webscraping.com/places/default/view/Anguilla-8\nhttp://example.webscraping.com/places/default/view/Antarctica-9\nhttp://example.webscraping.com/places/default/view/Antigua-and-Barbuda-10\n......\n```\n\n#### ä¼°ç®—ç½‘ç«™å¤§å°\n\n- ç›®æ ‡ç½‘ç«™çš„å¤§å°ä¼šå½±å“æˆ‘ä»¬å¦‚ä½•è¿›è¡Œçˆ¬å–\n\n##### ä¼°ç®—æ–¹æ³•\n\n- ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯æ£€æŸ¥ Google çˆ¬è™«çš„ç»“æœ, Google å¾ˆå¯èƒ½å·²ç»çˆ¬å–è¿‡æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç½‘ç«™\n- é€šè¿‡æœç´¢çš„ `site` å…³é”®è¯è¿‡æ»¤åŸŸåç»“\n    - åœ¨åŸŸååæ·»åŠ  url å¯ä»¥å¯¹ç»“æœè¿›è¡Œè¿‡æ»¤, ä»…æ˜¾ç¤ºç½‘é¡µæŸäº›éƒ¨åˆ†\n    - å¯ä»¥ä» http://www.google.com/advanced_search äº†è§£å‚æ•°\n\n```\nsite:example.webscraping.com       // æœç´¢å…¨ç«™\nsite:example.webscraping.com/places/default/view  // åªæœç´¢å›½å®¶é¡µé¢\n```\n\n#### è¯†åˆ«ç½‘ç«™æ‰€ç”¨æŠ€æœ¯\n\nä½¿ç”¨ builtwith æ¨¡å—æ£€æŸ¥ç½‘ç«™æ„å»ºçš„æŠ€æœ¯ç±»å‹:\n\n```sh\npip install builtwish\n```\n\nç”¨æ³•:\n\n```python\n\u003e\u003e\u003e import builtwith\n\u003e\u003e\u003e builtwith.parse('http://example.webscraping.com')\n\n{u'javascript-frameworks': [u'jQuery', u'Modernizr', u'jQuery UI'], u'web-frameworks': [u'Web2py', u'Twitter Bootstrap'], u'programming-languages': [u'Python'], u'web-servers': [u'Nginx']}\n``` \n\né€šè¿‡è¿”å›çš„ä¿¡æ¯, è¯¥ç½‘ç«™ä½¿ç”¨ python çš„ web2py æ¡†æ¶, è¿˜ä½¿ç”¨äº†ä¸€äº› JavaScript åº“, å› æ­¤å†…å®¹å¯èƒ½åµŒå…¥åœ¨ HTML ä¸­.\n\n#### å¯»æ‰¾ç½‘ç«™æ‰€æœ‰è€…\n\næ ¹æ®æ‰€æœ‰è€…æ¥è°ƒæ•´çˆ¬è™«ç­–ç•¥.\n\n##### WHOIS æŸ¥è¯¢\n\n```sh\npip install python-whois\n```\n\nç”¨æ³•:\n\n```python\n\u003e\u003e\u003e import whois\n\u003e\u003e\u003e print whois.whois('webscraping.com')\n\n{\n  \"updated_date\": [\n    \"2013-08-20 08:08:30\", \n    \"2013-08-20 08:08:29\"\n  ], \n  \"status\": [\n    \"clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited\", \n    \"clientRenewProhibited https://icann.org/epp#clientRenewProhibited\", \n    \"clientTransferProhibited https://icann.org/epp#clientTransferProhibited\", \n    \"clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited\", \n    \"clientTransferProhibited http://www.icann.org/epp#clientTransferProhibited\", \n    \"clientUpdateProhibited http://www.icann.org/epp#clientUpdateProhibited\", \n    \"clientRenewProhibited http://www.icann.org/epp#clientRenewProhibited\", \n    \"clientDeleteProhibited http://www.icann.org/epp#clientDeleteProhibited\"\n  ], \n  \"name\": null, \n  \"dnssec\": \"unsigned\", \n  \"city\": null, \n  \"expiration_date\": \"2020-06-26 18:01:19\", \n  \"zipcode\": null, \n  \"domain_name\": \"WEBSCRAPING.COM\", \n  \"country\": \"AU\", \n  \"whois_server\": \"whois.godaddy.com\", \n  \"state\": \"Victoria\", \n  \"registrar\": \"GoDaddy.com, LLC\", \n  \"referral_url\": null, \n  \"address\": null, \n  \"name_servers\": [\n    \"NS1.WEBFACTION.COM\", \n    \"NS2.WEBFACTION.COM\", \n    \"NS3.WEBFACTION.COM\", \n    \"NS4.WEBFACTION.COM\"\n  ], \n  \"org\": null, \n  \"creation_date\": \"2004-06-26 18:01:19\", \n  \"emails\": \"abuse@godaddy.com\"\n}\n\n```\n\n### ç¼–å†™ç¬¬ä¸€ä¸ªçˆ¬è™«\n\nçˆ¬å– (srawling) ä¸€èˆ¬æ–¹å¼:\n- çˆ¬å–ç½‘ç«™åœ°å›¾\n- éå†æ¯ä¸ªç½‘é¡µçš„æ•°æ®åº“ ID\n- è·Ÿè¸ªç½‘é¡µé“¾æ¥\n\n#### ä¸‹è½½ç½‘é¡µ\n\nä½¿ç”¨ urllib2 æ¨¡å—ä¸‹è½½ URL:  \n\ndownload.py:\n\n```python\n## coding=utf-8\nimport urllib2\n\n\ndef download(url, num_retries = 2):\n    print 'Downloading:', url\n    try:\n        html = urllib2.urlopen(url).read()\n    except urllib2.URLError as e:\n        print 'Download error:', e.reason\n        html = None\n    if num_retries \u003e 0:\n        if hasattr(e, 'code') and 500 \u003c= e.code \u003c 600:\n            return download(url, num_retries - 1)\n    return html\n```\n\ntest.py:\n\n```python\n## coding=utf-8\nimport download\n\nurl = raw_input(\"please type the url:\")  ## è¾“å…¥url\nhtml = download.download(url)\nprint html\n```\n\n## å®é™…é¡¹ç›®\n\n### æ’ä»¶\n\n- requests\n    - çˆ¬å–ç½‘é¡µ\n- bs4\n    - è§£æçˆ¬å–çš„å†…å®¹\n- openpyxl\n    - å¯¼å‡º excel\n\n### user-agent\n\næµè§ˆå™¨ä¸­ F12, ç½‘ç»œä¸€æ æ‰¾åˆ°åŠ è½½çš„ä¸€ä¸ª htmlæ–‡ä»¶. é‡Œé¢æœ‰ user-agent å­—æ®µ.  \n\n```python\nheaders = {'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:62.0) Gecko/20100101 Firefox/62.0'}\n```","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/Python/Python%E8%A3%85%E9%A5%B0%E5%99%A8":{"title":"Pythonè£…é¥°å™¨","content":"\n# Pythonè£…é¥°å™¨\n\n## ç®€è¿°\n\n- è£…é¥°å™¨æ˜¯é—­åŒ…çš„è¯­æ³•ç³–\n- è£…é¥°å™¨å°±æ˜¯åœ¨ç›®æ ‡å‡½æ•°\"å‘¨å›´\"åŠ ä¸Šé™„åŠ çš„ä»£ç \n- ä¸€èˆ¬å¦‚æ’å…¥æ—¥å¿—ã€æ€§èƒ½æµ‹è¯•ã€äº‹åŠ¡å¤„ç†ã€ç¼“å­˜ã€æƒé™æ ¡éªŒç­‰åœºæ™¯\n- è£…é¥°å™¨æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹çš„è®¾è®¡æ€æƒ³\n\n## ç®€å•è£…é¥°å™¨\n\n### ç›®æ ‡å‡½æ•°\n\n```python\ndef foo():\n    print('i am foo')\n```\n\n### é¢å¤–ä»£ç \n\næ‰“å°log:\n\n```python\ndef foo():\n    print('i am foo')\n    print(\"foo is running\")\n```\n\n### ç‹¬ç«‹ log å‡½æ•°\n\n```python\ndef use_logging(func):\n    print(\"%s is running\" % func.__name__)\n    func()\n\ndef foo():\n    print('i am foo')\n\nuse_logging(foo)\n```\n\n### é—®é¢˜\n\n- æƒ³è¦åŠ å¼ºåŸå‡½æ•°ï¼Œè¦ä¿®æ”¹å‡½æ•°è°ƒç”¨å¤„çš„ä»£ç é€»è¾‘ï¼Œæš´éœ²äº†ä¿®æ”¹ã€‚\n\n## æ”¹è¿›è£…é¥°å™¨\n\n```python\ndef use_logging(func):\n\n    def wrapper():\n        print(\"%s is running\" % func.__name__)\n        return func()   ## æŠŠ foo å½“åšå‚æ•°ä¼ é€’è¿›æ¥æ—¶ï¼Œæ‰§è¡Œfunc()å°±ç›¸å½“äºæ‰§è¡Œfoo()\n    return wrapper\n\ndef foo():\n    print('i am foo')\n\nfoo = use_logging(foo)  ## å› ä¸ºè£…é¥°å™¨ use_logging(foo) è¿”å›çš„æ—¶å‡½æ•°å¯¹è±¡ wrapperï¼Œè¿™æ¡è¯­å¥ç›¸å½“äº  foo = wrapper\nfoo()                   ## æ‰§è¡Œfoo()å°±ç›¸å½“äºæ‰§è¡Œ wrapper()\n```\n\n### ä¸ºä»€ä¹ˆè¦ç”¨ä¸¤å±‚å‡½æ•°æ¥è¡¨ç¤ºè£…é¥°å™¨?\n\n\u003e å› ä¸ºè¦æŠŠå¢å¼ºåŠŸèƒ½å’ŒåŸå§‹å‡½æ•°æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°å¯¹è±¡ï¼Œè€Œä¸æ˜¯åŸåœ°è°ƒç”¨ã€‚\n\n#### é”™è¯¯å†™æ³•\n\n```python\ndef use_logging(func):\n    print(\"%s is running\" % func.__name__)\n    return func\n\n\ndef foo():\n    print('i an foo')\n    return 1\n\n\nfoo = use_logging(foo)\nfoo()\n```\n\nä¹ä¸€çœ‹è¿™ä¹ˆå†™å’Œå‰é¢çš„ä»£ç æ•ˆæœä¸€è‡´, ä½†æ˜¯å…¶å®å¾ˆæœ‰é—®é¢˜:\n\n- åœ¨ `foo = use_logging(foo)` æ—¶å°±æ‰“å°äº†`foo()`æ­£åœ¨æ‰§è¡Œ, è€Œå®é™…è¿˜æœªæ‰§è¡Œ, é€»è¾‘é”™è¯¯\n- æ— æ³•å®ç°åœ¨ `foo()` æ‰§è¡Œåæ·»åŠ ä»£ç , ä¾‹å¦‚å¤„ç† `foo()` çš„è¿”å›å€¼\n\n#### ä¸ªäººç†è§£\n\n- è£…é¥°å™¨çš„å¤–å±‚ä»£ç èµ·åˆ°**æ‰“åŒ…**çš„åŠ¨ä½œï¼Œ**å‡½æ•°å¯¹è±¡å®šä¹‰æ—¶ä¸ä¼šæ‰§è¡Œ**ã€‚\n    - æ¥æ”¶ç›®æ ‡å‡½æ•°(ä¸æ‰§è¡Œ), äº¤ç»™å†…å±‚å‡½æ•°(æ‰“åŒ…), è¿”å›å†…å±‚å‡½æ•°(ä¸æ‰§è¡Œ)\n- å†…å±‚å‡½æ•°å®ç°å¯¹ç›®æ ‡å‡½æ•°çš„æ‰©å±•, å¹¶ä¸”**æ‰¿æ‹…æ‰§è¡Œç›®æ ‡å‡½æ•°çš„åŠŸèƒ½**\n    - å†…å±‚å‡½æ•°çš„ `return func()` æ—¶å°± æ‰§è¡Œäº†ç›®æ ‡å‡½æ•°äº†\n    - å› æ­¤ `wapper()` å¯ä»¥åœ¨åšåˆ°æ‰§è¡Œç›®æ ‡å‡½æ•°åå†æ·»åŠ ä»£ç \n    \n    ```python\n    def wrapper():\n        print(\"%s is running\" % func.__name__)\n        func()\n        result = func()  ## æ­¤æ—¶å·²ç»æ‰§è¡Œäº†ç›®æ ‡å‡½æ•°\n        print(result)\n        return result\n    ```    \n    \n\n## @ è¯­æ³•ç³–\n\n```python\ndef use_logging(func):\n\n    def wrapper():\n        print(\"%s is running\" % func.__name__)\n        return func()\n    return wrapper\n\n@use_logging\ndef foo():\n    print(\"i am foo\")\n\nfoo()\n```\n\n- æœ‰äº† @ å°±å¯ä»¥çœå» `foo = use_logging(foo)` è¿™ä¸€å¥, ç›´æ¥è°ƒç”¨ `foo()` å³å¯å¾—åˆ°æƒ³è¦çš„ç»“æœ\n- foo() å‡½æ•°ä¸éœ€è¦åšä»»ä½•ä¿®æ”¹, åªéœ€åœ¨å®šä¹‰çš„åœ°æ–¹åŠ ä¸Šè£…é¥°å™¨\n- å¦‚æœæˆ‘ä»¬æœ‰å…¶ä»–çš„ç±»ä¼¼å‡½æ•°, å¯ä»¥ç»§ç»­è°ƒç”¨è£…é¥°å™¨æ¥ä¿®é¥°å‡½æ•°, è€Œä¸ç”¨é‡å¤ä¿®æ”¹å‡½æ•°æˆ–è€…å¢åŠ æ–°çš„å°è£…\n\nè£…é¥°å™¨åœ¨ Python ä½¿ç”¨å¦‚æ­¤æ–¹ä¾¿éƒ½è¦å½’å› äº Python çš„å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œèƒ½åƒæ™®é€šçš„å¯¹è±¡ä¸€æ ·èƒ½ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°, å¯ä»¥è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡, å¯ä»¥ä½œä¸ºè¿”å›å€¼, å¯ä»¥è¢«å®šä¹‰åœ¨å¦å¤–ä¸€ä¸ªå‡½æ•°å†…ã€‚\n\n## ç›®æ ‡å‡½æ•°éœ€è¦æ¥å—å‚æ•°\n\n```python\ndef foo(name):\n    print(\"i am %s\" % name)\n```\n\n### å®šä¹‰ wrapper å‡½æ•°æ—¶å€™æŒ‡å®š(ç›®æ ‡å‡½æ•°çš„)å‚æ•°\n\n```python\ndef wrapper(name):\n\tlogging.warn(\"%s is running\" % func.__name__)\n\treturn func(name)\nreturn wrapper\n```\n\n### è£…é¥°å™¨ä¸çŸ¥é“ç›®æ ‡å‡½æ•°åˆ°åº•æœ‰å¤šå°‘ä¸ªå‚æ•°æ—¶\n\nç”¨ `*args` æ¥ä»£æ›¿:\n\n```python\ndef wrapper(*args):\n\tlogging.warn(\"%s is running\" % func.__name__)\n\treturn func(*args)\nreturn wrapper\n```\n\n### ç›®æ ‡å‡½æ•°å®šä¹‰äº†ä¸€äº›å…³é”®å­—å‚æ•°\n\nä¾‹å¦‚:  \n\n```python\ndef foo(name, age=None, height=None):\n    print(\"I am %s, age %s, height %s\" % (name, age, height))\n```\n\nwrapper å‡½æ•°æŒ‡å®šå…³é”®å­—å‡½æ•°:  \n\n```python\ndef wrapper(*args, **kwargs):\n\t## argsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œkwargsä¸€ä¸ªå­—å…¸\n\tlogging.warn(\"%s is running\" % func.__name__)\n\treturn func(*args, **kwargs)\nreturn wrapper\n```\n\n## å¢å¼ºåŠŸèƒ½éƒ¨åˆ†éœ€è¦å‚æ•°\n\nå‚æ•°æ§åˆ¶æ“ä½œå¤–å±‚æ‰“åŒ…ç¨‹åºçš„é€»è¾‘:  \næŒ‡å®šæ—¥å¿—çº§åˆ«\n\n```python\ndef use_logging(level):\n    def decorator(func):\n        def wrapper(*args, **kwargs):\n            if level == \"warn\":\n                logging.warn(\"%s is running\" % func.__name__)\n            elif level == \"info\":\n                logging.info(\"%s is running\" % func.__name__)\n            return func(*args)\n        return wrapper\n    return decorator\n\n@use_logging(level=\"warn\")\ndef foo(name='foo'):\n    print(\"i am %s\" % name)\n\nfoo()\n```\n\n- å®ƒå®é™…ä¸Šæ˜¯å¯¹åŸæœ‰è£…é¥°å™¨çš„ä¸€ä¸ªå‡½æ•°å°è£…, å¹¶è¿”å›ä¸€ä¸ªè£…é¥°å™¨\n- å¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ªå«æœ‰å‚æ•°çš„é—­åŒ…\n- ä½¿ç”¨ `@use_logging(level=\"warn\")` è°ƒç”¨çš„æ—¶, Python èƒ½å¤Ÿå‘ç°è¿™ä¸€å±‚çš„å°è£…, å¹¶æŠŠå‚æ•°ä¼ é€’åˆ°è£…é¥°å™¨çš„ç¯å¢ƒä¸­\n\n\u003e è¦å®šä¹‰ä¸‰å±‚å°±æ˜¯å› ä¸ºæœ‰ä¸‰ç±»æ®è¯´éœ€è¦ä¼ é€’ï¼Œä½†æ˜¯ä¸èƒ½æ··åœ¨åŒä¸€ä¸ªå‚æ•°åˆ—è¡¨ä¸­ï¼š\n\u003e funæŒ‡é’ˆ / funå‡½æ•°çš„å‚æ•° / è£…é¥°å™¨çš„å‚æ•°\n\n## ç±»è£…é¥°å™¨\n\nä½¿ç”¨ç±»è£…é¥°å™¨ä¸»è¦ä¾é ç±»çš„ `__call__` æ–¹æ³•, å½“ä½¿ç”¨ `@` å½¢å¼å°†è£…é¥°å™¨é™„åŠ åˆ°å‡½æ•°ä¸Šæ—¶, å°±ä¼šè°ƒç”¨æ­¤æ–¹æ³•\n\n```python\nclass Foo(object):\n    def __init__(self, func):\n        self._func = func\n\n    def __call__(self):\n        print ('class decorator runing')\n        self._func()\n        print ('class decorator ending')\n\n@Foo\ndef bar():\n    print ('bar')\n\nbar()\n```\n\n## æ‰¾å›ç›®æ ‡å‡½æ•°å…ƒä¿¡æ¯\n\n### è£…é¥°å™¨æŠ¹é™¤äº†ç›®æ ‡å‡½æ•°çš„å…ƒä¿¡æ¯\n\nåŸå‡½æ•°çš„å…ƒä¿¡æ¯ä¸è§äº†, æ¯”å¦‚å‡½æ•°çš„ `docstringã€__name__ã€å‚æ•°åˆ—è¡¨`:\n\n```python\n## è£…é¥°å™¨\ndef logged(func):\n    def with_logging(*args, **kwargs):\n        print func.__name__      ## è¾“å‡º 'with_logging'\n        print func.__doc__       ## è¾“å‡º None\n        return func(*args, **kwargs)\n    return with_logging\n\n## å‡½æ•°\n@logged\ndef f(x):\n   \"\"\"does some math\"\"\"\n   return x + x * x\n\nlogged(f)\n```\n\nå‡½æ•° `f` è¢« `with_logging` å–ä»£äº†, å®ƒçš„ `docstringï¼Œ__name__` å°±æ˜¯å˜æˆäº† `with_logging` å‡½æ•°çš„ä¿¡æ¯äº†.\n\n### functools.wraps\n\n- wrapsæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè£…é¥°å™¨\n- å®ƒèƒ½æŠŠåŸå‡½æ•°çš„å…ƒä¿¡æ¯æ‹·è´åˆ°è£…é¥°å™¨é‡Œé¢çš„ `func` å‡½æ•°ä¸­\n- ä½¿å¾—è£…é¥°å™¨é‡Œé¢çš„ `func` å‡½æ•°ä¹Ÿæœ‰å’ŒåŸå‡½æ•° `foo` ä¸€æ ·çš„å…ƒä¿¡æ¯\n\n```python\nfrom functools import wraps\ndef logged(func):\n    @wraps(func)\n    def with_logging(*args, **kwargs):\n        print func.__name__      ## è¾“å‡º 'f'\n        print func.__doc__       ## è¾“å‡º 'does some math'\n        return func(*args, **kwargs)\n    return with_logging\n\n@logged\ndef f(x):\n   \"\"\"does some math\"\"\"\n```\n\n## è£…é¥°å™¨é¡ºåº\n\nä¸€ä¸ªå‡½æ•°è¿˜å¯ä»¥åŒæ—¶å®šä¹‰å¤šä¸ªè£…é¥°å™¨:\n\n```py\n@a\n@b\n@c\ndef f ():\n    pass\n```\n\næ‰§è¡Œé¡ºåº:  \n\nä»é‡Œåˆ°å¤–, **æœ€å…ˆè°ƒç”¨æœ€é‡Œå±‚çš„è£…é¥°å™¨**, æœ€åè°ƒç”¨æœ€å¤–å±‚çš„è£…é¥°å™¨:\n\n```py\nf = a(b(c(f)))\n```\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cmake/%E7%9B%AE%E6%A0%87%E5%8C%85%E5%90%AB%E5%85%B3%E9%94%AE%E5%AD%97":{"title":"ç›®æ ‡åŒ…å«å…³é”®å­—","content":"\n# ç›®æ ‡åŒ…å«å…³é”®å­—\n\n\u003e [cmakeï¼štarget_** ä¸­çš„ PUBLICï¼ŒPRIVATEï¼ŒINTERFACE - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/82244559)\n\n## PRIVATE\n\næ¨¡å—è‡ªå·±ä½¿ç”¨ï¼Œå…¶å®ƒé“¾æ¥æœ¬æ¨¡å—çš„å¤–éƒ¨æ¨¡å—ä¸ä½¿ç”¨ã€‚\n\n## INTERFACE\n\næ¨¡å—è‡ªå·±ä¸ä½¿ç”¨ï¼Œå…¶å®ƒé“¾æ¥æœ¬æ¨¡å—çš„å¤–éƒ¨æ¨¡å—ä½¿ç”¨ã€‚\nå¤šç”¨äºåœ¨æ¨¡å—è‡ªå·±çš„`CMakeLists.txt`æ–‡ä»¶ä¸­æŒ‡å®šè¦å¯¼å…¥è¯¥æ–‡ä»¶è€Œå¼•å…¥çš„ä¸œè¥¿ï¼Œå› ä¸ºæ¨¡å—è‡ªå·±ä¸éœ€è¦è‡ªå·±çš„ä¸œè¥¿ï¼Œåªæœ‰å¤–éƒ¨éœ€è¦ç”¨ã€‚\n\n## PUBLIC\n\néƒ½ä½¿ç”¨ï¼šPRIVATE + INTERFACE\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cmake/%E8%AE%BE%E5%AE%9A%E5%A4%B4%E6%96%87%E4%BB%B6%E6%90%9C%E7%B4%A2%E8%B7%AF%E5%BE%84%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%80%9D%E8%B7%AF":{"title":"è®¾å®šå¤´æ–‡ä»¶æœç´¢è·¯å¾„çš„ä¸¤ç§æ€è·¯","content":"\n# è®¾å®šå¤´æ–‡ä»¶æœç´¢è·¯å¾„çš„ä¸¤ç§æ€è·¯\n\n## æŒ‡å‘æºç ç›®å½•ï¼Œå®‰è£…æ—¶å†å¤åˆ¶\n\n```cmake\ntarget_include_directories(mymodule INTERFACE ${PROJECT_SOURCE_DIR}/mymodule)\n\ninstall(FILES mymodule.h DESTINATION ${PROJECT_BINARY_DIR}/include)\n```\n\n## ç¼–è¯‘å‰å¤åˆ¶åˆ°å®‰è£…ç›®å½•å†æŒ‡å‘\n\n```cmake\nfile(INSTALL ${CMAKE_CURRENT_SOURCE_DIR}/mymodule.h\n                DESTINATION ${CMAKE_INSTALL_PREFIX}/include)\n\ninclude_directories(${CMAKE_INSTALL_PREFIX}/include)\n```\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cmake/%E9%A1%B9%E7%9B%AE%E5%91%BD%E4%BB%A4/target_include_directories":{"title":"target_include_directories","content":"\n# target_include_directories\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cmake/cmake%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4":{"title":"cmakeå¸¸ç”¨æŒ‡ä»¤","content":"\n# cmakeå¸¸ç”¨æŒ‡ä»¤\n\n## add_subdirectory\n\né€’å½’çš„å»`add_subdirectory`æŒ‡å®šçš„ç›®å½•æ‰§è¡Œ`cmake`è°ƒç”¨å­ç›®å½•ä¸‹çš„`CMakeLists.txt`æ–‡ä»¶ã€‚\n\n\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cmake/cmake%E9%AA%A8%E6%9E%B6":{"title":"cmakeéª¨æ¶","content":"\n# cmakeéª¨æ¶\n\n## ä¸»æ¨¡å—\n\n1. è®¾å®šCmakeç‰ˆæœ¬è¦æ±‚\n2. è®¾å®šé¡¹ç›®åç§°\n3. è®¾å®šè¯­è¨€æ ‡å‡†\n4. æ‰“å¼€æºç æ–‡ä»¶ï¼Œæ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶\n5. è®¾å®šç¼–è¯‘é€‰é¡¹\n6. æ·»åŠ å­æ¨¡å—ç›®å½•\n7. è®¾å®šé¡¹ç›®å®‰è£…ç›®å½•\n8. è®¾å®šå¤´æ–‡ä»¶æœç´¢è·¯å¾„\n9. è®¾å®šé“¾æ¥å™¨æœç´¢è·¯å¾„\n10. è®¾å®šå®‰è£…è·¯å¾„\n    1. è®¾å®š`CMAKE_INSTALL_PREFIX`ç¯å¢ƒå˜é‡\n    2. äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…è·¯å¾„\n    3. å¤´æ–‡ä»¶å®‰è£…è·¯å¾„\n\n## å­æ¨¡å—\n\n1. æ·»åŠ åº“æ–‡ä»¶\n2. è®¾å®šå¯¹å¤–çš„å¤´æ–‡ä»¶å¯¼å…¥è·¯å¾„\n    1. [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cmake/é¡¹ç›®å‘½ä»¤/target_include_directories|target_include_directories]]æŒ‡å®šå¤´æ–‡ä»¶æœç´¢ç›®å½•\n    2. \n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cmake/file%E5%92%8Cinstall%E7%9A%84%E5%8C%BA%E5%88%AB":{"title":"fileå’Œinstallçš„åŒºåˆ«","content":"\n# fileå’Œinstallçš„åŒºåˆ«\n\nfileå‘½ä»¤æ˜¯åœ¨cmakeé˜¶æ®µèµ·æ•ˆæœçš„ï¼Œå¯ä»¥è¿›è¡Œæ–‡ä»¶æ“ä½œåŒ…æ‹¬å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ã€‚\ninstallåœ¨make installæ—¶æ‰èµ·æ•ˆæœã€‚\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E5%8F%96%E5%9C%B0%E5%9D%80%E6%93%8D%E4%BD%9C%E7%AC%A6":{"title":"å–åœ°å€æ“ä½œç¬¦","content":"\n# å–åœ°å€æ“ä½œç¬¦\n\n\u0026æ“ä½œç¬¦è¿”å›æ“ä½œæ•°çš„åœ°å€ã€‚\n\næŠŠä¸€ä¸ªç°æœ‰å˜é‡çš„åœ°å€èµ‹å€¼ç»™ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼š\n\n```c\nint a, *b;\n...\nb = \u0026a;\n```\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E5%8F%98%E9%87%8F%E7%9A%84%E5%9C%B0%E5%9D%80%E4%B8%8E%E5%80%BC":{"title":"å˜é‡çš„åœ°å€ä¸å€¼","content":"\n# å˜é‡çš„åœ°å€ä¸å€¼\n\n```c\nint a;\na = 9;\n```\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024011715.png]]\n\nä¸€ä¸ªå˜é‡åœ¨ç”³æ˜åï¼Œå­˜åœ¨ä¸¤ä¸ªå±æ€§ï¼šåœ°å€ã€å€¼ã€‚\n\nå˜é‡aåœ¨å·¦å€¼æ—¶æ“ä½œçš„æ˜¯åœ°å€ï¼Œåœ¨å³å€¼æ—¶æ“ä½œçš„æ˜¯å€¼ã€‚\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E5%8F%98%E9%87%8F%E7%9A%84%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B":{"title":"å˜é‡çš„å­˜å‚¨ç±»å‹","content":"\n# å˜é‡çš„å­˜å‚¨ç±»å‹\n\nå­˜å‚¨ç±»å‹æ˜¯æŒ‡å˜é‡å­˜å‚¨çš„å†…å­˜ç±»å‹ï¼Œå†³å®šäº†å˜é‡ä½•æ—¶åˆ›å»ºã€ä½•æ—¶é”€æ¯ã€æŒç»­æ—¶é—´ã€‚\n\n## å­˜å‚¨åŒºåŸŸ\n\n- æ™®é€šå†…å­˜\n- è¿è¡Œæ—¶å †æ ˆ\n- ç¡¬ä»¶å¯„å­˜å™¨\n\n## ç¼ºçœå­˜å‚¨ç±»å‹\n\nå˜é‡ç¼ºçœå­˜å‚¨ç±»å‹å–å†³äºå£°æ˜ä½ç½®ï¼š\n- å£°æ˜åœ¨ä»»ä½•ä»£ç å—å¤–ï¼šé™æ€å†…å­˜\n\t- åœ¨ç¨‹åºè¿è¡Œå‰åˆ›å»º\n\t- ç¨‹åºæ‰§è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨\n\t- å§‹ç»ˆä¿æŒåŸå…ˆçš„å€¼ï¼Œé™¤éä¸­é€”èµ‹å€¼æˆ–ç¨‹åºç»“æŸ\n- å£°æ˜åœ¨ä»£ç å—å†…éƒ¨ï¼šå †æ ˆ\n\t- è¯¥ç±»å‹ä¸ºè‡ªåŠ¨ç±»å‹ï¼ˆautomaticï¼‰ï¼Œå˜é‡æ˜¯è‡ªåŠ¨å˜é‡\n\t- å¯ä»¥æ˜¾ç¤ºä½¿ç”¨autoå…³é”®å­—ä¿®æ”¹è¯¥ç§å˜é‡\n\t- ç¨‹åºæ‰§è¡Œåˆ°å˜é‡å£°æ˜æ—¶æ‰åˆ›å»ºè¯¥å˜é‡\n\t- ç¨‹åºæµç¨‹ç¦»å¼€è¯¥ä»£ç å—æ—¶å˜é‡è¢«é”€æ¯\n\t- ä»£ç å—è¢«å¤šæ¬¡æ‰§è¡Œæ—¶ï¼Œè‡ªåŠ¨å˜é‡æ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ›å»º\n\n## æ”¹å˜å­˜å‚¨ç±»å‹\n\n\u003e ä¿®æ”¹å˜é‡çš„å­˜å‚¨ç±»å‹ä¸ä»£è¡¨ä¿®æ”¹å˜é‡çš„ä½œç”¨åŸŸã€‚\n\n- staticä¿®é¥°è‡ªåŠ¨å˜é‡ï¼šè½¬ä¸ºé™æ€å­˜å‚¨ã€‚\n\t- å˜é‡ç”Ÿå‘½å‘¨æœŸä¸ºæ•´ä¸ªç¨‹åºæ‰§è¡ŒæœŸé—´ã€‚\n\t- å‡½æ•°çš„å½¢å‚ä¸èƒ½å£°æ˜ä¸ºé™æ€ï¼Œå› ä¸ºå®å‚æ€»æ˜¯åœ¨å‡†ç‰ˆç§ä¼ é€’ç»™å‡½æ•°ï¼Œç”¨äºæ”¯æŒé€’å½’ã€‚\n- registerä¿®é¥°è‡ªåŠ¨å˜é‡ï¼šè½¬ä¸ºå¯„å­˜å™¨å˜é‡ï¼Œå­˜å‚¨äºå¯„å­˜å™¨è€Œä¸æ˜¯å†…å­˜ã€‚\n\t- ç¼–è¯‘å™¨ä¸ä¸€å®šä¼šå¤„ç†registerå…³é”®å­—ã€‚\n\t\t- å› å¯„å­˜å™¨æ•°é‡æœ‰é™ï¼Œç¼–è¯‘å™¨åªä¼šé€‰å‰å‡ ä¸ªå˜é‡ä¸ºå¯„å­˜å™¨å˜é‡ã€‚\n\t\t- ç¼–è¯‘å™¨æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¼˜åŒ–ç­–ç•¥ï¼Œåˆ™ä¼šå¿½ç•¥è¯¥å…³é”®å­—ã€‚\n\t\t- å¯ä»¥æŠŠå‡½æ•°å½¢å‚å£°æ˜ä¸ºå¯„å­˜å™¨å˜é‡ã€‚\n\t\t- å¯„å­˜å™¨å˜é‡çš„ä½¿ç”¨ä½¿å¾—å‡½æ•°éœ€è¦åœ¨æ‰§è¡Œå‰ä¿å­˜å¯„å­˜å™¨çŠ¶æ€ï¼Œè¿”å›æ—¶æ¢å¤å¯„å­˜å™¨çŠ¶æ€ã€‚\n\n## å˜é‡åˆå§‹åŒ–\n\n- é™æ€å˜é‡çš„åˆå§‹å€¼è®°å½•åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„.bssæ®µï¼Œç¨‹åºåŠ è½½åä¿å­˜è¯¥å€¼å¾—å†…å­˜åœ°å€ä¼šèµ‹å€¼ç»™å˜é‡ï¼ŒæœªæŒ‡å®šåˆå§‹å€¼åˆ™ä¸º0ã€‚\n- è‡ªåŠ¨å˜é‡çš„å­˜å‚¨ä½ç½®åœ¨ç¨‹åºé“¾æ¥æ—¶å¹¶ä¸ç¡®å®šï¼Œæ‰€ä»¥æ²¡æœ‰åˆå§‹å€¼ï¼Œæ˜¾å¼çš„åˆå§‹åŒ–å°†åœ¨ä»£ç å—ä¸­æ’å…¥ä¸€æ¡èµ‹å€¼è¯­å¥ã€‚\n\t- åœ¨å£°æ˜å˜é‡æ—¶åˆå§‹åŒ–ä¸å…ˆå£°æ˜åèµ‹å€¼çš„æ•ˆç‡ä¸€æ ·ã€‚\n\t- æ¯æ¬¡æ‰§è¡Œåˆ°è‡ªåŠ¨å˜é‡å£°æ˜æ—¶éƒ½ä¼šæ‰§è¡Œåˆå§‹åŒ–è¯­å¥ã€‚\n\t- è¿è¡Œæ—¶çš„åˆå§‹åŒ–æ”¯æŒä»»æ„è¡¨è¾¾å¼ä½œä¸ºåˆå§‹åŒ–å€¼ã€‚\n\t- è‡ªåŠ¨å˜é‡æœªåˆå§‹åŒ–æ—¶å€¼éƒ½æ˜¯åƒåœ¾ã€‚\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E5%B7%A6%E5%80%BC%E5%92%8C%E5%8F%B3%E5%80%BC":{"title":"å·¦å€¼å’Œå³å€¼","content":"\n# å·¦å€¼å’Œå³å€¼\n\n## åŒºåˆ«\n\n- å·¦å€¼ï¼šå¯ä»¥å‡ºç°åœ¨èµ‹å€¼ç¬¦å·å·¦è¾¹çš„å€¼ã€‚\n\t- å¿…é¡»èƒ½æ ‡è¯†ä¸€ä¸ªç‰¹å®šçš„å†…å­˜ä½ç½®ã€‚\n- å³å€¼ï¼šå¯ä»¥å‡ºç°åœ¨èµ‹å€¼ç¬¦å·å³è¾¹çš„å€¼ã€‚\n\né—´æ¥è®¿é—®ã€ä¸‹æ ‡å¼•ç”¨æ“ä½œç¬¦è¿”å›çš„æ˜¯å·¦å€¼ï¼Œå…¶ä½™ä¸ºå³å€¼ã€‚\n\n## ç¤ºä¾‹\n\nè¡¨è¾¾å¼ä¸ä¸€å®šä¸èƒ½ä½œä¸ºå·¦å€¼ï¼š\n\nä¸‹æ ‡å¼•ç”¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œä½†æ˜¯è¿™é‡Œä½œä¸ºå·¦å€¼æ˜¯åˆæ³•çš„ï¼Œå› ä¸ºå®ƒæ ‡è¯†äº†ä¸€ä¸ªç‰¹å®šçš„ä½ç½®ï¼Œå¯ä»¥åœ¨ä»¥åçš„ç¨‹åºä¸­å¼•ç”¨å®ƒã€‚\n\n```c\nint a[30];\n...\na[b+10] = 0;\n```\n\n`*`æ“ä½œç¬¦ä¹Ÿæ˜¯ä¸€æ ·ï¼š\n\n```c\nint a, *pi;\n...\npi = \u0026a;\n*pi = 20;\n```\n\nç¬¬äºŒè¡Œå·¦è¾¹`*pi`æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œ`pi`çš„å€¼æ˜¯å†…å­˜ä¸­æŸä¸ªç‰¹å®šä½ç½®çš„åœ°å€ï¼Œ`*`æ“ä½œç¬¦ä½¿æœºå™¨æŒ‡å‘è¿™ä¸ªä½ç½®ï¼š\n- `*pi`ä½œä¸ºå·¦å€¼ï¼šæŒ‡å®šéœ€è¦ä¿®æ”¹çš„ä½ç½®ã€‚\n- `*pi`ä½œä¸ºå³å€¼ï¼šå–å‡ºå½“å‰å­˜å‚¨äºè¯¥ä½ç½®çš„å€¼ã€‚\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E6%8A%80%E5%B7%A7/%E6%8C%89%E9%9C%80%E5%AE%9E%E7%8E%B0%E5%87%BD%E6%95%B0":{"title":"æŒ‰éœ€å®ç°å‡½æ•°","content":"\n# æŒ‰éœ€å®ç°å‡½æ•°\n\n```c\nint func(void);\nstatic inline int FUNC(void) {\n    return func ? func() : RET_FAILURE;\n}\n```\n\néœ€è¦æ·»åŠ ä¸€ä¸ªæ±‡ç¼–è¯­è¨€ç¼–è¯‘å•å…ƒ(MSVC)ï¼š\n\n```c\nglobalÂ ?func@@YAXXZ\n?func@@YAXXZÂ equÂ 0\n```\n\næˆ–è€…æŠŠÂ `intÂ func(void)`Â æ”¹æˆ `externÂ \"C\"Â intÂ func(void);`ã€‚\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E6%8C%87%E9%92%88":{"title":"æŒ‡é’ˆ","content":"\n# æŒ‡é’ˆ\n\næŒ‡é’ˆå˜é‡æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸å­˜åœ¨å†…å»ºçš„é—´æ¥è®¿é—®å±æ€§ã€‚é™¤éæ˜¾ç¤ºçš„ä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/é—´æ¥è®¿é—®æ“ä½œç¬¦|é—´æ¥è®¿é—®æ“ä½œç¬¦]]ã€‚\n\n## æœªåˆå§‹åŒ–å’Œéæ³•çš„æŒ‡é’ˆ\n\n```c\nint *a;\n...\n*a = 12;\n```\n\naæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼š\n- aæ˜¯ä¸€ä¸ªè‡ªåŠ¨å˜é‡ï¼Œæ„å‘³ç€æœªå¯¹å…¶è¿›è¡Œåˆå§‹åŒ–å‰å…¶å€¼æ˜¯åƒåœ¾ã€‚\n- aæ˜¯ä¸€ä¸ªé™æ€å˜é‡ï¼Œæ„å‘³ç€æœªæ˜¾ç¤ºåˆå§‹åŒ–æƒ…å†µä¸‹å…¶å€¼å§‹ç»ˆä¸º0ã€‚\n\n## æŒ‡é’ˆçš„æŒ‡é’ˆ\n\n```c\nint a = 12;\nint *b = \u0026a;\nint **c = \u0026b;\n```\n\n## æŒ‡é’ˆè¡¨è¾¾å¼\n\næ¶‰åŠåˆ°[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/å˜é‡çš„åœ°å€ä¸å€¼|å˜é‡çš„åœ°å€ä¸å€¼]]ã€‚\n\n```c\nchar ch = 'a';\nchar *cp = \u0026ch;\n```\n\nåˆå§‹åŒ–å¦‚ä¸‹ï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024005918.png]]\n\n### ch\n\nå·¦å€¼ï¼šè¡¨ç¤ºè¡¨è¾¾å¼å€¼ä¸º'a'\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024010009.png]]\n\nå³å€¼ï¼šè¡¨è¾¾å¼ä¸ºå†…å­˜çš„åœ°å€ï¼ˆè€Œä¸æ˜¯åœ°å€ä¸Šå­˜çš„å€¼ï¼‰ï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024010053.png]]\n\n### \u0026ch\n\nå³å€¼ï¼šå˜é‡chçš„åœ°å€ï¼Œä½†æ˜¯\u0026chæœ¬èº«çš„å­˜å‚¨ä½ç½®ä¸ç¡®å®šï¼Œå¯èƒ½æ˜¯æ ˆä¸Šï¼Œå¯èƒ½åœ¨å¯„å­˜å™¨é‡Œï¼Œæ‰€ä»¥æµ®ç©ºè¡¨ç¤ºã€‚\nå·¦å€¼ï¼š\u0026chä½ç½®ä¸ç¡®å®šï¼Œæˆ–è€…è¯´è¯¥å˜é‡æ²¡æœ‰å¯¹åº”çš„åœ°å€ä¿¡æ¯ï¼Œæ— æ³•ä½œä¸ºå·¦å€¼ä½¿ç”¨ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024010125.png]]\n\n### cp\n\nå³å€¼ï¼šcpæ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå…¶å€¼è®°å½•çš„æ˜¯chçš„åœ°å€ã€‚\nå·¦å€¼ï¼šcpè‡ªå·±çš„åœ°å€ã€‚å› ä¸ºè¯¥è¡¨è¾¾å¼æ²¡æœ‰è¿›è¡Œé—´æ¥è®¿é—®ï¼Œæ‰€ä»¥æ²¡æœ‰ç®­å¤´ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024010336.png]]\n\n### \u0026cp\n\nå³å€¼ï¼šå–cpçš„åœ°å€å€¼ï¼Œä½†æ˜¯å–å‡ºæ¥ä¸ç¡®å®šæ”¾åœ¨å“ªé‡Œã€‚\nå·¦å€¼ï¼š\u0026cpæ²¡æœ‰è‡ªèº«çš„åœ°å€ä¿¡æ¯ï¼Œæ— æ³•ä½œä¸ºå·¦å€¼ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024010542.png]]\n\n### \\*cp\n\nå³å€¼ï¼šè¿›è¡Œäº†ä¸€æ¬¡é—´æ¥è®¿é—®ï¼Œè·³è½¬åˆ°äº†chçš„å€¼\nå·¦å€¼ï¼šè¿›è¡Œäº†ä¸€æ¬¡é—´æ¥è®¿é—®ï¼Œè·³è½¬åˆ°äº†chçš„åœ°å€\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024010720.png]]\n\n### \\*cp+1\n\nå³å€¼ï¼šè¡¨è¾¾å¼æœ€ç»ˆç»“æœå­˜å‚¨ä½ç½®æœªçŸ¥ï¼Œéæ³•å³å€¼ã€‚\nå·¦å€¼ï¼šå–chçš„åœ°å€å€¼å¹¶+1ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024012149.png]]\n\n### \\*(cp+1)\n\nå³å€¼ï¼šæŒ‡é’ˆè¿ç®—ç»“æœä¸ºå³å€¼ã€‚\nå·¦å€¼ï¼š`*`æ“ä½œç¬¦å°†æŒ‡é’ˆè¿ç®—cp+1çš„ç»“æœï¼ˆä¸€ä¸ªå¸¸é‡ï¼‰è½¬ä¸ºäº†å·¦å€¼ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024132113.png]]\n\n### ++cp\n\nè¡¨è¾¾å¼ç»“æœè¿”å›çš„æ˜¯ä¸€ä¸ªå³å€¼ï¼ŒåŒæ—¶ä¼šæ›´æ–°æ‰cpçš„å€¼ã€‚å…ˆè·å–cpå€¼æ‹·è´å¹¶å¢åŠ å€¼å¤§å°ï¼Œå†è¿”å›ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024133848.png]]\n\n## cp++\n\nè¡¨è¾¾å¼ç»“æœè¿”å›çš„æ˜¯ä¸€ä¸ªå³å€¼ï¼ŒåŒæ—¶ä¼šæ›´æ–°æ‰cpçš„å€¼ã€‚å…ˆè¿”å›cpå€¼æ‹·è´ï¼Œå†å¢åŠ cpçš„å€¼ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024134817.png]]\n\n### \\*++p\n\né—´æ¥è®¿é—®æ“ä½œç¬¦ä½œç”¨äºå¢å€¼åçš„æŒ‡é’ˆæ‹·è´ï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024135020.png]]\n\n### \\*cp++\n\nåç¼€++æ“ä½œç¬¦ä¼˜å…ˆçº§é«˜äº\\*æ“ä½œç¬¦ï¼š\n1. ++æ“ä½œç¬¦äº§ç”Ÿcpçš„ä¸€ä»½æ‹·è´\n2. ++æ“ä½œç¬¦å¢åŠ cpçš„å€¼\n3. cpçš„æ‹·è´ä¸Šæ‰§è¡Œé—´æ¥è®¿é—®\n\n\u003e è¯¥è¡¨è¾¾å¼å¸¸å‡ºç°åœ¨å¾ªç¯ä½“å†…ç”¨äºä¸€æ¬¡è®¿é—®æ•°ç»„å†…å®¹ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024223350.png]]\n\n### ++\\*p\n\né¦–å…ˆæ‰§è¡Œé—´æ¥è®¿é—®ï¼Œå†å°†cpæŒ‡å‘ä½ç½®ä¸Šçš„å€¼å¢åŠ 1ï¼Œè¡¨è¾¾å¼ç»“æœæ˜¯æ­¤æ—¶è¯¥å€¼çš„ä¸€ä¸ªæ‹·è´ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221024225616.png]]\n\n### (\\*cp)++\n\nä¸++\\*pä¸€æ ·ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221025004740.png]]\n\n### ++\\*++cp\n\n1. æ‰§è¡Œ++cpï¼Œè¿”å›å¢åŠ åçš„cpçš„å€¼çš„æ‹·è´ã€‚\n2. å¯¹æ‹·è´å€¼è¿›è¡Œå·¦++æ“ä½œã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221025005008.png]]\n\n## ++\\*cp++\n\n1. æ‰§è¡Œcp++ï¼Œè¿”å›åŸcpå€¼çš„æ‹·è´å€¼ã€‚\n2. æ‰§è¡Œå¯¹æ‹·è´å€¼çš„é—´æ¥è®¿é—®ï¼Œæ•ˆæœç­‰åŒäº\\*cp\n3. å¯¹cpæ‰€æŒ‡å‘ä½ç½®çš„å€¼è¿›è¡Œå·¦++ï¼Œè¿”å›å¢åŠ åçš„æ‹·è´å€¼ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221025005545.png]]\n\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E6%95%B0%E7%BB%84":{"title":"æ•°ç»„","content":"\n# æ•°ç»„\n\n## æ•°ç»„å\n\n```c\nint b[10];\n```\n\nå…¶ä¸­ï¼š\n- b[4] çš„ç±»å‹æ˜¯intã€‚\n- bçš„ç±»å‹æ˜¯æ•°ç»„åã€‚\n- æ•°ç»„åæœ¬è´¨æ˜¯ä¸€ä¸ªå¸¸é‡[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/æŒ‡é’ˆ|æŒ‡é’ˆ]]ï¼Œä½†ç¼–è¯‘å™¨ä¼šè®°å½•ç›¸å…³å±æ€§ï¼Œå¦‚æ•°ç»„å…ƒç´ ä¸ªæ•°ç­‰ã€‚\n- æ•°ç»„åçš„å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘é¦–å…ƒç´ çš„æŒ‡é’ˆå¸¸é‡ã€‚\n- åªæœ‰æ•°ç»„ååœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šä¸ºå®ƒäº§ç”Ÿä¸€ä¸ªæŒ‡é’ˆå¸¸é‡ã€‚\n- æŒ‡é’ˆå¸¸é‡æ„å‘³ç€æŒ‡é’ˆçš„å€¼ä¸èƒ½æ”¹å˜ã€‚\n\nä¸¤ç§æƒ…å†µä¸‹æ•°ç»„åä¸ç”¨æŒ‡é’ˆå¸¸é‡æ¥è¡¨ç¤ºï¼š\n- æ•°ç»„åä½œä¸º sizeof æ“ä½œæ•°æ—¶ï¼š\n    - sizeofè¿”å›æ•°ç»„çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆé•¿åº¦ã€‚\n- ä½œä¸º \u0026  çš„æ“ä½œæ•°æ—¶ï¼š\n    - å–ä¸€ä¸ªæ•°ç»„åçš„åœ°å€æ‰€äº§ç”Ÿçš„æ—¶ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæŒ‡å‘æŸä¸ªå¸¸é‡å€¼çš„æŒ‡é’ˆã€‚\n\n```c\nint a[10];\nint b[10];\n...\nc = \u0026a[10];\n```\n\n- `\u0026a[0]`æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼Œæ­£æ˜¯æ•°ç»„åæœ¬èº«çš„å€¼ï¼Œç­‰ä»·äº `c =a;`ã€‚\n- `b = a;` å’Œ `a = c;` éƒ½æ˜¯éæ³•çš„ï¼Œæ— æ³•ç»™æŒ‡é’ˆå¸¸é‡èµ‹å€¼ã€‚\n\n## ä¸‹æ ‡å¼•ç”¨\n\n```c\narray[ä¸‹æ ‡]\n```\n\nç­‰ä»·äºï¼š\n\n```c\n*(array + (ä¸‹æ ‡) )\n```\n\n### ç­‰ä»·å…³ç³»\n\n```c\nint array[10];\nint *ap = array + 2;\n```\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221031001323.png]]\n\n- apï¼šarray+2ã€\u0026array[2]ã€‚\n- \\*apï¼šarray[2]ã€\\*(array+2)ã€‚\n- ap[0]ï¼š\\*(ap+(0))ã€array[2]ã€‚\n- ap+6ï¼šarray+8ã€\u0026array[8]ã€‚\n- \\*(ap+6)ï¼š\\*(array+8)ã€array[8]ã€‚\n- ap[6]ï¼š\\*(array+8)ã€array[8]ã€‚\n- \u0026apï¼šåˆæ³•ä½†æ˜¯æ²¡æœ‰å¯¹ç­‰çš„æ¶‰åŠarrayçš„è¡¨è¾¾å¼ï¼Œæ— æ³•é¢„æµ‹ç¼–è¯‘å™¨ä¼šæŠŠapæ”¾åœ¨ç›¸å¯¹äºarrayçš„ä½•å¤„ã€‚\n- ap[-1]ï¼š\\*(array+2-1)ã€array[1]ã€‚\n- ap[9]ï¼šarray[11]ï¼Œæ•°ç»„è¶Šç•Œä½†ç¼–è¯‘å™¨å¯èƒ½æ— æ³•æ£€æµ‹åˆ°æ­¤ç±»é”™è¯¯ã€‚\n- 2[array]ï¼š\\*(2+(array))ï¼Œarrayå¤–æ‹¬å·å¯çœç•¥å¹¶äº¤æ¢é¡ºåº--\u003e\\*(array+2)ï¼Œåˆæ³•ã€‚\n\nä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç ä¼šè¾“å‡º10ï¼š\n\n```c\nint main() {\n\tint array[10] = { 0,1,2,3,4,5,6,7,8,9 };\n\tint test[5] = { 0,1,2,3,4 };\n\tint *p = array;\n\tp[16] = 10;\n\tcout \u003c\u003c test[0];\n\treturn 0;\n}\n```\n\n\u003e åœ¨ä¸€äº›åœºæ™¯ä¼šä½¿ç”¨è¯¥æŠ€å·§ï¼Œä¾‹å¦‚åµŒå…¥å¼å¼€å‘æ—¶å¯¹boot magic addressçš„æ“ä½œã€‚\n\n## æ•°ç»„ä¸æŒ‡é’ˆçš„å·®åˆ«\n\n```c\nint a[5];\nint *b;\n```\n\naå’Œbéƒ½æœ‰æŒ‡é’ˆå€¼ï¼Œéƒ½å¯ä»¥è¿›è¡Œé—´æ¥è®¿é—®å’Œä¸‹æ ‡å¼•ç”¨ï¼Œä½†æ˜¯ä¸èƒ½éšæ„äº’æ¢ä½¿ç”¨ï¼š\n- å£°æ˜ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®æŒ‡å®šå…ƒç´ æ•°é‡ä¸ºå…¶ä¿ç•™å†…å­˜ç©ºé—´ï¼Œå†åˆ›å»ºæ•°ç»„åä¸”å€¼æ˜¯æŒ‡å‘è¯¥æ®µç©ºé—´èµ·å§‹ä½ç½®çš„å¸¸é‡ã€‚\n- å£°æ˜ä¸€ä¸ªæŒ‡é’ˆæ—¶ï¼Œç¼–è¯‘å™¨åªä¼šä¸ºæŒ‡é’ˆæœ¬èº«ä¿ç•™ç©ºé—´ï¼Œä¸”ä¸ä¼šåˆå§‹åŒ–æŒ‡å‘ä»»ä½•ç°æœ‰ç©ºé—´ã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101015317.png]]\n\n## æŒ‡é’ˆä¸ä¸‹æ ‡çš„é€‰æ‹©\n\nä¸Šé¢ä¸¤æ®µä»£ç ä¸­\n\n### æŒ‡é’ˆæ•ˆç‡æ›´é«˜çš„åœºæ™¯\n\n\u003e æŒ‡é’ˆçš„æ•ˆç‡å’Œä¸‹æ ‡ä¸€æ ·æˆ–è€…æ›´é«˜ã€‚\n\n```c\nint array[10], a;\nfor (a = 0; a\u003c10; a++)\n    array[a] = 0;\n```\n\nä¸Šä¸€æ®µä»£ç ï¼Œç¼–è¯‘å™¨å…ˆå–å‡ºaçš„å€¼ï¼Œå†ä¹˜ä»¥æ•´å‹çš„é•¿åº¦4ï¼Œå¾ªç¯æ‰§è¡Œã€‚\n\n```c\nint array[10], *ap;\nfor (ap = array; ap\u003carray+10; ap++)\n    *ap = 0;\n```\n\nä¸Šæ®µä»£ç ä¸­ï¼ŒapæŒ‡é’ˆå¤šæ¬¡åŠ ä¸Š$1*4$çš„å€¼ã€‚\n\nè™½ç„¶éƒ½æœ‰å¤šæ¬¡ä¹˜æ³•ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªä»£ç ä¸­çš„ä¹˜æ³•æ€»æ˜¯$1*4$ï¼Œå³å¯åœ¨ç¼–è¯‘é˜¶æ®µä¼˜åŒ–ã€‚\n\n### æ•ˆç‡ä¸€æ ·çš„åœºæ™¯\n\n```c\na = get_value();\narray[a] = 0;\n```\n\n```c\na = get_value();\n*(array+a) = 0;\n```\n\nä¸Šé¢ä¸¤æ®µä»£ç ä¸­çš„aæ¯æ¬¡éƒ½æ˜¯ä¸ç¡®å®šçš„å€¼ï¼Œå› æ­¤æŒ‡é’ˆè®¿é—®ä¹Ÿä¸èƒ½è¢«ä¼˜åŒ–ï¼Œæ‰€ä»¥æ•ˆç‡ä¸€æ ·ã€‚\n\n### æ›´å¤æ‚çš„åœºæ™¯\n\n```c\n#define SIZE 50\nint x[SIZE];\nint y[SIZE];\nint i;\nint *p1, *p2;\n\nint main() {\nÂ  Â  for(i=0;i\u003cSIZE;i++)\nÂ  Â  Â  Â  x[i]=y[i];\n}\n```\n\n```c\nint x[SIZE];\nint y[SIZE];\nint i;\nint *p1, *p2;\n\nint main() {\nÂ  Â  register int *p1, *p2;\nÂ  Â  for(p1=x ,p2=y;p1\u003c\u0026x[SIZE];)\nÂ  Â  Â  Â  *p1++=*p2++;\n}\n```\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101014553.png]]\n\nç¬¬äºŒç§æ–¹å¼æ›´å¿«ï¼Œå› ä¸ºç”¨åˆ°äº†å¯„å­˜å™¨å˜é‡ï¼Œå¹¶ä¸”é€šè¿‡æ¶ˆé™¤è®¡æ•°å™¨æ¥å°†å¾ªç¯è¾¹ç•Œçš„èŒƒå›´æ¯”è¾ƒå€¼æ”¾åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œè®¡ç®—ã€‚\n\n## æ•°ç»„åä½œä¸ºå‡½æ•°å‚æ•°\n\nå®å‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå› ä¸ºå‡½æ•°å¹¶ä¸ä¼šä¸ºæ•°ç»„å‚æ•°åˆ†é…å†…å­˜ç©ºé—´ï¼Œå½¢å‚åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘äº†å·²ç»åœ¨å…¶å®ƒåœ°æ–¹åˆ†é…å¥½çš„å†…å­˜ç©ºé—´ã€‚å› æ­¤å‡½æ•°ä¹Ÿæ— æ³•çŸ¥é“æ•°ç»„çš„é•¿åº¦ï¼Œéœ€è¦æ˜¾ç¤ºçš„ä¼ é€’ä¸€ä¸ªå‚æ•°å‘ŠçŸ¥æ•°ç»„é•¿åº¦ï¼Œä¸” `sizeof string`çš„å€¼æ—¶æŒ‡å‘å­—ç¬¦ä¸²é¦–ä¸ªå­—ç¬¦çš„æŒ‡é’ˆçš„é•¿åº¦ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚\nä¸‹é¢ä¸¤ç§å½¢å¼ç›¸ç­‰ï¼Œä½†ä»…é™äºå½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚\n\n```c\nint strlen(char *string);\nint strlen(char string[]);\n```\n\n## å¤šç»´æ•°ç»„\n\n```c\nint array[3][6];\n```\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101171935.png]]\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101171952.png]]\n\nå¤šç»´æ•°ç»„çš„ç¬¬ä¸€ç»´å®é™…ä¸Šæ—¶å¦ä¸€ä¸ªæ•°ç»„ã€‚ä¸Šé¢ä¾‹å­ä¸­arrayå¯ä»¥çœ‹ä½œæ—¶ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼ŒåŒ…å«3ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ æ°å¥½æ˜¯åŒ…å«6ä¸ªæ•´å‹å…ƒç´ çš„æ•°ç»„ã€‚\n\narrayè¿™ä¸ªåå­—çš„å€¼æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼Œæ‰€ä»¥arrayæ˜¯ä¸€ä¸ªæŒ‡å‘åŒ…å«6ä¸ªæ•´å‹å…ƒç´ çš„æ•°ç»„çš„æŒ‡é’ˆã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101172727.png]]\n\narray+1ä¹Ÿæ˜¯æŒ‡å‘åŒ…å«6ä¸ªæ•´å‹å…ƒç´ çš„æ•°ç»„çš„æŒ‡é’ˆï¼Œä½†æ˜¯æŒ‡å‘çš„æ˜¯arrayçš„å¦ä¸€è¡Œï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101172809.png]]\n\n`*(array+1)` æ˜¯ä¸€ä¸ªæŒ‡å‘æ•´å‹çš„æŒ‡é’ˆ\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101172926.png]]\n\n`*(array+1)+5`ï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101173028.png]]\n\n`*(*(array+1)+5)`ï¼šæ‰§è¡Œé—´æ¥è®¿é—®æ“ä½œã€‚\n\n### ä¸‹æ ‡è®¿é—®\n\n```c\nint matrix[3][10];\nmatrix[1][5];\n```\n\n![[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/z-attachments/Pasted image 20221101172653.png]]\n\n### æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ\n\n```c\nint vector[10], *vp=vector;\nint matrix[3][10], *mp=matrix;\n```\n\nè¯­å¥1åˆæ³•ï¼Œè¯­å¥2ä¸åˆæ³•ã€‚å› ä¸ºmatrixä¸æ˜¯ä¸€ä¸ªæŒ‡å‘æ•´å‹çš„æŒ‡é’ˆï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘æ•´å‹æ•°ç»„çš„æŒ‡é’ˆï¼Œä¸ `int *mp`ä¸­mpçš„ç±»å‹ä¸ç¬¦ï¼Œåº”è¯¥å£°æ˜å¦‚ä¸‹ï¼š\n\n```c\nint (*p)[10];\n```\n\nä¸‹æ ‡å¼•ç”¨ä¼˜å…ˆçº§é«˜äºé—´æ¥è®¿é—®ï¼Œä½†æ‹¬å·æé«˜äº†é—´æ¥è®¿é—®çš„ä¼˜å…ˆçº§ä¿è¯å…¶é¦–å…ˆè¢«æ‰§è¡Œï¼Œæ‰€ä»¥pæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼›\næ‰§è¡Œä¸‹æ ‡è®¿é—®åï¼Œç¡®å®šäº†pæŒ‡å‘æŸç§ç±»å‹çš„**æ•°ç»„**ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯intã€‚\n\nä¸‹é¢çš„ä¾‹å­åŒ…å«äº†ä¸‰ç§å¸¸è§æƒ…å†µï¼š\n\n```c\nint main() {\n\tint array[3][4] = { 1,2,3,4,5,6,7,8,9,10,11,12 };\n\tint* p1 = \u0026array[0][0];\n\tint* p2 = array[0];\n\tint (*p3)[4] = array;\n\tcout \u003c\u003c *(p1 + 1) \u003c\u003c endl;    // 2\n\tcout \u003c\u003c *(p2 + 1) \u003c\u003c endl;    // 2\n\tcout \u003c\u003c *(*(p3 + 1)) \u003c\u003c endl; // 5\n\treturn 0;\n}\n```\n\n### å¤šç»´æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°\n\nå‚æ•°ä¸­çš„å¤šç»´æ•°ç»„åï¼Œå®é™…ä¼ é€’çš„æ—¶æŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆã€‚\n\nå¯ä»¥å‚è€ƒä¸€ç»´æ•°ç»„çš„æƒ…å†µï¼š\n\n```c\nvoid func1(int *vec);\nvoid func1(int vec[]);\n...\nint vector[10];\n...\nfunc1(vector);\n```\n\n```c\n\n```\n\näºŒç»´æ•°ç»„ï¼š\n\n```c\nvoid func2(int (*mat)[10]);\nvoid func2(int mat[][10]);\n...\nint matrix[3][10];\n...\nfunc2(matrix);\n```\n\nå…³é”®æ˜¯ç¼–è¯‘å™¨å¿…é¡»è¦èƒ½çŸ¥é“ç¬¬äºŒä¸ªåŠä»¥åå„ç»´çš„é•¿åº¦æ‰èƒ½å¯¹å„ä¸‹æ ‡æ±‚å€¼ï¼Œå‡½æ•°å½¢å‚å¿…é¡»å£°æ˜\u003e=2ç»´çš„é•¿åº¦ã€‚\nç¬¬ä¸€ç»´çš„é•¿åº¦ä¸é‡è¦ï¼Œå› ä¸ºè®¡ç®—ä¸‹æ ‡å€¼æ—¶ç”¨ä¸åˆ°ã€‚\n\nä¸‹åˆ—å£°æ˜å½¢å¼ä¸æ­£ç¡®ï¼š\n\n```c\nvoid func2(int **mat);\n```\n\n## æŒ‡é’ˆæ•°ç»„\n\n```c\nint *api[10];\n```\n\nä¸‹æ ‡å¼•ç”¨ä¼˜å…ˆçº§é«˜äºé—´æ¥è®¿é—®ï¼Œåœ¨ä¸Šè¿°è¡¨è¾¾å¼ä¸­é¦–å…ˆæ‰§è¡Œä¸‹æ ‡å¼•ç”¨ï¼Œapiæ—¶æŸç§ç±»å‹çš„é•¿åº¦ä¸º10æ•°ç»„ã€‚è¿”å›æ•°ç»„é¦–å…ƒç´ ï¼Œå†æ‰§è¡Œé—´æ¥è®¿é—®åæ˜¯æ•´å‹ã€‚\næœ€ç»ˆapiæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…ƒç´ ç±»å‹æ˜¯æŒ‡å‘æ•´å‹çš„æŒ‡é’ˆã€‚\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E6%A0%87%E8%AF%86%E7%AC%A6%E7%9A%84%E9%93%BE%E6%8E%A5%E5%B1%9E%E6%80%A7":{"title":"æ ‡è¯†ç¬¦çš„é“¾æ¥å±æ€§","content":"\n# æ ‡è¯†ç¬¦çš„é“¾æ¥å±æ€§\n\n## åˆ†ç±»\n\n- external å¤–éƒ¨ï¼šæ ‡è¯†ç¬¦æ— è®ºå£°æ˜å¤šå°‘æ¬¡ã€ä½äºå‡ ä¸ªæºæ–‡ä»¶ï¼Œéƒ½è¡¨ç¤ºåŒä¸€ä¸ªå®ä½“ã€‚\n- internal å†…éƒ¨ï¼šæ ‡è¯†ç¬¦åœ¨åŒä¸€ä¸ªæ–‡ä»¶å†…çš„æ‰€æœ‰å£°æ˜éƒ½è¡¨ç¤ºåŒä¸€ä¸ªå®ä½“ã€‚\n- none é»˜è®¤ï¼šè¯¥æ ‡è¯†ç¬¦çš„å¤šä¸ªå£°æ˜è¢«å½“ä½œç‹¬ç«‹çš„ä¸ªä½“ã€‚\n\n## æ ‡è¯†ç¬¦é“¾æ¥å±æ€§åˆ¤åˆ«\n\nç¤ºä¾‹ä»£ç ï¼š\n\n```c\ntypedef char *a;\nint b;\nint c(int d)\n{\n\tint e;\n\tint f(int g);\n\t...\n}\n```\n\n- a\n- b external\n- c external\n- d\n- e\n- f external\n- g\n\n## å˜æ›´æ ‡è¯†ç¬¦é“¾æ¥å±æ€§\n\n- å¯¹ç¼ºçœé“¾æ¥å±æ€§ä¸º external çš„æ ‡è¯†ç¬¦ä½¿ç”¨ static å¯ä»¥å°†å…¶è½¬ä¸º internalã€‚\n- extern ä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦æŒ‡å®š external é“¾æ¥å±æ€§ã€‚\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/%E9%97%B4%E6%8E%A5%E8%AE%BF%E9%97%AE%E6%93%8D%E4%BD%9C%E7%AC%A6":{"title":"é—´æ¥è®¿é—®æ“ä½œç¬¦","content":"\n# é—´æ¥è®¿é—®æ“ä½œç¬¦\n\né€šè¿‡ä¸€ä¸ªæŒ‡é’ˆè®¿é—®å®ƒæ‰€æŒ‡å‘çš„åœ°å€çš„è¿‡ç¨‹ç§°ä¸ºé—´æ¥è®¿é—®/è§£å¼•ç”¨æŒ‡é’ˆã€‚\n\n`*`æ“ä½œç¬¦æ˜¯é—´æ¥è®¿é—®æ“ä½œç¬¦ã€‚ä¸[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/æŒ‡é’ˆ|æŒ‡é’ˆ]]ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºè®¿é—®æŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼ã€‚è¯¥æ“ä½œç¬¦éœ€è¦ä¸€ä¸ªå³å€¼ï¼ˆç±»å‹æ˜¯æŒ‡é’ˆç±»å‹è¡¨è¾¾å¼ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå·¦å€¼ã€‚\n\nå¤šä¸ª`*`æ“ä½œç¬¦å…·æœ‰ä»å³å‘å·¦ç»“åˆçš„ç‰¹æ€§ï¼š\n\n```c\nint **c = \u0026b;\n```\n\nç­‰ä»·äºï¼š\n\n```c\nint *(*c) = \u0026b;\n```\n\n## ç¤ºä¾‹\n\nè¡¨ç¤ºè¡¨è¾¾å¼ `*a`çš„ç±»å‹æ˜¯intã€‚\n\n```c\nint *a;\n```\n","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/gcc%E5%8F%82%E6%95%B0":{"title":"gccå‚æ•°","content":"\n# gccå‚æ•°\n\n- -E é¢„å¤„ç†\n- -S å°†æºä»£ç æˆ–é¢„å¤„ç†åæ–‡ä»¶ç¼–è¯‘ä¸ºæ±‡ç¼–æ–‡ä»¶\n- -c ç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶\n- -o ç›®æ ‡è¾“å‡ºæ–‡ä»¶\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/gcc%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6":{"title":"gccè¾“å‡ºæ–‡ä»¶","content":"\n# gccè¾“å‡ºæ–‡ä»¶\n\n- .c æºæ–‡ä»¶\n- .h å¤´æ–‡ä»¶\n- .i é¢„å¤„ç†åæ–‡ä»¶\n- .s æ±‡ç¼–è¯­è¨€æ–‡ä»¶\n- .o ç›®æ ‡æ–‡ä»¶\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/cpp/static%E5%85%B3%E9%94%AE%E5%AD%97":{"title":"staticå…³é”®å­—","content":"\n# staticå…³é”®å­—\n\n## ä½œç”¨\n\n- ç”¨äºå‡½æ•°å®šä¹‰æˆ–ä»£ç å—å¤–å˜é‡å£°æ˜æ—¶ï¼šæ”¹å˜[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/æ ‡è¯†ç¬¦çš„é“¾æ¥å±æ€§|æ ‡è¯†ç¬¦çš„é“¾æ¥å±æ€§]]ã€‚\n- ç”¨äºä»£ç å—å†…å˜é‡å£°æ˜æ—¶ï¼šæ”¹å˜[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/cpp/å˜é‡çš„å­˜å‚¨ç±»å‹|å˜é‡çš„å­˜å‚¨ç±»å‹]]ã€‚\n","lastmodified":"2023-01-23T15:37:51.754680553Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/0-%E8%BD%AF%E4%BB%B6%E8%AF%AD%E8%A8%80/sql/%E5%8F%8C%E5%B1%82not_exists%E5%B5%8C%E5%A5%97":{"title":"åŒå±‚not_existsåµŒå¥—","content":"# åŒå±‚not_existsåµŒå¥—\n\n\u003e [SQL ä¸­çš„ EXISTS åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/20005249)\n\u003e [SQL åŒå±‚ not exist åµŒå¥—](https://blog.csdn.net/mtawaken/article/details/6573122)  \n\n## WHERE åšäº†ä»€ä¹ˆ\n\n```sql\nSELECT Sno, Sname\nFROM Student\nWHERE Sdept = 'IS'\n```\n\n1. DBMS ä¼šæ‰«æ è¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•\n1. åˆ¤æ–­åé¢çš„é€»è¾‘è¡¨è¾¾å¼çš„å€¼æ˜¯å¦ä¸º True\n   - å¦‚æœä¸º Trueï¼Œåˆ™å°†å½“å‰è¿™æ¡è®°å½•æ”¾åˆ°ç»“æœé›†é‡Œé¢å»\n   - å¦‚æœé€»è¾‘è¡¨è¾¾å¼çš„å€¼ä¸º False åˆ™ä¸æ”¾\n\n## ç›¸å…³å­æŸ¥è¯¢\n\næŸ¥è¯¢æ¯ä¸ªå­¦ç”Ÿè¶…è¿‡å…¶é€‰ä¿®çš„æ‰€æœ‰è¯¾ç¨‹çš„å¹³å‡æˆç»©çš„è¯¾ç¨‹çš„è¯¾ç¨‹å·:   \n```sql\nSELECT Cno\nFROM SC x\nWHERE Grade \u003e=\n(\n    SELECT AVG(Grade)\n    FROM SC y\n    WHERE y.Sno = x.Sno\n)\n```\n\n1. æ‰«æçˆ¶æŸ¥è¯¢ä¸­æ•°æ®æ¥æºï¼ˆå¦‚ SC è¡¨ï¼‰ä¸­çš„æ¯ä¸€æ¡è®°å½•\n1. å°†å½“å‰è¿™æ¡è®°å½•ä¸­çš„ï¼Œåœ¨å­æŸ¥è¯¢ä¸­ä¼šç”¨åˆ°çš„å€¼(Grade)ä»£å…¥åˆ°å­æŸ¥è¯¢ä¸­å»\n1. æ‰§è¡Œå­æŸ¥è¯¢å¹¶å¾—åˆ°ç»“æœï¼ˆå¯ä»¥çœ‹æˆæ˜¯è¿”å›å€¼ï¼‰\n1. å†å°†è¿™ä¸ªç»“æœä»£å…¥åˆ°çˆ¶æŸ¥è¯¢çš„æ¡ä»¶ä¸­(Grade \u003e=)\n1. åˆ¤æ–­çˆ¶æŸ¥è¯¢çš„æ¡ä»¶è¡¨è¾¾å¼çš„å€¼æ˜¯å¦ä¸º True (WHERE èµ·ä½œç”¨)\n   - è‹¥ä¸º Trueï¼Œåˆ™å°†å½“å‰ SC è¡¨ä¸­çš„è¿™æ¡è®°å½•ï¼ˆç»è¿‡ SELECT å¤„ç†ï¼‰åæ”¾åˆ°ç»“æœé›†ä¸­å»\n   - è‹¥ä¸º False åˆ™ä¸æ”¾\n\n## (NOT) EXISTS åšäº†ä»€ä¹ˆ\n\nè‹¥å­˜åœ¨:\n1. åˆ¤æ–­å­æŸ¥è¯¢å¾—åˆ°çš„ç»“æœé›†æ˜¯å¦æ˜¯ä¸€ä¸ªç©ºé›†\n   - å¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å› True\n   - å¦‚æœæ˜¯ï¼Œåˆ™è¿”å› False\nè‹¥ä¸å­˜åœ¨:\nè¿”å›ç»“æœä¸ä¸Šè¿°ç›¸å\n\n### ç”¨æ³•\n\n- ç”±existså¼•å‡ºçš„å­æŸ¥è¯¢ï¼Œå…¶ç›®æ ‡åˆ—è¡¨è¾¾å¼é€šå¸¸éƒ½ç”¨*ï¼Œå› ä¸ºEXISTSçš„å­æŸ¥è¯¢åªè¿”å›çœŸå€¼æˆ–è€…å‡å€¼ï¼Œä¸è¿”å›é€‰æ‹©å‡ºæ¥çš„ç»“æœ\n- å­æŸ¥è¯¢ä¸­å¿…é¡»è¦æœ‰ä¾èµ–çˆ¶æŸ¥è¯¢çš„æ¡ä»¶\n- æ¯æ¬¡æŸ¥è¯¢æ—¶çˆ¶æŸ¥è¯¢è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç»„å¯¹å­æŸ¥è¯¢æ‰€æœ‰çš„å…ƒç»„è¿›è¡Œåˆ¤å®š\n  - å¦‚æœä¸ºtrueåˆ™çˆ¶æŸ¥è¯¢ä¸­çš„è¿™ä¸ªå…ƒç»„å…è®¸æ”¾å…¥ç»“æœè¡¨\n  - å¦åˆ™è¿›è¡Œçˆ¶æŸ¥è¯¢ä¸‹ä¸€ä¸ªå…ƒç»„çš„åˆ¤å®š\n\n## WHERE å’Œ (NOT) EXISTS é…åˆ\n\n1. WHERE æ ¹æ®å…¶åè¯­å¥çš„ç»“æœå†³å®šæ˜¯å¦å°†å½“å‰éå†æ¡ç›®åŠ å…¥åˆ°ç»“æœé›†åˆä¸­\n1. EXISTS ç”¨äºæ£€éªŒå½“å‰æ¡ç›®ç›¸å…³æ•°æ®å¸¦å…¥è‡ªèº«åˆ¤æ–­åçš„é€»è¾‘ç»“æœ\n   1. è¿”å›çš„æ˜¯å†…éƒ¨æŸ¥è¯¢ç»“æœé›†æ˜¯å¦ä¸ºç©ºçš„é€»è¾‘å€¼\n1. WHERE æ¥å— EXISTS è¿”å›çš„é€»è¾‘å€¼åšç›¸åº”æ“ä½œ\n\n## å…³ç³»æ¨¡å‹\n\n```\nå­¦ç”Ÿï¼ˆå­¦å·ï¼Œå§“åï¼Œç³»åˆ«ï¼Œå¹´é¾„ï¼‰\n\nè¯¾ç¨‹ï¼ˆè¯¾ç¨‹å·ï¼Œè¯¾ç¨‹åï¼Œå­¦æ—¶ï¼‰\n\né€‰è¯»ï¼ˆå­¦å·ï¼Œè¯¾ç¨‹å·ï¼Œæˆç»©ï¼‰\n```\n\n## é—®é¢˜: æ£€ç´¢é€‰è¯»å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿå§“å\n\nç­”æ¡ˆ:\n```sql\nselect å­¦ç”Ÿ.å§“å from å­¦ç”Ÿ\nwhere not exists\n(\n    select * from è¯¾ç¨‹ where not exists\n    (\n        select * from é€‰è¯» where å­¦å·=å­¦ç”Ÿ.å­¦å· and è¯¾ç¨‹å·=è¯¾ç¨‹.è¯¾ç¨‹å·\n    )\n)\n```\n\n## åˆ†æ\n\n1. å…ˆå– Student è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç»„ï¼Œå¾—åˆ°å…¶ Sno åˆ—çš„å€¼ã€‚\n1. å†å– Course è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç»„ï¼Œå¾—åˆ°å…¶ Cno åˆ—çš„å€¼ã€‚\n1. æ ¹æ® Sno ä¸ Cno çš„å€¼ï¼Œéå† SC è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ï¼ˆä¹Ÿå°±æ˜¯é€‰è¯¾è®°å½•ï¼‰\n   - ç¬¬äºŒä¸ª NOT EXISTS\n   - è‹¥å¯¹äºæŸä¸ª Sno å’Œ Cno çš„å€¼æ¥è¯´ï¼Œåœ¨ SC è¡¨ä¸­æ‰¾ä¸åˆ°ç›¸åº”çš„è®°å½•ï¼Œåˆ™è¯´æ˜è¯¥ Sno å¯¹åº”çš„å­¦ç”Ÿæ²¡æœ‰é€‰ä¿®è¯¥ Cno å¯¹åº”çš„è¯¾ç¨‹ã€‚\n1. å¯¹äºæŸä¸ªå­¦ç”Ÿæ¥è¯´ï¼Œè‹¥åœ¨éå† Course è¡¨ä¸­æ‰€æœ‰è®°å½•ï¼ˆä¹Ÿå°±æ˜¯æ‰€æœ‰è¯¾ç¨‹ï¼‰åï¼Œä»æ‰¾ä¸åˆ°ä»»ä½•ä¸€é—¨ä»–/å¥¹æ²¡æœ‰é€‰ä¿®çš„è¯¾ç¨‹ï¼Œå°±è¯´æ˜æ­¤å­¦ç”Ÿé€‰ä¿®äº†å…¨éƒ¨çš„è¯¾ç¨‹ã€‚\n   - ç¬¬ä¸€ä¸ª NOT EXISTS\n1. å°†æ­¤å­¦ç”Ÿæ”¾å…¥ç»“æœå…ƒç»„é›†åˆä¸­ã€‚\n1. å›åˆ° STEP1ï¼Œå– Student ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç»„ã€‚\n1. å°†æ‰€æœ‰ç»“æœå…ƒç»„é›†åˆæ˜¾ç¤ºã€‚\n\nç¬¬ä¸€ä¸ª NOT EXISTS å¯¹åº”ç¬¬å››æ­¥ï¼Œç¬¬äºŒä¸ª NOT EXISTS å¯¹åº”ç¬¬ä¸‰æ­¥\n\næ³¨é‡Š:\n\n```sql\nselect å­¦ç”Ÿ.å§“å from å­¦ç”Ÿ  --ç»“æœé›†1, ç»“æœé›†2ä¸ºç©ºå¯¹åº”çš„å­¦ç”Ÿæ”¾å…¥ç»“æœé›†1\nwhere not exists\n(\n    select * from è¯¾ç¨‹  --ç»“æœé›†2, è¯¾è¡¨é‡ŒxåŒå­¦æœªé€‰è¿‡çš„è¯¾ç»„æˆ\n    where not exists\n    (\n        select * from é€‰è¯»\n        where å­¦å·=å­¦ç”Ÿ.å­¦å· and è¯¾ç¨‹å·=è¯¾ç¨‹.è¯¾ç¨‹å·  --æ‰¾å­¦ç”Ÿxé€‰è¿‡çš„è¯¾çš„é›†åˆ\n    )\n)\n```","lastmodified":"2023-01-23T15:37:51.766680662Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/%E5%A7%94%E6%B4%BE":{"title":"å§”æ´¾","content":"# å§”æ´¾\n\nA  å§”æ´¾ B åšæŸäº‹ï¼Œåˆ™ B å†…ä¼šæœ‰ A çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨ A çš„æ–¹æ³•ã€‚\n\n```java\n// Java program to illustrate\n// delegation\nclass RealPrinter {\n\t// the \"delegate\"\n\tvoid print()\n\t{\n\t\tSystem.out.println(\"The Delegate\");\n\t}\n}\n\nclass Printer {\n\t// the \"delegator\"\n\tRealPrinter p = new RealPrinter();\n\n\t// create the delegate\n\tvoid print()\n\t{\n\t\tp.print(); // delegation\n\t}\n}\n\npublic class Tester {\n\n\t// To the outside world it looks like Printer actually prints.\npublic static void main(String[] args)\n\t{\n\t\tPrinter printer = new Printer();\n\t\tprinter.print();\n\t}\n}\n\n```","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/%E7%BB%A7%E6%89%BF":{"title":"ç»§æ‰¿","content":"# ç»§æ‰¿\n\nB ç»§æ‰¿è‡ª Aï¼Œåˆ™ B èƒ½è·å¾— A çš„å±æ€§ï¼Œå¹¶æ¥ç®¡æ“ä½œã€‚\n\n```java\n// Java program to illustrate\n// Inheritance\nclass RealPrinter {\n\t// base class implements method\n\tvoid print()\n\t{\n\t\tSystem.out.println(\"Printing Data\");\n\t}\n} 3 // Printer Inheriting functionality of real printer\n\tclass Printer extends RealPrinter {\n\n\tvoid print()\n\t{\n\t\tsuper.print(); // inside calling method of parent\n\t}\n}\n\npublic class Tester {\n\n\t// To the outside world it looks like Printer actually prints.\npublic static void main(String[] args)\n\t{\n\t\tPrinter printer = new Printer();\n\t\tprinter.print();\n\t}\n}\n\n```","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/%E7%BB%A7%E6%89%BF%E5%92%8C%E5%A7%94%E6%B4%BE%E7%9A%84%E9%80%89%E6%8B%A9":{"title":"ç»§æ‰¿å’Œå§”æ´¾çš„é€‰æ‹©","content":"\n# ç»§æ‰¿å’Œå§”æ´¾çš„é€‰æ‹©\n\n- æƒ³è¦è¡¨è¾¾ is-a å…³ç³»ï¼Œä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/ç¼–ç¨‹æ€æƒ³/ç»§æ‰¿|ç»§æ‰¿]]ã€‚\n- æƒ³è¦å°†ç±»ä¼ é€’ç»™å·²æœ‰çš„APIï¼Œä½¿ç”¨ç»§æ‰¿ã€‚\n- æƒ³è¦å¢å¼ºAï¼Œä½†Aä¸èƒ½å†è¢«[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/ç¼–ç¨‹æ€æƒ³/ç»§æ‰¿|ç»§æ‰¿]]ï¼Œä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/ç¼–ç¨‹æ€æƒ³/å§”æ´¾|å§”æ´¾]]ã€‚\n- æƒ³è¦æŸæ–¹æ³•å¹¶ä¸”ä¸æƒ³è¦†ç›–è¯¥æ–¹æ³•ï¼Œä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/ç¼–ç¨‹æ€æƒ³/å§”æ´¾|å§”æ´¾]]ã€‚\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%A4%E9%98%B6%E6%AE%B5%E7%BB%88%E6%AD%A2":{"title":"ä¸¤é˜¶æ®µç»ˆæ­¢","content":"\n# ä¸¤é˜¶æ®µç»ˆæ­¢\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F":{"title":"äº«å…ƒæ¨¡å¼","content":"\n# äº«å…ƒæ¨¡å¼\n\n\u003e å¯ä»¥ç”¨æ¥è§£å†³[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/ä¿æŠ¤æ€§æ‹·è´|ä¿æŠ¤æ€§æ‹·è´]]é¢‘ç¹åˆ›å»ºå¯¹è±¡å¼€é”€è¿‡å¤§çš„é—®é¢˜ã€‚\n\u003e é‡ç”¨æ•°é‡æœ‰é™çš„åŒä¸€ç±»å¯¹è±¡ã€‚\n\nè‹±æ–‡åç§°ï¼šFlyweight patternã€‚\n\n\u003ewikipediaï¼š A ï¬‚yweight is an object that minimizes memory usage by sharing as much data as possible with other similar objects\n\n## ç”¨ä¾‹\n\n### åŒ…è£…ç±»\n\nåœ¨JDKä¸­ Booleanï¼ŒByteï¼ŒShortï¼ŒIntegerï¼ŒLongï¼ŒCharacter ç­‰åŒ…è£…ç±»æä¾›äº† valueOf æ–¹æ³•ï¼Œä¾‹å¦‚ Long çš„ valueOf ä¼šç¼“å­˜ -128~127 ä¹‹é—´çš„ Long å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹é—´ä¼šé‡ç”¨å¯¹è±¡ï¼Œå¤§äºè¿™ä¸ªèŒƒå›´ï¼Œæ‰ä¼šæ–°å»º Long å¯¹è±¡ï¼š\n\n```java\npublic static Long valueOf(long l) {\n    final int offset = 128;\n    if (l \u003e= -128 \u0026\u0026 l \u003c= 127) { // will cache\n        return LongCache.cache[(int)l + offset];\n    }\n    return new Long(l);\n}\n```\n\næ³¨æ„ï¼š\n- Byte, Short, Long ç¼“å­˜çš„èŒƒå›´éƒ½æ˜¯ -128~127\n- Character ç¼“å­˜çš„èŒƒå›´æ˜¯ 0~127\n- Integerçš„é»˜è®¤èŒƒå›´æ˜¯ -128~127\n\t- æœ€å°å€¼ä¸èƒ½å˜\n\t- ä½†æœ€å¤§å€¼å¯ä»¥é€šè¿‡è°ƒæ•´è™šæ‹Ÿæœºå‚æ•°`Djava.lang.Integer.IntegerCache.high`æ¥æ”¹å˜\n- Boolean ç¼“å­˜äº† TRUE å’Œ FALSE\n\n### Stringæ± \n\n### BigDecimal\n\nBigDecimal\n\n### BigInteger\n\nBigInteger\n\n### æ•°æ®åº“è¿æ¥æ± \n\n```java\nclass Pool {\n    // 1. è¿æ¥æ± å¤§å°\n    private final int poolSize;\n \n    // 2. è¿æ¥å¯¹è±¡æ•°ç»„\n    private Connection[] connections;\n \n    // 3. è¿æ¥çŠ¶æ€æ•°ç»„ 0 è¡¨ç¤ºç©ºé—²ï¼Œ 1 è¡¨ç¤ºç¹å¿™\n    private AtomicIntegerArray states;\n \n    // 4. æ„é€ æ–¹æ³•åˆå§‹åŒ–\n    public Pool(int poolSize) {\n        this.poolSize = poolSize;\n        this.connections = new Connection[poolSize];\n        this.states = new AtomicIntegerArray(new int[poolSize]);\n        for (int i = 0; i \u003c poolSize; i++) {\n            connections[i] = new MockConnection(\"è¿æ¥\" + (i+1));\n        }\n    }\n \n    // 5. å€Ÿè¿æ¥\n    public Connection borrow() {\n    while(true) {\n            for (int i = 0; i \u003c poolSize; i++) {\n                // è·å–ç©ºé—²è¿æ¥\n                if(states.get(i) == 0) {\n                    if (states.compareAndSet(i, 0, 1)) {\n                        log.debug(\"borrow {}\", connections[i]);\n                        return connections[i];\n                    }\n                }\n            }\n            // å¦‚æœæ²¡æœ‰ç©ºé—²è¿æ¥ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…\n            synchronized (this) {\n                try {\n                    log.debug(\"wait...\");\n                    this.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n \n    // 6. å½’è¿˜è¿æ¥\n    public void free(Connection conn) {\n        for (int i = 0; i \u003c poolSize; i++) {\n            if (connections[i] == conn) {\n                states.set(i, 0);\n                synchronized (this) {\n                    log.debug(\"free {}\", conn);\n                    this.notifyAll();\n                }\n                break;\n            }\n        }\n    }\n}\n \nclass MockConnection implements Connection {\n  // å®ç°ç•¥\n}\n```\n\nä½¿ç”¨ï¼š\n\n```java\nPool pool = new Pool(2);\nfor (int i = 0; i \u003c 5; i++) {\n    new Thread(() -\u003e {\n        Connection conn = pool.borrow();\n        try {\n            Thread.sleep(new Random().nextInt(1000));\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        pool.free(conn);\n    }).start();\n}\n```\n\ncasæ“ä½œé€‚åˆçŸ­æ—¶é—´è¿è¡Œçš„ä»£ç ç‰‡æ®µï¼Œæ“ä½œæ•°æ®åº“å¯èƒ½æ—¶é—´æ¯”è¾ƒé•¿ï¼Œé€‚åˆç”¨synchronizedé…åˆwaitæ¥é˜»å¡çº¿ç¨‹ã€‚\n\nä»¥ä¸Šå®ç°æ²¡æœ‰è€ƒè™‘ï¼š\n- è¿æ¥çš„åŠ¨æ€å¢é•¿ä¸æ”¶ç¼©\n- è¿æ¥ä¿æ´»ï¼ˆå¯ç”¨æ€§æ£€æµ‹ï¼‰\n- ç­‰å¾…è¶…æ—¶å¤„ç†\n- åˆ†å¸ƒå¼ hash\n\n\u003eå¯¹äºå…³ç³»å‹æ•°æ®åº“ï¼Œæœ‰æ¯”è¾ƒæˆç†Ÿçš„è¿æ¥æ± å®ç°ï¼Œä¾‹å¦‚c3p0, druidç­‰ å¯¹äºæ›´é€šç”¨çš„å¯¹è±¡æ± ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨apache commons poolï¼Œä¾‹å¦‚redisè¿æ¥æ± å¯ä»¥å‚è€ƒjedisä¸­å…³äºè¿æ¥æ± çš„å®ç°ã€‚\n\u003etomcatçš„è¿æ¥æ± ç›¸å¯¹ç®€å•ï¼Œå¯ä»¥é˜…è¯»ä¸€ä¸‹æºç ã€‚\n\n### ç®€åŒ–æ•°æ®åº“è¿æ¥æ± \n\nä½¿ç”¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/Semaphore#ç®€åŒ–è¿æ¥æ± |Semaphore]]ã€‚\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BF%9D%E6%8A%A4%E6%80%A7%E6%9A%82%E5%81%9C":{"title":"ä¿æŠ¤æ€§æš‚åœ","content":"\n# ä¿æŠ¤æ€§æš‚åœ\n\n## åŸºæœ¬å®ç°\n\nGuarded Suspensionï¼šç”¨äºä¸€ä¸ª[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œåªé€‚ç”¨äºäº§ç”Ÿ**ä¸€ä¸ª**æ¶ˆæ¯çš„æƒ…å†µã€‚\n\n- æœ‰ä¸€ä¸ªç»“æœéœ€è¦ä»ä¸€ä¸ªçº¿ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè®©ä»–ä»¬å…³è”åŒä¸€ä¸ª GuardedObjectã€‚\n- å¦‚æœæœ‰ç»“æœä¸æ–­ä»ä¸€ä¸ªçº¿ç¨‹åˆ°å¦ä¸€ä¸ªçº¿ç¨‹é‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆè§ç”Ÿäº§è€…/æ¶ˆè´¹è€…ï¼‰ã€‚\n- JDK ä¸­ï¼Œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/join|join]] çš„å®ç°ã€Future çš„å®ç°ï¼Œé‡‡ç”¨çš„å°±æ˜¯æ­¤æ¨¡å¼ã€‚\n- å› ä¸ºè¦ç­‰å¾…å¦ä¸€æ–¹çš„ç»“æœï¼Œå› æ­¤å½’ç±»åˆ°[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/åŒæ­¥|åŒæ­¥]]æ¨¡å¼ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220528230352.png]]\n\n\u003e äº§ç”Ÿç»“æœçš„çº¿ç¨‹å’Œæ¶ˆè´¹ç»“æœçš„çº¿ç¨‹è¦ä¸€ä¸€å¯¹åº”ã€‚\n\n### å®ç°\n\n```java\n@Slf4j  \npublic class Test10GuardedSuspention {  \n    public static void main(String[] args) {  \n        // T1 ç­‰å¾… T2 ä¸‹è½½ç»“æœ  \n        GuardedObj go = new GuardedObj();  \n        new Thread(()-\u003e{  \n            log.debug(\"ç­‰å¾…ç»“æœ\");  \n            go.get();  \n            log.debug(\"ä¸‹è½½å®Œæˆ\");  \n        }).start();  \n  \n        new Thread(()-\u003e{  \n            log.debug(\"å¼€å§‹ä¸‹è½½\");  \n            try {  \n                go.complate(Downloader.download());  \n            } catch (IOException e) {  \n                throw new RuntimeException(e);  \n            }  \n        }).start();  \n    }  \n}  \n  \nclass GuardedObj {  \n    private Object response;  \n\n    // è·å–ç»“æœï¼Œt1è°ƒç”¨  \n    public Object get(long millis) {  \n        synchronized (this) {  \n            // 1) è®°å½•æœ€åˆæ—¶é—´  \n            long begin = System.currentTimeMillis();  \n            // 2) å·²ç»ç»å†çš„æ—¶é—´  \n            long timePassed = 0;  \n  \n            // ç”¨å¾ªç¯æ˜¯å› ä¸ºè¦åˆ¤æ–­æ˜¯å¦è™šå‡å”¤é†’  \n            // åˆ¤æ–­ä¸œè¥¿æœ‰æ²¡æœ‰åˆ°\n            while (response == null) {  \n                // 4) å‡è®¾ millis æ˜¯ 1000ï¼Œç»“æœåœ¨ 400 æ—¶å”¤é†’äº†ï¼Œé‚£ä¹ˆè¿˜æœ‰ 600 è¦ç­‰  \n                long waitTime = millis-timePassed;  \n                if (waitTime\u003c=0)  \n                    break;  \n                // ç­‰å¾…ç»“æœ  \n                try {  \n                    this.wait(waitTime);  \n                } catch (InterruptedException e) {  \n                    e.printStackTrace();  \n                }  \n                // æ›´æ–°ç»è¿‡çš„æ—¶é—´  \n                timePassed = System.currentTimeMillis()-begin;  \n            }  \n            return response;  \n        }  \n    }  \n  \n    // äº§ç”Ÿç»“æœ ï¼Œt2è°ƒç”¨\n    public void complate(Object response) {  \n        synchronized (this) {  \n            // ç»™æˆå‘˜å˜é‡èµ‹å€¼  \n            this.response = response;  \n            this.notify();  \n        }  \n    }  \n}  \n  \nclass Downloader {  \n    public static List\u003cString\u003e download() throws IOException {  \n        List\u003cString\u003e lines = new ArrayList\u003c\u003e();  \n        HttpURLConnection conn = (HttpURLConnection) new URL(\"https://www.baidu.com/\").openConnection();  \n        BufferedReader reader = new BufferedReader(new InputStreamReader(conn.getInputStream(), StandardCharsets.UTF_8));  \n        String line;  \n        while ((line = reader.readLine())!=null)  \n            lines.add(line);  \n        return lines;  \n    }  \n}\n```\n\n### ä¸joinæ–¹æ¡ˆç›¸æ¯”\n\n- T2å®Œæˆä»»åŠ¡åå¯ä»¥æ‰§è¡Œå…¶å®ƒä»»åŠ¡ï¼Œè€Œjoinæ–¹æ¡ˆä¸‹è½½å™¨ä¸‹è½½å®Œæˆåªèƒ½ç­‰å¾…T1æ‰§è¡Œå®Œæˆã€‚\n- joinå¿…é¡»å€ŸåŠ©å…¨å±€å˜é‡ä¼ é€’ç»“æœï¼Œè€Œæœ¬æ–¹æ¡ˆç»“æœéƒ½æ˜¯å±€éƒ¨çš„ã€‚\n\n## å¢å¼ºå®ç°\n\nå¤šä»»åŠ¡ç‰ˆã€‚\n\n### å®ç°\n\n![[z-oblib/z2-attachments/Pasted image 20220529142327.png]]\n\nå›¾ä¸­ Futures å°±å¥½æ¯”å±…æ°‘æ¥¼ä¸€å±‚çš„ä¿¡ç®±ï¼ˆæ¯ä¸ªä¿¡ç®±æœ‰æˆ¿é—´ç¼–å·ï¼‰ï¼Œå·¦ä¾§çš„ t0ï¼Œt2ï¼Œt4 å°±å¥½æ¯”ç­‰å¾…é‚®ä»¶çš„å±…æ°‘ï¼Œå³ä¾§çš„ t1ï¼Œt3ï¼Œt5 å°±å¥½æ¯”é‚®é€’å‘˜ã€‚\nå¦‚æœéœ€è¦åœ¨å¤šä¸ªç±»ä¹‹é—´ä½¿ç”¨ GuardedObject å¯¹è±¡ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› æ­¤è®¾è®¡ä¸€ä¸ªç”¨æ¥è§£è€¦çš„ä¸­é—´ç±»ï¼Œè¿™æ ·ä¸ä»…èƒ½å¤Ÿè§£è€¦ã€ç»“æœç­‰å¾…è€…ã€‘å’Œã€ç»“æœç”Ÿäº§è€…ã€‘ï¼Œè¿˜èƒ½å¤ŸåŒæ—¶æ”¯æŒå¤šä¸ªä»»åŠ¡çš„ç®¡ç†ã€‚\n\n```java\npackage test;  \n  \nimport lombok.extern.slf4j.Slf4j;  \n  \nimport java.io.BufferedReader;  \nimport java.io.IOException;  \nimport java.io.InputStreamReader;  \nimport java.net.HttpURLConnection;  \nimport java.net.URL;  \nimport java.nio.charset.StandardCharsets;  \nimport java.util.*;  \n  \n@Slf4j  \npublic class Test10GuardedSuspention {  \n    public static void main(String[] args) throws InterruptedException {  \n        for (int i=0; i\u003c3; i++) {  \n            new People().start();  \n        }  \n        Thread.sleep(3000);  // ç­‰çš„æ—¶é—´å¤ªçŸ­ä¼šå¯¼è‡´è¿­ä»£å™¨éƒ¨åˆ†å¹¶å‘é”™è¯¯  \n        for (Integer id : MailBoxes.getIds()) {  \n            log.debug(\"å«å‡ºé‚®é€’å‘˜{}\", id);  \n            new Postman(id, \"||å†…å®¹\" + id).start();  \n        }  \n    }  \n}  \n  \n@Slf4j  \nclass People extends Thread {  \n    @Override  \n    public void run() {  \n        // æ”¶ä»¶äººåˆ›å»ºé‚®ç®±  \n        GuardedObj go = MailBoxes.createGuardedObj();  \n        log.debug(\"å¼€å§‹æ”¶ä¿¡{}\", go.getId());  \n        // è¶…æ—¶ç­‰å¾…æ”¶ä¿¡  \n        Object mail = go.get(5000);  \n        if (mail!=null)  \n            log.debug(\"æ”¶åˆ°äº†{},å†…å®¹{}\", go.getId(), mail);  \n        else            log.debug(\"{}è¶…æ—¶æœªæ”¶åˆ°\", go.getId());  \n    }  \n}  \n  \n@Slf4j  \nclass Postman extends Thread {  \n    private int id;  \n    private String mail;  \n  \n    public Postman(int id, String mail) {  \n        this.id = id;  \n        this.mail = mail;  \n    }  \n  \n    @Override  \n    public void run() {  \n        GuardedObj go = MailBoxes.getGuardedObj(id);  \n        log.debug(\"å¾€{}é€ä¿¡ï¼Œå†…å®¹{}\", id, mail);  \n        go.complate(mail);  \n    }  \n}  \n  \n// ç±»ä¼¼èœ‚å·¢å¿«é€’æŸœ  \n@Slf4j  \nclass MailBoxes {  \n    private static Map\u003cInteger, GuardedObj\u003e box = new Hashtable\u003c\u003e();  // HashTableçº¿ç¨‹å®‰å…¨ï¼ŒHashMapçº¿ç¨‹ä¸å®‰å…¨  \n    private static int id = 1;  \n  \n    // äº§ç”Ÿå”¯ä¸€ID  \n    private static synchronized int generateId() {  \n        return id++;  \n    }  \n  \n    public static GuardedObj createGuardedObj() {  \n        GuardedObj go = new GuardedObj(generateId());  \n        box.put(go.getId(), go);  \n        return go;  \n    }  \n    public static Set\u003cInteger\u003e getIds() {  \n        log.debug(\"{}\",box.size());  \n        return box.keySet();  \n    }  \n  \n    // å¿«é€’æŸœä½ å–å®Œå¿«é€’è¦æŠŠæ ¼å­é‡Šæ”¾å‡ºå»  \n    public static GuardedObj getGuardedObj(int id) {  \n        return box.remove(id);  \n    }  \n}  \n  \nclass GuardedObj {  \n    private Object response;  \n    private int id;  \n  \n    public int getId() {  \n        return id;  \n    }  \n  \n    public GuardedObj(int id) {  \n        this.id = id;  \n    }  \n  \n    // è·å–ç»“æœ  \n    public Object get(long millis) {  \n        synchronized (this) {  \n            // 1) è®°å½•æœ€åˆæ—¶é—´  \n            long begin = System.currentTimeMillis();  \n            // 2) å·²ç»ç»å†çš„æ—¶é—´  \n            long timePassed = 0;  \n            // åˆ¤æ–­æ˜¯å¦è™šå‡å”¤é†’  \n            while (response == null) {  \n                // 4) å‡è®¾ millis æ˜¯ 1000ï¼Œç»“æœåœ¨ 400 æ—¶å”¤é†’äº†ï¼Œé‚£ä¹ˆè¿˜æœ‰ 600 è¦ç­‰  \n                long waitTime = millis-timePassed;  \n                if (waitTime\u003c=0)  \n                    break;  \n                // ç­‰å¾…ç»“æœ  \n                try {  \n                    this.wait(waitTime);  \n                } catch (InterruptedException e) {  \n                    e.printStackTrace();  \n                }  \n                // æ›´æ–°ç»è¿‡çš„æ—¶é—´  \n                timePassed = System.currentTimeMillis()-begin;  \n            }  \n            return response;  \n        }  \n    }  \n  \n    // äº§ç”Ÿç»“æœ  \n    public void complate(Object response) {  \n        synchronized (this) {  \n            // ç»™æˆå‘˜å˜é‡èµ‹å€¼  \n            this.response = response;  \n            this.notify();  \n        }  \n    }  \n}  \n  \nclass Downloader {  \n    public static List\u003cString\u003e download() throws IOException {  \n        List\u003cString\u003e lines = new ArrayList\u003c\u003e();  \n        HttpURLConnection conn = (HttpURLConnection) new URL(\"https://www.baidu.com/\").openConnection();  \n        BufferedReader reader = new BufferedReader(new InputStreamReader(conn.getInputStream(), StandardCharsets.UTF_8));  \n        String line;  \n        while ((line = reader.readLine())!=null)  \n            lines.add(line);  \n        return lines;  \n    }  \n}\n```\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F":{"title":"å•ä¾‹æ¨¡å¼","content":"\n# å•ä¾‹æ¨¡å¼\n\n## çº¿ç¨‹å®‰å…¨çš„å®ç°\n\n### æ‡’æ±‰å¼ï¼š\n\n[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/Balking|balking]]æ¨¡å¼ï¼š\n\n```java\npublic final class Singleton {\n    private Singleton() {\n    }\n \n    private static Singleton INSTANCE = null;\n \n    public static synchronized Singleton getInstance() {\n        if (INSTANCE == null) {\n\t        INSTANCE = new Singleton();\n        }\n        return INSTANCE;\n    }\n}\n```\n\n### åŒé‡æ ¡éªŒé”\n\n\u003eç”±æ‡’æ±‰æ¨¡å¼æ”¹è¿›\n\n#### å­˜åœ¨é—®é¢˜ç‰ˆ\n\nå¯ä»¥å‘ç°ä¸Šé¢çš„å®ç°é™¤äº†ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡å¿…é¡»è¦é”ï¼Œåç»­åªè¦ç®€å•åˆ¤æ–­æ ‡å¿—ä½å³å¯ï¼Œæ‰€ä»¥å¤–é¢å¤šåŠ ä¸€å±‚åˆ¤æ–­æ ‡å¿—ï¼Œé˜²æ­¢åç»­ä¸å¿…è¦çš„é”æ“ä½œï¼š\n\n```java\npublic final class Singleton {\n    private Singleton() {\n    }\n \n    private static Singleton INSTANCE = null;\n \n    public static Singleton getInstance() {\n\t    // é¦–æ¬¡è®¿é—®ä¼š[[2_0_2-è®¡ç®—æœºç§‘å­¦/2_0_2_1_2_3-è½¯ä»¶ç³»ç»Ÿ/2_0_2_1_2_3_1-æ“ä½œç³»ç»Ÿ/åŒæ­¥|åŒæ­¥]]ï¼Œä½†ä¹‹åçš„è®¿é—®å°±æ²¡æœ‰synchronized\n        if(INSTANCE == null) {\n\t        synchronized(Singleton.class) {\n\t\t        if (INSTANCE == null) {\n\t\t            INSTANCE = new Singleton();\n\t\t        }\n\t        }\n        }\n        return INSTANCE;\n    }\n}\n```\n\n\u003eç†è§£ä¸Šæ¥è¯´ï¼Œæœ€å¤–å±‚çš„åˆ¤æ–­æ‰æ˜¯ååŠ çš„ï¼ŒåŒé‡æ ¡éªŒé”æ˜¯ç”±æ‡’æ±‰æ¨¡å¼è¿›åŒ–è€Œæ¥ã€‚\n\n##### é—®é¢˜åˆ†æ\n\nå¯¹åº”jvmå­—èŠ‚ç ï¼š\n\n```java\n0: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n3: ifnonnull     37\n6: ldc           #3                  // class cn/itcast/n5/Singleton\n8: dup\n9: astore_0\n10: monitorenter\n11: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n14: ifnonnull     27\n17: new           #3                  // class cn/itcast/n5/Singleton\n20: dup\n21: invokespecial #4                  // Method \"\u003cinit\u003e\":()V\n24: putstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n27: aload_0\n28: monitorexit\n29: goto          37\n32: astore_1\n33: aload_0\n34: monitorexit\n35: aload_1\n36: athrow\n37: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n40: areturn\n```\n\n- 17 è¡¨ç¤ºåˆ›å»ºå¯¹è±¡ï¼Œå°†å¯¹è±¡å¼•ç”¨å…¥æ ˆ  // new Singleton\n- 20 è¡¨ç¤ºå¤åˆ¶ä¸€ä»½å¯¹è±¡å¼•ç”¨  // å¼•ç”¨åœ°å€\n- 21 è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œè°ƒç”¨æ„é€ æ–¹æ³• \n- 24 è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œèµ‹å€¼ç»™ static INSTANCE\nä¹Ÿè®¸ jvm ä¼šä¼˜åŒ–ä¸ºï¼šå…ˆæ‰§è¡Œ 24ï¼Œå†æ‰§è¡Œ 21ã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹ t1ï¼Œt2 æŒ‰å¦‚ä¸‹æ—¶é—´åºåˆ—æ‰§è¡Œï¼š\n![[z-oblib/z2-attachments/Pasted image 20220531152646.png]]\n\n\nå¤–å±‚ifåœ¨[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/synchronized|synchronized]]ä¹‹å¤–ï¼Œä¸å—ä¿æŠ¤ï¼Œå¹¶ä¸”å¯¹è±¡å¯èƒ½å…ˆäº§ç”Ÿåœ°å€å†è¢«åˆå§‹åŒ–ï¼Œå¯¼è‡´å¤–å±‚ifå¯èƒ½è¯»åˆ°æœªåˆå§‹åŒ–çš„å¯¹è±¡ï¼š\n\nå…³é”®åœ¨äº 0: getstatic è¿™è¡Œä»£ç åœ¨ monitor æ§åˆ¶ä¹‹å¤–ï¼Œå®ƒå°±åƒä¹‹å‰ä¸¾ä¾‹ä¸­ä¸å®ˆè§„åˆ™çš„äººï¼Œå¯ä»¥è¶Šè¿‡ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/monitor|monitor]] è¯»å–INSTANCE å˜é‡çš„å€¼ã€‚\nè¿™æ—¶ t1 è¿˜æœªå®Œå…¨å°†æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­è¦æ‰§è¡Œå¾ˆå¤šåˆå§‹åŒ–æ“ä½œï¼Œé‚£ä¹ˆ t2 æ‹¿åˆ°çš„æ˜¯å°†æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæ¯•çš„å•ä¾‹ã€‚\nå¯¹ INSTANCE ä½¿ç”¨ volatile ä¿®é¥°å³å¯ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æ’ï¼Œä½†è¦æ³¨æ„åœ¨ JDK 5 ä»¥ä¸Šçš„ç‰ˆæœ¬çš„ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/volatile|volatile]] æ‰ä¼šçœŸæ­£æœ‰æ•ˆã€‚\n\n#### æ”¹è¿›ç‰ˆ\n\né€šè¿‡volatileä¿è¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/å¯è§æ€§|å¯è§æ€§]]å’Œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/æœ‰åºæ€§|æœ‰åºæ€§]]ã€‚\n\n```java\npublic final class Singleton {\n    private Singleton() { }\n    private static volatile Singleton INSTANCE = null;\n    public static Singleton getInstance() {\n        // å®ä¾‹æ²¡åˆ›å»ºï¼Œæ‰ä¼šè¿›å…¥å†…éƒ¨çš„ synchronizedä»£ç å—\n        if (INSTANCE == null) {            \n            synchronized (Singleton.class) { // t2\n                // ä¹Ÿè®¸æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®ä¾‹ï¼Œæ‰€ä»¥å†åˆ¤æ–­ä¸€æ¬¡\n                if (INSTANCE == null) { // t1\n                    INSTANCE = new Singleton();\n                }\n            }\n        }\n        return INSTANCE;\n    }\n}\n```\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B":{"title":"å·¥ä½œçº¿ç¨‹","content":"\n# å·¥ä½œçº¿ç¨‹\n\n## å®šä¹‰\n\nè®©æœ‰é™çš„å·¥ä½œ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/çº¿ç¨‹|çº¿ç¨‹]]ï¼ˆWorker Threadï¼‰æ¥è½®æµ[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å¼‚æ­¥|å¼‚æ­¥]]å¤„ç†æ— é™å¤šçš„ä»»åŠ¡ã€‚ä¹Ÿå¯ä»¥å°†å…¶å½’ç±»ä¸ºåˆ†å·¥æ¨¡å¼ï¼Œå®ƒçš„å…¸å‹å®ç° å°±æ˜¯[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± |çº¿ç¨‹æ± ]]ï¼Œä¹Ÿä½“ç°äº†ç»å…¸è®¾è®¡æ¨¡å¼ä¸­çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/äº«å…ƒæ¨¡å¼|äº«å…ƒæ¨¡å¼]]ã€‚\n\nä¾‹å¦‚ï¼Œæµ·åº•æçš„æœåŠ¡å‘˜ï¼ˆçº¿ç¨‹ï¼‰ï¼Œè½®æµå¤„ç†æ¯ä½å®¢äººçš„ç‚¹é¤ï¼ˆä»»åŠ¡ï¼‰ï¼Œå¦‚æœä¸ºæ¯ä½å®¢äººéƒ½é…ä¸€åä¸“å±çš„æœåŠ¡å‘˜ï¼Œé‚£ä¹ˆæˆæœ¬å°±å¤ªé«˜äº†ï¼ˆå¯¹æ¯”å¦ä¸€ç§å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼ï¼šThread-Per-Messageï¼‰ã€‚\n\næ³¨æ„ï¼Œä¸åŒä»»åŠ¡ç±»å‹åº”è¯¥ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼Œè¿™æ ·èƒ½å¤Ÿé¿å…[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å·¥ä½œçº¿ç¨‹#é¥¥é¥¿|é¥¥é¥¿]]ï¼Œå¹¶èƒ½æå‡æ•ˆç‡ã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªé¤é¦†çš„å·¥äººæ—¢è¦æ‹›å‘¼å®¢äººï¼ˆä»»åŠ¡ç±»å‹Aï¼‰ï¼Œåˆè¦åˆ°åå¨åšèœï¼ˆä»»åŠ¡ç±»å‹Bï¼‰æ˜¾ç„¶æ•ˆç‡ä¸å’‹åœ°ï¼Œåˆ†æˆæœåŠ¡å‘˜ï¼ˆçº¿ç¨‹æ± Aï¼‰ä¸å¨å¸ˆï¼ˆçº¿ç¨‹æ± Bï¼‰æ›´ä¸ºåˆç†ï¼Œå½“ç„¶ä½ èƒ½æƒ³åˆ°æ›´ç»†è‡´çš„åˆ†å·¥ã€‚\n\n## é¥¥é¥¿\n\n**å›ºå®šå¤§å°**çº¿ç¨‹æ± ä¼šæœ‰é¥¥é¥¿ç°è±¡ï¼š\n- ä¸¤ä¸ªå·¥äººæ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ± ä¸­çš„ä¸¤ä¸ªçº¿ç¨‹\n- ä»–ä»¬è¦åšçš„äº‹æƒ…æ˜¯ï¼šä¸ºå®¢äººç‚¹é¤å’Œåˆ°åå¨åšèœï¼Œè¿™æ˜¯ä¸¤ä¸ªé˜¶æ®µçš„å·¥ä½œ\n\t- å®¢äººç‚¹é¤ï¼šå¿…é¡»å…ˆç‚¹å®Œé¤ï¼Œç­‰èœåšå¥½ï¼Œä¸Šèœï¼Œåœ¨æ­¤æœŸé—´å¤„ç†ç‚¹é¤çš„å·¥äººå¿…é¡»ç­‰å¾…\n\t- åå¨åšèœï¼šæ²¡å•¥è¯´çš„ï¼Œåšå°±æ˜¯äº†\n- æ¯”å¦‚å·¥äººA å¤„ç†äº†ç‚¹é¤ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥å®ƒè¦ç­‰ç€ å·¥äººB æŠŠèœåšå¥½ï¼Œç„¶åä¸Šèœï¼Œä»–ä¿©ä¹Ÿé…åˆçš„è›®å¥½\n- ä½†ç°åœ¨åŒæ—¶æ¥äº†ä¸¤ä¸ªå®¢äººï¼Œè¿™ä¸ªæ—¶å€™å·¥äººA å’Œå·¥äººB éƒ½å»å¤„ç†ç‚¹é¤äº†ï¼Œè¿™æ—¶æ²¡äººåšé¥­äº†ï¼Œé¥¥é¥¿\n\n```java\npublic class TestDeadLock {\n \n    static final List\u003cString\u003e MENU = Arrays.asList(\"åœ°ä¸‰é²œ\", \"å®«ä¿é¸¡ä¸\", \"è¾£å­é¸¡ä¸\", \"çƒ¤é¸¡ç¿…\");\n    static Random RANDOM = new Random();\n    static String cooking() {\n        return MENU.get(RANDOM.nextInt(MENU.size()));\n    }\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newFixedThreadPool(2);\n \n        executorService.execute(() -\u003e {\n            log.debug(\"å¤„ç†ç‚¹é¤...\");\n            Future\u003cString\u003e f = executorService.submit(() -\u003e {\n                log.debug(\"åšèœ\");\n                return cooking();\n            });\n            try {\n                log.debug(\"ä¸Šèœ: {}\", f.get());\n            } catch (InterruptedException | ExecutionException e) {\n                e.printStackTrace();\n            }\n        });\n        /*executorService.execute(() -\u003e {\n            log.debug(\"å¤„ç†ç‚¹é¤...\");\n            Future\u003cString\u003e f = executorService.submit(() -\u003e {\n                log.debug(\"åšèœ\");\n                return cooking();\n            });\n            try {\n                log.debug(\"ä¸Šèœ: {}\", f.get());\n            } catch (InterruptedException | ExecutionException e) {\n            e.printStackTrace();\n            }\n        });*/\n \n    }\n}\n```\n\nä¸Šè¿°ä»£ç ä¸­ä¸€ä¸ªçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ—¢è¦å¤„ç†ç‚¹èœä¸Šèœï¼Œåˆè¦å¤„ç†åšèœï¼Œå¯¼è‡´çº¿ç¨‹æ•°å¯èƒ½ä¸å¤Ÿé€ æˆé¥¥é¥¿ã€‚\n\nè§£å†³æ–¹æ³•å¯ä»¥å¢åŠ çº¿ç¨‹æ± çš„å¤§å°ï¼Œä¸è¿‡ä¸æ˜¯æ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯å‰é¢æåˆ°çš„ï¼Œä¸åŒçš„ä»»åŠ¡ç±»å‹ï¼Œé‡‡ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼Œä¾‹å¦‚ï¼š\n\n```java\npublic class TestDeadLock {\n \n    static final List\u003cString\u003e MENU = Arrays.asList(\"åœ°ä¸‰é²œ\", \"å®«ä¿é¸¡ä¸\", \"è¾£å­é¸¡ä¸\", \"çƒ¤é¸¡ç¿…\");\n    static Random RANDOM = new Random();\n    static String cooking() {\n        return MENU.get(RANDOM.nextInt(MENU.size()));\n    }\n    public static void main(String[] args) {\n\t    // åˆ†åˆ«åˆ›å»ºä¸¤ä¸ªä¸åŒåŠŸèƒ½çš„çº¿ç¨‹æ± \n\t    // ä¸“é—¨è´Ÿè´£ä¸Šèœç‚¹èœ\n        ExecutorService waiterPool = Executors.newFixedThreadPool(1);\n        // ä¸“é—¨è´Ÿè´£åšèœ\n        ExecutorService cookPool = Executors.newFixedThreadPool(1);\n \n        waiterPool.execute(() -\u003e {\n            log.debug(\"å¤„ç†ç‚¹é¤...\");\n            // åšèœäº¤ç»™ä¸“é—¨çš„å¨å¸ˆå»åš\n            Future\u003cString\u003e f = cookPool.submit(() -\u003e {\n                log.debug(\"åšèœ\");\n                return cooking();\n            });\n            try {\n                log.debug(\"ä¸Šèœ: {}\", f.get());\n            } catch (InterruptedException | ExecutionException e) {\n                e.printStackTrace();\n            }\n        });\n        waiterPool.execute(() -\u003e {\n            log.debug(\"å¤„ç†ç‚¹é¤...\");\n            Future\u003cString\u003e f = cookPool.submit(() -\u003e {\n                log.debug(\"åšèœ\");\n                return cooking();\n            });\n            try {\n\t            log.debug(\"ä¸Šèœ: {}\", f.get());\n            } catch (InterruptedException | ExecutionException e) {\n                e.printStackTrace();\n            }\n        });\n \n \n    }\n}\n```\n\n## åˆ›å»ºå¤šå°‘çº¿ç¨‹æ± åˆé€‚\n\n- è¿‡å°ä¼šå¯¼è‡´ç¨‹åºä¸èƒ½å……åˆ†åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€å®¹æ˜“å¯¼è‡´é¥¥é¥¿ã€‚\n- è¿‡å¤§ä¼šå¯¼è‡´æ›´å¤šçš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå ç”¨æ›´å¤šå†…å­˜ã€‚\n\n### CPUå¯†é›†å‹\n\né€šå¸¸é‡‡ç”¨ cpu æ ¸æ•° **+ 1** èƒ½å¤Ÿå®ç°æœ€ä¼˜çš„ CPU åˆ©ç”¨ç‡ï¼Œ+1 æ˜¯ä¿è¯å½“çº¿ç¨‹ç”±äºé¡µç¼ºå¤±æ•…éšœï¼ˆæ“ä½œç³»ç»Ÿï¼‰æˆ–å…¶å®ƒåŸå›  å¯¼è‡´æš‚åœæ—¶ï¼Œé¢å¤–çš„è¿™ä¸ªçº¿ç¨‹å°±èƒ½é¡¶ä¸Šå»ï¼Œä¿è¯ CPU æ—¶é’Ÿå‘¨æœŸä¸è¢«æµªè´¹ã€‚\n\n### IOå¯†é›†å‹\n\nCPU ä¸æ€»æ˜¯å¤„äºç¹å¿™çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œå½“ä½ æ‰§è¡Œä¸šåŠ¡è®¡ç®—æ—¶ï¼Œè¿™æ—¶å€™ä¼šä½¿ç”¨ CPU èµ„æºï¼Œä½†å½“ä½ æ‰§è¡Œ I/O æ“ä½œæ—¶ã€è¿œç¨‹ RPC è°ƒç”¨æ—¶ï¼ŒåŒ…æ‹¬è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™ CPU å°±é—²ä¸‹æ¥äº†ï¼Œä½ å¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹æé«˜å®ƒçš„åˆ©ç”¨ç‡ã€‚\n\nç»éªŒå…¬å¼å¦‚ä¸‹\nçº¿ç¨‹æ•° = æ ¸æ•° * æœŸæœ› CPU åˆ©ç”¨ç‡ * æ€»æ—¶é—´(CPUè®¡ç®—æ—¶é—´+ç­‰å¾…æ—¶é—´) / CPU è®¡ç®—æ—¶é—´\nä¾‹å¦‚ 4 æ ¸ CPU è®¡ç®—æ—¶é—´æ˜¯ 50% ï¼Œå…¶å®ƒç­‰å¾…æ—¶é—´æ˜¯ 50%ï¼ŒæœŸæœ› cpu è¢« 100% åˆ©ç”¨ï¼Œå¥—ç”¨å…¬å¼\n\n4 * 100% * (100% / 50%) = 8\n\nä¾‹å¦‚ 4 æ ¸ CPU è®¡ç®—æ—¶é—´æ˜¯ 10% ï¼Œå…¶å®ƒç­‰å¾…æ—¶é—´æ˜¯ 90%ï¼ŒæœŸæœ› cpu è¢« 100% åˆ©ç”¨ï¼Œå¥—ç”¨å…¬å¼\n\n4 * 100% * (100% / 10%) = 40\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F":{"title":"å·¥å‚æ¨¡å¼","content":"\n# å·¥å‚æ¨¡å¼\n\n## ä½œç”¨\n\næŠŠå¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨è¿‡ç¨‹åˆ†å‰²å¼€æ¥ï¼š\nå°†å¯¹è±¡å®ä¾‹åŒ–çš„åŠ¨ä½œè§£è€¦åˆ°ä¸€ä¸ªå·¥å‚ä¸­ï¼Œåç»­è¦ä¿®æ”¹æˆ–æ·»åŠ å…¶å®ƒå®ä¾‹ï¼Œåªéœ€è¦ä¿®æ”¹å·¥å‚æ–¹æ³•ã€‚\n\nä¾‹å¦‚ï¼š\n\nå¦‚æœå¯¹ç±»Açš„åŠŸèƒ½è¿›è¡Œä¿®æ”¹ï¼Œè¡ç”Ÿå‡ºå­ç±»Bç»§æ‰¿è‡ªåŸå§‹ç±»Aï¼Œåˆ™éœ€è¦åœ¨æ‰€æœ‰å®ä¾‹åŒ–Açš„åœ°æ–¹ä¿®æ”¹å®ä¾‹åŒ–ä»£ç ã€‚\n\nè€Œæœ‰å·¥å‚æ–¹æ³•åï¼Œåªéœ€è¦ä¿®æ”¹å·¥å‚ä¸­çš„äº‹ä»¶ï¼Œå°†åŸæ¥`return new A()` æ”¹ä¸º `return new B()`å³å¯ã€‚\n\n### æ™®é€šå·¥å‚\n\n```java\ninterface fruit{\n    public abstract void eat();\n} \nclass Apple implements fruit{\n     public void eat(){\n         System.out.println(\"Apple\");\n     }\n} \nclass Orange implements fruit{\n     public void eat(){\n         System.out.println(\"Orange\");\n     }\n}\n//æ„é€ å·¥å‚ç±»\n//ä¹Ÿå°±æ˜¯è¯´ä»¥åå¦‚æœæˆ‘ä»¬åœ¨æ·»åŠ å…¶ä»–çš„å®ä¾‹çš„æ—¶å€™\n//åªéœ€è¦ä¿®æ”¹å·¥å‚ç±»å°±è¡Œäº†\nclass Factory{\n     public static fruit getInstance(String fruitName){\n         fruit f=null;\n         if(\"Apple\".equals(fruitName)){\n             f=new Apple();\n         }\n         if(\"Orange\".equals(fruitName)){\n             f=new Orange();\n         }\n         return f;\n     }\n}\nclass hello{\n     public static void main(String[] a){\n         fruit f=Factory.getInstance(\"Orange\");\n         f.eat();\n     }\n}\n```\n\n## ç¼ºç‚¹\n\næ¯æ·»åŠ ä¸€æ¬¡å­ç±»ï¼Œå°±éœ€è¦ä¿®æ”¹ä¸€æ¬¡å·¥å‚ç±»ï¼Œå¦‚æœå­ç±»è¿‡å¤šï¼Œå·¥å‚ç±»ä¼šååˆ†ç¹æ‚ï¼Œä¸åˆ©äºç»´æŠ¤ã€‚\n\n## å€ŸåŠ©JAVAåå°„ä¼˜åŒ–\n\n\u003eæ®ç»™å‡ºçš„ç±»åï¼ˆå­—ç¬¦ä¸²æ–¹å¼ï¼‰æ¥åŠ¨æ€åœ°ç”Ÿæˆå¯¹è±¡ï¼Œè¿™ç§ç¼–ç¨‹æ–¹å¼å¯ä»¥è®©å¯¹è±¡åœ¨ç”Ÿæˆæ—¶æ‰è¢«å†³å®šåˆ°åº•æ˜¯å“ªä¸€ç§å¯¹è±¡ã€‚\n\né€šè¿‡ç»Ÿä¸€çš„åå°„æ–¹æ³•ç”Ÿæˆå¯¹è±¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ä»£ç å†™æ­»ã€‚ä½¿ç”¨æ—¶åªéœ€è¦ä¼ å…¥å¯¹åº”çš„ç±»è·¯å¾„ï¼Œåå°„ä¼šå¸®æˆ‘ä»¬ç”Ÿæˆå¯¹è±¡ã€‚\n\n### ç»“åˆåå°„æ¨¡æ‹Ÿå®ç°Springçš„IOC\n\n```java\ninterface fruit{\n    public abstract void eat();\n}\nclass Apple implements fruit{\n    public void eat(){\n        System.out.println(\"Apple\");\n    }\n}\nclass Orange implements fruit{\n    public void eat(){\n        System.out.println(\"Orange\");\n    }\n}\n//æ“ä½œå±æ€§æ–‡ä»¶ç±»\nclass init{\n    public static Properties getPro() throws Exception{\n        Properties pro=new Properties();\n        File f=new File(\"fruit.properties\");\n        if(f.exists()){\n            pro.load(new FileInputStream(f));\n        }else{\n            pro.setProperty(\"apple\", \"Reflect.Apple\");\n            pro.setProperty(\"orange\", \"Reflect.Orange\");\n            pro.store(new FileOutputStream(f), \"FRUIT CLASS\");\n        }\n        return pro;\n    }\n}\nclass Factory{\n    public static fruit getInstance(String ClassName){\n        fruit f=null;\n        try{\n            f=(fruit)Class.forName(ClassName).newInstance();\n        }catch (Exception e) {\n            e.printStackTrace();\n        }\n        return f;\n    }\n}\nclass hello{\n    public static void main(String[] a) throws Exception{\n        Properties pro=init.getPro();\n        fruit f=Factory.getInstance(pro.getProperty(\"apple\"));\n        if(f!=null){\n            f.eat();\n        }\n    }\n}\n```\n\n### æ€»ç»“\n\nç”±ä»£ç å†™æ­» --\u003e åŠ¨æ€æ”¹å˜ ï¼ˆåŠ¨æ€æ˜¯æŒ‡å¯¹è±¡çš„ç”Ÿæˆç”±å­—ç¬¦ä¸²è¾“å…¥å†³å®šï¼Œè€Œéä»£ç å†™æ­»ï¼‰ã€‚\n\næŠŠIOCå®¹å™¨çš„å·¥ä½œæ¨¡å¼çœ‹åšæ˜¯å·¥å‚æ¨¡å¼çš„å‡åï¼Œå¯ä»¥æŠŠIOCå®¹å™¨çœ‹ä½œæ˜¯ä¸€ä¸ªå·¥å‚ï¼Œè¿™ä¸ªå·¥å‚é‡Œè¦ç”Ÿäº§çš„å¯¹è±¡éƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­ç»™å‡ºå®šä¹‰ï¼Œç„¶ååˆ©ç”¨ç¼–ç¨‹è¯­è¨€æä¾›çš„åå°„æœºåˆ¶ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶ä¸­ç»™å‡ºçš„ç±»åç”Ÿæˆç›¸åº”çš„å¯¹è±¡ã€‚\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F":{"title":"æ¨¡æ¿æ¨¡å¼","content":"\n# æ¨¡æ¿æ¨¡å¼\n\nåœ¨æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰ä¸­ï¼Œä¸€ä¸ªæŠ½è±¡ç±»å…¬å¼€å®šä¹‰äº†æ‰§è¡Œå®ƒçš„æ–¹æ³•çš„æ–¹å¼/æ¨¡æ¿ã€‚å®ƒçš„å­ç±»å¯ä»¥æŒ‰éœ€è¦é‡å†™æ–¹æ³•å®ç°ï¼Œä½†è°ƒç”¨å°†ä»¥æŠ½è±¡ç±»ä¸­å®šä¹‰çš„æ–¹å¼è¿›è¡Œã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚\n\n**æ„å›¾ï¼š** å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚\n\n**ä¸»è¦è§£å†³ï¼š** ä¸€äº›æ–¹æ³•é€šç”¨ï¼Œå´åœ¨æ¯ä¸€ä¸ªå­ç±»éƒ½é‡æ–°å†™äº†è¿™ä¸€æ–¹æ³•ã€‚\n\n**ä½•æ—¶ä½¿ç”¨ï¼š** æœ‰ä¸€äº›é€šç”¨çš„æ–¹æ³•ã€‚\n\n**å¦‚ä½•è§£å†³ï¼š** å°†è¿™äº›é€šç”¨ç®—æ³•æŠ½è±¡å‡ºæ¥ã€‚\n\n**å…³é”®ä»£ç ï¼š** åœ¨æŠ½è±¡ç±»å®ç°ï¼Œå…¶ä»–æ­¥éª¤åœ¨å­ç±»å®ç°ã€‚\n\n**åº”ç”¨å®ä¾‹ï¼š** 1ã€åœ¨é€ æˆ¿å­çš„æ—¶å€™ï¼Œåœ°åŸºã€èµ°çº¿ã€æ°´ç®¡éƒ½ä¸€æ ·ï¼Œåªæœ‰åœ¨å»ºç­‘çš„åæœŸæ‰æœ‰åŠ å£æ©±åŠ æ …æ ç­‰å·®å¼‚ã€‚ 2ã€è¥¿æ¸¸è®°é‡Œé¢è©è¨å®šå¥½çš„ 81 éš¾ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªé¡¶å±‚çš„é€»è¾‘éª¨æ¶ã€‚ 3ã€spring ä¸­å¯¹ Hibernate çš„æ”¯æŒï¼Œå°†ä¸€äº›å·²ç»å®šå¥½çš„æ–¹æ³•å°è£…èµ·æ¥ï¼Œæ¯”å¦‚å¼€å¯äº‹åŠ¡ã€è·å– Sessionã€å…³é—­ Session ç­‰ï¼Œç¨‹åºå‘˜ä¸é‡å¤å†™é‚£äº›å·²ç»è§„èŒƒå¥½çš„ä»£ç ï¼Œç›´æ¥ä¸¢ä¸€ä¸ªå®ä½“å°±å¯ä»¥ä¿å­˜ã€‚\n\n**ä¼˜ç‚¹ï¼š** 1ã€å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚ 2ã€æå–å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚ 3ã€è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç°ã€‚\n\n**ç¼ºç‚¹ï¼š** æ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§ã€‚\n\n**ä½¿ç”¨åœºæ™¯ï¼š** 1ã€æœ‰å¤šä¸ªå­ç±»å…±æœ‰çš„æ–¹æ³•ï¼Œä¸”é€»è¾‘ç›¸åŒã€‚ 2ã€é‡è¦çš„ã€å¤æ‚çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘ä½œä¸ºæ¨¡æ¿æ–¹æ³•ã€‚\n\n**æ³¨æ„äº‹é¡¹ï¼š** ä¸ºé˜²æ­¢æ¶æ„æ“ä½œï¼Œä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®è¯ã€‚\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85":{"title":"ç”Ÿäº§è€…æ¶ˆè´¹è€…","content":"\n# ç”Ÿäº§è€…æ¶ˆè´¹è€…\n\n- ä¸[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ä¿æŠ¤æ€§æš‚åœ|ä¿æŠ¤æ€§æš‚åœ]]ä¸­çš„ GuardObject ä¸åŒï¼Œä¸éœ€è¦äº§ç”Ÿç»“æœå’Œæ¶ˆè´¹ç»“æœçš„çº¿ç¨‹ä¸€ä¸€å¯¹åº”ã€‚\n- æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§å¼‚æ­¥çš„æ¨¡å¼ï¼Œæ¶ˆæ¯ç”Ÿäº§å‡ºæ¥ä¸ä¸€å®šè¢«ç«‹åˆ»æ¶ˆè´¹ã€‚\n- æ¶ˆè´¹é˜Ÿåˆ—å¯ä»¥ç”¨æ¥å¹³è¡¡ç”Ÿäº§å’Œæ¶ˆè´¹çš„çº¿ç¨‹èµ„æºã€‚\n- ç”Ÿäº§è€…ä»…è´Ÿè´£äº§ç”Ÿç»“æœæ•°æ®ï¼Œä¸å…³å¿ƒæ•°æ®è¯¥å¦‚ä½•å¤„ç†ï¼Œè€Œæ¶ˆè´¹è€…ä¸“å¿ƒå¤„ç†ç»“æœæ•°æ®ã€‚\n- æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æœ‰å®¹é‡é™åˆ¶çš„ï¼Œæ»¡æ—¶ä¸ä¼šå†åŠ å…¥æ•°æ®ï¼Œç©ºæ—¶ä¸ä¼šå†æ¶ˆè€—æ•°æ®ã€‚\n- JDK ä¸­å„ç§[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é˜»å¡é˜Ÿåˆ—|é˜»å¡é˜Ÿåˆ—]]ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ¨¡å¼ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220529162239.png]]\n\n## å®ç°\n\n```java\npackage test;  \n  \nimport lombok.extern.slf4j.Slf4j;  \n  \nimport java.util.LinkedList;  \n  \n@Slf4j  \npublic class Test11MessageQueue {  \n    public static void main(String[] args) {  \n        MessageQueue queue = new MessageQueue(2);  \n        for (int i=0; i\u003c99999; i++) {  \n            int id = i;  \n            new Thread(()-\u003e{  \n                queue.put(new Message(id, \"å†…å®¹\"+id));  \n            }, \"ç”Ÿäº§è€…\"+i).start();  \n        }  \n  \n        new Thread(()-\u003e{  \n            try {  \n                Thread.sleep(1000);  \n            } catch (InterruptedException e) {  \n                throw new RuntimeException(e);  \n            }  \n            while (true) {  \n                queue.take();  \n            }  \n        }, \"æ¶ˆè´¹è€…\").start();  \n    }  \n}  \n  \n@Slf4j  \nclass MessageQueue {  \n    private LinkedList\u003cMessage\u003e list = new LinkedList\u003c\u003e();  \n    private int capacity;  \n  \n    public MessageQueue(int capacity) {  \n        this.capacity = capacity;  \n    }  \n  \n    // æ¶ˆè´¹  \n    public Message take() {  \n        synchronized (list) {  \n            while(list.isEmpty()){  \n                try {  \n                    log.debug(\"é˜Ÿåˆ—ç©º\");  \n                    list.wait();  \n                } catch (InterruptedException e) {  \n                    throw new RuntimeException(e);  \n                }  \n            }  \n            Message message = list.removeFirst();  \n            log.debug(\"å·²æ¶ˆè´¹{}\", message);  \n            list.notify();  \n            return message;  \n        }  \n    }  \n  \n    // ç”Ÿäº§  \n    public void put(Message message) {  \n        synchronized (list) {  \n            while (list.size()==capacity) {  \n                try {  \n                    log.debug(\"é˜Ÿåˆ—æ»¡\");  \n                    list.wait();  \n                } catch (InterruptedException e) {  \n                    throw new RuntimeException(e);  \n                }  \n            }  \n            list.addLast(message);  \n            log.debug(\"å·²ç”Ÿäº§{}\", message);  \n            list.notifyAll();  \n        }  \n    }  \n}  \n  \n@Slf4j  \nfinal class Message {  \n    private int id;  \n    private Object value;  \n  \n    public int getId() {  \n        return id;  \n    }  \n  \n    public Object getValue() {  \n        return value;  \n    }  \n  \n    public Message(int id, Object value) {  \n        this.id = id;  \n        this.value = value;  \n    }  \n  \n    @Override  \n    public String toString() {  \n        return \"Message{\" +  \n                \"id=\" + id +  \n                \", value=\" + value +  \n                '}';  \n    }  \n}\n```\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F":{"title":"è£…é¥°å™¨æ¨¡å¼","content":"\n# è£…é¥°å™¨æ¨¡å¼\n\nå¯¹ç°æœ‰ç±»ä¸æ”¹åŠ¨ç»“æ„çš„æƒ…å†µä¸‹ä¸ºç±»æ·»åŠ æ–°èŒè´£å’ŒåŠŸèƒ½çš„æ¨¡å¼ã€‚\n\n## ä½¿ç”¨åœºæ™¯\n\n- éœ€è¦å¤§é‡çš„å­ç±»ä¸ºæŸä¸€ä¸ªå¯¹è±¡è¿›è¡ŒèŒè´£å¢å¼ºçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼\n- å¸Œæœ›ä½¿ç”¨ç»§æ‰¿å¯¹äºç±»è¿›è¡ŒåŠ¨æ€æ‰©å±•çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼\n\n## åŠ¨æœº\n\nä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç°ç»™ä¸€ä¸ªç±»æˆ–å¯¹è±¡å¢åŠ è¡Œä¸ºï¼š\n\n- ç»§æ‰¿æœºåˆ¶ï¼Œä½¿ç”¨ç»§æ‰¿æœºåˆ¶æ˜¯ç»™ç°æœ‰ç±»æ·»åŠ åŠŸèƒ½çš„ä¸€ç§æœ‰æ•ˆé€”å¾„ï¼Œé€šè¿‡ç»§æ‰¿ä¸€ä¸ªç°æœ‰ç±»å¯ä»¥ä½¿å¾—å­ç±»åœ¨æ‹¥æœ‰è‡ªèº«æ–¹æ³•çš„åŒæ—¶è¿˜æ‹¥æœ‰çˆ¶ç±»çš„æ–¹æ³•ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•æ˜¯é™æ€çš„ï¼Œç”¨æˆ·ä¸èƒ½æ§åˆ¶å¢åŠ è¡Œä¸ºçš„æ–¹å¼å’Œæ—¶æœºã€‚\n- å…³è”æœºåˆ¶ï¼Œå³å°†ä¸€ä¸ªç±»çš„å¯¹è±¡åµŒå…¥å¦ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œç”±å¦ä¸€ä¸ªå¯¹è±¡æ¥å†³å®šæ˜¯å¦è°ƒç”¨åµŒå…¥å¯¹è±¡çš„è¡Œä¸ºä»¥ä¾¿æ‰©å±•è‡ªå·±çš„è¡Œä¸ºï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªåµŒå…¥çš„å¯¹è±¡ä¸ºè£…é¥°å™¨(Decorator)\n\nè£…é¥°æ¨¡å¼ä»¥å¯¹å®¢æˆ·é€æ˜çš„æ–¹å¼åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡é™„åŠ ä¸Šæ›´å¤šçš„è´£ä»»ï¼Œæ¢è¨€ä¹‹ï¼Œå®¢æˆ·ç«¯å¹¶ä¸ä¼šè§‰å¾—å¯¹è±¡åœ¨è£…é¥°å‰å’Œè£…é¥°åæœ‰ä»€ä¹ˆä¸åŒã€‚è£…é¥°æ¨¡å¼å¯ä»¥åœ¨ä¸éœ€è¦åˆ›é€ æ›´å¤šå­ç±»çš„æƒ…å†µä¸‹ï¼Œå°†å¯¹è±¡çš„åŠŸèƒ½åŠ ä»¥æ‰©å±•ã€‚\n\n## è§’è‰²\n\n- **Component**ï¼šæŠ½è±¡ç»„ä»¶ï¼Œè£…é¥°è€…å’Œè¢«è£…é¥°è€…å…±åŒçš„çˆ¶ç±»ï¼Œæ˜¯ä¸€ä¸ªæ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œç”¨æ¥å®šä¹‰åŸºæœ¬è¡Œä¸ºï¼Œå¯ä»¥ç»™è¿™äº›å¯¹è±¡åŠ¨æ€æ·»åŠ èŒè´£\n- **ConcreteComponent**ï¼šå…·ä½“çš„ç»„ä»¶å¯¹è±¡ï¼Œå®ç°ç±» ï¼Œå³è¢«è£…é¥°è€…ï¼Œé€šå¸¸å°±æ˜¯è¢«è£…é¥°å™¨è£…é¥°çš„åŸå§‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç»™è¿™ä¸ªå¯¹è±¡æ·»åŠ èŒè´£\n- **Decorator**ï¼šæ‰€æœ‰è£…é¥°å™¨çš„æŠ½è±¡çˆ¶ç±»ï¼Œä¸€èˆ¬æ˜¯æŠ½è±¡ç±»ï¼Œå®ç°æ¥å£ï¼›å®ƒçš„å±æ€§å¿…ç„¶æœ‰ä¸ªæŒ‡å‘ Conponent æŠ½è±¡ç»„ä»¶çš„å¯¹è±¡ ï¼Œå…¶å®å°±æ˜¯æŒæœ‰ä¸€ä¸ªè¢«è£…é¥°çš„å¯¹è±¡\n- **ConcreteDecorator**ï¼šå…·ä½“çš„è£…é¥°å¯¹è±¡ï¼Œå®ç°å…·ä½“è¦è¢«è£…é¥°å¯¹è±¡æ·»åŠ çš„åŠŸèƒ½ã€‚æ¯ä¸€ä¸ªå…·ä½“è£…é¥°ç±»éƒ½å®šä¹‰äº†ä¸€äº›æ–°çš„è¡Œä¸ºï¼Œå®ƒå¯ä»¥è°ƒç”¨åœ¨æŠ½è±¡è£…é¥°ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¹¶å¯ä»¥å¢åŠ æ–°çš„æ–¹æ³•ç”¨ä»¥æ‰©å……å¯¹è±¡çš„è¡Œä¸ºã€‚\n\n![[z-oblib/z2-attachments/3ec6aa3545c9b5ab14fac788a400a4e9.webp]]\n\nè£…é¥°è€…å’Œè¢«è£…é¥°è€…å¯¹è±¡æœ‰ç›¸åŒçš„çˆ¶ç±»ï¼Œå› ä¸ºè£…é¥°è€…å’Œè¢«è£…é¥°è€…å¿…é¡»æ˜¯ä¸€æ ·çš„ç±»å‹ï¼Œ**è¿™é‡Œåˆ©ç”¨ç»§æ‰¿æ˜¯ä¸ºäº†è¾¾åˆ°ç±»å‹åŒ¹é…ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ç»§æ‰¿è·å¾—è¡Œä¸º**ã€‚\n\nåˆ©ç”¨ç»§æ‰¿è®¾è®¡å­ç±»ï¼Œåªèƒ½åœ¨ç¼–è¯‘æ—¶é™æ€å†³å®šï¼Œå¹¶ä¸”æ‰€æœ‰å­ç±»éƒ½ä¼šç»§æ‰¿ç›¸åŒçš„è¡Œä¸ºï¼›åˆ©ç”¨ç»„åˆçš„åšæ³•æ‰©å±•å¯¹è±¡ï¼Œå°±å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„è¿›è¡Œæ‰©å±•ã€‚è£…é¥°è€…æ¨¡å¼éµå¾ªå¼€æ”¾-å…³é—­åŸåˆ™ï¼šç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚åˆ©ç”¨è£…é¥°è€…ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ–°çš„è£…é¥°è€…å¢åŠ æ–°çš„è¡Œä¸ºè€Œä¸ç”¨ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œè€Œå¦‚æœå•çº¯ä¾èµ–ç»§æ‰¿ï¼Œæ¯å½“éœ€è¦æ–°è¡Œä¸ºæ—¶ï¼Œè¿˜å¾—ä¿®æ”¹ç°æœ‰çš„ä»£ç ã€‚\n\n## å®ä¾‹\n\nå–ç…é¥¼ï¼š\n\n![[z-oblib/z2-attachments/Pasted image 20220610170159.png]]\n\n### æŠ½è±¡ç»„ä»¶\n\n```java\npublic abstract class Pancake {\n\n    String description = \"æ™®é€šç…é¥¼\";\n\n    public String getDescription(){\n\n        return description;\n\n    }\n\n    public abstract double cost();\n\n}\n```\n\n### å…·ä½“ç»„ä»¶\n\nå®šä¹‰å…·ä½“çš„è¢«è£…é¥°è€…ï¼Œè¿™é‡Œæ˜¯ç…é¥¼æœå­ï¼Œå½“ç„¶è¿˜å¯ä»¥æœ‰é¸¡è›‹çŒé¥¼ã€æ‰‹æŠ“é¥¼ç­‰å…¶ä»–è¢«è£…é¥°è€…ï¼š\n\n```java\npublic class Battercake extends Pancake {\n    @Override\n    public double cost() {\n        return 8;\n    }\n\n    public Battercake(){\n        description = \"ç…é¥¼æœå­\";\n    }\n}\n```\n\n### æŠ½è±¡è£…é¥°å™¨\n\nå®šä¹‰ä¸€ä¸ªè°ƒæ–™æŠ½è±¡ç±»ï¼š\n\n```java\npublic abstract class CondimentDecorator extends Pancake {\n\n    // æŒæœ‰ç»„ä»¶å¯¹è±¡\n    protected Pancake pancake;\n    public CondimentDecorator(Pancake pancake){\n        this.pancake = pancake;\n    }\n\n    public abstract String getDescription();\n}\n```\n\n### å…·ä½“è£…é¥°å™¨\n\nå…·ä½“çš„è£…é¥°è€…ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé¸¡è›‹è£…é¥°å™¨ï¼Œä¸€ä¸ªç«è…¿è£…é¥°å™¨ï¼š\n\n```java\npublic class Egg extends CondimentDecorator {\n    public Egg(Pancake pancake){\n        super(pancake);\n    }\n\n\t// åŸæœ‰æ–¹æ³•åšå‘å¤–æ‰©å±•ï¼Œä¸ä¿®æ”¹åŸæœ‰æ–¹æ³•\n    @Override\n    public String getDescription() {\n        return pancake.getDescription() + \"åŠ é¸¡è›‹\";\n    }\n\n    @Override\n    public double cost() {\n        return pancake.cost() + 1;\n    }\n}\n```\n\n```java\npublic class Sausage extends CondimentDecorator{\n    public Sausage(Pancake pancake){\n        super(pancake);\n    }\n    @Override\n    public String getDescription() {\n        return pancake.getDescription() + \"åŠ ç«è…¿\";\n    }\n\n    @Override\n    public double cost() {\n        return pancake.cost() + 2;\n    }\n}\n```\n\n### æµ‹è¯•\n\n```java\npublic class Client {\n\n    public static void main(String[] args) {\n        //ä¹°ä¸€ä¸ªæ™®é€šçš„ç…é¥¼æœå­\n        Pancake battercake = new Battercake();\n        System.out.println(battercake.getDescription() + \"èŠ±è´¹ï¼š\"+battercake.cost() + \"å…ƒ\");\n\n        //ä¹°ä¸€ä¸ªåŠ åŒè›‹çš„ç…é¥¼æœå­\n        Pancake doubleEgg = new Battercake();\n        doubleEgg = new Egg(doubleEgg);\n        doubleEgg = new Egg(doubleEgg);\n        System.out.println(doubleEgg.getDescription() + \"èŠ±è´¹\" + doubleEgg.cost() + \"å…ƒ\");\n\n        //åŠ ç«è…¿å’Œé¸¡è›‹\n        Pancake battercakePlus = new Battercake();\n        battercakePlus = new Egg(battercakePlus);\n        battercakePlus = new Sausage(battercakePlus);\n        System.out.println(battercakePlus.getDescription() + \"èŠ±è´¹\" + battercakePlus.cost() + \"å…ƒ\");\n    }\n}\n```\n\n```\nç…é¥¼æœå­èŠ±è´¹ï¼š8.0å…ƒ\nç…é¥¼æœå­åŠ é¸¡è›‹åŠ é¸¡è›‹èŠ±è´¹10.0å…ƒ\nç…é¥¼æœå­åŠ é¸¡è›‹åŠ ç«è…¿èŠ±è´¹11.0å…ƒ\n```\n\n## ä¼˜ç‚¹\n\n- è£…é¥°æ¨¡å¼ä¸ç»§æ‰¿å…³ç³»çš„ç›®çš„éƒ½æ˜¯è¦æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ï¼Œä½†æ˜¯è£…é¥°æ¨¡å¼å¯ä»¥æä¾›æ¯”ç»§æ‰¿æ›´å¤šçš„çµæ´»æ€§ã€‚\n- å¯ä»¥é€šè¿‡ä¸€ç§åŠ¨æ€çš„æ–¹å¼æ¥æ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥åœ¨è¿è¡Œæ—¶é€‰æ‹©ä¸åŒçš„è£…é¥°å™¨ï¼Œä»è€Œå®ç°ä¸åŒçš„è¡Œä¸ºã€‚\n- é€šè¿‡ä½¿ç”¨ä¸åŒçš„å…·ä½“è£…é¥°ç±»ä»¥åŠè¿™äº›è£…é¥°ç±»çš„æ’åˆ—ç»„åˆï¼Œå¯ä»¥åˆ›é€ å‡ºå¾ˆå¤šä¸åŒè¡Œä¸ºçš„ç»„åˆã€‚å¯ä»¥ä½¿ç”¨å¤šä¸ªå…·ä½“è£…é¥°ç±»æ¥è£…é¥°åŒä¸€å¯¹è±¡ï¼Œå¾—åˆ°åŠŸèƒ½æ›´ä¸ºå¼ºå¤§çš„å¯¹è±¡ã€‚\n- å…·ä½“æ„ä»¶ç±»ä¸å…·ä½“è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å˜åŒ–ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„å…·ä½“æ„ä»¶ç±»å’Œå…·ä½“è£…é¥°ç±»ï¼Œåœ¨ä½¿ç”¨æ—¶å†å¯¹å…¶è¿›è¡Œç»„åˆï¼ŒåŸæœ‰ä»£ç æ— é¡»æ”¹å˜ï¼Œç¬¦åˆâ€œ[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/å¼€é—­åŸåˆ™|å¼€é—­åŸåˆ™]]â€\n\n## ç¼ºç‚¹\n\n- ä½¿ç”¨è£…é¥°æ¨¡å¼è¿›è¡Œç³»ç»Ÿè®¾è®¡æ—¶å°†äº§ç”Ÿå¾ˆå¤šå°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„åŒºåˆ«åœ¨äºå®ƒä»¬ä¹‹é—´ç›¸äº’è¿æ¥çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„ç±»æˆ–è€…å±æ€§å€¼æœ‰æ‰€ä¸åŒï¼ŒåŒæ—¶è¿˜å°†äº§ç”Ÿå¾ˆå¤šå…·ä½“è£…é¥°ç±»ã€‚è¿™äº›è£…é¥°ç±»å’Œå°å¯¹è±¡çš„äº§ç”Ÿå°†å¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼ŒåŠ å¤§å­¦ä¹ ä¸ç†è§£çš„éš¾åº¦ã€‚\n- è¿™ç§æ¯”ç»§æ‰¿æ›´åŠ çµæ´»æœºåŠ¨çš„ç‰¹æ€§ï¼Œä¹ŸåŒæ—¶æ„å‘³ç€è£…é¥°æ¨¡å¼æ¯”ç»§æ‰¿æ›´åŠ æ˜“äºå‡ºé”™ï¼Œæ’é”™ä¹Ÿå¾ˆå›°éš¾ï¼Œå¯¹äºå¤šæ¬¡è£…é¥°çš„å¯¹è±¡ï¼Œè°ƒè¯•æ—¶å¯»æ‰¾é”™è¯¯å¯èƒ½éœ€è¦é€çº§æ’æŸ¥ï¼Œè¾ƒä¸ºçƒ¦çã€‚\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93":{"title":"è®¾è®¡æ¨¡å¼æ€»ç»“","content":"\n# è®¾è®¡æ¨¡å¼æ€»ç»“\n\n## æ¨¡å¼\n\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/è£…é¥°å™¨æ¨¡å¼|è£…é¥°å™¨æ¨¡å¼]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ä¸¤é˜¶æ®µç»ˆæ­¢|ä¸¤é˜¶æ®µç»ˆæ­¢]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/æ¨¡æ¿æ¨¡å¼|æ¨¡æ¿æ¨¡å¼]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å•ä¾‹æ¨¡å¼|å•ä¾‹æ¨¡å¼]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å·¥å‚æ¨¡å¼|å·¥å‚æ¨¡å¼]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/äº«å…ƒæ¨¡å¼|äº«å…ƒæ¨¡å¼]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ä¿æŠ¤æ€§æš‚åœ|ä¿æŠ¤æ€§æš‚åœ]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/ç”Ÿäº§è€…æ¶ˆè´¹è€…|ç”Ÿäº§è€…æ¶ˆè´¹è€…]]\n\n## å·¥å…·\n\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/Balking|Balking]]\n- [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å·¥ä½œçº¿ç¨‹|å·¥ä½œçº¿ç¨‹]]\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/1-%E8%BD%AF%E4%BB%B6%E6%96%B9%E6%B3%95%E5%AD%A6/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Balking":{"title":"Balking","content":"\n# Balking\n\nBalking ï¼ˆçŠ¹è±«ï¼‰æ¨¡å¼ç”¨åœ¨ä¸€ä¸ªçº¿ç¨‹å‘ç°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–æœ¬çº¿ç¨‹å·²ç»åšäº†æŸä¸€ä»¶ç›¸åŒçš„äº‹ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ— éœ€å†åšäº†ï¼Œç›´æ¥ç»“æŸè¿”å›ã€‚\n\n## å®ç°\n\n### å•çº¿ç¨‹æƒ…å†µ\n\né€šè¿‡å˜é‡è®°å½•æŸä¸ªæ–¹æ³•æ˜¯å¦å·²ç»æ‰§è¡Œè¿‡ï¼Œä¿è¯æ–¹æ³•åªèƒ½æ‰§è¡Œä¸€æ¬¡ã€‚\nä¾‹å¦‚ç›‘æ§å™¨å‰ç¨‹åªéœ€è¦ä¸€ä¸ªï¼Œä¸éœ€è¦é‡å¤start()æ–°çš„çº¿ç¨‹ã€‚\n\n```java\nclass SystemMonitor {\n\tprivate boolean starting = false;\n\tpublic void start() {\n\t\t// é˜²æ­¢é‡å¤å¯åŠ¨\n\t\tif(starting) {\n\t\t\treturn;\n\t\t}\n\t\tstarting = true;\n\t\tmonitorThread = new Thread(()-\u003e{...;});\n\t\tmonitorThread.start();\n\t}\n}\n```\n\n### å¤šçº¿ç¨‹æƒ…å†µ\n\nstartingçš„åˆ¤æ–­å’Œèµ‹å€¼åˆ†æˆäº†ä¸¤æ­¥ï¼Œæ‰€ä»¥æ²¡æœ‰ä¿è¯åŸå­æ€§ï¼Œå¤šçº¿ç¨‹è®¿é—®ä¼šå‡ºé—®é¢˜ï¼Œéœ€è¦åŠ é”ï¼š\n\n```java\nclass SystemMonitor {\n\tprivate boolean starting = false;\n\tpublic void start() {\n\t\t// åŠ é”é˜²æ­¢å¤šçº¿ç¨‹ç ´ååŸå­æ€§\n\t\tsynchronized(this) {\n\t\t\tif(starting) {\n\t\t\t\treturn;\n\t\t\t}\n\t\tstarting = true;\n\t\t}\n\t\tmonitorThread = new Thread(()-\u003e{...;});\n\t\tmonitorThread.start();\n\t}\n}\n```\n\n## åº”ç”¨\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Linux%E7%BD%91%E7%BB%9C%E5%BC%80%E5%8F%91/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E9%AA%A8%E6%9E%B6":{"title":"æ”¶åŒ…","content":"\n# æ”¶åŒ…\n\n1. åˆå§‹åŒ–socket\n2. è®¾ç½®socketå‚æ•°\n    1. æ¥æ”¶è¶…æ—¶æ—¶é—´\n3. é€šè¿‡ç½‘å¡åè·å–ç½‘å¡index\n4. é€šè¿‡ç½‘å¡indexå°†socketä¸ç½‘å¡ç»‘å®š\n5. è®¾ç½®ç½‘å¡ä¸ºæ··æ‚æ¨¡å¼\n6. å¾ªç¯æ¥æ”¶æ•°æ®åŒ…\n\n# å‘åŒ…\n\n1. åˆå§‹åŒ–socket\n2. è®¾ç½®socketå‚æ•°\n    1. `SO_DONTROUTE` è®©æ¶ˆæ¯ç›´å‘ç½‘å¡ï¼Œä¸è·¯ç”±\n3. é€šè¿‡ç½‘å¡åè·å–ç½‘å¡index\n4. é€šè¿‡ç½‘å¡indexå°†socketä¸ç½‘å¡ç»‘å®š\n5. æ„å»ºå¾…å‘é€æ•°æ®åŒ…\n    1. æ•°æ®é“¾è·¯å±‚\n    2. ç½‘ç»œå±‚\n    3. ä¼ è¾“å±‚\n        1. TCP\n        2. UDP\n    4. åº”ç”¨å±‚\n6. é€šè¿‡writeå‘raw socketå†™å…¥\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/%E6%9E%84%E5%BB%BARPC/%E6%9E%84%E5%BB%BARPC%E6%80%9D%E8%B7%AF":{"title":"æ„å»ºRPCæ€è·¯","content":"\n# æ„å»ºRPCæ€è·¯\n\n## é—®é¢˜\n\n1. å®¢æˆ·ç«¯å¦‚ä½•çŸ¥é“æœåŠ¡ç«¯åœ°å€\n2. å®¢æˆ·ç«¯å¦‚ä½•çŸ¥é“æœ‰å“ªäº›æœåŠ¡\n3. å®¢æˆ·ç«¯å¦‚ä½•å‘æœåŠ¡ç«¯ä¼ é€’å‚æ•°\n4. æ•°æ®å¦‚ä½•ç¼–è§£ç \n5. æœåŠ¡ç«¯å¦‚ä½•éªŒè¯å®¢æˆ·ç«¯å’Œè¯·æ±‚åˆæ³•\n6. æœåŠ¡ç«¯å¦‚ä½•å°†æ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯\n\t1. å®¢æˆ·ç«¯å¦‚ä½•ç­‰å¾…ç»“æœ\n7. æœåŠ¡ç«¯å¦‚ä½•åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Netty/Netty%E4%BC%98%E5%8C%96%E4%B8%8E%E6%BA%90%E7%A0%81":{"title":"Nettyä¼˜åŒ–ä¸æºç ","content":"\n# Nettyä¼˜åŒ–ä¸æºç \n\n## 1. ä¼˜åŒ–\n\n### 1.1 æ‰©å±•åºåˆ—åŒ–ç®—æ³•\n\nåºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ä¸»è¦ç”¨åœ¨æ¶ˆæ¯æ­£æ–‡çš„è½¬æ¢ä¸Š\n\n* åºåˆ—åŒ–æ—¶ï¼Œéœ€è¦å°† Java å¯¹è±¡å˜ä¸ºè¦ä¼ è¾“çš„æ•°æ®ï¼ˆå¯ä»¥æ˜¯ byte[]ï¼Œæˆ– json ç­‰ï¼Œ**æœ€ç»ˆéƒ½éœ€è¦å˜æˆ byte[]**ï¼‰\n* ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦å°†ä¼ å…¥çš„æ­£æ–‡æ•°æ®è¿˜åŸæˆ Java å¯¹è±¡ï¼Œä¾¿äºå¤„ç†\n\nç›®å‰çš„ä»£ç ä»…æ”¯æŒ Java è‡ªå¸¦çš„åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–æœºåˆ¶ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹\n\n```java\n// ååºåˆ—åŒ–\nbyte[] body = new byte[bodyLength];\nbyteByf.readBytes(body);\nObjectInputStream in = new ObjectInputStream(new ByteArrayInputStream(body));\nMessage message = (Message) in.readObject();\nmessage.setSequenceId(sequenceId);\n\n// åºåˆ—åŒ–\nByteArrayOutputStream out = new ByteArrayOutputStream();\nnew ObjectOutputStream(out).writeObject(message);\nbyte[] bytes = out.toByteArray();\n```\n\nä¸ºäº†æ”¯æŒæ›´å¤šåºåˆ—åŒ–ç®—æ³•ï¼ŒæŠ½è±¡ä¸€ä¸ª Serializer æ¥å£\n\n```java\npublic interface Serializer {\n\n    // ååºåˆ—åŒ–æ–¹æ³•\n    \u003cT\u003e T deserialize(Class\u003cT\u003e clazz, byte[] bytes);\n\n    // åºåˆ—åŒ–æ–¹æ³•\n    \u003cT\u003e byte[] serialize(T object);\n\n}\n```\n\næä¾›ä¸¤ä¸ªå®ç°ï¼Œæˆ‘è¿™é‡Œç›´æ¥å°†å®ç°åŠ å…¥äº†æšä¸¾ç±» Serializer.Algorithm ä¸­\n\n```java\nenum SerializerAlgorithm implements Serializer {\n\t// Java å®ç°\n    Java {\n        @Override\n        public \u003cT\u003e T deserialize(Class\u003cT\u003e clazz, byte[] bytes) {\n            try {\n                ObjectInputStream in = \n                    new ObjectInputStream(new ByteArrayInputStream(bytes));\n                Object object = in.readObject();\n                return (T) object;\n            } catch (IOException | ClassNotFoundException e) {\n                throw new RuntimeException(\"SerializerAlgorithm.Java ååºåˆ—åŒ–é”™è¯¯\", e);\n            }\n        }\n\n        @Override\n        public \u003cT\u003e byte[] serialize(T object) {\n            try {\n                ByteArrayOutputStream out = new ByteArrayOutputStream();\n                new ObjectOutputStream(out).writeObject(object);\n                return out.toByteArray();\n            } catch (IOException e) {\n                throw new RuntimeException(\"SerializerAlgorithm.Java åºåˆ—åŒ–é”™è¯¯\", e);\n            }\n        }\n    }, \n    // Json å®ç°(å¼•å…¥äº† Gson ä¾èµ–)\n    Json {\n        @Override\n        public \u003cT\u003e T deserialize(Class\u003cT\u003e clazz, byte[] bytes) {\n            return new Gson().fromJson(new String(bytes, StandardCharsets.UTF_8), clazz);\n        }\n\n        @Override\n        public \u003cT\u003e byte[] serialize(T object) {\n            return new Gson().toJson(object).getBytes(StandardCharsets.UTF_8);\n        }\n    };\n\n    // éœ€è¦ä»åè®®çš„å­—èŠ‚ä¸­å¾—åˆ°æ˜¯å“ªç§åºåˆ—åŒ–ç®—æ³•\n    public static SerializerAlgorithm getByInt(int type) {\n        SerializerAlgorithm[] array = SerializerAlgorithm.values();\n        if (type \u003c 0 || type \u003e array.length - 1) {\n            throw new IllegalArgumentException(\"è¶…è¿‡ SerializerAlgorithm èŒƒå›´\");\n        }\n        return array[type];\n    }\n}\n```\n\nå¢åŠ é…ç½®ç±»å’Œé…ç½®æ–‡ä»¶\n\n```java\npublic abstract class Config {\n    static Properties properties;\n    static {\n        try (InputStream in = Config.class.getResourceAsStream(\"/application.properties\")) {\n            properties = new Properties();\n            properties.load(in);\n        } catch (IOException e) {\n            throw new ExceptionInInitializerError(e);\n        }\n    }\n    public static int getServerPort() {\n        String value = properties.getProperty(\"server.port\");\n        if(value == null) {\n            return 8080;\n        } else {\n            return Integer.parseInt(value);\n        }\n    }\n    public static Serializer.Algorithm getSerializerAlgorithm() {\n        String value = properties.getProperty(\"serializer.algorithm\");\n        if(value == null) {\n            return Serializer.Algorithm.Java;\n        } else {\n            return Serializer.Algorithm.valueOf(value);\n        }\n    }\n}\n```\n\né…ç½®æ–‡ä»¶\n\n```properties\nserializer.algorithm=Json\n```\n\nä¿®æ”¹ç¼–è§£ç å™¨\n\n```java\n/**\n * å¿…é¡»å’Œ LengthFieldBasedFrameDecoder ä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿æ¥åˆ°çš„ ByteBuf æ¶ˆæ¯æ˜¯å®Œæ•´çš„\n */\npublic class MessageCodecSharable extends MessageToMessageCodec\u003cByteBuf, Message\u003e {\n    @Override\n    public void encode(ChannelHandlerContext ctx, Message msg, List\u003cObject\u003e outList) throws Exception {\n        ByteBuf out = ctx.alloc().buffer();\n        // 1. 4 å­—èŠ‚çš„é­”æ•°\n        out.writeBytes(new byte[]{1, 2, 3, 4});\n        // 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,\n        out.writeByte(1);\n        // 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1\n        out.writeByte(Config.getSerializerAlgorithm().ordinal());\n        // 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹\n        out.writeByte(msg.getMessageType());\n        // 5. 4 ä¸ªå­—èŠ‚\n        out.writeInt(msg.getSequenceId());\n        // æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……\n        out.writeByte(0xff);\n        // 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„\n        byte[] bytes = Config.getSerializerAlgorithm().serialize(msg);\n        // 7. é•¿åº¦\n        out.writeInt(bytes.length);\n        // 8. å†™å…¥å†…å®¹\n        out.writeBytes(bytes);\n        outList.add(out);\n    }\n\n    @Override\n    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List\u003cObject\u003e out) throws Exception {\n        int magicNum = in.readInt();\n        byte version = in.readByte();\n        byte serializerAlgorithm = in.readByte(); // 0 æˆ– 1\n        byte messageType = in.readByte(); // 0,1,2...\n        int sequenceId = in.readInt();\n        in.readByte();\n        int length = in.readInt();\n        byte[] bytes = new byte[length];\n        in.readBytes(bytes, 0, length);\n\n        // æ‰¾åˆ°ååºåˆ—åŒ–ç®—æ³•\n        Serializer.Algorithm algorithm = Serializer.Algorithm.values()[serializerAlgorithm];\n        // ç¡®å®šå…·ä½“æ¶ˆæ¯ç±»å‹\n        Class\u003c? extends Message\u003e messageClass = Message.getMessageClass(messageType);\n        Message message = algorithm.deserialize(messageClass, bytes);\n//        log.debug(\"{}, {}, {}, {}, {}, {}\", magicNum, version, serializerType, messageType, sequenceId, length);\n//        log.debug(\"{}\", message);\n        out.add(message);\n    }\n}\n```\n\nå…¶ä¸­ç¡®å®šå…·ä½“æ¶ˆæ¯ç±»å‹ï¼Œå¯ä»¥æ ¹æ® `æ¶ˆæ¯ç±»å‹å­—èŠ‚` è·å–åˆ°å¯¹åº”çš„ `æ¶ˆæ¯ class`\n\n```java\n@Data\npublic abstract class Message implements Serializable {\n\n    /**\n     * æ ¹æ®æ¶ˆæ¯ç±»å‹å­—èŠ‚ï¼Œè·å¾—å¯¹åº”çš„æ¶ˆæ¯ class\n     * @param messageType æ¶ˆæ¯ç±»å‹å­—èŠ‚\n     * @return æ¶ˆæ¯ class\n     */\n    public static Class\u003c? extends Message\u003e getMessageClass(int messageType) {\n        return messageClasses.get(messageType);\n    }\n\n    private int sequenceId;\n\n    private int messageType;\n\n    public abstract int getMessageType();\n\n    public static final int LoginRequestMessage = 0;\n    public static final int LoginResponseMessage = 1;\n    public static final int ChatRequestMessage = 2;\n    public static final int ChatResponseMessage = 3;\n    public static final int GroupCreateRequestMessage = 4;\n    public static final int GroupCreateResponseMessage = 5;\n    public static final int GroupJoinRequestMessage = 6;\n    public static final int GroupJoinResponseMessage = 7;\n    public static final int GroupQuitRequestMessage = 8;\n    public static final int GroupQuitResponseMessage = 9;\n    public static final int GroupChatRequestMessage = 10;\n    public static final int GroupChatResponseMessage = 11;\n    public static final int GroupMembersRequestMessage = 12;\n    public static final int GroupMembersResponseMessage = 13;\n    public static final int PingMessage = 14;\n    public static final int PongMessage = 15;\n    private static final Map\u003cInteger, Class\u003c? extends Message\u003e\u003e messageClasses = new HashMap\u003c\u003e();\n\n    static {\n        messageClasses.put(LoginRequestMessage, LoginRequestMessage.class);\n        messageClasses.put(LoginResponseMessage, LoginResponseMessage.class);\n        messageClasses.put(ChatRequestMessage, ChatRequestMessage.class);\n        messageClasses.put(ChatResponseMessage, ChatResponseMessage.class);\n        messageClasses.put(GroupCreateRequestMessage, GroupCreateRequestMessage.class);\n        messageClasses.put(GroupCreateResponseMessage, GroupCreateResponseMessage.class);\n        messageClasses.put(GroupJoinRequestMessage, GroupJoinRequestMessage.class);\n        messageClasses.put(GroupJoinResponseMessage, GroupJoinResponseMessage.class);\n        messageClasses.put(GroupQuitRequestMessage, GroupQuitRequestMessage.class);\n        messageClasses.put(GroupQuitResponseMessage, GroupQuitResponseMessage.class);\n        messageClasses.put(GroupChatRequestMessage, GroupChatRequestMessage.class);\n        messageClasses.put(GroupChatResponseMessage, GroupChatResponseMessage.class);\n        messageClasses.put(GroupMembersRequestMessage, GroupMembersRequestMessage.class);\n        messageClasses.put(GroupMembersResponseMessage, GroupMembersResponseMessage.class);\n    }\n}\n```\n\n### 1.2 å‚æ•°è°ƒä¼˜\n\nå®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨ Bootstrap().option(xxx)\næœåŠ¡å™¨ç«¯ï¼š\nServerBootstrap().option(xxx)æ˜¯ç»™ServerSocketChannelé…ç½®å‚æ•°\nServerBootstrap().childOption(xxx)æ˜¯ç»™SocketChannelé…ç½®å‚æ•°\n\n#### 1ï¼‰CONNECT_TIMEOUT_MILLIS\n\n* å±äº SocketChannal å‚æ•°\n* ç”¨åœ¨å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ—¶ï¼Œå¦‚æœåœ¨æŒ‡å®šæ¯«ç§’å†…æ— æ³•è¿æ¥ï¼Œä¼šæŠ›å‡º timeout å¼‚å¸¸\n\n* SO_TIMEOUT ä¸»è¦ç”¨åœ¨é˜»å¡ IOï¼Œé˜»å¡ IO ä¸­ acceptï¼Œread ç­‰éƒ½æ˜¯æ— é™ç­‰å¾…çš„ï¼Œå¦‚æœä¸å¸Œæœ›æ°¸è¿œé˜»å¡ï¼Œä½¿ç”¨å®ƒè°ƒæ•´è¶…æ—¶æ—¶é—´\n\n```java\n@Slf4j\npublic class TestConnectionTimeout {\n    public static void main(String[] args) {\n        NioEventLoopGroup group = new NioEventLoopGroup();\n        try {\n            Bootstrap bootstrap = new Bootstrap()\n                    .group(group)\n                    // é…ç½®å‚æ•°\n                    .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 300)\n                    .channel(NioSocketChannel.class)\n                    .handler(new LoggingHandler());\n            ChannelFuture future = bootstrap.connect(\"127.0.0.1\", 8080);\n            future.sync().channel().closeFuture().sync(); // æ–­ç‚¹1\n        } catch (Exception e) {\n            e.printStackTrace();\n            log.debug(\"timeout\");\n        } finally {\n            group.shutdownGracefully();\n        }\n    }\n}\n```\n\nå¦å¤–æºç éƒ¨åˆ† `io.netty.channel.nio.AbstractNioChannel.AbstractNioUnsafe#connect`\n\n```java\n@Override\npublic final void connect(\n        final SocketAddress remoteAddress, final SocketAddress localAddress, final ChannelPromise promise) {\n    // ...\n    // Schedule connect timeout.\n    int connectTimeoutMillis = config().getConnectTimeoutMillis();\n    if (connectTimeoutMillis \u003e 0) {\n        connectTimeoutFuture = eventLoop().schedule(new Runnable() {\n            @Override\n            public void run() {                \n                ChannelPromise connectPromise = AbstractNioChannel.this.connectPromise;\n                ConnectTimeoutException cause =\n                    new ConnectTimeoutException(\"connection timed out: \" + remoteAddress); // æ–­ç‚¹2\n                if (connectPromise != null \u0026\u0026 connectPromise.tryFailure(cause)) {\n                    close(voidPromise());\n                }\n            }\n        }, connectTimeoutMillis, TimeUnit.MILLISECONDS);\n    }\n\t// ...\n}\n```\n\n#### 2ï¼‰SO_BACKLOG\n\n* å±äº ServerSocketChannal å‚æ•°\n\nä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼š\n\n```mermaid\nsequenceDiagram\n\nparticipant c as client\nparticipant s as server\nparticipant sq as syns queue\nparticipant aq as accept queue\n\ns -\u003e\u003e s : bind()\ns -\u003e\u003e s : listen()\nc -\u003e\u003e c : connect()\nc -\u003e\u003e s : 1. SYN\nNote left of c : SYN_SEND\ns -\u003e\u003e sq : put\nNote right of s : SYN_RCVD\ns -\u003e\u003e c : 2. SYN + ACK\nNote left of c : ESTABLISHED\nc -\u003e\u003e s : 3. ACK\nsq -\u003e\u003e aq : put\nNote right of s : ESTABLISHED\naq --\u003e\u003e s : \ns -\u003e\u003e s : accept()\n```\n\n\u003e sync queueï¼šåŠè¿æ¥é˜Ÿåˆ—ï¼šè¿˜æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥æ”¾å…¥\n\u003e accept queueï¼šå…¨è¿æ¥é˜Ÿåˆ—ï¼šå®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥æ”¾å…¥\n\n\u003e æœåŠ¡å™¨å…ˆæ”¾å…¥accept queueçš„åŸå› æ˜¯ï¼šæœåŠ¡å™¨å¤„ç†accept()çš„èƒ½åŠ›æœ‰é™ï¼Œå¦‚æœå¤§é‡å®¢æˆ·ç«¯è¿æ¥å¯èƒ½é€ æˆè´Ÿè½½è¿‡é«˜ï¼Œæ‰€ä»¥å…ˆæ”¾å…¥é˜Ÿåˆ—ã€‚\n\u003e ä¸‰æ¬¡æ¡æ‰‹å‘ç”Ÿåœ¨accept()ä¹‹å‰ã€‚\n\n1. ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œclient å‘é€ SYN åˆ° serverï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º SYN_SENDï¼Œserver æ”¶åˆ°ï¼ŒçŠ¶æ€æ”¹å˜ä¸º SYN_REVDï¼Œå¹¶å°†è¯¥è¯·æ±‚æ”¾å…¥ sync queue é˜Ÿåˆ—\n2. ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œserver å›å¤ SYN + ACK ç»™ clientï¼Œclient æ”¶åˆ°ï¼ŒçŠ¶æ€æ”¹å˜ä¸º ESTABLISHEDï¼Œå¹¶å‘é€ ACK ç»™ server\n3. ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œserver æ”¶åˆ° ACKï¼ŒçŠ¶æ€æ”¹å˜ä¸º ESTABLISHEDï¼Œå°†è¯¥è¯·æ±‚ä» sync queue æ”¾å…¥ accept queue\n\nå…¶ä¸­\n\n* åœ¨ linux 2.2 ä¹‹å‰ï¼Œbacklog å¤§å°åŒ…æ‹¬äº†ä¸¤ä¸ªé˜Ÿåˆ—çš„å¤§å°ï¼Œåœ¨ 2.2 ä¹‹åï¼Œåˆ†åˆ«ç”¨ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶\n\n* sync queue - åŠè¿æ¥é˜Ÿåˆ—\n  * å¤§å°é€šè¿‡ /proc/sys/net/ipv4/tcp_max_syn_backlog æŒ‡å®šï¼Œåœ¨ `syncookies` å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œé€»è¾‘ä¸Šæ²¡æœ‰æœ€å¤§å€¼é™åˆ¶ï¼Œè¿™ä¸ªè®¾ç½®ä¾¿è¢«å¿½ç•¥\n* accept queue - å…¨è¿æ¥é˜Ÿåˆ—\n  * å…¶å¤§å°é€šè¿‡ /proc/sys/net/core/somaxconn æŒ‡å®šï¼Œåœ¨ä½¿ç”¨ listen å‡½æ•°æ—¶ï¼Œå†…æ ¸ä¼šæ ¹æ®ä¼ å…¥çš„ backlog å‚æ•°ä¸ç³»ç»Ÿå‚æ•°ï¼Œå–**äºŒè€…çš„è¾ƒå°å€¼**\n  * **å¦‚æœ accpet queue é˜Ÿåˆ—æ»¡äº†ï¼Œserver å°†å‘é€ä¸€ä¸ªæ‹’ç»è¿æ¥çš„é”™è¯¯ä¿¡æ¯åˆ° client**\n\n\n\nnetty ä¸­\n\nå¯ä»¥é€šè¿‡  option(ChannelOption.SO_BACKLOG, å€¼) æ¥è®¾ç½®å…¨è¿æ¥é˜Ÿåˆ—å¤§å°\n\nå¯ä»¥é€šè¿‡ä¸‹é¢æºç æŸ¥çœ‹é»˜è®¤å¤§å°\n\n```java\npublic class DefaultServerSocketChannelConfig extends DefaultChannelConfig\n                                              implements ServerSocketChannelConfig {\n\n    private volatile int backlog = NetUtil.SOMAXCONN;\n    // ...\n}\n```\n\nè¯¾å ‚è°ƒè¯•å…³é”®æ–­ç‚¹ä¸ºï¼š`io.netty.channel.nio.NioEventLoop#processSelectedKey`\n\n\n\noio ä¸­æ›´å®¹æ˜“è¯´æ˜ï¼Œä¸ç”¨ debug æ¨¡å¼\n\n```java\npublic class Server {\n    public static void main(String[] args) throws IOException {\n        ServerSocket ss = new ServerSocket(8888, 2);\n        Socket accept = ss.accept();\n        System.out.println(accept);\n        System.in.read();\n    }\n}\n```\n\nå®¢æˆ·ç«¯å¯åŠ¨ 4 ä¸ª\n\n```java\npublic class Client {\n    public static void main(String[] args) throws IOException {\n        try {\n            Socket s = new Socket();\n            System.out.println(new Date()+\" connecting...\");\n            s.connect(new InetSocketAddress(\"localhost\", 8888),1000);\n            System.out.println(new Date()+\" connected...\");\n            s.getOutputStream().write(1);\n            System.in.read();\n        } catch (IOException e) {\n            System.out.println(new Date()+\" connecting timeout...\");\n            e.printStackTrace();\n        }\n    }\n}\n```\n\nç¬¬ 1ï¼Œ2ï¼Œ3 ä¸ªå®¢æˆ·ç«¯éƒ½æ‰“å°ï¼Œä½†é™¤äº†ç¬¬ä¸€ä¸ªå¤„äº accpet å¤–ï¼Œå…¶å®ƒä¸¤ä¸ªéƒ½å¤„äº accept queue ä¸­\n\n```java\nTue Apr 21 20:30:28 CST 2020 connecting...\nTue Apr 21 20:30:28 CST 2020 connected...\n```\n\nç¬¬ 4 ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶\n\n```\nTue Apr 21 20:53:58 CST 2020 connecting...\nTue Apr 21 20:53:59 CST 2020 connecting timeout...\njava.net.SocketTimeoutException: connect timed out\n```\n\n#### 3ï¼‰ulimit -n\n\n* å±äºæ“ä½œç³»ç»Ÿå‚æ•°\n\né™åˆ¶è¿›ç¨‹èƒ½åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ã€‚\n\n\u003e Linux çš„æ™®é€šæ–‡ä»¶å’Œsocketéƒ½æ˜¯ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥ä»£è¡¨ã€‚\n\u003e å±äºç³»ç»Ÿçš„ä¸´æ—¶è°ƒæ•´ï¼Œå»ºè®®æ”¾åœ¨å¯åŠ¨è„šæœ¬ã€‚\n\n#### 4ï¼‰TCP_NODELAY\n\n* å±äº SocketChannal å‚æ•°ï¼Œéœ€è¦childOptionè®¾ç½®ã€‚\n\n\u003e é»˜è®¤å€¼æ˜¯falseï¼Œä»£è¡¨å¼€å¯nagleç®—æ³•ã€‚\n\u003e è®¾ä¸ºtrueå…³é—­nagleç®—æ³•ã€‚\n\n#### 5ï¼‰SO_SNDBUF \u0026 SO_RCVBUF\n\n* SO_SNDBUF å±äº SocketChannal å‚æ•°\n* SO_RCVBUF æ—¢å¯ç”¨äº SocketChannal å‚æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨äº ServerSocketChannal å‚æ•°ï¼ˆå»ºè®®è®¾ç½®åˆ° ServerSocketChannal ä¸Šï¼‰\n\n\u003e ä¸å»ºè®®è°ƒæ•´è¯¥å‚æ•°ï¼Œæ“ä½œç³»ç»Ÿæ‹¥å¡æ§åˆ¶ä¼šè‡ªåŠ¨è°ƒæ•´ã€‚\n\n#### 6ï¼‰ALLOCATOR\n\n* å±äº SocketChannal å‚æ•°\n* ç”¨æ¥åˆ†é… ByteBufï¼Œ ctx.alloc()\n* æ§åˆ¶åˆ†é…å‡ºæ¥çš„ByteBufæ˜¯æ± åŒ–/éæ± åŒ–ï¼Œç›´æ¥å†…å­˜/å †å†…å­˜\n\t* é»˜è®¤æ˜¯æ± åŒ– ç›´æ¥å†…å­˜\n\n\u003e è°ƒç”¨ctx.alloc()æ‹¿åˆ°çš„å°±æ˜¯è¯¥åˆ†é…å™¨å¯¹è±¡ã€‚\n\n#### 7ï¼‰RCVBUF_ALLOCATOR\n\n* å±äº SocketChannal å‚æ•°\n* æ§åˆ¶ netty **æ¥æ”¶**ç¼“å†²åŒºå¤§å°\n* è´Ÿè´£å…¥ç«™æ•°æ®çš„åˆ†é…ï¼Œå†³å®šå…¥ç«™ç¼“å†²åŒºçš„å¤§å°ï¼ˆå¹¶å¯åŠ¨æ€è°ƒæ•´ï¼‰ï¼Œ**ç»Ÿä¸€é‡‡ç”¨ direct ç›´æ¥å†…å­˜**ï¼Œå…·ä½“æ± åŒ–è¿˜æ˜¯éæ± åŒ–ç”± allocator å†³å®š\n\n\u003e ALLOCATOR å’Œ RCVBUF_ALLOCATOR å…±åŒåä½œå®ŒæˆByteBufçš„åˆå§‹åˆ†é…ã€‚\n\n### 1.3 RPC æ¡†æ¶\n\n#### 1ï¼‰å‡†å¤‡å·¥ä½œ\n\nè¿™äº›ä»£ç å¯ä»¥è®¤ä¸ºæ˜¯ç°æˆçš„ï¼Œæ— éœ€ä»å¤´ç¼–å†™ç»ƒä¹ \n\nä¸ºäº†ç®€åŒ–èµ·è§ï¼Œåœ¨åŸæ¥èŠå¤©é¡¹ç›®çš„åŸºç¡€ä¸Šæ–°å¢ Rpc è¯·æ±‚å’Œå“åº”æ¶ˆæ¯\n\n```java\n@Data\npublic abstract class Message implements Serializable {\n\n    // çœç•¥æ—§çš„ä»£ç \n\n    public static final int RPC_MESSAGE_TYPE_REQUEST = 101;\n    public static final int  RPC_MESSAGE_TYPE_RESPONSE = 102;\n\n    static {\n        // ...\n        messageClasses.put(RPC_MESSAGE_TYPE_REQUEST, RpcRequestMessage.class);\n        messageClasses.put(RPC_MESSAGE_TYPE_RESPONSE, RpcResponseMessage.class);\n    }\n\n}\n```\n\nè¯·æ±‚æ¶ˆæ¯\n\n```java\n@Getter\n@ToString(callSuper = true)\npublic class RpcRequestMessage extends Message {\n\n    /**\n     * è°ƒç”¨çš„æ¥å£å…¨é™å®šåï¼ŒæœåŠ¡ç«¯æ ¹æ®å®ƒæ‰¾åˆ°å®ç°\n     */\n    private String interfaceName;\n    /**\n     * è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•å\n     */\n    private String methodName;\n    /**\n     * æ–¹æ³•è¿”å›ç±»å‹\n     */\n    private Class\u003c?\u003e returnType;\n    /**\n     * æ–¹æ³•å‚æ•°ç±»å‹æ•°ç»„\n     */\n    private Class[] parameterTypes;\n    /**\n     * æ–¹æ³•å‚æ•°å€¼æ•°ç»„\n     */\n    private Object[] parameterValue;\n\n    public RpcRequestMessage(int sequenceId, String interfaceName, String methodName, Class\u003c?\u003e returnType, Class[] parameterTypes, Object[] parameterValue) {\n        super.setSequenceId(sequenceId);\n        this.interfaceName = interfaceName;\n        this.methodName = methodName;\n        this.returnType = returnType;\n        this.parameterTypes = parameterTypes;\n        this.parameterValue = parameterValue;\n    }\n\n    @Override\n    public int getMessageType() {\n        return RPC_MESSAGE_TYPE_REQUEST;\n    }\n}\n```\n\nå“åº”æ¶ˆæ¯\n\n```java\n@Data\n@ToString(callSuper = true)\npublic class RpcResponseMessage extends Message {\n    /**\n     * è¿”å›å€¼\n     */\n    private Object returnValue;\n    /**\n     * å¼‚å¸¸å€¼\n     */\n    private Exception exceptionValue;\n\n    @Override\n    public int getMessageType() {\n        return RPC_MESSAGE_TYPE_RESPONSE;\n    }\n}\n```\n\næœåŠ¡å™¨æ¶å­\n\n```java\n@Slf4j\npublic class RpcServer {\n    public static void main(String[] args) {\n        NioEventLoopGroup boss = new NioEventLoopGroup();\n        NioEventLoopGroup worker = new NioEventLoopGroup();\n        LoggingHandler LOGGING_HANDLER = new LoggingHandler(LogLevel.DEBUG);\n        MessageCodecSharable MESSAGE_CODEC = new MessageCodecSharable();\n        \n        // rpc è¯·æ±‚æ¶ˆæ¯å¤„ç†å™¨ï¼Œå¾…å®ç°\n        RpcRequestMessageHandler RPC_HANDLER = new RpcRequestMessageHandler();\n        try {\n            ServerBootstrap serverBootstrap = new ServerBootstrap();\n            serverBootstrap.channel(NioServerSocketChannel.class);\n            serverBootstrap.group(boss, worker);\n            serverBootstrap.childHandler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    ch.pipeline().addLast(new ProcotolFrameDecoder());\n                    ch.pipeline().addLast(LOGGING_HANDLER);\n                    ch.pipeline().addLast(MESSAGE_CODEC);\n                    ch.pipeline().addLast(RPC_HANDLER);\n                }\n            });\n            Channel channel = serverBootstrap.bind(8080).sync().channel();\n            channel.closeFuture().sync();\n        } catch (InterruptedException e) {\n            log.error(\"server error\", e);\n        } finally {\n            boss.shutdownGracefully();\n            worker.shutdownGracefully();\n        }\n    }\n}\n```\n\nå®¢æˆ·ç«¯æ¶å­\n\n```java\npublic class RpcClient {\n    public static void main(String[] args) {\n        NioEventLoopGroup group = new NioEventLoopGroup();\n        LoggingHandler LOGGING_HANDLER = new LoggingHandler(LogLevel.DEBUG);\n        MessageCodecSharable MESSAGE_CODEC = new MessageCodecSharable();\n        \n        // rpc å“åº”æ¶ˆæ¯å¤„ç†å™¨ï¼Œå¾…å®ç°\n        RpcResponseMessageHandler RPC_HANDLER = new RpcResponseMessageHandler();\n        try {\n            Bootstrap bootstrap = new Bootstrap();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(group);\n            bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    ch.pipeline().addLast(new ProcotolFrameDecoder());\n                    ch.pipeline().addLast(LOGGING_HANDLER);\n                    ch.pipeline().addLast(MESSAGE_CODEC);\n                    ch.pipeline().addLast(RPC_HANDLER);\n                }\n            });\n            Channel channel = bootstrap.connect(\"localhost\", 8080).sync().channel();\n            channel.closeFuture().sync();\n        } catch (Exception e) {\n            log.error(\"client error\", e);\n        } finally {\n            group.shutdownGracefully();\n        }\n    }\n}\n```\n\næœåŠ¡å™¨ç«¯çš„ service è·å–\n\n```java\npublic class ServicesFactory {\n\n    static Properties properties;\n    static Map\u003cClass\u003c?\u003e, Object\u003e map = new ConcurrentHashMap\u003c\u003e();\n\n    static {\n        try (InputStream in = Config.class.getResourceAsStream(\"/application.properties\")) {\n            properties = new Properties();\n            properties.load(in);\n            Set\u003cString\u003e names = properties.stringPropertyNames();\n            for (String name : names) {\n                if (name.endsWith(\"Service\")) {\n                    Class\u003c?\u003e interfaceClass = Class.forName(name);\n                    Class\u003c?\u003e instanceClass = Class.forName(properties.getProperty(name));\n                    map.put(interfaceClass, instanceClass.newInstance());\n                }\n            }\n        } catch (IOException | ClassNotFoundException | InstantiationException | IllegalAccessException e) {\n            throw new ExceptionInInitializerError(e);\n        }\n    }\n\n    public static \u003cT\u003e T getService(Class\u003cT\u003e interfaceClass) {\n        return (T) map.get(interfaceClass);\n    }\n}\n```\n\nç›¸å…³é…ç½® application.properties\n\n```\nserializer.algorithm=Json\ncn.itcast.server.service.HelloService=cn.itcast.server.service.HelloServiceImpl\n```\n\n#### 2ï¼‰æœåŠ¡å™¨ handler\n\n```java\n@Slf4j\n@ChannelHandler.Sharable\npublic class RpcRequestMessageHandler extends SimpleChannelInboundHandler\u003cRpcRequestMessage\u003e {\n\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, RpcRequestMessage message) {\n        RpcResponseMessage response = new RpcResponseMessage();\n        response.setSequenceId(message.getSequenceId());\n        try {\n            // è·å–çœŸæ­£çš„å®ç°å¯¹è±¡\n            HelloService service = (HelloService)\n                    ServicesFactory.getService(Class.forName(message.getInterfaceName()));\n            \n            // è·å–è¦è°ƒç”¨çš„æ–¹æ³•\n            Method method = service.getClass().getMethod(message.getMethodName(), message.getParameterTypes());\n            \n            // è°ƒç”¨æ–¹æ³•\n            Object invoke = method.invoke(service, message.getParameterValue());\n            // è°ƒç”¨æˆåŠŸ\n            response.setReturnValue(invoke);\n        } catch (Exception e) {\n            e.printStackTrace();\n            // è°ƒç”¨å¼‚å¸¸\n            response.setExceptionValue(e);\n        }\n        // è¿”å›ç»“æœ\n        ctx.writeAndFlush(response);\n    }\n}\n```\n\n#### 3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ\n\nåªå‘æ¶ˆæ¯\n\n```java\n@Slf4j\npublic class RpcClient {\n    public static void main(String[] args) {\n        NioEventLoopGroup group = new NioEventLoopGroup();\n        LoggingHandler LOGGING_HANDLER = new LoggingHandler(LogLevel.DEBUG);\n        MessageCodecSharable MESSAGE_CODEC = new MessageCodecSharable();\n        RpcResponseMessageHandler RPC_HANDLER = new RpcResponseMessageHandler();\n        try {\n            Bootstrap bootstrap = new Bootstrap();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(group);\n            bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    ch.pipeline().addLast(new ProcotolFrameDecoder());\n                    ch.pipeline().addLast(LOGGING_HANDLER);\n                    ch.pipeline().addLast(MESSAGE_CODEC);\n                    ch.pipeline().addLast(RPC_HANDLER);\n                }\n            });\n            Channel channel = bootstrap.connect(\"localhost\", 8080).sync().channel();\n\n            ChannelFuture future = channel.writeAndFlush(new RpcRequestMessage(\n                    1,\n                    \"cn.itcast.server.service.HelloService\",\n                    \"sayHello\",\n                    String.class,\n                    new Class[]{String.class},\n                    new Object[]{\"å¼ ä¸‰\"}\n            )).addListener(promise -\u003e {\n                if (!promise.isSuccess()) {\n                    Throwable cause = promise.cause();\n                    log.error(\"error\", cause);\n                }\n            });\n\n            channel.closeFuture().sync();\n        } catch (Exception e) {\n            log.error(\"client error\", e);\n        } finally {\n            group.shutdownGracefully();\n        }\n    }\n}\n```\n\n#### 4ï¼‰å®¢æˆ·ç«¯ handler ç¬¬ä¸€ç‰ˆ\n\n```java\n@Slf4j\n@ChannelHandler.Sharable\npublic class RpcResponseMessageHandler extends SimpleChannelInboundHandler\u003cRpcResponseMessage\u003e {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, RpcResponseMessage msg) throws Exception {\n        log.debug(\"{}\", msg);\n    }\n}\n```\n\n#### 5ï¼‰å®¢æˆ·ç«¯ä»£ç  ç¬¬äºŒç‰ˆ\n\nåŒ…æ‹¬ channel ç®¡ç†ï¼Œä»£ç†ï¼Œæ¥æ”¶ç»“æœ\n\n```java\n@Slf4j\npublic class RpcClientManager {\n\n\n    public static void main(String[] args) {\n        HelloService service = getProxyService(HelloService.class);\n        System.out.println(service.sayHello(\"zhangsan\"));\n//        System.out.println(service.sayHello(\"lisi\"));\n//        System.out.println(service.sayHello(\"wangwu\"));\n    }\n\n    // åˆ›å»ºä»£ç†ç±»\n    public static \u003cT\u003e T getProxyService(Class\u003cT\u003e serviceClass) {\n        ClassLoader loader = serviceClass.getClassLoader();\n        Class\u003c?\u003e[] interfaces = new Class[]{serviceClass};\n        //                                                            sayHello  \"å¼ ä¸‰\"\n        Object o = Proxy.newProxyInstance(loader, interfaces, (proxy, method, args) -\u003e {\n            // 1. å°†æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸º æ¶ˆæ¯å¯¹è±¡\n            int sequenceId = SequenceIdGenerator.nextId();\n            RpcRequestMessage msg = new RpcRequestMessage(\n                    sequenceId,\n                    serviceClass.getName(),\n                    method.getName(),\n                    method.getReturnType(),\n                    method.getParameterTypes(),\n                    args\n            );\n            // 2. å°†æ¶ˆæ¯å¯¹è±¡å‘é€å‡ºå»\n            getChannel().writeAndFlush(msg);\n\n            // 3. å‡†å¤‡ä¸€ä¸ªç©º Promise å¯¹è±¡ï¼Œæ¥æ¥æ”¶ç»“æœ             æŒ‡å®š promise å¯¹è±¡å¼‚æ­¥æ¥æ”¶ç»“æœçº¿ç¨‹\n            DefaultPromise\u003cObject\u003e promise = new DefaultPromise\u003c\u003e(getChannel().eventLoop());\n            RpcResponseMessageHandler.PROMISES.put(sequenceId, promise);\n\n//            promise.addListener(future -\u003e {\n//                // çº¿ç¨‹\n//            });\n\n            // 4. ç­‰å¾… promise ç»“æœ\n            promise.await();\n            if(promise.isSuccess()) {\n                // è°ƒç”¨æ­£å¸¸\n                return promise.getNow();\n            } else {\n                // è°ƒç”¨å¤±è´¥\n                throw new RuntimeException(promise.cause());\n            }\n        });\n        return (T) o;\n    }\n\n    private static Channel channel = null;\n    private static final Object LOCK = new Object();\n\n    // è·å–å”¯ä¸€çš„ channel å¯¹è±¡\n    public static Channel getChannel() {\n        if (channel != null) {\n            return channel;\n        }\n        synchronized (LOCK) { //  t2\n            if (channel != null) { // t1\n                return channel;\n            }\n            initChannel();\n            return channel;\n        }\n    }\n\n    // åˆå§‹åŒ– channel æ–¹æ³•\n    private static void initChannel() {\n        NioEventLoopGroup group = new NioEventLoopGroup();\n        LoggingHandler LOGGING_HANDLER = new LoggingHandler(LogLevel.DEBUG);\n        MessageCodecSharable MESSAGE_CODEC = new MessageCodecSharable();\n        RpcResponseMessageHandler RPC_HANDLER = new RpcResponseMessageHandler();\n        Bootstrap bootstrap = new Bootstrap();\n        bootstrap.channel(NioSocketChannel.class);\n        bootstrap.group(group);\n        bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n            @Override\n            protected void initChannel(SocketChannel ch) throws Exception {\n                ch.pipeline().addLast(new ProcotolFrameDecoder());\n                ch.pipeline().addLast(LOGGING_HANDLER);\n                ch.pipeline().addLast(MESSAGE_CODEC);\n                ch.pipeline().addLast(RPC_HANDLER);\n            }\n        });\n        try {\n            channel = bootstrap.connect(\"localhost\", 8080).sync().channel();\n            channel.closeFuture().addListener(future -\u003e {\n                group.shutdownGracefully();\n            });\n        } catch (Exception e) {\n            log.error(\"client error\", e);\n        }\n    }\n}\n```\n\n#### 6ï¼‰å®¢æˆ·ç«¯ handler ç¬¬äºŒç‰ˆ\n\n```java\n@Slf4j\n@ChannelHandler.Sharable\npublic class RpcResponseMessageHandler extends SimpleChannelInboundHandler\u003cRpcResponseMessage\u003e {\n\n    //                       åºå·      ç”¨æ¥æ¥æ”¶ç»“æœçš„ promise å¯¹è±¡\n    public static final Map\u003cInteger, Promise\u003cObject\u003e\u003e PROMISES = new ConcurrentHashMap\u003c\u003e();\n\n    @Override\n\n    protected void channelRead0(ChannelHandlerContext ctx, RpcResponseMessage msg) throws Exception {\n        log.debug(\"{}\", msg);\n        // æ‹¿åˆ°ç©ºçš„ promise\n        Promise\u003cObject\u003e promise = PROMISES.remove(msg.getSequenceId());\n        if (promise != null) {\n            Object returnValue = msg.getReturnValue();\n            Exception exceptionValue = msg.getExceptionValue();\n            if(exceptionValue != null) {\n                promise.setFailure(exceptionValue);\n            } else {\n                promise.setSuccess(returnValue);\n            }\n        }\n    }\n}\n```\n\n![[z-oblib/z2-attachments/Pasted image 20220624192123.png]]\n\n## 2. æºç åˆ†æ\n\n### 2.1 å¯åŠ¨å‰–æ\n\nä¸»è¦æ­¥éª¤ï¼š\n1. æ‰“å¼€select\n2. æ‰“å¼€ssc\n3. channelç»‘å®šåˆ°selectä¸Š\n4. é€šè¿‡selectionKeyå…³æ³¨acceptäº‹ä»¶\n\n![[z-oblib/z2-attachments/Pasted image 20220624213014.png]]\n\næˆ‘ä»¬å°±æ¥çœ‹çœ‹ netty ä¸­å¯¹ä¸‹é¢çš„ä»£ç æ˜¯æ€æ ·è¿›è¡Œå¤„ç†çš„\n\n```java\n//1 netty ä¸­ä½¿ç”¨ NioEventLoopGroup ï¼ˆç®€ç§° nio boss çº¿ç¨‹ï¼‰æ¥å°è£…çº¿ç¨‹å’Œ selector\nSelector selector = Selector.open(); \n\n//2 åˆ›å»º NioServerSocketChannelï¼ŒåŒæ—¶ä¼šåˆå§‹åŒ–å®ƒå…³è”çš„ handlerï¼Œä»¥åŠä¸ºåŸç”Ÿ ssc å­˜å‚¨ config\nNioServerSocketChannel attachment = new NioServerSocketChannel();\n\n//3 åˆ›å»º NioServerSocketChannel æ—¶ï¼Œåˆ›å»ºäº† java åŸç”Ÿçš„ ServerSocketChannel\nServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); \nserverSocketChannel.configureBlocking(false);\n\n//4 å¯åŠ¨ nio boss çº¿ç¨‹æ‰§è¡Œæ¥ä¸‹æ¥çš„æ“ä½œ\n\n//5 æ³¨å†Œï¼ˆä»…å…³è” selector å’Œ NioServerSocketChannelï¼‰ï¼Œæœªå…³æ³¨äº‹ä»¶\nSelectionKey selectionKey = serverSocketChannel.register(selector, 0, attachment);\n\n//6 head -\u003e åˆå§‹åŒ–å™¨ -\u003e ServerBootstrapAcceptor -\u003e tailï¼Œåˆå§‹åŒ–å™¨æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œåªä¸ºæ·»åŠ  acceptor\n\n//7 ç»‘å®šç«¯å£\nserverSocketChannel.bind(new InetSocketAddress(8080));\n\n//8 è§¦å‘ channel active äº‹ä»¶ï¼Œåœ¨ head ä¸­å…³æ³¨ op_accept äº‹ä»¶\nselectionKey.interestOps(SelectionKey.OP_ACCEPT);\n```\n\nå…¥å£ `io.netty.bootstrap.ServerBootstrap#bind`\n\nå…³é”®ä»£ç  `io.netty.bootstrap.AbstractBootstrap#doBind`\n\n```java\nprivate ChannelFuture doBind(final SocketAddress localAddress) {\n\t// 1. æ‰§è¡Œåˆå§‹åŒ–å’Œæ³¨å†Œ regFuture ä¼šç”± initAndRegister è®¾ç½®å…¶æ˜¯å¦å®Œæˆï¼Œä»è€Œå›è°ƒ 3.2 å¤„ä»£ç \n    final ChannelFuture regFuture = initAndRegister();\n    final Channel channel = regFuture.channel();\n    if (regFuture.cause() != null) {\n        return regFuture;\n    }\n\n    // 2. å› ä¸ºæ˜¯ initAndRegister å¼‚æ­¥æ‰§è¡Œï¼Œéœ€è¦åˆ†ä¸¤ç§æƒ…å†µæ¥çœ‹ï¼Œè°ƒè¯•æ—¶ä¹Ÿéœ€è¦é€šè¿‡ suspend æ–­ç‚¹ç±»å‹åŠ ä»¥åŒºåˆ†\n    // 2.1 å¦‚æœå·²ç»å®Œæˆ\n    if (regFuture.isDone()) {\n        ChannelPromise promise = channel.newPromise();\n        // 3.1 ç«‹åˆ»è°ƒç”¨ doBind0\n        doBind0(regFuture, channel, localAddress, promise);\n        return promise;\n    } \n    // 2.2 è¿˜æ²¡æœ‰å®Œæˆ\n    else {\n        final PendingRegistrationPromise promise = new PendingRegistrationPromise(channel);\n        // 3.2 å›è°ƒ doBind0\n        regFuture.addListener(new ChannelFutureListener() {\n            @Override\n            public void operationComplete(ChannelFuture future) throws Exception {\n                Throwable cause = future.cause();\n                if (cause != null) {\n                    // å¤„ç†å¼‚å¸¸...\n                    promise.setFailure(cause);\n                } else {\n                    promise.registered();\n\t\t\t\t\t// 3. ç”±æ³¨å†Œçº¿ç¨‹å»æ‰§è¡Œ doBind0\n                    doBind0(regFuture, channel, localAddress, promise);\n                }\n            }\n        });\n        return promise;\n    }\n}\n```\n\nå…³é”®ä»£ç  `io.netty.bootstrap.AbstractBootstrap#initAndRegister`\n\n```java\nfinal ChannelFuture initAndRegister() {\n    Channel channel = null;\n    try {\n        channel = channelFactory.newChannel();\n        // 1.1 åˆå§‹åŒ– - åšçš„äº‹å°±æ˜¯æ·»åŠ ä¸€ä¸ªåˆå§‹åŒ–å™¨ ChannelInitializer\n        init(channel);\n    } catch (Throwable t) {\n        // å¤„ç†å¼‚å¸¸...\n        return new DefaultChannelPromise(new FailedChannel(), GlobalEventExecutor.INSTANCE).setFailure(t);\n    }\n\n    // 1.2 æ³¨å†Œ - åšçš„äº‹å°±æ˜¯å°†åŸç”Ÿ channel æ³¨å†Œåˆ° selector ä¸Š\n    ChannelFuture regFuture = config().group().register(channel);\n    if (regFuture.cause() != null) {\n        // å¤„ç†å¼‚å¸¸...\n    }\n    return regFuture;\n}\n```\n\nå…³é”®ä»£ç  `io.netty.bootstrap.ServerBootstrap#init`\n\n```java\n// è¿™é‡Œ channel å®é™…ä¸Šæ˜¯ NioServerSocketChannel\nvoid init(Channel channel) throws Exception {\n    final Map\u003cChannelOption\u003c?\u003e, Object\u003e options = options0();\n    synchronized (options) {\n        setChannelOptions(channel, options, logger);\n    }\n\n    final Map\u003cAttributeKey\u003c?\u003e, Object\u003e attrs = attrs0();\n    synchronized (attrs) {\n        for (Entry\u003cAttributeKey\u003c?\u003e, Object\u003e e: attrs.entrySet()) {\n            @SuppressWarnings(\"unchecked\")\n            AttributeKey\u003cObject\u003e key = (AttributeKey\u003cObject\u003e) e.getKey();\n            channel.attr(key).set(e.getValue());\n        }\n    }\n\n    ChannelPipeline p = channel.pipeline();\n\n    final EventLoopGroup currentChildGroup = childGroup;\n    final ChannelHandler currentChildHandler = childHandler;\n    final Entry\u003cChannelOption\u003c?\u003e, Object\u003e[] currentChildOptions;\n    final Entry\u003cAttributeKey\u003c?\u003e, Object\u003e[] currentChildAttrs;\n    synchronized (childOptions) {\n        currentChildOptions = childOptions.entrySet().toArray(newOptionArray(0));\n    }\n    synchronized (childAttrs) {\n        currentChildAttrs = childAttrs.entrySet().toArray(newAttrArray(0));\n    }\n\t\n    // ä¸º NioServerSocketChannel æ·»åŠ åˆå§‹åŒ–å™¨\n    p.addLast(new ChannelInitializer\u003cChannel\u003e() {\n        @Override\n        public void initChannel(final Channel ch) throws Exception {\n            final ChannelPipeline pipeline = ch.pipeline();\n            ChannelHandler handler = config.handler();\n            if (handler != null) {\n                pipeline.addLast(handler);\n            }\n\n            // åˆå§‹åŒ–å™¨çš„èŒè´£æ˜¯å°† ServerBootstrapAcceptor åŠ å…¥è‡³ NioServerSocketChannel\n            ch.eventLoop().execute(new Runnable() {\n                @Override\n                public void run() {\n                    pipeline.addLast(new ServerBootstrapAcceptor(\n                            ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs));\n                }\n            });\n        }\n    });\n}\n```\n\nå…³é”®ä»£ç  `io.netty.channel.AbstractChannel.AbstractUnsafe#register`\n\n```java\npublic final void register(EventLoop eventLoop, final ChannelPromise promise) {\n    // ä¸€äº›æ£€æŸ¥ï¼Œç•¥...\n\n    AbstractChannel.this.eventLoop = eventLoop;\n\n    if (eventLoop.inEventLoop()) {\n        register0(promise);\n    } else {\n        try {\n            // é¦–æ¬¡æ‰§è¡Œ execute æ–¹æ³•æ—¶ï¼Œä¼šå¯åŠ¨ nio çº¿ç¨‹ï¼Œä¹‹åæ³¨å†Œç­‰æ“ä½œåœ¨ nio çº¿ç¨‹ä¸Šæ‰§è¡Œ\n            // å› ä¸ºåªæœ‰ä¸€ä¸ª NioServerSocketChannel å› æ­¤ï¼Œä¹Ÿåªä¼šæœ‰ä¸€ä¸ª boss nio çº¿ç¨‹\n            // è¿™è¡Œä»£ç å®Œæˆçš„äº‹å®æ˜¯ main -\u003e nio boss çº¿ç¨‹çš„åˆ‡æ¢\n            eventLoop.execute(new Runnable() {\n                @Override\n                public void run() {\n                    register0(promise);\n                }\n            });\n        } catch (Throwable t) {\n            // æ—¥å¿—è®°å½•...\n            closeForcibly();\n            closeFuture.setClosed();\n            safeSetFailure(promise, t);\n        }\n    }\n}\n```\n\n`io.netty.channel.AbstractChannel.AbstractUnsafe#register0`\n\n```java\nprivate void register0(ChannelPromise promise) {\n    try {\n        if (!promise.setUncancellable() || !ensureOpen(promise)) {\n            return;\n        }\n        boolean firstRegistration = neverRegistered;\n        // 1.2.1 åŸç”Ÿçš„ nio channel ç»‘å®šåˆ° selector ä¸Šï¼Œæ³¨æ„æ­¤æ—¶æ²¡æœ‰æ³¨å†Œ selector å…³æ³¨äº‹ä»¶ï¼Œé™„ä»¶ä¸º NioServerSocketChannel\n        doRegister();\n        neverRegistered = false;\n        registered = true;\n\n        // 1.2.2 æ‰§è¡Œ NioServerSocketChannel åˆå§‹åŒ–å™¨çš„ initChannel\n        pipeline.invokeHandlerAddedIfNeeded();\n\n        // å›è°ƒ 3.2 io.netty.bootstrap.AbstractBootstrap#doBind0\n        safeSetSuccess(promise);\n        pipeline.fireChannelRegistered();\n        \n        // å¯¹åº” server socket channel è¿˜æœªç»‘å®šï¼ŒisActive ä¸º false\n        if (isActive()) {\n            if (firstRegistration) {\n                pipeline.fireChannelActive();\n            } else if (config().isAutoRead()) {\n                beginRead();\n            }\n        }\n    } catch (Throwable t) {\n        // Close the channel directly to avoid FD leak.\n        closeForcibly();\n        closeFuture.setClosed();\n        safeSetFailure(promise, t);\n    }\n}\n```\n\nå…³é”®ä»£ç  `io.netty.channel.ChannelInitializer#initChannel`\n\n```java\nprivate boolean initChannel(ChannelHandlerContext ctx) throws Exception {\n    if (initMap.add(ctx)) { // Guard against re-entrance.\n        try {\n            // 1.2.2.1 æ‰§è¡Œåˆå§‹åŒ–\n            initChannel((C) ctx.channel());\n        } catch (Throwable cause) {\n            exceptionCaught(ctx, cause);\n        } finally {\n            // 1.2.2.2 ç§»é™¤åˆå§‹åŒ–å™¨\n            ChannelPipeline pipeline = ctx.pipeline();\n            if (pipeline.context(this) != null) {\n                pipeline.remove(this);\n            }\n        }\n        return true;\n    }\n    return false;\n}\n```\n\nå…³é”®ä»£ç  `io.netty.bootstrap.AbstractBootstrap#doBind0`\n\n```java\n// 3.1 æˆ– 3.2 æ‰§è¡Œ doBind0\nprivate static void doBind0(\n        final ChannelFuture regFuture, final Channel channel,\n        final SocketAddress localAddress, final ChannelPromise promise) {\n\n    channel.eventLoop().execute(new Runnable() {\n        @Override\n        public void run() {\n            if (regFuture.isSuccess()) {\n                channel.bind(localAddress, promise).addListener(ChannelFutureListener.CLOSE_ON_FAILURE);\n            } else {\n                promise.setFailure(regFuture.cause());\n            }\n        }\n    });\n}\n```\n\nå…³é”®ä»£ç  `io.netty.channel.AbstractChannel.AbstractUnsafe#bind`\n\n```java\npublic final void bind(final SocketAddress localAddress, final ChannelPromise promise) {\n    assertEventLoop();\n\n    if (!promise.setUncancellable() || !ensureOpen(promise)) {\n        return;\n    }\n\n    if (Boolean.TRUE.equals(config().getOption(ChannelOption.SO_BROADCAST)) \u0026\u0026\n        localAddress instanceof InetSocketAddress \u0026\u0026\n        !((InetSocketAddress) localAddress).getAddress().isAnyLocalAddress() \u0026\u0026\n        !PlatformDependent.isWindows() \u0026\u0026 !PlatformDependent.maybeSuperUser()) {\n        // è®°å½•æ—¥å¿—...\n    }\n\n    boolean wasActive = isActive();\n    try {\n        // 3.3 æ‰§è¡Œç«¯å£ç»‘å®š\n        doBind(localAddress);\n    } catch (Throwable t) {\n        safeSetFailure(promise, t);\n        closeIfClosed();\n        return;\n    }\n\n    if (!wasActive \u0026\u0026 isActive()) {\n        invokeLater(new Runnable() {\n            @Override\n            public void run() {\n                // 3.4 è§¦å‘ active äº‹ä»¶\n                pipeline.fireChannelActive();\n            }\n        });\n    }\n\n    safeSetSuccess(promise);\n}\n```\n\n3.3 å…³é”®ä»£ç  `io.netty.channel.socket.nio.NioServerSocketChannel#doBind`\n\n```java\nprotected void doBind(SocketAddress localAddress) throws Exception {\n    if (PlatformDependent.javaVersion() \u003e= 7) {\n        javaChannel().bind(localAddress, config.getBacklog());\n    } else {\n        javaChannel().socket().bind(localAddress, config.getBacklog());\n    }\n}\n```\n\n3.4 å…³é”®ä»£ç  `io.netty.channel.DefaultChannelPipeline.HeadContext#channelActive`\n\n```java\npublic void channelActive(ChannelHandlerContext ctx) {\n    ctx.fireChannelActive();\n\t// è§¦å‘ read (NioServerSocketChannel ä¸Šçš„ read ä¸æ˜¯è¯»å–æ•°æ®ï¼Œåªæ˜¯ä¸ºäº†è§¦å‘ channel çš„äº‹ä»¶æ³¨å†Œ)\n    readIfIsAutoRead();\n}\n```\n\nå…³é”®ä»£ç  `io.netty.channel.nio.AbstractNioChannel#doBeginRead`\n\n```java\nprotected void doBeginRead() throws Exception {\n    // Channel.read() or ChannelHandlerContext.read() was called\n    final SelectionKey selectionKey = this.selectionKey;\n    if (!selectionKey.isValid()) {\n        return;\n    }\n\n    readPending = true;\n\n    final int interestOps = selectionKey.interestOps();\n    // readInterestOp å–å€¼æ˜¯ 16ï¼Œåœ¨ NioServerSocketChannel åˆ›å»ºæ—¶åˆå§‹åŒ–å¥½ï¼Œä»£è¡¨å…³æ³¨ accept äº‹ä»¶\n    if ((interestOps \u0026 readInterestOp) == 0) {\n        selectionKey.interestOps(interestOps | readInterestOp);\n    }\n}\n```\n\n### 2.2 NioEventLoop å‰–æ\n\n![[z-oblib/z2-attachments/Pasted image 20220624231611.png]]\n\nNioEventLoop çº¿ç¨‹ä¸ä»…è¦å¤„ç† IO äº‹ä»¶ï¼Œè¿˜è¦å¤„ç† Taskï¼ˆåŒ…æ‹¬æ™®é€šä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡ï¼‰ï¼Œ\n\næäº¤ä»»åŠ¡ä»£ç  `io.netty.util.concurrent.SingleThreadEventExecutor#execute`\n\n```java\npublic void execute(Runnable task) {\n    if (task == null) {\n        throw new NullPointerException(\"task\");\n    }\n\n    boolean inEventLoop = inEventLoop();\n    // æ·»åŠ ä»»åŠ¡ï¼Œå…¶ä¸­é˜Ÿåˆ—ä½¿ç”¨äº† jctools æä¾›çš„ mpsc æ— é”é˜Ÿåˆ—\n    addTask(task);\n    if (!inEventLoop) {\n        // inEventLoop å¦‚æœä¸º false è¡¨ç¤ºç”±å…¶å®ƒçº¿ç¨‹æ¥è°ƒç”¨ executeï¼Œå³é¦–æ¬¡è°ƒç”¨ï¼Œè¿™æ—¶éœ€è¦å‘ eventLoop æäº¤é¦–ä¸ªä»»åŠ¡ï¼Œå¯åŠ¨æ­»å¾ªç¯ï¼Œä¼šæ‰§è¡Œåˆ°ä¸‹é¢çš„ doStartThread\n        startThread();\n        if (isShutdown()) {\n            // å¦‚æœå·²ç» shutdownï¼Œåšæ‹’ç»é€»è¾‘ï¼Œä»£ç ç•¥...\n        }\n    }\n\n    if (!addTaskWakesUp \u0026\u0026 wakesUpForTask(task)) {\n        // å¦‚æœçº¿ç¨‹ç”±äº IO select é˜»å¡äº†ï¼Œæ·»åŠ çš„ä»»åŠ¡çš„çº¿ç¨‹éœ€è¦è´Ÿè´£å”¤é†’ NioEventLoop çº¿ç¨‹\n        wakeup(inEventLoop);\n    }\n}\n```\n\nå”¤é†’ select é˜»å¡çº¿ç¨‹`io.netty.channel.nio.NioEventLoop#wakeup`\n\n```java\n@Override\nprotected void wakeup(boolean inEventLoop) {\n    if (!inEventLoop \u0026\u0026 wakenUp.compareAndSet(false, true)) {\n        selector.wakeup();\n    }\n}\n```\n\nå¯åŠ¨ EventLoop ä¸»å¾ªç¯ `io.netty.util.concurrent.SingleThreadEventExecutor#doStartThread`\n\n```java\nprivate void doStartThread() {\n    assert thread == null;\n    executor.execute(new Runnable() {\n        @Override\n        public void run() {\n            // å°†çº¿ç¨‹æ± çš„å½“å‰çº¿ç¨‹ä¿å­˜åœ¨æˆå‘˜å˜é‡ä¸­ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨\n            thread = Thread.currentThread();\n            if (interrupted) {\n                thread.interrupt();\n            }\n\n            boolean success = false;\n            updateLastExecutionTime();\n            try {\n                // è°ƒç”¨å¤–éƒ¨ç±» SingleThreadEventExecutor çš„ run æ–¹æ³•ï¼Œè¿›å…¥æ­»å¾ªç¯ï¼Œrun æ–¹æ³•è§ä¸‹\n                SingleThreadEventExecutor.this.run();\n                success = true;\n            } catch (Throwable t) {\n                logger.warn(\"Unexpected exception from an event executor: \", t);\n            } finally {\n\t\t\t\t// æ¸…ç†å·¥ä½œï¼Œä»£ç ç•¥...\n            }\n        }\n    });\n}\n```\n\n`io.netty.channel.nio.NioEventLoop#run` ä¸»è¦ä»»åŠ¡æ˜¯æ‰§è¡Œæ­»å¾ªç¯ï¼Œä¸æ–­çœ‹æœ‰æ²¡æœ‰æ–°ä»»åŠ¡ï¼Œæœ‰æ²¡æœ‰ IO äº‹ä»¶\n\n```java\nprotected void run() {\n    for (;;) {\n        try {\n            try {\n                // calculateStrategy çš„é€»è¾‘å¦‚ä¸‹ï¼š\n                // æœ‰ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡ selectNowï¼Œæ¸…é™¤ä¸Šä¸€æ¬¡çš„ wakeup ç»“æœï¼Œæ— è®ºæœ‰æ²¡æœ‰ IO äº‹ä»¶ï¼Œéƒ½ä¼šè·³è¿‡ switch\n                // æ²¡æœ‰ä»»åŠ¡ï¼Œä¼šåŒ¹é… SelectStrategy.SELECTï¼Œçœ‹æ˜¯å¦åº”å½“é˜»å¡\n                switch (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) {\n                    case SelectStrategy.CONTINUE:\n                        continue;\n\n                    case SelectStrategy.BUSY_WAIT:\n\n                    case SelectStrategy.SELECT:\n                        // å› ä¸º IO çº¿ç¨‹å’Œæäº¤ä»»åŠ¡çº¿ç¨‹éƒ½æœ‰å¯èƒ½æ‰§è¡Œ wakeupï¼Œè€Œ wakeup å±äºæ¯”è¾ƒæ˜‚è´µçš„æ“ä½œï¼Œå› æ­¤ä½¿ç”¨äº†ä¸€ä¸ªåŸå­å¸ƒå°”å¯¹è±¡ wakenUpï¼Œå®ƒå–å€¼ä¸º true æ—¶ï¼Œè¡¨ç¤ºè¯¥ç”±å½“å‰çº¿ç¨‹å”¤é†’\n                        // è¿›è¡Œ select é˜»å¡ï¼Œå¹¶è®¾ç½®å”¤é†’çŠ¶æ€ä¸º false\n                        boolean oldWakenUp = wakenUp.getAndSet(false);\n                        \n                        // å¦‚æœåœ¨è¿™ä¸ªä½ç½®ï¼Œé EventLoop çº¿ç¨‹æŠ¢å…ˆå°† wakenUp ç½®ä¸º trueï¼Œå¹¶ wakeup\n                        // ä¸‹é¢çš„ select æ–¹æ³•ä¸ä¼šé˜»å¡\n                        // ç­‰ runAllTasks å¤„ç†å®Œæˆåï¼Œåˆ°å†å¾ªç¯è¿›æ¥è¿™ä¸ªé˜¶æ®µæ–°å¢çš„ä»»åŠ¡ä¼šä¸ä¼šåŠæ—¶æ‰§è¡Œå‘¢?\n                        // å› ä¸º oldWakenUp ä¸º trueï¼Œå› æ­¤ä¸‹é¢çš„ select æ–¹æ³•å°±ä¼šé˜»å¡ï¼Œç›´åˆ°è¶…æ—¶\n                        // æ‰èƒ½æ‰§è¡Œï¼Œè®© select æ–¹æ³•æ— è°“é˜»å¡\n                        select(oldWakenUp);\n\n                        if (wakenUp.get()) {\n                            selector.wakeup();\n                        }\n                    default:\n                }\n            } catch (IOException e) {\n                rebuildSelector0();\n                handleLoopException(e);\n                continue;\n            }\n\n            cancelledKeys = 0;\n            needsToSelectAgain = false;\n            // ioRatio é»˜è®¤æ˜¯ 50\n            final int ioRatio = this.ioRatio;\n            if (ioRatio == 100) {\n                try {\n                    processSelectedKeys();\n                } finally {\n                    // ioRatio ä¸º 100 æ—¶ï¼Œæ€»æ˜¯è¿è¡Œå®Œæ‰€æœ‰é IO ä»»åŠ¡\n                    runAllTasks();\n                }\n            } else {                \n                final long ioStartTime = System.nanoTime();\n                try {\n                    processSelectedKeys();\n                } finally {\n                    // è®°å½• io äº‹ä»¶å¤„ç†è€—æ—¶\n                    final long ioTime = System.nanoTime() - ioStartTime;\n                    // è¿è¡Œé IO ä»»åŠ¡ï¼Œä¸€æ—¦è¶…æ—¶ä¼šé€€å‡º runAllTasks\n                    runAllTasks(ioTime * (100 - ioRatio) / ioRatio);\n                }\n            }\n        } catch (Throwable t) {\n            handleLoopException(t);\n        }\n        try {\n            if (isShuttingDown()) {\n                closeAll();\n                if (confirmShutdown()) {\n                    return;\n                }\n            }\n        } catch (Throwable t) {\n            handleLoopException(t);\n        }\n    }\n}\n```\n\n#### âš ï¸ æ³¨æ„\n\n\u003e è¿™é‡Œæœ‰ä¸ªè´¹è§£çš„åœ°æ–¹å°±æ˜¯ wakeupï¼Œå®ƒæ—¢å¯ä»¥ç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ¥è°ƒç”¨ï¼ˆæ¯”è¾ƒå¥½ç†è§£ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”± EventLoop çº¿ç¨‹æ¥è°ƒç”¨ï¼ˆæ¯”è¾ƒè´¹è§£ï¼‰ï¼Œè¿™é‡Œè¦çŸ¥é“ wakeup æ–¹æ³•çš„æ•ˆæœï¼š\n\u003e\n\u003e * ç”±é EventLoop çº¿ç¨‹è°ƒç”¨ï¼Œä¼šå”¤é†’å½“å‰åœ¨æ‰§è¡Œ select é˜»å¡çš„ EventLoop çº¿ç¨‹\n\u003e * ç”± EventLoop è‡ªå·±è°ƒç”¨ï¼Œä¼šæœ¬æ¬¡çš„ wakeup ä¼šå–æ¶ˆä¸‹ä¸€æ¬¡çš„ select æ“ä½œ\n\n\n\nå‚è€ƒä¸‹å›¾\n\n![[z-oblib/z2-attachments/0032.png]]\n\n\n\n`io.netty.channel.nio.NioEventLoop#select`\n\n```java\nprivate void select(boolean oldWakenUp) throws IOException {\n    Selector selector = this.selector;\n    try {\n        int selectCnt = 0;\n        long currentTimeNanos = System.nanoTime();\n        // è®¡ç®—ç­‰å¾…æ—¶é—´\n        // * æ²¡æœ‰ scheduledTaskï¼Œè¶…æ—¶æ—¶é—´ä¸º 1s\n        // * æœ‰ scheduledTaskï¼Œè¶…æ—¶æ—¶é—´ä¸º `ä¸‹ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´ - å½“å‰æ—¶é—´`\n        long selectDeadLineNanos = currentTimeNanos + delayNanos(currentTimeNanos);\n\n        for (;;) {\n            long timeoutMillis = (selectDeadLineNanos - currentTimeNanos + 500000L) / 1000000L;\n            // å¦‚æœè¶…æ—¶ï¼Œé€€å‡ºå¾ªç¯\n            if (timeoutMillis \u003c= 0) {\n                if (selectCnt == 0) {\n                    selector.selectNow();\n                    selectCnt = 1;\n                }\n                break;\n            }\n\n            // å¦‚æœæœŸé—´åˆæœ‰ task é€€å‡ºå¾ªç¯ï¼Œå¦‚æœæ²¡è¿™ä¸ªåˆ¤æ–­ï¼Œé‚£ä¹ˆä»»åŠ¡å°±ä¼šç­‰åˆ°ä¸‹æ¬¡ select è¶…æ—¶æ—¶æ‰èƒ½è¢«æ‰§è¡Œ\n            // wakenUp.compareAndSet(false, true) æ˜¯è®©é NioEventLoop ä¸å¿…å†æ‰§è¡Œ wakeup\n            if (hasTasks() \u0026\u0026 wakenUp.compareAndSet(false, true)) {\n                selector.selectNow();\n                selectCnt = 1;\n                break;\n            }\n\n            // select æœ‰é™æ—¶é˜»å¡\n            // æ³¨æ„ nio æœ‰ bugï¼Œå½“ bug å‡ºç°æ—¶ï¼Œselect æ–¹æ³•å³ä½¿æ²¡æœ‰æ—¶é—´å‘ç”Ÿï¼Œä¹Ÿä¸ä¼šé˜»å¡ä½ï¼Œå¯¼è‡´ä¸æ–­ç©ºè½®è¯¢ï¼Œcpu å ç”¨ 100%\n            int selectedKeys = selector.select(timeoutMillis);\n            // è®¡æ•°åŠ  1\n            selectCnt ++;\n\n            // é†’æ¥åï¼Œå¦‚æœæœ‰ IO äº‹ä»¶ã€æˆ–æ˜¯ç”±é EventLoop çº¿ç¨‹å”¤é†’ï¼Œæˆ–è€…æœ‰ä»»åŠ¡ï¼Œé€€å‡ºå¾ªç¯\n            if (selectedKeys != 0 || oldWakenUp || wakenUp.get() || hasTasks() || hasScheduledTasks()) {\n                break;\n            }\n            if (Thread.interrupted()) {\n               \t// çº¿ç¨‹è¢«æ‰“æ–­ï¼Œé€€å‡ºå¾ªç¯\n                // è®°å½•æ—¥å¿—\n                selectCnt = 1;\n                break;\n            }\n\n            long time = System.nanoTime();\n            if (time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) \u003e= currentTimeNanos) {\n                // å¦‚æœè¶…æ—¶ï¼Œè®¡æ•°é‡ç½®ä¸º 1ï¼Œä¸‹æ¬¡å¾ªç¯å°±ä¼š break\n                selectCnt = 1;\n            } \n            // è®¡æ•°è¶…è¿‡é˜ˆå€¼ï¼Œç”± io.netty.selectorAutoRebuildThreshold æŒ‡å®šï¼Œé»˜è®¤ 512\n            // è¿™æ˜¯ä¸ºäº†è§£å†³ nio ç©ºè½®è¯¢ bug\n            else if (SELECTOR_AUTO_REBUILD_THRESHOLD \u003e 0 \u0026\u0026\n                    selectCnt \u003e= SELECTOR_AUTO_REBUILD_THRESHOLD) {\n                // é‡å»º selector\n                selector = selectRebuildSelector(selectCnt);\n                selectCnt = 1;\n                break;\n            }\n\n            currentTimeNanos = time;\n        }\n\n        if (selectCnt \u003e MIN_PREMATURE_SELECTOR_RETURNS) {\n            // è®°å½•æ—¥å¿—\n        }\n    } catch (CancelledKeyException e) {\n        // è®°å½•æ—¥å¿—\n    }\n}\n```\n\nå¤„ç† keys `io.netty.channel.nio.NioEventLoop#processSelectedKeys`\n\n```java\nprivate void processSelectedKeys() {\n    if (selectedKeys != null) {\n        // é€šè¿‡åå°„å°† Selector å®ç°ç±»ä¸­çš„å°±ç»ªäº‹ä»¶é›†åˆæ›¿æ¢ä¸º SelectedSelectionKeySet \n        // SelectedSelectionKeySet åº•å±‚ä¸ºæ•°ç»„å®ç°ï¼Œå¯ä»¥æé«˜éå†æ€§èƒ½ï¼ˆåŸæœ¬ä¸º HashSetï¼‰\n        processSelectedKeysOptimized();\n    } else {\n        processSelectedKeysPlain(selector.selectedKeys());\n    }\n}\n```\n\n`io.netty.channel.nio.NioEventLoop#processSelectedKey`\n\n```java\nprivate void processSelectedKey(SelectionKey k, AbstractNioChannel ch) {\n    final AbstractNioChannel.NioUnsafe unsafe = ch.unsafe();\n    // å½“ key å–æ¶ˆæˆ–å…³é—­æ—¶ä¼šå¯¼è‡´è¿™ä¸ª key æ— æ•ˆ\n    if (!k.isValid()) {\n        // æ— æ•ˆæ—¶å¤„ç†...\n        return;\n    }\n\n    try {\n        int readyOps = k.readyOps();\n        // è¿æ¥äº‹ä»¶\n        if ((readyOps \u0026 SelectionKey.OP_CONNECT) != 0) {\n            int ops = k.interestOps();\n            ops \u0026= ~SelectionKey.OP_CONNECT;\n            k.interestOps(ops);\n\n            unsafe.finishConnect();\n        }\n\n        // å¯å†™äº‹ä»¶\n        if ((readyOps \u0026 SelectionKey.OP_WRITE) != 0) {\n            ch.unsafe().forceFlush();\n        }\n\n        // å¯è¯»æˆ–å¯æ¥å…¥äº‹ä»¶\n        if ((readyOps \u0026 (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != 0 || readyOps == 0) {\n            // å¦‚æœæ˜¯å¯æ¥å…¥ io.netty.channel.nio.AbstractNioMessageChannel.NioMessageUnsafe#read\n            // å¦‚æœæ˜¯å¯è¯» io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read\n            unsafe.read();\n        }\n    } catch (CancelledKeyException ignored) {\n        unsafe.close(unsafe.voidPromise());\n    }\n}\n```\n\n### 2.3 accept å‰–æ\n\nnio ä¸­å¦‚ä¸‹ä»£ç ï¼Œåœ¨ netty ä¸­çš„æµç¨‹\n\n```java\n//1 é˜»å¡ç›´åˆ°äº‹ä»¶å‘ç”Ÿ\nselector.select();\n\nIterator\u003cSelectionKey\u003e iter = selector.selectedKeys().iterator();\nwhile (iter.hasNext()) {    \n    //2 æ‹¿åˆ°ä¸€ä¸ªäº‹ä»¶\n    SelectionKey key = iter.next();\n    \n    //3 å¦‚æœæ˜¯ accept äº‹ä»¶\n    if (key.isAcceptable()) {\n        \n        //4 æ‰§è¡Œ accept\n        SocketChannel channel = serverSocketChannel.accept();\n        channel.configureBlocking(false);\n        \n        //5 å…³æ³¨ read äº‹ä»¶\n        channel.register(selector, SelectionKey.OP_READ);\n    }\n    // ...\n}\n```\n\nå…ˆæ¥çœ‹å¯æ¥å…¥äº‹ä»¶å¤„ç†ï¼ˆacceptï¼‰\n\n`io.netty.channel.nio.AbstractNioMessageChannel.NioMessageUnsafe#read`\n\n```java\npublic void read() {\n    assert eventLoop().inEventLoop();\n    final ChannelConfig config = config();\n    final ChannelPipeline pipeline = pipeline();    \n    final RecvByteBufAllocator.Handle allocHandle = unsafe().recvBufAllocHandle();\n    allocHandle.reset(config);\n\n    boolean closed = false;\n    Throwable exception = null;\n    try {\n        try {\n            do {\n\t\t\t\t// doReadMessages ä¸­æ‰§è¡Œäº† accept å¹¶åˆ›å»º NioSocketChannel ä½œä¸ºæ¶ˆæ¯æ”¾å…¥ readBuf\n                // readBuf æ˜¯ä¸€ä¸ª ArrayList ç”¨æ¥ç¼“å­˜æ¶ˆæ¯\n                int localRead = doReadMessages(readBuf);\n                if (localRead == 0) {\n                    break;\n                }\n                if (localRead \u003c 0) {\n                    closed = true;\n                    break;\n                }\n\t\t\t\t// localRead ä¸º 1ï¼Œå°±ä¸€æ¡æ¶ˆæ¯ï¼Œå³æ¥æ”¶ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥\n                allocHandle.incMessagesRead(localRead);\n            } while (allocHandle.continueReading());\n        } catch (Throwable t) {\n            exception = t;\n        }\n\n        int size = readBuf.size();\n        for (int i = 0; i \u003c size; i ++) {\n            readPending = false;\n            // è§¦å‘ read äº‹ä»¶ï¼Œè®© pipeline ä¸Šçš„ handler å¤„ç†ï¼Œè¿™æ—¶æ˜¯å¤„ç†\n            // io.netty.bootstrap.ServerBootstrap.ServerBootstrapAcceptor#channelRead\n            pipeline.fireChannelRead(readBuf.get(i));\n        }\n        readBuf.clear();\n        allocHandle.readComplete();\n        pipeline.fireChannelReadComplete();\n\n        if (exception != null) {\n            closed = closeOnReadError(exception);\n\n            pipeline.fireExceptionCaught(exception);\n        }\n\n        if (closed) {\n            inputShutdown = true;\n            if (isOpen()) {\n                close(voidPromise());\n            }\n        }\n    } finally {\n        if (!readPending \u0026\u0026 !config.isAutoRead()) {\n            removeReadOp();\n        }\n    }\n}\n```\n\nå…³é”®ä»£ç  `io.netty.bootstrap.ServerBootstrap.ServerBootstrapAcceptor#channelRead`\n\n```java\npublic void channelRead(ChannelHandlerContext ctx, Object msg) {\n    // è¿™æ—¶çš„ msg æ˜¯ NioSocketChannel\n    final Channel child = (Channel) msg;\n\n    // NioSocketChannel æ·»åŠ   childHandler å³åˆå§‹åŒ–å™¨\n    child.pipeline().addLast(childHandler);\n\n    // è®¾ç½®é€‰é¡¹\n    setChannelOptions(child, childOptions, logger);\n\n    for (Entry\u003cAttributeKey\u003c?\u003e, Object\u003e e: childAttrs) {\n        child.attr((AttributeKey\u003cObject\u003e) e.getKey()).set(e.getValue());\n    }\n\n    try {\n        // æ³¨å†Œ NioSocketChannel åˆ° nio worker çº¿ç¨‹ï¼Œæ¥ä¸‹æ¥çš„å¤„ç†ä¹Ÿç§»äº¤è‡³ nio worker çº¿ç¨‹\n        childGroup.register(child).addListener(new ChannelFutureListener() {\n            @Override\n            public void operationComplete(ChannelFuture future) throws Exception {\n                if (!future.isSuccess()) {\n                    forceClose(child, future.cause());\n                }\n            }\n        });\n    } catch (Throwable t) {\n        forceClose(child, t);\n    }\n}\n```\n\nåˆå›åˆ°äº†ç†Ÿæ‚‰çš„ `io.netty.channel.AbstractChannel.AbstractUnsafe#register`  æ–¹æ³•\n\n```java\npublic final void register(EventLoop eventLoop, final ChannelPromise promise) {\n    // ä¸€äº›æ£€æŸ¥ï¼Œç•¥...\n\n    AbstractChannel.this.eventLoop = eventLoop;\n\n    if (eventLoop.inEventLoop()) {\n        register0(promise);\n    } else {\n        try {\n            // è¿™è¡Œä»£ç å®Œæˆçš„äº‹å®æ˜¯ nio boss -\u003e nio worker çº¿ç¨‹çš„åˆ‡æ¢\n            eventLoop.execute(new Runnable() {\n                @Override\n                public void run() {\n                    register0(promise);\n                }\n            });\n        } catch (Throwable t) {\n            // æ—¥å¿—è®°å½•...\n            closeForcibly();\n            closeFuture.setClosed();\n            safeSetFailure(promise, t);\n        }\n    }\n}\n```\n\n`io.netty.channel.AbstractChannel.AbstractUnsafe#register0`\n\n```java\nprivate void register0(ChannelPromise promise) {\n    try {\n        if (!promise.setUncancellable() || !ensureOpen(promise)) {\n            return;\n        }\n        boolean firstRegistration = neverRegistered;\n        doRegister();\n        neverRegistered = false;\n        registered = true;\n\t\t\n        // æ‰§è¡Œåˆå§‹åŒ–å™¨ï¼Œæ‰§è¡Œå‰ pipeline ä¸­åªæœ‰ head -\u003e åˆå§‹åŒ–å™¨ -\u003e tail\n        pipeline.invokeHandlerAddedIfNeeded();\n        // æ‰§è¡Œåå°±æ˜¯ head -\u003e logging handler -\u003e my handler -\u003e tail\n\n        safeSetSuccess(promise);\n        pipeline.fireChannelRegistered();\n        \n        if (isActive()) {\n            if (firstRegistration) {\n                // è§¦å‘ pipeline ä¸Š active äº‹ä»¶\n                pipeline.fireChannelActive();\n            } else if (config().isAutoRead()) {\n                beginRead();\n            }\n        }\n    } catch (Throwable t) {\n        closeForcibly();\n        closeFuture.setClosed();\n        safeSetFailure(promise, t);\n    }\n}\n```\n\nå›åˆ°äº†ç†Ÿæ‚‰çš„ä»£ç  `io.netty.channel.DefaultChannelPipeline.HeadContext#channelActive`\n\n```java\npublic void channelActive(ChannelHandlerContext ctx) {\n    ctx.fireChannelActive();\n\t// è§¦å‘ read (NioSocketChannel è¿™é‡Œ readï¼Œåªæ˜¯ä¸ºäº†è§¦å‘ channel çš„äº‹ä»¶æ³¨å†Œï¼Œè¿˜æœªæ¶‰åŠæ•°æ®è¯»å–)\n    readIfIsAutoRead();\n}\n```\n\n`io.netty.channel.nio.AbstractNioChannel#doBeginRead`\n\n```java\nprotected void doBeginRead() throws Exception {\n    // Channel.read() or ChannelHandlerContext.read() was called\n    final SelectionKey selectionKey = this.selectionKey;\n    if (!selectionKey.isValid()) {\n        return;\n    }\n\n    readPending = true;\n\t// è¿™æ—¶å€™ interestOps æ˜¯ 0\n    final int interestOps = selectionKey.interestOps();\n    if ((interestOps \u0026 readInterestOp) == 0) {\n        // å…³æ³¨ read äº‹ä»¶\n        selectionKey.interestOps(interestOps | readInterestOp);\n    }\n}\n```\n\n### 2.4 read å‰–æ\n\nå†æ¥çœ‹å¯è¯»äº‹ä»¶ `io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read`ï¼Œæ³¨æ„å‘é€çš„æ•°æ®æœªå¿…èƒ½å¤Ÿä¸€æ¬¡è¯»å®Œï¼Œå› æ­¤ä¼šè§¦å‘å¤šæ¬¡ nio read äº‹ä»¶ï¼Œä¸€æ¬¡äº‹ä»¶å†…ä¼šè§¦å‘å¤šæ¬¡ pipeline readï¼Œä¸€æ¬¡äº‹ä»¶ä¼šè§¦å‘ä¸€æ¬¡ pipeline read complete\n\n```java\npublic final void read() {\n    final ChannelConfig config = config();\n    if (shouldBreakReadReady(config)) {\n        clearReadPending();\n        return;\n    }\n    final ChannelPipeline pipeline = pipeline();\n    // io.netty.allocator.type å†³å®š allocator çš„å®ç°\n    final ByteBufAllocator allocator = config.getAllocator();\n    // ç”¨æ¥åˆ†é… byteBufï¼Œç¡®å®šå•æ¬¡è¯»å–å¤§å°\n    final RecvByteBufAllocator.Handle allocHandle = recvBufAllocHandle();\n    allocHandle.reset(config);\n\n    ByteBuf byteBuf = null;\n    boolean close = false;\n    try {\n        do {\n            byteBuf = allocHandle.allocate(allocator);\n            // è¯»å–\n            allocHandle.lastBytesRead(doReadBytes(byteBuf));\n            if (allocHandle.lastBytesRead() \u003c= 0) {\n                byteBuf.release();\n                byteBuf = null;\n                close = allocHandle.lastBytesRead() \u003c 0;\n                if (close) {\n                    readPending = false;\n                }\n                break;\n            }\n\n            allocHandle.incMessagesRead(1);\n            readPending = false;\n            // è§¦å‘ read äº‹ä»¶ï¼Œè®© pipeline ä¸Šçš„ handler å¤„ç†ï¼Œè¿™æ—¶æ˜¯å¤„ç† NioSocketChannel ä¸Šçš„ handler\n            pipeline.fireChannelRead(byteBuf);\n            byteBuf = null;\n        } \n        // æ˜¯å¦è¦ç»§ç»­å¾ªç¯\n        while (allocHandle.continueReading());\n\n        allocHandle.readComplete();\n        // è§¦å‘ read complete äº‹ä»¶\n        pipeline.fireChannelReadComplete();\n\n        if (close) {\n            closeOnRead(pipeline);\n        }\n    } catch (Throwable t) {\n        handleReadException(pipeline, byteBuf, t, close, allocHandle);\n    } finally {\n        if (!readPending \u0026\u0026 !config.isAutoRead()) {\n            removeReadOp();\n        }\n    }\n}\n```\n\n`io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator.MaxMessageHandle#continueReading(io.netty.util.UncheckedBooleanSupplier)`\n\n```java\npublic boolean continueReading(UncheckedBooleanSupplier maybeMoreDataSupplier) {\n    return \n           // ä¸€èˆ¬ä¸º true\n           config.isAutoRead() \u0026\u0026\n           // respectMaybeMoreData é»˜è®¤ä¸º true\n           // maybeMoreDataSupplier çš„é€»è¾‘æ˜¯å¦‚æœé¢„æœŸè¯»å–å­—èŠ‚ä¸å®é™…è¯»å–å­—èŠ‚ç›¸ç­‰ï¼Œè¿”å› true\n           (!respectMaybeMoreData || maybeMoreDataSupplier.get()) \u0026\u0026\n           // å°äºæœ€å¤§æ¬¡æ•°ï¼ŒmaxMessagePerRead é»˜è®¤ 16\n           totalMessages \u003c maxMessagePerRead \u0026\u0026\n           // å®é™…è¯»åˆ°äº†æ•°æ®\n           totalBytesRead \u003e 0;\n}\n```\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Netty/Netty%E5%85%A5%E9%97%A8":{"title":"Nettyå…¥é—¨","content":"\n# Nettyå…¥é—¨\n\n## 1. æ¦‚è¿°\n\n### 1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ\n\n```\nNetty is an asynchronous event-driven network application framework\nfor rapid development of maintainable high performance protocol servers \u0026 clients.\n```\n\nNetty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯\n\n### 1.2 Netty çš„ä½œè€…\n\n![[z-oblib/z2-attachments/64fc67105d460cb23e0bcc014ba4c21f.png]]\n\nä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…\n\n### 1.3 Netty çš„åœ°ä½\n\nNetty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½\n\nä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼\n\n* Cassandra - nosql æ•°æ®åº“\n* Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶\n* Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶\n* RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—\n* ElasticSearch - æœç´¢å¼•æ“\n* gRPC - rpc æ¡†æ¶\n* Dubbo - rpc æ¡†æ¶\n* Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯\n* Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶\n\n### 1.4 Netty çš„ä¼˜åŠ¿\n\n* Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š\n  * éœ€è¦è‡ªå·±æ„å»ºåè®®\n  * è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…\n  * epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%\n  * å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal =\u003e ThreadLocalï¼ŒByteBuf =\u003e ByteBuffer\n* Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶\n  * Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€\n  * ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬\n    * 2.x 2004\n    * 3.x 2008\n    * 4.x 2013\n    * 5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰\n\n## 2. Hello World\n\n### 2.1 ç›®æ ‡\n\nå¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯\n\n* å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world\n* æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›\n\n\n\nåŠ å…¥ä¾èµ–\n\n```xml\n\u003cdependency\u003e\n    \u003cgroupId\u003eio.netty\u003c/groupId\u003e\n    \u003cartifactId\u003enetty-all\u003c/artifactId\u003e\n    \u003cversion\u003e4.1.39.Final\u003c/version\u003e\n\u003c/dependency\u003e\n```\n\n### 2.2 æœåŠ¡å™¨ç«¯\n\n```java\n// æœåŠ¡å™¨ç«¯çš„å¯åŠ¨å™¨ï¼Œè´Ÿè´£ç»„è£…nattyç»„ä»¶ï¼Œåè°ƒå·¥ä½œå¹¶å¯åŠ¨ã€‚\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup()) // 1\n    .channel(NioServerSocketChannel.class) // 2\n    .childHandler(new ChannelInitializer\u003cNioSocketChannel\u003e() { // 3\n        protected void initChannel(NioSocketChannel ch) {\n            ch.pipeline().addLast(new StringDecoder()); // 5\n            ch.pipeline().addLast(new SimpleChannelInboundHandler\u003cString\u003e() { // 6\n                @Override\n                protected void channelRead0(ChannelHandlerContext ctx, String msg) {\n                    System.out.println(msg);  // æ‰“å°ä¸Šä¸€æ­¥è½¬æ¢å¥½çš„å­—ç¬¦ä¸²\n                }\n            });\n        }\n    })\n    .bind(8080); // 4\n```\n\nä»£ç è§£è¯»\n\n* 1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º `çº¿ç¨‹æ±  + Selector` ï¼ŒåŒ…å«[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/NIO/NIOåŸºç¡€#ğŸ’¡ åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–|NIO]]éƒ¨åˆ†çš„Bosså’ŒWorkerä¸¤ä¸ªé€‰æ‹©å™¨åŠå¯¹åº”çš„çº¿ç¨‹ç­‰ã€‚\n\n* 2 å¤„ï¼Œé€‰æ‹©æœåŠ¡ Scoket å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰\n\n![[z-oblib/z2-attachments/e96dc3fa309784d125c72bc9f1dcbb3f.png]]\n\n* 3 å¤„ï¼Œæ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰workerå¦‚ä½•å»å¤„ç†ç½‘ç»œä¸­çš„æ•°æ®ï¼ˆç¼–è§£ç ã€ä¸šåŠ¡å¤„ç†...ï¼‰ã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨ï¼Œè¿™é‡Œæ·»åŠ äº† 5 6ä¸¤ä¸ªå¤„ç†å™¨ã€‚\n\n* 4 å¤„ï¼ŒServerSocketChannel ç»‘å®šçš„ç›‘å¬ç«¯å£ã€‚\n\n* 5 å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =\u003e Stringã€‚\n\n* 6 å¤„ï¼Œè‡ªå®šä¹‰çš„SocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œæ¥å—çš„æ¶ˆæ¯æ˜¯ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœã€‚\n\n### 2.3 å®¢æˆ·ç«¯\n\n```java\nnew Bootstrap()\n    .group(new NioEventLoopGroup()) // 1\n    .channel(NioSocketChannel.class) // 2\n    .handler(new ChannelInitializer\u003cChannel\u003e() { // 3\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder()); // 8\n        }\n    })\n    .connect(\"127.0.0.1\", 8080) // 4\n    .sync() // 5\n    .channel() // 6\n    .writeAndFlush(new Date() + \": hello world!\"); // 7\n```\n\nä»£ç è§£è¯»\n\n* 1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server\n\n* 2 å¤„ï¼Œé€‰æ‹©å®¢æˆ· Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰\n\n![[z-oblib/z2-attachments/10eac7273abe4f354a285f9b498a2825.png]]\n\n* 3 å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨\n* 4 å¤„ï¼ŒæŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨å’Œç«¯å£\n* 5 å¤„ï¼Œsyncæ˜¯ä¸€ä¸ªåŒæ­¥ï¼ˆé˜»å¡ï¼‰æ–¹æ³•ã€‚Netty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯•\n* 6 å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ\n* 7 å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº\n* 8 å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String =\u003e ByteBuf å‘å‡º\n* æ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ 5 å’Œ 6 å¤„çš„ handler å…ˆåè¢«è§¦å‘ï¼Œèµ°å®Œä¸€ä¸ªæµç¨‹\n\n### 2.4 æµç¨‹æ¢³ç†\n\n![[z-oblib/z2-attachments/adea72dac7ceb3d0f0158cd3d7acdd57.png]]\n\n#### ğŸ’¡ æç¤º\n\n\u003e ä¸€å¼€å§‹éœ€è¦æ ‘ç«‹æ­£ç¡®çš„è§‚å¿µ\n\u003e\n\u003e * æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“\n\u003e * æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf\n\u003e * æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº\n\u003e   * å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆ...ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰\n\u003e   * handler åˆ† Inbound å’Œ Outbound ä¸¤ç±»\n\u003e * æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº\n\u003e   * å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ io æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰\n\u003e   * å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ io æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡\n\u003e   * å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº\n\n## 3. ç»„ä»¶\n\n### 3.1 EventLoop\n\n\u003e ä¸€ä¸ªEventLoopåªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚\n\näº‹ä»¶å¾ªç¯å¯¹è±¡\n\nEventLoop æœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ io äº‹ä»¶ã€‚\n\nå®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚ï¼ˆä¸¤æ¡çº¿ï¼‰ï¼š\n\n* ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª j.u.c.ScheduledExecutorService å› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•\n* å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutorï¼Œ\n  * æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop\n  * æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup\n\n\n\näº‹ä»¶å¾ªç¯ç»„\n\nEventLoopGroup æ˜¯ä¸€ç»„ EventLoopï¼ŒChannel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥**ç»‘å®š**å…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ io äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† io äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰\n\n* ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup\n  * å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ›\n  * å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop\n\n\n\nä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š\n\n```java\n// å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ª EventLoop, æ¯ä¸ª EventLoop ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹\nDefaultEventLoopGroup group = new DefaultEventLoopGroup(2);\nSystem.out.println(group.next());\nSystem.out.println(group.next());\nSystem.out.println(group.next());\n```\n\nè¾“å‡º\n\n```\nio.netty.channel.DefaultEventLoop@60f82f98\nio.netty.channel.DefaultEventLoop@35f983a6\nio.netty.channel.DefaultEventLoop@60f82f98\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯\n\n```java\nDefaultEventLoopGroup group = new DefaultEventLoopGroup(2);\nfor (EventExecutor eventLoop : group) {\n    System.out.println(eventLoop);\n}\n```\n\nè¾“å‡º\n\n```\nio.netty.channel.DefaultEventLoop@60f82f98\nio.netty.channel.DefaultEventLoop@35f983a6\n```\n\n#### ğŸ’¡ ä¼˜é›…å…³é—­\n\nä¼˜é›…å…³é—­ `shutdownGracefully` æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ `EventLoopGroup` åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„\n\n#### æ¼”ç¤º NioEventLoop å¤„ç† io äº‹ä»¶\n\næœåŠ¡å™¨ç«¯ä¸¤ä¸ª nio worker å·¥äºº\n\n```java\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup(1), new NioEventLoopGroup(2))\n    .channel(NioServerSocketChannel.class)\n    .childHandler(new ChannelInitializer\u003cNioSocketChannel\u003e() {\n        @Override\n        protected void initChannel(NioSocketChannel ch) {\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    ByteBuf byteBuf = msg instanceof ByteBuf ? ((ByteBuf) msg) : null;\n                    if (byteBuf != null) {\n                        byte[] buf = new byte[16];\n                        ByteBuf len = byteBuf.readBytes(buf, 0, byteBuf.readableBytes());\n                        log.debug(new String(buf));\n                    }\n                }\n            });\n        }\n    }).bind(8080).sync();\n```\n\nå®¢æˆ·ç«¯ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰\n\n```java\npublic static void main(String[] args) throws InterruptedException {\n    Channel channel = new Bootstrap()\n            .group(new NioEventLoopGroup(1))\n            .handler(new ChannelInitializer\u003cNioSocketChannel\u003e() {\n                @Override\n                protected void initChannel(NioSocketChannel ch) throws Exception {\n                    System.out.println(\"init...\");\n                    ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                }\n            })\n            .channel(NioSocketChannel.class).connect(\"localhost\", 8080)\n            .sync()\n            .channel();\n\n    channel.writeAndFlush(ByteBufAllocator.DEFAULT.buffer().writeBytes(\"wangwu\".getBytes()));\n    Thread.sleep(2000);\n    channel.writeAndFlush(ByteBufAllocator.DEFAULT.buffer().writeBytes(\"wangwu\".getBytes()));\n```\n\næœ€åè¾“å‡º\n\n```\n22:03:34 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - zhangsan       \n22:03:36 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - zhangsan       \n22:05:36 [DEBUG] [nioEventLoopGroup-3-2] c.i.o.EventLoopTest - lisi           \n22:05:38 [DEBUG] [nioEventLoopGroup-3-2] c.i.o.EventLoopTest - lisi           \n22:06:09 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - wangwu        \n22:06:11 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - wangwu         \n```\n\nå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå·¥äººè½®æµå¤„ç† channelï¼Œä½†å·¥äººä¸ channel ä¹‹é—´è¿›è¡Œäº†**ç»‘å®š**\n\n![[z-oblib/z2-attachments/5481d330648f7aac4452dbfb01920fd3.png]]\n\n\n\nå†å¢åŠ ä¸¤ä¸ªé nio å·¥äºº\n\n```java\nDefaultEventLoopGroup normalWorkers = new DefaultEventLoopGroup(2);\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup(1), new NioEventLoopGroup(2))\n    .channel(NioServerSocketChannel.class)\n    .childHandler(new ChannelInitializer\u003cNioSocketChannel\u003e() {\n        @Override\n        protected void initChannel(NioSocketChannel ch)  {\n            ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n            ch.pipeline().addLast(normalWorkers,\"myhandler\",\n              new ChannelInboundHandlerAdapter() {\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    ByteBuf byteBuf = msg instanceof ByteBuf ? ((ByteBuf) msg) : null;\n                    if (byteBuf != null) {\n                        byte[] buf = new byte[16];\n                        ByteBuf len = byteBuf.readBytes(buf, 0, byteBuf.readableBytes());\n                        log.debug(new String(buf));\n                    }\n                }\n            });\n        }\n    }).bind(8080).sync();\n```\n\nå®¢æˆ·ç«¯ä»£ç ä¸å˜ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰\n\nè¾“å‡º\n\n```\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] REGISTERED\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] ACTIVE\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |\n+--------+-------------------------------------------------+----------------+\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ COMPLETE\n22:19:48 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        \n22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |\n+--------+-------------------------------------------------+----------------+\n22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ COMPLETE\n22:19:50 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        \n22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] REGISTERED\n22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] ACTIVE\n22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ: 4B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6c 69 73 69                                     |lisi            |\n+--------+-------------------------------------------------+----------------+\n22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ COMPLETE\n22:20:25 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            \n22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ: 4B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6c 69 73 69                                     |lisi            |\n+--------+-------------------------------------------------+----------------+\n22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ COMPLETE\n22:20:27 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            \n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] REGISTERED\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] ACTIVE\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ: 6B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 77 61 6e 67 77 75                               |wangwu          |\n+--------+-------------------------------------------------+----------------+\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ COMPLETE\n22:20:38 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          \n22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ: 6B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 77 61 6e 67 77 75                               |wangwu          |\n+--------+-------------------------------------------------+----------------+\n22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ COMPLETE\n22:20:40 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          \n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œnio å·¥äººå’Œ é nio å·¥äººä¹Ÿåˆ†åˆ«ç»‘å®šäº† channelï¼ˆLoggingHandler ç”± nio å·¥äººæ‰§è¡Œï¼Œè€Œæˆ‘ä»¬è‡ªå·±çš„ handler ç”±é nio å·¥äººæ‰§è¡Œï¼‰\n\n\n\n![[z-oblib/z2-attachments/7de561abc15cda8879ac2cf85700066b.png]]\n\n#### ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ\n\n\u003e piplineä¸­çš„çº¿ç¨‹åˆ‡æ¢ã€‚\n\nå…³é”®ä»£ç  `io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()`\n\n\u003e å¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªhandlerç»‘å®šçš„æ˜¯ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¦‚æœæ˜¯å°±ç›´æ¥çº¿æ€§è°ƒç”¨ï¼›å¦‚æœä¸æ˜¯å°±æŠŠæ¥ä¸‹æ¥çš„ä»»åŠ¡åŒ…è£…æˆRunnableæ‰”ç»™ä¸‹ä¸€ä¸ªhandlerå¯¹åº”çš„çº¿ç¨‹æ± ã€‚\n\n```java\nstatic void invokeChannelRead(final AbstractChannelHandlerContext next, Object msg) {\n    final Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, \"msg\"), next);\n    // ä¸‹ä¸€ä¸ª handler çš„äº‹ä»¶å¾ªç¯æ˜¯å¦ä¸å½“å‰çš„äº‹ä»¶å¾ªç¯æ˜¯åŒä¸€ä¸ªçº¿ç¨‹\n    EventExecutor executor = next.executor();\n    \n    // æ˜¯ï¼Œç›´æ¥è°ƒç”¨\n    if (executor.inEventLoop()) {\n        next.invokeChannelRead(m);\n    } \n    // ä¸æ˜¯ï¼Œå°†è¦æ‰§è¡Œçš„ä»£ç ä½œä¸ºä»»åŠ¡æäº¤ç»™ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼ˆæ¢äººï¼‰\n    else {\n\t    // executorå½“å‰å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ˜¯ä¸‹ä¸€ä¸ªhandler\n        executor.execute(new Runnable() {\n            @Override\n            public void run() {\n                next.invokeChannelRead(m);\n            }\n        });\n    }\n}\n```\n\n* å¦‚æœä¸¤ä¸ª handler ç»‘å®šçš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨\n* å¦åˆ™ï¼ŒæŠŠè¦è°ƒç”¨çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç”±ä¸‹ä¸€ä¸ª handler çš„çº¿ç¨‹æ¥è°ƒç”¨\n\n#### æ¼”ç¤º NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡\n\nNioEventLoop é™¤äº†å¯ä»¥å¤„ç† io äº‹ä»¶ï¼ŒåŒæ ·å¯ä»¥å‘å®ƒæäº¤æ™®é€šä»»åŠ¡\n\n```java\nNioEventLoopGroup nioWorkers = new NioEventLoopGroup(2);\n\nlog.debug(\"server start...\");\nThread.sleep(2000);\nnioWorkers.execute(()-\u003e{\n    log.debug(\"normal task...\");\n});\n```\n\nè¾“å‡º\n\n```\n22:30:36 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...\n22:30:38 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - normal task...\n```\n\n\u003e å¯ä»¥ç”¨æ¥æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡\n\n#### æ¼”ç¤º NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡\n\n```java\nNioEventLoopGroup nioWorkers = new NioEventLoopGroup(2);\n\nlog.debug(\"server start...\");\nThread.sleep(2000);\nnioWorkers.scheduleAtFixedRate(() -\u003e {\n    log.debug(\"running...\");\n}, 0, 1, TimeUnit.SECONDS);\n```\n\nè¾“å‡º\n\n```\n22:35:15 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...\n22:35:17 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:19 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:20 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n...\n```\n\n\u003e å¯ä»¥ç”¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡\n\n### 3.2 Channel\n\nchannel çš„ä¸»è¦ä½œç”¨\n\n* close() å¯ä»¥ç”¨æ¥å…³é—­ channel\n* closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­\n  * sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­\n  * è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­\n* pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨\n* write() æ–¹æ³•å°†æ•°æ®å†™å…¥\n* writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º\n\n#### ChannelFuture\n\nè¿™æ—¶åˆšæ‰çš„å®¢æˆ·ç«¯ä»£ç \n\n```java\nnew Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer\u003cChannel\u003e() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080)\n    .sync()\n    .channel()\n    .writeAndFlush(new Date() + \": hello world!\");\n```\n\nç°åœ¨æŠŠå®ƒæ‹†å¼€æ¥çœ‹\n\n```java\nChannelFuture channelFuture = new Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer\u003cChannel\u003e() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080); // 1\n\nchannelFuture.sync().channel().writeAndFlush(new Date() + \": hello world!\");\n```\n\n* 1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡\n\n**æ³¨æ„** connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®çš„ Channel å¯¹è±¡\n\nå®éªŒå¦‚ä¸‹ï¼š\n\n```java\nChannelFuture channelFuture = new Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer\u003cChannel\u003e() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080);\n\nSystem.out.println(channelFuture.channel()); // 1\nchannelFuture.sync(); // 2\nSystem.out.println(channelFuture.channel()); // 3\n```\n\n* æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° `[id: 0x2e1884dd]`\n* æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ\n* æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° `[id: 0x2e1884dd, L:/127.0.0.1:57191 - R:/127.0.0.1:8080]`\n\né™¤äº†ç”¨ sync æ–¹æ³•å¯ä»¥è®©å¼‚æ­¥æ“ä½œåŒæ­¥ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›è°ƒçš„æ–¹å¼ï¼š\n\n```java\nChannelFuture channelFuture = new Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer\u003cChannel\u003e() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080);\nSystem.out.println(channelFuture.channel()); // 1\nchannelFuture.addListener((ChannelFutureListener) future -\u003e {\n    System.out.println(future.channel()); // 2\n});\n```\n\n* æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° `[id: 0x749124ba]`\n* ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° `[id: 0x749124ba, L:/127.0.0.1:57351 - R:/127.0.0.1:8080]`\n\n##### æ€»ç»“\n\nsyncï¼šè°å‘èµ·è°ƒç”¨ï¼Œè°é˜»å¡å¼ç­‰å¾…ç»“æœã€‚\n[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å›è°ƒ|å›è°ƒ]]ï¼šæ‰§è¡ŒåŠ¨ä½œå’Œç­‰å¾…ç»“æœéƒ½äº¤ç»™å…¶å®ƒçº¿ç¨‹å¤„ç†ï¼Œæœ¬çº¿ç¨‹ä¸é˜»å¡ç­‰å¾…ã€‚\n\n#### CloseFuture\n\n```java\n@Slf4j\npublic class CloseFutureClient {\n    public static void main(String[] args) throws InterruptedException {\n\t\t// groupéœ€è¦æå‡ºæ¥ï¼Œå¦åˆ™åç»­å…³é—­çš„æ—¶å€™æ— æ³•å¼•ç”¨åˆ°ï¼ˆåŒ¿åå¯¹è±¡æ— æ³•å¼•ç”¨ï¼‰\n        NioEventLoopGroup group new NioEventLoopGroup();\n        ChannelFuture channelFuture = new Bootstrap()\n                .group(group)\n                .channel(NioSocketChannel.class)\n                .handler(new ChannelInitializer\u003cNioSocketChannel\u003e() {\n                    @Override // åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨\n                    protected void initChannel(NioSocketChannel ch) throws Exception {\n                        ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                        ch.pipeline().addLast(new StringEncoder());\n                    }\n                })\n                .connect(new InetSocketAddress(\"localhost\", 8080));\n        Channel channel = channelFuture.sync().channel();\n        log.debug(\"{}\", channel);\n        new Thread(()-\u003e{\n            Scanner scanner = new Scanner(System.in);\n            while (true) {\n                String line = scanner.nextLine();\n                if (\"q\".equals(line)) {\n                    channel.close(); // close å¼‚æ­¥æ“ä½œ 1s ä¹‹å\n//                    log.debug(\"å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ\"); // ä¸èƒ½åœ¨è¿™é‡Œå–„å\n                    break;\n                }\n                channel.writeAndFlush(line);\n            }\n        }, \"input\").start();\n\n        // è·å– CloseFuture å¯¹è±¡ï¼Œ 1) åŒæ­¥å¤„ç†å…³é—­ï¼Œ 2) å¼‚æ­¥å¤„ç†å…³é—­\n        ChannelFuture closeFuture = channel.closeFuture();\n        /*log.debug(\"waiting close...\");\n        closeFuture.sync();\n        log.debug(\"å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ\");*/\n        closeFuture.addListener(new ChannelFutureListener() {\n            @Override\n            public void operationComplete(ChannelFuture future) throws Exception {\n                log.debug(\"å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ\");\n                // groupçš„çº¿ç¨‹éƒ½è¦ç»“æŸï¼Œæ‰èƒ½å®Œå…¨ç»“æŸ\n                group.shutdownGracefully();\n            }\n        });\n    }\n}\n```\n\n#### ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ\n\n* æœ‰äº›åŒå­¦çœ‹åˆ°è¿™é‡Œä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å»æ‰§è¡Œå…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥\n\n* è¿˜æœ‰åŒå­¦ä¼šç¬¼ç»Ÿåœ°å›ç­”ï¼Œå› ä¸º netty å¼‚æ­¥æ–¹å¼ç”¨äº†å¤šçº¿ç¨‹ã€å¤šçº¿ç¨‹å°±æ•ˆç‡é«˜ã€‚å…¶å®è¿™äº›è®¤è¯†éƒ½æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„\n\n\næ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š`4 * 8 * 3 = 96`\n\n![[z-oblib/z2-attachments/6a10c9dad3ac38a87f514c18b0324711.png]]\n\nç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¦‚ä¸‹\n\n![[z-oblib/z2-attachments/6a10c9dad3ac38a87f514c18b0324711.png]]\n\nå› æ­¤å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–ï¼Œåªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œå¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº† `4 * 8 * 12` æ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€\n\n![[z-oblib/z2-attachments/a694740c598213c9bdeba1a223382696.png]]\n\n##### è¦ç‚¹\n\n\u003e æå‡çš„æ€è·¯ç±»ä¼¼CPUçš„æµæ°´çº¿è®¾è®¡ï¼Œå°†å¤§ä»»åŠ¡ç»†åˆ†ï¼Œæ‹†ç»™ä¸åŒäººåšã€‚ï¼ˆä¸è¿‡CPUé‡æ’æå‡æ•ˆç‡çš„éƒ¨åˆ†åŸå› æ˜¯ä¸€äº›æ‰§è¡Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œè€Œè¿™é‡Œåœ¨çº¿ç¨‹æ•°é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæ€»å¤„ç†äº‹ä»¶ä¸ä¼šç¼©çŸ­ï¼‰ï¼›\n\u003e é™ä½äº†å•ä¸€è¿æ¥çš„å“åº”é€Ÿåº¦ï¼ˆçº¿ç¨‹åˆ‡æ¢é¢å¤–å¼€é”€ï¼‰ï¼Œæå‡äº†ååé‡ï¼ˆå•ä½æ—¶é—´å¤„ç†è¯·æ±‚çš„ä¸ªæ•°ï¼‰ã€‚\n\u003e å•ä¸ªè¿æ¥çš„å¤„ç†æ—¶é—´è¿˜æ˜¯å’ŒåŸæ¥ä¸€æ ·ï¼Œä½†æ˜¯ä¸ä¼šå› ä¸ºå…¶å®ƒè¿æ¥å ç”¨çº¿ç¨‹è€Œè¢«é˜»å¡äº†ã€‚\n\u003e ä¸Šé¢çš„ä¾‹å­å¦‚æœä¸å¼‚æ­¥ï¼Œä¾‹å¦‚æœ‰çš„ç—…äººéœ€è¦åŠ¨æ‰‹æœ¯ï¼Œè€—è´¹å¤§é‡æ—¶é—´ï¼Œä¼šå¯¼è‡´å…¶å®ƒç—…äººæ²¡æ³•è¿›æ¥çœ‹ç—…ã€‚\n\n* å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿\n* å¼‚æ­¥å¹¶**æ²¡æœ‰**ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ \n* åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®\n\n### 3.3 Future \u0026 Promise\n\nåœ¨å¼‚æ­¥å¤„ç†æ—¶ï¼Œç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£\n\né¦–å…ˆè¦è¯´æ˜ netty ä¸­çš„ Future ä¸ jdk ä¸­çš„ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/FutureTask|Future]] åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ï¼Œnetty çš„ Future ç»§æ‰¿è‡ª jdk çš„ Futureï¼Œè€Œ Promise åˆå¯¹ netty Future è¿›è¡Œäº†æ‰©å±•\n\n* jdk Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ\n* netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ\n* netty Promise ä¸ä»…æœ‰ netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨ï¼ˆå•å‘å˜åŒå‘ï¼‰\n\n| åŠŸèƒ½/åç§°    | jdk Future                     | netty Future                                                 | Promise      |\n| ------------ | ------------------------------ | ------------------------------------------------------------ | ------------ |\n| cancel       | å–æ¶ˆä»»åŠ¡                       | -                                                            | -            |\n| isCanceled   | ä»»åŠ¡æ˜¯å¦å–æ¶ˆ                   | -                                                            | -            |\n| isDone       | ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥ | -                                                            | -            |\n| get          | è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…         | -                                                            | -            |\n| getNow       | -                              | è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null                | -            |\n| await        | -                              | ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­ | -            |\n| sync         | -                              | ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸                         | -            |\n| isSuccess    | -                              | åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ                                             | -            |\n| cause        | -                              | è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null                 | -            |\n| addLinstener | -                              | æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ                                       | -            |\n| setSuccess   | -                              | -                                                            | è®¾ç½®æˆåŠŸç»“æœ |\n| setFailure   | -                              | -                                                            | è®¾ç½®å¤±è´¥ç»“æœ |\n\n#### ä¾‹1\n\nåŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise\u003cInteger\u003e promise = new DefaultPromise\u003c\u003e(eventExecutors);\n\neventExecutors.execute(()-\u003e{\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.debug(\"set success, {}\",10);\n    promise.setSuccess(10);\n});\n\nlog.debug(\"start...\");\nlog.debug(\"{}\",promise.getNow()); // è¿˜æ²¡æœ‰ç»“æœ\nlog.debug(\"{}\",promise.get());\n```\n\nè¾“å‡º\n\n```\n11:51:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n11:51:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n11:51:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 10\n11:51:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - 10\n```\n\n#### ä¾‹2\n\nå¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise\u003cInteger\u003e promise = new DefaultPromise\u003c\u003e(eventExecutors);\n\n// è®¾ç½®å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ\npromise.addListener(future -\u003e {\n    // è¿™é‡Œçš„ future å°±æ˜¯ä¸Šé¢çš„ promise\n    log.debug(\"{}\",future.getNow());\n});\n\n// ç­‰å¾… 1000 åè®¾ç½®æˆåŠŸç»“æœ\neventExecutors.execute(()-\u003e{\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.debug(\"set success, {}\",10);\n    promise.setSuccess(10);\n});\n\nlog.debug(\"start...\");\n```\n\nè¾“å‡º\n\n```\n11:49:30 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 10\n11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - 10\n```\n\n#### ä¾‹3\n\nåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync \u0026 get\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\n        DefaultPromise\u003cInteger\u003e promise = new DefaultPromise\u003c\u003e(eventExecutors);\n\n        eventExecutors.execute(() -\u003e {\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            RuntimeException e = new RuntimeException(\"error...\");\n            log.debug(\"set failure, {}\", e.toString());\n            promise.setFailure(e);\n        });\n\n        log.debug(\"start...\");\n        log.debug(\"{}\", promise.getNow());\n        promise.get(); // sync() ä¹Ÿä¼šå‡ºç°å¼‚å¸¸ï¼Œåªæ˜¯ get ä¼šå†ç”¨ ExecutionException åŒ…ä¸€å±‚å¼‚å¸¸\n```\n\nè¾“å‡º\n\n```\n12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n12:11:08 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\nException in thread \"main\" java.util.concurrent.ExecutionException: java.lang.RuntimeException: error...\n\tat io.netty.util.concurrent.AbstractFuture.get(AbstractFuture.java:41)\n\tat com.itcast.oio.DefaultPromiseTest2.main(DefaultPromiseTest2.java:34)\nCaused by: java.lang.RuntimeException: error...\n\tat com.itcast.oio.DefaultPromiseTest2.lambda$main$0(DefaultPromiseTest2.java:27)\n\tat io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(Thread.java:745)\n```\n\n#### ä¾‹4\n\nåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - await\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise\u003cInteger\u003e promise = new DefaultPromise\u003c\u003e(eventExecutors);\n\neventExecutors.execute(() -\u003e {\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    RuntimeException e = new RuntimeException(\"error...\");\n    log.debug(\"set failure, {}\", e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(\"start...\");\nlog.debug(\"{}\", promise.getNow());\npromise.await(); // ä¸ sync å’Œ get åŒºåˆ«åœ¨äºï¼Œä¸ä¼šæŠ›å¼‚å¸¸\nlog.debug(\"result {}\", (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());\n```\n\nè¾“å‡º\n\n```\n12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n12:18:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\n12:18:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: error...\n```\n\n#### ä¾‹5\n\nå¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise\u003cInteger\u003e promise = new DefaultPromise\u003c\u003e(eventExecutors);\n\npromise.addListener(future -\u003e {\n    log.debug(\"result {}\", (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());\n});\n\neventExecutors.execute(() -\u003e {\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    RuntimeException e = new RuntimeException(\"error...\");\n    log.debug(\"set failure, {}\", e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(\"start...\");\n```\n\nè¾“å‡º\n\n```\n12:04:57 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\n12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: error...\n```\n\n#### ä¾‹6\n\nawait æ­»é”æ£€æŸ¥\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise\u003cInteger\u003e promise = new DefaultPromise\u003c\u003e(eventExecutors);\n\neventExecutors.submit(()-\u003e{\n    System.out.println(\"1\");\n    try {\n        promise.await();\n        // æ³¨æ„ä¸èƒ½ä»…æ•è· InterruptedException å¼‚å¸¸\n        // å¦åˆ™ æ­»é”æ£€æŸ¥æŠ›å‡ºçš„ BlockingOperationException ä¼šç»§ç»­å‘ä¸Šä¼ æ’­\n        // è€Œæäº¤çš„ä»»åŠ¡ä¼šè¢«åŒ…è£…ä¸º PromiseTaskï¼Œå®ƒçš„ run æ–¹æ³•ä¸­ä¼š catch æ‰€æœ‰å¼‚å¸¸ç„¶åè®¾ç½®ä¸º Promise çš„å¤±è´¥ç»“æœè€Œä¸ä¼šæŠ›å‡º\n    } catch (Exception e) { \n        e.printStackTrace();\n    }\n    System.out.println(\"2\");\n});\neventExecutors.submit(()-\u003e{\n    System.out.println(\"3\");\n    try {\n        promise.await();\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n    System.out.println(\"4\");\n});\n```\n\nè¾“å‡º\n\n```\n1\n2\n3\n4\nio.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)\n\tat io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)\n\tat io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:212)\n\tat com.itcast.oio.DefaultPromiseTest.lambda$main$0(DefaultPromiseTest.java:27)\n\tat io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)\n\tat io.netty.util.concurrent.PromiseTask.run(PromiseTask.java:73)\n\tat io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(Thread.java:745)\nio.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)\n\tat io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)\n\tat io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:212)\n\tat com.itcast.oio.DefaultPromiseTest.lambda$main$1(DefaultPromiseTest.java:36)\n\tat io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)\n\tat io.netty.util.concurrent.PromiseTask.run(PromiseTask.java:73)\n\tat io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(Thread.java:745)\n\n```\n\n### 3.4 Handler \u0026 Pipeline\n\nChannelHandler ç”¨æ¥å¤„ç† Channel ä¸Šçš„å„ç§äº‹ä»¶ï¼Œåˆ†ä¸º**å…¥**ç«™ï¼ˆå®¢æˆ·ç«¯ä¾§ï¼‰ã€**å‡º**ç«™ï¼ˆæœåŠ¡å™¨ä¾§ï¼‰ä¸¤ç§ã€‚æ‰€æœ‰ ChannelHandler è¢«è¿æˆä¸€ä¸²ï¼Œå°±æ˜¯ Pipeline\n\n* å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelInboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥è¯»å–å®¢æˆ·ç«¯æ•°æ®ï¼Œå†™å›ç»“æœ\n* å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelOutboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦å¯¹å†™å›ç»“æœè¿›è¡ŒåŠ å·¥\n\næ‰“ä¸ªæ¯”å–»ï¼Œæ¯ä¸ª Channel æ˜¯ä¸€ä¸ªäº§å“çš„åŠ å·¥è½¦é—´ï¼ŒPipeline æ˜¯è½¦é—´ä¸­çš„æµæ°´çº¿ï¼ŒChannelHandler å°±æ˜¯æµæ°´çº¿ä¸Šçš„å„é“å·¥åºï¼Œè€Œåé¢è¦è®²çš„ ByteBuf æ˜¯åŸææ–™ï¼Œç»è¿‡å¾ˆå¤šå·¥åºçš„åŠ å·¥ï¼šå…ˆç»è¿‡ä¸€é“é“å…¥ç«™å·¥åºï¼Œå†ç»è¿‡ä¸€é“é“å‡ºç«™å·¥åºæœ€ç»ˆå˜æˆäº§å“\n\n\n\nå…ˆææ¸…æ¥šé¡ºåºï¼ŒæœåŠ¡ç«¯\n\n```java\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioServerSocketChannel.class)\n    .childHandler(new ChannelInitializer\u003cNioSocketChannel\u003e() {\n        protected void initChannel(NioSocketChannel ch) {\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    System.out.println(1);\n                    ctx.fireChannelRead(msg); // 1\n                }\n            });\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    System.out.println(2);\n                    ctx.fireChannelRead(msg); // 2\n                }\n            });\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    System.out.println(3);\n                    ctx.channel().write(msg); // 3\n                }\n            });\n            ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){\n                @Override\n                public void write(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise) {\n                    System.out.println(4);\n                    ctx.write(msg, promise); // 4\n                }\n            });\n            ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){\n                @Override\n                public void write(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise) {\n                    System.out.println(5);\n                    ctx.write(msg, promise); // 5\n                }\n            });\n            ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){\n                @Override\n                public void write(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise) {\n                    System.out.println(6);\n                    ctx.write(msg, promise); // 6\n                }\n            });\n        }\n    })\n    .bind(8080);\n```\n\nå®¢æˆ·ç«¯\n\n```java\nnew Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer\u003cChannel\u003e() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080)\n    .addListener((ChannelFutureListener) future -\u003e {\n        future.channel().writeAndFlush(\"hello,world\");\n    });\n```\n\næœåŠ¡å™¨ç«¯æ‰“å°ï¼š\n\n```\n1\n2\n3\n6\n5\n4\n```\n\nå¯ä»¥çœ‹åˆ°ï¼ŒChannelInboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ ChannelOutboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é€†åºæ‰§è¡Œçš„ã€‚ChannelPipeline çš„å®ç°æ˜¯ä¸€ä¸ª ChannelHandlerContextï¼ˆåŒ…è£…äº† ChannelHandlerï¼‰ ç»„æˆçš„åŒå‘é“¾è¡¨\n\n![[z-oblib/z2-attachments/9f1815805bdefed71b1f6f5e5c0627ee.png]]\n\n* å…¥ç«™å¤„ç†å™¨ä¸­ï¼Œctx.fireChannelRead(msg) æ˜¯ **è°ƒç”¨ä¸‹ä¸€ä¸ªå…¥ç«™å¤„ç†å™¨**\n  * å¦‚æœæ³¨é‡Šæ‰ 1 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1\n  * å¦‚æœæ³¨é‡Šæ‰ 2 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2\n* 3 å¤„çš„ ctx.channel().write(msg) ä¼š **ä»å°¾éƒ¨å¼€å§‹è§¦å‘** åç»­å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ\n  * å¦‚æœæ³¨é‡Šæ‰ 3 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3\n* ç±»ä¼¼çš„ï¼Œå‡ºç«™å¤„ç†å™¨ä¸­ï¼Œctx.write(msg, promise) çš„è°ƒç”¨ä¹Ÿä¼š **è§¦å‘ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨**\n  * å¦‚æœæ³¨é‡Šæ‰ 6 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3 6\n* ctx.channel().write(msg) vs ctx.write(msg)\n  * éƒ½æ˜¯è§¦å‘å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ\n  * ctx.channel().write(msg) ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾å‡ºç«™å¤„ç†å™¨\n  * ctx.write(msg) æ˜¯ä»**å½“å‰**èŠ‚ç‚¹æ‰¾ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨\n  * 3 å¤„çš„ ctx.channel().write(msg) å¦‚æœæ”¹ä¸º ctx.write(msg) ä»…ä¼šæ‰“å° 1 2 3ï¼Œå› ä¸ºèŠ‚ç‚¹3 ä¹‹å‰æ²¡æœ‰å…¶å®ƒå‡ºç«™å¤„ç†å™¨äº†\n  * 6 å¤„çš„ ctx.write(msg, promise) å¦‚æœæ”¹ä¸º ctx.channel().write(msg) ä¼šæ‰“å° 1 2 3 6 6 6... å› ä¸º ctx.channel().write() æ˜¯ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾ï¼Œç»“æœåˆæ˜¯èŠ‚ç‚¹6 è‡ªå·±\n\n\u003e ctx.writeæ˜¯ä»å½“å‰èŠ‚ç‚¹æ‰¾ä¸‹ä¸€ä¸ªå‡ºç«™å¤„ç†å™¨\n\u003e channel.writeæ˜¯ä»å°¾èŠ‚ç‚¹å¼€å§‹æ‰¾ä¸‹ä¸€ä¸ªå‡ºç«™å¤„ç†å™¨\n\nå›¾1 - æœåŠ¡ç«¯ pipeline è§¦å‘çš„åŸå§‹æµç¨‹ï¼Œå›¾ä¸­æ•°å­—ä»£è¡¨äº†å¤„ç†æ­¥éª¤çš„å…ˆåæ¬¡åº\n\n![[z-oblib/z2-attachments/56d3381368d498b7fbe7e6b775fcbdd1.png]]\n\n\u003e æä¾›ä»å½“å‰èŠ‚ç‚¹ç›´æ¥æŸ¥æ‰¾çš„ç›®çš„æ˜¯æ–¹ä¾¿å°†å¤šä¸ªè¯»å†™æ“ä½œä¸²èµ·æ¥æ‰§è¡Œã€‚\n\n#### EmbeddedChannel\n\n\u003ehandleræµ‹è¯•å·¥å…·ç±»ï¼Œä¸ç”¨å€ŸåŠ©æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„å®ç°å°±èƒ½æ¨¡æ‹Ÿè¾“å…¥è¾“å‡ºæµ‹è¯•handlerã€‚\n\n```java\n@Slf4j  \npublic class TestEmbeddedChannel {  \n    public static void main(String[] args) {  \n        ChannelInboundHandlerAdapter h1 = new ChannelInboundHandlerAdapter(){  \n            @Override  \n            public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {  \n                log.debug(\"1\");  \n                super.channelRead(ctx, msg);  \n            }  \n        };  \n        ChannelInboundHandlerAdapter h2 = new ChannelInboundHandlerAdapter(){  \n            @Override  \n            public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {  \n                log.debug(\"2\");  \n                super.channelRead(ctx, msg);  \n            }  \n        };  \n        ChannelOutboundHandlerAdapter h3 = new ChannelOutboundHandlerAdapter() {  \n            @Override  \n            public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) throws Exception {  \n                log.debug(\"3\");  \n                super.write(ctx, msg, promise);  \n            }  \n        };  \n        ChannelOutboundHandlerAdapter h4 = new ChannelOutboundHandlerAdapter() {  \n            @Override  \n            public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) throws Exception {  \n                log.debug(\"4\");  \n                super.write(ctx, msg, promise);  \n            }  \n        };  \n        EmbeddedChannel channel = new EmbeddedChannel(h1, h2, h3, h4);  \n        // æ¨¡æ‹Ÿå…¥ç«™  \n        channel.writeInbound(ByteBufAllocator.DEFAULT.buffer().writeBytes(\"Hello\".getBytes()));  \n        // æ¨¡æ‹Ÿå‡ºç«™  \n        channel.writeOutbound(ByteBufAllocator.DEFAULT.buffer().writeBytes(\"World\".getBytes()));  \n    }  \n}\n```\n\n### 3.5 ByteBuf\n\næ˜¯å¯¹å­—èŠ‚æ•°æ®çš„å°è£…\n\n\u003e é»˜è®¤å¤§å°256ï¼Œå¯åŠ¨æ€æ‰©å®¹ï¼Œè€ŒNIOçš„ByteBufferä¸æ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚\n\n#### 1ï¼‰åˆ›å»º\n\n```java\nByteBuf buffer = ByteBufAllocator.DEFAULT.buffer(10);\nlog(buffer);\n```\n\n\u003e DEFAULTæ˜¯ä¸€ä¸ªé»˜è®¤æ–¹æ³•å®ç°ã€‚\n\nä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„ ByteBufï¼ˆæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBufï¼‰ï¼Œåˆå§‹å®¹é‡æ˜¯ 10\n\nè¾“å‡º\n\n```\nread index:0 write index:0 capacity:10\n```\n\nå…¶ä¸­ log æ–¹æ³•å‚è€ƒå¦‚ä¸‹\n\n```java\nprivate static void log(ByteBuf buffer) {\n    int length = buffer.readableBytes();\n    int rows = length / 16 + (length % 15 == 0 ? 0 : 1) + 4;\n    StringBuilder buf = new StringBuilder(rows * 80 * 2)\n        .append(\"read index:\").append(buffer.readerIndex())\n        .append(\" write index:\").append(buffer.writerIndex())\n        .append(\" capacity:\").append(buffer.capacity())\n        .append(NEWLINE);\n    appendPrettyHexDump(buf, buffer);\n    System.out.println(buf.toString());\n}\n```\n\n#### 2ï¼‰ç›´æ¥å†…å­˜ vs å †å†…å­˜\n\nå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºå †çš„ ByteBuf\n\n```java\nByteBuf buffer = ByteBufAllocator.DEFAULT.heapBuffer(10);\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBuf\n\n```java\nByteBuf buffer = ByteBufAllocator.DEFAULT.directBuffer(10);\n```\n\n* ç›´æ¥å†…å­˜åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·æ˜‚è´µï¼Œä½†è¯»å†™æ€§èƒ½é«˜ï¼ˆå°‘ä¸€æ¬¡å†…å­˜å¤åˆ¶ï¼‰ï¼Œé€‚åˆé…åˆæ± åŒ–åŠŸèƒ½ä¸€èµ·ç”¨\n* ç›´æ¥å†…å­˜å¯¹ GC å‹åŠ›å°ï¼Œå› ä¸ºè¿™éƒ¨åˆ†å†…å­˜ä¸å— JVM åƒåœ¾å›æ”¶çš„ç®¡ç†ï¼Œä½†ä¹Ÿè¦æ³¨æ„åŠæ—¶**ä¸»åŠ¨**é‡Šæ”¾\n\n\u003egcå¯èƒ½ä¼šå¯¹å †å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œæ¬è¿ã€å¤åˆ¶ç­‰æ“ä½œã€‚\n\n#### 3ï¼‰æ± åŒ– vs éæ± åŒ–\n\n\u003e [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/äº«å…ƒæ¨¡å¼|äº«å…ƒæ¨¡å¼]]ã€‚\n\næ± åŒ–çš„æœ€å¤§æ„ä¹‰åœ¨äºå¯ä»¥é‡ç”¨ ByteBufï¼Œä¼˜ç‚¹æœ‰\n\n* æ²¡æœ‰æ± åŒ–ï¼Œåˆ™æ¯æ¬¡éƒ½å¾—åˆ›å»ºæ–°çš„ ByteBuf å®ä¾‹ï¼Œè¿™ä¸ªæ“ä½œå¯¹ç›´æ¥å†…å­˜ä»£ä»·æ˜‚è´µï¼Œå°±ç®—æ˜¯å †å†…å­˜ï¼Œä¹Ÿä¼šå¢åŠ  GC å‹åŠ›\n* æœ‰äº†æ± åŒ–ï¼Œåˆ™å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œå¹¶ä¸”é‡‡ç”¨äº†ä¸ jemalloc ç±»ä¼¼çš„å†…å­˜åˆ†é…ç®—æ³•æå‡åˆ†é…æ•ˆç‡\n* é«˜å¹¶å‘æ—¶ï¼Œæ± åŒ–åŠŸèƒ½æ›´**èŠ‚çº¦å†…å­˜**ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½\n\næ± åŒ–åŠŸèƒ½æ˜¯å¦å¼€å¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥è®¾ç½®\n\n```java\n-Dio.netty.allocator.type={unpooled|pooled}\n```\n\nåœ¨VM optionsä¸­é…ç½®ï¼š\n![[z-oblib/z2-attachments/Pasted image 20220621203238.png]]\n\n* 4.1 ä»¥åï¼Œé Android å¹³å°é»˜è®¤å¯ç”¨æ± åŒ–å®ç°ï¼ŒAndroid å¹³å°å¯ç”¨éæ± åŒ–å®ç°\n* 4.1 ä¹‹å‰ï¼Œæ± åŒ–åŠŸèƒ½è¿˜ä¸æˆç†Ÿï¼Œé»˜è®¤æ˜¯éæ± åŒ–å®ç°\n\n#### 4ï¼‰ç»„æˆ\n\nByteBuf ç”±å››éƒ¨åˆ†ç»„æˆ\n\n![[z-oblib/z2-attachments/cba17278034a053c70930947343310aa.png]]\n\næœ€å¼€å§‹è¯»å†™æŒ‡é’ˆéƒ½åœ¨ 0 ä½ç½®\næœ€å¤§å®¹é‡é»˜è®¤æ˜¯Iterator.MAX_VALUE\n\n\u003eå’ŒNIOç›¸æ¯”ï¼Œä¸¤æ¡æŒ‡é’ˆä¸ç”¨flipè¿›è¡Œè¯»å†™åˆ‡æ¢äº†ã€‚\n\n#### 5ï¼‰å†™å…¥\n\næ–¹æ³•åˆ—è¡¨ï¼Œçœç•¥ä¸€äº›ä¸é‡è¦çš„æ–¹æ³•\n\n| æ–¹æ³•ç­¾å                                                     | å«ä¹‰                   | å¤‡æ³¨                                        |\n| ------------------------------------------------------------ | ---------------------- | ------------------------------------------- |\n| writeBoolean(boolean value)                                  | å†™å…¥ boolean å€¼        | ç”¨ä¸€å­—èŠ‚ 01\\|00 ä»£è¡¨ true\\|false            |\n| writeByte(int value)                                         | å†™å…¥ byte å€¼           |                                             |\n| writeShort(int value)                                        | å†™å…¥ short å€¼          |                                             |\n| writeInt(int value)                                          | å†™å…¥ int å€¼            | Big Endianï¼Œå³ 0x250ï¼Œå†™å…¥å 00 00 02 50    |\n| writeIntLE(int value)                                        | å†™å…¥ int å€¼            | Little Endianï¼Œå³ 0x250ï¼Œå†™å…¥å 50 02 00 00 |\n| writeLong(long value)                                        | å†™å…¥ long å€¼           |                                             |\n| writeChar(int value)                                         | å†™å…¥ char å€¼           |                                             |\n| writeFloat(float value)                                      | å†™å…¥ float å€¼          |                                             |\n| writeDouble(double value)                                    | å†™å…¥ double å€¼         |                                             |\n| writeBytes(ByteBuf src)                                      | å†™å…¥ netty çš„ ByteBuf  |                                             |\n| writeBytes(byte[] src)                                       | å†™å…¥ byte[]            |                                             |\n| writeBytes(ByteBuffer src)                                   | å†™å…¥ nio çš„ ByteBuffer |                                             |\n| int writeCharSequence(CharSequence sequence, Charset charset) | å†™å…¥å­—ç¬¦ä¸²             |                                             |\n\n\u003e æ³¨æ„\n\u003e\n\u003eè¿™äº›æ–¹æ³•çš„æœªæŒ‡æ˜è¿”å›å€¼çš„ï¼Œå…¶è¿”å›å€¼éƒ½æ˜¯ ByteBufï¼Œæ„å‘³ç€å¯ä»¥é“¾å¼è°ƒç”¨\n\u003eç½‘ç»œä¼ è¾“ï¼Œé»˜è®¤ä¹ æƒ¯æ˜¯ Big Endian\n\nå…ˆå†™å…¥ 4 ä¸ªå­—èŠ‚\n\n```java\nbuffer.writeBytes(new byte[]{1, 2, 3, 4});\nlog(buffer);\n```\n\nç»“æœæ˜¯\n\n```\nread index:0 write index:4 capacity:10\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04                                     |....            |\n+--------+-------------------------------------------------+----------------+\n```\n\nå†å†™å…¥ä¸€ä¸ª int æ•´æ•°ï¼Œä¹Ÿæ˜¯ 4 ä¸ªå­—èŠ‚\n\n```java\nbuffer.writeInt(5);\nlog(buffer);\n```\n\nç»“æœæ˜¯\n\n```\nread index:0 write index:8 capacity:10\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 00 00 00 05                         |........        |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿˜æœ‰ä¸€ç±»æ–¹æ³•æ˜¯ set å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å†™å…¥æ•°æ®ï¼Œä½†ä¸ä¼šæ”¹å˜å†™æŒ‡é’ˆä½ç½®\n\n#### 6ï¼‰æ‰©å®¹\n\nå†å†™å…¥ä¸€ä¸ª int æ•´æ•°æ—¶ï¼Œå®¹é‡ä¸å¤Ÿäº†ï¼ˆåˆå§‹å®¹é‡æ˜¯ 10ï¼‰ï¼Œè¿™æ—¶ä¼šå¼•å‘æ‰©å®¹\n\n```java\nbuffer.writeInt(6);\nlog(buffer);\n```\n\næ‰©å®¹è§„åˆ™æ˜¯\n\n* å¦‚ä½•å†™å…¥åæ•°æ®å¤§å°æœªè¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 16 çš„æ•´æ•°å€ï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 12 ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 16\n* å¦‚æœå†™å…¥åæ•°æ®å¤§å°è¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 2^nï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 513ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 2^10=1024ï¼ˆ2^9=512 å·²ç»ä¸å¤Ÿäº†ï¼‰\n* æ‰©å®¹ä¸èƒ½è¶…è¿‡ max capacity ä¼šæŠ¥é”™\n\nç»“æœæ˜¯\n\n```\nread index:0 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 00 00 00 05 00 00 00 06             |............    |\n+--------+-------------------------------------------------+----------------+\n```\n\n#### 7ï¼‰è¯»å–\n\nä¾‹å¦‚è¯»äº† 4 æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªå­—èŠ‚\n\n```java\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nlog(buffer);\n```\n\nè¯»è¿‡çš„å†…å®¹ï¼Œå°±å±äºåºŸå¼ƒéƒ¨åˆ†äº†ï¼Œå†è¯»åªèƒ½è¯»é‚£äº›å°šæœªè¯»å–çš„éƒ¨åˆ†\n\n```\n1\n2\n3\n4\nread index:4 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 05 00 00 00 06                         |........        |\n+--------+-------------------------------------------------+----------------+\n```\n\nå¦‚æœéœ€è¦é‡å¤è¯»å– int æ•´æ•° 5ï¼Œæ€ä¹ˆåŠï¼Ÿ\n\nå¯ä»¥åœ¨ read å‰å…ˆåšä¸ª**è¯»æŒ‡é’ˆ**çš„æ ‡è®° mark\n\n```java\nbuffer.markReaderIndex();\nSystem.out.println(buffer.readInt());\nlog(buffer);\n```\n\nç»“æœ\n\n```\n5\nread index:8 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 06                                     |....            |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™æ—¶è¦é‡å¤è¯»å–çš„è¯ï¼Œè¯»æŒ‡é’ˆé‡ç½®åˆ°æ ‡è®°ä½ç½® reset\n\n```java\nbuffer.resetReaderIndex();\nlog(buffer);\n```\n\nè¿™æ—¶\n\n```\nread index:4 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 05 00 00 00 06                         |........        |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿˜æœ‰ç§åŠæ³•æ˜¯é‡‡ç”¨ get å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸ä¼šæ”¹å˜ read index\n\n#### 8ï¼‰retain \u0026 release\n\nç”±äº Netty ä¸­æœ‰å †å¤–å†…å­˜çš„ ByteBuf å®ç°ï¼Œå †å¤–å†…å­˜æœ€å¥½æ˜¯æ‰‹åŠ¨æ¥é‡Šæ”¾ï¼Œè€Œä¸æ˜¯ç­‰ GC åƒåœ¾å›æ”¶ã€‚\n\n* UnpooledHeapByteBuf ä½¿ç”¨çš„æ˜¯ JVM å†…å­˜ï¼Œåªéœ€ç­‰ GC å›æ”¶å†…å­˜å³å¯\n* UnpooledDirectByteBuf ä½¿ç”¨çš„å°±æ˜¯ç›´æ¥å†…å­˜äº†ï¼Œéœ€è¦ç‰¹æ®Šçš„æ–¹æ³•æ¥å›æ”¶å†…å­˜\n* PooledByteBuf å’Œå®ƒçš„å­ç±»ä½¿ç”¨äº†æ± åŒ–æœºåˆ¶ï¼Œéœ€è¦æ›´å¤æ‚çš„è§„åˆ™æ¥å›æ”¶å†…å­˜\n\n\u003e å›æ”¶å†…å­˜çš„æºç å®ç°ï¼Œè¯·å…³æ³¨ä¸‹é¢æ–¹æ³•çš„ä¸åŒå®ç°\n\u003e `protected abstract void deallocate()`\n\nNetty è¿™é‡Œé‡‡ç”¨äº†å¼•ç”¨è®¡æ•°æ³•æ¥æ§åˆ¶å›æ”¶å†…å­˜ï¼Œæ¯ä¸ª ByteBuf éƒ½å®ç°äº† ReferenceCounted æ¥å£\n\n* æ¯ä¸ª ByteBuf å¯¹è±¡çš„åˆå§‹è®¡æ•°ä¸º 1\n* è°ƒç”¨ release æ–¹æ³•è®¡æ•°å‡ 1ï¼Œå¦‚æœè®¡æ•°ä¸º 0ï¼ŒByteBuf å†…å­˜è¢«å›æ”¶\n* è°ƒç”¨ retain æ–¹æ³•è®¡æ•°åŠ  1ï¼Œè¡¨ç¤ºè°ƒç”¨è€…æ²¡ç”¨å®Œä¹‹å‰ï¼Œå…¶å®ƒ handler å³ä½¿è°ƒç”¨äº† release ä¹Ÿä¸ä¼šé€ æˆå›æ”¶\n* å½“è®¡æ•°ä¸º 0 æ—¶ï¼Œåº•å±‚å†…å­˜ä¼šè¢«å›æ”¶ï¼Œè¿™æ—¶å³ä½¿ ByteBuf å¯¹è±¡è¿˜åœ¨ï¼Œå…¶å„ä¸ªæ–¹æ³•å‡æ— æ³•æ­£å¸¸ä½¿ç”¨\n\nè°æ¥è´Ÿè´£ release å‘¢ï¼Ÿ\n\nä¸æ˜¯æˆ‘ä»¬æƒ³è±¡çš„ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼‰\n\n```java\nByteBuf buf = ...\ntry {\n    ...\n} finally {\n    buf.release();\n}\n```\n\nè¯·æ€è€ƒï¼Œå› ä¸º pipeline çš„å­˜åœ¨ï¼Œä¸€èˆ¬éœ€è¦å°† ByteBuf ä¼ é€’ç»™ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¦‚æœåœ¨ finally ä¸­ release äº†ï¼Œå°±å¤±å»äº†ä¼ é€’æ€§ï¼ˆå½“ç„¶ï¼Œå¦‚æœåœ¨è¿™ä¸ª ChannelHandler å†…è¿™ä¸ª ByteBuf å·²å®Œæˆäº†å®ƒçš„ä½¿å‘½ï¼Œé‚£ä¹ˆä¾¿æ— é¡»å†ä¼ é€’ï¼‰\n\nåŸºæœ¬è§„åˆ™æ˜¯ï¼Œ**è°æ˜¯æœ€åä½¿ç”¨è€…ï¼Œè°è´Ÿè´£ release**ï¼Œè¯¦ç»†åˆ†æå¦‚ä¸‹\n\n* èµ·ç‚¹ï¼Œå¯¹äº NIO å®ç°æ¥è®²ï¼Œåœ¨ `io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read` æ–¹æ³•ä¸­é¦–æ¬¡åˆ›å»º ByteBuf æ”¾å…¥ pipelineï¼ˆline 163 pipeline.fireChannelRead(byteBuf)ï¼‰\n* å…¥ç«™ ByteBuf å¤„ç†åŸåˆ™\n  * å¯¹åŸå§‹ ByteBuf ä¸åšå¤„ç†ï¼Œè°ƒç”¨ `ctx.fireChannelRead(msg)` å‘åä¼ é€’ï¼Œè¿™æ—¶æ— é¡» release\n  * å°†åŸå§‹ ByteBuf è½¬æ¢ä¸ºå…¶å®ƒç±»å‹çš„ Java å¯¹è±¡ï¼Œè¿™æ—¶ ByteBuf å°±æ²¡ç”¨äº†ï¼Œå¿…é¡» release\n  * **å¦‚æœä¸è°ƒç”¨ `ctx.fireChannelRead(msg)` å‘åä¼ é€’ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡» release**\n  * æ³¨æ„å„ç§å¼‚å¸¸ï¼Œå¦‚æœ ByteBuf æ²¡æœ‰æˆåŠŸä¼ é€’åˆ°ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¿…é¡» release\n  * å‡è®¾æ¶ˆæ¯ä¸€ç›´å‘åä¼ ï¼Œé‚£ä¹ˆ **TailContext ä¼šè´Ÿè´£é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯**ï¼ˆåŸå§‹çš„ ByteBufï¼‰\n* å‡ºç«™ ByteBuf å¤„ç†åŸåˆ™\n  * å‡ºç«™æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè½¬ä¸º ByteBuf è¾“å‡ºï¼Œä¸€ç›´å‘å‰ä¼ ï¼Œç”± **HeadContext flush å release**\n* å¼‚å¸¸å¤„ç†åŸåˆ™\n  * æœ‰æ—¶å€™ä¸æ¸…æ¥š ByteBuf è¢«å¼•ç”¨äº†å¤šå°‘æ¬¡ï¼Œä½†åˆå¿…é¡»å½»åº•é‡Šæ”¾ï¼Œå¯ä»¥**å¾ªç¯è°ƒç”¨ release** ç›´åˆ°è¿”å› true\n\nTailContext é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯é€»è¾‘\n\n```java\n// io.netty.channel.DefaultChannelPipeline#onUnhandledInboundMessage(java.lang.Object)\nprotected void onUnhandledInboundMessage(Object msg) {\n    try {\n        logger.debug(\n            \"Discarded inbound message {} that reached at the tail of the pipeline. \" +\n            \"Please check your pipeline configuration.\", msg);\n    } finally {\n        ReferenceCountUtil.release(msg);\n    }\n}\n```\n\nå…·ä½“ä»£ç \n\n```java\n// io.netty.util.ReferenceCountUtil#release(java.lang.Object)\npublic static boolean release(Object msg) {\n    if (msg instanceof ReferenceCounted) {\n        return ((ReferenceCounted) msg).release();\n    }\n    // ä¸æ˜¯ByteBufç±»å‹ä¹Ÿä¸ç”¨å¤„ç†\n    return false;\n}\n```\n\n#### 9ï¼‰slice\n\n**é›¶æ‹·è´**çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯¹åŸå§‹ ByteBuf è¿›è¡Œåˆ‡ç‰‡æˆå¤šä¸ª ByteBufï¼Œåˆ‡ç‰‡åçš„ ByteBuf å¹¶**æ²¡æœ‰**å‘ç”Ÿå†…å­˜å¤åˆ¶ï¼Œè¿˜æ˜¯ä½¿ç”¨åŸå§‹ ByteBuf çš„å†…å­˜ï¼Œåˆ‡ç‰‡åçš„ ByteBuf ç»´æŠ¤ç‹¬ç«‹çš„ readï¼Œwrite æŒ‡é’ˆ\n\n![[z-oblib/z2-attachments/ae0b62ba4b5935c66674cb603da6bbc4.png]]\n\nä¾‹ï¼ŒåŸå§‹ ByteBuf è¿›è¡Œä¸€äº›åˆå§‹æ“ä½œ\n\n```java\nByteBuf origin = ByteBufAllocator.DEFAULT.buffer(10);\norigin.writeBytes(new byte[]{1, 2, 3, 4});\norigin.readByte();\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™æ—¶è°ƒç”¨ slice è¿›è¡Œåˆ‡ç‰‡ï¼Œæ— å‚ slice æ˜¯ä»åŸå§‹ ByteBuf çš„ read index åˆ° write index ä¹‹é—´çš„å†…å®¹è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡åçš„ max capacity è¢«å›ºå®šä¸ºè¿™ä¸ªåŒºé—´çš„å¤§å°ï¼Œå› æ­¤**ä¸èƒ½**è¿½åŠ  write\n\n```java\nByteBuf slice = origin.slice();\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n// slice.writeByte(5); å¦‚æœæ‰§è¡Œï¼Œä¼šæŠ¥ IndexOutOfBoundsException å¼‚å¸¸\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n```\n\nå¦‚æœåŸå§‹ ByteBuf å†æ¬¡è¯»æ“ä½œï¼ˆåˆè¯»äº†ä¸€ä¸ªå­—èŠ‚ï¼‰\n\n```java\norigin.readByte();\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 03 04                                           |..              |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™æ—¶çš„ slice ä¸å—å½±å“ï¼Œå› ä¸ºå®ƒæœ‰ç‹¬ç«‹çš„è¯»å†™æŒ‡é’ˆ\n\n```java\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n```\n\nå¦‚æœ slice çš„å†…å®¹å‘ç”Ÿäº†æ›´æ”¹\n\n```java\nslice.setByte(2, 5);\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 05                                        |...             |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™æ—¶ï¼ŒåŸå§‹ ByteBuf ä¹Ÿä¼šå—å½±å“ï¼Œå› ä¸ºåº•å±‚éƒ½æ˜¯åŒä¸€å—å†…å­˜\n\n```\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 03 05                                           |..              |\n+--------+-------------------------------------------------+----------------+\n```\n\n#### 10ï¼‰duplicate\n\nã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå°±å¥½æ¯”æˆªå–äº†åŸå§‹ ByteBuf æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰ max capacity çš„é™åˆ¶ï¼Œä¹Ÿæ˜¯ä¸åŸå§‹ ByteBuf ä½¿ç”¨åŒä¸€å—åº•å±‚å†…å­˜ï¼Œåªæ˜¯**è¯»å†™æŒ‡é’ˆ**æ˜¯ç‹¬ç«‹çš„\n\n![[z-oblib/z2-attachments/dc2294119a7fdc68f77855060844c978.png]]\n\n#### 11ï¼‰copy\n\nä¼šå°†åº•å±‚å†…å­˜æ•°æ®è¿›è¡Œ**æ·±æ‹·è´**ï¼Œå› æ­¤æ— è®ºè¯»å†™ï¼Œéƒ½ä¸åŸå§‹ ByteBuf æ— å…³\n\n#### 12ï¼‰CompositeByteBuf\n\nã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯ä»¥å°†å¤šä¸ª ByteBuf **åˆå¹¶**ä¸ºä¸€ä¸ªé€»è¾‘ä¸Šçš„ ByteBufï¼Œé¿å…æ‹·è´\n\næœ‰ä¸¤ä¸ª ByteBuf å¦‚ä¸‹\n\n```java\nByteBuf buf1 = ByteBufAllocator.DEFAULT.buffer(5);\nbuf1.writeBytes(new byte[]{1, 2, 3, 4, 5});\nByteBuf buf2 = ByteBufAllocator.DEFAULT.buffer(5);\nbuf2.writeBytes(new byte[]{6, 7, 8, 9, 10});\nSystem.out.println(ByteBufUtil.prettyHexDump(buf1));\nSystem.out.println(ByteBufUtil.prettyHexDump(buf2));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05                                  |.....           |\n+--------+-------------------------------------------------+----------------+\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 06 07 08 09 0a                                  |.....           |\n+--------+-------------------------------------------------+----------------+\n```\n\nç°åœ¨éœ€è¦ä¸€ä¸ªæ–°çš„ ByteBufï¼Œå†…å®¹æ¥è‡ªäºåˆšæ‰çš„ buf1 å’Œ buf2ï¼Œå¦‚ä½•å®ç°ï¼Ÿ\n\næ–¹æ³•1ï¼š\n\n```java\nByteBuf buf3 = ByteBufAllocator.DEFAULT\n    .buffer(buf1.readableBytes()+buf2.readableBytes());\nbuf3.writeBytes(buf1);\nbuf3.writeBytes(buf2);\nSystem.out.println(ByteBufUtil.prettyHexDump(buf3));\n```\n\nç»“æœ\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™ç§æ–¹æ³•å¥½ä¸å¥½ï¼Ÿå›ç­”æ˜¯ä¸å¤ªå¥½ï¼Œå› ä¸ºè¿›è¡Œäº†æ•°æ®çš„å†…å­˜å¤åˆ¶æ“ä½œ\n\næ–¹æ³•2ï¼š\n\n```java\nCompositeByteBuf buf3 = ByteBufAllocator.DEFAULT.compositeBuffer();\n// true è¡¨ç¤ºå¢åŠ æ–°çš„ ByteBuf è‡ªåŠ¨é€’å¢ write index, å¦åˆ™ write index ä¼šå§‹ç»ˆä¸º 0\nbuf3.addComponents(true, buf1, buf2);\n```\n\nç»“æœæ˜¯ä¸€æ ·çš„\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n```\n\nCompositeByteBuf æ˜¯ä¸€ä¸ªç»„åˆçš„ ByteBufï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Component **æ•°ç»„**ï¼Œæ¯ä¸ª Component ç®¡ç†ä¸€ä¸ª ByteBufï¼Œè®°å½•äº†è¿™ä¸ª ByteBuf ç›¸å¯¹äºæ•´ä½“**åç§»é‡**ç­‰ä¿¡æ¯ï¼Œä»£è¡¨ç€æ•´ä½“ä¸­æŸä¸€æ®µçš„æ•°æ®ã€‚\n\n* ä¼˜ç‚¹ï¼Œå¯¹å¤–æ˜¯ä¸€ä¸ªè™šæ‹Ÿè§†å›¾ï¼Œç»„åˆè¿™äº› ByteBuf ä¸ä¼šäº§ç”Ÿå†…å­˜å¤åˆ¶\n* ç¼ºç‚¹ï¼Œå¤æ‚äº†å¾ˆå¤šï¼Œå¤šæ¬¡æ“ä½œä¼šå¸¦æ¥æ€§èƒ½çš„æŸè€—\n\n#### 13ï¼‰Unpooled\n\nUnpooled æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç±»å¦‚å…¶åï¼Œæä¾›äº†**éæ± åŒ–**çš„ ByteBuf åˆ›å»ºã€ç»„åˆã€å¤åˆ¶ç­‰æ“ä½œ\n\nè¿™é‡Œä»…ä»‹ç»å…¶è·Ÿã€é›¶æ‹·è´ã€‘ç›¸å…³çš„ wrappedBuffer æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åŒ…è£… ByteBuf\n\n```java\nByteBuf buf1 = ByteBufAllocator.DEFAULT.buffer(5);\nbuf1.writeBytes(new byte[]{1, 2, 3, 4, 5});\nByteBuf buf2 = ByteBufAllocator.DEFAULT.buffer(5);\nbuf2.writeBytes(new byte[]{6, 7, 8, 9, 10});\n\n// å½“åŒ…è£… ByteBuf ä¸ªæ•°è¶…è¿‡ä¸€ä¸ªæ—¶, åº•å±‚ä½¿ç”¨äº† CompositeByteBuf\nByteBuf buf3 = Unpooled.wrappedBuffer(buf1, buf2);\nSystem.out.println(ByteBufUtil.prettyHexDump(buf3));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n```\n\nä¹Ÿå¯ä»¥ç”¨æ¥åŒ…è£…æ™®é€šå­—èŠ‚æ•°ç»„ï¼Œåº•å±‚ä¹Ÿä¸ä¼šæœ‰æ‹·è´æ“ä½œ\n\n```java\nByteBuf buf4 = Unpooled.wrappedBuffer(new byte[]{1, 2, 3}, new byte[]{4, 5, 6});\nSystem.out.println(buf4.getClass());\nSystem.out.println(ByteBufUtil.prettyHexDump(buf4));\n```\n\nè¾“å‡º\n\n```\nclass io.netty.buffer.CompositeByteBuf\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06                               |......          |\n+--------+-------------------------------------------------+----------------+\n```\n\n#### ğŸ’¡ ByteBuf ä¼˜åŠ¿\n\n* **æ± åŒ–** - å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œæ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½\n* **è¯»å†™æŒ‡é’ˆåˆ†ç¦»**ï¼Œä¸éœ€è¦åƒ ByteBuffer ä¸€æ ·åˆ‡æ¢è¯»å†™æ¨¡å¼\n* å¯ä»¥**è‡ªåŠ¨æ‰©å®¹**\n* æ”¯æŒ**é“¾å¼è°ƒç”¨**ï¼Œä½¿ç”¨æ›´æµç•…\n* å¾ˆå¤šåœ°æ–¹ä½“ç°**é›¶æ‹·è´**ï¼Œä¾‹å¦‚ sliceã€duplicateã€CompositeByteBuf\n\n## 4. åŒå‘é€šä¿¡\n\n### 4.1 ç»ƒä¹ \n\nå®ç°ä¸€ä¸ª echo server\n\nç¼–å†™ server\n\n```java\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioServerSocketChannel.class)\n    .childHandler(new ChannelInitializer\u003cNioSocketChannel\u003e() {\n        @Override\n        protected void initChannel(NioSocketChannel ch) {\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    ByteBuf buffer = (ByteBuf) msg;\n                    System.out.println(buffer.toString(Charset.defaultCharset()));\n\n                    // å»ºè®®ä½¿ç”¨ ctx.alloc() åˆ›å»º ByteBuf\n                    ByteBuf response = ctx.alloc().buffer();\n                    response.writeBytes(buffer);\n                    ctx.writeAndFlush(response);\n\n                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—\n                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ response å—\n                }\n            });\n        }\n    }).bind(8080);\n```\n\nç¼–å†™ client\n\n```java\nNioEventLoopGroup group = new NioEventLoopGroup();\nChannel channel = new Bootstrap()\n    .group(group)\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer\u003cNioSocketChannel\u003e() {\n        @Override\n        protected void initChannel(NioSocketChannel ch) throws Exception {\n            ch.pipeline().addLast(new StringEncoder());\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    ByteBuf buffer = (ByteBuf) msg;\n                    System.out.println(buffer.toString(Charset.defaultCharset()));\n\n                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—\n                }\n            });\n        }\n    }).connect(\"127.0.0.1\", 8080).sync().channel();\n\nchannel.closeFuture().addListener(future -\u003e {\n    group.shutdownGracefully();\n});\n\nnew Thread(() -\u003e {\n    Scanner scanner = new Scanner(System.in);\n    while (true) {\n        String line = scanner.nextLine();\n        if (\"q\".equals(line)) {\n            channel.close();\n            break;\n        }\n        channel.writeAndFlush(line);\n    }\n}).start();\n```\n\n### ğŸ’¡ è¯»å’Œå†™çš„è¯¯è§£\n\næˆ‘æœ€åˆåœ¨è®¤è¯†ä¸Šæœ‰è¿™æ ·çš„è¯¯åŒºï¼Œè®¤ä¸ºåªæœ‰åœ¨ nettyï¼Œnio è¿™æ ·çš„å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ—¶ï¼Œè¯»å†™æ‰ä¸ä¼šç›¸äº’é˜»å¡ï¼Œæ‰å¯ä»¥å®ç°é«˜æ•ˆçš„åŒå‘é€šä¿¡ï¼Œä½†å®é™…ä¸Šï¼ŒJava Socket æ˜¯å…¨åŒå·¥çš„ï¼šåœ¨ä»»æ„æ—¶åˆ»ï¼Œçº¿è·¯ä¸Šå­˜åœ¨`A åˆ° B` å’Œ `B åˆ° A` çš„åŒå‘ä¿¡å·ä¼ è¾“ã€‚å³ä½¿æ˜¯é˜»å¡ IOï¼Œè¯»å’Œå†™æ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„ï¼Œåªè¦åˆ†åˆ«é‡‡ç”¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å³å¯ï¼Œè¯»ä¸ä¼šé˜»å¡å†™ã€å†™ä¹Ÿä¸ä¼šé˜»å¡è¯»\n\nä¾‹å¦‚\n\n```java\npublic class TestServer {\n    public static void main(String[] args) throws IOException {\n        ServerSocket ss = new ServerSocket(8888);\n        Socket s = ss.accept();\n\n        new Thread(() -\u003e {\n            try {\n                BufferedReader reader = new BufferedReader(new InputStreamReader(s.getInputStream()));\n                while (true) {\n                    System.out.println(reader.readLine());\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n\n        new Thread(() -\u003e {\n            try {\n                BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(s.getOutputStream()));\n                // ä¾‹å¦‚åœ¨è¿™ä¸ªä½ç½®åŠ å…¥ thread çº§åˆ«æ–­ç‚¹ï¼Œå¯ä»¥å‘ç°å³ä½¿ä¸å†™å…¥æ•°æ®ï¼Œä¹Ÿä¸å¦¨ç¢å‰é¢çº¿ç¨‹è¯»å–å®¢æˆ·ç«¯æ•°æ®\n                for (int i = 0; i \u003c 100; i++) {\n                    writer.write(String.valueOf(i));\n                    writer.newLine();\n                    writer.flush();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n    }\n}\n```\n\nå®¢æˆ·ç«¯\n\n```java\npublic class TestClient {\n    public static void main(String[] args) throws IOException {\n        Socket s = new Socket(\"localhost\", 8888);\n\n        new Thread(() -\u003e {\n            try {\n                BufferedReader reader = new BufferedReader(new InputStreamReader(s.getInputStream()));\n                while (true) {\n                    System.out.println(reader.readLine());\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n\n        new Thread(() -\u003e {\n            try {\n                BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(s.getOutputStream()));\n                for (int i = 0; i \u003c 100; i++) {\n                    writer.write(String.valueOf(i));\n                    writer.newLine();\n                    writer.flush();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n    }\n}\n```\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Netty/Netty%E8%BF%9B%E9%98%B6":{"title":"Nettyè¿›é˜¶","content":"\n# Nettyè¿›é˜¶\n\n## 1. ç²˜åŒ…ä¸åŠåŒ…\n\n### 1.1 ç²˜åŒ…ç°è±¡\n\næœåŠ¡ç«¯ä»£ç \n\n```java\npublic class HelloWorldServer {\n    static final Logger log = LoggerFactory.getLogger(HelloWorldServer.class);\n    void start() {\n        NioEventLoopGroup boss = new NioEventLoopGroup(1);\n        NioEventLoopGroup worker = new NioEventLoopGroup();\n        try {\n            ServerBootstrap serverBootstrap = new ServerBootstrap();\n            serverBootstrap.channel(NioServerSocketChannel.class);\n            serverBootstrap.group(boss, worker);\n            serverBootstrap.childHandler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                    ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                        @Override\n                        public void channelActive(ChannelHandlerContext ctx) throws Exception {\n                            log.debug(\"connected {}\", ctx.channel());\n                            super.channelActive(ctx);\n                        }\n\n                        @Override\n                        public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n                            log.debug(\"disconnect {}\", ctx.channel());\n                            super.channelInactive(ctx);\n                        }\n                    });\n                }\n            });\n            ChannelFuture channelFuture = serverBootstrap.bind(8080);\n            log.debug(\"{} binding...\", channelFuture.channel());\n            channelFuture.sync();\n            log.debug(\"{} bound...\", channelFuture.channel());\n            channelFuture.channel().closeFuture().sync();\n        } catch (InterruptedException e) {\n            log.error(\"server error\", e);\n        } finally {\n            boss.shutdownGracefully();\n            worker.shutdownGracefully();\n            log.debug(\"stoped\");\n        }\n    }\n\n    public static void main(String[] args) {\n        new HelloWorldServer().start();\n    }\n}\n```\n\nå®¢æˆ·ç«¯ä»£ç å¸Œæœ›å‘é€ 10 ä¸ªæ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆæ¯æ˜¯ 16 å­—èŠ‚\n\n```java\npublic class HelloWorldClient {\n    static final Logger log = LoggerFactory.getLogger(HelloWorldClient.class);\n    public static void main(String[] args) {\n        NioEventLoopGroup worker = new NioEventLoopGroup();\n        try {\n            Bootstrap bootstrap = new Bootstrap();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    log.debug(\"connetted...\");\n                    ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                        @Override\n                        public void channelActive(ChannelHandlerContext ctx) throws Exception {\n                            log.debug(\"sending...\");\n                            Random r = new Random();\n                            char c = 'a';\n                            for (int i = 0; i \u003c 10; i++) {\n                                ByteBuf buffer = ctx.alloc().buffer();\n                                buffer.writeBytes(new byte[]{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15});\n                                ctx.writeAndFlush(buffer);\n                            }\n                        }\n                    });\n                }\n            });\n            ChannelFuture channelFuture = bootstrap.connect(\"127.0.0.1\", 8080).sync();\n            channelFuture.channel().closeFuture().sync();\n\n        } catch (InterruptedException e) {\n            log.error(\"client error\", e);\n        } finally {\n            worker.shutdownGracefully();\n        }\n    }\n}\n```\n\næœåŠ¡å™¨ç«¯çš„æŸæ¬¡è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°ä¸€æ¬¡å°±æ¥æ”¶äº† 160 ä¸ªå­—èŠ‚ï¼Œè€Œéåˆ† 10 æ¬¡æ¥æ”¶\n\n```\n08:24:46 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x81e0fda5] binding...\n08:24:46 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x81e0fda5, L:/0:0:0:0:0:0:0:0:8080] bound...\n08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] REGISTERED\n08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] ACTIVE\n08:24:55 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177]\n08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] READ: 160B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000010| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000020| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000030| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000040| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000050| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000060| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000070| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000080| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000090| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n+--------+-------------------------------------------------+----------------+\n08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] READ COMPLETE\n```\n\n### 1.2 åŠåŒ…ç°è±¡\n\nå®¢æˆ·ç«¯ä»£ç å¸Œæœ›å‘é€ 1 ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ 160 å­—èŠ‚ï¼Œä»£ç æ”¹ä¸º\n\n```java\nByteBuf buffer = ctx.alloc().buffer();\nfor (int i = 0; i \u003c 10; i++) {\n    buffer.writeBytes(new byte[]{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15});\n}\nctx.writeAndFlush(buffer);\n```\n\nä¸ºç°è±¡æ˜æ˜¾ï¼ŒæœåŠ¡ç«¯ä¿®æ”¹ä¸€ä¸‹æ¥æ”¶ç¼“å†²åŒºï¼Œå…¶å®ƒä»£ç ä¸å˜\n\n```java\nserverBootstrap.option(ChannelOption.SO_RCVBUF, 10);\n```\n\næœåŠ¡å™¨ç«¯çš„æŸæ¬¡è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ¥æ”¶çš„æ¶ˆæ¯è¢«åˆ†ä¸ºä¸¤èŠ‚ï¼Œç¬¬ä¸€æ¬¡ 20 å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡ 140 å­—èŠ‚\n\n```\n08:43:49 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x4d6c6a84] binding...\n08:43:49 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x4d6c6a84, L:/0:0:0:0:0:0:0:0:8080] bound...\n08:44:23 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] REGISTERED\n08:44:23 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] ACTIVE\n08:44:23 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221]\n08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ: 20B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|\n|00000010| 00 01 02 03                                     |....            |\n+--------+-------------------------------------------------+----------------+\n08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ COMPLETE\n08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ: 140B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|\n|00000010| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|\n|00000020| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|\n|00000030| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|\n|00000040| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|\n|00000050| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|\n|00000060| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|\n|00000070| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................|\n|00000080| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f             |............    |\n+--------+-------------------------------------------------+----------------+\n08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ COMPLETE\n```\n\n\u003e **æ³¨æ„**\n\u003e\n\u003e serverBootstrap.option(ChannelOption.SO_RCVBUF, 10) å½±å“çš„åº•å±‚æ¥æ”¶ç¼“å†²åŒºï¼ˆå³æ»‘åŠ¨çª—å£ï¼‰å¤§å°ï¼Œä»…å†³å®šäº† netty è¯»å–çš„æœ€å°å•ä½ï¼Œnetty å®é™…æ¯æ¬¡è¯»å–çš„ä¸€èˆ¬æ˜¯å®ƒçš„æ•´æ•°å€\n\n### ğŸ’¡1.3 ç°è±¡åˆ†æ\n\n\u003eæ€»åŸå› ï¼šTCPæ¶ˆæ¯æ²¡æœ‰è¾¹ç•Œã€‚\n\n#### ç²˜åŒ…\n\n* ç°è±¡ï¼Œå‘é€ abc defï¼Œæ¥æ”¶ abcdef\n* åŸå› \n  * **åº”ç”¨å±‚**ï¼šæ¥æ”¶æ–¹ ByteBuf è®¾ç½®å¤ªå¤§ï¼ˆNetty é»˜è®¤ 1024ï¼‰\n  * **ä¼ è¾“å±‚**ï¼šTCPï¼šæ»‘åŠ¨çª—å£ï¼šå‡è®¾å‘é€æ–¹ 256 bytes è¡¨ç¤ºä¸€ä¸ªå®Œæ•´æŠ¥æ–‡ï¼Œä½†ç”±äºæ¥æ”¶æ–¹å¤„ç†ä¸åŠæ—¶ä¸”çª—å£å¤§å°è¶³å¤Ÿå¤§ï¼Œè¿™ 256 bytes å­—èŠ‚å°±ä¼šç¼“å†²åœ¨æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£ä¸­ï¼Œå½“æ»‘åŠ¨çª—å£ä¸­ç¼“å†²äº†å¤šä¸ªæŠ¥æ–‡å°±ä¼šç²˜åŒ…\n  * **ä¼ è¾“å±‚**ï¼šTCPï¼šNagle ç®—æ³•ï¼šä¼šé€ æˆç²˜åŒ…\n\n\u003e Nagle ç®—æ³•\n\u003e\n\u003e * ç³Šæ¶‚çª—å£ç»¼åˆå¾ï¼šå³ä½¿å‘é€1ä¸ªå­—èŠ‚ï¼Œä¹Ÿéœ€è¦åŠ å…¥ tcp å¤´å’Œ ip å¤´ï¼Œä¹Ÿå°±æ˜¯æ€»å­—èŠ‚æ•°ä¼šä½¿ç”¨ 41 bytesï¼ˆTCP20+IP20+æ•°æ®1ï¼‰ï¼Œéå¸¸ä¸ç»æµã€‚å› æ­¤ä¸ºäº†æé«˜ç½‘ç»œåˆ©ç”¨ç‡ï¼Œtcp å¸Œæœ›**å°½å¯èƒ½å‘é€è¶³å¤Ÿå¤§çš„æ•°æ®**ï¼Œè¿™å°±æ˜¯ Nagle ç®—æ³•äº§ç”Ÿçš„ç¼˜ç”±\n\u003e * è¯¥ç®—æ³•æ˜¯æŒ‡å‘é€ç«¯å³ä½¿è¿˜æœ‰åº”è¯¥å‘é€çš„æ•°æ®ï¼Œä½†å¦‚æœè¿™éƒ¨åˆ†æ•°æ®å¾ˆå°‘çš„è¯ï¼Œåˆ™è¿›è¡Œå»¶è¿Ÿå‘é€\n\u003e   * å¦‚æœ SO_SNDBUF çš„æ•°æ®è¾¾åˆ° MSSï¼Œåˆ™éœ€è¦å‘é€\n\u003e   * å¦‚æœ SO_SNDBUF ä¸­å«æœ‰ FINï¼ˆè¡¨ç¤ºéœ€è¦è¿æ¥å…³é—­ï¼‰è¿™æ—¶å°†å‰©ä½™æ•°æ®å‘é€ï¼Œå†å…³é—­\n\u003e   * å¦‚æœ TCP_NODELAY = trueï¼Œåˆ™éœ€è¦å‘é€\n\u003e   * å·²å‘é€çš„æ•°æ®éƒ½æ”¶åˆ° ack æ—¶ï¼Œåˆ™éœ€è¦å‘é€\n\u003e   * ä¸Šè¿°æ¡ä»¶ä¸æ»¡è¶³ï¼Œä½†å‘ç”Ÿè¶…æ—¶ï¼ˆä¸€èˆ¬ä¸º 200msï¼‰åˆ™éœ€è¦å‘é€\n\u003e   * é™¤ä¸Šè¿°æƒ…å†µï¼Œå»¶è¿Ÿå‘é€\n\n#### åŠåŒ…\n\n* ç°è±¡ï¼Œå‘é€ abcdefï¼Œæ¥æ”¶ abc def\n* åŸå› \n  * **åº”ç”¨å±‚**ï¼šæ¥æ”¶æ–¹ ByteBuf å°äºå®é™…å‘é€æ•°æ®é‡\n  * **ä¼ è¾“å±‚**ï¼šTCPï¼šæ»‘åŠ¨çª—å£ï¼šå‡è®¾æ¥æ”¶æ–¹çš„çª—å£åªå‰©äº† 128 bytesï¼Œå‘é€æ–¹çš„æŠ¥æ–‡å¤§å°æ˜¯ 256 bytesï¼Œè¿™æ—¶æ”¾ä¸ä¸‹äº†ï¼Œåªèƒ½å…ˆå‘é€å‰ 128 bytesï¼Œç­‰å¾… ack åæ‰èƒ½å‘é€å‰©ä½™éƒ¨åˆ†ï¼Œè¿™å°±é€ æˆäº†åŠåŒ…\n  * **æ•°æ®é“¾è·¯å±‚**ï¼šMSS é™åˆ¶ï¼šå½“å‘é€çš„æ•°æ®è¶…è¿‡ MSS é™åˆ¶åï¼Œä¼šå°†æ•°æ®åˆ‡åˆ†å‘é€ï¼Œå°±ä¼šé€ æˆåŠåŒ…\n\t  * â†‘MSSæ˜¯**ä¼ è¾“å±‚**çš„æŠ¥æ–‡è½½è·é•¿åº¦ï¼ˆä¸åŒ…å«æŠ¥å¤´ï¼‰ï¼ŒMTUæ˜¯**æ•°æ®é“¾è·¯å±‚**æœ€å¤§è½½è·é•¿åº¦ï¼Œå…¶ä¸­MTUåŒ…å«äº†MSSï¼ŒMTUå‡å»IPå¤´å’ŒTCPå¤´ï¼ˆ20+20ï¼‰å°±æ˜¯MSS\n\t  * æœ¬æœºå›ç¯åœ°å€MTUé™åˆ¶å¾ˆå¤§ï¼Œ65535ï¼Œéš¾ä»¥æµ‹è¯•ã€‚\n\næœ¬è´¨æ˜¯å› ä¸º TCP æ˜¯æµå¼åè®®ï¼Œæ¶ˆæ¯æ— è¾¹ç•Œ\n\n\u003e æ»‘åŠ¨çª—å£\n\u003e\n\u003e * TCP ä»¥ä¸€ä¸ªæ®µï¼ˆsegmentï¼‰ä¸ºå•ä½ï¼Œæ¯å‘é€ä¸€ä¸ªæ®µå°±éœ€è¦è¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”ï¼ˆackï¼‰å¤„ç†ï¼Œä½†å¦‚æœè¿™ä¹ˆåšï¼Œç¼ºç‚¹æ˜¯åŒ…çš„å¾€è¿”æ—¶é—´è¶Šé•¿æ€§èƒ½å°±è¶Šå·®\n\u003e\n\u003e   ![[z-oblib/z2-attachments/0049 1.png]]\n\u003e\n\u003e \n\u003e\n\u003e ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå¼•å…¥äº†çª—å£æ¦‚å¿µï¼Œçª—å£å¤§å°å³å†³å®šäº†æ— éœ€ç­‰å¾…åº”ç­”è€Œå¯ä»¥ç»§ç»­å‘é€çš„æ•°æ®æœ€å¤§å€¼\n\u003e\n\u003e  ![[z-oblib/z2-attachments/0051.png]]\n\u003e\n\u003e - çª—å£å®é™…å°±èµ·åˆ°ä¸€ä¸ªç¼“å†²åŒºçš„ä½œç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½èµ·åˆ°æµé‡æ§åˆ¶çš„ä½œç”¨\n\u003e\n\u003e   * å›¾ä¸­æ·±è‰²çš„éƒ¨åˆ†å³è¦å‘é€çš„æ•°æ®ï¼Œé«˜äº®çš„éƒ¨åˆ†å³çª—å£\n\u003e   * çª—å£å†…çš„æ•°æ®æ‰å…è®¸è¢«å‘é€ï¼Œå½“åº”ç­”æœªåˆ°è¾¾å‰ï¼Œçª—å£å¿…é¡»åœæ­¢æ»‘åŠ¨\n\u003e   * å¦‚æœ 1001~2000 è¿™ä¸ªæ®µçš„æ•°æ® ack å›æ¥äº†ï¼Œçª—å£å°±å¯ä»¥å‘å‰æ»‘åŠ¨\n\u003e   * æ¥æ”¶æ–¹ä¹Ÿä¼šç»´æŠ¤ä¸€ä¸ªçª—å£ï¼Œåªæœ‰è½åœ¨çª—å£å†…çš„æ•°æ®æ‰èƒ½å…è®¸æ¥æ”¶\n\u003e\n\n\n\u003e  MSS é™åˆ¶\n\u003e\n\u003e  * é“¾è·¯å±‚å¯¹ä¸€æ¬¡èƒ½å¤Ÿå‘é€çš„æœ€å¤§æ•°æ®æœ‰é™åˆ¶ï¼Œè¿™ä¸ªé™åˆ¶ç§°ä¹‹ä¸º MTUï¼ˆmaximum transmission unitï¼‰ï¼Œä¸åŒçš„é“¾è·¯è®¾å¤‡çš„ MTU å€¼ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä¾‹å¦‚\n\u003e\n\u003e   * ä»¥å¤ªç½‘çš„ MTU æ˜¯ 1500\n\u003e   * FDDIï¼ˆå…‰çº¤åˆ†å¸ƒå¼æ•°æ®æ¥å£ï¼‰çš„ MTU æ˜¯ 4352\n\u003e   * æœ¬åœ°å›ç¯åœ°å€çš„ MTU æ˜¯ 65535 - æœ¬åœ°æµ‹è¯•ä¸èµ°ç½‘å¡\n\u003e\n\u003e  * MSS æ˜¯æœ€å¤§æ®µé•¿åº¦ï¼ˆmaximum segment sizeï¼‰ï¼Œå®ƒæ˜¯ MTU åˆ¨å» tcp å¤´å’Œ ip å¤´åå‰©ä½™èƒ½å¤Ÿä½œä¸ºæ•°æ®ä¼ è¾“çš„å­—èŠ‚æ•°\n\u003e\n\u003e   * ipv4 tcp å¤´å ç”¨ 20 bytesï¼Œip å¤´å ç”¨ 20 bytesï¼Œå› æ­¤ä»¥å¤ªç½‘ MSS çš„å€¼ä¸º 1500 - 40 = 1460\n\u003e   * TCP åœ¨ä¼ é€’å¤§é‡æ•°æ®æ—¶ï¼Œä¼šæŒ‰ç…§ MSS å¤§å°å°†æ•°æ®è¿›è¡Œåˆ†å‰²å‘é€\n\u003e   * MSS çš„å€¼åœ¨ä¸‰æ¬¡æ¡æ‰‹æ—¶é€šçŸ¥å¯¹æ–¹è‡ªå·± MSS çš„å€¼ï¼Œç„¶ååœ¨ä¸¤è€…ä¹‹é—´é€‰æ‹©ä¸€ä¸ªå°å€¼ä½œä¸º MSS\n\u003e\n\u003e  ![[z-oblib/z2-attachments/0031.jpg]]\n\n### 1.4 ğŸ’¡è§£å†³æ–¹æ¡ˆ\n\n1. çŸ­é“¾æ¥ï¼Œå‘ä¸€ä¸ªåŒ…å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œè¿™æ ·è¿æ¥å»ºç«‹åˆ°è¿æ¥æ–­å¼€ä¹‹é—´å°±æ˜¯æ¶ˆæ¯çš„è¾¹ç•Œï¼Œç¼ºç‚¹æ•ˆç‡å¤ªä½\n2. æ¯ä¸€æ¡æ¶ˆæ¯é‡‡ç”¨å›ºå®šé•¿åº¦ï¼Œç¼ºç‚¹æµªè´¹ç©ºé—´\n3. æ¯ä¸€æ¡æ¶ˆæ¯é‡‡ç”¨åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ \\nï¼Œç¼ºç‚¹éœ€è¦è½¬ä¹‰\n4. æ¯ä¸€æ¡æ¶ˆæ¯åˆ†ä¸º head å’Œ bodyï¼Œhead ä¸­åŒ…å« body çš„é•¿åº¦\n\n#### æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥\n\nä»¥è§£å†³ç²˜åŒ…ä¸ºä¾‹\n\n```java\npublic class HelloWorldClient {\n    static final Logger log = LoggerFactory.getLogger(HelloWorldClient.class);\n\n    public static void main(String[] args) {\n        // åˆ† 10 æ¬¡å‘é€\n        for (int i = 0; i \u003c 10; i++) {\n            send();\n        }\n    }\n\n    private static void send() {\n        NioEventLoopGroup worker = new NioEventLoopGroup();\n        try {\n            Bootstrap bootstrap = new Bootstrap();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    log.debug(\"conneted...\");\n                    ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                    ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                        @Override\n                        public void channelActive(ChannelHandlerContext ctx) throws Exception {\n                            log.debug(\"sending...\");\n                            ByteBuf buffer = ctx.alloc().buffer();\n                            buffer.writeBytes(new byte[]{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15});\n                            ctx.writeAndFlush(buffer);\n                            // å‘å®Œå³å…³\n                            ctx.close();\n                        }\n                    });\n                }\n            });\n            ChannelFuture channelFuture = bootstrap.connect(\"localhost\", 8080).sync();\n            channelFuture.channel().closeFuture().sync();\n\n        } catch (InterruptedException e) {\n            log.error(\"client error\", e);\n        } finally {\n            worker.shutdownGracefully();\n        }\n    }\n}\n```\n\nè¾“å‡ºï¼Œç•¥\n\n##### ç¼ºç‚¹\n\nåŠåŒ…ç”¨è¿™ç§åŠæ³•è¿˜æ˜¯ä¸å¥½è§£å†³ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„ç¼“å†²åŒºå¤§å°æ˜¯æœ‰é™çš„\n\n#### æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦\n\nè®©æ‰€æœ‰æ•°æ®åŒ…é•¿åº¦å›ºå®šï¼ˆå‡è®¾é•¿åº¦ä¸º 8 å­—èŠ‚ï¼‰ï¼ŒæœåŠ¡å™¨ç«¯åŠ å…¥\n\n```java\nch.pipeline().addLast(new FixedLengthFrameDecoder(8));\n```\n\n\u003e frameï¼šå¸§ï¼Œç½‘ç»œä¸Šä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯\n\nå®¢æˆ·ç«¯æµ‹è¯•ä»£ç ï¼Œæ³¨æ„, é‡‡ç”¨è¿™ç§æ–¹æ³•åï¼Œå®¢æˆ·ç«¯ä»€ä¹ˆæ—¶å€™ flush éƒ½å¯ä»¥\n\n```java\npublic class HelloWorldClient {\n    static final Logger log = LoggerFactory.getLogger(HelloWorldClient.class);\n\n    public static void main(String[] args) {\n        NioEventLoopGroup worker = new NioEventLoopGroup();\n        try {\n            Bootstrap bootstrap = new Bootstrap();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    log.debug(\"connetted...\");\n                    ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                    ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                        @Override\n                        public void channelActive(ChannelHandlerContext ctx) throws Exception {\n                            log.debug(\"sending...\");\n                            // å‘é€å†…å®¹éšæœºçš„æ•°æ®åŒ…\n                            Random r = new Random();\n                            char c = 'a';\n                            ByteBuf buffer = ctx.alloc().buffer();\n                            for (int i = 0; i \u003c 10; i++) {\n                                byte[] bytes = new byte[8];\n                                for (int j = 0; j \u003c r.nextInt(8); j++) {\n                                    bytes[j] = (byte) c;\n                                }\n                                c++;\n                                buffer.writeBytes(bytes);\n                            }\n                            ctx.writeAndFlush(buffer);\n                        }\n                    });\n                }\n            });\n            ChannelFuture channelFuture = bootstrap.connect(\"192.168.0.103\", 9090).sync();\n            channelFuture.channel().closeFuture().sync();\n\n        } catch (InterruptedException e) {\n            log.error(\"client error\", e);\n        } finally {\n            worker.shutdownGracefully();\n        }\n    }\n}\n```\n\nå®¢æˆ·ç«¯è¾“å‡º\n\n```\n12:07:00 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...\n12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2] REGISTERED\n12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2] CONNECT: /192.168.0.103:9090\n12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] ACTIVE\n12:07:00 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...\n12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] WRITE: 80B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 61 61 61 61 00 00 00 00 62 00 00 00 00 00 00 00 |aaaa....b.......|\n|00000010| 63 63 00 00 00 00 00 00 64 00 00 00 00 00 00 00 |cc......d.......|\n|00000020| 00 00 00 00 00 00 00 00 66 66 66 66 00 00 00 00 |........ffff....|\n|00000030| 67 67 67 00 00 00 00 00 68 00 00 00 00 00 00 00 |ggg.....h.......|\n|00000040| 69 69 69 69 69 00 00 00 6a 6a 6a 6a 00 00 00 00 |iiiii...jjjj....|\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] FLUSH\n```\n\næœåŠ¡ç«¯è¾“å‡º\n\n```\n12:06:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xe3d9713f] binding...\n12:06:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xe3d9713f, L:/192.168.0.103:9090] bound...\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] REGISTERED\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] ACTIVE\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155]\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 61 61 61 61 00 00 00 00                         |aaaa....        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 62 00 00 00 00 00 00 00                         |b.......        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 63 63 00 00 00 00 00 00                         |cc......        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 64 00 00 00 00 00 00 00                         |d.......        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 00 00 00 00 00                         |........        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 66 66 66 66 00 00 00 00                         |ffff....        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 67 67 67 00 00 00 00 00                         |ggg.....        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 68 00 00 00 00 00 00 00                         |h.......        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 69 69 69 69 69 00 00 00                         |iiiii...        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6a 6a 6a 6a 00 00 00 00                         |jjjj....        |\n+--------+-------------------------------------------------+----------------+\n12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ COMPLETE\n```\n\n##### ç¼ºç‚¹\n\næ•°æ®åŒ…çš„å¤§å°ä¸å¥½æŠŠæ¡\n\n* é•¿åº¦å®šçš„å¤ªå¤§ï¼Œæµªè´¹\n* é•¿åº¦å®šçš„å¤ªå°ï¼Œå¯¹æŸäº›æ•°æ®åŒ…åˆæ˜¾å¾—ä¸å¤Ÿ\n\n#### æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦\n\næœåŠ¡ç«¯åŠ å…¥ï¼Œé»˜è®¤ä»¥ `\\n` æˆ– `\\r\\n` ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¿…é¡»æŒ‡å®šæœ€å¤§é•¿åº¦ï¼Œå¦‚æœè¶…å‡ºæŒ‡å®šé•¿åº¦ä»æœªå‡ºç°åˆ†éš”ç¬¦ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸\n\n```java\nch.pipeline().addLast(new LineBasedFrameDecoder(1024));\n```\n\nå®¢æˆ·ç«¯åœ¨æ¯æ¡æ¶ˆæ¯ä¹‹åï¼ŒåŠ å…¥ `\\n` åˆ†éš”ç¬¦\n\n```java\npublic class HelloWorldClient {\n    static final Logger log = LoggerFactory.getLogger(HelloWorldClient.class);\n\n    public static void main(String[] args) {\n        NioEventLoopGroup worker = new NioEventLoopGroup();\n        try {\n            Bootstrap bootstrap = new Bootstrap();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    log.debug(\"connetted...\");\n                    ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                    ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                        @Override\n                        public void channelActive(ChannelHandlerContext ctx) throws Exception {\n                            log.debug(\"sending...\");\n                            Random r = new Random();\n                            char c = 'a';\n                            ByteBuf buffer = ctx.alloc().buffer();\n                            for (int i = 0; i \u003c 10; i++) {\n                                for (int j = 1; j \u003c= r.nextInt(16)+1; j++) {\n                                    buffer.writeByte((byte) c);\n                                }\n                                buffer.writeByte(10);\n                                c++;\n                            }\n                            ctx.writeAndFlush(buffer);\n                        }\n                    });\n                }\n            });\n            ChannelFuture channelFuture = bootstrap.connect(\"192.168.0.103\", 9090).sync();\n            channelFuture.channel().closeFuture().sync();\n\n        } catch (InterruptedException e) {\n            log.error(\"client error\", e);\n        } finally {\n            worker.shutdownGracefully();\n        }\n    }\n}\n```\n\nå®¢æˆ·ç«¯è¾“å‡º\n\n```\n14:08:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...\n14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755] REGISTERED\n14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755] CONNECT: /192.168.0.103:9090\n14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] ACTIVE\n14:08:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...\n14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] WRITE: 60B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 61 0a 62 62 62 0a 63 63 63 0a 64 64 0a 65 65 65 |a.bbb.ccc.dd.eee|\n|00000010| 65 65 65 65 65 65 65 0a 66 66 0a 67 67 67 67 67 |eeeeeee.ff.ggggg|\n|00000020| 67 67 0a 68 68 68 68 0a 69 69 69 69 69 69 69 0a |gg.hhhh.iiiiiii.|\n|00000030| 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 0a             |jjjjjjjjjjj.    |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] FLUSH\n```\n\næœåŠ¡ç«¯è¾“å‡º\n\n```\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] c.i.n.HelloWorldServer - connected [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641]\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 1B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 61                                              |a               |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 3B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 62 62 62                                        |bbb             |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 3B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 63 63 63                                        |ccc             |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 2B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 64 64                                           |dd              |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 10B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 65 65 65 65 65 65 65 65 65 65                   |eeeeeeeeee      |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 2B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 66 66                                           |ff              |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 7B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 67 67 67 67 67 67 67                            |ggggggg         |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 4B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 68 68 68 68                                     |hhhh            |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 7B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 69 69 69 69 69 69 69                            |iiiiiii         |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 11B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a                |jjjjjjjjjjj     |\n+--------+-------------------------------------------------+----------------+\n14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ COMPLETE\n```\n\n##### ç¼ºç‚¹\n\nå¤„ç†å­—ç¬¦æ•°æ®æ¯”è¾ƒåˆé€‚ï¼Œä½†å¦‚æœå†…å®¹æœ¬èº«åŒ…å«äº†åˆ†éš”ç¬¦ï¼ˆå­—èŠ‚æ•°æ®å¸¸å¸¸ä¼šæœ‰æ­¤æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè§£æé”™è¯¯\n\n#### æ–¹æ³•4ï¼Œçº¦å®šé•¿åº¦\n\n\u003e ç±»ä¼¼httpåè®®çš„Content-Lengthã€‚å®é™…ä¸Šæˆ‘ä»¬å°±æ˜¯è¦è®¾è®¡ä¸€ä¸ªç±»ä¼¼httpçš„åè®®ã€‚\n\nåœ¨å‘é€æ¶ˆæ¯å‰ï¼Œå…ˆçº¦å®šç”¨å®šé•¿å­—èŠ‚è¡¨ç¤ºæ¥ä¸‹æ¥æ•°æ®çš„é•¿åº¦\n\n```java\n// æœ€å¤§é•¿åº¦ï¼Œé•¿åº¦åç§»ï¼Œé•¿åº¦å ç”¨å­—èŠ‚ï¼Œé•¿åº¦è°ƒæ•´ï¼Œå‰¥ç¦»å­—èŠ‚æ•°\nch.pipeline().addLast(new LengthFieldBasedFrameDecoder(1024, 0, 1, 0, 1));\n```\n\nå®¢æˆ·ç«¯ä»£ç \n\n```java\npublic class HelloWorldClient {\n    static final Logger log = LoggerFactory.getLogger(HelloWorldClient.class);\n\n    public static void main(String[] args) {\n        NioEventLoopGroup worker = new NioEventLoopGroup();\n        try {\n            Bootstrap bootstrap = new Bootstrap();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    log.debug(\"connetted...\");\n                    ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                    ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                        @Override\n                        public void channelActive(ChannelHandlerContext ctx) throws Exception {\n                            log.debug(\"sending...\");\n                            Random r = new Random();\n                            char c = 'a';\n                            ByteBuf buffer = ctx.alloc().buffer();\n                            for (int i = 0; i \u003c 10; i++) {\n                                byte length = (byte) (r.nextInt(16) + 1);\n                                // å…ˆå†™å…¥é•¿åº¦\n                                buffer.writeByte(length);\n                                // å†\n                                for (int j = 1; j \u003c= length; j++) {\n                                    buffer.writeByte((byte) c);\n                                }\n                                c++;\n                            }\n                            ctx.writeAndFlush(buffer);\n                        }\n                    });\n                }\n            });\n            ChannelFuture channelFuture = bootstrap.connect(\"192.168.0.103\", 9090).sync();\n            channelFuture.channel().closeFuture().sync();\n\n        } catch (InterruptedException e) {\n            log.error(\"client error\", e);\n        } finally {\n            worker.shutdownGracefully();\n        }\n    }\n}\n```\n\nå®¢æˆ·ç«¯è¾“å‡º\n\n```\n14:37:10 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...\n14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8] REGISTERED\n14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8] CONNECT: /192.168.0.103:9090\n14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] ACTIVE\n14:37:10 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...\n14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] WRITE: 97B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 09 61 61 61 61 61 61 61 61 61 09 62 62 62 62 62 |.aaaaaaaaa.bbbbb|\n|00000010| 62 62 62 62 06 63 63 63 63 63 63 08 64 64 64 64 |bbbb.cccccc.dddd|\n|00000020| 64 64 64 64 0f 65 65 65 65 65 65 65 65 65 65 65 |dddd.eeeeeeeeeee|\n|00000030| 65 65 65 65 0d 66 66 66 66 66 66 66 66 66 66 66 |eeee.fffffffffff|\n|00000040| 66 66 02 67 67 02 68 68 0e 69 69 69 69 69 69 69 |ff.gg.hh.iiiiiii|\n|00000050| 69 69 69 69 69 69 69 09 6a 6a 6a 6a 6a 6a 6a 6a |iiiiiii.jjjjjjjj|\n|00000060| 6a                                              |j               |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] FLUSH\n```\n\næœåŠ¡ç«¯è¾“å‡º\n\n```\n14:36:50 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xdff439d3] binding...\n14:36:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xdff439d3, L:/192.168.0.103:9090] bound...\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] REGISTERED\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] ACTIVE\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979]\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 61 61 61 61 61 61 61 61 61                      |aaaaaaaaa       |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 62 62 62 62 62 62 62 62 62                      |bbbbbbbbb       |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 6B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 63 63 63 63 63 63                               |cccccc          |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 64 64 64 64 64 64 64 64                         |dddddddd        |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 15B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 65 65 65 65 65 65 65 65 65 65 65 65 65 65 65    |eeeeeeeeeeeeeee |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 13B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 66 66 66 66 66 66 66 66 66 66 66 66 66          |fffffffffffff   |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 2B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 67 67                                           |gg              |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 2B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 68 68                                           |hh              |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 14B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 69 69 69 69 69 69 69 69 69 69 69 69 69 69       |iiiiiiiiiiiiii  |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6a 6a 6a 6a 6a 6a 6a 6a 6a                      |jjjjjjjjj       |\n+--------+-------------------------------------------------+----------------+\n14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ COMPLETE\n\n```\n\n## 2. åè®®è®¾è®¡ä¸è§£æ\n\n### 2.1 ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ\n\n\u003e TCP/IP ä¸­æ¶ˆæ¯ä¼ è¾“åŸºäº**æµ**çš„æ–¹å¼ï¼Œ**æ²¡æœ‰è¾¹ç•Œ**ã€‚\n\nåè®®çš„ç›®çš„å°±æ˜¯åˆ’å®šæ¶ˆæ¯çš„è¾¹ç•Œï¼Œåˆ¶å®šé€šä¿¡åŒæ–¹è¦å…±åŒéµå®ˆçš„é€šä¿¡è§„åˆ™\n\nä¾‹å¦‚ï¼šåœ¨ç½‘ç»œä¸Šä¼ è¾“\n\n```\nä¸‹é›¨å¤©ç•™å®¢å¤©ç•™æˆ‘ä¸ç•™\n```\n\næ˜¯ä¸­æ–‡ä¸€å¥è‘—åçš„æ— æ ‡ç‚¹ç¬¦å·å¥å­ï¼Œåœ¨æ²¡æœ‰æ ‡ç‚¹ç¬¦å·æƒ…å†µä¸‹ï¼Œè¿™å¥è¯æœ‰æ•°ç§æ‹†è§£æ–¹å¼ï¼Œè€Œæ„æ€å´æ˜¯å®Œå…¨ä¸åŒï¼Œæ‰€ä»¥å¸¸è¢«ç”¨ä½œè®²è¿°æ ‡ç‚¹ç¬¦å·çš„é‡è¦æ€§\n\nä¸€ç§è§£è¯»\n\n```\nä¸‹é›¨å¤©ç•™å®¢ï¼Œå¤©ç•™ï¼Œæˆ‘ä¸ç•™\n```\n\nå¦ä¸€ç§è§£è¯»\n\n```\nä¸‹é›¨å¤©ï¼Œç•™å®¢å¤©ï¼Œç•™æˆ‘ä¸ï¼Ÿç•™\n```\n\nå¦‚ä½•è®¾è®¡åè®®å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç»™ç½‘ç»œä¼ è¾“çš„ä¿¡æ¯åŠ ä¸Šâ€œæ ‡ç‚¹ç¬¦å·â€ã€‚ä½†é€šè¿‡åˆ†éš”ç¬¦æ¥æ–­å¥ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºåˆ†éš”ç¬¦æœ¬èº«å¦‚æœç”¨äºä¼ è¾“ï¼Œé‚£ä¹ˆå¿…é¡»åŠ ä»¥åŒºåˆ†ã€‚å› æ­¤ï¼Œä¸‹é¢ä¸€ç§åè®®è¾ƒä¸ºå¸¸ç”¨\n\n``` \nå®šé•¿å­—èŠ‚è¡¨ç¤ºå†…å®¹é•¿åº¦ + å®é™…å†…å®¹\n```\n\nä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªä¸­æ–‡å­—ç¬¦é•¿åº¦ä¸º 3ï¼ŒæŒ‰ç…§ä¸Šè¿°åè®®çš„è§„åˆ™ï¼Œå‘é€ä¿¡æ¯æ–¹å¼å¦‚ä¸‹ï¼Œå°±ä¸ä¼šè¢«æ¥æ”¶æ–¹å¼„é”™æ„æ€äº†\n\n```\n0fä¸‹é›¨å¤©ç•™å®¢06å¤©ç•™09æˆ‘ä¸ç•™\n```\n\n\u003e å°æ•…äº‹\n\u003e\n\u003e å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œä¸€ä½ç§å¡¾å…ˆç”Ÿåˆ°ä¸€å®¶ä»»æ•™ã€‚åŒæ–¹ç­¾è®¢äº†ä¸€çº¸åè®®ï¼šâ€œæ— é¸¡é¸­äº¦å¯æ— é±¼è‚‰äº¦å¯ç™½èœè±†è…ä¸å¯å°‘ä¸å¾—æŸä¿®é‡‘â€ã€‚æ­¤åï¼Œç§å¡¾å…ˆç”Ÿè™½ç„¶è®¤çœŸæ•™è¯¾ï¼Œä½†ä¸»äººå®¶åˆ™æ€»æ˜¯ç»™ç§å¡¾å…ˆç”Ÿä»¥ç™½èœè±†è…ä¸ºèœï¼Œä¸æ¯«æœªè§é¸¡é¸­é±¼è‚‰çš„æ¬¾å¾…ã€‚ç§å¡¾å…ˆç”Ÿå…ˆæ˜¯å¾ˆä¸è§£ï¼Œå¯æ˜¯åæ¥ä¹Ÿå°±æƒ³é€šäº†ï¼šä¸»äººæŠŠé¸¡é¸­é±¼è‚‰çš„é’±éƒ½ä¼šæ¢ä¸ºæŸä¿®é‡‘çš„ï¼Œä¹Ÿç½¢ã€‚è‡³æ­¤åŒæ–¹ç›¸å®‰æ— äº‹ã€‚\n\u003e\n\u003e å¹´å…³å°†è‡³ï¼Œä¸€ä¸ªå­¦å¹´æ®µäº¦å‘Šç»“æŸã€‚ç§å¡¾å…ˆç”Ÿä¸´è¡Œæ—¶ï¼Œä¹Ÿä¸è§ä¸»äººå®¶ä¸ºä»–äº¤ä»˜æŸä¿®é‡‘ï¼Œé‚ä¸ä¸»å®¶ç†è®ºã€‚ç„¶ä¸»å®¶äº¦æŒ¯æŒ¯æœ‰è¯ï¼šâ€œæœ‰åè®®ä¸ºè¯â€”â€”æ— é¸¡é¸­äº¦å¯ï¼Œæ— é±¼è‚‰äº¦å¯ï¼Œç™½èœè±†è…ä¸å¯å°‘ï¼Œä¸å¾—æŸä¿®é‡‘ã€‚è¿™ç™½çº¸é»‘å­—æ˜æ‘†ç€çš„ï¼Œä½ æœ‰ä»€ä¹ˆè¦è¯´çš„å‘¢ï¼Ÿâ€\n\u003e\n\u003e ç§å¡¾å…ˆç”Ÿæ®ç†åŠ›äº‰ï¼šâ€œåè®®æ˜¯è¿™æ ·çš„â€”â€”æ— é¸¡ï¼Œé¸­äº¦å¯ï¼›æ— é±¼ï¼Œè‚‰äº¦å¯ï¼›ç™½èœè±†è…ä¸å¯ï¼Œå°‘ä¸å¾—æŸä¿®é‡‘ã€‚â€\n\u003e\n\u003e åŒæ–¹å”‡æªèˆŒæˆ˜ï¼Œä½ æ¥æˆ‘å¾€ï¼ŒçœŸä¸ªæ˜¯ä¸äº¦ä¹ä¹ï¼\n\u003e\n\u003e è¿™é‡Œçš„æŸä¿®é‡‘ï¼Œä¹Ÿä½œâ€œæŸè„©â€ï¼Œåº”å½“æ˜¯æ³›æŒ‡æ•™å¸ˆåº”å½“å¾—åˆ°çš„æŠ¥é…¬\n\n### 2.2 redis åè®®ä¸¾ä¾‹\n\n```java\nNioEventLoopGroup worker = new NioEventLoopGroup();\nbyte[] LINE = {13, 10};\ntry {\n    Bootstrap bootstrap = new Bootstrap();\n    bootstrap.channel(NioSocketChannel.class);\n    bootstrap.group(worker);\n    bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n        @Override\n        protected void initChannel(SocketChannel ch) {\n            ch.pipeline().addLast(new LoggingHandler());\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                // ä¼šåœ¨è¿æ¥ channel å»ºç«‹æˆåŠŸåï¼Œä¼šè§¦å‘ active äº‹ä»¶\n                @Override\n                public void channelActive(ChannelHandlerContext ctx) {\n                    set(ctx);\n                    get(ctx);\n                }\n                private void get(ChannelHandlerContext ctx) {\n                    ByteBuf buf = ctx.alloc().buffer();\n                    buf.writeBytes(\"*2\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"$3\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"get\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"$3\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"aaa\".getBytes());\n                    buf.writeBytes(LINE);\n                    ctx.writeAndFlush(buf);\n                }\n                private void set(ChannelHandlerContext ctx) {\n                    ByteBuf buf = ctx.alloc().buffer();\n                    buf.writeBytes(\"*3\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"$3\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"set\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"$3\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"aaa\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"$3\".getBytes());\n                    buf.writeBytes(LINE);\n                    buf.writeBytes(\"bbb\".getBytes());\n                    buf.writeBytes(LINE);\n                    ctx.writeAndFlush(buf);\n                }\n\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {\n                    ByteBuf buf = (ByteBuf) msg;\n                    System.out.println(buf.toString(Charset.defaultCharset()));\n                }\n            });\n        }\n    });\n    ChannelFuture channelFuture = bootstrap.connect(\"localhost\", 6379).sync();\n    channelFuture.channel().closeFuture().sync();\n} catch (InterruptedException e) {\n    log.error(\"client error\", e);\n} finally {\n    worker.shutdownGracefully();\n}\n```\n\n### 2.3 http åè®®ä¸¾ä¾‹\n\n```java\nNioEventLoopGroup boss = new NioEventLoopGroup();\nNioEventLoopGroup worker = new NioEventLoopGroup();\ntry {\n    ServerBootstrap serverBootstrap = new ServerBootstrap();\n    serverBootstrap.channel(NioServerSocketChannel.class);\n    serverBootstrap.group(boss, worker);\n    serverBootstrap.childHandler(new ChannelInitializer\u003cSocketChannel\u003e() {\n        @Override\n        protected void initChannel(SocketChannel ch) throws Exception {\n            ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n            ch.pipeline().addLast(new HttpServerCodec());\n            ch.pipeline().addLast(new SimpleChannelInboundHandler\u003cHttpRequest\u003e() {\n                @Override\n                protected void channelRead0(ChannelHandlerContext ctx, HttpRequest msg) throws Exception {\n                    // è·å–è¯·æ±‚\n                    log.debug(msg.uri());\n\n                    // è¿”å›å“åº”\n                    DefaultFullHttpResponse response =\n                            new DefaultFullHttpResponse(msg.protocolVersion(), HttpResponseStatus.OK);\n\n                    byte[] bytes = \"\u003ch1\u003eHello, world!\u003c/h1\u003e\".getBytes();\n\n                    response.headers().setInt(CONTENT_LENGTH, bytes.length);\n                    response.content().writeBytes(bytes);\n\n                    // å†™å›å“åº”\n                    ctx.writeAndFlush(response);\n                }\n            });\n            /*ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {\n                    log.debug(\"{}\", msg.getClass());\n\n                    if (msg instanceof HttpRequest) { // è¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´\n\n                    } else if (msg instanceof HttpContent) { //è¯·æ±‚ä½“\n\n                    }\n                }\n            });*/\n        }\n    });\n    ChannelFuture channelFuture = serverBootstrap.bind(8080).sync();\n    channelFuture.channel().closeFuture().sync();\n} catch (InterruptedException e) {\n    log.error(\"server error\", e);\n} finally {\n    boss.shutdownGracefully();\n    worker.shutdownGracefully();\n}\n```\n\n### 2.4 è‡ªå®šä¹‰åè®®è¦ç´ \n\n* é­”æ•°ï¼Œç”¨æ¥åœ¨ç¬¬ä¸€æ—¶é—´åˆ¤å®šæ˜¯å¦æ˜¯æ— æ•ˆæ•°æ®åŒ…\n* ç‰ˆæœ¬å·ï¼Œå¯ä»¥æ”¯æŒåè®®çš„å‡çº§\n* åºåˆ—åŒ–ç®—æ³•ï¼Œæ¶ˆæ¯æ­£æ–‡åˆ°åº•é‡‡ç”¨å“ªç§åºåˆ—åŒ–ååºåˆ—åŒ–æ–¹å¼ï¼Œå¯ä»¥ç”±æ­¤æ‰©å±•ï¼Œä¾‹å¦‚ï¼šjsonã€protobufã€hessianã€jdkï¼ˆæ€§èƒ½å·®ã€éè·¨å¹³å°ï¼‰\n* æŒ‡ä»¤ç±»å‹ï¼Œæ˜¯ç™»å½•ã€æ³¨å†Œã€å•èŠã€ç¾¤èŠ... è·Ÿä¸šåŠ¡ç›¸å…³\n* è¯·æ±‚åºå·ï¼Œä¸ºäº†åŒå·¥é€šä¿¡ï¼Œ \n* æ­£æ–‡é•¿åº¦\n* æ¶ˆæ¯æ­£æ–‡\n\n#### ç¼–è§£ç å™¨\n\næ ¹æ®ä¸Šé¢çš„è¦ç´ ï¼Œè®¾è®¡ä¸€ä¸ªç™»å½•è¯·æ±‚æ¶ˆæ¯å’Œç™»å½•å“åº”æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ Netty å®Œæˆæ”¶å‘\n\n```java\n@Slf4j\npublic class MessageCodec extends ByteToMessageCodec\u003cMessage\u003e {\n\n    @Override\n    protected void encode(ChannelHandlerContext ctx, Message msg, ByteBuf out) throws Exception {\n        // 1. 4 å­—èŠ‚çš„é­”æ•°\n        out.writeBytes(new byte[]{1, 2, 3, 4});\n        // 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,\n        out.writeByte(1);\n        // 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1\n        out.writeByte(0);\n        // 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹\n        out.writeByte(msg.getMessageType());\n        // 5. 4 ä¸ªå­—èŠ‚\n        out.writeInt(msg.getSequenceId());\n        // æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……\n        out.writeByte(0xff);\n        // 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„\n        ByteArrayOutputStream bos = new ByteArrayOutputStream();\n        ObjectOutputStream oos = new ObjectOutputStream(bos);\n        oos.writeObject(msg);\n        byte[] bytes = bos.toByteArray();\n        // 7. é•¿åº¦\n        out.writeInt(bytes.length);\n        // 8. å†™å…¥å†…å®¹\n        out.writeBytes(bytes);\n    }\n\n    @Override\n    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List\u003cObject\u003e out) throws Exception {\n        int magicNum = in.readInt();\n        byte version = in.readByte();\n        byte serializerType = in.readByte();\n        byte messageType = in.readByte();\n        int sequenceId = in.readInt();\n        in.readByte();\n        int length = in.readInt();\n        byte[] bytes = new byte[length];\n        in.readBytes(bytes, 0, length);\n        ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(bytes));\n        Message message = (Message) ois.readObject();\n        log.debug(\"{}, {}, {}, {}, {}, {}\", magicNum, version, serializerType, messageType, sequenceId, length);\n        log.debug(\"{}\", message);\n        out.add(message);\n    }\n}\n```\n\næµ‹è¯•\n\n```java\nEmbeddedChannel channel = new EmbeddedChannel(\n    new LoggingHandler(),\n    new LengthFieldBasedFrameDecoder(\n        1024, 12, 4, 0, 0),\n    new MessageCodec()\n);\n// encode\nLoginRequestMessage message = new LoginRequestMessage(\"zhangsan\", \"123\", \"å¼ ä¸‰\");\n//        channel.writeOutbound(message);\n// decode\nByteBuf buf = ByteBufAllocator.DEFAULT.buffer();\nnew MessageCodec().encode(null, message, buf);\n\nByteBuf s1 = buf.slice(0, 100);\nByteBuf s2 = buf.slice(100, buf.readableBytes() - 100);\ns1.retain(); // å¼•ç”¨è®¡æ•° 2\nchannel.writeInbound(s1); // release 1\nchannel.writeInbound(s2);\n```\n\nè§£è¯»\n\n![[z-oblib/z2-attachments/0013.png]]\n\n##### æ³¨æ„åŠåŒ…\n\nè™½ç„¶åè®®æŒ‡å®šäº†æ•°æ®é•¿åº¦ï¼Œå¯ä»¥è§£å†³ç²˜åŒ…é—®é¢˜ï¼Œä½†æ˜¯åŠåŒ…é—®é¢˜è¿˜è¦æ³¨æ„ï¼š\nå¦‚æœåŠåŒ…äº†ï¼Œé‚£ä¹ˆhandlerå°±ä¸åº”è¯¥ç»§ç»­å¾€ä¸‹å¤„ç†ï¼Œå› ä¸ºæ­¤æ—¶ååºåˆ—åŒ–ä¼šå¤±è´¥ï¼ˆå®é™…é•¿åº¦å°äºæŒ‡å®šé•¿åº¦ï¼Œè¶Šç•Œè¯»ï¼‰ã€‚\néœ€è¦å…ˆç”¨å¸§è§£ç å™¨åŒ…è£…åŒ…çš„å®Œæ•´æ€§ã€‚ \n\n#### ğŸ’¡ ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ  @Sharable\n\n* å½“ handler **ä¸ä¿å­˜çŠ¶æ€**ï¼ˆæˆå‘˜å˜é‡ï¼‰æ—¶ï¼Œå°±å¯ä»¥å®‰å…¨åœ°åœ¨å¤šçº¿ç¨‹ä¸‹è¢«å…±äº«ï¼ˆä¾‹å¦‚LoggingHandlerå¯ä»¥å…±äº«ï¼ŒLengthFieldBasedFrameDecoderä¸èƒ½å…±äº«ï¼‰ã€‚\n* ä½†è¦æ³¨æ„å¯¹äºç¼–è§£ç å™¨ç±»ï¼Œä¸èƒ½ç»§æ‰¿ ByteToMessageCodec æˆ– CombinedChannelDuplexHandler çˆ¶ç±»ï¼Œä»–ä»¬çš„æ„é€ æ–¹æ³•å¯¹ @Sharable æœ‰é™åˆ¶\n\t* nettyè®¤ä¸ºä½ å¦‚æœç»§æ‰¿äº†è¿™ä¸¤ä¸ªçˆ¶ç±»ï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥æ˜¯ä¼šä¿å­˜çŠ¶æ€çš„ï¼ˆä¸ç®¡ä½ å®é™…ä¸Šæ˜¯å¦è¿™ä¹ˆåšäº†ï¼‰\n* å¦‚æœèƒ½ç¡®ä¿ç¼–è§£ç å™¨**ä¸ä¼š**ä¿å­˜çŠ¶æ€ï¼Œå¯ä»¥ç»§æ‰¿ MessageToMessageCodec çˆ¶ç±»\n\n\u003e Byteä»£è¡¨rawçš„æ•°æ®ï¼Œå¯èƒ½ä¸å®Œæ•´ï¼ŒMessageä»£è¡¨æ˜¯ä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯äº†ã€‚\n\n```java\n@Slf4j\n@ChannelHandler.Sharable\n/**\n * å¿…é¡»å’Œ LengthFieldBasedFrameDecoder ä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿æ¥åˆ°çš„ ByteBuf æ¶ˆæ¯æ˜¯å®Œæ•´çš„\n */\npublic class MessageCodecSharable extends MessageToMessageCodec\u003cByteBuf, Message\u003e {\n    @Override\n    protected void encode(ChannelHandlerContext ctx, Message msg, List\u003cObject\u003e outList) throws Exception {\n        ByteBuf out = ctx.alloc().buffer();\n        // 1. 4 å­—èŠ‚çš„é­”æ•°\n        out.writeBytes(new byte[]{1, 2, 3, 4});\n        // 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,\n        out.writeByte(1);\n        // 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1\n        out.writeByte(0);\n        // 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹\n        out.writeByte(msg.getMessageType());\n        // 5. 4 ä¸ªå­—èŠ‚\n        out.writeInt(msg.getSequenceId());\n        // æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……\n        out.writeByte(0xff);\n        // 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„\n        ByteArrayOutputStream bos = new ByteArrayOutputStream();\n        ObjectOutputStream oos = new ObjectOutputStream(bos);\n        oos.writeObject(msg);\n        byte[] bytes = bos.toByteArray();\n        // 7. é•¿åº¦\n        out.writeInt(bytes.length);\n        // 8. å†™å…¥å†…å®¹\n        out.writeBytes(bytes);\n        outList.add(out);\n    }\n\n    @Override\n    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List\u003cObject\u003e out) throws Exception {\n        int magicNum = in.readInt();\n        byte version = in.readByte();\n        byte serializerType = in.readByte();\n        byte messageType = in.readByte();\n        int sequenceId = in.readInt();\n        in.readByte();\n        int length = in.readInt();\n        byte[] bytes = new byte[length];\n        in.readBytes(bytes, 0, length);\n        ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(bytes));\n        Message message = (Message) ois.readObject();\n        log.debug(\"{}, {}, {}, {}, {}, {}\", magicNum, version, serializerType, messageType, sequenceId, length);\n        log.debug(\"{}\", message);\n        out.add(message);\n    }\n}\n```\n\n## 3. èŠå¤©å®¤æ¡ˆä¾‹\n\n### 3.1 èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»\n\n```java\n/**\n * ç”¨æˆ·ç®¡ç†æ¥å£\n */\npublic interface UserService {\n\n    /**\n     * ç™»å½•\n     * @param username ç”¨æˆ·å\n     * @param password å¯†ç \n     * @return ç™»å½•æˆåŠŸè¿”å› true, å¦åˆ™è¿”å› false\n     */\n    boolean login(String username, String password);\n}\n```\n\n```java\n/**\n * ä¼šè¯ç®¡ç†æ¥å£\n */\npublic interface Session {\n\n    /**\n     * ç»‘å®šä¼šè¯\n     * @param channel å“ªä¸ª channel è¦ç»‘å®šä¼šè¯\n     * @param username ä¼šè¯ç»‘å®šç”¨æˆ·\n     */\n    void bind(Channel channel, String username);\n\n    /**\n     * è§£ç»‘ä¼šè¯\n     * @param channel å“ªä¸ª channel è¦è§£ç»‘ä¼šè¯\n     */\n    void unbind(Channel channel);\n\n    /**\n     * è·å–å±æ€§\n     * @param channel å“ªä¸ª channel\n     * @param name å±æ€§å\n     * @return å±æ€§å€¼\n     */\n    Object getAttribute(Channel channel, String name);\n\n    /**\n     * è®¾ç½®å±æ€§\n     * @param channel å“ªä¸ª channel\n     * @param name å±æ€§å\n     * @param value å±æ€§å€¼\n     */\n    void setAttribute(Channel channel, String name, Object value);\n\n    /**\n     * æ ¹æ®ç”¨æˆ·åè·å– channel\n     * @param username ç”¨æˆ·å\n     * @return channel\n     */\n    Channel getChannel(String username);\n}\n```\n\n```java\n/**\n * èŠå¤©ç»„ä¼šè¯ç®¡ç†æ¥å£\n */\npublic interface GroupSession {\n\n    /**\n     * åˆ›å»ºä¸€ä¸ªèŠå¤©ç»„, å¦‚æœä¸å­˜åœ¨æ‰èƒ½åˆ›å»ºæˆåŠŸ, å¦åˆ™è¿”å› null\n     * @param name ç»„å\n     * @param members æˆå‘˜\n     * @return æˆåŠŸæ—¶è¿”å›ç»„å¯¹è±¡, å¤±è´¥è¿”å› null\n     */\n    Group createGroup(String name, Set\u003cString\u003e members);\n\n    /**\n     * åŠ å…¥èŠå¤©ç»„\n     * @param name ç»„å\n     * @param member æˆå‘˜å\n     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡\n     */\n    Group joinMember(String name, String member);\n\n    /**\n     * ç§»é™¤ç»„æˆå‘˜\n     * @param name ç»„å\n     * @param member æˆå‘˜å\n     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡\n     */\n    Group removeMember(String name, String member);\n\n    /**\n     * ç§»é™¤èŠå¤©ç»„\n     * @param name ç»„å\n     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡\n     */\n    Group removeGroup(String name);\n\n    /**\n     * è·å–ç»„æˆå‘˜\n     * @param name ç»„å\n     * @return æˆå‘˜é›†åˆ, æ²¡æœ‰æˆå‘˜ä¼šè¿”å› empty set\n     */\n    Set\u003cString\u003e getMembers(String name);\n\n    /**\n     * è·å–ç»„æˆå‘˜çš„ channel é›†åˆ, åªæœ‰åœ¨çº¿çš„ channel æ‰ä¼šè¿”å›\n     * @param name ç»„å\n     * @return æˆå‘˜ channel é›†åˆ\n     */\n    List\u003cChannel\u003e getMembersChannel(String name);\n}\n```\n\n### 3.2 èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•\n\n```java\n@Slf4j\npublic class ChatServer {\n    public static void main(String[] args) {\n        NioEventLoopGroup boss = new NioEventLoopGroup();\n        NioEventLoopGroup worker = new NioEventLoopGroup();\n        LoggingHandler LOGGING_HANDLER = new LoggingHandler(LogLevel.DEBUG);\n        MessageCodecSharable MESSAGE_CODEC = new MessageCodecSharable();\n        try {\n            ServerBootstrap serverBootstrap = new ServerBootstrap();\n            serverBootstrap.channel(NioServerSocketChannel.class);\n            serverBootstrap.group(boss, worker);\n            serverBootstrap.childHandler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    ch.pipeline().addLast(new ProcotolFrameDecoder());\n                    ch.pipeline().addLast(LOGGING_HANDLER);\n                    ch.pipeline().addLast(MESSAGE_CODEC);\n                    ch.pipeline().addLast(new SimpleChannelInboundHandler\u003cLoginRequestMessage\u003e() {\n                        @Override\n                        protected void channelRead0(ChannelHandlerContext ctx, LoginRequestMessage msg) throws Exception {\n                            String username = msg.getUsername();\n                            String password = msg.getPassword();\n                            boolean login = UserServiceFactory.getUserService().login(username, password);\n                            LoginResponseMessage message;\n                            if(login) {\n                                message = new LoginResponseMessage(true, \"ç™»å½•æˆåŠŸ\");\n                            } else {\n                                message = new LoginResponseMessage(false, \"ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®\");\n                            }\n                            ctx.writeAndFlush(message);\n                        }\n                    });\n                }\n            });\n            Channel channel = serverBootstrap.bind(8080).sync().channel();\n            channel.closeFuture().sync();\n        } catch (InterruptedException e) {\n            log.error(\"server error\", e);\n        } finally {\n            boss.shutdownGracefully();\n            worker.shutdownGracefully();\n        }\n    }\n}\n```\n\n```java\n@Slf4j\npublic class ChatClient {\n    public static void main(String[] args) {\n        NioEventLoopGroup group = new NioEventLoopGroup();\n        LoggingHandler LOGGING_HANDLER = new LoggingHandler(LogLevel.DEBUG);\n        MessageCodecSharable MESSAGE_CODEC = new MessageCodecSharable();\n        CountDownLatch WAIT_FOR_LOGIN = new CountDownLatch(1);\n        AtomicBoolean LOGIN = new AtomicBoolean(false);\n        try {\n            Bootstrap bootstrap = new Bootstrap();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(group);\n            bootstrap.handler(new ChannelInitializer\u003cSocketChannel\u003e() {\n                @Override\n                protected void initChannel(SocketChannel ch) throws Exception {\n                    ch.pipeline().addLast(new ProcotolFrameDecoder());\n//                    ch.pipeline().addLast(LOGGING_HANDLER);\n                    ch.pipeline().addLast(MESSAGE_CODEC);\n                    ch.pipeline().addLast(\"client handler\", new ChannelInboundHandlerAdapter() {\n                        // æ¥æ”¶å“åº”æ¶ˆæ¯\n                        @Override\n                        public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {\n                            log.debug(\"msg: {}\", msg);\n                            if ((msg instanceof LoginResponseMessage)) {\n                                LoginResponseMessage response = (LoginResponseMessage) msg;\n                                if (response.isSuccess()) {\n                                    // å¦‚æœç™»å½•æˆåŠŸ\n                                    LOGIN.set(true);\n                                }\n                                // å”¤é†’ system in çº¿ç¨‹\n                                WAIT_FOR_LOGIN.countDown();\n                            }\n                        }\n\n                        // åœ¨è¿æ¥å»ºç«‹åè§¦å‘ active äº‹ä»¶\n                        @Override\n                        public void channelActive(ChannelHandlerContext ctx) throws Exception {\n                            // è´Ÿè´£æ¥æ”¶ç”¨æˆ·åœ¨æ§åˆ¶å°çš„è¾“å…¥ï¼Œè´Ÿè´£å‘æœåŠ¡å™¨å‘é€å„ç§æ¶ˆæ¯\n                            new Thread(() -\u003e {\n                                Scanner scanner = new Scanner(System.in);\n                                System.out.println(\"è¯·è¾“å…¥ç”¨æˆ·å:\");\n                                String username = scanner.nextLine();\n                                System.out.println(\"è¯·è¾“å…¥å¯†ç :\");\n                                String password = scanner.nextLine();\n                                // æ„é€ æ¶ˆæ¯å¯¹è±¡\n                                LoginRequestMessage message = new LoginRequestMessage(username, password);\n                                // å‘é€æ¶ˆæ¯\n                                ctx.writeAndFlush(message);\n                                System.out.println(\"ç­‰å¾…åç»­æ“ä½œ...\");\n                                try {\n                                    WAIT_FOR_LOGIN.await();\n                                } catch (InterruptedException e) {\n                                    e.printStackTrace();\n                                }\n                                // å¦‚æœç™»å½•å¤±è´¥\n                                if (!LOGIN.get()) {\n                                    ctx.channel().close();\n                                    return;\n                                }\n                                while (true) {\n                                    System.out.println(\"==================================\");\n                                    System.out.println(\"send [username] [content]\");\n                                    System.out.println(\"gsend [group name] [content]\");\n                                    System.out.println(\"gcreate [group name] [m1,m2,m3...]\");\n                                    System.out.println(\"gmembers [group name]\");\n                                    System.out.println(\"gjoin [group name]\");\n                                    System.out.println(\"gquit [group name]\");\n                                    System.out.println(\"quit\");\n                                    System.out.println(\"==================================\");\n                                    String command = scanner.nextLine();\n                                    String[] s = command.split(\" \");\n                                    switch (s[0]){\n                                        case \"send\":\n                                            ctx.writeAndFlush(new ChatRequestMessage(username, s[1], s[2]));\n                                            break;\n                                        case \"gsend\":\n                                            ctx.writeAndFlush(new GroupChatRequestMessage(username, s[1], s[2]));\n                                            break;\n                                        case \"gcreate\":\n                                            Set\u003cString\u003e set = new HashSet\u003c\u003e(Arrays.asList(s[2].split(\",\")));\n                                            set.add(username); // åŠ å…¥è‡ªå·±\n                                            ctx.writeAndFlush(new GroupCreateRequestMessage(s[1], set));\n                                            break;\n                                        case \"gmembers\":\n                                            ctx.writeAndFlush(new GroupMembersRequestMessage(s[1]));\n                                            break;\n                                        case \"gjoin\":\n                                            ctx.writeAndFlush(new GroupJoinRequestMessage(username, s[1]));\n                                            break;\n                                        case \"gquit\":\n                                            ctx.writeAndFlush(new GroupQuitRequestMessage(username, s[1]));\n                                            break;\n                                        case \"quit\":\n                                            ctx.channel().close();\n                                            return;\n                                    }\n                                }\n                            }, \"system in\").start();\n                        }\n                    });\n                }\n            });\n            Channel channel = bootstrap.connect(\"localhost\", 8080).sync().channel();\n            channel.closeFuture().sync();\n        } catch (Exception e) {\n            log.error(\"client error\", e);\n        } finally {\n            group.shutdownGracefully();\n        }\n    }\n}\n```\n\n### 3.3 èŠå¤©å®¤ä¸šåŠ¡-å•èŠ\n\næœåŠ¡å™¨ç«¯å°† handler ç‹¬ç«‹å‡ºæ¥\n\nç™»å½• handler\n\n```java\n@ChannelHandler.Sharable\npublic class LoginRequestMessageHandler extends SimpleChannelInboundHandler\u003cLoginRequestMessage\u003e {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, LoginRequestMessage msg) throws Exception {\n        String username = msg.getUsername();\n        String password = msg.getPassword();\n        boolean login = UserServiceFactory.getUserService().login(username, password);\n        LoginResponseMessage message;\n        if(login) {\n            SessionFactory.getSession().bind(ctx.channel(), username);\n            message = new LoginResponseMessage(true, \"ç™»å½•æˆåŠŸ\");\n        } else {\n            message = new LoginResponseMessage(false, \"ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®\");\n        }\n        ctx.writeAndFlush(message);\n    }\n}\n```\n\nå•èŠ handler\n\n```java\n@ChannelHandler.Sharable\npublic class ChatRequestMessageHandler extends SimpleChannelInboundHandler\u003cChatRequestMessage\u003e {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, ChatRequestMessage msg) throws Exception {\n        String to = msg.getTo();\n        Channel channel = SessionFactory.getSession().getChannel(to);\n        // åœ¨çº¿\n        if(channel != null) {\n            channel.writeAndFlush(new ChatResponseMessage(msg.getFrom(), msg.getContent()));\n        }\n        // ä¸åœ¨çº¿\n        else {\n            ctx.writeAndFlush(new ChatResponseMessage(false, \"å¯¹æ–¹ç”¨æˆ·ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨çº¿\"));\n        }\n    }\n}\n```\n\n### 3.4 èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ\n\nåˆ›å»ºç¾¤èŠ\n\n```java\n@ChannelHandler.Sharable\npublic class GroupCreateRequestMessageHandler extends SimpleChannelInboundHandler\u003cGroupCreateRequestMessage\u003e {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, GroupCreateRequestMessage msg) throws Exception {\n        String groupName = msg.getGroupName();\n        Set\u003cString\u003e members = msg.getMembers();\n        // ç¾¤ç®¡ç†å™¨\n        GroupSession groupSession = GroupSessionFactory.getGroupSession();\n        Group group = groupSession.createGroup(groupName, members);\n        if (group == null) {\n            // å‘ç”ŸæˆåŠŸæ¶ˆæ¯\n            ctx.writeAndFlush(new GroupCreateResponseMessage(true, groupName + \"åˆ›å»ºæˆåŠŸ\"));\n            // å‘é€æ‹‰ç¾¤æ¶ˆæ¯\n            List\u003cChannel\u003e channels = groupSession.getMembersChannel(groupName);\n            for (Channel channel : channels) {\n                channel.writeAndFlush(new GroupCreateResponseMessage(true, \"æ‚¨å·²è¢«æ‹‰å…¥\" + groupName));\n            }\n        } else {\n            ctx.writeAndFlush(new GroupCreateResponseMessage(false, groupName + \"å·²ç»å­˜åœ¨\"));\n        }\n    }\n}\n```\n\nç¾¤èŠ\n\n```java\n@ChannelHandler.Sharable\npublic class GroupChatRequestMessageHandler extends SimpleChannelInboundHandler\u003cGroupChatRequestMessage\u003e {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, GroupChatRequestMessage msg) throws Exception {\n        List\u003cChannel\u003e channels = GroupSessionFactory.getGroupSession()\n                .getMembersChannel(msg.getGroupName());\n\n        for (Channel channel : channels) {\n            channel.writeAndFlush(new GroupChatResponseMessage(msg.getFrom(), msg.getContent()));\n        }\n    }\n}\n```\n\nåŠ å…¥ç¾¤èŠ\n\n```java\n@ChannelHandler.Sharable\npublic class GroupJoinRequestMessageHandler extends SimpleChannelInboundHandler\u003cGroupJoinRequestMessage\u003e {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, GroupJoinRequestMessage msg) throws Exception {\n        Group group = GroupSessionFactory.getGroupSession().joinMember(msg.getGroupName(), msg.getUsername());\n        if (group != null) {\n            ctx.writeAndFlush(new GroupJoinResponseMessage(true, msg.getGroupName() + \"ç¾¤åŠ å…¥æˆåŠŸ\"));\n        } else {\n            ctx.writeAndFlush(new GroupJoinResponseMessage(true, msg.getGroupName() + \"ç¾¤ä¸å­˜åœ¨\"));\n        }\n    }\n}\n```\n\né€€å‡ºç¾¤èŠ\n\n```java\n@ChannelHandler.Sharable\npublic class GroupQuitRequestMessageHandler extends SimpleChannelInboundHandler\u003cGroupQuitRequestMessage\u003e {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, GroupQuitRequestMessage msg) throws Exception {\n        Group group = GroupSessionFactory.getGroupSession().removeMember(msg.getGroupName(), msg.getUsername());\n        if (group != null) {\n            ctx.writeAndFlush(new GroupJoinResponseMessage(true, \"å·²é€€å‡ºç¾¤\" + msg.getGroupName()));\n        } else {\n            ctx.writeAndFlush(new GroupJoinResponseMessage(true, msg.getGroupName() + \"ç¾¤ä¸å­˜åœ¨\"));\n        }\n    }\n}\n```\n\næŸ¥çœ‹æˆå‘˜\n\n```java\n@ChannelHandler.Sharable\npublic class GroupMembersRequestMessageHandler extends SimpleChannelInboundHandler\u003cGroupMembersRequestMessage\u003e {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, GroupMembersRequestMessage msg) throws Exception {\n        Set\u003cString\u003e members = GroupSessionFactory.getGroupSession()\n                .getMembers(msg.getGroupName());\n        ctx.writeAndFlush(new GroupMembersResponseMessage(members));\n    }\n}\n```\n\n### 3.5 èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º\n\n```\n@Slf4j\n@ChannelHandler.Sharable\npublic class QuitHandler extends ChannelInboundHandlerAdapter {\n\n    // å½“è¿æ¥æ–­å¼€æ—¶è§¦å‘ inactive äº‹ä»¶\n    @Override\n    public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n        SessionFactory.getSession().unbind(ctx.channel());\n        log.debug(\"{} å·²ç»æ–­å¼€\", ctx.channel());\n    }\n\n\t// å½“å‡ºç°å¼‚å¸¸æ—¶è§¦å‘\n    @Override\n    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception {\n        SessionFactory.getSession().unbind(ctx.channel());\n        log.debug(\"{} å·²ç»å¼‚å¸¸æ–­å¼€ å¼‚å¸¸æ˜¯{}\", ctx.channel(), cause.getMessage());\n    }\n}\n```\n\n### 3.6 èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹\n\n#### è¿æ¥å‡æ­»\n\n##### åŸå› \n\n* ç½‘ç»œè®¾å¤‡å‡ºç°æ•…éšœï¼Œä¾‹å¦‚ç½‘å¡ï¼Œæœºæˆ¿ç­‰ï¼Œåº•å±‚çš„ TCP è¿æ¥å·²ç»æ–­å¼€äº†ï¼Œä½†åº”ç”¨**ç¨‹åºæ²¡æœ‰æ„ŸçŸ¥**åˆ°ï¼Œä»ç„¶å ç”¨ç€èµ„æºã€‚\n* å…¬ç½‘ç½‘ç»œä¸ç¨³å®šï¼Œå‡ºç°ä¸¢åŒ…ã€‚å¦‚æœè¿ç»­å‡ºç°ä¸¢åŒ…ï¼Œè¿™æ—¶ç°è±¡å°±æ˜¯å®¢æˆ·ç«¯æ•°æ®å‘ä¸å‡ºå»ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¸€ç›´æ”¶ä¸åˆ°æ•°æ®ï¼Œå°±è¿™ä¹ˆä¸€ç›´è€—ç€\n* åº”ç”¨ç¨‹åºçº¿ç¨‹é˜»å¡ï¼Œæ— æ³•è¿›è¡Œæ•°æ®è¯»å†™\n\n##### é—®é¢˜\n\n* å‡æ­»çš„è¿æ¥å ç”¨çš„èµ„æºä¸èƒ½è‡ªåŠ¨é‡Šæ”¾\n* å‘å‡æ­»çš„è¿æ¥å‘é€æ•°æ®ï¼Œå¾—åˆ°çš„åé¦ˆæ˜¯å‘é€è¶…æ—¶\n\n##### æœåŠ¡å™¨ç«¯è§£å†³\n\n* æ€ä¹ˆåˆ¤æ–­å®¢æˆ·ç«¯è¿æ¥æ˜¯å¦å‡æ­»å‘¢ï¼Ÿå¦‚æœèƒ½æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼Œè¯´æ˜æ²¡æœ‰å‡æ­»ã€‚å› æ­¤ç­–ç•¥å°±å¯ä»¥å®šä¸ºï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±æ£€æŸ¥è¿™æ®µæ—¶é—´å†…æ˜¯å¦æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼Œæ²¡æœ‰å°±å¯ä»¥åˆ¤å®šä¸ºè¿æ¥å‡æ­»\n\n```java\n// ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿\n// 5s å†…å¦‚æœæ²¡æœ‰æ”¶åˆ° channel çš„æ•°æ®ï¼Œä¼šè§¦å‘ä¸€ä¸ª IdleState#READER_IDLE äº‹ä»¶\nch.pipeline().addLast(new IdleStateHandler(5, 0, 0));\n// ChannelDuplexHandler å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨\nch.pipeline().addLast(new ChannelDuplexHandler() {\n    // ç”¨æ¥è§¦å‘ç‰¹æ®Šäº‹ä»¶\n    @Override\n    public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception{\n        IdleStateEvent event = (IdleStateEvent) evt;\n        // è§¦å‘äº†è¯»ç©ºé—²äº‹ä»¶\n        if (event.state() == IdleState.READER_IDLE) {\n            log.debug(\"å·²ç» 5s æ²¡æœ‰è¯»åˆ°æ•°æ®äº†\");\n            ctx.channel().close();\n        }\n    }\n});\n```\n\n##### å®¢æˆ·ç«¯å®šæ—¶å¿ƒè·³\n\n* å®¢æˆ·ç«¯å¯ä»¥å®šæ—¶å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®ï¼Œåªè¦è¿™ä¸ªæ—¶é—´é—´éš”å°äºæœåŠ¡å™¨å®šä¹‰çš„ç©ºé—²æ£€æµ‹çš„æ—¶é—´é—´éš”ï¼Œé‚£ä¹ˆå°±èƒ½é˜²æ­¢å‰é¢æåˆ°çš„è¯¯åˆ¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥å®šä¹‰å¦‚ä¸‹å¿ƒè·³å¤„ç†å™¨\n\n```java\n// ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿\n// 3s å†…å¦‚æœæ²¡æœ‰å‘æœåŠ¡å™¨å†™æ•°æ®ï¼Œä¼šè§¦å‘ä¸€ä¸ª IdleState#WRITER_IDLE äº‹ä»¶\nch.pipeline().addLast(new IdleStateHandler(0, 3, 0));\n// ChannelDuplexHandler å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨\nch.pipeline().addLast(new ChannelDuplexHandler() {\n    // ç”¨æ¥è§¦å‘ç‰¹æ®Šäº‹ä»¶\n    @Override\n    public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception{\n        IdleStateEvent event = (IdleStateEvent) evt;\n        // è§¦å‘äº†å†™ç©ºé—²äº‹ä»¶\n        if (event.state() == IdleState.WRITER_IDLE) {\n            //                                log.debug(\"3s æ²¡æœ‰å†™æ•°æ®äº†ï¼Œå‘é€ä¸€ä¸ªå¿ƒè·³åŒ…\");\n            ctx.writeAndFlush(new PingMessage());\n        }\n    }\n});\n```\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/SSM/spring":{"title":"spring","content":"\n# spring\n\n## ä¾èµ–æ³¨å…¥\n\nxmlé…ç½®ä¸­å¸¸è§å½¢å¼ `\u003cxxx name=\"abc\", ref=\"abcBean\"\u003e`ï¼š\n1. setteræ³¨å…¥æ—¶æ„å‘³ç€ï¼šå°†å‰è¿°åˆ›å»ºçš„abcBeanèµ‹å€¼ç»™**æˆå‘˜**abcã€‚\n2. æ„é€ å™¨æ³¨å…¥æ—¶æ„å‘³ç€ï¼šå°†å‰è¿°åˆ›å»ºçš„abcBeanä¼ é€’ç»™**å½¢å‚**abcã€‚ \n\n\u003e refå¡«çš„æ˜¯å‰è¿°å®šä¹‰çš„beançš„idå€¼ã€‚\n\n\u003e æ„é€ å™¨ä¼ é€’ä¼šå—åˆ°æ„é€ å‡½æ•°å½¢å‚çš„é™åˆ¶ï¼Œé€ æˆé…ç½®æ–‡ä»¶ä¸ä»£ç çš„è€¦åˆï¼Œè™½ç„¶æä¾›äº†éƒ¨åˆ†å…¼å®¹æ€§çš„è§£å†³æ–¹æ¡ˆï¼šæŒ‡å®šå‚æ•°ç±»å‹ã€æŒ‡å®šå‚æ•°é¡ºåºï¼Œä½†è¿˜æ˜¯ä¸å¥½ç”¨ï¼Œè‡ªå·±å¼€å‘æ¨¡å—æ¨èç”¨setterã€‚\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Spring/AbstractDispatcherServletInitializer%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%B1%BB%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%88%9D%E5%A7%8B%E5%8C%96Web%E5%AE%B9%E5%99%A8%E7%9A%84%E6%97%B6%E5%80%99%E8%A2%AB%E8%B0%83%E7%94%A8":{"title":"AbstractDispatcherServletInitializerçš„å®ç°ç±»ä¸ºä»€ä¹ˆå¯ä»¥åœ¨åˆå§‹åŒ–Webå®¹å™¨çš„æ—¶å€™è¢«è°ƒç”¨","content":"\n# AbstractDispatcherServletInitializerçš„å®ç°ç±»ä¸ºä»€ä¹ˆå¯ä»¥åœ¨åˆå§‹åŒ–Webå®¹å™¨çš„æ—¶å€™è¢«è°ƒç”¨\n\n[(33æ¡æ¶ˆæ¯) AbstractDispatcherServletInitializer çš„å®ç°ç±»ä¸ºä»€ä¹ˆå¯ä»¥åœ¨åˆå§‹åŒ–Webå®¹å™¨çš„æ—¶å€™è¢«è°ƒç”¨_Nishkataçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/Nishkata/article/details/125432352)\n\n[Spring MVC ä¹‹ AbstractAnnotationConfigDispatcherServletInitializerå‰–æ_Spring MVC ä¹‹ AbstractAnnotationConfigDispatcherServletInitializerå‰–æ|Samuelä¸ªäººåšå®¢ (yangshuaibin.com)](https://www.yangshuaibin.com/detail/392696)\n\n## Servlet åšçš„äº‹\n\nServlet3.0 ç¯å¢ƒä¸­ï¼Œå®¹å™¨ä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å®ç° ServletContainerInitializer æ¥å£çš„ç±»ï¼Œå¦‚æœå‘ç°çš„è¯ï¼Œå°±ç”¨å®ƒæ¥é…ç½® Servlet å®¹å™¨ã€‚  \n\n## SpringMvc åšçš„äº‹\n\nSpring æä¾›äº†è¿™ä¸ªæ¥å£çš„å®ç°ç±»Â SpringServletContainerInitializer , é€šè¿‡ `@HandlesTypes(WebApplicationInitializer.class)` è®¾ç½®ï¼Œè¿™ä¸ªç±»åè¿‡æ¥ä¼šæŸ¥æ‰¾å®ç° WebApplicationInitializer çš„ç±»ï¼Œå¹¶å°†é…ç½®çš„ä»»åŠ¡äº¤ç»™ä»–ä»¬æ¥å®Œæˆã€‚  \nAbstractAnnotationConfigDispatcherServletInitializer ç±»æ‰©å±•äº† WebApplicationInitializer ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡å®ç° AbstractAnnotationConfigDispatcherServletInitializer æ¥è¿›è¡Œé…ç½® Servlet çš„ä¸Šä¸‹æ–‡äº†ã€‚\n\nDispatcherServletInitializer é…ç½®ç±»èƒ½å¤Ÿè¢«åŠ è½½çš„æ ¸å¿ƒæ˜¯ Java çš„ [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/SPI|SPI]] æœåŠ¡å‘ç°æœºåˆ¶ã€‚\n\n1. æœåŠ¡æ¥å£çš„å®šä¹‰ï¼šServlet è§„èŒƒå®šä¹‰äº†æœåŠ¡æ¥å£ `javax-servlet-api-xxx.jar/javax.servlet.ServletContainerInitializer`\n2. æ³¨å†ŒæœåŠ¡æ¥å£çš„å®ç°ï¼š Spring MVC æ³¨å†ŒæœåŠ¡ã€‚åœ¨ `spring-web-xxx.jar` åŒ…ä¸‹ æœ‰ `META-INF/services/javax.servlet.ServletContainerInitializer` æ–‡ä»¶ï¼Œå†…å®¹ä¸º `org.springframework.web.SpringServletContainerInitializer`\n3. æœåŠ¡åŠ è½½ï¼š SpringServletContainerInitializer ä¸­çš„ onStartup æ–¹æ³•ä¼šåœ¨ Servlet å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™é€šè¿‡ SPI æœºåˆ¶å‘ç°å¹¶è°ƒç”¨ï¼ŒonStartup æ–¹æ³•é‡Œé¢åˆä¼š å°†æ‰€æœ‰ WebApplicationInitializer çš„å®ç°ç±»çš„å¯¹è±¡çš„ onStartup æ–¹æ³•å…¨éƒ¨è°ƒç”¨ä¸€éã€‚\n4. AbstractDispatcherServletInitializer ä¹Ÿæ˜¯ WebApplicationInitializer æ¥å£çš„å®ç°ï¼Œæ‰€ä»¥å…¶ onStartup æ–¹æ³•ä¹Ÿä¼šåœ¨ Servlet å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™è¢«è°ƒç”¨ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220819234813.png]]\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Spring/spring%E6%8A%A5%E9%94%99%E5%88%86%E6%9E%90%E6%8A%80%E5%B7%A7":{"title":"springæŠ¥é”™åˆ†ææŠ€å·§","content":"# springæŠ¥é”™åˆ†ææŠ€å·§\n\n1. é”™è¯¯ä¿¡æ¯**ä»ä¸‹å¾€ä¸Šä¾æ¬¡æŸ¥çœ‹**ï¼Œå› ä¸ºä¸Šé¢çš„é”™è¯¯å¤§éƒ½æ˜¯å¯¹ä¸‹é¢é”™è¯¯çš„ä¸€ä¸ªåŒ…è£…ï¼Œæœ€æ ¸å¿ƒé”™è¯¯æ˜¯åœ¨æœ€ä¸‹é¢ã€‚ \n2. æœ‰æ—¶æœ€ä¸‹ä¸€å±‚æ˜¯springå†…éƒ¨çš„å¼‚å¸¸ï¼Œå¯ä»¥å¾€ä¸Šçœ‹ä¸€çº§ã€‚\n\næœ€ä¸‹é¢æ˜¯æ ¸å¿ƒåŸå› ï¼Œæœ€ä¸Šé¢æ˜¯æ•´æ¡é”™è¯¯é“¾çš„ä¸²æ˜¾ç¤ºã€‚","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Tomcat/Tomcat%E7%BA%BF%E7%A8%8B%E6%B1%A0":{"title":"Tomcatçº¿ç¨‹æ± ","content":"\n# Tomcatçº¿ç¨‹æ± \n\n\u003e åˆç†çš„åˆ†å·¥æ˜¯å®ç°é«˜[[3-è®¡ç®—æœºç§‘å­¦/2-è®¡ç®—æœºç»„æˆåŸç†/å¹¶å‘|å¹¶å‘]]çš„ä¿éšœã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220608183846.png]]\n\n\u003e åˆ†å·¥çš„åŸå› å°±æ˜¯ä¸ºäº†é˜²æ­¢[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/é¥¥é¥¿|é¥¥é¥¿]]ï¼ŒæŠŠ\n\n- LimitLatch ç”¨æ¥é™æµï¼Œå¯ä»¥æ§åˆ¶æœ€å¤§è¿æ¥ä¸ªæ•°ï¼Œç±»ä¼¼ J.U.C ä¸­çš„  Semaphore åé¢å†è®²\n- Acceptor åªè´Ÿè´£ã€æ¥æ”¶æ–°çš„ socket è¿æ¥ã€‘\n- Poller åªè´Ÿè´£ç›‘å¬ socket channel æ˜¯å¦æœ‰ã€å¯è¯»çš„ I/O äº‹ä»¶ã€‘\n- ä¸€æ—¦å¯è¯»ï¼Œå°è£…ä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼ˆsocketProcessorï¼‰ï¼Œæäº¤ç»™ Executor [[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/2-å¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± |çº¿ç¨‹æ± ]]å¤„ç†\n- Executor çº¿ç¨‹æ± ä¸­çš„[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/1-è½¯ä»¶æ–¹æ³•å­¦/è®¾è®¡æ¨¡å¼/å·¥ä½œçº¿ç¨‹|å·¥ä½œçº¿ç¨‹]]æœ€ç»ˆè´Ÿè´£ã€å¤„ç†è¯·æ±‚ã€‘ã€‚\n\n## ä¸JDKçº¿ç¨‹æ± å·®åˆ«\n\nTomcat çº¿ç¨‹æ± æ‰©å±•äº† ThreadPoolExecutorï¼Œè¡Œä¸ºç¨æœ‰ä¸åŒï¼š\n\n- å¦‚æœæ€»çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSize\n\t- è¿™æ—¶ä¸ä¼šç«‹åˆ»æŠ› RejectedExecutionException å¼‚å¸¸\n\t- è€Œæ˜¯å†æ¬¡å°è¯•å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œå¦‚æœè¿˜å¤±è´¥ï¼Œæ‰æŠ›å‡º RejectedExecutionException å¼‚å¸¸\n\n```java\npublic void execute(Runnable command, long timeout, TimeUnit unit) {\n    submittedCount.incrementAndGet();\n    try {\n\t    // å…ˆæ‰§è¡ŒåŸç”Ÿçš„execute\n        super.execute(command);\n    // ç¬¬ä¸€æ¬¡å¤±è´¥ä¸ç›´æ¥æŠ›å¼‚å¸¸\n    } catch (RejectedExecutionException rx) {\n\t    // æ‹¿åˆ°ä»»åŠ¡é˜Ÿåˆ—\n\t    // TaskQueueæ˜¯tomcatåšè¿‡æ‰©å±•çš„ä»»åŠ¡é˜Ÿåˆ—\n        if (super.getQueue() instanceof TaskQueue) {\n            final TaskQueue queue = (TaskQueue)super.getQueue();\n            try {\n                if (!queue.force(command, timeout, unit)) {\n                    submittedCount.decrementAndGet();\n                    throw new RejectedExecutionException(\"Queue capacity is full.\");\n                }\n            } catch (InterruptedException x) {\n                submittedCount.decrementAndGet();\n                Thread.interrupted();\n                throw new RejectedExecutionException(x);\n            }\n            } else {\n            submittedCount.decrementAndGet();\n            throw rx;\n        }\n \n    }\n}\n```\n\nConnector é…ç½®ï¼š\n\n```java\npublic boolean force(Runnable o, long timeout, TimeUnit unit) throws InterruptedException {\n    if ( parent.isShutdown() ) \n        throw new RejectedExecutionException(\n            \"Executor not running, can't force a command into the queue\"\n        );\n    // è¿˜æ˜¯è°ƒç”¨çš„offer\n    return super.offer(o,timeout,unit); //forces the item onto the queue, to be used if the task \nis rejected\n}\n```\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Tomcat/tomcat%E5%8E%9F%E7%90%86":{"title":"tomcatåŸç†","content":"# tomcatåŸç†\n\n![[z-oblib/z2-attachments/Pasted image 20220815211547.png]]\n\n## å³è¾¹ -- è¯·æ±‚å¤„ç†\n\n![[z-oblib/z2-attachments/Pasted image 20220815210239.png]]\n\nwrapperçš„ä½œç”¨æ˜¯ç»™å…·ä½“çš„servletå®ç°è¿›è¡Œåˆ†ç±»ï¼Œæ¯ä¸ªservletå®ç°å¯¹åº”ä¸€ä¸ªwrapperï¼Œå­˜å‚¨å¤šä¸ªè¿è¡Œæ—¶äº§ç”Ÿçš„å®ä¾‹ã€‚\n\n\u003eä½œç”¨çš„é˜²æ­¢æ··ä¹±ã€‚\n\nvalveæœ¬èº«æ˜¯ä¸€ä¸ªè´£ä»»é“¾çš„æ¨¡å¼ï¼Œä¾‹å¦‚å¯ä»¥è‡ªå®šä¹‰valveæ¥è®°å½•æ—¥å¿—ã€‚\nè¯·æ±‚åˆ°è¾¾å¯¹åº”å±‚æ¬¡çš„æ—¶å€™ï¼Œtomcatå°±ä¼šå°†è¯·æ±‚ä¼ é€’ç»™valveé“¾å¤„ç†ï¼Œæœ€ç»ˆä»StandardEngineValveå°†è¯·æ±‚è½¬äº¤ç»™ä¸‹ä¸€å±‚ã€‚\n\nWrapperä¸­æœ€åä¸€ä¸ªvalveï¼ˆStandardWrapperValveï¼‰ä¼šè°ƒç”¨å…·ä½“çš„ä¸šåŠ¡servletå®ä¾‹å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œç»Ÿä¸€è°ƒç”¨serviceæ–¹æ³•ï¼ˆservletçˆ¶ç±»æ–¹æ³•ï¼‰ï¼Œ serviceæ ¹æ®httpå¤´çš„åŠ¨ä½œå­—ç¬¦ä¸²ï¼ˆGET/POSTã€‚ã€‚ï¼‰è°ƒç”¨å¯¹åº”çš„æ–¹æ³•ã€‚\n\n\n## å·¦è¾¹ -- è¯·æ±‚äº§ç”Ÿ\n\n","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/6-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/Web%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/dao":{"title":"dao","content":"# dao\n\nDAOï¼ˆData Access Objectï¼‰æ˜¯**ç”¨äºè®¿é—®æ•°æ®çš„å¯¹è±¡**ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œå°†javaä¸­è®¿é—®å¯¹è±¡çš„æ“ä½œæ˜ å°„çš„å…·ä½“æ•°æ®åº“çš„æ“ä½œï¼Œä¾‹å¦‚Mybatisçš„è®¾è®¡ä¸­ï¼ŒMapperScannerConfigurerä¼šæ‰«ææ‰€æœ‰daoï¼Œå¾—åˆ°domainæ•°æ®å¯¹è±¡æ“ä½œå’Œæ•°æ®åº“è¯­å¥çš„æ˜ å°„å…³ç³»ï¼Œé€šè¿‡[[3-è®¡ç®—æœºç§‘å­¦/6-åº”ç”¨å¼€å‘/0-è½¯ä»¶è¯­è¨€/Java/1-é«˜çº§ç‰¹æ€§/åŠ¨æ€ä»£ç†|åŠ¨æ€ä»£ç†]]çš„æ–¹å¼æ‹¦æˆªæ‰€æœ‰å¯¹domainçš„æ“ä½œï¼Œè½¬åˆ°å¯¹æ•°æ®åº“çš„æ“ä½œã€‚","lastmodified":"2023-01-23T15:37:51.774680734Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84%E5%8F%8C%E5%AD%97%E8%8A%82":{"title":"é€†å‘ä¸­çš„åŒå­—èŠ‚","content":"\n# é€†å‘ä¸­çš„åŒå­—èŠ‚\n\n- æ•°æ®å‚¨å­˜ç±»å‹åˆ†ä¸º byte, word, dword\n    - åŒºåˆ«åœ¨äºå ç”¨å‡ ä¸ªå­—èŠ‚(byte)\n- byte ä¸å—å¤§å°ç«¯çš„å½±å“, å› ä¸ºå…¶åªæœ‰ä¸€ä½\n- word, å’Œ dword å—å¤§å°ç«¯çš„å½±å“\n- ä¸€èˆ¬çš„è®¡ç®—æœºä½¿ç”¨çš„æ˜¯å°ç«¯åº\n- ä¸€ä¸ª2ä½16è¿›åˆ¶æ˜¯1å­—èŠ‚\n\n## æŠ€å·§\n\n- IDA ä¸­çœ‹åˆ° word\n    - 16 è¿›åˆ¶æ˜¾ç¤ºæ—¶, ä¸¤ä¸¤ä¸€ç»„(4ä½16è¿›åˆ¶æ•°)ä»å³å‘å·¦\n- IDA ä¸­çœ‹åˆ° dword\n    - 16 è¿›åˆ¶æ˜¾ç¤ºæ—¶, å››ä¸ªä¸€ç»„(8ä½16è¿›åˆ¶æ•°)ä»å³å‘å·¦\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-%E6%B8%B8%E6%88%8F%E8%BF%87%E5%85%B3":{"title":"é€†å‘wp-æ¸¸æˆè¿‡å…³","content":"# é€†å‘wp-æ¸¸æˆè¿‡å…³\n\nbugku é€†å‘ç¬¬ä¸‰é¢˜.\n\nhttp://gokoucat.ys168.com/\n\n## å®šä½å…³é”®å‡½æ•°\n\né€šè¿‡å¯¹å­—ç¬¦ä¸² `done!!! the flag is` è¿›è¡Œäº¤å‰å¼•ç”¨çš„å®šä½, æ‰¾åˆ°å…³é”®å‡½æ•°çš„ä½ç½®.\n\n```c\n...\n    if ( byte_532E28[0] == 1\n      \u0026\u0026 byte_532E28[1] == 1\n      \u0026\u0026 byte_532E28[2] == 1\n      \u0026\u0026 byte_532E28[3] == 1\n      \u0026\u0026 byte_532E28[4] == 1\n      \u0026\u0026 byte_532E28[5] == 1\n      \u0026\u0026 byte_532E28[6] == 1\n      \u0026\u0026 byte_532E28[7] == 1 )\n    {\n      sub_457AB4();  //å…³é”®å‡½æ•°\n    }\n```\n\n## åˆ†æå‡½æ•°\n\nå‡½æ•°å†…éƒ¨æ˜¯å¯¹å·²æœ‰çš„æ•°æ®è¿›è¡Œå¤„ç†å¹¶è¾“å‡º\n\n## æ§åˆ¶ç¨‹åºæµç¨‹\n\nä¸€ç§æ–¹æ³•æ˜¯, åˆ©ç”¨ OD è°ƒè¯•, ç„¶åæ§åˆ¶è·³è½¬åˆ° flag å¤„ç†å‡½æ•°, ç›´æ¥è¾“å‡º:\n1. æ‰“å¼€od, åŠ è½½ç¨‹åº\n1. åœ¨è¯»å–è¾“å…¥çš„åœ°æ–¹è®¾ç½®æ–­ç‚¹:\n    ```c\n     while ( 1 )\n    {\n      s_print((int)\"input n,n(1-8)\\n\", v19);\n      sub_459418();\n      s_print((int)\"n=\", v16);\n      sub_4596D4(\"%d\", (unsigned int)\u0026v21);    //åœ¨è¿™ä¸ªä½ç½®è®¾ç½®æ–­ç‚¹\n      s_print((int)\"\\n\", v17);\n      if ( v21 \u003e= 0 \u0026\u0026 v21 \u003c= 8 )\n        break;\n      s_print((int)\"sorry,n error,try again\\n\", v19);\n    }\n    ```\n1.åŒå‡»ä¿®æ”¹ `call` çš„åœ°å€åˆ° flag å¤„ç†å‡½æ•°\n1. æŒ‰ F8 æ‰§è¡Œä¿®æ”¹è¿‡çš„æŒ‡ä»¤\n1. è¿”å›æ§åˆ¶å°çª—å£, æŸ¥çœ‹è¾“å‡º\n\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-Easy-CrackMe":{"title":"é€†å‘wp-Easy-CrackMe","content":"# é€†å‘wp-Easy-CrackMe\n\né¢˜ç›®åœ¨ç½‘ç»œå¯¹åº”ç›®å½•ä¸­: http://gokoucat.ys168.com/\n\n## é»‘ç›’æµ‹è¯•\n\n- windows çª—ä½“ç¨‹åº\n- æ²¡ä»€ä¹ˆè¾“å…¥é™åˆ¶\n- é”™è¯¯è¿”å›å­—ç¬¦ä¸² `Incorrect Password`\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214007.png]]\n\n## åç¼–è¯‘\n\nç¨‹åºæ˜¯ 32 ä½çš„.\n\n### å®šä½å…³é”®å‡½æ•°\n\né€šè¿‡å­—ç¬¦ä¸² `Incorrect Password` å®šä½å…³é”®å‡½æ•°, F5 åˆ†æ C ä»£ç .\n\n### å…³é”®å‡½æ•°åˆ†æ\n\n\u003e å˜é‡åæ ¹æ®ç”¨é€”é‡å‘½åè¿‡.\n\n```c\nint __cdecl sub_401080(HWND hDlg)\n{\n  int result; // eax@5\n  CHAR c1; // [sp+4h] [bp-64h]@1\n  char c2; // [sp+5h] [bp-63h]@1\n  char c3; // [sp+6h] [bp-62h]@2\n  char c4; // [sp+8h] [bp-60h]@3\n  __int16 v6; // [sp+65h] [bp-3h]@1\n  char v7; // [sp+67h] [bp-1h]@1\n\n  c1 = 0;\n  memset(\u0026c2, 0, 0x60u);\n  v6 = 0;\n  v7 = 0;\n  GetDlgItemTextA(hDlg, 1000, \u0026c1, 100);\n  if ( c2 == 'a' \u0026\u0026 !strncmp(\u0026c3, a5y, 2u) \u0026\u0026 !strcmp(\u0026c4, aR3versing) \u0026\u0026 c1 == 'E' )\n  {\n    MessageBoxA(hDlg, str_success, str_title1, 0x40u);\n    result = EndDialog(hDlg, 0);\n  }\n  else\n  {\n    result = MessageBoxA(hDlg, aIncorrectPassw, str_title1, 0x10u);\n  }\n  return result;\n}\n```\n\nå‘ç° `if ( c2 == 'a' \u0026\u0026 !strncmp(\u0026c3, a5y, 2u) \u0026\u0026 !strcmp(\u0026c4, aR3versing) \u0026\u0026 c1 == 'E' )` æ˜¯å…³é”®.  \n\næ¡ä»¶çœŸåˆ™å¯†ç é€šè¿‡, å¯†ç ä¸º `'E' + 'a' + \"5y\" + \"R3versing\"`\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214032.png]]","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-Easy-Keygen":{"title":"é€†å‘wp-Easy-Keygen","content":"# é€†å‘wp-Easy-Keygen\n\nåŸºç¡€çš„å¼‚æˆ–åŠ å¯†é¢˜.\n\nhttp://gokoucat.ys168.com/\n\n## é¢˜ç›®è¦æ±‚\n\nFind the Name when the Serial is 5B134977135E7D13\n\n## é»‘ç›’æµ‹è¯•\n\nç®€å•è¿è¡Œä¸€ä¸‹ç¨‹åº, å‘ç°æ˜¯ Windows ä¸‹çš„å‘½ä»¤è¡Œç¨‹åº, è¦æ±‚è¾“å…¥ name å’Œ serial, ç¨‹åºåˆ¤æ–­æ˜¯å¦æ­£ç¡®, é”™è¯¯ç›´æ¥è·³å‡º.  \n\n## åç¼–è¯‘\n\nç›´æ¥æ”¾ IDA é‡Œåç¼–è¯‘.\n\n### å®šä½å‡½æ•°\n\né€šè¿‡æœç´¢å­—ç¬¦ä¸² `Input Name:` æˆ–`Input Serial:`, æŸ¥æ‰¾äº¤å‰åº”ç”¨æ¥å®šä½ä¸»å‡½æ•°.\n\n### åˆ†æå‡½æ•°\n\nè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå‘, æ‰¾åˆ°ä¸»å‡½æ•°ç›´æ¥ F5 çœ‹ C ä»£ç :  \n\n```c\nint __cdecl main(int argc, const char **argv, const char **envp)\n{\n  signed int v3; // ebp@1\n  signed int i; // esi@1\n  int result; // eax@6\n  char v6; // [sp+Ch] [bp-130h]@1\n  char v7; // [sp+Dh] [bp-12Fh]@1\n  char v8; // [sp+Eh] [bp-12Eh]@1\n  char v9; // [sp+10h] [bp-12Ch]@1\n  char v10; // [sp+11h] [bp-12Bh]@1\n  __int16 v11; // [sp+71h] [bp-CBh]@1\n  char v12; // [sp+73h] [bp-C9h]@1\n  char v13; // [sp+74h] [bp-C8h]@1\n  char v14; // [sp+75h] [bp-C7h]@1\n  __int16 v15; // [sp+139h] [bp-3h]@1\n  char v16; // [sp+13Bh] [bp-1h]@1\n\n  v9 = 0;\n  v13 = 0;\n  memset(\u0026v10, 0, 0x60u);\n  v11 = 0;\n  v12 = 0;\n  memset(\u0026v14, 0, 0xC4u);\n  v15 = 0;\n  v16 = 0;\n  v6 = 16;\n  v7 = 32;\n  v8 = 48;\n  sub_4011B9(aInputName);\n  scanf(aS, \u0026v9);\n  v3 = 0;\n  for ( i = 0; v3 \u003c (signed int)strlen(\u0026v9); ++i )\n  {\n    if ( i \u003e= 3 )\n      i = 0;\n    sprintf(\u0026v13, aS02x, \u0026v13, *(\u0026v9 + v3++) ^ *(\u0026v6 + i));\n  }\n  memset(\u0026v9, 0, 0x64u);\n  sub_4011B9(aInputSerial);\n  scanf(aS, \u0026v9);\n  if ( !strcmp(\u0026v9, \u0026v13) )\n  {\n    sub_4011B9(aCorrect);\n    result = 0;\n  }\n  else\n  {\n    sub_4011B9(aWrong);\n    result = 0;\n  }\n  return result;\n}\n```\n\n#### å‡½æ•°æµç¨‹\n\n1. åˆå§‹åŒ–å­—ç¬¦ä¸²å˜é‡\n1. è¯»å…¥ç¬¬ä¸€æ¬¡è¾“å…¥\n1. å¾ªç¯éå†è¾“å…¥çš„æ¯ä¸€ä¸ªå­—ç¬¦\n    1. å°†å­—ç¬¦çš„ ASCII æ•°å€¼ä¸16, 32, 48 ä¸­çš„ä¸€ä¸ªå¼‚æˆ–, key çš„ä½¿ç”¨ä¸º 3 æ¬¡ä¸€å¾ªç¯\n    1. ç»“æœå‚¨å­˜ä¸º 16 è¿›åˆ¶, ä¸è¶³ 2 ä½åˆ™åŠ å…¥å‰å¯¼ 0\n1. é€šè¿‡ `sprintf` å‡½æ•°å¢é‡å†™å…¥å˜é‡ v13 ä¸­\n1. è¯»å…¥ç¬¬äºŒæ¬¡è¾“å…¥\n1. å°† v13 çš„ç»“æœä¸è¾“å…¥æ¯”è¾ƒ, ä¸€è‡´åˆ™é€šè¿‡\n\n#### åŠ å¯†ç®—æ³•åˆ†æ\n\nå‡½æ•°é€šè¿‡ä¸€æ¬¡ for å¾ªç¯, æ¥éå†è¾“å…¥å­—ç¬¦ä¸²çš„æ¯ä¸€ä¸ªå­—ç¬¦, é€šè¿‡ sprintf æ ¼å¼åŒ–è¾“å…¥, å°†æŒ‰ä½å¼‚æˆ–çš„ç»“æœå¢é‡å­˜å…¥ v13 å˜é‡ä¸­.  \nè¿™é‡Œæˆ‘ä»¬åˆ†æä¸€ä¸‹ `sprintf` å‡½æ•°:  \n\n\u003e [å‚è€ƒæ–‡ç« ](https://zh.cppreference.com/w/c/io/fprintf)  \n\n```c\nsprintf(\u0026v13, aS02x, \u0026v13, *(\u0026v9 + v3++) ^ *(\u0026v6 + i))\n```\n\n- å…¶ä¸­ aS02x å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯ `%s%02x`, æŒ‡å®šæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²å’Œ å¸¦å‰å¯¼ 0 çš„ 16 è¿›åˆ¶ 2 ä½æ•°\n- `%s` å­˜å…¥å½“å‰(ä¹Ÿå°±æ˜¯ä¸Šä¸€æ¬¡å¼‚æˆ–ç»“æœ) v13 å˜é‡çš„å†…å®¹, ç¬¬äºŒä¸ª\n- `%02x` å­˜å…¥ å½“å‰éå†å­—ç¬¦ä¸å¯¹åº” KEY å¼‚æˆ–çš„ç»“æœ\n\n```c\nif ( i \u003e= 3 )\n      i = 0;\n```\n\nä»£è¡¨å¾ªç¯ä½¿ç”¨ 3 ä¸ª KEY, åˆ†åˆ«æ˜¯16, 32, 48 (10è¿›åˆ¶è¡¨ç¤º).  \n\n#### ç ´è§£ç®—æ³•\n\næœ¬é¢˜å®é™…åªæ˜¯é€šè¿‡å¼‚æˆ–åŠ å¯†, è€Œå¼‚æˆ–è¿ç®—çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹å°±æ˜¯, å¯¹ä¸€ä¸ªæ•°ç”¨åŒæ ·çš„ KEY å¼‚æˆ– 2 æ¬¡, ä¼šå¾—åˆ°è¿™ä¸ªæ•°æœ¬èº«.  \nç ´è§£çš„æ–¹æ³•å°±å˜å¾—ç®€å•äº†, åªè¦å†å†™ä¸€éå¼‚æˆ–ç®—æ³•å°±è¡Œ, è¿™é‡Œç”¨ python æ¥å†™:  \n\n```python\nserial = \"5B134977135E7D13\"  ## è¦è§£å¯†çš„æ³¨å†Œç \nkey = [16, 32, 48]           ## å¼‚æˆ–ç”¨åˆ°çš„ key\nname = \"\"                    ## åˆå§‹åŒ–\n\nfor i in range(len(serial) // 2):   \n    each_2char = serial[i*2:i*2+2]  ## å°†æ³¨å†Œç ä¸¤ä¸¤åˆ†ç»„\n    name += chr(int(each_2char, 16) ^ key[i%3])  ## å¼‚æˆ–è¿ç®—\nprint(name)\n```\n\næ³¨æ„, åŠ å¯†ç®—æ³•ä¿å­˜çš„å­—ç¬¦ä¸²æ ¼å¼ä¸ºå¸¦å‰å¯¼ 0 çš„ 16 è¿›åˆ¶ 2 ä½æ•°, æ‰€ä»¥åè¿‡æ¥å¯¹æ³¨å†Œç å¼‚æˆ–è¿ç®—æ—¶, è¦ä¸¤ä¸¤åˆ†ç»„, å¾ªç¯æ¬¡æ•°ä¹Ÿè¦ç›¸åº”å‡åŠ.  \n`key[i%3]` ä¸­çš„ `i%3` åˆ™æ˜¯ä½¿ 3 ä¸ª key å¾ªç¯ä½¿ç”¨.  ","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-Easy-Re":{"title":"é€†å‘wp-Easy-Re","content":"# é€†å‘wp-Easy-Re\n\nbugku é€†å‘ç¬¬äºŒé¢˜.\n\n## å®šä½å…³é”®å‡½æ•°\n\né€šè¿‡ ida åç¼–è¯‘, å¾ˆå®¹æ˜“å®šä½å…³é”®å‡½æ•°, æœ¬é¢˜ç»“æ„ååˆ†ç®€å•:\n\n```c\nint __cdecl main(int argc, const char **argv, const char **envp)\n{\n  int v3; // eax\n  __int128 v5; // [esp+0h] [ebp-44h]\n  __int64 v6; // [esp+10h] [ebp-34h]\n  int v7; // [esp+18h] [ebp-2Ch]\n  __int16 v8; // [esp+1Ch] [ebp-28h]\n  char v9; // [esp+20h] [ebp-24h]\n\n  _mm_storeu_si128((__m128i *)\u0026v5, _mm_loadu_si128((const __m128i *)\u0026xmmword_413E34));  // \u0026xmmword_413E34 å³è¢«æ¯”è¾ƒæ•°æ® flag\n  v7 = 0;\n  v6 = qword_413E44;\n  v8 = 0;\n  printf(\"æ¬¢è¿æ¥åˆ°DUTCTFå‘¦\\n\");\n  printf(\"è¿™æ˜¯ä¸€é“å¾ˆå¯çˆ±å¾ˆç®€å•çš„é€†å‘é¢˜å‘¦\\n\");\n  printf(\"è¾“å…¥flagå§:\");\n  scanf(\"%s\", \u0026v9);\n  v3 = strcmp((const char *)\u0026v5, \u0026v9);  // å°†è¾“å…¥ä¸å·²æœ‰æ•°æ®è¿›è¡Œæ¯”è¾ƒ, \n  if ( v3 )\n    v3 = -(v3 \u003c 0) | 1;\n  if ( v3 )\n    printf(aFlag_0);\n  else\n    printf((const char *)\u0026unk_413E90);\n  system(\"pause\");\n  return 0;\n}\n```\n\n## è§£æå­—ç¬¦ä¸²\n\nå¯¹ `\u0026xmmword_413E34` ä½ç½®çš„æ•°æ®è¿›è¡Œåˆ†æ, å‘ç°æ­¤å¤„å°±æ˜¯ flag çš„é€†åºå­˜å‚¨, ç›´æ¥å³é”®æ˜¾ç¤ºä¸º å­—ç¬¦, ç„¶åæ‰‹å·¥åå‘è¾“å…¥å³å¯.\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214345.png]]\n\n## å€ŸåŠ© python è§£ç \n\n\u003e python 3\n\nå°†æ•°æ®å¤åˆ¶å‡ºæ¥, æ”¾åˆ°python 3 é‡Œè§£ç :\n\n```py\nimport binascii\n\na = '7D465443545544'    ## é€†åºæ‰€ä»¥åä¸€æ®µåœ¨å‰\nb = binascii.a2b_hex(a)    ## 16 è¿›åˆ¶è½¬ä¸ºå­—ç¬¦ä¸²\nc = '3074656D30633165577B465443545544'\nb += binascii.a2b_hex(c)    ## 16 è¿›åˆ¶è½¬ä¸ºå­—ç¬¦ä¸²\nstr_list = list(b)    ## å°†å­—ç¬¦ä¸²è½¬ä¸ºæ•°ç»„\nstr_list.reverse()    ## å¯¹æ•°ç»„é€†åº\n\nfor i in str_list:     ## éå†è¾“å‡ºæ•°ç»„, ä»¥ chr æ ¼å¼\n    print(chr(i), end=\"\")\n```","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-Easy-UnpackMe":{"title":"é€†å‘wp-Easy-UnpackMe","content":"\n# é€†å‘wp-Easy-UnpackMe\n\nè„±å£³å…¥é—¨é¢˜, æ‰¾ç¨‹åº EOP (å…¥å£ç‚¹).\n\né¢˜ç›®åœ¨ç½‘ç»œå¯¹åº”ç›®å½•ä¸­: http://gokoucat.ys168.com/\n\n## é¢˜ç›®è¦æ±‚\n\nFind the OEP, ex) 00401000\n\n## é»‘ç›’æµ‹è¯•\n\nåŒå‡»æ‰“å¼€, æ˜¯ä¸€ä¸ªç©ºç™½çš„ Windows çª—ä½“ç¨‹åº, æ²¡ä»€ä¹ˆç‰¹åˆ«çš„.\n\n## OD è°ƒè¯•\n\né€šè¿‡ä½¿ç”¨ OD åŠ¨æ€è°ƒè¯•, å¯»æ‰¾ç¨‹åºçš„ EOP, ä½¿ç”¨çš„æ–¹æ³•æ˜¯å•æ­¥è·Ÿè¸ª.\n\n### å•æ­¥è·Ÿè¸ª\n\n\u003e [å‚è€ƒè§†é¢‘](https://www.bilibili.com/video/av19570153)\n\n- ç¨‹åºè½½å…¥ OD åå³å¼€å§‹å•æ­¥æ­¥è¿‡ (F8) è°ƒè¯•\n- é‡åˆ°å‘ä¸‹è·³è½¬çš„ä¸€å¾‹æ‰§è¡Œ\n- é‡åˆ°å‘ä¸Šè·³è½¬çš„ä¸€å¾‹ä¸æ‰§è¡Œ\n    - é€‰ä¸­ä¸‹ä¸€æ¡æŒ‡ä»¤\n    - æŒ‰ F4 æ‰§è¡Œåˆ°é€‰ä¸­ä½ç½®\n    - æˆ–è€…åœ¨ä¸‹ä¸€æ¡æŒ‡ä»¤å¤„ä¸‹æ–­ç‚¹, å†ç»§ç»­ç¨‹åº, åˆ°è¾¾æ–­ç‚¹ååˆ é™¤æ–­ç‚¹ (ä¸å¸¸ç”¨)\n\n- ç›´åˆ°é‡åˆ°åœ°å€è·³è·ƒå¹…åº¦å¾ˆå¤§çš„åœ°å€\n\næ‰¾åˆ°è¿™æ ·çš„åœ°å€, åŸºæœ¬å°±æ˜¯ç¨‹åºçš„ OEP äº†, æ³¨æ„åœ¨ OD ä¸­, çº¢è‰²çš„çº¿ä»£è¡¨è·³è½¬å·²ç»å®ç°, ç»¿è‰²çš„çº¿ä»£è¡¨è·³è½¬æœªå®ç°.  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214517.png]]\n\nå›¾ä¸­ jmp æœ¬èº«çš„åœ°å€æ˜¯ `0040A1FB`, è€Œç›®æ ‡åœ°å€æ˜¯ `00401150`, åœ°å€è·¨åº¦è¾ƒå¤§, å¯ä»¥åˆ¤å®š `00401150` å°±æ˜¯ EOP åœ°å€.  \n\nåç»­åˆ™æ˜¯è„±å£³æ­¥éª¤, æœ¬é¢˜ä¸æ¶‰åŠè„±å£³æ“ä½œ, åªç”¨æ‰¾ EOP åœ°å€, åˆ°æ­¤ç»“æŸ\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-Reverse-100":{"title":"é€†å‘wp-Reverse-100","content":"# é€†å‘wp-Reverse-100\n\n[æ­ç”µ CTF å¹³å°é€†å‘ç¬¬å››é¢˜.](http://sec.hdu.edu.cn/question/reverse/5789?sort=default)\n\né¢˜ç›®åœ¨ç½‘ç»œå¯¹åº”ç›®å½•ä¸­: http://gokoucat.ys168.com/\n\n## å®šä½å…³é”®å‡½æ•°\n\nè€å¥—è·¯, string æŸ¥æ‰¾, ä¸å¤š BB.\n\n## è§£æå‡½æ•°\n\nè¿™ä¸ªå‡½æ•°æ¯”è¾ƒç®€å•, key å’Œ åˆ¤æ–­æµç¨‹åœ¨ä¸€ä¸ªç®€å•çš„å‡½æ•°ä¸­ç›´æ¥å±•ç¤º:\n\n```c\nint __cdecl main(int argc, const char **argv, const char **envp)\n{\n  signed int i; // edi\n  char s_input; // [esp+10h] [ebp-104h]\n  char Dst; // [esp+11h] [ebp-103h]\n\n  s_input = 0;\n  memset(\u0026Dst, 0, 0xFFu);\n  printf(\"please input ns-ctf password: \");\n  scanf_s(\"%s\", \u0026s_input);\n  for ( i = 1; strncmp(\"nsF0cuS!x01\", \u0026s_input, 0xBu); ++i )\n  {\n    printf(\"try again!\\n\");\n    memset(\u0026s_input, 0, 0x100u);\n    printf(\"please input ns-ctf password: \");\n    scanf_s(\"%s\", \u0026s_input);\n  }\n  dword_403368 = 1;\n  if ( \u0026s_input + strlen(\u0026s_input) + 1 != \u0026Dst )\n  {\n    if ( i \u003e 3 )\n    {\n      sub_401000();\n      return 0;\n    }\n    printf(\"flag:{NSCTF_md5065ca\u003e01??ab7e0f4\u003e\u003ea701c\u003ecd17340}\");\n  }\n  return 0;\n}\n```\n\n- å‡½æ•°åˆ©ç”¨ for é‡Œçš„è¯­å¥å¾ªç¯è¯»å…¥å­—ç¬¦ä¸²\n- å­—ç¬¦ä¸²ä¸ `nsF0cuS!x01` æ¯”è¾ƒ, ç›¸åŒåˆ™é€šè¿‡\n- å¦‚æœ `i \u003c= 3`, è¿”å›çš„ flag æ˜¯æœªç»å¤„ç†çš„é”™è¯¯ç­”æ¡ˆ\n\n## ä½œç­”\n\nå¯¹ç­–ååˆ†ç®€å•, æ•…æ„é”™è¯¯è¾“å…¥3æ¬¡, ç¬¬å››æ¬¡è¾“å…¥ `nsF0cuS!x01` å³å¯\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215255.png]]\n\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-WannaLOL2":{"title":"é€†å‘wp-WannaLOL2","content":"\n# é€†å‘wp-WannaLOL2\n\né€†å‘å…¥é—¨é¢˜.\n\né¢˜ç›®åœ¨ç½‘ç»œå¯¹åº”ç›®å½•ä¸­: http://gokoucat.ys168.com/\n\n## é»‘ç›’æµ‹è¯•\n\næ‹¿åˆ°é¢˜ç›®ç¬¬ä¸€æ­¥, å°±æ˜¯è¿è¡Œè½¯ä»¶è¿›è¡Œæµ‹è¯•\n- åˆ¤æ–­è½¯ä»¶å¹³å°\n- è§‚å¯Ÿè¾“å…¥é™åˆ¶\n- è§‚å¯Ÿè¾“å‡ºä¿¡æ¯\n\næœ¬é¢˜æ˜¯ä¸€é“ Windows å¹³å°ä¸‹çš„çª—ä½“ç¨‹åº, ä»»æ„è¾“å…¥å†…å®¹è¿›è¡Œæµ‹è¯•:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215724.png]]\n\néšæ„è¾“å…¥å, å‘ç°ç¨‹åºå¯¹è¾“å…¥çš„å†…å®¹å’Œé•¿åº¦æ²¡æœ‰åšé™åˆ¶, è¾“å…¥ä¸é€šè¿‡æ—¶è¿”å›å­—ç¬¦ä¸² `error !`  \nè¿”å›é”™çš„çš„å­—ç¬¦ä¸²å°±æ˜¯å®šä½å…³é”®å‡½æ•°çš„ä¸€ä¸ªçªç ´ç‚¹.  \n\n## åç¼–è¯‘\n\nä½¿ç”¨ IDA è½¯ä»¶å¯¹ç¨‹åºè¿›è¡Œåç¼–è¯‘.  \n\n```\næ— æ³•ç¡®è®¤ç¨‹åºä½æ•°æ—¶, ç»Ÿä¸€å…ˆç”¨ X86 çš„ IDA æ‰“å¼€, è§‚å¯Ÿæ˜¯å¦æŠ¥é”™æ¥ç¡®å®šæ˜¯å¤šå°‘ä½çš„ç¨‹åº.\n```\n\n### IDA è§†å›¾é…ç½®\n\n- æ‰“å¼€æœºå™¨ç æ˜¾ç¤º\n- æ‰“å¼€ 16 è¿›åˆ¶è§†å›¾ (Hex-View)\n- æ‰“å¼€å­—ç¬¦ä¸²è§†å›¾ (Strings windows)\n\n### å®šä½å…³é”®å‡½æ•°\n\né€šè¿‡è¾“å‡ºå­—ç¬¦ä¸² `error !` å®šä½ç¨‹åºçš„å…³é”®å‡½æ•°.\n\n#### æœç´¢å­—ç¬¦ä¸²å®šä½\n\n1. åœ¨ strings windows ä¸­æŒ‰ ctrl + F æœç´¢å­—ç¬¦ä¸² `error !`\n1. åŒå‡»ç»“æœä¸­åŒ¹é…çš„å†…å®¹, è·³è½¬åˆ°å¯¹åº”çš„æ•°æ®ä½ç½®\n\n#### å®šä½å­—ç¬¦ä¸²å¼•ç”¨ä½ç½®\n\nå…‰æ ‡æ”¾åœ¨å­—ç¬¦ä¸²çš„å˜é‡åå¤„, æŒ‰ x è°ƒå‡ºäº¤å‰åº”ç”¨çª—å£, åŒå‡»æ¡ç›®è·³è½¬åˆ°å¯¹åº”å‡½æ•°  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215738.png]]\n\nå¼•ç”¨ä½ç½®:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215748.png]]\n\n### èŠ±æŒ‡ä»¤\n\n#### è¯†åˆ«èŠ±æŒ‡ä»¤\n\nåœ¨å…³é”®å‡½æ•°å¤„æŒ‰ F5 å‘ç°æ— æ³•è½¬æ¢æˆ C ä»£ç , åˆ¤æ–­å‡½æ•°ä¸­å­˜åœ¨èŠ±æŒ‡ä»¤.  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215712.png]]\n\nè¿™é‡Œæ˜¯ä¸€ç§æœ€åŸºæœ¬çš„èŠ±æŒ‡ä»¤ç±»å‹, æ–‡ç«  [ä»£ç æ··æ·†ï¼ç¨‹åºä¿æŠ¤ï¼ˆå¯¹æŠ—åæ±‡ç¼–ï¼‰åŸç†ä¸å®è·µ](https://blog.csdn.net/pianogirl123/article/details/53871397) ä»‹ç»äº†åŸºç¡€çš„ä»£ç æ··æ·†çŸ¥è¯†, å¯ä»¥æ‰©å±•é˜…è¯».  \n\nä»”ç»†åˆ†ææœ¬é¢˜çš„èŠ±æŒ‡ä»¤:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215802.png]]\n\nç¬¬ä¸€å’Œç¬¬äºŒæ¡çš„ `jz` å’Œ `jnz` éƒ½è·³è½¬åˆ°äº†åŒä¸€ä¸ªåœ°å€, é‚£ä¹ˆä»£è¡¨ç¨‹åºçœŸæ­£æ‰§è¡Œèµ·æ¥, æ— è®ºå¦‚ä½•éƒ½ä¼šè·³è½¬åˆ°æŒ‡å‘çš„ `loc_401262+1` ä½ç½®.  \nå†è§‚å¯Ÿ `loc_401262` é™„è¿‘, æœºå™¨ç æ˜¯ `E8 66 B8 08 00`, æŸ¥è¯¢æœºå™¨ç å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤, `E8` å€¼ `CALL`, è¿™æ ·, IDA é”™è¯¯çš„è®¤ä¸ºæ­¤å¤„æœ‰ `CALL` æŒ‡ä»¤, ä¸”åç»­çš„åç§»é‡æ˜¯ä¸€ä¸ªæ— æ•ˆçš„åœ°å€. è€Œç¨‹åºæ‰§è¡Œæ—¶, å®é™…è·³è¿‡äº† `E8`.  \n\n#### å¤„ç†èŠ±æŒ‡ä»¤\n\næœ¬é¢˜çš„èŠ±æŒ‡ä»¤æœ‰ä¸¤ç§æ–¹æ³•å»é™¤, æœ¬è´¨æ˜¯è®© IDA ä¸è¯†åˆ«åˆ° `E8` ([[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/call|CALL]]).  \n\n##### æ›¿æ¢æŒ‡ä»¤ä¸º `90`\n\n`90` æœºå™¨ç ä»£è¡¨ä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œ, å°† `E8` æ›¿æ¢ä¸º `90` å³å¯è®© IDA æ­£ç¡®è¯†åˆ«å‡½æ•°.  \n\nå…‰æ ‡å®šä½åˆ° `E8` ä½ç½®, åˆ‡æ¢åˆ° 16 è¿›åˆ¶è§†å›¾, æŒ‰ F2 å¼€å¯ç¼–è¾‘æ¨¡å¼, å°† `E8` æ”¹ä¸º `90`, å†æŒ‰ F2 ä¿å­˜æ›´æ”¹.  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/flower3.gif]]\n\n##### å°†èŠ±æŒ‡ä»¤æ ‡è®°ä¸º db\n\nå…‰æ ‡å®šä½åˆ° `E8` ä½ç½®, æŒ‰ U (undefine), é€‰ä¸­ä¸‹ä¸€ä¸ªæœºå™¨ç  `66`, æŒ‰ C (code).  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/flower4.gif]]\n\n#### è®© IDA é‡æ–°è¯†åˆ«å‡½æ•°\n\nå°†æ•´ä¸ªå‡½æ•°é€‰ä¸­, æŒ‰ P é‡æ–°è¯†åˆ«, æ­¤æ—¶å¯ä»¥æŒ‰ F5 è½¬æ¢ä¸º C ä»£ç äº†.  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/flower5.gif]]\n\n### ä¸»å‡½æ•°åˆ†æ\n\nIDA ç”Ÿæˆçš„ C ä»£ç å¦‚ä¸‹:  \n\n```c\nint sub_4011F4()\n{\n  double v0; // st7@8\n  double v1; // st6@8\n  const CHAR *v3; // [sp-Ch] [bp-28h]@12\n  const CHAR *v4; // [sp-8h] [bp-24h]@11\n  CHAR String; // [sp+0h] [bp-1Ch]@1\n  char v6; // [sp+1h] [bp-1Bh]@3\n  char v7; // [sp+2h] [bp-1Ah]@4\n  char v8; // [sp+3h] [bp-19h]@5\n  int v9; // [sp+18h] [bp-4h]@8\n\n  GetDlgItemTextA(hDlg, 1001, \u0026String, 21);\n  Sleep(0x1F4u);\n  if ( strlen(\u0026String) != 4 || String == 48 || v6 == 48 || v7 == 48 || v8 == 48 || String != 49 || v6 != 53 )\n  {\n    v4 = Caption;\nLABEL_14:\n    v3 = Text;\n    return MessageBoxA(hWnd, v3, v4, 0);\n  }\n  v9 = v7 - 48;\n  v0 = (double)v9;\n  v9 = String - 48;\n  v1 = (double)v9;\n  v9 = v8 - 48;\n  *(float *)\u0026v9 = (v0 - v1 / (double)5) * (double)v9 * 16.0;\n  if ( v8 != 48 \u0026\u0026 v8 == 48 )\n    JUMPOUT(unk_4012AA);\n  v4 = aCrackme2017Ctf;\n  if ( *(float *)\u0026v9 != 384.0 )\n    goto LABEL_14;\n  v3 = aRegistrationSu;\n  return MessageBoxA(hWnd, v3, v4, 0);\n}\n```\n\n#### æµç¨‹åˆ†æ\n\nåˆ†æä»£ç , å¯çŸ¥ç¨‹åºé€šè¿‡å¯¹å­—ç¬¦ä¸²æ•°ç»„ String, ä¹Ÿå°±æ˜¯è¾“å…¥çš„å†…å®¹è¿›è¡Œæ¡ä»¶æ¯”è¾ƒ, å†è¾“å‡ºç»“æœ.  \nå…¶ä¸­ `Caption` å’Œ `aCrackme2017Ctf` çš„å†…å®¹æ˜¯è¾“å‡ºçª—ä½“çš„æ ‡é¢˜, `Test` çš„å†…å®¹ä¸ºè¿”å›çš„ error å­—ç¬¦ä¸², `aRegistrationSu` çš„å†…å®¹ä¸ºè¾“å…¥å†…å®¹æ­£ç¡®å›æ˜¾çš„å­—ç¬¦ä¸².  \nç¨‹åºç»è¿‡ä¸¤æ¬¡ if åˆ¤æ–­, æ¥å†³å®šå›æ˜¾ error è¿˜æ˜¯ success:  \n\n```c\nif ( strlen(\u0026String) != 4 || String == 48 || v6 == 48 || v7 == 48 || v8 == 48 || String != 49 || v6 != 53 )\n```\n\nä¸ºå‡, ä¸”\n\n```c\nif ( v8 != 48 \u0026\u0026 v8 == 48 )\n```\n\nä¸ºçœŸ, åˆ™è¿”å› success.\n\n#### ä¼˜åŒ–å˜é‡å\n\nåœ¨ç”¨ IDA åˆ†æä»£ç æ—¶, è‡ªåŠ¨ç”Ÿæˆçš„å˜é‡åå¾€å¾€ä¸èƒ½å¾ˆå¥½çš„è¡¨è¾¾å˜é‡çš„å«ä¹‰, æ­¤æ—¶å°±éœ€è¦æ‰‹åŠ¨é‡å‘½åå˜é‡, å…‰æ ‡å®šä½åˆ°å¯¹åº”å˜é‡åæŒ‰ N å³å¯.  \nå¯¹äºéƒ¨åˆ†æ•°æ®, å¯ä»¥å³é”®è½¬åŒ–ä¸ºä¸åŒçš„æ˜¾ç¤ºæ–¹å¼, å¦‚ 48 é‡æ–°æ˜¾ç¤ºä¸º å­—ç¬¦ '0'.  \né‡æ–°å®šä¹‰è¿‡å˜é‡ååçš„ä»£ç å¦‚ä¸‹:  \n\nå…¶ä¸­ c1-c4 æ˜¯è¾“å…¥å­—ç¬¦ä¸²çš„ 4 ä½å­—ç¬¦\n\n```c\nint sub_4011F4()\n{\n  double v0; // st7@8\n  double v1; // st6@8\n  const CHAR *v3; // [sp-Ch] [bp-28h]@12\n  const CHAR *v4; // [sp-8h] [bp-24h]@11\n  CHAR c1; // [sp+0h] [bp-1Ch]@1\n  char c2; // [sp+1h] [bp-1Bh]@3\n  char c3; // [sp+2h] [bp-1Ah]@4\n  char c4; // [sp+3h] [bp-19h]@5\n  int temp; // [sp+18h] [bp-4h]@8\n\n  GetDlgItemTextA(hDlg, 1001, \u0026c1, 21);\n  Sleep(0x1F4u);\n  if ( strlen(\u0026c1) != 4 || c1 == '0' || c2 == '0' || c3 == '0' || c4 == '0' || c1 != '1' || c2 != '5' )\n  {\n    v4 = str_title1;\nLABEL_14:\n    v3 = str_error;\n    return MessageBoxA(hWnd, v3, v4, 0);\n  }\n  temp = c3 - '0';\n  v0 = (double)temp;\n  temp = c1 - '0';\n  v1 = (double)temp;\n  temp = c4 - '0';\n  *(float *)\u0026temp = (v0 - v1 / (double)5) * (double)temp * 16.0;\n  if ( c4 != '0' \u0026\u0026 c4 == '0' )\n    JUMPOUT(unk_4012AA);\n  v4 = str_title2;\n  if ( *(float *)\u0026temp != 384.0 )\n    goto LABEL_14;\n  v3 = str_success;\n  return MessageBoxA(hWnd, v3, v4, 0);\n}\n```\n\n#### ä¸»è¦è¯­å¥åˆ†æ\n\n##### ç¬¬ä¸€å¤„ if\n\n```c\nif ( strlen(\u0026c1) != 4 || c1 == '0' || c2 == '0' || c3 == '0' || c4 == '0' || c1 != '1' || c2 != '5' )\n```\n\nè§£é‡Šä¸€ä¸‹:  \n\n```\nå¦‚æœ (å­—ç¬¦é•¿åº¦ä¸ç­‰äº4 æˆ– ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯0 æˆ– ç¬¬äºŒä¸ªå­—ç¬¦æ˜¯0 æˆ– ç¬¬ä¸‰ä¸ªå­—ç¬¦æ˜¯0 æˆ– ç¬¬å››ä¸ªå­—ç¬¦æ˜¯0 æˆ–ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯1 æˆ– ç¬¬äºŒä¸ªå­—ç¬¦ä¸æ˜¯ 5)\n{\n    è¿”å› error\n}\n```\n\næ¢å¥è¯è¯´, è¾“å…¥çš„å­—ç¬¦ä¸²è¦ä¸º 4 ä¸ªå­—ç¬¦é•¿åº¦, å„å­—ç¬¦ä¸èƒ½æ˜¯ '0', ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ '1', ç¬¬äºŒä¸ªå­—ç¬¦æ˜¯ '5'.\n\n##### ç¬¬äºŒå¤„ if\n\næ­¤æ—¶, æˆ‘ä»¬çŸ¥é“:  \n\n```c\nc1 = '1'\nc2 = '5'\n```\n\nè¿˜éœ€è¦è§£å‡º c3 å’Œ c4 çš„å€¼, å³å¯. åˆ†æç¬¬äºŒå¤„ if å‰åçš„å†…å®¹:  \n\n```c\ntemp = c3 - '0';\n  v0 = (double)temp;  // v0 = (double)c3\n  temp = c1 - '0';\n  v1 = (double)temp;  // v1 = 1\n  temp = c4 - '0';   // temp = (int)c4\n  *(float *)\u0026temp = (v0 - v1 / (double)5) * (double)temp * 16.0;\n  if ( *(float *)\u0026temp != 384.0 )\n    goto LABEL_14;\n```\n\nå¯çŸ¥, `(v0 - v1 / (double)5) * (double)temp * 16.0` çš„å€¼ç­‰äº 384 æ—¶, å¯ä»¥è¿”å› success. å…¶ä¸­ `v0` æ˜¯ `c3` å­—ç¬¦å†…å®¹çš„æµ®ç‚¹è¡¨ç¤º, `v1` å€¼æ˜¯ 1, `temp` æ˜¯ `c4` å†…å®¹çš„æ•´æ•°è¡¨ç¤º, åˆ†åˆ«ç”¨ x å’Œ y ä»£æ›¿, å¾—åˆ°äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹:  \n\n$$(x - 1 / 5) \\times y \\times 16 = 384$$\n\nåŒ–ç®€ä¸€ä¸‹å:  \n\n$$(x - 1 / 5) \\times y = 24$$\n\n#### è§£æ–¹ç¨‹\n\nç”¨ python æˆ–å…¶ä»–æ–¹å¼, å¯¹äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹æ±‚è§£:  \n\n```python\nfor x in range(10):\n    for y in range(10):\n        if (x - 1 / 5) * y == 24:\n            print(x,y)\n```\n\nè§£å¾— x å’Œ y å‡ä¸º 5.  æ•´ä¸ªè¾“å…¥çš„å­—ç¬¦ä¸²ä¸º1555.  è¾“å…¥æ±‚è¯:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917220053.png]]\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-ebCTF-Teaser-BIN100-Dice":{"title":"é€†å‘wp-ebCTF-Teaser-BIN100-Dice","content":"\n# é€†å‘wp-ebCTF-Teaser-BIN100-Dice\n\n[æ­ç”µ CTF å¹³å°é€†å‘ç¬¬ä¸€é¢˜.](http://sec.hdu.edu.cn/question/reverse/5780?sort=default)\n\nhttp://gokoucat.ys168.com/\n\n## å®šä½å…³é”®å‡½æ•°\n\n- ä½¿ç”¨ IDA å­—ç¬¦ä¸²æœç´¢\n- å®šä½å›æ˜¾å­—ç¬¦ä¸²è¢«äº¤å‰å¼•ç”¨çš„ä½ç½®\n\nå¾—åˆ°å…³é”®å‡½æ•°ä¸­çš„é‡è¦ç‰‡æ®µå¦‚ä¸‹: \n\n```c++\nint __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd)\n{\n\n  ......\n  \n  v9 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e(\n         (int)\u0026std::cout,\n         \"[*] You will first need to throw a three, press enter to throw a dice!\");\n  std::ostream::operator\u003c\u003c(v9, std::endl\u003cchar,std::char_traits\u003cchar\u003e\u003e);\n  std::getline\u003cchar,std::char_traits\u003cchar\u003e,std::allocator\u003cchar\u003e\u003e(\u0026std::cin, \u0026v83);\n  v80 = time(0);  // è·å–ç³»ç»Ÿæ—¶é—´\n  rand();    // äº§ç”Ÿéšæœºæ•°\n  v82 = 3;\n\n......\n\n  if ( v82 == 3 )     // ç¬¬ä¸€ä¸ªä¸º 3\n  {\n    fctx.call_site = 1;\n    v10 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e((int)\u0026std::cout, \"[*] You rolled a three! Good!\");\n   \n......\n\n    v17 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e(\n            (int)\u0026std::cout,\n            \"[*] Next you will need to throw a one, press enter to throw a dice!\");\n\n    v80 = time(0);\n    rand();\n  \n......\n\n    if ( v82 == 1 )    // ç¬¬äºŒä¸ªæ˜¯1\n    {\n      fctx.call_site = 1;\n      v18 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e((int)\u0026std::cout, \"[*] You rolled a one! Very nice!\");\n      \n......\n\n      v25 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e(\n              (int)\u0026std::cout,\n              \"[*] Next you will need to throw another three, press enter to throw a dice!\");\n\n      v80 = time(0);\n      rand();\n      \n......\n\n      if ( v82 == 3 )  // ç¬¬ä¸‰ä¸ªæ˜¯3\n      {\n        fctx.call_site = 1;\n        v26 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e((int)\u0026std::cout, \"[*] You rolled a three! Awesome!\");\n       \n......\n\n        v33 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e(\n                (int)\u0026std::cout,\n                \"[*] Throw another three for me now, press enter to throw a dice!\");\n\n        v80 = time(0);\n        rand();\n        \n......\n\n        if ( v82 == 3 )  // ç¬¬å››ä¸ªæ˜¯3\n        {\n\n......\n\n          v42 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e(\n                  (int)\u0026std::cout,\n                  \"[*] The last character you need to roll is a seven....  (o_O)  Press enter to throw a dice!\");\n\n          v80 = time(0);\n          \n......\n\n          if ( v82 == 7 )   //ç¬¬äº”ä¸ªæ˜¯7\n          {\n            fctx.call_site = 1;\n            v43 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e(\n                    (int)\u0026std::cout,\n                    \"[*] You rolled a seven, with a six sided dice! How awesome are you?!\");\n\n......\n\n            fctx.call_site = 1;\n            if ( std::string::find((std::string *)\u0026v84, \"ebCTF\", 0) == -1 )\n            {\n              fctx.call_site = 1;\n              v59 = std::ostream::operator\u003c\u003c(\u0026std::cout, std::endl\u003cchar,std::char_traits\u003cchar\u003e\u003e);\n              v60 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e(\n                      v59,\n                      \"[!] It seems you did something wrong :( No flag for you.\");\n              \n......\n\n            }\n            else\n            {\n              v55 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e(\n                      (int)\u0026std::cout,\n                      \"[*] You rolled 3-1-3-3-7, what does that make you? ELEET! \\\\o/\");    //è¿™é‡Œä¹Ÿå¯ä»¥å¾—çŸ¥è¿‡å…³é¡ºåº\n              std::ostream::operator\u003c\u003c(v55, std::endl\u003cchar,std::char_traits\u003cchar\u003e\u003e);\n              v56 = std::operator\u003c\u003c\u003cstd::char_traits\u003cchar\u003e\u003e((int)\u0026std::cout, \"[*] Nice job, here is the flag: \");\n              \n......\n\n            }\n          }\n         \n......\n\n}\n```\n\n## åˆ†æå‡½æ•°\n\n- å‡½æ•°é€šè¿‡ rand() å‡½æ•°äº§ç”Ÿéšæœºæ•°\n- é€šè¿‡éšæœºæ•°æŠ•æ·éª°å­\n- éª°å­çš„é¡ºåºä¸º 3-1-3-3-7 åˆ™è¿‡å…³è¿”å› flag\n\n## è°ƒè¯•ç¨‹åº\n\nä½¿ç”¨ OD è°ƒè¯•ç¨‹åº, è¿™é‡Œå¤ä¹ ä¸€ä¸‹ OD çš„ä½¿ç”¨:\n- é”®å…¥ bp xxx åˆ™åœ¨ xxxä½ç½®ä¸‹æ–­ç‚¹\n- F9 ä¸ºç»§ç»­è¿è¡Œåˆ°æ–­ç‚¹å¤„\n- F8 ä¸ºå•æ­¥æ­¥è¿‡\n- F7 ä¸ºå•æ­¥æ­¥å…¥\n- F4 ä¸ºè¿è¡Œåˆ°å…‰æ ‡å¤„\n- F2 ä¸ºåœ¨å…‰æ ‡ä½ç½®åˆ‡æ¢æ–­ç‚¹\n- åŒå‡»æ±‡ç¼–æŒ‡ä»¤æˆ–æŒ‰ç©ºæ ¼å¯ä¿®æ”¹æŒ‡ä»¤\n- åŒå‡»å¯„å­˜å™¨å¯ä¿®æ”¹å¯„å­˜å™¨æ•°æ®\n- åŒå‡»æ ˆåç©ºæ ¼å¯ä¿®æ”¹æ ˆä¸­æ•°æ®\n\n### ä¿®æ”¹å¯„å­˜å™¨å°è¯•è¿‡å…³\n\nå› ä¸ºæ¯æ¬¡éƒ½æ˜¯éšæœºäº§ç”Ÿæ•°å­—, è€Œä¸”å°†å¤„ç†å®Œçš„æ•°æ®ä¿å­˜åœ¨ `EAX` å¯„å­˜å™¨ç”¨äºæŠ•æ·éª°å­, é‚£ä¹ˆå¯ä»¥ä¿®æ”¹ `EAX` å†…å®¹æ¥å®ç°ç²¾å‡†æŠ•æ·.  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220918204747.png]]\n\n- å°† EAX çš„æ•°å­—åˆ†åˆ«ä¿®æ”¹ä¸º 3, 1, 3, 3, æ“ä½œé‡å¤ 4 æ¬¡å³å¯\n- æ­¤æ—¶å‘ç°, ç¬¬äº”ä¸ª 7 ä¸æ˜¯é€šè¿‡å¯„å­˜å™¨æ¥å–å€¼çš„, è€Œæ˜¯é€šè¿‡æ ˆå–å€¼\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220918204801.png]]\n\n- è§‚å¯Ÿåç»­ä»£ç , å‘ç°æœ‰å¤§é‡å¯¹æ ˆ [ebp-0x5c] ä½ç½®çš„ cmp (æ¯”è¾ƒ) æ“ä½œ\n- å¯ä»¥å¤§èƒ†çŒœæµ‹ç¨‹åºç”¨ 7 å¯¹ [ebp-0x5c] æ¯”è¾ƒ, çœŸåˆ™æŠ•æ·å‡º 7 ç‚¹\n- æ­¤æ—¶çš„ ebp ä¸º `0028FEC8`\n- [ebp-0x5c] åˆ™ä¸º `0028FE6C`\n- ä¿®æ”¹æ­¤å¤„æ ˆå€¼ä¸º 7\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220918204815.png]]\n\nç»§ç»­æ‰§è¡Œç¨‹åº, ç¡®å®æŠ•æ·å‡ºäº† 7 ç‚¹, ä½†æ˜¯ç¨‹åºä¼¼ä¹è¿˜æœ‰ä¸€ä¸ªæ£€æµ‹æœºåˆ¶, é˜»æ­¢äº†æˆ‘ä»¬è·å– flag.  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220918204839.png]]\n\n### åˆ©ç”¨ IDA ä¿®æ”¹ç¨‹åº\n\n#### æ€è·¯\n\n- å›æƒ³ç¨‹åºçš„ä»£ç , è°ƒç”¨çš„ `time()` å‡½æ•°\n- å¤§èƒ†çŒœæµ‹, ç¨‹åºåº”è¯¥æ˜¯åˆ©ç”¨å„å¤„ `time()` è·å–çš„ç³»ç»Ÿæ—¶é—´, æ¥æ£€æµ‹ç¨‹åºæ˜¯ä¸æ˜¯åœ¨è¢«è°ƒè¯•.\n- å› æ­¤, å¯ç”¨ IDA ä¿®æ”¹ç¨‹åºæŒ‡ä»¤, æ¥è®©ç¨‹åºä¸€æ¬¡é€šè¿‡.\n\nåœ¨ OD è°ƒè¯•çš„æ—¶å€™, è®°å½•ä¸‹ 5 æ¬¡æŠ•æ·çš„ä½ç½®:\n\n```\n00401830  --\u003e 3\n00401B6E  --\u003e 1\n00401EAA  --\u003e 3\n004021DA  --\u003e 3\n0040254E  --\u003e 7\n```\n\nIDA ä¸­çš„æ“ä½œ:\n- æŒ‰ G å¯æ‰“å¼€åœ°å€è·³è½¬çª—å£\n- ä¿®æ”¹: Edit -- Patch program -- Change byte...\n- åº”ç”¨ä¿®æ”¹åˆ°æ–‡ä»¶: Edit -- Patch program -- Apply patches to input file...\n- ä¸»è¦è¦ç”¨ 90 (nop) æ¥å¡«å……å‰©ä½™ç©ºé—´ (00ä¹Ÿå¯ä»¥)\n\n#### æ“ä½œç»†èŠ‚\n\n- è¿™é‡Œæˆ‘ä»¬å°†å–å€¼éƒ¨åˆ†çš„æ“ä½œä¿®æ”¹ä¸ºç›´æ¥ä¸º eax èµ‹ç›®æ ‡æ•°å€¼, åŒæ—¶å¯¹ ecx èµ‹å€¼ [ç›®æ ‡æ•°å€¼ - 1] çš„å€¼\n- ç¬¬äº”æ¬¡åˆ™æ˜¯å¯¹ [ebp-0x5c] å¤„èµ‹å€¼ 7\n\nå¯ä»¥åˆ©ç”¨ç½‘ç»œæˆ–å…¶ä»–å·¥å…·, æˆ–è€…æ˜¯ OD (OD å¯ä»¥ç›´æ¥ç¼–è¾‘æ±‡ç¼–ä»£ç , ç„¶åè§‚å¯Ÿå¯¹åº”æœºå™¨ç å³å¯), å¾—åˆ°ç›®æ ‡æœºå™¨ç :  \n\n```\nmov ecx, [num]   --\u003e   B9 [num] 00 00 00\nmov eax, [num]   --\u003e   B8 [num] 00 00 00\nä¾‹å¦‚: mov ecx, 2 --\u003e  B9 02 00 00 00\n\nmov [ebp+var_5C], 7  --\u003e  C7 45 A4 07 00 00 00\n```\n\nå‰ 4 æ¬¡ä¿®æ”¹å‰:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214627.png]]\n\nå‰ 4 æ¬¡ä¿®æ”¹å:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214643.png]]\n\nç¬¬ 5 æ¬¡ä¿®æ”¹å‰:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214657.png]]\n\nç¬¬ 5 æ¬¡ä¿®æ”¹å:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214710.png]]\n\nApply patches to input file åå³å¤§åŠŸå‘Šæˆ.\n\n## æ‰§è¡Œç»“æœ\n\nå€¼å¾—æ³¨æ„çš„æ˜¯, ç¨‹åºæœ€åè¿è¡Œç»“æŸä¼šç›´æ¥å…³é—­, æ‰€ä»¥æˆ‘ä»¬è¦å…ˆæ‰“å¼€ cmd, å†ç”¨ cmd æ‰“å¼€ç¨‹åº:\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917214722.png]]\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-keylead":{"title":"é€†å‘wp-keylead","content":"# é€†å‘wp-keylead\n\n[æ­ç”µ CTF å¹³å°é€†å‘ç¬¬äºŒé¢˜.](http://sec.hdu.edu.cn/question/reverse/5783?sort=default)\n\né¢˜ç›®åœ¨ç½‘ç»œå¯¹åº”ç›®å½•ä¸­: http://gokoucat.ys168.com/\n\n## æ–‡ä»¶åˆ†æ\n\né€šè¿‡åœ¨ lunux ç¯å¢ƒä¸‹, ä½¿ç”¨ `file keylead` å‘ç°æ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶, è§£å‹åå¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶.\n\n```shell\nfile keylead\n\nkeylead: XZ compressed data\n```\n\n## å‡½æ•°åˆ†æ\n\né€šè¿‡å­—ç¬¦ä¸²å®šä½çš„æ–¹æ³•, æ‰¾åˆ°ä¸»å‡½æ•°.\n\n### ä¸»å‡½æ•°\n\n```c\nsigned __int64 __fastcall main(__int64 a1, char **a2, char **a3)\n{\n  unsigned int v3; // eax\n  unsigned int i_rand_n1; // ST14_4\n  signed __int64 result; // rax\n  unsigned int i_rand_n5; // [rsp+4h] [rbp-1Ch]\n  unsigned int i_rand_n4; // [rsp+8h] [rbp-18h]\n  unsigned int i_rand_n3; // [rsp+Ch] [rbp-14h]\n  unsigned int i_rand_n2; // [rsp+10h] [rbp-10h]\n  int start_time; // [rsp+18h] [rbp-8h]\n\n  puts(\"hi all ----------------------\");\n  puts(\"Welcome to dice game!\");\n  puts(\"You have to roll 5 dices and get 3, 1, 3, 3, 7 in order.\");\n  puts(\"Press enter to roll.\");\n  getchar();\n  v3 = time(0LL);\n  srand(v3);\n  start_time = time(0LL);                       // è·å–åŸºå‡†æ—¶é—´\n  i_rand_n1 = rand() % 6 + 1;\n  i_rand_n2 = rand() % 6 + 1;\n  i_rand_n3 = rand() % 6 + 1;\n  i_rand_n4 = rand() % 6 + 1;\n  i_rand_n5 = rand() % 6 + 1;\n  printf(\"You rolled %d, %d, %d, %d, %d.\\n\", i_rand_n1, i_rand_n2, i_rand_n3, i_rand_n4, i_rand_n5);\n  if ( i_rand_n1 != 3 )\n    goto LABEL_20;\n  if ( time(0LL) - start_time \u003e 2 )             // è¶…æ—¶åˆ™å¤±è´¥, ä¼°è®¡æ—¶é˜²è°ƒè¯•çš„æ‰‹æ®µ\n  {\n    puts(\"No cheat!\");\n    return 0xFFFFFFFFLL;\n  }\n  if ( i_rand_n2 != 1 )\n    goto LABEL_20;\n  if ( time(0LL) - start_time \u003e 2 )\n  {\n    puts(\"No cheat!\");\n    return 0xFFFFFFFFLL;\n  }\n  if ( i_rand_n3 != 3 )\n    goto LABEL_20;\n  if ( time(0LL) - start_time \u003e 2 )\n  {\n    puts(\"No cheat!\");\n    return 0xFFFFFFFFLL;\n  }\n  if ( i_rand_n4 != 3 )\n    goto LABEL_20;\n  if ( time(0LL) - start_time \u003e 2 )\n  {\n    puts(\"No cheat!\");\n    return 0xFFFFFFFFLL;\n  }\n  if ( i_rand_n5 != 7 )\n  {\nLABEL_20:\n    puts(\"You DID NOT roll as I said!\");\n    puts(\"Bye bye~\");\n    result = 0xFFFFFFFFLL;\n  }\n  else if ( time(0LL) - start_time \u003c= 2 )\n  {\n    puts(\"You rolled as I said! I'll give you the flag.\");\n    f_cal_flag();                               // è®¡ç®—å¹¶è¿”å›flagçš„å‡½æ•°\n    result = 0LL;\n  }\n  else\n  {\n    puts(\"No cheat!\");\n    result = 0xFFFFFFFFLL;\n  }\n  return result;\n}\n```\n\n- å‡½æ•°é€šè¿‡ `rand()`, éšæœºç”Ÿæˆ 5 ä¸ªæ•°å­—ç”¨äºæŠ•æ·éª°å­\n- æœ‰é˜²è°ƒè¯•ä¿®æ”¹çš„æ‰‹æ®µ\n- ç»“æœä¸º 31337 åˆ™è°ƒç”¨ flag ç”Ÿæˆçš„å‡½æ•° `f_cal_flag()`\n\n### flag ç”Ÿæˆå‡½æ•°\n\nå°è¯•é€šè¿‡å¯¹ flag ç”Ÿæˆå‡½æ•°è¿›è¡Œè¿˜åŸ, å¾—åˆ°flag, å¤åˆ¶ä»£ç åä¿®æ”¹æ‰§è¡Œ:\n\n```c\n#include\u003cstdio.h\u003e\n\nint main(void)\n{\n  int v0; // ST0C_4\n  int v1; // ST08_4\n  int v2; // ST0C_4\n  int v3; // ST0C_4\n  int v4; // ST08_4\n  int v5; // ST0C_4\n  int v6; // ST08_4\n  int v7; // [rsp+8h] [rbp-8h]\n  int v8; // [rsp+8h] [rbp-8h]\n  int i; // [rsp+8h] [rbp-8h]\n  int j; // [rsp+8h] [rbp-8h]\n  int v11; // [rsp+Ch] [rbp-4h]\n  int v12; // [rsp+Ch] [rbp-4h]\n  int v13; // [rsp+Ch] [rbp-4h]\n  int v14; // [rsp+Ch] [rbp-4h]\n  int v15; // [rsp+Ch] [rbp-4h]\n  int v16; // [rsp+Ch] [rbp-4h]\n\n  v11 = 0;\n  v7 = 0;\n  \nchar flag[] = \n{0x41,0x00,0x61,0x00,0x63,0x00,\n 0x62,0x00,0x65,0x00,0x66,0x00,\n 0x49,0x00,0x33,0x00,0x31,0x00,\n 0x30,0x00,0x53,0x00,0x32,0x00,\n 0x37,0x00,0x36,0x00,0x39,0x00,\n 0x38,0x00,0x7b,0x00,0x7d,0x00,};\n  \n  while ( v11 != 1 )\n  {\n    putchar(flag[14 * v11++]);\n    do\n    {\n      while ( v7 \u003c= 1 )\n        putchar(flag[20 * v11 - 8 * v7++]);\n      v1 = v7 + 1;\n      v2 = 3 * v11;\n      putchar(flag[2 * v2 + 11 + v1]);\n      v2 *= 5;\n      v8 = v1 - 1;\n      putchar(flag[2 * v2 + v8]);\n      v12 = v2 / 3;\n      while ( 1 )\n      {\n        while ( 1 )\n        {\nLABEL_12:\n          if ( !v8 )\n          {\n            putchar(flag[2 * v12]);\n            v15 = v12 ^ 2;\n            while ( 2 )\n            {\n              for ( i = 1; i \u003c= 9; ++i )\n                putchar(flag[10 * (i % 2) + 3 + v15]);\n              v13 = v15 + 1;\nLABEL_44:\n              putchar(flag[v13 / 3]);\n              if ( i == 10 )\n              {\n                v13 += 2 * v13 + 13;\n                i = 19;\n                goto LABEL_33;\n              }\n              if ( i == 2 )\n              {\n                i = v13-- + 2;\n                goto LABEL_4;\n              }\n              if ( (unsigned int)(i - 22) \u003c= 0xA )\n              {\n                v14 = v13 - 3;\n                for ( j = i - v14; ; j = 8 )\n                {\nLABEL_58:\n                  putchar(flag[v14 + 1]);\n                  v16 = v14 + 1;\n                  if ( j == 11 )\n                  {\n                    v13 = (v16 + 14) / 2;\n                    i = 11 * (v13 / 6);\n                    goto LABEL_44;\n                  }\n                  if ( j != 13 )\n                    break;\n                  v12 = v16 + 8;\n                  v8 = 2;\nLABEL_51:\n                  while ( 2 )\n                  {\n                    putchar(flag[v12 - 10]);\n                    if ( v8 == v12 )\n                    {\n                      v4 = v8 + 2;\n                      v5 = v12 + 2;\n                      putchar(flag[v5 / 2 + v4 / 5]);\n                      i = v4 / 2;\n                      putchar(flag[i / 5 + v5]);\n                      v13 = v5 + i - 1 + v5;\n                      while ( 1 )\n                      {\nLABEL_33:\n                        putchar(flag[v13 - 19]);\n                        if ( i == 2 )\n                        {\n                          v3 = v13 + 1;\n                          putchar(flag[v3 / 2 - 3]);\n                          v13 = v3 / 5 + 2;\n                          i = 2;\n                          goto LABEL_44;\n                        }\n                        if ( i \u003c= 2 )\n                          break;\n                        if ( i == 10 )\n                        {\n                          v12 = v13 - 31;\n                          v8 = 9;\n                          goto LABEL_51;\n                        }\n                        if ( i != 19 )\n                          goto LABEL_44;\n                        i = 2;\n                      }\n                      if ( i == 1 )\n                      {\n                        v8 = 17;\n                        v12 = v13 % 5 - 17 + v13;\nLABEL_20:\n                        putchar(flag[v12 - v8 + 9]);\n                        v12 += ~v8++;\n                        continue;\n                      }\n                      goto LABEL_44;\n                    }\n                    break;\n                  }\n                  if ( v8 != 9 )\n                  {\n                    if ( v8 != 2 )\n                      goto LABEL_12;\n                    j = 2;\n                    v16 = v12 - 18;\nLABEL_64:\n                    v6 = 9 * j;\n                    putchar(flag[v16 / 2 + v6 + v6 % 10]);\n                    v11 = v16 + 1;\n                    v7 = v6 % 10;\n                    goto LABEL_21;\n                  }\n                  putchar(flag[v12 - 16]);\n                  v14 = v12 / 2;\n                }\n                if ( j == 8 )\n                {\n                  v15 = v16 + 1;\n                  i = 7;\n                  continue;\n                }\n                goto LABEL_64;\n              }\n              goto LABEL_4;\n            }\n          }\n          if ( v8 == 2 )\n            break;\n          if ( v12 == 7 )\n          {\n            putchar(flag[21 - v8]);\n            v13 = 49;\n            i = v8 / 3;\n            goto LABEL_33;\n          }\n          if ( v8 != 3 )\n            goto LABEL_20;\n          putchar(flag[2 * (v12 / 3)]);\n          v13 = v12 / 3;\n          i = 9;\n          do\n          {\n            while ( 1 )\n            {\n              if ( v13 == 10 )\n              {\n                putchar(flag[i + 8]);\n                v14 = 9;\n                j = i + 1;\n                goto LABEL_58;\n              }\n              if ( v13 == 11 )\n              {\n                putchar(flag[i / 7]);\n                v13 = i-- - 11;\n              }\nLABEL_4:\n              if ( i != 9 )\n                break;\n              putchar(flag[v13 * v13 + 7]);\n              v13 = v13 * v13 + 1;\n              i = 10;\n            }\n          }\n          while ( i != 13 );\n          putchar(flag[2 * v13 + 12]);\n          v8 = 3;\n          v12 = 3 * v13;\n        }\n        putchar(flag[3 * v12 + 1]);\n        v0 = v12 * v12;\n        putchar(flag[v0 - 15]);\n        v11 = v0 - 15;\n        v7 = 4;\n        putchar(flag[4]);\nLABEL_21:\n        if ( v7 != 4 )\n          break;\n        putchar(flag[v11 + 6]);\n        v12 = v11 - 3;\n        v8 = 3;\n      }\n    }\n    while ( v7 != 8 );\n    putchar(flag[2 * v11 + 32]);\n  }\n  \n  return 0;\n}\n```\n\næ‰§è¡Œè¿”å›çš„ç»“æœä¸º:  \n\n```\nASIS{1fc1089e328eaf737373737c882ca0b10fcfe6}\n```\n\nçœ‹ä¼¼æ­£ç¡®, ä½†å®é™…ä¸Šæœ‰é”™è¯¯, å¯¹æ¯”ç­”æ¡ˆå¹¶è°ƒè¯•åå‘ç°, 59 è¡Œå¤„å¤šæ¬¡å¾ªç¯, å¯¼è‡´ flag ä¸­ 7373 å¤„å¤šäº†.  \nè¿™ä¸ªé—®é¢˜æš‚æ—¶æ²¡æœ‰æƒ³æ˜ç™½.\n\n## æ–¹æ³•åˆ†æ\n\nåˆ©ç”¨ç¨‹åºå¼€å§‹çš„è°ƒç”¨é€»è¾‘, ç›´æ¥æ‰§è¡Œ flag ç”Ÿæˆå‡½æ•°.\n\n### å®šä½ç¨‹åºèµ·å§‹ä½ç½®\n\nåœ¨å·¦ä¾§å‡½æ•°è¡¨åŒå‡»å®šä½åˆ° start\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215125.png]]\n\n```\nå‚è€ƒ1 [main() å‡½æ•°åœ¨ Linux ä¸Šçš„å¯åŠ¨è¿‡ç¨‹åˆ†æ ](http://gokoucat.cn/2018/10/01/security/reverse/learning/main-function-startup-process-on-linux/)  \nå‚è€ƒ2 [x86-64 æ¡†æ¶ä¸‹çš„å‚æ•°ä¼ é€’](http://gokoucat.cn/2018/10/01/security/reverse/learning/64-calling-convention/)  \n```\n\né€šè¿‡ä¿®æ”¹ `mov     rdi, offset main ; main` æŒ‡ä»¤çš„ç›®æ ‡ä½ç½®, å³å¯æ§åˆ¶ç¨‹åºè·³è½¬åˆ° flag ç”Ÿæˆå‡½æ•°.\n\n### å‡½æ•°ä½ç½®è®°å½•\n\n- `mov     rdi, offset main` åœ¨ `0x4005dd`\n- `f_cal_flag` åœ¨ `0x4006b6`\n\nå› æ­¤åªè¦å°† `mov     rdi, offset main` ä¿®æ”¹ä¸º `mov     rdi, 0x4006b6` å³å¯.  \n\n## è°ƒè¯•\n\n### gdb æ“ä½œå¤ä¹ \n\n- å¼€å§‹è°ƒè¯• `gdb xxx`\n- è®¾ç½®æ–­ç‚¹ `b *0x111111`\n- æŸ¥çœ‹æ–­ç‚¹: `i b`\n- åˆ é™¤æ–­ç‚¹: `d xx`\n- è¿è¡Œ: `r`\n- ç»§ç»­æ‰§è¡Œåˆ°æ–­ç‚¹: `c`\n- æŸ¥çœ‹å¯„å­˜å™¨: `i r` æˆ– `i registers`\n- ä¿®æ”¹å¯„å­˜å™¨å€¼: `set $REGISTER=VALUE`\n\n### å¼€å§‹è°ƒè¯•\n\n```sh\ngdb keylead            ## è¿›å…¥è°ƒè¯•ç¯å¢ƒ\nb *0x4005dd            #è®¾ç½®æ–­ç‚¹\nr                      #è¿è¡Œç¨‹åº\ni r                   #æŸ¥çœ‹å¯„å­˜å™¨çš„å€¼\nn                     #å•æ­¥è¿è¡Œ\ni r                   #æŸ¥çœ‹å¯„å­˜å™¨çš„å€¼\nset $rdi=0x4006b6    #è®¾ç½® rdiå¯„å­˜å™¨çš„å€¼\nc                    #ç»§ç»­è¿è¡Œç¨‹åº\n```\n\nè¿”å›flag: `ASIS{1fc1089e328eaf737c882ca0b10fcfe6}`","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91/writeup/%E9%80%86%E5%90%91wp-reverse02":{"title":"é€†å‘wp-reverse02","content":"# é€†å‘wp-reverse02\n\n[æ­ç”µ CTF å¹³å°é€†å‘ç¬¬ä¸‰é¢˜.](http://sec.hdu.edu.cn/question/reverse/5786?sort=default)  \n\né¢˜ç›®åœ¨ç½‘ç»œå¯¹åº”ç›®å½•ä¸­: http://gokoucat.ys168.com/\n\n## å®šä½å‡½æ•°\nç¨‹åºæ—¶ä¸€ä¸ª win32 çš„çª—å£ç¨‹åº, æŒ‰é’®æ˜¯ç°è‰²çš„.  \nè€å¥—è·¯, æ ¹æ®å­—ç¬¦ä¸²æ¥å®šä½å‡½æ•°.  \n\nè¿™é¢˜å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå†…å®¹æ˜¯ `flag:{NSCTF_md57e0cad17016b0\u003e?45?f7c\u003e0\u003e4a\u003e1c3a0}` çš„å­—ç¬¦ä¸², ç›´æ¥æäº¤é”™è¯¯, çœ‹æ¥æ²¡è¿™ä¹ˆç®€å•.  \n\n### äº¤å‰å¼•ç”¨\n\nå¯¹è¯¥å­—ç¬¦ä¸²çš„äº¤å‰å¼•ç”¨æœ‰ä¸¤å¤„, åˆ†åˆ«åˆ†æå‘ç°å…¶ä¸­ä¸€ä¸ªåº”è¯¥ä¸ºä¸»è¦çš„å‡½æ•°:\n\n```c\nint __thiscall sub_401070(_BYTE *this)\n{\n  int v1; // edx\n  int v2; // esi\n  int result; // eax\n\n  if ( ((unsigned __int8)byte_403028 ^ 7) != *this\n    || ((unsigned __int8)byte_403027 ^ 7) != this[1]\n    || ((unsigned __int8)byte_403026 ^ 7) != this[2]\n    || ((unsigned __int8)byte_403025 ^ 7) != this[3]\n    || ((unsigned __int8)byte_403024 ^ 7) != this[4]\n    || ((unsigned __int8)byte_403023 ^ 7) != this[5]\n    || ((unsigned __int8)byte_403022 ^ 7) != this[6] )\n  {\n    v1 = dword_403380;\n    v2 = dword_403018;\n  }\n  else\n  {\n    v1 = dword_403380 + 2;\n    v2 = dword_403018 - 1;\n    dword_403380 += 2;\n    --dword_403018;\n  }\n  if ( ((unsigned __int8)byte_403021 ^ 0x33) == this[7]\n    \u0026\u0026 ((unsigned __int8)byte_403020 ^ 0x33) == this[8]\n    \u0026\u0026 ((unsigned __int8)byte_40301F ^ 0x33) == this[9]\n    \u0026\u0026 ((unsigned __int8)byte_40301E ^ 0x33) == this[10]\n    \u0026\u0026 ((unsigned __int8)byte_40301D ^ 0x33) == this[11]\n    \u0026\u0026 ((unsigned __int8)byte_40301C ^ 0x33) == this[12] )\n  {\n    --v1;\n    v2 += 2;\n    dword_403380 = v1;\n    dword_403018 = v2;\n  }\n  if ( v2 + v1 == 3 )\n    result = sub_401000();\n  else\n    result = MessageBoxA(0, \"flag:{NSCTF_md57e0cad17016b0\u003e?45?f7c\u003e0\u003e4a\u003e1c3a0}\", \"Flag\", 0);\n  dword_403018 = 1;\n  dword_403380 = 0;\n  return result;\n}\n```\n\nçœ‹æ¥ç¨‹åºæ˜¯å¯¹ä¸€ä¸²å­—ç¬¦ä¸²åšå¼‚æˆ–, ç„¶ååˆ¤æ–­å’Œè¾“å…¥çš„å†…å®¹æ˜¯å¦ä¸€è‡´, ä¸€è‡´åˆ™è¿”å›å¤„ç†è¿‡åçš„çœŸæ­£çš„ flag.\n\n## è§£å¯†\n\nä¼—æ‰€å‘¨çŸ¥, é‡å¤ä¸¤æ¬¡å¼‚æˆ–, å°±æ˜¯åŸç»“æœ, å°†ä¸Šè¿°ä»£ç ä¸­çš„å†…ç½®å­—ç¬¦æ‹·è´å‡ºæ¥, å†ä»¿ç…§å…¶å¼‚æˆ–çš„è¿‡ç¨‹è¿›è¡Œè§£å¯†:\n\n```python\nkey1 = [0x4e, 0x62, 0x57, 0x47, 0x39, 0x3b, 0x32]\nkey2 = [0x6a, 0x58, 0x6a, 0x46, 0x50, 0x4a]\nfor i in key1:\n    print(chr(i ^ 0x7), end=\"\")\nfor j in key2:\n    print(chr(j ^ 0x33), end=\"\")\n\n```\n\nè¾“å‡ºç»“æœä¸º: `IeP@\u003e\u003c5YkYucy`\n\n## ç°è‰²æŒ‰é’®\n\nç¨‹åºçš„æŒ‰é’®æ˜¯ç°è‰²çš„ä¸å¯ç‚¹å‡», ç”¨ç°è‰²æŒ‰é’®å…‹æ˜Ÿç­‰ç¨‹åº, ç ´è§£æŒ‰é’®.\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215523.png]]\n\nå…·ä½“çš„å®ç°è¿‡ç¨‹æœ‰å¾…ç ”ç©¶...  \n\n## è¾“å‡ºç­”æ¡ˆ\n\nè¾“å…¥ä¹‹å‰è§£å¯†çš„ key `IeP@\u003e\u003c5YkYucy` å³å¯:  \n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/é€†å‘/writeup/z-attachments/Pasted image 20220917215533.png]]","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/IoT%E5%AE%89%E5%85%A8/%E5%AE%89%E8%A3%85qemu":{"title":"å®‰è£…qemu","content":"\n# å®‰è£…qemu\n\n```sh\nsudo apt-get install qemu \n#user mode,åŒ…å«qemu-mips-staticï¼Œqemu-mipsel-static,qemu-arm-staticç­‰\nsudo apt-get install qemu-user-static\n#system modeï¼ŒåŒ…å«qemu-system-mipsï¼Œqemu-system-mipsel,qemu-system-armç­‰\nsudo apt-get install qemu-system\n```\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/IoT%E5%AE%89%E5%85%A8/busybox":{"title":"busybox","content":"\n# busybox\n\nä¸€ä¸ªé›†æˆäº†ä¸€ç™¾å¤šä¸ªæœ€å¸¸ç”¨linuxå‘½ä»¤å’Œå·¥å…·çš„è½¯ä»¶ã€‚\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/IoT%E5%AE%89%E5%85%A8/firmadyne":{"title":"firmadyne","content":"\n# firmadyne\n\nFirmadyneæ˜¯ä¸€æ¬¾è‡ªåŠ¨åŒ–å’Œå¯è£å‰ªçš„åµŒå…¥å¼Linuxç³»ç»Ÿå›ºä»¶åˆ†ææ¡†æ¶ã€‚å®ƒæ”¯æŒç³»ç»Ÿå›ºä»¶é€†å‘QEMUåµŒå…¥å¼ç³»ç»Ÿæ¨¡æ‹Ÿæ‰§è¡Œã€‚ä½¿ç”¨å®ƒæ¨¡æ‹Ÿè·¯ç”±å™¨å›ºä»¶æ‰§è¡Œè·¯ç”±å™¨ï¼Œç„¶åå¯ä»¥åŸºäºæ¨¡æ‹Ÿç¯å¢ƒè¿›è¡Œè·¯ç”±å™¨æ¼æ´æŒ–æ˜ã€æ¸—é€æ”»é˜²ã€‚\n\n## ç»„ä»¶\n\n- ä¿®æ”¹è¿‡çš„ä¾¿äºé˜²ç«å¢™ç¨‹åºæ‰§è¡Œçš„kernels (MIPS:Â [v2.6.32](https://github.com/firmadyne/kernel-v2.6.32),Â  Â Â Â ARM:Â [v4.1](https://github.com/firmadyne/kernel-v4.1),Â [v3.10](https://github.com/firmadyne/kernel-v3.10));  \n- ä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„Â [NVRAMÂ library](https://github.com/firmadyne/libnvram)ï¼Œç”¨äºæ¨¡æ‹ŸNVRAMç¡¬ä»¶;  \n- ä¸€ä¸ªå›ºä»¶æå–å™¨ï¼ˆ[extractor](https://github.com/firmadyne/extractor)ï¼‰ï¼ŒÂ ç”¨äºæå–åµŒå…¥å¼firmwareå›ºä»¶çš„filesystemÂ å’Œkernel;  \n- ä¸€ä¸ªå°[console](https://github.com/firmadyne/console)åº”ç”¨ï¼Œç”¨äºå¦å¯ä¸€ä¸ªshellè¿›è¡Œè°ƒè¯•;  \n- ä¸€ä¸ªÂ [scraper](https://github.com/firmadyne/scraper)ï¼Œç”¨äºä¸‹è½½Â firmwareå›ºä»¶ï¼ˆä»Â 42+Â ä¸åŒä¾›åº”å•†ï¼‰\n\n## å‚è€ƒ\n\n[(1æ¡æ¶ˆæ¯) è‡ªåŠ¨åŒ–å›ºä»¶é€†å‘æ¡†æ¶firmadyneä½¿ç”¨è¯¦ç»†æ•™ç¨‹_å­æ›°å°ç–çš„åšå®¢-CSDNåšå®¢_firmadyneå®‰è£…](https://blog.csdn.net/wxh0000mm/article/details/108443293)\n[firmadyne/firmadyne: Platform for emulation and dynamic analysis of Linux-based firmware (github.com)](https://github.com/firmadyne/firmadyne)\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/IoT%E5%AE%89%E5%85%A8/qemu%E8%BF%90%E8%A1%8Cmips%E7%A8%8B%E5%BA%8F":{"title":"qemuè¿è¡Œmipsç¨‹åº","content":"\n# qemuè¿è¡Œmipsç¨‹åº\n\n1. [[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/IoTå®‰å…¨/å®‰è£…qemu|å®‰è£…qemu]]\n2. æ‹·è´[[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/IoTå®‰å…¨/qemu-user-static|qemu-user-static]]åˆ°ç›®æ ‡ç›®å½•ä¸‹ï¼š`cp /usr/bin/qemu-mips-static ./`ã€‚\n3. è¿è¡Œmipsç¨‹åº(å…¶ä¸­./bin/busyboxä¸ºè¦æ‰§è¡Œçš„busybox)ï¼š`sudo chroot . ./qemu-mips-static ./bin/busybox`ã€‚\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/IoT%E5%AE%89%E5%85%A8/qemu-user-static":{"title":"qemu-user-static","content":"\n# qemu-user-static\n\nä¸€ä¸ªç”¨äºåˆ©ç”¨å½“å‰æ“ä½œç³»ç»Ÿæ¥è¿è¡Œå…¶å®ƒæ¶æ„çš„ä¸€ä¸ªä»¿çœŸå™¨ã€‚\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/IoT%E5%AE%89%E5%85%A8/squashfs":{"title":"squashfs","content":"\n# squashfs\n\nsquashfs æ˜¯ä¸€ä¸ªé«˜åº¦å‹ç¼©çš„åªè¯»æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯ä»¥å°†é«˜è¾¾ 2-3GB çš„æ•°æ®å‹ç¼©åˆ°ä¸€ä¸ªåªæœ‰ 700M çš„æ–‡ä»¶ä¸­ã€‚å½“ä¸€ä¸ª Live CD å¯åŠ¨æ—¶ï¼Œå®ƒå°†åŠ è½½æ•´ä¸ª Linux ç³»ç»Ÿç¯å¢ƒã€‚Live CD æ‰€ä½¿ç”¨çš„æ­£æ˜¯è¿™ç§é«˜åº¦å‹ç¼©çš„åªè¯» squashfs æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä¸­çš„ root æ–‡ä»¶ç³»ç»Ÿå°±è¢«å‹ç¼©å­˜æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿä¹‹ä¸­ã€‚\n\n\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/IoT%E5%AE%89%E5%85%A8/ubuntu2004%E4%B8%8B%E5%AE%89%E8%A3%85%E7%89%A9%E8%81%94%E7%BD%91%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E5%8C%85":{"title":"ubuntu2004ä¸‹å®‰è£…ç‰©è”ç½‘å›ºä»¶åˆ†æå·¥å…·åŒ…","content":"\n# ubuntu2004ä¸‹å®‰è£…ç‰©è”ç½‘å›ºä»¶åˆ†æå·¥å…·åŒ…\n\n## åŸºç¡€ç¯å¢ƒ\n\nç³»ç»Ÿï¼šubuntu2004 64ä½ã€‚\nä»£ç†å·¥å…·ï¼šproxychains4ã€‚\nå®¿ä¸»æœºç½‘ç»œåŠ é€Ÿè½¯ä»¶å¼€æ”¾ç«¯å£ç”¨äºç»™è™šæ‹Ÿæœºä»£ç†ã€‚\n\n## å®‰è£…æµç¨‹\n\n1. å®‰è£…ä»£ç†å·¥å…·ï¼š`sudo apt install proxychains4`ã€‚\n2. é…ç½®ä»£ç†ï¼š`sudo vim /etc/proxychains4.conf`ï¼Œå°†æœ€åçš„ä»£ç†æœåŠ¡å™¨åœ°å€æ¢æˆ`socks5 å®¿ä¸»æœºIp ä»£ç†ç«¯å£`\n3. å…‹éš†è‡ªåŠ¨åŒ–åˆ†æå·¥å…·åŒ…è„šæœ¬é¡¹ç›®ï¼š`git clone --recursive https://github.com/attify/firmware-analysis-toolkit.git`ã€‚\n4. æ‰‹åŠ¨å®‰è£…binwalkã€‚\n5. æ‰‹åŠ¨[[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/IoTå®‰å…¨/å®‰è£…qemu|å®‰è£…qemu]]ã€‚\n6. æ‰‹åŠ¨å®‰è£…[[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/äºŒè¿›åˆ¶å®‰å…¨/IoTå®‰å…¨/firmadyne|firmadyne]]ã€‚\n7. å®‰è£…firmware-analysis-toolkitå‰©ä½™éƒ¨åˆ†ã€‚\n\n## å‚è€ƒ\n\n[è·¯ç”±å™¨å›ºä»¶æ¨¡æ‹Ÿç¯å¢ƒæ­å»º(è¶…è¯¦ç»†)_Tig3rHuçš„åšå®¢-CSDNåšå®¢_è·¯ç”±å™¨ç¯å¢ƒæ­å»º](https://blog.csdn.net/wuyou1995/article/details/105545581?spm=1001.2014.3001.5502)\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/pwn/%E6%A0%88%E8%BF%81%E7%A7%BB":{"title":"æ ˆè¿ç§»","content":"# æ ˆè¿ç§»\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/pwn/%E9%92%88%E5%AF%B9%E5%BB%B6%E8%BF%9F%E7%BB%91%E5%AE%9A%E7%9A%84%E6%94%BB%E5%87%BB":{"title":"é’ˆå¯¹å»¶è¿Ÿç»‘å®šçš„æ”»å‡»","content":"\n# é’ˆå¯¹å»¶è¿Ÿç»‘å®šçš„æ”»å‡»\n\n\u003e Â 2015 å¹´çš„è®ºæ–‡ â€œHow the [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ELF|ELF]] Ruined Christmasâ€ ä¸­æå‡ºçš„ã€‚\n\nå¼ºè¿«åŠ¨æ€è£…è½½å™¨è§£æè¯·æ±‚çš„å‡½æ•°ã€‚\n\n![[z-oblib/z2-attachments/Pasted image 20220911020331.png]]\n![[z-oblib/z2-attachments/Pasted image 20220911020936.png]]\n\n\n- å›¾aä¸­ï¼Œå› ä¸ºåŠ¨æ€è½¬è½½å™¨æ˜¯ä»Â `.dynamic`Â æ®µçš„Â `DT_STRTAB`Â æ¡ç›®ä¸­è·å¾—Â `.dynstr`Â æ®µçš„åœ°å€çš„ï¼Œè€ŒÂ `DT_STRTAB`Â æ¡ç›®çš„ä½ç½®å·²çŸ¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¹Ÿå¯å†™ã€‚æ‰€ä»¥æ”»å‡»è€…èƒ½å¤Ÿæ”¹å†™Â `DT_STRTAB`Â æ¡ç›®çš„å†…å®¹ï¼Œæ¬ºéª—åŠ¨æ€è£…è½½å™¨ï¼Œè®©å®ƒä»¥ä¸ºÂ `.dynstr`Â æ®µåœ¨Â `.bss`Â æ®µä¸­ï¼Œå¹¶åœ¨é‚£é‡Œä¼ªé€ ä¸€ä¸ªå‡çš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/å­—ç¬¦ä¸²è¡¨|å­—ç¬¦ä¸²è¡¨]]ã€‚å½“å®ƒå°è¯•è§£æ printf æ—¶ä¼šä½¿ç”¨ä¸åŒçš„[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/åŸºåœ°å€|åŸºåœ°å€]]æ¥å¯»æ‰¾å‡½æ•°åï¼Œæœ€ç»ˆæ‰§è¡Œçš„æ˜¯ execveã€‚è¿™ç§æ–¹å¼éå¸¸ç®€å•ï¼Œä½†ä»…å½“äºŒè¿›åˆ¶ç¨‹åºçš„Â `.dynamic`Â æ®µå¯å†™æ—¶æœ‰æ•ˆã€‚\n- å›¾bä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“Â [[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/_dl_runtime_resolve|_dl_runtime_resolve]]Â çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ Elf_Rel æ¡ç›®åœ¨Â `.rel.plt`Â æ®µä¸­çš„åç§»ï¼ŒåŠ¨æ€è£…è½½å™¨å°†è¿™ä¸ªå€¼åŠ ä¸ŠÂ `.rel.plt`Â çš„åŸºå€æ¥å¾—åˆ°ç›®æ ‡ç»“æ„ä½“çš„ç»å¯¹ä½ç½®ã€‚ç„¶åå½“ä¼ é€’ç»™Â `_dl_runtime_resolve`Â çš„å‚æ•°Â `reloc_index`Â è¶…å‡ºäº†Â `.rel.plt`Â æ®µï¼Œå¹¶æœ€ç»ˆè½åœ¨Â `.bss`Â æ®µä¸­æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨è¯¥ä½ç½®ä¼ªé€ äº†ä¸€ä¸ªÂ `Elf_Rel`Â ç»“æ„ï¼Œå¹¶å¡«å†™Â `r_offset`Â çš„å€¼ä¸ºä¸€ä¸ªå¯å†™çš„å†…å­˜åœ°å€æ¥å°†è§£æåçš„å‡½æ•°åœ°å€å†™åœ¨é‚£é‡Œï¼ŒåŒç†Â `r_info`Â ä¹Ÿä¼šæ˜¯ä¸€ä¸ªå°†åŠ¨æ€è£…è½½å™¨å¯¼å‘åˆ°æ”»å‡»è€…æ§åˆ¶å†…å­˜çš„ä¸‹æ ‡ã€‚è¿™ä¸ªä¸‹æ ‡å°±æŒ‡å‘ä¸€ä¸ªä½äºå®ƒåé¢çš„Â `Elf_Sym`Â ç»“æ„ï¼Œè€ŒÂ `Elf_Sym`Â ç»“æ„ä¸­çš„Â `st_name`Â åŒæ ·è¶…å‡ºäº†Â `.dynsym`Â æ®µã€‚è¿™æ ·è¿™ä¸ªç¬¦å·å°±ä¼šåŒ…å«ä¸€ä¸ªç›¸å¯¹äºÂ `.dynstr`Â åœ°å€è¶³å¤Ÿå¤§çš„åç§»ä½¿å…¶èƒ½å¤Ÿè¾¾åˆ°è¿™ä¸ªç¬¦å·ä¹‹åçš„ä¸€æ®µå†…å­˜ï¼Œè€Œé‚£æ®µå†…å­˜é‡Œä¿å­˜ç€è¿™ä¸ªå°†è¦è°ƒç”¨çš„å‡½æ•°çš„åç§°ã€‚\n- è¿˜è®°å¾—æˆ‘ä»¬å‰é¢è¯´è¿‡çš„ GOT[1]ï¼Œå®ƒæ˜¯ä¸€ä¸ª link_map ç±»å‹çš„æŒ‡é’ˆï¼Œå…¶Â `l_info`Â åŸŸä¸­æœ‰ä¸€ä¸ªåŒ…å«Â `.dynmic`Â æ®µä¸­æ‰€æœ‰æ¡ç›®æ„æˆçš„æ•°ç»„ã€‚åŠ¨æ€é“¾æ¥å™¨å°±æ˜¯åˆ©ç”¨è¿™äº›æŒ‡é’ˆæ¥å®šä½[[3-è®¡ç®—æœºç§‘å­¦/3-æ“ä½œç³»ç»Ÿ/Linux/ç¬¦å·è§£æ|ç¬¦å·è§£æ]]è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å¯¹è±¡çš„ã€‚é€šè¿‡è¦†ç›–è¿™ä¸ª link_map çš„ä¸€éƒ¨åˆ†ï¼Œå°±èƒ½å¤Ÿå°†Â `l_info`Â åŸŸä¸­çš„Â `DT_STRTAB`Â æ¡ç›®æŒ‡å‘ä¸€ä¸ªç‰¹æ„åˆ¶é€ çš„åŠ¨æ€æ¡ç›®ï¼Œé‚£é‡Œåˆ™æŒ‡å‘ä¸€ä¸ªå‡çš„åŠ¨æ€å­—ç¬¦ä¸²è¡¨ã€‚\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/pwn/ubuntu%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE":{"title":"ubuntuç¯å¢ƒé…ç½®","content":"\n# ubuntuç¯å¢ƒé…ç½®\n\n```sh\n# aptæ¢æº\nsudo cp -a /etc/apt/sources.list /etc/apt/sources.list.bak\nsudo sed -i \"s@http://.*archive.ubuntu.com@http://repo.huaweicloud.com@g\" /etc/apt/sources.list  \nsudo sed -i \"s@http://.*security.ubuntu.com@http://repo.huaweicloud.com@g\" /etc/apt/sources.list\nsudo apt update\n\n# pip æ¢æº\npip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\n\nsudo apt-get install git\n# gitå¯ç”¨å®¿ä¸»æœºä»£ç†\ngit config --global https.proxy socks5://192.168.204.1:1080\ngit config --global https.proxy socks5://192.168.204.1:1080\n#git config --global --unset http.proxy\n#git config --global --unset https.proxy\n\nsudo apt-get update\n# sudo apt-get install python2.7-dev python-pip -y\npip install pwntools\n# echo 'export PATH=/usr/local/mongodb/bin:$PATH \u003e\u003e ~/.bashrc'\nsudo apt-get install libcapstone-dev -y\n\n# wpndbg é€‚åˆpwn\ncd ~/\ngit clone https://github.com/pwndbg/pwndbg\ncd pwndbg\n./setup.sh\ncd ~/\ngit clone https://github.com/scwuaptx/Pwngdb.git\ncp ~/Pwngdb/.gdbinit ~/\n\n# peda é€‚åˆé€†å‘\ngit clone https://github.com/longld/peda.git ~/peda\necho \"source ~/peda/peda.py\" \u003e\u003e ~/.gdbinit\n\n# if not install pwndbg \u0026 pwngdb ? use howdays gdb\n# wget http://howdays.kr/public/gdb/setupdbg.sh\n# chmod 777 setupdbg.sh\n# ./setupdbg.sh\n\n# zsh\nsudo apt-get install zsh -y\nsudo chsh -s /usr/bin/zsh\nsudo sh -c \"$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)\"\ngit clone https://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions\n# ADD ~/.zshrc -\u003e (zsh-autosuggestions)\nsource ~/.zshrc\n\nsudo apt install ruby-full -y\ngem install one_gadget\n\nsudo pip install ropgadget -y\n\n# pwnç«¯å£è½¬å‘æœ¬åœ°éƒ¨ç½²å·¥å…·\nsudo apt-get install socat\n\n# 32ä½ç¯å¢ƒ\nsudo apt-get update  \nsudo apt-get purge libc6-dev  \nsudo apt-get install libc6-dev  \nsudo apt-get install libc6-dev-i386\n\n# sudo dpkg --add-architecture i386\n# sudo apt-get install libc6:i386 libncurses5:i386 libstdc++6:i386 -y\n\n# z3\nsudo apt-get install z3\ngit clone https://github.com/Z3Prover/z3.git\ncd z3\ncd build\nmake\nsudo make install\n```\n\n## gdbæ’ä»¶åˆ‡æ¢\n\n```sh\n# åˆ‡æ¢è„šæœ¬\ntouch ~/.local/bin/gdbplugin\ncat \u003e ~/.local/bin/gdbplugin \u003c\u003c \\EOF\n#!/bin/bash\nfunction Mode_change {\n    name=$1\n    gdbinitfile=~/.gdbinit    #è¿™ä¸ªè·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹\n    peda=\"source ~/peda/peda.py\"   #è¿™ä¸ªè·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹\n    gef=\"source ~/.gdbinit-gef.py\"  #è¿™ä¸ªè·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹\n    pwndbg=\"source ~/Downloads/pwndbg/gdbinit.py\"\n\n    sign=$(cat $gdbinitfile | grep -n \"#this place is controled by user's shell\")\n           #æ­¤å¤„ä¸Šé¢çš„æŸ¥æ‰¾å†…å®¹è¦å’Œä½ è‡ªå·±çš„ä¿æŒä¸€è‡´\n\n    pattern=\":#this place is controled by user's shell\"\n    number=${sign%$pattern}\n    location=$[number+2]\n\n    parameter_add=${location}i\n    parameter_del=${location}d\n\n    message=\"TEST\"\n\n    if [ $name -eq \"1\" ];then\n        sed -i \"$parameter_del\" $gdbinitfile\n        sed -i \"$parameter_add $peda\" $gdbinitfile\n        echo -e \"Please enjoy the peda!\\n\"\n    elif [ $name -eq \"2\" ];then\n        echo -e \"Please enjoy the gef!\\n\"\n        else\n        sed -i \"$parameter_del\" $gdbinitfile\n        sed -i \"$parameter_add $pwndbg\" $gdbinitfile\n        echo -e \"Please enjoy the pwndbg!\\n\"\n    fi\n\n}\n\necho -e \"Please choose one mode of GDB?\\n1.peda    2.gef    3.pwndbg\"\n\nread -p \"Input your choice:\" num\n\nif [ $num -eq \"1\" ];then\n    Mode_change $num\nelif [ $num -eq \"2\" ];then\n    Mode_change $num\nelif [ $num -eq \"3\" ];then\n    Mode_change $num\nelse\n    echo -e \"Error!\\nPleasse input right number!\"\nfi\n\ngdb $1 $2 $3 $4 $5 $6 $7 $8 $9\n\nEOF\n\nsudo chmod +x ~/.local/bin/gdbplugin\n```\n","lastmodified":"2023-01-23T15:37:51.77868077Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/suricata/%E5%85%A8%E5%B1%80%E5%91%8A%E8%AD%A6%E9%98%88%E5%80%BC":{"title":"å…¨å±€å‘Šè­¦é˜ˆå€¼","content":"\n# å…¨å±€å‘Šè­¦é˜ˆå€¼\n\n## threshold\n\nè¦†ç›–è§„åˆ™è­¦æŠ¥é¢‘ç‡ã€‚\n\n### è¯­æ³•\n\n```sh\nthreshold gen_id \u003cgid\u003e, sig_id \u003csid\u003e, type \u003cthreshold|limit|both\u003e, track \u003cby_src|by_dst|by_rule|by_both\u003e, count \u003cN\u003e, seconds \u003cT\u003e\n```\n\n- thresholdï¼šè§„åˆ™å°†åœ¨åŒ¹é…ç¬¬næ¬¡æ—¶å¼€å§‹åŠ¨ä½œã€‚\n- limitï¼šåœ¨äº‹ä»¶å‘¨æœŸå†…æœ€å¤šå‘å‡ºnæ¬¡è­¦æŠ¥ã€‚\n- bothï¼šè®¾å®šçš„countå’ŒsecondsåŒæ—¶åº”ç”¨äºä¸Šé¢ä¸¤ä¸ªè®¾ç½®ã€‚\n\n## rate_filter\n\nè¿‡æ»¤å™¨åœ¨è§„åˆ™åŒ¹é…æ—¶æ”¹å˜å¯¹åº”è§„åˆ™æ“ä½œã€‚\n\n### è¯­æ³•\n\n```\nrate_filter: rate_filter gen_id \u003cgid\u003e, sig_id \u003csid\u003e, track \u003ctracker\u003e, count \u003cc\u003e, seconds \u003cs\u003e, new_action \u003caction\u003e, timeout \u003ctimeout\u003e\n```\n\n- gen_idï¼šé»˜è®¤å€¼1ï¼Œå¦‚æœruleä¸­é€šè¿‡genå…³é”®å­—è®¾ç½®è¿‡äº†ï¼Œåˆ™åº”è¯¥ä¸ºå¯¹åº”å€¼ã€‚\n- sig_idï¼šè§„åˆ™idï¼Œruleä¸­ç”¨sidå…³é”®è¯è®¾ç½®ã€‚\n- trackï¼š\n    - `by_src` å’Œ `by_dst` æ˜¯å¦è¾¾åˆ°é˜ˆå€¼æŒ‰ç…§ipåœ°å€åˆ†å¼€è®¡ç®—ã€‚\n    - `by_rule` æ˜¯å¦è¾¾åˆ°é˜ˆå€¼å…¨å±€è®¡ç®—ã€‚\n- countï¼šrate_filterå¯åŠ¨å‰ç›®æ ‡ruleè¢«åŒ¹é…çš„æ¬¡æ•°ã€‚\n- secondsï¼šcountçš„ç»Ÿè®¡å‘¨æœŸï¼Œåœ¨secondsè®¾å®šçš„å‘¨æœŸå†…è®¡æ•°å€¼è¾¾åˆ°countå­—æ®µè®¾ç½®å€¼ï¼Œåˆ™å¯åŠ¨rate_filterã€‚\n- new_actionï¼šrate_filterè¢«è§¦å‘æ—¶åº”ç”¨çš„åŠ¨ä½œã€‚\n    - alert\n    - drop\n    - pass\n    - reject\n- timeoutï¼šrate_filteræ¯ä¸€æ¬¡çš„æ´»åŠ¨ç§’æ•°ã€‚\n\n### ç”¨ä¾‹\n\nå¯¹sshç«¯å£çš„è¿æ¥å‘Šè­¦ï¼ŒæŸä¸€ipåœ¨1åˆ†é’Ÿå†…è¿æ¥è¶…è¿‡10æ¬¡ï¼Œåˆ™åœ¨æ¥ä¸‹æ¥5åˆ†é’Ÿå†…åŠ¨ä½œalertæ”¹ä¸ºdropä¸¢å¼ƒæ•°æ®åŒ…ã€‚\n\nRule:\n\n```\nalert tcp any any -\u003e $MY_SSH_SERVER 22 (msg:\"Connection to SSH server\"; flow:to_server; flags:S,12; sid:888;)\n```\n\nRate filter:\n\n```\nrate_filter gen_id 1, sig_id 888, track by_src, count 10, seconds 60,  new_action drop, timeout 300\n```\n\n## suppress\n\næŠ‘åˆ¶å™¨åœ¨è§„åˆ™åŒ¹é…æ—¶ï¼ŒæŠ‘åˆ¶é’ˆå¯¹è§„åˆ™æˆ–è€…ç½‘ç»œçš„å‘Šè­¦äº§ç”Ÿï¼Œä½†flowbitç­‰åŠ¨ä½œä»ç„¶ä¼šæ‰§è¡Œã€‚\n\n### è¯­æ³•\n\n```\nsuppress gen_id \u003cgid\u003e, sig_id \u003csid\u003e\nsuppress gen_id \u003cgid\u003e, sig_id \u003csid\u003e, track \u003cby_src|by_dst|by_either\u003e, ip \u003cip|subnet|addressvar\u003e\n```\n\n### ç”¨ä¾‹\n\nè§„åˆ™2002087ä¸å†å¯¹209.132.180.67èµ·ååº”\n\n```sh\nsuppress gen_id 1, sig_id 2002087, track by_src, ip 209.132.180.67\n```\n\n```sh\nsuppress gen_id 1, sig_id 2003614, track by_src, ip 217.110.97.128/25\nsuppress gen_id 1, sig_id 2003614, track by_src, ip [192.168.0.0/16,10.0.0.0/8,172.16.0.0/12]\nsuppress gen_id 1, sig_id 2003614, track by_src, ip $HOME_NET\nsuppress gen_id 1, sig_id 2003614, track by_either, ip 217.110.97.128/25\n```\n\næœ€åä¸€æ¡è¡¨ç¤ºæºåœ°å€æˆ–ç›®çš„åœ°å€åŒ¹é…217.110.97.128/25å°±æŠ‘åˆ¶ã€‚\n\n## ruleé˜ˆå€¼å’Œå…¨å±€é˜ˆå€¼\n\n### rule\n\n```sh\nalert tcp any any -\u003e any 25 (msg:\"ET POLICY Inbound Frequent Emails - Possible Spambot Inbound\"; \\\n     flow:established; content:\"mail from|3a|\"; nocase;                                          \\\n     threshold: type threshold, track by_src, count 10, seconds 60;                              \\\n     reference:url,doc.emergingthreats.net/2002087; classtype:misc-activity; sid:2002087; rev:10;)\n```\n\n60ç§’å†…åŒ¹é…10æ¬¡æ‰ä¼šè§¦å‘alertåŠ¨ä½œã€‚\n\n### å…¨å±€\n\nsuppresså¯ä»¥åº”ç”¨äºå¸¦æœ‰threshold/detection_filtersçš„è§„åˆ™ã€‚\n\n```sh\nsuppress gen_id 1, sig_id 2002087, track by_src, ip 209.132.180.67\nsuppress gen_id 0, sig_id 0, track by_src, ip 209.132.180.67\nsuppress gen_id 1, sig_id 0, track by_src, ip 209.132.180.67\n```\n\nä¸‹é¢è¿™å¥è¯ä¼šè¦†ç›–ä¸Šé¢çš„è§„åˆ™ï¼Œä½¿å¾—é•¿æœŸä¸ä¼šè§¦å‘alertåŠ¨ä½œï¼š\n\n```sh\nsuppress gen_id 1, sig_id 2002087\n```\n\n### ### Threshold/event_filter\n\nå…¨å±€è®¾ç½®çš„thresholds and event_filtersä¼šè¦†ç›–æ‰ruleä¸Šçš„è®¾ç½®ï¼Œå¸¸ç”¨äºé»˜è®¤è§„åˆ™ä¸é€‚ç”¨å½“å‰ç¯å¢ƒæ—¶å¯¹è¯¥è§„é¿è¿›è¡Œé‡æ–°è®¾ç½®ã€‚\n\n```sh\nthreshold gen_id 1, sig_id 2002087, type both, track by_src, count 3, seconds 5\nthreshold gen_id 1, sig_id 2002087, type threshold, track by_src, count 10, seconds 60\nthreshold gen_id 1, sig_id 2002087, type limit, track by_src, count 1, seconds 15\n```\n\nä¸Šè¿°æ¯ä¸€æ¡éƒ½ä¼šç”¨æ–°çš„thresholdå€¼æ›¿ä»£2002087 ruleä¸Šçš„è®¾ç½®ã€‚\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/suricata/%E5%91%8A%E8%AD%A6%E9%98%88%E5%80%BC":{"title":"å‘Šè­¦é˜ˆå€¼","content":"\n# å‘Šè­¦é˜ˆå€¼\n\n## threshold\n\n```shell\nthreshold: type \u003cthreshold|limit|both\u003e, track \u003cby_src|by_dst|by_rule|by_both\u003e, count \u003cN\u003e, seconds \u003cT\u003e\n```\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/suricata/suricata%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6":{"title":"suricataé…ç½®æ–‡ä»¶","content":"\n# suricataé…ç½®æ–‡ä»¶\n\n","lastmodified":"2023-01-23T15:37:51.806681024Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/7-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%AF%94%E8%B5%9Bwp/2023%E5%86%ACHWS":{"title":"2023å†¬HWS","content":"\n# 2023å†¬HWS\n\n## babyre\n\napkæ‹–å…¥jebåˆ†æï¼Œå…¥å£ç‚¹æ‰¾åˆ°check()å‡½æ•°ï¼Œä¸€ä¸ªç®€å•åŠ å¯†+base64ä½†æ˜¯æ— æ³•è§£å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/æ¯”èµ›wp/z-attachments/Pasted image 20230109025910.png]]\n\nå‘ç°ç±»bä¸­æœ‰åŠ¨æ€æ³¨å…¥ï¼Œåˆ†æä»£ç å‘ç°ä¼šè¯»å–Assetsçš„encæ–‡ä»¶ï¼Œå¼‚æˆ–åç”Ÿæˆclasses.dexæ–‡ä»¶:\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/æ¯”èµ›wp/z-attachments/Pasted image 20230109025921.png]]\n\næ›¿æ¢check()å‡½æ•°ï¼ŒæŒ‰ç…§æµç¨‹æå–å‡ºæ–‡ä»¶åé€†å‘ï¼š\n\n![[3-è®¡ç®—æœºç§‘å­¦/7-ç½‘ç»œå®‰å…¨/æ¯”èµ›wp/z-attachments/Pasted image 20230109025933.png]]\n\næ˜¯ä¸€ä¸ªAESåŠ å¯†ï¼Œå†base64åŠ å¯†ï¼Œé€†å‘è¿ç®—å°±èƒ½å¾—åˆ°ç»“æœã€‚\n\n### ä»£ç \n\n```java\nimport javax.crypto.Cipher;\nimport javax.crypto.spec.IvParameterSpec;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.io.*;\nimport java.nio.charset.StandardCharsets;\nimport java.util.*;\n\npublic class Test1 {\n    static void getFile() {\n        File inFile = new File(\"enc\");\n        File outFile = new File(\"classes.dex\");\n        byte[] encBytes;\n        try (InputStream inputStream = new FileInputStream(inFile)) {\n            encBytes = new byte[inputStream.available()];\n            inputStream.read(encBytes);\n            for (int i=0; i\u003cencBytes.length; ++i) {\n                encBytes[i] = (byte)(encBytes[i] ^ 52);\n            }\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n\n        try (FileOutputStream fileOutputStream = new FileOutputStream(outFile)) {\n            fileOutputStream.write(encBytes);\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n    }\n\n    static String encode(String input) throws Exception {\n        Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");\n        cipher.init(Cipher.ENCRYPT_MODE, new SecretKeySpec(\"FV8aOaQiak6txP09\".getBytes(StandardCharsets.UTF_8), \"AES\"), new IvParameterSpec(\"2Aq7SR5268ZzbouE\".getBytes()));\n        return Base64.getEncoder().encodeToString(cipher.doFinal(input.getBytes()));\n    }\n\n    static String decode(String input) throws Exception {\n        byte[] base64decodedBytes = Base64.getDecoder().decode(input);\n        Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");\n        cipher.init(Cipher.DECRYPT_MODE, new SecretKeySpec(\"FV8aOaQiak6txP09\".getBytes(StandardCharsets.UTF_8), \"AES\"), new IvParameterSpec(\"2Aq7SR5268ZzbouE\".getBytes()));\n        byte[] resultBytes = cipher.doFinal(base64decodedBytes);\n        return new String(resultBytes);\n    }\n\n    public static void main(String[] args) throws Exception {\n        getFile();\n        System.out.println(decode(\"9Kz3YlSdD3lB9KoxeKxXQT4YOEqJTVIuNU+IjW4iFQzjpU+NikF/UqCOsL+1g4eA\"));\n    }\n}\n```\n\n## Numbers Game\n\npythonçš„éšæœºbytesè¶…è¿‡32ä½å®é™…ä¸Šæ˜¯å¤šæ¬¡è°ƒç”¨`random.getrandbits(32)`ï¼Œä¾‹å¦‚é¢˜ç›®ä¸­çš„`random.getrandbits(128)`åˆ™æ˜¯è°ƒç”¨4æ¬¡`random.getrandbits(32)`ã€‚\n\né¢˜ç›®ç»™äº†624ç»„32bytesçš„éšæœºæ•°ç»“æœï¼Œæ­£å¥½æ˜¯pythoné‡‡ç”¨çš„éšæœºç®—æ³•MT19937çš„ç©ºé—´å¤§å°ï¼Œé€šè¿‡å·²ç»äº§ç”Ÿ624ç»„éšæœºæ•°é¢„æµ‹ä¹‹åäº§ç”Ÿçš„éšæœºæ•°ã€‚\n\nä½†æ˜¯é¢˜ç›®æŒ–ç©ºçš„æ˜¯å‰12ç»„32ä½éšæœºæ•°ï¼Œéœ€è¦é€šè¿‡é€†å‘twistè¿‡ç¨‹æ¥ç”±åé¢çš„stateæ¨å¯¼å‰é¢çš„stateã€‚\n\nåˆ™é¦–å…ˆè®¡ç®—åé¢çš„stateï¼Œå†é€šè¿‡é€†å‘çš„twistç®—æ³•æ¥å¾—åˆ°å‰12ä¸ªstateå€¼ï¼Œå†è®¾ç½®åˆ°randomä¸Šï¼Œæ¢å¤ç°åœºåé‡æ–°è°ƒç”¨éšæœºæ•°ç”Ÿæˆå³å¯ã€‚\n\nå‚è€ƒæ–‡ç« ï¼š[æµ…æMT19937ä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)](https://www.anquanke.com/post/id/205861#h2-5)\n\n### ä»£ç \n\n```py\nimport hashlib  \nimport random  \nfrom random import Random  \nfrom randcrack import RandCrack  \n  \n  \ndef test_random():  \n    r = random.getrandbits(128)  \n    print(r)  \n    hr = hex(r)[2:].zfill(32)  \n    print(hr)  \n    print(int(hr, 16))  \n  \n  \ndef invert_right(m, l, val=''):  \n    length = 32  \n    mx = 0xffffffff  \n    if val == '':  \n        val = mx  \n    i, res = 0, 0  \n    while i * l \u003c length:  \n        mask = (mx \u003c\u003c (length - l) \u0026 mx) \u003e\u003e i * l  \n        tmp = m \u0026 mask  \n        m = m ^ tmp \u003e\u003e l \u0026 val  \n        res += tmp  \n        i += 1  \n    return res  \n  \n  \ndef invert_left(m, l, val):  \n    length = 32  \n    mx = 0xffffffff  \n    i, res = 0, 0  \n    while i * l \u003c length:  \n        mask = (mx \u003e\u003e (length - l) \u0026 mx) \u003c\u003c i * l  \n        tmp = m \u0026 mask  \n        m ^= tmp \u003c\u003c l \u0026 val  \n        res |= tmp  \n        i += 1  \n    return res  \n  \n  \ndef invert_temper(m):  \n    m = invert_right(m, 18)  \n    m = invert_left(m, 15, 4022730752)  \n    m = invert_left(m, 7, 2636928640)  \n    m = invert_right(m, 11)  \n    return m  \n  \n  \ndef recover_state(record):  \n    state = [invert_temper(i) for i in record]  \n    state = reverse_twist([0] * 12 + state)  \n    return state[0:624]  \n  \n  \ndef clone_mt(record):  \n    state = recover_state(record)[0:624]  \n    gen = Random()  \n    gen.setstate((3, tuple(state + [0]), None))  \n    return gen  \n  \n  \ndef to_hex32(dec):  \n    return hex(dec)[2:].zfill(32)  \n  \n  \ndef to_hex64(dec):  \n    return hex(dec)[2:].zfill(64)  \n  \n  \ndef reverse_twist(cur):  \n    high = 0x80000000  \n    low = 0x7fffffff  \n    mask = 0x9908b0df  \n    state = cur  \n    for i in range(11, -1, -1):  \n        tmp = state[i + 624] ^ state[i + 397]  \n        # recover Y,tmp = Y  \n        if tmp \u0026 high == high:  \n            tmp ^= mask  \n            tmp \u003c\u003c= 1  \n            tmp |= 1  \n        else:  \n            tmp \u003c\u003c= 1  \n        # recover highest bit  \n        res = tmp \u0026 high  \n        # recover other 31 bits,when i =0,it just use the method again it so beautiful!!!!  \n        tmp = state[i - 1 + 624] ^ state[i + 396]  \n        # recover Y,tmp = Y  \n        if tmp \u0026 high == high:  \n            tmp ^= mask  \n            tmp \u003c\u003c= 1  \n            tmp |= 1  \n        else:  \n            tmp \u003c\u003c= 1  \n        res |= (tmp) \u0026 low  \n        state[i] = res  \n    return state  \n  \n  \ndef solve():  \n    rs128s = ['d5d97afad7ef619b4badd8d2da10ee24', '67f4660a8335fb9f4152a9fbc44c9c77',  \n              '8cd43c85ebe9cc7036a37f47ccd1d1e4', 'ee3e8c62e8b0100027589d6de82677ef',  \n              '463bb2f3731ad0e786302bf78da08330', 'e245b1852a3b92734e46eb3421bd76c9',  \n              '0b74736786b4ab94651e3b706a548e55', '79cb596b28c2b4e02738f93b5bfbe0d3',  \n              '5a9c46837952952045564b5b395acad1', 'd3c2d90a05d1a059fbeba4a05a608798',  \n              '4da0306c8ab58097d2fef9114e6fcb6d', '9707fabbd3c96de66917f15998ac9201',  \n              '9dd3e46fc930abfb523fe31e8ee8a658', '3716a8fd05f7388e7151d09431e61ee1',  \n              '9acf027679a6d7a674a43dee4f5bea35', '78702a2b125a940519337b1bf50aff8a',  \n              '262cf3b8c8072a602048a24756c83fcf', '092f8d227ec583c4734a6f449de521a3',  \n              '712aa300302b57fed458553426348fce', '834d4a0ea451cc04b469636b18c56435',  \n              '754b5284b14402c61e3b1e56cb2d41e9', '51d742ca6a341032afcb5dc645f54bfa',  \n              'c1a33d104f47e33d6932905b483a2018', '3def7c2a14cff6b2864a2100956df07f',  \n              '7e3606e4ec1c99fe5a8593ae44f25a70', '404c6139570883dbab8e5a299d7a5017',  \n              'f07597079e1b68ebb4e2d16b83b7b484', '0723daf5c65f8ba6cd6e43fcdf9d18dc',  \n              '4c54db12829f165837384b66978e8438', 'cd056e64e1f31461cab2e66ece9d3278',  \n              '2f6ae16fab122cbce240e32464a1ab57', 'f86e0e9ee23498340f62d8617f6f5218',  \n              'af4ebe2535885c783c89f8d8c4815076', 'c8eae5b5c7aca2c5fdb4f284e2cf65c5',  \n              'bec0d8ecabedd9811a8ecb6052b21d8c', '731bd3421b6517aa101357fe1c49caf3',  \n              '344f4a26cdaf1a782d9b32208e1a3e92', '892b1741d304878461dd0774a335ea3d',  \n              '56e2a484ca40f43e059bf5f0bd822bdc', 'd7c0762df71b31c14654147fb9a0595c',  \n              '57016a179ba5509f6b04a161ac628b34', 'e49a2d573522c1ee3e8348ceca0295a4',  \n              '4b0f49c7e6469e82832e9cc90b9e17c0', 'eadc9d0c8b75127fe0a7f71881de1ea7',  \n              'db9fe5537768207bd8cdf770bcd42dfa', 'ba2f57578752628d1ecac419b3a8bc36',  \n              '3752e70b5d2b578a8d412d84aab43705', '54e97795df8781c776cbb1ce4f5f31fc',  \n              '32794880abc9f68102c24e92ad9c7cd5',  \n              'b5eb7e651ca298f6873694c47d1cd3da', 'a188934777d2c67e3d59692135005497',  \n              '34c308fa1644b387169ea88c1b575490']  \n    rs256s = ['2eebed894580fb900c3615d4866150e68322ff4d48e7509f85ff4543969b0cf6',  \n              '017aefd63b4ce14eb376161902d92894a15f680e7b055ce25c3b02c6b49db0a6',  \n              'e12d945904032887c967ae03a48c8b096abc79dc64134d872693599d4f6c91cc',  \n              '0f8957f365f53a7209baa852905c5da5dba54ddb403ab17a4c9b3a051540d49c',  \n              '091e3e41815cd32f482f2cf54ac3338fc918c2a657896af1aa1b23ea528664f4',  \n              '5916cd18e8c48c545232112f2179aa7a722350a8a0ced4f1363cc61bc9d83630',  \n              '37702710d47a1c17278743253123f6eac85b16d9393432ec65100143bc8657e8',  \n              'c3a7006293c48957cba5c010f945483cfdc47650a79d0e8a8a9a52c174244a10',  \n              'e1a90a475dd21da64d64ea1dd50a82a622061d08e9d4b3016982c4a0b42f1251',  \n              '2f40ff85024765e58ed175927c53e0a279cda96ce755b602f89bfc171108ba3d',  \n              'f4f8337dd7267d02638a9cc531c8a02fe0316dd5ff6f8c8aec898c060c6fb217',  \n              '0df2f3fe1eb976944a2de5729fca4a12b83c8329b4f514869856ebb94b7d7bf9',  \n              'abb2f1277b1cb5ad07254b7f7ed346bcdb73282b306123ce0b5befe42a9e796d',  \n              '6ef31ed6a2a465bcd146c2438bf391bfd9f3187cf54afae512220a7a94714bf3',  \n              '6981f99ba288923a5cd68908ecc8795bf301f1e7d081ac6580a63902fd52da01',  \n              'b6b07975697de1c0342e3711b59165b849125794ef2541c6c60dcf40e689df7b',  \n              '20e3af3a2bcedfd15199975cc9edcde14cb13fdff3ea0607a4747601e500aede',  \n              '606aa1daf188b9dd5fd6141312f1828846f92baa519e70e5c6923a352421fe2f',  \n              '1dc6a60112e99c5b884c0bb5430a7a54eba8aef34fada9cb96bce79a22456cf2',  \n              'fd81e36f576119a19185cd12e87544b42f9fcc3dcb5e7ba282b1a128d73d63c5',  \n              '7a01e947ca012a5c9a8dd20e693a7788cd6157a5c3fce5fa7c7e09014ea3266e',  \n              'ccd162b182c773062514ffc3551ed47f32293700083782d902efc55b1e9795c6',  \n              'dbb6115aefd2638eebf44d3be6e9525e09ff036269d954469a0f925b496327a7',  \n              'ac08696fe64bb5e58cd3e558463213ca08ab7805e33f45459ae14b35fc5858c6',  \n              '6e1594596ad1c656635af29d14b22a5ed10e545442eea5f4e056e20d11aa33b3',  \n              '4afd17e64562603c66ce0ca42d544ca48511c3d560f9180c231a9ccb28a0e55e',  \n              '06b2d2b24ca626e18fdcb3196e989e3b05150500815511f48200ddea9aacda48',  \n              '947a11e8258fd161d02b0eb1b2e8fcd9ff1684a7c75f7c506ddee91f08316f56',  \n              'a0e58b15736cab055be1d03860dedb6b8136f6739308c2e0ef6a7490c6b4a1f1',  \n              '31476f64f96d72a398e7eb789068b8cfd61ed9cac95d76824a2bbf5b682ea72d',  \n              '974259198846a4849d318afd325d860a6e40dfd39e1ed8c7b6d87c990e35efcf',  \n              'e93d02ba7079c488c30e377794b4fcc62eeafb6c3f02197f1ebc059e3e5f7f07',  \n              'ded96eec0d25c05a54671a001bcd99f5c6d3991d2fdf80afb8f0861a44f3fd64',  \n              '86f34c1da65f07634de7c302a6df306dd545806022411a318900bd33b0aff9bd',  \n              '59baf4cf3d3b85fcdefd1a9b60c3d78926ff73650ac375c616b30fe9063b377d',  \n              '02f2ee251ecc19fa52dd42c0e0b609bc2e7a8ae11ce6ca35396a4bc74d12ac63',  \n              '597d09b4c43012b1b4b040d8c62d5fb02d1c4249de4eea06e1447000ba53f50c',  \n              'bb87bd8e1903db2df41c349914e9f3591bb032400be6e86ed10e7d292243a374',  \n              'cec38960069fdc8090cfbdd166e15ec8a77ce5b4d6b350805a63d2b54cbf0187',  \n              '1439d35a9c0caa9cacabe8e6179a02d51ebb9fb51125d5eeaba47ff6b8abcc97',  \n              '820d72d49e0fd86ef47b022a3091b326be8b0d2a42f87cbc918737b9972ea62f',  \n              'e625e82100031fa4a4410700034859cd4b35c086f5ac2870c6909c16a6831bfc',  \n              'f0e22f5167d29331351e1718c17b5420f6a29d84357273e1bfb24c2ff34fa675',  \n              'a5a7991f0c5c6a44f68c5c18661611057dbabeff7847623315ce784095645f75',  \n              '07cd3f5c5c690214af5feda27b3aec257543a8f96bc509805028a0e95c5d98c6',  \n              '6e5dd4405c1b446b9530e4d9356c05b71d1bfcf8a79778588143c3b6fec3fded',  \n              'a33f821d277e6f73c09a5ecd14cef80bac29ffe2b917225c27725d2447ac0489',  \n              'c18a4a02dd1f7ee65bf5596c53549c286a754afb0e3b90b2369cdd1e43c0b986',  \n              '6b8df66aa27b40ca275bc133958b5d543167edf919e7e623a496c9afbf7594d6',  \n              'c48124eeef995c7bb705bd240a26dbf6bdbe42ba29addf7ac78fa28dbed3debe',  \n              '040eef11dc6e0f3bb3e58e12d2a57ee274071a9c6224f27db70e19a8aa7d4df2',  \n              '4ecd0a955e52657fab8dfdac2df4d805f1d08b031df8bce22ac01fe20ca72c5b']  \n    record = []  \n    for i in range(52):  \n        rs128 = rs128s[i]  \n        rs128 = int(rs128, 16)  \n        record.append(rs128 \u0026 (2 ** 32 - 1))  \n        record.append((rs128 \u0026 (2 ** 64 - 1)) \u003e\u003e 32)  \n        record.append((rs128 \u0026 (2 ** 96 - 1)) \u003e\u003e 64)  \n        record.append(rs128 \u003e\u003e 96)  \n  \n        rs256 = rs256s[i]  \n        rs256 = int(rs256, 16)  \n        record.append(rs256 \u0026 (2 ** 32 - 1))  \n        record.append((rs256 \u0026 (2 ** 64 - 1)) \u003e\u003e 32)  \n        record.append((rs256 \u0026 (2 ** 96 - 1)) \u003e\u003e 64)  \n        record.append((rs256 \u0026 (2 ** 128 - 1)) \u003e\u003e 96)  \n        record.append((rs256 \u0026 (2 ** 160 - 1)) \u003e\u003e 128)  \n        record.append((rs256 \u0026 (2 ** 192 - 1)) \u003e\u003e 160)  \n        record.append((rs256 \u0026 (2 ** 224 - 1)) \u003e\u003e 192)  \n        record.append(rs256 \u003e\u003e 224)  \n  \n    g = clone_mt(record[:624])  \n    # for i in range(624):  \n    #     g.getrandbits(32) #äº§ç”Ÿå‰624ä¸ªéšæœºæ•°ï¼Œè®©stateçŠ¶æ€åˆ°ç”Ÿæˆflagå‰  \n  \n    flag = hashlib.md5((to_hex32(g.getrandbits(128)) + to_hex64(g.getrandbits(256))).encode()).hexdigest()  \n    print('flag{%s}' % flag)  \n  \n  \ndef test():  \n    for i in range(624):  \n        print(random.getrandbits(32))  \n    print(random.getrandbits(32))  \n  \n  \nif __name__ == '__main__':  \n    solve()\n```\n","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/8-%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E6%A2%AF%E5%AD%90/v2ray-multi%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%8D%E5%8A%A1%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98":{"title":"v2ray-multiæœ€æ–°ç‰ˆæœåŠ¡æ— æ³•å¯åŠ¨é—®é¢˜","content":"\n# v2ray-multiæœ€æ–°ç‰ˆæœåŠ¡æ— æ³•å¯åŠ¨é—®é¢˜\n\n/etc/systemd/system/v2ray.serviceè¿™ä¸ªæ–‡ä»¶ï¼ŒExecStart=/usr/bin/v2ray/v2ray -config /etc/v2ray/config.jsonï¼Œåœ¨-configå‰é¢åŠ ä¸ªrunï¼Œç„¶åsystemctl daemon-reloadï¼Œç„¶åé‡å¯v2rayå°±è¡Œäº†ã€‚å› ä¸ºæ–°ç‰ˆä¿®æ”¹äº†å¯åŠ¨å‘½ä»¤ï¼Œå¯åŠ¨æ—¶éœ€è¦åŠ ä¸Šrun\n","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/8-%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E7%AC%94%E8%AE%B0%E8%BD%AF%E4%BB%B6/%E6%AF%9B%E7%BA%BF%E5%89%AA%E8%97%8F%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6":{"title":"è·¯å¾„é…ç½®","content":"\n# è·¯å¾„é…ç½®\n\n```\n0_0-æ”¶é›†/0_0_0-mxwc/0_0_0_0-é»˜è®¤åˆ†ç±»\n```\n","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/8-%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E7%AC%94%E8%AE%B0%E8%BD%AF%E4%BB%B6/hugo/hugo%E5%90%AF%E7%94%A8%E6%9C%80%E5%90%8E%E4%BF%AE%E6%94%B9%E6%97%A5%E6%9C%9F":{"title":"hugoå¯ç”¨æœ€åä¿®æ”¹æ—¥æœŸ","content":"# hugoå¯ç”¨æœ€åä¿®æ”¹æ—¥æœŸ\n\n## è¯»å–ç¬”è®°yamlä¿¡æ¯\n\nä¿®æ”¹æ¨¡æ¿ï¼š\n```yaml\nupdated: å¡«å…¥æ—¥æœŸ\n```\n\nè®¾ç½®é…ç½®æ–‡ä»¶ï¼š\nå¦‚æœæ˜¯yamlæ–‡ä»¶ï¼š\n```yaml\nfrontmatter:\n  lastmod: [\":lastmod\", \"updated\"]\n```\nå¦‚æœæ˜¯tomlæ–‡ä»¶ï¼š\n```toml\n[frontmatter]\n  lastmod = [\":lastmod\", \"updated\"]\n```\n\né…ç½®æ–‡ä»¶ä¸­ç¬¬äºŒä¸ªå­—æ®µä¸yamlä¸­å®šä¹‰çš„å­—æ®µä¸€è‡´å³å¯ã€‚\n\n## è¯»å–ç¬”è®°æ–‡ä»¶ä¿®æ”¹ä¿¡æ¯\n\nè®¾ç½®é…ç½®æ–‡ä»¶ï¼š\nå¦‚æœæ˜¯yamlæ–‡ä»¶ï¼š\n```yaml\nfrontmatter:\n  lastmod: [\":fileModTime\", \"lastmod\"]\n```\nå¦‚æœæ˜¯tomlæ–‡ä»¶ï¼š\n```toml\n[frontmatter]\n  lastmod = [\":fileModTime\", \"lastmod\"]\n```","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/8-%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E7%AC%94%E8%AE%B0%E8%BD%AF%E4%BB%B6/obsidian/Obsidian%E9%85%8D%E7%BD%AEwebdav%E8%BF%9C%E7%A8%8B%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8":{"title":"Obsidiané…ç½®webdavè¿œç¨‹åŒæ­¥æœåŠ¡å™¨","content":"# Obsidiané…ç½®webdavè¿œç¨‹åŒæ­¥æœåŠ¡å™¨\n\n## å‡†å¤‡\n\n1. obsidianè½¯ä»¶\n2. obsidian remotely saveæ’ä»¶\n3. vpsæœåŠ¡å™¨ ï¼ˆubuntu2004ï¼‰\n\n## å®‰è£…å¹¶é…ç½®nginxæœåŠ¡å™¨\n\n### å®‰è£…nginxåŠwebdavæ’ä»¶\n```shell\nsudo apt\nsudo apt -y install nginx nginx-extras libnginx-mod-http-dav-ext libnginx-mod-http-auth-pam\n```\n\n### åˆ›å»ºnginxé…ç½®æ–‡ä»¶\n```shell\nvim /etc/nginx/conf.d/webdav.conf\n```\n\næ–‡ä»¶å†…å®¹ï¼š\n```nginx\nserver {\n    listen è®¾ç½®ä¸€ä¸ªç«¯å£;\n    listen [::]:è®¾ç½®ä¸€ä¸ªç«¯å£;\n    server_name å¦‚æœæœ‰åŸŸåå°±é…åœ¨è¿™é‡Œ;\n    # è®¾ç½®ä½¿ç”¨utf-8ç¼–ç ,é˜²æ­¢ä¸­æ–‡æ–‡ä»¶åä¹±ç \n    charset utf-8;\n    # é»˜è®¤å­˜æ”¾æ–‡ä»¶çš„è·¯å¾„\n    root /webdav;\n    auth_basic              realm_name;\n    # ç”¨æˆ·å¯†ç æ–‡ä»¶å­˜æ”¾ä½ç½®\n    auth_basic_user_file    /etc/nginx/.passwords.list;\n    # dav å…è®¸çš„æ“ä½œ\n    dav_methods     PUT DELETE MKCOL COPY MOVE;\n    dav_ext_methods PROPFIND OPTIONS;\n    # åˆ›å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™\n    dav_access      user:rw group:rw all:r;\n    # ä¸´æ—¶æ–‡ä»¶ä½ç½®\n    client_body_temp_path   /tmp;\n    # æœ€å¤§ä¸Šä¼ æ–‡ä»¶é™åˆ¶, 0è¡¨ç¤ºæ— é™åˆ¶\n    client_max_body_size    0;\n    # å…è®¸è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶å¤¹(å¦‚æœæœ‰éœ€è¦çš„è¯)\n    create_full_put_path    on;\n    autoindex on;\n    autoindex_exact_size on;\n\t# æ³¨æ„è¿™é‡Œå¿…é¡»è¦ç”¨locationå—åŒ…èµ·æ¥ï¼Œå¦åˆ™add_headerä¼šæŠ¥é”™\n    location / {\n        if ($request_method = OPTIONS ) {\n            add_header Content-Length 0;\n            add_header Content-Type text/plain;\n            add_header DAV 1,2;\n            add_header Allow 'OPTIONS,HEAD,GET,PROPFIND,DELETE,COPY,MOVE,PROPPATCH,LOCK,UNLOCK';\n            add_header Access-Control-Allow-Origin '$http_origin' always;\n            add_header Access-Control-Allow-Credentials 'true' always;\n            add_header Access-Control-Allow-Methods 'OPTIONS,HEAD,GET,POST,PUT,PROPFIND,DELETE,COPY,MOVE,PROPPATCH,LOCK,UNLOCK' always;\n            add_header Access-Control-Allow-Headers '*' always;\n            return 200;\n        }\n\n        add_header Access-Control-Allow-Origin '$http_origin' always;\n        add_header Access-Control-Allow-Credentials 'true' always;\n        add_header Access-Control-Allow-Methods 'OPTIONS,HEAD,GET,POST,PUT,PROPFIND,DELETE,COPY,MOVE,PROPPATCH,LOCK,UNLOCK' always;\n        add_header Access-Control-Allow-Headers 'Origin,X-Requested-With,Content-Type,Accept,Authorization,Depth' always;\n    }\n}\n```\n\næµ‹è¯•è¿é€šæ€§ï¼š\nç›´æ¥ç”¨æµè§ˆå™¨è®¿é—®åœ°å€ï¼šç«¯å£çœ‹æ˜¯å¦èƒ½æ˜ å°„å‡ºç›®å½•ã€‚\n\næ³¨æ„ï¼š\n- å¿…é¡»è¦ç”¨locationå—æŠŠadd_headeréƒ¨åˆ†åŒ…èµ·æ¥ï¼Œå¦åˆ™add_headerä¼šæŠ¥é”™ï¼Œå› ä¸ºadd_headerä¸èƒ½ç”¨åœ¨serverå—ä¸‹çš„ifå—ä¸­ã€‚\n\n### åˆ›å»ºæ–‡ä»¶å¤¹å¹¶é…ç½®æƒé™\n```shell\nmkdir /webdav\nsudo chown -R www-data:www-data /webdav\nsudo chmod 755 /webdav\n```\n\n### åˆ›å»ºç”¨æˆ·å¹¶ç”Ÿæˆå¯†ç \n```shell\n# è®¾ç½®ç”¨æˆ·å\necho -n 'è®¾ç½®ä¸€ä¸ªç”¨æˆ·å:' | sudo tee /etc/nginx/.passwords.list\n# ç”Ÿæˆå¯†ç å¹¶å†™å…¥å¯†æ–‡\nopenssl passwd -apr1 | sudo tee -a /etc/nginx/.passwords.list\n# ç¡®è®¤è¾“å…¥ä¸¤æ¬¡å¯†ç \n```\n\næ³¨æ„ï¼š\n- ç”¨æˆ·ååé¢è¦æœ‰å†’å·\n- æ–‡ä»¶æ­¤æ—¶ä¿å­˜çš„æ˜¯æ‰€è®¾ç½®å¯†ç çš„å¯†æ–‡\n\n### é…ç½®é˜²ç«å¢™å¹¶å¯åŠ¨æœåŠ¡\n\n```shell\nsudo ufw allow ä½ è®¾ç½®çš„ç«¯å£\nsudo systemctl start nginx\nsudo systemctl enable nginx\n```\n\n## è®¾ç½®æ’ä»¶\n\næŒ‰ç…§æ’ä»¶å­—æ®µæç¤ºè®¾ç½®å³å¯ï¼Œæœ‰å‡ ä¸ªåœ°æ–¹è¦æ³¨æ„ï¼š\n- æœåŠ¡å™¨åœ°å€å‰ä¹Ÿè¦åŠ `http://`ã€‚\n- ä¸å»ºè®®å¼€åŠ å¯†ï¼Œå¯èƒ½æ–‡ä»¶åä¼šè¶…è¿‡linux255å­—ç¬¦çš„é™åˆ¶å¯¼è‡´åŒæ­¥å¤±è´¥ã€‚","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/8-%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E8%99%9A%E6%8B%9F%E6%9C%BA/docker/docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C":{"title":"dockerå¸¸ç”¨æ“ä½œ","content":"\n# dockerå¸¸ç”¨æ“ä½œ\n\n## æŸ¥è¯¢æ­£åœ¨è¿è¡Œå®¹å™¨å¹¶è¿›å…¥\n\n```shell\nsudo docker ps  \nsudo docker exec -it 775c7c9ee1e1 /bin/bash\n```\n\n## å¯åŠ¨å®¹å™¨\n\n```bash\ndocker run -itd -p [å¤–éƒ¨ç«¯å£]:[å†…éƒ¨ç«¯å£] -v [å¤–éƒ¨ç»å¯¹è·¯å¾„]:[å†…éƒ¨ç»å¯¹è·¯å¾„] -w [å·¥ä½œè·¯å¾„] --name [è‡ªå®šä¹‰åç§°] [é•œåƒå]:[ç‰ˆæœ¬å·] /bin/bash\n```\n\nä¾‹å­\n\n```bash\ndocker run -itd -p 4222:22 -v /root/mfjshared:/root/shared -v /root/jys:/root/jys -w /root --name edge-dev-env-49-mfj edge-dev-env:v4.9 /bin/bash\n```\n\n## æ‰“åŒ…å®¹å™¨æˆé•œåƒ\n\n```bash\ndocker commit -a \"[ä½œè€…åç§°]\" -m \"[æè¿°]\" [å®¹å™¨id] [é•œåƒåç§°]:[ç‰ˆæœ¬å·]\n```\n","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/8-%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/Git/git%E4%B8%ADfork%E7%9A%84%E4%BB%93%E5%BA%93%E8%A7%A3%E5%86%B3merge%E5%86%B2%E7%AA%81":{"title":"gitä¸­forkçš„ä»“åº“è§£å†³mergeå†²çª","content":"\n# gitä¸­forkçš„ä»“åº“è§£å†³mergeå†²çª\n\nå‡è®¾æˆ‘ä»¬ä»è¿œç¨‹ä¸»ä»“åº“repoA fork äº†è‡ªå·±çš„repoBï¼Œæˆ‘ä»¬å¼€å‘å¹¶æäº¤ä»£ç çš„æ—¶å€™ï¼Œä¸»ä»“åº“åŒæ—¶æœ‰å…¶å®ƒäººæäº¤ä»£ç ï¼Œä¸å¹¸çš„æ˜¯ä½ ä»¬éƒ½ä¿®æ”¹äº†åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€è¡Œï¼Œäº§ç”Ÿå†²çªã€‚\n\n## 1. æ·»åŠ ä¸»ä»“åº“ä¸ºupstreamåˆ°æœ¬åœ°git\n\n[Git Upstreams and Forks: A Complete How-To | Atlassian Git Tutorial](https://www.atlassian.com/git/tutorials/git-forks-and-upstreams)\n\n1. æ£€æŸ¥æ˜¯å¦è®¾ç½®upstreamä»“åº“ï¼š\n\n```bash\n   gitÂ remoteÂ -v\n   origin   git@bitbucket.org:my-user/some-project.gitÂ (fetch)\n   originÂ Â git@bitbucket.org:my-user/some-project.gitÂ (push)\n```\n\nå¦‚æœå¦‚ä¸Šè¿°ç»“æœåˆ™è¯´æ˜æ²¡æœ‰è®¾ç½®upstreamä»“åº“ï¼Œéœ€è¦æ·»åŠ ã€‚\n\n2. è®¾ç½®upstreamä»“åº“\n\n```bash\ngitÂ remoteÂ addÂ upstreamÂ git@bitbucket.org:some-gatekeeper-maintainer/some-project.git\n```\n\næ·»åŠ åé‡æ–°æ£€æŸ¥ç»“æœå¦‚ä¸‹ï¼š\n\n```bash\ngitÂ remoteÂ -v\n    originÂ Â Â Â git@bitbucket.org:my-user/some-project.gitÂ (fetch)\n    originÂ Â Â Â git@bitbucket.org:my-user/some-project.gitÂ (push) upstreamÂ Â git@bitbucket.org:some-gatekeeper-maintainer/some-project.gitÂ (fetch)\n    upstreamÂ Â git@bitbucket.org:some-gatekeeper-maintainer/some-project.gitÂ (push)\n```\n\n3. åˆ›å»ºåˆ†æ”¯æˆ–è€…ä½¿ç”¨devåˆ†æ”¯ï¼Œå‡†å¤‡å¤„ç†åˆ°æ¥çš„å†²çª\n\nfetchçš„æœ€æ–°ä»£ç ï¼Œå¦‚æœå’Œæœ¬åœ°æäº¤ä¿®æ”¹äº†åŒä¸€è¡Œï¼Œå°±ä¼šå‘ç”Ÿå†²çªï¼Œæ­¤æ—¶gitçš„è‡ªåŠ¨mergeæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å†²çªï¼Œä¸ºæ­¤åˆ›å»ºä¸€ä¸ªåˆ†æ”¯è€Œä¸æ˜¯ä½¿ç”¨masteråˆ†æ”¯æ¥å¤„ç†å†²çªã€‚\n\n```bash\ngitÂ checkoutÂ -bÂ dev\n#someÂ workÂ andÂ someÂ commitsÂ happen\n#someÂ timeÂ passes\n```\n\n4. ä»upstream fetchæœ€æ–°çš„ä»£ç \n\nåœ¨ä¸çŸ¥ä¸è§‰ä¸­ï¼Œä¸»ä»“åº“çš„å…¶å®ƒå¼€å‘äººå‘˜ä¼šæäº¤ä»£ç ï¼Œä½ è‡ªå·±forkçš„ä»£ç å¯èƒ½å°±ä¼šè½åï¼Œè¿™æ—¶å€™éœ€è¦fetchè·å–æœ€æ–°çš„ä»£ç åˆ°æœ¬åœ°ï¼Œä¿æŒä»£ç çš„æ–°é²œï¼š\n\n```bash\ngit fetch upstream\n```\n\n5. åˆå¹¶æœ¬åœ°ä»“åº“çš„headä¸ä¸»ä»“åº“çš„head\n\nå‡å¦‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯vscodeæ¥å¼€å‘ï¼Œæœ‰gitå›¾å½¢ç•Œé¢ã€‚\nfetchåˆ°æœ€æ–°çš„ä¸»ä»“åº“ä»£ç åï¼Œä¸»ä»“åº“äº§ç”Ÿçš„å˜åŠ¨ä¼šåˆ†æˆä¸¤ç§ï¼š\n1. æ²¡æœ‰å†²çªçš„ä»£ç æ›´æ–°ï¼Œä¼šç›´æ¥è¢«å­˜æ”¾åœ¨staged changesä¸­ï¼Œä»£è¡¨è¿™äº›å˜åŠ¨æ— éœ€å¤„ç†å†²çªï¼Œå¯ä»¥ç›´æ¥åœ¨repoBä¸Šcommitã€‚\n2. å­˜åœ¨å†²çªçš„æ›´æ–°ï¼Œä¼šå­˜æ”¾åœ¨merge changesä¸­ï¼Œä»£è¡¨è¿™äº›å˜åŠ¨éœ€è¦æ‰‹åŠ¨å¤„ç†å†²çªï¼Œæ­¤æ—¶åœ¨vscodeä¸Šé€šè¿‡å›¾å½¢ç•Œé¢æ‰‹åŠ¨å®¡æ ¸ä»£ç å¤„ç†å†²çªï¼Œå®Œæˆå¤„ç†åä¼šç§»åŠ¨åˆ°staged changesä¸­ã€‚\n\n6. pushä»£ç åˆ°å…‹éš†çš„è¿œç¨‹ä»“åº“repoB\n\nç›´æ¥pushå°±è¡Œã€‚\n\n```bash\ngit push\n```\n\n7. å‘ä¸»ä»“åº“æäº¤PR\n\næ­¤æ—¶åœ¨repoBä¸Šæäº¤çš„commitæ˜¯ç»è¿‡fetchæœ€æ–°ä»£ç å¹¶å¤„ç†äº†åˆå¹¶å†²çªçš„ï¼Œå‘ä¸»ä»“åº“æäº¤åˆå¹¶è¯·æ±‚ä¸ä¼šå†äº§ç”Ÿåˆå¹¶å†²çªé—®é¢˜ã€‚\n","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null},"/3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/8-%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/Git/git%E5%A4%9A%E4%BA%BA%E5%8D%8F%E4%BD%9C":{"title":"gitå¤šäººåä½œ","content":"\n# gitå¤šäººåä½œ\n\n## åˆ›å»ºåˆ†æ”¯\n\nåˆ†æ”¯çš„ä½œç”¨æ˜¯ä¸ºäº†åŒºåˆ«å¼€ä¸åŒçš„å¼€å‘æµç¨‹ï¼Œæ–¹ä¾¿åšå¹¶è¡Œå¤„ç†ä»¥åŠå¿«é€Ÿåˆ‡æ¢ï¼Œä¾‹å¦‚ä¸€ä¸ªdevåˆ†æ”¯ç”¨äºä¸»å¼€å‘æµç¨‹ï¼Œè€Œçªç„¶éœ€è¦é’ˆå¯¹æŸä¸ªåœºæ™¯åšå…¼å®¹æ€§å¼€å‘ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªdev2åˆ†æ”¯å¹¶åˆ‡æ¢è¿‡å»ã€‚\n\n[Git - åˆ†æ”¯çš„æ–°å»ºä¸åˆå¹¶ (git-scm.com)](https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E6%96%B0%E5%BB%BA%E4%B8%8E%E5%90%88%E5%B9%B6)\n","lastmodified":"2023-01-23T15:37:51.81068106Z","tags":null}}