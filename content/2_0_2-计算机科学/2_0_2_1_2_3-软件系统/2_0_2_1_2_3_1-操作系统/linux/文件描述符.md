---
title: 文件描述符
created: 2022-08-02 23:42:31
updated: 2022-10-02 22:50:23
tags: 
- atom
---

文件描述符表项的下标，就是文件描述符。

# 文件描述符

> [2、文件指针与文件描述符 - 孤情剑客 - 博客园 (cnblogs.com)](https://www.cnblogs.com/The-explosion/articles/12246297.html)

**文件描述符在形式上是一个非负整数**。实际上，它是一个**索引值**，指向内核为每一个进程所维护的该进程打开文件的**记录表**。该表的记录值是一个**file_struct对象**，成员字段记录了文件的状态信息、读写位置、路径等。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。

![[2_0_2-计算机科学/2_0_2_1_2_3-软件系统/2_0_2_1_2_3_1-操作系统/z-attachments/Pasted image 20221002224808.png]]

>文件描述符这一概念往往只适用于UNIX、Linux这样的操作系统。

系统为每一个进程维护了一个文件描述符表，该表的值都是从0开始的，所以在不同的进程中你会看到相同的文件描述符，这种情况下相同文件描述符有可能指向同一个文件，也有可能指向不同的文件。

具体情况要具体分析，要理解具体其概况如何，需要查看由内核维护的3个数据结构。内核使用3种数据结构表示打开的文件，他们之间的关系决定了在文件共享方面一个进程对另一个进程的影响。

1. 进程级的文件描述符表。每个进程在进程表中都有一个纪录项，纪录项中包含一张打开文件描述符表，每个文件描述符各占一项，与每个文件描述符相关的是：
	1. 文件描述符标志
	2. 指向一个文件表项的指针
2. 系统级的打开文件描述符表。内核为所有打开文件维护一张文件表项，每个文件表项包含：
	1. 文件状态(读 写 同步 非阻塞等)
	2. 当前文件偏移量
	3. 指向改文件inode（Linux）节点(v节点unix )的指针
4. 文件系统的i-node表。每打开一个文件或设备，都有一个inode节点结构，inode节点包含了文件类型和对此文件进行操作函数的指针，对于大多数文件，inode节点还包含了文件的i节点索引节点，这些信息是在打开文件时从磁盘读入内存的，所以，文件的所有文件信息都是随时可用的。inode节点包含了文件的所有者，文件长度，指向文件实际数据块在磁盘上位置的指针等。
5. 

## file_struct的存放

从文件描述符表的前端开始找到第一个没有被使用的单元格。


## 不同的进程打开同一个文件

  不同的进程打开同一个文件，那么他们应该有各自对应的文件表表项。因为文件表表项记录了进程读写文件时的偏移量和存取权限。多个进程不可能共享一个文件偏移量。另外他们各自打开文件的权限也可能是不同的，有的是为了读、有的为了写，有的为了读写。所以，他们应该有不同的文件表表项。

此外，因为是同一个文件，所以，多个进程会共享同一个索引结点表项。即他们的文件表表项指针会指向同一个索引结点，最终，如下图所示：

![[z-oblib/z2-attachments/Pasted image 20220803012527.png]]

## 同一个进程多次打开同一个文件

每打开一次同一个文件，内核就会在文件表中增加一个表项。这是因为每次open文件时使用了不同的读写权限，而读写权限是保存在文件表表项里面的。所以，效果如下所示：

![[z-oblib/z2-attachments/Pasted image 20220803012609.png]]
