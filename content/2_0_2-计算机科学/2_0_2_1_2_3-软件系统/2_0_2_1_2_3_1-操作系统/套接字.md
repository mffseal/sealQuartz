---
title: 套接字
created: 2022-08-03 13:29:03
updated: 2022-08-03 14:13:38
tags: 
- atom
---
# 套接字

套接字（Socket）用于协调不同计算机上的[[2_0_2-计算机科学/2_0_2_1_2_3-软件系统/2_0_2_1_2_3_1-操作系统/进程|进程]]间通信，也就是基于网络的通信。当然，也可以在本机上使用套接字进行进程间的通信。

套接字通信的方式非常多，有Unix域套接字、TCP套接字、UDP套接字、链路层套接字等等。但最常用的肯定是TCP套接字。所以，这里介绍下TCP Socket通信方式，稍后再单独介绍Unix域套接字。

TCP Socket用于客户端、服务端的基于TCP协议的通信，所以在客户端和服务端均需要创建一个套接字。创建TCP套接字时会返回这个套接字的文件描述符，可通过这个[[2_0_2-计算机科学/2_0_2_1_2_3-软件系统/2_0_2_1_2_3_1-操作系统/文件描述符|文件描述符]]对套接字进行读和写操作。

对比一下，当一个程序需要对一个磁盘文件同时进行读写操作（在命令行下似乎没有找到这种命令，但通过编程方式是很容易实现的）时，由于只通过单个文件描述符同时负责读和写，很可能需要通过不断移动文件指针的方式来改变读写的位置，否则数据很容易错乱。

而TCP套接字也是通过单个文件描述符进行读写套接字的，为了保证读和写的位置不错乱，操作系统在内核空间为**每个TCP套接字维护了两个buffer空间**，一个buffer用于写、一个buffer用于读。提供读的buffer空间称为recv buffer，提供写的buffer空间称为send buffer，它们统称为socket buffer。

所以，服务端和客户端通过两个套接字通信就简单了，一端向send buffer写数据，该buffer的数据会通过已经建立好的TCP连接发送到另一端的recv buffer，于是另一端只需从recv buffer中读数据即可实现不同计算机上的进程间通信。过程如图。

![[z-oblib/z2-attachments/Pasted image 20220803132920.png]]