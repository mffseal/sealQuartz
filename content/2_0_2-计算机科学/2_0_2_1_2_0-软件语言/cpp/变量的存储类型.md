---
title: 变量的存储类型
created: 2022-10-23 17:01:28
updated: 2022-10-23 19:40:28
tags: 
- atom
---

# 变量的存储类型

存储类型是指变量存储的内存类型，决定了变量何时创建、何时销毁、持续时间。

## 存储区域

- 普通内存
- 运行时堆栈
- 硬件寄存器

## 缺省存储类型

变量缺省存储类型取决于声明位置：
- 声明在任何代码块外：静态内存
	- 在程序运行前创建
	- 程序执行期间一直存在
	- 始终保持原先的值，除非中途赋值或程序结束
- 声明在代码块内部：堆栈
	- 该类型为自动类型（automatic），变量是自动变量
	- 可以显示使用auto关键字修改该种变量
	- 程序执行到变量声明时才创建该变量
	- 程序流程离开该代码块时变量被销毁
	- 代码块被多次执行时，自动变量每次都会重新创建

## 改变存储类型

> 修改变量的存储类型不代表修改变量的作用域。

- static修饰自动变量：转为静态存储。
	- 变量生命周期为整个程序执行期间。
	- 函数的形参不能声明为静态，因为实参总是在准版种传递给函数，用于支持递归。
- register修饰自动变量：转为寄存器变量，存储于寄存器而不是内存。
	- 编译器不一定会处理register关键字。
		- 因寄存器数量有限，编译器只会选前几个变量为寄存器变量。
		- 编译器有自己的寄存器优化策略，则会忽略该关键字。
		- 可以把函数形参声明为寄存器变量。
		- 寄存器变量的使用使得函数需要在执行前保存寄存器状态，返回时恢复寄存器状态。

## 变量初始化

- 静态变量的初始值记录在可执行文件中的.bss段，程序加载后保存该值得内存地址会赋值给变量，未指定初始值则为0。
- 自动变量的存储位置在程序链接时并不确定，所以没有初始值，显式的初始化将在代码块中插入一条赋值语句。
	- 在声明变量时初始化与先声明后赋值的效率一样。
	- 每次执行到自动变量声明时都会执行初始化语句。
	- 运行时的初始化支持任意表达式作为初始化值。
	- 自动变量未初始化时值都是垃圾。
